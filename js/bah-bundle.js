///#source 1 1 Custom/browserWarning.js
// ----------------------------------------------------------
// A short snippet for detecting versions of IE in JavaScript
// without resorting to user-agent sniffing
// ----------------------------------------------------------
// If you're not in IE (or IE version is less than 5) then:
// ie === undefined
// If you're in IE (>=5) then you can determine which version:
// ie === 7; // IE7
// Thus, to detect IE:
// if (ie) {}
// And to detect the version:
// ie === 6 // IE6
// ie > 7 // IE8, IE9 ...
// ie < 9 // Anything less than IE9
// ----------------------------------------------------------

// UPDATE: Now using Live NodeList idea from @jdalton

var ie = (function () {
    var v = 3
      , div = document.createElement('div')
      , all = div.getElementsByTagName('i')
    do
        div.innerHTML = '<!--[if gt IE ' + (++v) + ']><i></i><![endif]-->'
    while
    (all[0])
    return v > 4 ? v : document.documentMode
}())
//console.log('IE = ' + ie);
if (ie < 10) {
    var warning = 'Zone does not support the web browser you are using. Please use Internet Explorer 10+, the latest version of Google Chrome or Safari. If you continue to experience problems, please contact the help desk.';
    var checkForElement = setInterval(function () { findElement() }, 1000);
    function findElement() {
        var parentElement = document.getElementsByTagName('body')[0];
        if (parentElement !== undefined) {
            var referenceElement = parentElement.firstChild;
            var newElement = document.createElement('div');
            newElement.setAttribute('id', 'browser-warning');
            parentElement.insertBefore(newElement, referenceElement);
            newElement.innerHTML = warning;
            clearInterval(checkForElement);
        }
    }
}

///#source 1 1 Plugins/modernizr.js
/*!
 * Modernizr v2.8.3
 * www.modernizr.com
 *
 * Copyright (c) Faruk Ates, Paul Irish, Alex Sexton
 * Available under the BSD and MIT licenses: www.modernizr.com/license/
 */
window.Modernizr=function(a,b,c){function d(a){t.cssText=a}function e(a,b){return d(x.join(a+";")+(b||""))}function f(a,b){return typeof a===b}function g(a,b){return!!~(""+a).indexOf(b)}function h(a,b){for(var d in a){var e=a[d];if(!g(e,"-")&&t[e]!==c)return"pfx"==b?e:!0}return!1}function i(a,b,d){for(var e in a){var g=b[a[e]];if(g!==c)return d===!1?a[e]:f(g,"function")?g.bind(d||b):g}return!1}function j(a,b,c){var d=a.charAt(0).toUpperCase()+a.slice(1),e=(a+" "+z.join(d+" ")+d).split(" ");return f(b,"string")||f(b,"undefined")?h(e,b):(e=(a+" "+A.join(d+" ")+d).split(" "),i(e,b,c))}function k(){o.input=function(c){for(var d=0,e=c.length;e>d;d++)E[c[d]]=!!(c[d]in u);return E.list&&(E.list=!(!b.createElement("datalist")||!a.HTMLDataListElement)),E}("autocomplete autofocus list placeholder max min multiple pattern required step".split(" ")),o.inputtypes=function(a){for(var d,e,f,g=0,h=a.length;h>g;g++)u.setAttribute("type",e=a[g]),d="text"!==u.type,d&&(u.value=v,u.style.cssText="position:absolute;visibility:hidden;",/^range$/.test(e)&&u.style.WebkitAppearance!==c?(q.appendChild(u),f=b.defaultView,d=f.getComputedStyle&&"textfield"!==f.getComputedStyle(u,null).WebkitAppearance&&0!==u.offsetHeight,q.removeChild(u)):/^(search|tel)$/.test(e)||(d=/^(url|email)$/.test(e)?u.checkValidity&&u.checkValidity()===!1:u.value!=v)),D[a[g]]=!!d;return D}("search tel url email datetime date month week time datetime-local number range color".split(" "))}var l,m,n="2.8.3",o={},p=!0,q=b.documentElement,r="modernizr",s=b.createElement(r),t=s.style,u=b.createElement("input"),v=":)",w={}.toString,x=" -webkit- -moz- -o- -ms- ".split(" "),y="Webkit Moz O ms",z=y.split(" "),A=y.toLowerCase().split(" "),B={svg:"http://www.w3.org/2000/svg"},C={},D={},E={},F=[],G=F.slice,H=function(a,c,d,e){var f,g,h,i,j=b.createElement("div"),k=b.body,l=k||b.createElement("body");if(parseInt(d,10))for(;d--;)h=b.createElement("div"),h.id=e?e[d]:r+(d+1),j.appendChild(h);return f=["&#173;",'<style id="s',r,'">',a,"</style>"].join(""),j.id=r,(k?j:l).innerHTML+=f,l.appendChild(j),k||(l.style.background="",l.style.overflow="hidden",i=q.style.overflow,q.style.overflow="hidden",q.appendChild(l)),g=c(j,a),k?j.parentNode.removeChild(j):(l.parentNode.removeChild(l),q.style.overflow=i),!!g},I=function(b){var c=a.matchMedia||a.msMatchMedia;if(c)return c(b)&&c(b).matches||!1;var d;return H("@media "+b+" { #"+r+" { position: absolute; } }",function(b){d="absolute"==(a.getComputedStyle?getComputedStyle(b,null):b.currentStyle).position}),d},J=function(){function a(a,e){e=e||b.createElement(d[a]||"div"),a="on"+a;var g=a in e;return g||(e.setAttribute||(e=b.createElement("div")),e.setAttribute&&e.removeAttribute&&(e.setAttribute(a,""),g=f(e[a],"function"),f(e[a],"undefined")||(e[a]=c),e.removeAttribute(a))),e=null,g}var d={select:"input",change:"input",submit:"form",reset:"form",error:"img",load:"img",abort:"img"};return a}(),K={}.hasOwnProperty;m=f(K,"undefined")||f(K.call,"undefined")?function(a,b){return b in a&&f(a.constructor.prototype[b],"undefined")}:function(a,b){return K.call(a,b)},Function.prototype.bind||(Function.prototype.bind=function(a){var b=this;if("function"!=typeof b)throw new TypeError;var c=G.call(arguments,1),d=function(){if(this instanceof d){var e=function(){};e.prototype=b.prototype;var f=new e,g=b.apply(f,c.concat(G.call(arguments)));return Object(g)===g?g:f}return b.apply(a,c.concat(G.call(arguments)))};return d}),C.flexbox=function(){return j("flexWrap")},C.flexboxlegacy=function(){return j("boxDirection")},C.canvas=function(){var a=b.createElement("canvas");return!(!a.getContext||!a.getContext("2d"))},C.canvastext=function(){return!(!o.canvas||!f(b.createElement("canvas").getContext("2d").fillText,"function"))},C.webgl=function(){return!!a.WebGLRenderingContext},C.touch=function(){var c;return"ontouchstart"in a||a.DocumentTouch&&b instanceof DocumentTouch?c=!0:H(["@media (",x.join("touch-enabled),("),r,")","{#modernizr{top:9px;position:absolute}}"].join(""),function(a){c=9===a.offsetTop}),c},C.geolocation=function(){return"geolocation"in navigator},C.postmessage=function(){return!!a.postMessage},C.websqldatabase=function(){return!!a.openDatabase},C.indexedDB=function(){return!!j("indexedDB",a)},C.hashchange=function(){return J("hashchange",a)&&(b.documentMode===c||b.documentMode>7)},C.history=function(){return!(!a.history||!history.pushState)},C.draganddrop=function(){var a=b.createElement("div");return"draggable"in a||"ondragstart"in a&&"ondrop"in a},C.websockets=function(){return"WebSocket"in a||"MozWebSocket"in a},C.rgba=function(){return d("background-color:rgba(150,255,150,.5)"),g(t.backgroundColor,"rgba")},C.hsla=function(){return d("background-color:hsla(120,40%,100%,.5)"),g(t.backgroundColor,"rgba")||g(t.backgroundColor,"hsla")},C.multiplebgs=function(){return d("background:url(https://),url(https://),red url(https://)"),/(url\s*\(.*?){3}/.test(t.background)},C.backgroundsize=function(){return j("backgroundSize")},C.borderimage=function(){return j("borderImage")},C.borderradius=function(){return j("borderRadius")},C.boxshadow=function(){return j("boxShadow")},C.textshadow=function(){return""===b.createElement("div").style.textShadow},C.opacity=function(){return e("opacity:.55"),/^0.55$/.test(t.opacity)},C.cssanimations=function(){return j("animationName")},C.csscolumns=function(){return j("columnCount")},C.cssgradients=function(){var a="background-image:",b="gradient(linear,left top,right bottom,from(#9f9),to(white));",c="linear-gradient(left top,#9f9, white);";return d((a+"-webkit- ".split(" ").join(b+a)+x.join(c+a)).slice(0,-a.length)),g(t.backgroundImage,"gradient")},C.cssreflections=function(){return j("boxReflect")},C.csstransforms=function(){return!!j("transform")},C.csstransforms3d=function(){var a=!!j("perspective");return a&&"webkitPerspective"in q.style&&H("@media (transform-3d),(-webkit-transform-3d){#modernizr{left:9px;position:absolute;height:3px;}}",function(b){a=9===b.offsetLeft&&3===b.offsetHeight}),a},C.csstransitions=function(){return j("transition")},C.fontface=function(){var a;return H('@font-face {font-family:"font";src:url("https://")}',function(c,d){var e=b.getElementById("smodernizr"),f=e.sheet||e.styleSheet,g=f?f.cssRules&&f.cssRules[0]?f.cssRules[0].cssText:f.cssText||"":"";a=/src/i.test(g)&&0===g.indexOf(d.split(" ")[0])}),a},C.generatedcontent=function(){var a;return H(["#",r,"{font:0/0 a}#",r,':after{content:"',v,'";visibility:hidden;font:3px/1 a}'].join(""),function(b){a=b.offsetHeight>=3}),a},C.video=function(){var a=b.createElement("video"),c=!1;try{(c=!!a.canPlayType)&&(c=new Boolean(c),c.ogg=a.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,""),c.h264=a.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,""),c.webm=a.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,""))}catch(d){}return c},C.audio=function(){var a=b.createElement("audio"),c=!1;try{(c=!!a.canPlayType)&&(c=new Boolean(c),c.ogg=a.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),c.mp3=a.canPlayType("audio/mpeg;").replace(/^no$/,""),c.wav=a.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),c.m4a=(a.canPlayType("audio/x-m4a;")||a.canPlayType("audio/aac;")).replace(/^no$/,""))}catch(d){}return c},C.localstorage=function(){try{return localStorage.setItem(r,r),localStorage.removeItem(r),!0}catch(a){return!1}},C.sessionstorage=function(){try{return sessionStorage.setItem(r,r),sessionStorage.removeItem(r),!0}catch(a){return!1}},C.webworkers=function(){return!!a.Worker},C.applicationcache=function(){return!!a.applicationCache},C.svg=function(){return!!b.createElementNS&&!!b.createElementNS(B.svg,"svg").createSVGRect},C.inlinesvg=function(){var a=b.createElement("div");return a.innerHTML="<svg/>",(a.firstChild&&a.firstChild.namespaceURI)==B.svg},C.smil=function(){return!!b.createElementNS&&/SVGAnimate/.test(w.call(b.createElementNS(B.svg,"animate")))},C.svgclippaths=function(){return!!b.createElementNS&&/SVGClipPath/.test(w.call(b.createElementNS(B.svg,"clipPath")))};for(var L in C)m(C,L)&&(l=L.toLowerCase(),o[l]=C[L](),F.push((o[l]?"":"no-")+l));return o.input||k(),o.addTest=function(a,b){if("object"==typeof a)for(var d in a)m(a,d)&&o.addTest(d,a[d]);else{if(a=a.toLowerCase(),o[a]!==c)return o;b="function"==typeof b?b():b,"undefined"!=typeof p&&p&&(q.className+=" "+(b?"":"no-")+a),o[a]=b}return o},d(""),s=u=null,function(a,b){function c(a,b){var c=a.createElement("p"),d=a.getElementsByTagName("head")[0]||a.documentElement;return c.innerHTML="x<style>"+b+"</style>",d.insertBefore(c.lastChild,d.firstChild)}function d(){var a=s.elements;return"string"==typeof a?a.split(" "):a}function e(a){var b=r[a[p]];return b||(b={},q++,a[p]=q,r[q]=b),b}function f(a,c,d){if(c||(c=b),k)return c.createElement(a);d||(d=e(c));var f;return f=d.cache[a]?d.cache[a].cloneNode():o.test(a)?(d.cache[a]=d.createElem(a)).cloneNode():d.createElem(a),!f.canHaveChildren||n.test(a)||f.tagUrn?f:d.frag.appendChild(f)}function g(a,c){if(a||(a=b),k)return a.createDocumentFragment();c=c||e(a);for(var f=c.frag.cloneNode(),g=0,h=d(),i=h.length;i>g;g++)f.createElement(h[g]);return f}function h(a,b){b.cache||(b.cache={},b.createElem=a.createElement,b.createFrag=a.createDocumentFragment,b.frag=b.createFrag()),a.createElement=function(c){return s.shivMethods?f(c,a,b):b.createElem(c)},a.createDocumentFragment=Function("h,f","return function(){var n=f.cloneNode(),c=n.createElement;h.shivMethods&&("+d().join().replace(/[\w\-]+/g,function(a){return b.createElem(a),b.frag.createElement(a),'c("'+a+'")'})+");return n}")(s,b.frag)}function i(a){a||(a=b);var d=e(a);return!s.shivCSS||j||d.hasCSS||(d.hasCSS=!!c(a,"article,aside,dialog,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}mark{background:#FF0;color:#000}template{display:none}")),k||h(a,d),a}var j,k,l="3.7.0",m=a.html5||{},n=/^<|^(?:button|map|select|textarea|object|iframe|option|optgroup)$/i,o=/^(?:a|b|code|div|fieldset|h1|h2|h3|h4|h5|h6|i|label|li|ol|p|q|span|strong|style|table|tbody|td|th|tr|ul)$/i,p="_html5shiv",q=0,r={};!function(){try{var a=b.createElement("a");a.innerHTML="<xyz></xyz>",j="hidden"in a,k=1==a.childNodes.length||function(){b.createElement("a");var a=b.createDocumentFragment();return"undefined"==typeof a.cloneNode||"undefined"==typeof a.createDocumentFragment||"undefined"==typeof a.createElement}()}catch(c){j=!0,k=!0}}();var s={elements:m.elements||"abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video",version:l,shivCSS:m.shivCSS!==!1,supportsUnknownElements:k,shivMethods:m.shivMethods!==!1,type:"default",shivDocument:i,createElement:f,createDocumentFragment:g};a.html5=s,i(b)}(this,b),o._version=n,o._prefixes=x,o._domPrefixes=A,o._cssomPrefixes=z,o.mq=I,o.hasEvent=J,o.testProp=function(a){return h([a])},o.testAllProps=j,o.testStyles=H,o.prefixed=function(a,b,c){return b?j(a,b,c):j(a,"pfx")},q.className=q.className.replace(/(^|\s)no-js(\s|$)/,"$1$2")+(p?" js "+F.join(" "):""),o}(this,this.document);

///#source 1 1 Plugins/jquery.js
/*! jQuery v2.1.1 | (c) 2005, 2014 jQuery Foundation, Inc. | jquery.org/license */
!function(a,b){"object"==typeof module&&"object"==typeof module.exports?module.exports=a.document?b(a,!0):function(a){if(!a.document)throw new Error("jQuery requires a window with a document");return b(a)}:b(a)}("undefined"!=typeof window?window:this,function(a,b){var c=[],d=c.slice,e=c.concat,f=c.push,g=c.indexOf,h={},i=h.toString,j=h.hasOwnProperty,k={},l=a.document,m="2.1.1",n=function(a,b){return new n.fn.init(a,b)},o=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,p=/^-ms-/,q=/-([\da-z])/gi,r=function(a,b){return b.toUpperCase()};n.fn=n.prototype={jquery:m,constructor:n,selector:"",length:0,toArray:function(){return d.call(this)},get:function(a){return null!=a?0>a?this[a+this.length]:this[a]:d.call(this)},pushStack:function(a){var b=n.merge(this.constructor(),a);return b.prevObject=this,b.context=this.context,b},each:function(a,b){return n.each(this,a,b)},map:function(a){return this.pushStack(n.map(this,function(b,c){return a.call(b,c,b)}))},slice:function(){return this.pushStack(d.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(a){var b=this.length,c=+a+(0>a?b:0);return this.pushStack(c>=0&&b>c?[this[c]]:[])},end:function(){return this.prevObject||this.constructor(null)},push:f,sort:c.sort,splice:c.splice},n.extend=n.fn.extend=function(){var a,b,c,d,e,f,g=arguments[0]||{},h=1,i=arguments.length,j=!1;for("boolean"==typeof g&&(j=g,g=arguments[h]||{},h++),"object"==typeof g||n.isFunction(g)||(g={}),h===i&&(g=this,h--);i>h;h++)if(null!=(a=arguments[h]))for(b in a)c=g[b],d=a[b],g!==d&&(j&&d&&(n.isPlainObject(d)||(e=n.isArray(d)))?(e?(e=!1,f=c&&n.isArray(c)?c:[]):f=c&&n.isPlainObject(c)?c:{},g[b]=n.extend(j,f,d)):void 0!==d&&(g[b]=d));return g},n.extend({expando:"jQuery"+(m+Math.random()).replace(/\D/g,""),isReady:!0,error:function(a){throw new Error(a)},noop:function(){},isFunction:function(a){return"function"===n.type(a)},isArray:Array.isArray,isWindow:function(a){return null!=a&&a===a.window},isNumeric:function(a){return!n.isArray(a)&&a-parseFloat(a)>=0},isPlainObject:function(a){return"object"!==n.type(a)||a.nodeType||n.isWindow(a)?!1:a.constructor&&!j.call(a.constructor.prototype,"isPrototypeOf")?!1:!0},isEmptyObject:function(a){var b;for(b in a)return!1;return!0},type:function(a){return null==a?a+"":"object"==typeof a||"function"==typeof a?h[i.call(a)]||"object":typeof a},globalEval:function(a){var b,c=eval;a=n.trim(a),a&&(1===a.indexOf("use strict")?(b=l.createElement("script"),b.text=a,l.head.appendChild(b).parentNode.removeChild(b)):c(a))},camelCase:function(a){return a.replace(p,"ms-").replace(q,r)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toLowerCase()===b.toLowerCase()},each:function(a,b,c){var d,e=0,f=a.length,g=s(a);if(c){if(g){for(;f>e;e++)if(d=b.apply(a[e],c),d===!1)break}else for(e in a)if(d=b.apply(a[e],c),d===!1)break}else if(g){for(;f>e;e++)if(d=b.call(a[e],e,a[e]),d===!1)break}else for(e in a)if(d=b.call(a[e],e,a[e]),d===!1)break;return a},trim:function(a){return null==a?"":(a+"").replace(o,"")},makeArray:function(a,b){var c=b||[];return null!=a&&(s(Object(a))?n.merge(c,"string"==typeof a?[a]:a):f.call(c,a)),c},inArray:function(a,b,c){return null==b?-1:g.call(b,a,c)},merge:function(a,b){for(var c=+b.length,d=0,e=a.length;c>d;d++)a[e++]=b[d];return a.length=e,a},grep:function(a,b,c){for(var d,e=[],f=0,g=a.length,h=!c;g>f;f++)d=!b(a[f],f),d!==h&&e.push(a[f]);return e},map:function(a,b,c){var d,f=0,g=a.length,h=s(a),i=[];if(h)for(;g>f;f++)d=b(a[f],f,c),null!=d&&i.push(d);else for(f in a)d=b(a[f],f,c),null!=d&&i.push(d);return e.apply([],i)},guid:1,proxy:function(a,b){var c,e,f;return"string"==typeof b&&(c=a[b],b=a,a=c),n.isFunction(a)?(e=d.call(arguments,2),f=function(){return a.apply(b||this,e.concat(d.call(arguments)))},f.guid=a.guid=a.guid||n.guid++,f):void 0},now:Date.now,support:k}),n.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(a,b){h["[object "+b+"]"]=b.toLowerCase()});function s(a){var b=a.length,c=n.type(a);return"function"===c||n.isWindow(a)?!1:1===a.nodeType&&b?!0:"array"===c||0===b||"number"==typeof b&&b>0&&b-1 in a}var t=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u="sizzle"+-new Date,v=a.document,w=0,x=0,y=gb(),z=gb(),A=gb(),B=function(a,b){return a===b&&(l=!0),0},C="undefined",D=1<<31,E={}.hasOwnProperty,F=[],G=F.pop,H=F.push,I=F.push,J=F.slice,K=F.indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(this[b]===a)return b;return-1},L="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",M="[\\x20\\t\\r\\n\\f]",N="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",O=N.replace("w","w#"),P="\\["+M+"*("+N+")(?:"+M+"*([*^$|!~]?=)"+M+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+O+"))|)"+M+"*\\]",Q=":("+N+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+P+")*)|.*)\\)|)",R=new RegExp("^"+M+"+|((?:^|[^\\\\])(?:\\\\.)*)"+M+"+$","g"),S=new RegExp("^"+M+"*,"+M+"*"),T=new RegExp("^"+M+"*([>+~]|"+M+")"+M+"*"),U=new RegExp("="+M+"*([^\\]'\"]*?)"+M+"*\\]","g"),V=new RegExp(Q),W=new RegExp("^"+O+"$"),X={ID:new RegExp("^#("+N+")"),CLASS:new RegExp("^\\.("+N+")"),TAG:new RegExp("^("+N.replace("w","w*")+")"),ATTR:new RegExp("^"+P),PSEUDO:new RegExp("^"+Q),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+M+"*(even|odd|(([+-]|)(\\d*)n|)"+M+"*(?:([+-]|)"+M+"*(\\d+)|))"+M+"*\\)|)","i"),bool:new RegExp("^(?:"+L+")$","i"),needsContext:new RegExp("^"+M+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+M+"*((?:-\\d)?\\d*)"+M+"*\\)|)(?=[^-]|$)","i")},Y=/^(?:input|select|textarea|button)$/i,Z=/^h\d$/i,$=/^[^{]+\{\s*\[native \w/,_=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ab=/[+~]/,bb=/'|\\/g,cb=new RegExp("\\\\([\\da-f]{1,6}"+M+"?|("+M+")|.)","ig"),db=function(a,b,c){var d="0x"+b-65536;return d!==d||c?b:0>d?String.fromCharCode(d+65536):String.fromCharCode(d>>10|55296,1023&d|56320)};try{I.apply(F=J.call(v.childNodes),v.childNodes),F[v.childNodes.length].nodeType}catch(eb){I={apply:F.length?function(a,b){H.apply(a,J.call(b))}:function(a,b){var c=a.length,d=0;while(a[c++]=b[d++]);a.length=c-1}}}function fb(a,b,d,e){var f,h,j,k,l,o,r,s,w,x;if((b?b.ownerDocument||b:v)!==n&&m(b),b=b||n,d=d||[],!a||"string"!=typeof a)return d;if(1!==(k=b.nodeType)&&9!==k)return[];if(p&&!e){if(f=_.exec(a))if(j=f[1]){if(9===k){if(h=b.getElementById(j),!h||!h.parentNode)return d;if(h.id===j)return d.push(h),d}else if(b.ownerDocument&&(h=b.ownerDocument.getElementById(j))&&t(b,h)&&h.id===j)return d.push(h),d}else{if(f[2])return I.apply(d,b.getElementsByTagName(a)),d;if((j=f[3])&&c.getElementsByClassName&&b.getElementsByClassName)return I.apply(d,b.getElementsByClassName(j)),d}if(c.qsa&&(!q||!q.test(a))){if(s=r=u,w=b,x=9===k&&a,1===k&&"object"!==b.nodeName.toLowerCase()){o=g(a),(r=b.getAttribute("id"))?s=r.replace(bb,"\\$&"):b.setAttribute("id",s),s="[id='"+s+"'] ",l=o.length;while(l--)o[l]=s+qb(o[l]);w=ab.test(a)&&ob(b.parentNode)||b,x=o.join(",")}if(x)try{return I.apply(d,w.querySelectorAll(x)),d}catch(y){}finally{r||b.removeAttribute("id")}}}return i(a.replace(R,"$1"),b,d,e)}function gb(){var a=[];function b(c,e){return a.push(c+" ")>d.cacheLength&&delete b[a.shift()],b[c+" "]=e}return b}function hb(a){return a[u]=!0,a}function ib(a){var b=n.createElement("div");try{return!!a(b)}catch(c){return!1}finally{b.parentNode&&b.parentNode.removeChild(b),b=null}}function jb(a,b){var c=a.split("|"),e=a.length;while(e--)d.attrHandle[c[e]]=b}function kb(a,b){var c=b&&a,d=c&&1===a.nodeType&&1===b.nodeType&&(~b.sourceIndex||D)-(~a.sourceIndex||D);if(d)return d;if(c)while(c=c.nextSibling)if(c===b)return-1;return a?1:-1}function lb(a){return function(b){var c=b.nodeName.toLowerCase();return"input"===c&&b.type===a}}function mb(a){return function(b){var c=b.nodeName.toLowerCase();return("input"===c||"button"===c)&&b.type===a}}function nb(a){return hb(function(b){return b=+b,hb(function(c,d){var e,f=a([],c.length,b),g=f.length;while(g--)c[e=f[g]]&&(c[e]=!(d[e]=c[e]))})})}function ob(a){return a&&typeof a.getElementsByTagName!==C&&a}c=fb.support={},f=fb.isXML=function(a){var b=a&&(a.ownerDocument||a).documentElement;return b?"HTML"!==b.nodeName:!1},m=fb.setDocument=function(a){var b,e=a?a.ownerDocument||a:v,g=e.defaultView;return e!==n&&9===e.nodeType&&e.documentElement?(n=e,o=e.documentElement,p=!f(e),g&&g!==g.top&&(g.addEventListener?g.addEventListener("unload",function(){m()},!1):g.attachEvent&&g.attachEvent("onunload",function(){m()})),c.attributes=ib(function(a){return a.className="i",!a.getAttribute("className")}),c.getElementsByTagName=ib(function(a){return a.appendChild(e.createComment("")),!a.getElementsByTagName("*").length}),c.getElementsByClassName=$.test(e.getElementsByClassName)&&ib(function(a){return a.innerHTML="<div class='a'></div><div class='a i'></div>",a.firstChild.className="i",2===a.getElementsByClassName("i").length}),c.getById=ib(function(a){return o.appendChild(a).id=u,!e.getElementsByName||!e.getElementsByName(u).length}),c.getById?(d.find.ID=function(a,b){if(typeof b.getElementById!==C&&p){var c=b.getElementById(a);return c&&c.parentNode?[c]:[]}},d.filter.ID=function(a){var b=a.replace(cb,db);return function(a){return a.getAttribute("id")===b}}):(delete d.find.ID,d.filter.ID=function(a){var b=a.replace(cb,db);return function(a){var c=typeof a.getAttributeNode!==C&&a.getAttributeNode("id");return c&&c.value===b}}),d.find.TAG=c.getElementsByTagName?function(a,b){return typeof b.getElementsByTagName!==C?b.getElementsByTagName(a):void 0}:function(a,b){var c,d=[],e=0,f=b.getElementsByTagName(a);if("*"===a){while(c=f[e++])1===c.nodeType&&d.push(c);return d}return f},d.find.CLASS=c.getElementsByClassName&&function(a,b){return typeof b.getElementsByClassName!==C&&p?b.getElementsByClassName(a):void 0},r=[],q=[],(c.qsa=$.test(e.querySelectorAll))&&(ib(function(a){a.innerHTML="<select msallowclip=''><option selected=''></option></select>",a.querySelectorAll("[msallowclip^='']").length&&q.push("[*^$]="+M+"*(?:''|\"\")"),a.querySelectorAll("[selected]").length||q.push("\\["+M+"*(?:value|"+L+")"),a.querySelectorAll(":checked").length||q.push(":checked")}),ib(function(a){var b=e.createElement("input");b.setAttribute("type","hidden"),a.appendChild(b).setAttribute("name","D"),a.querySelectorAll("[name=d]").length&&q.push("name"+M+"*[*^$|!~]?="),a.querySelectorAll(":enabled").length||q.push(":enabled",":disabled"),a.querySelectorAll("*,:x"),q.push(",.*:")})),(c.matchesSelector=$.test(s=o.matches||o.webkitMatchesSelector||o.mozMatchesSelector||o.oMatchesSelector||o.msMatchesSelector))&&ib(function(a){c.disconnectedMatch=s.call(a,"div"),s.call(a,"[s!='']:x"),r.push("!=",Q)}),q=q.length&&new RegExp(q.join("|")),r=r.length&&new RegExp(r.join("|")),b=$.test(o.compareDocumentPosition),t=b||$.test(o.contains)?function(a,b){var c=9===a.nodeType?a.documentElement:a,d=b&&b.parentNode;return a===d||!(!d||1!==d.nodeType||!(c.contains?c.contains(d):a.compareDocumentPosition&&16&a.compareDocumentPosition(d)))}:function(a,b){if(b)while(b=b.parentNode)if(b===a)return!0;return!1},B=b?function(a,b){if(a===b)return l=!0,0;var d=!a.compareDocumentPosition-!b.compareDocumentPosition;return d?d:(d=(a.ownerDocument||a)===(b.ownerDocument||b)?a.compareDocumentPosition(b):1,1&d||!c.sortDetached&&b.compareDocumentPosition(a)===d?a===e||a.ownerDocument===v&&t(v,a)?-1:b===e||b.ownerDocument===v&&t(v,b)?1:k?K.call(k,a)-K.call(k,b):0:4&d?-1:1)}:function(a,b){if(a===b)return l=!0,0;var c,d=0,f=a.parentNode,g=b.parentNode,h=[a],i=[b];if(!f||!g)return a===e?-1:b===e?1:f?-1:g?1:k?K.call(k,a)-K.call(k,b):0;if(f===g)return kb(a,b);c=a;while(c=c.parentNode)h.unshift(c);c=b;while(c=c.parentNode)i.unshift(c);while(h[d]===i[d])d++;return d?kb(h[d],i[d]):h[d]===v?-1:i[d]===v?1:0},e):n},fb.matches=function(a,b){return fb(a,null,null,b)},fb.matchesSelector=function(a,b){if((a.ownerDocument||a)!==n&&m(a),b=b.replace(U,"='$1']"),!(!c.matchesSelector||!p||r&&r.test(b)||q&&q.test(b)))try{var d=s.call(a,b);if(d||c.disconnectedMatch||a.document&&11!==a.document.nodeType)return d}catch(e){}return fb(b,n,null,[a]).length>0},fb.contains=function(a,b){return(a.ownerDocument||a)!==n&&m(a),t(a,b)},fb.attr=function(a,b){(a.ownerDocument||a)!==n&&m(a);var e=d.attrHandle[b.toLowerCase()],f=e&&E.call(d.attrHandle,b.toLowerCase())?e(a,b,!p):void 0;return void 0!==f?f:c.attributes||!p?a.getAttribute(b):(f=a.getAttributeNode(b))&&f.specified?f.value:null},fb.error=function(a){throw new Error("Syntax error, unrecognized expression: "+a)},fb.uniqueSort=function(a){var b,d=[],e=0,f=0;if(l=!c.detectDuplicates,k=!c.sortStable&&a.slice(0),a.sort(B),l){while(b=a[f++])b===a[f]&&(e=d.push(f));while(e--)a.splice(d[e],1)}return k=null,a},e=fb.getText=function(a){var b,c="",d=0,f=a.nodeType;if(f){if(1===f||9===f||11===f){if("string"==typeof a.textContent)return a.textContent;for(a=a.firstChild;a;a=a.nextSibling)c+=e(a)}else if(3===f||4===f)return a.nodeValue}else while(b=a[d++])c+=e(b);return c},d=fb.selectors={cacheLength:50,createPseudo:hb,match:X,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(a){return a[1]=a[1].replace(cb,db),a[3]=(a[3]||a[4]||a[5]||"").replace(cb,db),"~="===a[2]&&(a[3]=" "+a[3]+" "),a.slice(0,4)},CHILD:function(a){return a[1]=a[1].toLowerCase(),"nth"===a[1].slice(0,3)?(a[3]||fb.error(a[0]),a[4]=+(a[4]?a[5]+(a[6]||1):2*("even"===a[3]||"odd"===a[3])),a[5]=+(a[7]+a[8]||"odd"===a[3])):a[3]&&fb.error(a[0]),a},PSEUDO:function(a){var b,c=!a[6]&&a[2];return X.CHILD.test(a[0])?null:(a[3]?a[2]=a[4]||a[5]||"":c&&V.test(c)&&(b=g(c,!0))&&(b=c.indexOf(")",c.length-b)-c.length)&&(a[0]=a[0].slice(0,b),a[2]=c.slice(0,b)),a.slice(0,3))}},filter:{TAG:function(a){var b=a.replace(cb,db).toLowerCase();return"*"===a?function(){return!0}:function(a){return a.nodeName&&a.nodeName.toLowerCase()===b}},CLASS:function(a){var b=y[a+" "];return b||(b=new RegExp("(^|"+M+")"+a+"("+M+"|$)"))&&y(a,function(a){return b.test("string"==typeof a.className&&a.className||typeof a.getAttribute!==C&&a.getAttribute("class")||"")})},ATTR:function(a,b,c){return function(d){var e=fb.attr(d,a);return null==e?"!="===b:b?(e+="","="===b?e===c:"!="===b?e!==c:"^="===b?c&&0===e.indexOf(c):"*="===b?c&&e.indexOf(c)>-1:"$="===b?c&&e.slice(-c.length)===c:"~="===b?(" "+e+" ").indexOf(c)>-1:"|="===b?e===c||e.slice(0,c.length+1)===c+"-":!1):!0}},CHILD:function(a,b,c,d,e){var f="nth"!==a.slice(0,3),g="last"!==a.slice(-4),h="of-type"===b;return 1===d&&0===e?function(a){return!!a.parentNode}:function(b,c,i){var j,k,l,m,n,o,p=f!==g?"nextSibling":"previousSibling",q=b.parentNode,r=h&&b.nodeName.toLowerCase(),s=!i&&!h;if(q){if(f){while(p){l=b;while(l=l[p])if(h?l.nodeName.toLowerCase()===r:1===l.nodeType)return!1;o=p="only"===a&&!o&&"nextSibling"}return!0}if(o=[g?q.firstChild:q.lastChild],g&&s){k=q[u]||(q[u]={}),j=k[a]||[],n=j[0]===w&&j[1],m=j[0]===w&&j[2],l=n&&q.childNodes[n];while(l=++n&&l&&l[p]||(m=n=0)||o.pop())if(1===l.nodeType&&++m&&l===b){k[a]=[w,n,m];break}}else if(s&&(j=(b[u]||(b[u]={}))[a])&&j[0]===w)m=j[1];else while(l=++n&&l&&l[p]||(m=n=0)||o.pop())if((h?l.nodeName.toLowerCase()===r:1===l.nodeType)&&++m&&(s&&((l[u]||(l[u]={}))[a]=[w,m]),l===b))break;return m-=e,m===d||m%d===0&&m/d>=0}}},PSEUDO:function(a,b){var c,e=d.pseudos[a]||d.setFilters[a.toLowerCase()]||fb.error("unsupported pseudo: "+a);return e[u]?e(b):e.length>1?(c=[a,a,"",b],d.setFilters.hasOwnProperty(a.toLowerCase())?hb(function(a,c){var d,f=e(a,b),g=f.length;while(g--)d=K.call(a,f[g]),a[d]=!(c[d]=f[g])}):function(a){return e(a,0,c)}):e}},pseudos:{not:hb(function(a){var b=[],c=[],d=h(a.replace(R,"$1"));return d[u]?hb(function(a,b,c,e){var f,g=d(a,null,e,[]),h=a.length;while(h--)(f=g[h])&&(a[h]=!(b[h]=f))}):function(a,e,f){return b[0]=a,d(b,null,f,c),!c.pop()}}),has:hb(function(a){return function(b){return fb(a,b).length>0}}),contains:hb(function(a){return function(b){return(b.textContent||b.innerText||e(b)).indexOf(a)>-1}}),lang:hb(function(a){return W.test(a||"")||fb.error("unsupported lang: "+a),a=a.replace(cb,db).toLowerCase(),function(b){var c;do if(c=p?b.lang:b.getAttribute("xml:lang")||b.getAttribute("lang"))return c=c.toLowerCase(),c===a||0===c.indexOf(a+"-");while((b=b.parentNode)&&1===b.nodeType);return!1}}),target:function(b){var c=a.location&&a.location.hash;return c&&c.slice(1)===b.id},root:function(a){return a===o},focus:function(a){return a===n.activeElement&&(!n.hasFocus||n.hasFocus())&&!!(a.type||a.href||~a.tabIndex)},enabled:function(a){return a.disabled===!1},disabled:function(a){return a.disabled===!0},checked:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&!!a.checked||"option"===b&&!!a.selected},selected:function(a){return a.parentNode&&a.parentNode.selectedIndex,a.selected===!0},empty:function(a){for(a=a.firstChild;a;a=a.nextSibling)if(a.nodeType<6)return!1;return!0},parent:function(a){return!d.pseudos.empty(a)},header:function(a){return Z.test(a.nodeName)},input:function(a){return Y.test(a.nodeName)},button:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&"button"===a.type||"button"===b},text:function(a){var b;return"input"===a.nodeName.toLowerCase()&&"text"===a.type&&(null==(b=a.getAttribute("type"))||"text"===b.toLowerCase())},first:nb(function(){return[0]}),last:nb(function(a,b){return[b-1]}),eq:nb(function(a,b,c){return[0>c?c+b:c]}),even:nb(function(a,b){for(var c=0;b>c;c+=2)a.push(c);return a}),odd:nb(function(a,b){for(var c=1;b>c;c+=2)a.push(c);return a}),lt:nb(function(a,b,c){for(var d=0>c?c+b:c;--d>=0;)a.push(d);return a}),gt:nb(function(a,b,c){for(var d=0>c?c+b:c;++d<b;)a.push(d);return a})}},d.pseudos.nth=d.pseudos.eq;for(b in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})d.pseudos[b]=lb(b);for(b in{submit:!0,reset:!0})d.pseudos[b]=mb(b);function pb(){}pb.prototype=d.filters=d.pseudos,d.setFilters=new pb,g=fb.tokenize=function(a,b){var c,e,f,g,h,i,j,k=z[a+" "];if(k)return b?0:k.slice(0);h=a,i=[],j=d.preFilter;while(h){(!c||(e=S.exec(h)))&&(e&&(h=h.slice(e[0].length)||h),i.push(f=[])),c=!1,(e=T.exec(h))&&(c=e.shift(),f.push({value:c,type:e[0].replace(R," ")}),h=h.slice(c.length));for(g in d.filter)!(e=X[g].exec(h))||j[g]&&!(e=j[g](e))||(c=e.shift(),f.push({value:c,type:g,matches:e}),h=h.slice(c.length));if(!c)break}return b?h.length:h?fb.error(a):z(a,i).slice(0)};function qb(a){for(var b=0,c=a.length,d="";c>b;b++)d+=a[b].value;return d}function rb(a,b,c){var d=b.dir,e=c&&"parentNode"===d,f=x++;return b.first?function(b,c,f){while(b=b[d])if(1===b.nodeType||e)return a(b,c,f)}:function(b,c,g){var h,i,j=[w,f];if(g){while(b=b[d])if((1===b.nodeType||e)&&a(b,c,g))return!0}else while(b=b[d])if(1===b.nodeType||e){if(i=b[u]||(b[u]={}),(h=i[d])&&h[0]===w&&h[1]===f)return j[2]=h[2];if(i[d]=j,j[2]=a(b,c,g))return!0}}}function sb(a){return a.length>1?function(b,c,d){var e=a.length;while(e--)if(!a[e](b,c,d))return!1;return!0}:a[0]}function tb(a,b,c){for(var d=0,e=b.length;e>d;d++)fb(a,b[d],c);return c}function ub(a,b,c,d,e){for(var f,g=[],h=0,i=a.length,j=null!=b;i>h;h++)(f=a[h])&&(!c||c(f,d,e))&&(g.push(f),j&&b.push(h));return g}function vb(a,b,c,d,e,f){return d&&!d[u]&&(d=vb(d)),e&&!e[u]&&(e=vb(e,f)),hb(function(f,g,h,i){var j,k,l,m=[],n=[],o=g.length,p=f||tb(b||"*",h.nodeType?[h]:h,[]),q=!a||!f&&b?p:ub(p,m,a,h,i),r=c?e||(f?a:o||d)?[]:g:q;if(c&&c(q,r,h,i),d){j=ub(r,n),d(j,[],h,i),k=j.length;while(k--)(l=j[k])&&(r[n[k]]=!(q[n[k]]=l))}if(f){if(e||a){if(e){j=[],k=r.length;while(k--)(l=r[k])&&j.push(q[k]=l);e(null,r=[],j,i)}k=r.length;while(k--)(l=r[k])&&(j=e?K.call(f,l):m[k])>-1&&(f[j]=!(g[j]=l))}}else r=ub(r===g?r.splice(o,r.length):r),e?e(null,g,r,i):I.apply(g,r)})}function wb(a){for(var b,c,e,f=a.length,g=d.relative[a[0].type],h=g||d.relative[" "],i=g?1:0,k=rb(function(a){return a===b},h,!0),l=rb(function(a){return K.call(b,a)>-1},h,!0),m=[function(a,c,d){return!g&&(d||c!==j)||((b=c).nodeType?k(a,c,d):l(a,c,d))}];f>i;i++)if(c=d.relative[a[i].type])m=[rb(sb(m),c)];else{if(c=d.filter[a[i].type].apply(null,a[i].matches),c[u]){for(e=++i;f>e;e++)if(d.relative[a[e].type])break;return vb(i>1&&sb(m),i>1&&qb(a.slice(0,i-1).concat({value:" "===a[i-2].type?"*":""})).replace(R,"$1"),c,e>i&&wb(a.slice(i,e)),f>e&&wb(a=a.slice(e)),f>e&&qb(a))}m.push(c)}return sb(m)}function xb(a,b){var c=b.length>0,e=a.length>0,f=function(f,g,h,i,k){var l,m,o,p=0,q="0",r=f&&[],s=[],t=j,u=f||e&&d.find.TAG("*",k),v=w+=null==t?1:Math.random()||.1,x=u.length;for(k&&(j=g!==n&&g);q!==x&&null!=(l=u[q]);q++){if(e&&l){m=0;while(o=a[m++])if(o(l,g,h)){i.push(l);break}k&&(w=v)}c&&((l=!o&&l)&&p--,f&&r.push(l))}if(p+=q,c&&q!==p){m=0;while(o=b[m++])o(r,s,g,h);if(f){if(p>0)while(q--)r[q]||s[q]||(s[q]=G.call(i));s=ub(s)}I.apply(i,s),k&&!f&&s.length>0&&p+b.length>1&&fb.uniqueSort(i)}return k&&(w=v,j=t),r};return c?hb(f):f}return h=fb.compile=function(a,b){var c,d=[],e=[],f=A[a+" "];if(!f){b||(b=g(a)),c=b.length;while(c--)f=wb(b[c]),f[u]?d.push(f):e.push(f);f=A(a,xb(e,d)),f.selector=a}return f},i=fb.select=function(a,b,e,f){var i,j,k,l,m,n="function"==typeof a&&a,o=!f&&g(a=n.selector||a);if(e=e||[],1===o.length){if(j=o[0]=o[0].slice(0),j.length>2&&"ID"===(k=j[0]).type&&c.getById&&9===b.nodeType&&p&&d.relative[j[1].type]){if(b=(d.find.ID(k.matches[0].replace(cb,db),b)||[])[0],!b)return e;n&&(b=b.parentNode),a=a.slice(j.shift().value.length)}i=X.needsContext.test(a)?0:j.length;while(i--){if(k=j[i],d.relative[l=k.type])break;if((m=d.find[l])&&(f=m(k.matches[0].replace(cb,db),ab.test(j[0].type)&&ob(b.parentNode)||b))){if(j.splice(i,1),a=f.length&&qb(j),!a)return I.apply(e,f),e;break}}}return(n||h(a,o))(f,b,!p,e,ab.test(a)&&ob(b.parentNode)||b),e},c.sortStable=u.split("").sort(B).join("")===u,c.detectDuplicates=!!l,m(),c.sortDetached=ib(function(a){return 1&a.compareDocumentPosition(n.createElement("div"))}),ib(function(a){return a.innerHTML="<a href='#'></a>","#"===a.firstChild.getAttribute("href")})||jb("type|href|height|width",function(a,b,c){return c?void 0:a.getAttribute(b,"type"===b.toLowerCase()?1:2)}),c.attributes&&ib(function(a){return a.innerHTML="<input/>",a.firstChild.setAttribute("value",""),""===a.firstChild.getAttribute("value")})||jb("value",function(a,b,c){return c||"input"!==a.nodeName.toLowerCase()?void 0:a.defaultValue}),ib(function(a){return null==a.getAttribute("disabled")})||jb(L,function(a,b,c){var d;return c?void 0:a[b]===!0?b.toLowerCase():(d=a.getAttributeNode(b))&&d.specified?d.value:null}),fb}(a);n.find=t,n.expr=t.selectors,n.expr[":"]=n.expr.pseudos,n.unique=t.uniqueSort,n.text=t.getText,n.isXMLDoc=t.isXML,n.contains=t.contains;var u=n.expr.match.needsContext,v=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,w=/^.[^:#\[\.,]*$/;function x(a,b,c){if(n.isFunction(b))return n.grep(a,function(a,d){return!!b.call(a,d,a)!==c});if(b.nodeType)return n.grep(a,function(a){return a===b!==c});if("string"==typeof b){if(w.test(b))return n.filter(b,a,c);b=n.filter(b,a)}return n.grep(a,function(a){return g.call(b,a)>=0!==c})}n.filter=function(a,b,c){var d=b[0];return c&&(a=":not("+a+")"),1===b.length&&1===d.nodeType?n.find.matchesSelector(d,a)?[d]:[]:n.find.matches(a,n.grep(b,function(a){return 1===a.nodeType}))},n.fn.extend({find:function(a){var b,c=this.length,d=[],e=this;if("string"!=typeof a)return this.pushStack(n(a).filter(function(){for(b=0;c>b;b++)if(n.contains(e[b],this))return!0}));for(b=0;c>b;b++)n.find(a,e[b],d);return d=this.pushStack(c>1?n.unique(d):d),d.selector=this.selector?this.selector+" "+a:a,d},filter:function(a){return this.pushStack(x(this,a||[],!1))},not:function(a){return this.pushStack(x(this,a||[],!0))},is:function(a){return!!x(this,"string"==typeof a&&u.test(a)?n(a):a||[],!1).length}});var y,z=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,A=n.fn.init=function(a,b){var c,d;if(!a)return this;if("string"==typeof a){if(c="<"===a[0]&&">"===a[a.length-1]&&a.length>=3?[null,a,null]:z.exec(a),!c||!c[1]&&b)return!b||b.jquery?(b||y).find(a):this.constructor(b).find(a);if(c[1]){if(b=b instanceof n?b[0]:b,n.merge(this,n.parseHTML(c[1],b&&b.nodeType?b.ownerDocument||b:l,!0)),v.test(c[1])&&n.isPlainObject(b))for(c in b)n.isFunction(this[c])?this[c](b[c]):this.attr(c,b[c]);return this}return d=l.getElementById(c[2]),d&&d.parentNode&&(this.length=1,this[0]=d),this.context=l,this.selector=a,this}return a.nodeType?(this.context=this[0]=a,this.length=1,this):n.isFunction(a)?"undefined"!=typeof y.ready?y.ready(a):a(n):(void 0!==a.selector&&(this.selector=a.selector,this.context=a.context),n.makeArray(a,this))};A.prototype=n.fn,y=n(l);var B=/^(?:parents|prev(?:Until|All))/,C={children:!0,contents:!0,next:!0,prev:!0};n.extend({dir:function(a,b,c){var d=[],e=void 0!==c;while((a=a[b])&&9!==a.nodeType)if(1===a.nodeType){if(e&&n(a).is(c))break;d.push(a)}return d},sibling:function(a,b){for(var c=[];a;a=a.nextSibling)1===a.nodeType&&a!==b&&c.push(a);return c}}),n.fn.extend({has:function(a){var b=n(a,this),c=b.length;return this.filter(function(){for(var a=0;c>a;a++)if(n.contains(this,b[a]))return!0})},closest:function(a,b){for(var c,d=0,e=this.length,f=[],g=u.test(a)||"string"!=typeof a?n(a,b||this.context):0;e>d;d++)for(c=this[d];c&&c!==b;c=c.parentNode)if(c.nodeType<11&&(g?g.index(c)>-1:1===c.nodeType&&n.find.matchesSelector(c,a))){f.push(c);break}return this.pushStack(f.length>1?n.unique(f):f)},index:function(a){return a?"string"==typeof a?g.call(n(a),this[0]):g.call(this,a.jquery?a[0]:a):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(a,b){return this.pushStack(n.unique(n.merge(this.get(),n(a,b))))},addBack:function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}});function D(a,b){while((a=a[b])&&1!==a.nodeType);return a}n.each({parent:function(a){var b=a.parentNode;return b&&11!==b.nodeType?b:null},parents:function(a){return n.dir(a,"parentNode")},parentsUntil:function(a,b,c){return n.dir(a,"parentNode",c)},next:function(a){return D(a,"nextSibling")},prev:function(a){return D(a,"previousSibling")},nextAll:function(a){return n.dir(a,"nextSibling")},prevAll:function(a){return n.dir(a,"previousSibling")},nextUntil:function(a,b,c){return n.dir(a,"nextSibling",c)},prevUntil:function(a,b,c){return n.dir(a,"previousSibling",c)},siblings:function(a){return n.sibling((a.parentNode||{}).firstChild,a)},children:function(a){return n.sibling(a.firstChild)},contents:function(a){return a.contentDocument||n.merge([],a.childNodes)}},function(a,b){n.fn[a]=function(c,d){var e=n.map(this,b,c);return"Until"!==a.slice(-5)&&(d=c),d&&"string"==typeof d&&(e=n.filter(d,e)),this.length>1&&(C[a]||n.unique(e),B.test(a)&&e.reverse()),this.pushStack(e)}});var E=/\S+/g,F={};function G(a){var b=F[a]={};return n.each(a.match(E)||[],function(a,c){b[c]=!0}),b}n.Callbacks=function(a){a="string"==typeof a?F[a]||G(a):n.extend({},a);var b,c,d,e,f,g,h=[],i=!a.once&&[],j=function(l){for(b=a.memory&&l,c=!0,g=e||0,e=0,f=h.length,d=!0;h&&f>g;g++)if(h[g].apply(l[0],l[1])===!1&&a.stopOnFalse){b=!1;break}d=!1,h&&(i?i.length&&j(i.shift()):b?h=[]:k.disable())},k={add:function(){if(h){var c=h.length;!function g(b){n.each(b,function(b,c){var d=n.type(c);"function"===d?a.unique&&k.has(c)||h.push(c):c&&c.length&&"string"!==d&&g(c)})}(arguments),d?f=h.length:b&&(e=c,j(b))}return this},remove:function(){return h&&n.each(arguments,function(a,b){var c;while((c=n.inArray(b,h,c))>-1)h.splice(c,1),d&&(f>=c&&f--,g>=c&&g--)}),this},has:function(a){return a?n.inArray(a,h)>-1:!(!h||!h.length)},empty:function(){return h=[],f=0,this},disable:function(){return h=i=b=void 0,this},disabled:function(){return!h},lock:function(){return i=void 0,b||k.disable(),this},locked:function(){return!i},fireWith:function(a,b){return!h||c&&!i||(b=b||[],b=[a,b.slice?b.slice():b],d?i.push(b):j(b)),this},fire:function(){return k.fireWith(this,arguments),this},fired:function(){return!!c}};return k},n.extend({Deferred:function(a){var b=[["resolve","done",n.Callbacks("once memory"),"resolved"],["reject","fail",n.Callbacks("once memory"),"rejected"],["notify","progress",n.Callbacks("memory")]],c="pending",d={state:function(){return c},always:function(){return e.done(arguments).fail(arguments),this},then:function(){var a=arguments;return n.Deferred(function(c){n.each(b,function(b,f){var g=n.isFunction(a[b])&&a[b];e[f[1]](function(){var a=g&&g.apply(this,arguments);a&&n.isFunction(a.promise)?a.promise().done(c.resolve).fail(c.reject).progress(c.notify):c[f[0]+"With"](this===d?c.promise():this,g?[a]:arguments)})}),a=null}).promise()},promise:function(a){return null!=a?n.extend(a,d):d}},e={};return d.pipe=d.then,n.each(b,function(a,f){var g=f[2],h=f[3];d[f[1]]=g.add,h&&g.add(function(){c=h},b[1^a][2].disable,b[2][2].lock),e[f[0]]=function(){return e[f[0]+"With"](this===e?d:this,arguments),this},e[f[0]+"With"]=g.fireWith}),d.promise(e),a&&a.call(e,e),e},when:function(a){var b=0,c=d.call(arguments),e=c.length,f=1!==e||a&&n.isFunction(a.promise)?e:0,g=1===f?a:n.Deferred(),h=function(a,b,c){return function(e){b[a]=this,c[a]=arguments.length>1?d.call(arguments):e,c===i?g.notifyWith(b,c):--f||g.resolveWith(b,c)}},i,j,k;if(e>1)for(i=new Array(e),j=new Array(e),k=new Array(e);e>b;b++)c[b]&&n.isFunction(c[b].promise)?c[b].promise().done(h(b,k,c)).fail(g.reject).progress(h(b,j,i)):--f;return f||g.resolveWith(k,c),g.promise()}});var H;n.fn.ready=function(a){return n.ready.promise().done(a),this},n.extend({isReady:!1,readyWait:1,holdReady:function(a){a?n.readyWait++:n.ready(!0)},ready:function(a){(a===!0?--n.readyWait:n.isReady)||(n.isReady=!0,a!==!0&&--n.readyWait>0||(H.resolveWith(l,[n]),n.fn.triggerHandler&&(n(l).triggerHandler("ready"),n(l).off("ready"))))}});function I(){l.removeEventListener("DOMContentLoaded",I,!1),a.removeEventListener("load",I,!1),n.ready()}n.ready.promise=function(b){return H||(H=n.Deferred(),"complete"===l.readyState?setTimeout(n.ready):(l.addEventListener("DOMContentLoaded",I,!1),a.addEventListener("load",I,!1))),H.promise(b)},n.ready.promise();var J=n.access=function(a,b,c,d,e,f,g){var h=0,i=a.length,j=null==c;if("object"===n.type(c)){e=!0;for(h in c)n.access(a,b,h,c[h],!0,f,g)}else if(void 0!==d&&(e=!0,n.isFunction(d)||(g=!0),j&&(g?(b.call(a,d),b=null):(j=b,b=function(a,b,c){return j.call(n(a),c)})),b))for(;i>h;h++)b(a[h],c,g?d:d.call(a[h],h,b(a[h],c)));return e?a:j?b.call(a):i?b(a[0],c):f};n.acceptData=function(a){return 1===a.nodeType||9===a.nodeType||!+a.nodeType};function K(){Object.defineProperty(this.cache={},0,{get:function(){return{}}}),this.expando=n.expando+Math.random()}K.uid=1,K.accepts=n.acceptData,K.prototype={key:function(a){if(!K.accepts(a))return 0;var b={},c=a[this.expando];if(!c){c=K.uid++;try{b[this.expando]={value:c},Object.defineProperties(a,b)}catch(d){b[this.expando]=c,n.extend(a,b)}}return this.cache[c]||(this.cache[c]={}),c},set:function(a,b,c){var d,e=this.key(a),f=this.cache[e];if("string"==typeof b)f[b]=c;else if(n.isEmptyObject(f))n.extend(this.cache[e],b);else for(d in b)f[d]=b[d];return f},get:function(a,b){var c=this.cache[this.key(a)];return void 0===b?c:c[b]},access:function(a,b,c){var d;return void 0===b||b&&"string"==typeof b&&void 0===c?(d=this.get(a,b),void 0!==d?d:this.get(a,n.camelCase(b))):(this.set(a,b,c),void 0!==c?c:b)},remove:function(a,b){var c,d,e,f=this.key(a),g=this.cache[f];if(void 0===b)this.cache[f]={};else{n.isArray(b)?d=b.concat(b.map(n.camelCase)):(e=n.camelCase(b),b in g?d=[b,e]:(d=e,d=d in g?[d]:d.match(E)||[])),c=d.length;while(c--)delete g[d[c]]}},hasData:function(a){return!n.isEmptyObject(this.cache[a[this.expando]]||{})},discard:function(a){a[this.expando]&&delete this.cache[a[this.expando]]}};var L=new K,M=new K,N=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,O=/([A-Z])/g;function P(a,b,c){var d;if(void 0===c&&1===a.nodeType)if(d="data-"+b.replace(O,"-$1").toLowerCase(),c=a.getAttribute(d),"string"==typeof c){try{c="true"===c?!0:"false"===c?!1:"null"===c?null:+c+""===c?+c:N.test(c)?n.parseJSON(c):c}catch(e){}M.set(a,b,c)}else c=void 0;return c}n.extend({hasData:function(a){return M.hasData(a)||L.hasData(a)},data:function(a,b,c){return M.access(a,b,c)},removeData:function(a,b){M.remove(a,b)
},_data:function(a,b,c){return L.access(a,b,c)},_removeData:function(a,b){L.remove(a,b)}}),n.fn.extend({data:function(a,b){var c,d,e,f=this[0],g=f&&f.attributes;if(void 0===a){if(this.length&&(e=M.get(f),1===f.nodeType&&!L.get(f,"hasDataAttrs"))){c=g.length;while(c--)g[c]&&(d=g[c].name,0===d.indexOf("data-")&&(d=n.camelCase(d.slice(5)),P(f,d,e[d])));L.set(f,"hasDataAttrs",!0)}return e}return"object"==typeof a?this.each(function(){M.set(this,a)}):J(this,function(b){var c,d=n.camelCase(a);if(f&&void 0===b){if(c=M.get(f,a),void 0!==c)return c;if(c=M.get(f,d),void 0!==c)return c;if(c=P(f,d,void 0),void 0!==c)return c}else this.each(function(){var c=M.get(this,d);M.set(this,d,b),-1!==a.indexOf("-")&&void 0!==c&&M.set(this,a,b)})},null,b,arguments.length>1,null,!0)},removeData:function(a){return this.each(function(){M.remove(this,a)})}}),n.extend({queue:function(a,b,c){var d;return a?(b=(b||"fx")+"queue",d=L.get(a,b),c&&(!d||n.isArray(c)?d=L.access(a,b,n.makeArray(c)):d.push(c)),d||[]):void 0},dequeue:function(a,b){b=b||"fx";var c=n.queue(a,b),d=c.length,e=c.shift(),f=n._queueHooks(a,b),g=function(){n.dequeue(a,b)};"inprogress"===e&&(e=c.shift(),d--),e&&("fx"===b&&c.unshift("inprogress"),delete f.stop,e.call(a,g,f)),!d&&f&&f.empty.fire()},_queueHooks:function(a,b){var c=b+"queueHooks";return L.get(a,c)||L.access(a,c,{empty:n.Callbacks("once memory").add(function(){L.remove(a,[b+"queue",c])})})}}),n.fn.extend({queue:function(a,b){var c=2;return"string"!=typeof a&&(b=a,a="fx",c--),arguments.length<c?n.queue(this[0],a):void 0===b?this:this.each(function(){var c=n.queue(this,a,b);n._queueHooks(this,a),"fx"===a&&"inprogress"!==c[0]&&n.dequeue(this,a)})},dequeue:function(a){return this.each(function(){n.dequeue(this,a)})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,b){var c,d=1,e=n.Deferred(),f=this,g=this.length,h=function(){--d||e.resolveWith(f,[f])};"string"!=typeof a&&(b=a,a=void 0),a=a||"fx";while(g--)c=L.get(f[g],a+"queueHooks"),c&&c.empty&&(d++,c.empty.add(h));return h(),e.promise(b)}});var Q=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,R=["Top","Right","Bottom","Left"],S=function(a,b){return a=b||a,"none"===n.css(a,"display")||!n.contains(a.ownerDocument,a)},T=/^(?:checkbox|radio)$/i;!function(){var a=l.createDocumentFragment(),b=a.appendChild(l.createElement("div")),c=l.createElement("input");c.setAttribute("type","radio"),c.setAttribute("checked","checked"),c.setAttribute("name","t"),b.appendChild(c),k.checkClone=b.cloneNode(!0).cloneNode(!0).lastChild.checked,b.innerHTML="<textarea>x</textarea>",k.noCloneChecked=!!b.cloneNode(!0).lastChild.defaultValue}();var U="undefined";k.focusinBubbles="onfocusin"in a;var V=/^key/,W=/^(?:mouse|pointer|contextmenu)|click/,X=/^(?:focusinfocus|focusoutblur)$/,Y=/^([^.]*)(?:\.(.+)|)$/;function Z(){return!0}function $(){return!1}function _(){try{return l.activeElement}catch(a){}}n.event={global:{},add:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,o,p,q,r=L.get(a);if(r){c.handler&&(f=c,c=f.handler,e=f.selector),c.guid||(c.guid=n.guid++),(i=r.events)||(i=r.events={}),(g=r.handle)||(g=r.handle=function(b){return typeof n!==U&&n.event.triggered!==b.type?n.event.dispatch.apply(a,arguments):void 0}),b=(b||"").match(E)||[""],j=b.length;while(j--)h=Y.exec(b[j])||[],o=q=h[1],p=(h[2]||"").split(".").sort(),o&&(l=n.event.special[o]||{},o=(e?l.delegateType:l.bindType)||o,l=n.event.special[o]||{},k=n.extend({type:o,origType:q,data:d,handler:c,guid:c.guid,selector:e,needsContext:e&&n.expr.match.needsContext.test(e),namespace:p.join(".")},f),(m=i[o])||(m=i[o]=[],m.delegateCount=0,l.setup&&l.setup.call(a,d,p,g)!==!1||a.addEventListener&&a.addEventListener(o,g,!1)),l.add&&(l.add.call(a,k),k.handler.guid||(k.handler.guid=c.guid)),e?m.splice(m.delegateCount++,0,k):m.push(k),n.event.global[o]=!0)}},remove:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,o,p,q,r=L.hasData(a)&&L.get(a);if(r&&(i=r.events)){b=(b||"").match(E)||[""],j=b.length;while(j--)if(h=Y.exec(b[j])||[],o=q=h[1],p=(h[2]||"").split(".").sort(),o){l=n.event.special[o]||{},o=(d?l.delegateType:l.bindType)||o,m=i[o]||[],h=h[2]&&new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"),g=f=m.length;while(f--)k=m[f],!e&&q!==k.origType||c&&c.guid!==k.guid||h&&!h.test(k.namespace)||d&&d!==k.selector&&("**"!==d||!k.selector)||(m.splice(f,1),k.selector&&m.delegateCount--,l.remove&&l.remove.call(a,k));g&&!m.length&&(l.teardown&&l.teardown.call(a,p,r.handle)!==!1||n.removeEvent(a,o,r.handle),delete i[o])}else for(o in i)n.event.remove(a,o+b[j],c,d,!0);n.isEmptyObject(i)&&(delete r.handle,L.remove(a,"events"))}},trigger:function(b,c,d,e){var f,g,h,i,k,m,o,p=[d||l],q=j.call(b,"type")?b.type:b,r=j.call(b,"namespace")?b.namespace.split("."):[];if(g=h=d=d||l,3!==d.nodeType&&8!==d.nodeType&&!X.test(q+n.event.triggered)&&(q.indexOf(".")>=0&&(r=q.split("."),q=r.shift(),r.sort()),k=q.indexOf(":")<0&&"on"+q,b=b[n.expando]?b:new n.Event(q,"object"==typeof b&&b),b.isTrigger=e?2:3,b.namespace=r.join("."),b.namespace_re=b.namespace?new RegExp("(^|\\.)"+r.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,b.result=void 0,b.target||(b.target=d),c=null==c?[b]:n.makeArray(c,[b]),o=n.event.special[q]||{},e||!o.trigger||o.trigger.apply(d,c)!==!1)){if(!e&&!o.noBubble&&!n.isWindow(d)){for(i=o.delegateType||q,X.test(i+q)||(g=g.parentNode);g;g=g.parentNode)p.push(g),h=g;h===(d.ownerDocument||l)&&p.push(h.defaultView||h.parentWindow||a)}f=0;while((g=p[f++])&&!b.isPropagationStopped())b.type=f>1?i:o.bindType||q,m=(L.get(g,"events")||{})[b.type]&&L.get(g,"handle"),m&&m.apply(g,c),m=k&&g[k],m&&m.apply&&n.acceptData(g)&&(b.result=m.apply(g,c),b.result===!1&&b.preventDefault());return b.type=q,e||b.isDefaultPrevented()||o._default&&o._default.apply(p.pop(),c)!==!1||!n.acceptData(d)||k&&n.isFunction(d[q])&&!n.isWindow(d)&&(h=d[k],h&&(d[k]=null),n.event.triggered=q,d[q](),n.event.triggered=void 0,h&&(d[k]=h)),b.result}},dispatch:function(a){a=n.event.fix(a);var b,c,e,f,g,h=[],i=d.call(arguments),j=(L.get(this,"events")||{})[a.type]||[],k=n.event.special[a.type]||{};if(i[0]=a,a.delegateTarget=this,!k.preDispatch||k.preDispatch.call(this,a)!==!1){h=n.event.handlers.call(this,a,j),b=0;while((f=h[b++])&&!a.isPropagationStopped()){a.currentTarget=f.elem,c=0;while((g=f.handlers[c++])&&!a.isImmediatePropagationStopped())(!a.namespace_re||a.namespace_re.test(g.namespace))&&(a.handleObj=g,a.data=g.data,e=((n.event.special[g.origType]||{}).handle||g.handler).apply(f.elem,i),void 0!==e&&(a.result=e)===!1&&(a.preventDefault(),a.stopPropagation()))}return k.postDispatch&&k.postDispatch.call(this,a),a.result}},handlers:function(a,b){var c,d,e,f,g=[],h=b.delegateCount,i=a.target;if(h&&i.nodeType&&(!a.button||"click"!==a.type))for(;i!==this;i=i.parentNode||this)if(i.disabled!==!0||"click"!==a.type){for(d=[],c=0;h>c;c++)f=b[c],e=f.selector+" ",void 0===d[e]&&(d[e]=f.needsContext?n(e,this).index(i)>=0:n.find(e,this,null,[i]).length),d[e]&&d.push(f);d.length&&g.push({elem:i,handlers:d})}return h<b.length&&g.push({elem:this,handlers:b.slice(h)}),g},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(a,b){return null==a.which&&(a.which=null!=b.charCode?b.charCode:b.keyCode),a}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(a,b){var c,d,e,f=b.button;return null==a.pageX&&null!=b.clientX&&(c=a.target.ownerDocument||l,d=c.documentElement,e=c.body,a.pageX=b.clientX+(d&&d.scrollLeft||e&&e.scrollLeft||0)-(d&&d.clientLeft||e&&e.clientLeft||0),a.pageY=b.clientY+(d&&d.scrollTop||e&&e.scrollTop||0)-(d&&d.clientTop||e&&e.clientTop||0)),a.which||void 0===f||(a.which=1&f?1:2&f?3:4&f?2:0),a}},fix:function(a){if(a[n.expando])return a;var b,c,d,e=a.type,f=a,g=this.fixHooks[e];g||(this.fixHooks[e]=g=W.test(e)?this.mouseHooks:V.test(e)?this.keyHooks:{}),d=g.props?this.props.concat(g.props):this.props,a=new n.Event(f),b=d.length;while(b--)c=d[b],a[c]=f[c];return a.target||(a.target=l),3===a.target.nodeType&&(a.target=a.target.parentNode),g.filter?g.filter(a,f):a},special:{load:{noBubble:!0},focus:{trigger:function(){return this!==_()&&this.focus?(this.focus(),!1):void 0},delegateType:"focusin"},blur:{trigger:function(){return this===_()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return"checkbox"===this.type&&this.click&&n.nodeName(this,"input")?(this.click(),!1):void 0},_default:function(a){return n.nodeName(a.target,"a")}},beforeunload:{postDispatch:function(a){void 0!==a.result&&a.originalEvent&&(a.originalEvent.returnValue=a.result)}}},simulate:function(a,b,c,d){var e=n.extend(new n.Event,c,{type:a,isSimulated:!0,originalEvent:{}});d?n.event.trigger(e,null,b):n.event.dispatch.call(b,e),e.isDefaultPrevented()&&c.preventDefault()}},n.removeEvent=function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c,!1)},n.Event=function(a,b){return this instanceof n.Event?(a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||void 0===a.defaultPrevented&&a.returnValue===!1?Z:$):this.type=a,b&&n.extend(this,b),this.timeStamp=a&&a.timeStamp||n.now(),void(this[n.expando]=!0)):new n.Event(a,b)},n.Event.prototype={isDefaultPrevented:$,isPropagationStopped:$,isImmediatePropagationStopped:$,preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=Z,a&&a.preventDefault&&a.preventDefault()},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=Z,a&&a.stopPropagation&&a.stopPropagation()},stopImmediatePropagation:function(){var a=this.originalEvent;this.isImmediatePropagationStopped=Z,a&&a.stopImmediatePropagation&&a.stopImmediatePropagation(),this.stopPropagation()}},n.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(a,b){n.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c,d=this,e=a.relatedTarget,f=a.handleObj;return(!e||e!==d&&!n.contains(d,e))&&(a.type=f.origType,c=f.handler.apply(this,arguments),a.type=b),c}}}),k.focusinBubbles||n.each({focus:"focusin",blur:"focusout"},function(a,b){var c=function(a){n.event.simulate(b,a.target,n.event.fix(a),!0)};n.event.special[b]={setup:function(){var d=this.ownerDocument||this,e=L.access(d,b);e||d.addEventListener(a,c,!0),L.access(d,b,(e||0)+1)},teardown:function(){var d=this.ownerDocument||this,e=L.access(d,b)-1;e?L.access(d,b,e):(d.removeEventListener(a,c,!0),L.remove(d,b))}}}),n.fn.extend({on:function(a,b,c,d,e){var f,g;if("object"==typeof a){"string"!=typeof b&&(c=c||b,b=void 0);for(g in a)this.on(g,b,c,a[g],e);return this}if(null==c&&null==d?(d=b,c=b=void 0):null==d&&("string"==typeof b?(d=c,c=void 0):(d=c,c=b,b=void 0)),d===!1)d=$;else if(!d)return this;return 1===e&&(f=d,d=function(a){return n().off(a),f.apply(this,arguments)},d.guid=f.guid||(f.guid=n.guid++)),this.each(function(){n.event.add(this,a,d,c,b)})},one:function(a,b,c,d){return this.on(a,b,c,d,1)},off:function(a,b,c){var d,e;if(a&&a.preventDefault&&a.handleObj)return d=a.handleObj,n(a.delegateTarget).off(d.namespace?d.origType+"."+d.namespace:d.origType,d.selector,d.handler),this;if("object"==typeof a){for(e in a)this.off(e,b,a[e]);return this}return(b===!1||"function"==typeof b)&&(c=b,b=void 0),c===!1&&(c=$),this.each(function(){n.event.remove(this,a,c,b)})},trigger:function(a,b){return this.each(function(){n.event.trigger(a,b,this)})},triggerHandler:function(a,b){var c=this[0];return c?n.event.trigger(a,b,c,!0):void 0}});var ab=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,bb=/<([\w:]+)/,cb=/<|&#?\w+;/,db=/<(?:script|style|link)/i,eb=/checked\s*(?:[^=]|=\s*.checked.)/i,fb=/^$|\/(?:java|ecma)script/i,gb=/^true\/(.*)/,hb=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,ib={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};ib.optgroup=ib.option,ib.tbody=ib.tfoot=ib.colgroup=ib.caption=ib.thead,ib.th=ib.td;function jb(a,b){return n.nodeName(a,"table")&&n.nodeName(11!==b.nodeType?b:b.firstChild,"tr")?a.getElementsByTagName("tbody")[0]||a.appendChild(a.ownerDocument.createElement("tbody")):a}function kb(a){return a.type=(null!==a.getAttribute("type"))+"/"+a.type,a}function lb(a){var b=gb.exec(a.type);return b?a.type=b[1]:a.removeAttribute("type"),a}function mb(a,b){for(var c=0,d=a.length;d>c;c++)L.set(a[c],"globalEval",!b||L.get(b[c],"globalEval"))}function nb(a,b){var c,d,e,f,g,h,i,j;if(1===b.nodeType){if(L.hasData(a)&&(f=L.access(a),g=L.set(b,f),j=f.events)){delete g.handle,g.events={};for(e in j)for(c=0,d=j[e].length;d>c;c++)n.event.add(b,e,j[e][c])}M.hasData(a)&&(h=M.access(a),i=n.extend({},h),M.set(b,i))}}function ob(a,b){var c=a.getElementsByTagName?a.getElementsByTagName(b||"*"):a.querySelectorAll?a.querySelectorAll(b||"*"):[];return void 0===b||b&&n.nodeName(a,b)?n.merge([a],c):c}function pb(a,b){var c=b.nodeName.toLowerCase();"input"===c&&T.test(a.type)?b.checked=a.checked:("input"===c||"textarea"===c)&&(b.defaultValue=a.defaultValue)}n.extend({clone:function(a,b,c){var d,e,f,g,h=a.cloneNode(!0),i=n.contains(a.ownerDocument,a);if(!(k.noCloneChecked||1!==a.nodeType&&11!==a.nodeType||n.isXMLDoc(a)))for(g=ob(h),f=ob(a),d=0,e=f.length;e>d;d++)pb(f[d],g[d]);if(b)if(c)for(f=f||ob(a),g=g||ob(h),d=0,e=f.length;e>d;d++)nb(f[d],g[d]);else nb(a,h);return g=ob(h,"script"),g.length>0&&mb(g,!i&&ob(a,"script")),h},buildFragment:function(a,b,c,d){for(var e,f,g,h,i,j,k=b.createDocumentFragment(),l=[],m=0,o=a.length;o>m;m++)if(e=a[m],e||0===e)if("object"===n.type(e))n.merge(l,e.nodeType?[e]:e);else if(cb.test(e)){f=f||k.appendChild(b.createElement("div")),g=(bb.exec(e)||["",""])[1].toLowerCase(),h=ib[g]||ib._default,f.innerHTML=h[1]+e.replace(ab,"<$1></$2>")+h[2],j=h[0];while(j--)f=f.lastChild;n.merge(l,f.childNodes),f=k.firstChild,f.textContent=""}else l.push(b.createTextNode(e));k.textContent="",m=0;while(e=l[m++])if((!d||-1===n.inArray(e,d))&&(i=n.contains(e.ownerDocument,e),f=ob(k.appendChild(e),"script"),i&&mb(f),c)){j=0;while(e=f[j++])fb.test(e.type||"")&&c.push(e)}return k},cleanData:function(a){for(var b,c,d,e,f=n.event.special,g=0;void 0!==(c=a[g]);g++){if(n.acceptData(c)&&(e=c[L.expando],e&&(b=L.cache[e]))){if(b.events)for(d in b.events)f[d]?n.event.remove(c,d):n.removeEvent(c,d,b.handle);L.cache[e]&&delete L.cache[e]}delete M.cache[c[M.expando]]}}}),n.fn.extend({text:function(a){return J(this,function(a){return void 0===a?n.text(this):this.empty().each(function(){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&(this.textContent=a)})},null,a,arguments.length)},append:function(){return this.domManip(arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=jb(this,a);b.appendChild(a)}})},prepend:function(){return this.domManip(arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=jb(this,a);b.insertBefore(a,b.firstChild)}})},before:function(){return this.domManip(arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this)})},after:function(){return this.domManip(arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this.nextSibling)})},remove:function(a,b){for(var c,d=a?n.filter(a,this):this,e=0;null!=(c=d[e]);e++)b||1!==c.nodeType||n.cleanData(ob(c)),c.parentNode&&(b&&n.contains(c.ownerDocument,c)&&mb(ob(c,"script")),c.parentNode.removeChild(c));return this},empty:function(){for(var a,b=0;null!=(a=this[b]);b++)1===a.nodeType&&(n.cleanData(ob(a,!1)),a.textContent="");return this},clone:function(a,b){return a=null==a?!1:a,b=null==b?a:b,this.map(function(){return n.clone(this,a,b)})},html:function(a){return J(this,function(a){var b=this[0]||{},c=0,d=this.length;if(void 0===a&&1===b.nodeType)return b.innerHTML;if("string"==typeof a&&!db.test(a)&&!ib[(bb.exec(a)||["",""])[1].toLowerCase()]){a=a.replace(ab,"<$1></$2>");try{for(;d>c;c++)b=this[c]||{},1===b.nodeType&&(n.cleanData(ob(b,!1)),b.innerHTML=a);b=0}catch(e){}}b&&this.empty().append(a)},null,a,arguments.length)},replaceWith:function(){var a=arguments[0];return this.domManip(arguments,function(b){a=this.parentNode,n.cleanData(ob(this)),a&&a.replaceChild(b,this)}),a&&(a.length||a.nodeType)?this:this.remove()},detach:function(a){return this.remove(a,!0)},domManip:function(a,b){a=e.apply([],a);var c,d,f,g,h,i,j=0,l=this.length,m=this,o=l-1,p=a[0],q=n.isFunction(p);if(q||l>1&&"string"==typeof p&&!k.checkClone&&eb.test(p))return this.each(function(c){var d=m.eq(c);q&&(a[0]=p.call(this,c,d.html())),d.domManip(a,b)});if(l&&(c=n.buildFragment(a,this[0].ownerDocument,!1,this),d=c.firstChild,1===c.childNodes.length&&(c=d),d)){for(f=n.map(ob(c,"script"),kb),g=f.length;l>j;j++)h=c,j!==o&&(h=n.clone(h,!0,!0),g&&n.merge(f,ob(h,"script"))),b.call(this[j],h,j);if(g)for(i=f[f.length-1].ownerDocument,n.map(f,lb),j=0;g>j;j++)h=f[j],fb.test(h.type||"")&&!L.access(h,"globalEval")&&n.contains(i,h)&&(h.src?n._evalUrl&&n._evalUrl(h.src):n.globalEval(h.textContent.replace(hb,"")))}return this}}),n.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){n.fn[a]=function(a){for(var c,d=[],e=n(a),g=e.length-1,h=0;g>=h;h++)c=h===g?this:this.clone(!0),n(e[h])[b](c),f.apply(d,c.get());return this.pushStack(d)}});var qb,rb={};function sb(b,c){var d,e=n(c.createElement(b)).appendTo(c.body),f=a.getDefaultComputedStyle&&(d=a.getDefaultComputedStyle(e[0]))?d.display:n.css(e[0],"display");return e.detach(),f}function tb(a){var b=l,c=rb[a];return c||(c=sb(a,b),"none"!==c&&c||(qb=(qb||n("<iframe frameborder='0' width='0' height='0'/>")).appendTo(b.documentElement),b=qb[0].contentDocument,b.write(),b.close(),c=sb(a,b),qb.detach()),rb[a]=c),c}var ub=/^margin/,vb=new RegExp("^("+Q+")(?!px)[a-z%]+$","i"),wb=function(a){return a.ownerDocument.defaultView.getComputedStyle(a,null)};function xb(a,b,c){var d,e,f,g,h=a.style;return c=c||wb(a),c&&(g=c.getPropertyValue(b)||c[b]),c&&(""!==g||n.contains(a.ownerDocument,a)||(g=n.style(a,b)),vb.test(g)&&ub.test(b)&&(d=h.width,e=h.minWidth,f=h.maxWidth,h.minWidth=h.maxWidth=h.width=g,g=c.width,h.width=d,h.minWidth=e,h.maxWidth=f)),void 0!==g?g+"":g}function yb(a,b){return{get:function(){return a()?void delete this.get:(this.get=b).apply(this,arguments)}}}!function(){var b,c,d=l.documentElement,e=l.createElement("div"),f=l.createElement("div");if(f.style){f.style.backgroundClip="content-box",f.cloneNode(!0).style.backgroundClip="",k.clearCloneStyle="content-box"===f.style.backgroundClip,e.style.cssText="border:0;width:0;height:0;top:0;left:-9999px;margin-top:1px;position:absolute",e.appendChild(f);function g(){f.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;display:block;margin-top:1%;top:1%;border:1px;padding:1px;width:4px;position:absolute",f.innerHTML="",d.appendChild(e);var g=a.getComputedStyle(f,null);b="1%"!==g.top,c="4px"===g.width,d.removeChild(e)}a.getComputedStyle&&n.extend(k,{pixelPosition:function(){return g(),b},boxSizingReliable:function(){return null==c&&g(),c},reliableMarginRight:function(){var b,c=f.appendChild(l.createElement("div"));return c.style.cssText=f.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0",c.style.marginRight=c.style.width="0",f.style.width="1px",d.appendChild(e),b=!parseFloat(a.getComputedStyle(c,null).marginRight),d.removeChild(e),b}})}}(),n.swap=function(a,b,c,d){var e,f,g={};for(f in b)g[f]=a.style[f],a.style[f]=b[f];e=c.apply(a,d||[]);for(f in b)a.style[f]=g[f];return e};var zb=/^(none|table(?!-c[ea]).+)/,Ab=new RegExp("^("+Q+")(.*)$","i"),Bb=new RegExp("^([+-])=("+Q+")","i"),Cb={position:"absolute",visibility:"hidden",display:"block"},Db={letterSpacing:"0",fontWeight:"400"},Eb=["Webkit","O","Moz","ms"];function Fb(a,b){if(b in a)return b;var c=b[0].toUpperCase()+b.slice(1),d=b,e=Eb.length;while(e--)if(b=Eb[e]+c,b in a)return b;return d}function Gb(a,b,c){var d=Ab.exec(b);return d?Math.max(0,d[1]-(c||0))+(d[2]||"px"):b}function Hb(a,b,c,d,e){for(var f=c===(d?"border":"content")?4:"width"===b?1:0,g=0;4>f;f+=2)"margin"===c&&(g+=n.css(a,c+R[f],!0,e)),d?("content"===c&&(g-=n.css(a,"padding"+R[f],!0,e)),"margin"!==c&&(g-=n.css(a,"border"+R[f]+"Width",!0,e))):(g+=n.css(a,"padding"+R[f],!0,e),"padding"!==c&&(g+=n.css(a,"border"+R[f]+"Width",!0,e)));return g}function Ib(a,b,c){var d=!0,e="width"===b?a.offsetWidth:a.offsetHeight,f=wb(a),g="border-box"===n.css(a,"boxSizing",!1,f);if(0>=e||null==e){if(e=xb(a,b,f),(0>e||null==e)&&(e=a.style[b]),vb.test(e))return e;d=g&&(k.boxSizingReliable()||e===a.style[b]),e=parseFloat(e)||0}return e+Hb(a,b,c||(g?"border":"content"),d,f)+"px"}function Jb(a,b){for(var c,d,e,f=[],g=0,h=a.length;h>g;g++)d=a[g],d.style&&(f[g]=L.get(d,"olddisplay"),c=d.style.display,b?(f[g]||"none"!==c||(d.style.display=""),""===d.style.display&&S(d)&&(f[g]=L.access(d,"olddisplay",tb(d.nodeName)))):(e=S(d),"none"===c&&e||L.set(d,"olddisplay",e?c:n.css(d,"display"))));for(g=0;h>g;g++)d=a[g],d.style&&(b&&"none"!==d.style.display&&""!==d.style.display||(d.style.display=b?f[g]||"":"none"));return a}n.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=xb(a,"opacity");return""===c?"1":c}}}},cssNumber:{columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":"cssFloat"},style:function(a,b,c,d){if(a&&3!==a.nodeType&&8!==a.nodeType&&a.style){var e,f,g,h=n.camelCase(b),i=a.style;return b=n.cssProps[h]||(n.cssProps[h]=Fb(i,h)),g=n.cssHooks[b]||n.cssHooks[h],void 0===c?g&&"get"in g&&void 0!==(e=g.get(a,!1,d))?e:i[b]:(f=typeof c,"string"===f&&(e=Bb.exec(c))&&(c=(e[1]+1)*e[2]+parseFloat(n.css(a,b)),f="number"),null!=c&&c===c&&("number"!==f||n.cssNumber[h]||(c+="px"),k.clearCloneStyle||""!==c||0!==b.indexOf("background")||(i[b]="inherit"),g&&"set"in g&&void 0===(c=g.set(a,c,d))||(i[b]=c)),void 0)}},css:function(a,b,c,d){var e,f,g,h=n.camelCase(b);return b=n.cssProps[h]||(n.cssProps[h]=Fb(a.style,h)),g=n.cssHooks[b]||n.cssHooks[h],g&&"get"in g&&(e=g.get(a,!0,c)),void 0===e&&(e=xb(a,b,d)),"normal"===e&&b in Db&&(e=Db[b]),""===c||c?(f=parseFloat(e),c===!0||n.isNumeric(f)?f||0:e):e}}),n.each(["height","width"],function(a,b){n.cssHooks[b]={get:function(a,c,d){return c?zb.test(n.css(a,"display"))&&0===a.offsetWidth?n.swap(a,Cb,function(){return Ib(a,b,d)}):Ib(a,b,d):void 0},set:function(a,c,d){var e=d&&wb(a);return Gb(a,c,d?Hb(a,b,d,"border-box"===n.css(a,"boxSizing",!1,e),e):0)}}}),n.cssHooks.marginRight=yb(k.reliableMarginRight,function(a,b){return b?n.swap(a,{display:"inline-block"},xb,[a,"marginRight"]):void 0}),n.each({margin:"",padding:"",border:"Width"},function(a,b){n.cssHooks[a+b]={expand:function(c){for(var d=0,e={},f="string"==typeof c?c.split(" "):[c];4>d;d++)e[a+R[d]+b]=f[d]||f[d-2]||f[0];return e}},ub.test(a)||(n.cssHooks[a+b].set=Gb)}),n.fn.extend({css:function(a,b){return J(this,function(a,b,c){var d,e,f={},g=0;if(n.isArray(b)){for(d=wb(a),e=b.length;e>g;g++)f[b[g]]=n.css(a,b[g],!1,d);return f}return void 0!==c?n.style(a,b,c):n.css(a,b)},a,b,arguments.length>1)},show:function(){return Jb(this,!0)},hide:function(){return Jb(this)},toggle:function(a){return"boolean"==typeof a?a?this.show():this.hide():this.each(function(){S(this)?n(this).show():n(this).hide()})}});function Kb(a,b,c,d,e){return new Kb.prototype.init(a,b,c,d,e)}n.Tween=Kb,Kb.prototype={constructor:Kb,init:function(a,b,c,d,e,f){this.elem=a,this.prop=c,this.easing=e||"swing",this.options=b,this.start=this.now=this.cur(),this.end=d,this.unit=f||(n.cssNumber[c]?"":"px")},cur:function(){var a=Kb.propHooks[this.prop];return a&&a.get?a.get(this):Kb.propHooks._default.get(this)},run:function(a){var b,c=Kb.propHooks[this.prop];return this.pos=b=this.options.duration?n.easing[this.easing](a,this.options.duration*a,0,1,this.options.duration):a,this.now=(this.end-this.start)*b+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),c&&c.set?c.set(this):Kb.propHooks._default.set(this),this}},Kb.prototype.init.prototype=Kb.prototype,Kb.propHooks={_default:{get:function(a){var b;return null==a.elem[a.prop]||a.elem.style&&null!=a.elem.style[a.prop]?(b=n.css(a.elem,a.prop,""),b&&"auto"!==b?b:0):a.elem[a.prop]},set:function(a){n.fx.step[a.prop]?n.fx.step[a.prop](a):a.elem.style&&(null!=a.elem.style[n.cssProps[a.prop]]||n.cssHooks[a.prop])?n.style(a.elem,a.prop,a.now+a.unit):a.elem[a.prop]=a.now}}},Kb.propHooks.scrollTop=Kb.propHooks.scrollLeft={set:function(a){a.elem.nodeType&&a.elem.parentNode&&(a.elem[a.prop]=a.now)}},n.easing={linear:function(a){return a},swing:function(a){return.5-Math.cos(a*Math.PI)/2}},n.fx=Kb.prototype.init,n.fx.step={};var Lb,Mb,Nb=/^(?:toggle|show|hide)$/,Ob=new RegExp("^(?:([+-])=|)("+Q+")([a-z%]*)$","i"),Pb=/queueHooks$/,Qb=[Vb],Rb={"*":[function(a,b){var c=this.createTween(a,b),d=c.cur(),e=Ob.exec(b),f=e&&e[3]||(n.cssNumber[a]?"":"px"),g=(n.cssNumber[a]||"px"!==f&&+d)&&Ob.exec(n.css(c.elem,a)),h=1,i=20;if(g&&g[3]!==f){f=f||g[3],e=e||[],g=+d||1;do h=h||".5",g/=h,n.style(c.elem,a,g+f);while(h!==(h=c.cur()/d)&&1!==h&&--i)}return e&&(g=c.start=+g||+d||0,c.unit=f,c.end=e[1]?g+(e[1]+1)*e[2]:+e[2]),c}]};function Sb(){return setTimeout(function(){Lb=void 0}),Lb=n.now()}function Tb(a,b){var c,d=0,e={height:a};for(b=b?1:0;4>d;d+=2-b)c=R[d],e["margin"+c]=e["padding"+c]=a;return b&&(e.opacity=e.width=a),e}function Ub(a,b,c){for(var d,e=(Rb[b]||[]).concat(Rb["*"]),f=0,g=e.length;g>f;f++)if(d=e[f].call(c,b,a))return d}function Vb(a,b,c){var d,e,f,g,h,i,j,k,l=this,m={},o=a.style,p=a.nodeType&&S(a),q=L.get(a,"fxshow");c.queue||(h=n._queueHooks(a,"fx"),null==h.unqueued&&(h.unqueued=0,i=h.empty.fire,h.empty.fire=function(){h.unqueued||i()}),h.unqueued++,l.always(function(){l.always(function(){h.unqueued--,n.queue(a,"fx").length||h.empty.fire()})})),1===a.nodeType&&("height"in b||"width"in b)&&(c.overflow=[o.overflow,o.overflowX,o.overflowY],j=n.css(a,"display"),k="none"===j?L.get(a,"olddisplay")||tb(a.nodeName):j,"inline"===k&&"none"===n.css(a,"float")&&(o.display="inline-block")),c.overflow&&(o.overflow="hidden",l.always(function(){o.overflow=c.overflow[0],o.overflowX=c.overflow[1],o.overflowY=c.overflow[2]}));for(d in b)if(e=b[d],Nb.exec(e)){if(delete b[d],f=f||"toggle"===e,e===(p?"hide":"show")){if("show"!==e||!q||void 0===q[d])continue;p=!0}m[d]=q&&q[d]||n.style(a,d)}else j=void 0;if(n.isEmptyObject(m))"inline"===("none"===j?tb(a.nodeName):j)&&(o.display=j);else{q?"hidden"in q&&(p=q.hidden):q=L.access(a,"fxshow",{}),f&&(q.hidden=!p),p?n(a).show():l.done(function(){n(a).hide()}),l.done(function(){var b;L.remove(a,"fxshow");for(b in m)n.style(a,b,m[b])});for(d in m)g=Ub(p?q[d]:0,d,l),d in q||(q[d]=g.start,p&&(g.end=g.start,g.start="width"===d||"height"===d?1:0))}}function Wb(a,b){var c,d,e,f,g;for(c in a)if(d=n.camelCase(c),e=b[d],f=a[c],n.isArray(f)&&(e=f[1],f=a[c]=f[0]),c!==d&&(a[d]=f,delete a[c]),g=n.cssHooks[d],g&&"expand"in g){f=g.expand(f),delete a[d];for(c in f)c in a||(a[c]=f[c],b[c]=e)}else b[d]=e}function Xb(a,b,c){var d,e,f=0,g=Qb.length,h=n.Deferred().always(function(){delete i.elem}),i=function(){if(e)return!1;for(var b=Lb||Sb(),c=Math.max(0,j.startTime+j.duration-b),d=c/j.duration||0,f=1-d,g=0,i=j.tweens.length;i>g;g++)j.tweens[g].run(f);return h.notifyWith(a,[j,f,c]),1>f&&i?c:(h.resolveWith(a,[j]),!1)},j=h.promise({elem:a,props:n.extend({},b),opts:n.extend(!0,{specialEasing:{}},c),originalProperties:b,originalOptions:c,startTime:Lb||Sb(),duration:c.duration,tweens:[],createTween:function(b,c){var d=n.Tween(a,j.opts,b,c,j.opts.specialEasing[b]||j.opts.easing);return j.tweens.push(d),d},stop:function(b){var c=0,d=b?j.tweens.length:0;if(e)return this;for(e=!0;d>c;c++)j.tweens[c].run(1);return b?h.resolveWith(a,[j,b]):h.rejectWith(a,[j,b]),this}}),k=j.props;for(Wb(k,j.opts.specialEasing);g>f;f++)if(d=Qb[f].call(j,a,k,j.opts))return d;return n.map(k,Ub,j),n.isFunction(j.opts.start)&&j.opts.start.call(a,j),n.fx.timer(n.extend(i,{elem:a,anim:j,queue:j.opts.queue})),j.progress(j.opts.progress).done(j.opts.done,j.opts.complete).fail(j.opts.fail).always(j.opts.always)}n.Animation=n.extend(Xb,{tweener:function(a,b){n.isFunction(a)?(b=a,a=["*"]):a=a.split(" ");for(var c,d=0,e=a.length;e>d;d++)c=a[d],Rb[c]=Rb[c]||[],Rb[c].unshift(b)},prefilter:function(a,b){b?Qb.unshift(a):Qb.push(a)}}),n.speed=function(a,b,c){var d=a&&"object"==typeof a?n.extend({},a):{complete:c||!c&&b||n.isFunction(a)&&a,duration:a,easing:c&&b||b&&!n.isFunction(b)&&b};return d.duration=n.fx.off?0:"number"==typeof d.duration?d.duration:d.duration in n.fx.speeds?n.fx.speeds[d.duration]:n.fx.speeds._default,(null==d.queue||d.queue===!0)&&(d.queue="fx"),d.old=d.complete,d.complete=function(){n.isFunction(d.old)&&d.old.call(this),d.queue&&n.dequeue(this,d.queue)},d},n.fn.extend({fadeTo:function(a,b,c,d){return this.filter(S).css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){var e=n.isEmptyObject(a),f=n.speed(b,c,d),g=function(){var b=Xb(this,n.extend({},a),f);(e||L.get(this,"finish"))&&b.stop(!0)};return g.finish=g,e||f.queue===!1?this.each(g):this.queue(f.queue,g)},stop:function(a,b,c){var d=function(a){var b=a.stop;delete a.stop,b(c)};return"string"!=typeof a&&(c=b,b=a,a=void 0),b&&a!==!1&&this.queue(a||"fx",[]),this.each(function(){var b=!0,e=null!=a&&a+"queueHooks",f=n.timers,g=L.get(this);if(e)g[e]&&g[e].stop&&d(g[e]);else for(e in g)g[e]&&g[e].stop&&Pb.test(e)&&d(g[e]);for(e=f.length;e--;)f[e].elem!==this||null!=a&&f[e].queue!==a||(f[e].anim.stop(c),b=!1,f.splice(e,1));(b||!c)&&n.dequeue(this,a)})},finish:function(a){return a!==!1&&(a=a||"fx"),this.each(function(){var b,c=L.get(this),d=c[a+"queue"],e=c[a+"queueHooks"],f=n.timers,g=d?d.length:0;for(c.finish=!0,n.queue(this,a,[]),e&&e.stop&&e.stop.call(this,!0),b=f.length;b--;)f[b].elem===this&&f[b].queue===a&&(f[b].anim.stop(!0),f.splice(b,1));for(b=0;g>b;b++)d[b]&&d[b].finish&&d[b].finish.call(this);delete c.finish})}}),n.each(["toggle","show","hide"],function(a,b){var c=n.fn[b];n.fn[b]=function(a,d,e){return null==a||"boolean"==typeof a?c.apply(this,arguments):this.animate(Tb(b,!0),a,d,e)}}),n.each({slideDown:Tb("show"),slideUp:Tb("hide"),slideToggle:Tb("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){n.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}}),n.timers=[],n.fx.tick=function(){var a,b=0,c=n.timers;for(Lb=n.now();b<c.length;b++)a=c[b],a()||c[b]!==a||c.splice(b--,1);c.length||n.fx.stop(),Lb=void 0},n.fx.timer=function(a){n.timers.push(a),a()?n.fx.start():n.timers.pop()},n.fx.interval=13,n.fx.start=function(){Mb||(Mb=setInterval(n.fx.tick,n.fx.interval))},n.fx.stop=function(){clearInterval(Mb),Mb=null},n.fx.speeds={slow:600,fast:200,_default:400},n.fn.delay=function(a,b){return a=n.fx?n.fx.speeds[a]||a:a,b=b||"fx",this.queue(b,function(b,c){var d=setTimeout(b,a);c.stop=function(){clearTimeout(d)}})},function(){var a=l.createElement("input"),b=l.createElement("select"),c=b.appendChild(l.createElement("option"));a.type="checkbox",k.checkOn=""!==a.value,k.optSelected=c.selected,b.disabled=!0,k.optDisabled=!c.disabled,a=l.createElement("input"),a.value="t",a.type="radio",k.radioValue="t"===a.value}();var Yb,Zb,$b=n.expr.attrHandle;n.fn.extend({attr:function(a,b){return J(this,n.attr,a,b,arguments.length>1)},removeAttr:function(a){return this.each(function(){n.removeAttr(this,a)})}}),n.extend({attr:function(a,b,c){var d,e,f=a.nodeType;if(a&&3!==f&&8!==f&&2!==f)return typeof a.getAttribute===U?n.prop(a,b,c):(1===f&&n.isXMLDoc(a)||(b=b.toLowerCase(),d=n.attrHooks[b]||(n.expr.match.bool.test(b)?Zb:Yb)),void 0===c?d&&"get"in d&&null!==(e=d.get(a,b))?e:(e=n.find.attr(a,b),null==e?void 0:e):null!==c?d&&"set"in d&&void 0!==(e=d.set(a,c,b))?e:(a.setAttribute(b,c+""),c):void n.removeAttr(a,b))
},removeAttr:function(a,b){var c,d,e=0,f=b&&b.match(E);if(f&&1===a.nodeType)while(c=f[e++])d=n.propFix[c]||c,n.expr.match.bool.test(c)&&(a[d]=!1),a.removeAttribute(c)},attrHooks:{type:{set:function(a,b){if(!k.radioValue&&"radio"===b&&n.nodeName(a,"input")){var c=a.value;return a.setAttribute("type",b),c&&(a.value=c),b}}}}}),Zb={set:function(a,b,c){return b===!1?n.removeAttr(a,c):a.setAttribute(c,c),c}},n.each(n.expr.match.bool.source.match(/\w+/g),function(a,b){var c=$b[b]||n.find.attr;$b[b]=function(a,b,d){var e,f;return d||(f=$b[b],$b[b]=e,e=null!=c(a,b,d)?b.toLowerCase():null,$b[b]=f),e}});var _b=/^(?:input|select|textarea|button)$/i;n.fn.extend({prop:function(a,b){return J(this,n.prop,a,b,arguments.length>1)},removeProp:function(a){return this.each(function(){delete this[n.propFix[a]||a]})}}),n.extend({propFix:{"for":"htmlFor","class":"className"},prop:function(a,b,c){var d,e,f,g=a.nodeType;if(a&&3!==g&&8!==g&&2!==g)return f=1!==g||!n.isXMLDoc(a),f&&(b=n.propFix[b]||b,e=n.propHooks[b]),void 0!==c?e&&"set"in e&&void 0!==(d=e.set(a,c,b))?d:a[b]=c:e&&"get"in e&&null!==(d=e.get(a,b))?d:a[b]},propHooks:{tabIndex:{get:function(a){return a.hasAttribute("tabindex")||_b.test(a.nodeName)||a.href?a.tabIndex:-1}}}}),k.optSelected||(n.propHooks.selected={get:function(a){var b=a.parentNode;return b&&b.parentNode&&b.parentNode.selectedIndex,null}}),n.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){n.propFix[this.toLowerCase()]=this});var ac=/[\t\r\n\f]/g;n.fn.extend({addClass:function(a){var b,c,d,e,f,g,h="string"==typeof a&&a,i=0,j=this.length;if(n.isFunction(a))return this.each(function(b){n(this).addClass(a.call(this,b,this.className))});if(h)for(b=(a||"").match(E)||[];j>i;i++)if(c=this[i],d=1===c.nodeType&&(c.className?(" "+c.className+" ").replace(ac," "):" ")){f=0;while(e=b[f++])d.indexOf(" "+e+" ")<0&&(d+=e+" ");g=n.trim(d),c.className!==g&&(c.className=g)}return this},removeClass:function(a){var b,c,d,e,f,g,h=0===arguments.length||"string"==typeof a&&a,i=0,j=this.length;if(n.isFunction(a))return this.each(function(b){n(this).removeClass(a.call(this,b,this.className))});if(h)for(b=(a||"").match(E)||[];j>i;i++)if(c=this[i],d=1===c.nodeType&&(c.className?(" "+c.className+" ").replace(ac," "):"")){f=0;while(e=b[f++])while(d.indexOf(" "+e+" ")>=0)d=d.replace(" "+e+" "," ");g=a?n.trim(d):"",c.className!==g&&(c.className=g)}return this},toggleClass:function(a,b){var c=typeof a;return"boolean"==typeof b&&"string"===c?b?this.addClass(a):this.removeClass(a):this.each(n.isFunction(a)?function(c){n(this).toggleClass(a.call(this,c,this.className,b),b)}:function(){if("string"===c){var b,d=0,e=n(this),f=a.match(E)||[];while(b=f[d++])e.hasClass(b)?e.removeClass(b):e.addClass(b)}else(c===U||"boolean"===c)&&(this.className&&L.set(this,"__className__",this.className),this.className=this.className||a===!1?"":L.get(this,"__className__")||"")})},hasClass:function(a){for(var b=" "+a+" ",c=0,d=this.length;d>c;c++)if(1===this[c].nodeType&&(" "+this[c].className+" ").replace(ac," ").indexOf(b)>=0)return!0;return!1}});var bc=/\r/g;n.fn.extend({val:function(a){var b,c,d,e=this[0];{if(arguments.length)return d=n.isFunction(a),this.each(function(c){var e;1===this.nodeType&&(e=d?a.call(this,c,n(this).val()):a,null==e?e="":"number"==typeof e?e+="":n.isArray(e)&&(e=n.map(e,function(a){return null==a?"":a+""})),b=n.valHooks[this.type]||n.valHooks[this.nodeName.toLowerCase()],b&&"set"in b&&void 0!==b.set(this,e,"value")||(this.value=e))});if(e)return b=n.valHooks[e.type]||n.valHooks[e.nodeName.toLowerCase()],b&&"get"in b&&void 0!==(c=b.get(e,"value"))?c:(c=e.value,"string"==typeof c?c.replace(bc,""):null==c?"":c)}}}),n.extend({valHooks:{option:{get:function(a){var b=n.find.attr(a,"value");return null!=b?b:n.trim(n.text(a))}},select:{get:function(a){for(var b,c,d=a.options,e=a.selectedIndex,f="select-one"===a.type||0>e,g=f?null:[],h=f?e+1:d.length,i=0>e?h:f?e:0;h>i;i++)if(c=d[i],!(!c.selected&&i!==e||(k.optDisabled?c.disabled:null!==c.getAttribute("disabled"))||c.parentNode.disabled&&n.nodeName(c.parentNode,"optgroup"))){if(b=n(c).val(),f)return b;g.push(b)}return g},set:function(a,b){var c,d,e=a.options,f=n.makeArray(b),g=e.length;while(g--)d=e[g],(d.selected=n.inArray(d.value,f)>=0)&&(c=!0);return c||(a.selectedIndex=-1),f}}}}),n.each(["radio","checkbox"],function(){n.valHooks[this]={set:function(a,b){return n.isArray(b)?a.checked=n.inArray(n(a).val(),b)>=0:void 0}},k.checkOn||(n.valHooks[this].get=function(a){return null===a.getAttribute("value")?"on":a.value})}),n.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(a,b){n.fn[b]=function(a,c){return arguments.length>0?this.on(b,null,a,c):this.trigger(b)}}),n.fn.extend({hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)},bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return 1===arguments.length?this.off(a,"**"):this.off(b,a||"**",c)}});var cc=n.now(),dc=/\?/;n.parseJSON=function(a){return JSON.parse(a+"")},n.parseXML=function(a){var b,c;if(!a||"string"!=typeof a)return null;try{c=new DOMParser,b=c.parseFromString(a,"text/xml")}catch(d){b=void 0}return(!b||b.getElementsByTagName("parsererror").length)&&n.error("Invalid XML: "+a),b};var ec,fc,gc=/#.*$/,hc=/([?&])_=[^&]*/,ic=/^(.*?):[ \t]*([^\r\n]*)$/gm,jc=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,kc=/^(?:GET|HEAD)$/,lc=/^\/\//,mc=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,nc={},oc={},pc="*/".concat("*");try{fc=location.href}catch(qc){fc=l.createElement("a"),fc.href="",fc=fc.href}ec=mc.exec(fc.toLowerCase())||[];function rc(a){return function(b,c){"string"!=typeof b&&(c=b,b="*");var d,e=0,f=b.toLowerCase().match(E)||[];if(n.isFunction(c))while(d=f[e++])"+"===d[0]?(d=d.slice(1)||"*",(a[d]=a[d]||[]).unshift(c)):(a[d]=a[d]||[]).push(c)}}function sc(a,b,c,d){var e={},f=a===oc;function g(h){var i;return e[h]=!0,n.each(a[h]||[],function(a,h){var j=h(b,c,d);return"string"!=typeof j||f||e[j]?f?!(i=j):void 0:(b.dataTypes.unshift(j),g(j),!1)}),i}return g(b.dataTypes[0])||!e["*"]&&g("*")}function tc(a,b){var c,d,e=n.ajaxSettings.flatOptions||{};for(c in b)void 0!==b[c]&&((e[c]?a:d||(d={}))[c]=b[c]);return d&&n.extend(!0,a,d),a}function uc(a,b,c){var d,e,f,g,h=a.contents,i=a.dataTypes;while("*"===i[0])i.shift(),void 0===d&&(d=a.mimeType||b.getResponseHeader("Content-Type"));if(d)for(e in h)if(h[e]&&h[e].test(d)){i.unshift(e);break}if(i[0]in c)f=i[0];else{for(e in c){if(!i[0]||a.converters[e+" "+i[0]]){f=e;break}g||(g=e)}f=f||g}return f?(f!==i[0]&&i.unshift(f),c[f]):void 0}function vc(a,b,c,d){var e,f,g,h,i,j={},k=a.dataTypes.slice();if(k[1])for(g in a.converters)j[g.toLowerCase()]=a.converters[g];f=k.shift();while(f)if(a.responseFields[f]&&(c[a.responseFields[f]]=b),!i&&d&&a.dataFilter&&(b=a.dataFilter(b,a.dataType)),i=f,f=k.shift())if("*"===f)f=i;else if("*"!==i&&i!==f){if(g=j[i+" "+f]||j["* "+f],!g)for(e in j)if(h=e.split(" "),h[1]===f&&(g=j[i+" "+h[0]]||j["* "+h[0]])){g===!0?g=j[e]:j[e]!==!0&&(f=h[0],k.unshift(h[1]));break}if(g!==!0)if(g&&a["throws"])b=g(b);else try{b=g(b)}catch(l){return{state:"parsererror",error:g?l:"No conversion from "+i+" to "+f}}}return{state:"success",data:b}}n.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:fc,type:"GET",isLocal:jc.test(ec[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":pc,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":n.parseJSON,"text xml":n.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(a,b){return b?tc(tc(a,n.ajaxSettings),b):tc(n.ajaxSettings,a)},ajaxPrefilter:rc(nc),ajaxTransport:rc(oc),ajax:function(a,b){"object"==typeof a&&(b=a,a=void 0),b=b||{};var c,d,e,f,g,h,i,j,k=n.ajaxSetup({},b),l=k.context||k,m=k.context&&(l.nodeType||l.jquery)?n(l):n.event,o=n.Deferred(),p=n.Callbacks("once memory"),q=k.statusCode||{},r={},s={},t=0,u="canceled",v={readyState:0,getResponseHeader:function(a){var b;if(2===t){if(!f){f={};while(b=ic.exec(e))f[b[1].toLowerCase()]=b[2]}b=f[a.toLowerCase()]}return null==b?null:b},getAllResponseHeaders:function(){return 2===t?e:null},setRequestHeader:function(a,b){var c=a.toLowerCase();return t||(a=s[c]=s[c]||a,r[a]=b),this},overrideMimeType:function(a){return t||(k.mimeType=a),this},statusCode:function(a){var b;if(a)if(2>t)for(b in a)q[b]=[q[b],a[b]];else v.always(a[v.status]);return this},abort:function(a){var b=a||u;return c&&c.abort(b),x(0,b),this}};if(o.promise(v).complete=p.add,v.success=v.done,v.error=v.fail,k.url=((a||k.url||fc)+"").replace(gc,"").replace(lc,ec[1]+"//"),k.type=b.method||b.type||k.method||k.type,k.dataTypes=n.trim(k.dataType||"*").toLowerCase().match(E)||[""],null==k.crossDomain&&(h=mc.exec(k.url.toLowerCase()),k.crossDomain=!(!h||h[1]===ec[1]&&h[2]===ec[2]&&(h[3]||("http:"===h[1]?"80":"443"))===(ec[3]||("http:"===ec[1]?"80":"443")))),k.data&&k.processData&&"string"!=typeof k.data&&(k.data=n.param(k.data,k.traditional)),sc(nc,k,b,v),2===t)return v;i=k.global,i&&0===n.active++&&n.event.trigger("ajaxStart"),k.type=k.type.toUpperCase(),k.hasContent=!kc.test(k.type),d=k.url,k.hasContent||(k.data&&(d=k.url+=(dc.test(d)?"&":"?")+k.data,delete k.data),k.cache===!1&&(k.url=hc.test(d)?d.replace(hc,"$1_="+cc++):d+(dc.test(d)?"&":"?")+"_="+cc++)),k.ifModified&&(n.lastModified[d]&&v.setRequestHeader("If-Modified-Since",n.lastModified[d]),n.etag[d]&&v.setRequestHeader("If-None-Match",n.etag[d])),(k.data&&k.hasContent&&k.contentType!==!1||b.contentType)&&v.setRequestHeader("Content-Type",k.contentType),v.setRequestHeader("Accept",k.dataTypes[0]&&k.accepts[k.dataTypes[0]]?k.accepts[k.dataTypes[0]]+("*"!==k.dataTypes[0]?", "+pc+"; q=0.01":""):k.accepts["*"]);for(j in k.headers)v.setRequestHeader(j,k.headers[j]);if(k.beforeSend&&(k.beforeSend.call(l,v,k)===!1||2===t))return v.abort();u="abort";for(j in{success:1,error:1,complete:1})v[j](k[j]);if(c=sc(oc,k,b,v)){v.readyState=1,i&&m.trigger("ajaxSend",[v,k]),k.async&&k.timeout>0&&(g=setTimeout(function(){v.abort("timeout")},k.timeout));try{t=1,c.send(r,x)}catch(w){if(!(2>t))throw w;x(-1,w)}}else x(-1,"No Transport");function x(a,b,f,h){var j,r,s,u,w,x=b;2!==t&&(t=2,g&&clearTimeout(g),c=void 0,e=h||"",v.readyState=a>0?4:0,j=a>=200&&300>a||304===a,f&&(u=uc(k,v,f)),u=vc(k,u,v,j),j?(k.ifModified&&(w=v.getResponseHeader("Last-Modified"),w&&(n.lastModified[d]=w),w=v.getResponseHeader("etag"),w&&(n.etag[d]=w)),204===a||"HEAD"===k.type?x="nocontent":304===a?x="notmodified":(x=u.state,r=u.data,s=u.error,j=!s)):(s=x,(a||!x)&&(x="error",0>a&&(a=0))),v.status=a,v.statusText=(b||x)+"",j?o.resolveWith(l,[r,x,v]):o.rejectWith(l,[v,x,s]),v.statusCode(q),q=void 0,i&&m.trigger(j?"ajaxSuccess":"ajaxError",[v,k,j?r:s]),p.fireWith(l,[v,x]),i&&(m.trigger("ajaxComplete",[v,k]),--n.active||n.event.trigger("ajaxStop")))}return v},getJSON:function(a,b,c){return n.get(a,b,c,"json")},getScript:function(a,b){return n.get(a,void 0,b,"script")}}),n.each(["get","post"],function(a,b){n[b]=function(a,c,d,e){return n.isFunction(c)&&(e=e||d,d=c,c=void 0),n.ajax({url:a,type:b,dataType:e,data:c,success:d})}}),n.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(a,b){n.fn[b]=function(a){return this.on(b,a)}}),n._evalUrl=function(a){return n.ajax({url:a,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})},n.fn.extend({wrapAll:function(a){var b;return n.isFunction(a)?this.each(function(b){n(this).wrapAll(a.call(this,b))}):(this[0]&&(b=n(a,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){var a=this;while(a.firstElementChild)a=a.firstElementChild;return a}).append(this)),this)},wrapInner:function(a){return this.each(n.isFunction(a)?function(b){n(this).wrapInner(a.call(this,b))}:function(){var b=n(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=n.isFunction(a);return this.each(function(c){n(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(){return this.parent().each(function(){n.nodeName(this,"body")||n(this).replaceWith(this.childNodes)}).end()}}),n.expr.filters.hidden=function(a){return a.offsetWidth<=0&&a.offsetHeight<=0},n.expr.filters.visible=function(a){return!n.expr.filters.hidden(a)};var wc=/%20/g,xc=/\[\]$/,yc=/\r?\n/g,zc=/^(?:submit|button|image|reset|file)$/i,Ac=/^(?:input|select|textarea|keygen)/i;function Bc(a,b,c,d){var e;if(n.isArray(b))n.each(b,function(b,e){c||xc.test(a)?d(a,e):Bc(a+"["+("object"==typeof e?b:"")+"]",e,c,d)});else if(c||"object"!==n.type(b))d(a,b);else for(e in b)Bc(a+"["+e+"]",b[e],c,d)}n.param=function(a,b){var c,d=[],e=function(a,b){b=n.isFunction(b)?b():null==b?"":b,d[d.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};if(void 0===b&&(b=n.ajaxSettings&&n.ajaxSettings.traditional),n.isArray(a)||a.jquery&&!n.isPlainObject(a))n.each(a,function(){e(this.name,this.value)});else for(c in a)Bc(c,a[c],b,e);return d.join("&").replace(wc,"+")},n.fn.extend({serialize:function(){return n.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var a=n.prop(this,"elements");return a?n.makeArray(a):this}).filter(function(){var a=this.type;return this.name&&!n(this).is(":disabled")&&Ac.test(this.nodeName)&&!zc.test(a)&&(this.checked||!T.test(a))}).map(function(a,b){var c=n(this).val();return null==c?null:n.isArray(c)?n.map(c,function(a){return{name:b.name,value:a.replace(yc,"\r\n")}}):{name:b.name,value:c.replace(yc,"\r\n")}}).get()}}),n.ajaxSettings.xhr=function(){try{return new XMLHttpRequest}catch(a){}};var Cc=0,Dc={},Ec={0:200,1223:204},Fc=n.ajaxSettings.xhr();a.ActiveXObject&&n(a).on("unload",function(){for(var a in Dc)Dc[a]()}),k.cors=!!Fc&&"withCredentials"in Fc,k.ajax=Fc=!!Fc,n.ajaxTransport(function(a){var b;return k.cors||Fc&&!a.crossDomain?{send:function(c,d){var e,f=a.xhr(),g=++Cc;if(f.open(a.type,a.url,a.async,a.username,a.password),a.xhrFields)for(e in a.xhrFields)f[e]=a.xhrFields[e];a.mimeType&&f.overrideMimeType&&f.overrideMimeType(a.mimeType),a.crossDomain||c["X-Requested-With"]||(c["X-Requested-With"]="XMLHttpRequest");for(e in c)f.setRequestHeader(e,c[e]);b=function(a){return function(){b&&(delete Dc[g],b=f.onload=f.onerror=null,"abort"===a?f.abort():"error"===a?d(f.status,f.statusText):d(Ec[f.status]||f.status,f.statusText,"string"==typeof f.responseText?{text:f.responseText}:void 0,f.getAllResponseHeaders()))}},f.onload=b(),f.onerror=b("error"),b=Dc[g]=b("abort");try{f.send(a.hasContent&&a.data||null)}catch(h){if(b)throw h}},abort:function(){b&&b()}}:void 0}),n.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(a){return n.globalEval(a),a}}}),n.ajaxPrefilter("script",function(a){void 0===a.cache&&(a.cache=!1),a.crossDomain&&(a.type="GET")}),n.ajaxTransport("script",function(a){if(a.crossDomain){var b,c;return{send:function(d,e){b=n("<script>").prop({async:!0,charset:a.scriptCharset,src:a.url}).on("load error",c=function(a){b.remove(),c=null,a&&e("error"===a.type?404:200,a.type)}),l.head.appendChild(b[0])},abort:function(){c&&c()}}}});var Gc=[],Hc=/(=)\?(?=&|$)|\?\?/;n.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var a=Gc.pop()||n.expando+"_"+cc++;return this[a]=!0,a}}),n.ajaxPrefilter("json jsonp",function(b,c,d){var e,f,g,h=b.jsonp!==!1&&(Hc.test(b.url)?"url":"string"==typeof b.data&&!(b.contentType||"").indexOf("application/x-www-form-urlencoded")&&Hc.test(b.data)&&"data");return h||"jsonp"===b.dataTypes[0]?(e=b.jsonpCallback=n.isFunction(b.jsonpCallback)?b.jsonpCallback():b.jsonpCallback,h?b[h]=b[h].replace(Hc,"$1"+e):b.jsonp!==!1&&(b.url+=(dc.test(b.url)?"&":"?")+b.jsonp+"="+e),b.converters["script json"]=function(){return g||n.error(e+" was not called"),g[0]},b.dataTypes[0]="json",f=a[e],a[e]=function(){g=arguments},d.always(function(){a[e]=f,b[e]&&(b.jsonpCallback=c.jsonpCallback,Gc.push(e)),g&&n.isFunction(f)&&f(g[0]),g=f=void 0}),"script"):void 0}),n.parseHTML=function(a,b,c){if(!a||"string"!=typeof a)return null;"boolean"==typeof b&&(c=b,b=!1),b=b||l;var d=v.exec(a),e=!c&&[];return d?[b.createElement(d[1])]:(d=n.buildFragment([a],b,e),e&&e.length&&n(e).remove(),n.merge([],d.childNodes))};var Ic=n.fn.load;n.fn.load=function(a,b,c){if("string"!=typeof a&&Ic)return Ic.apply(this,arguments);var d,e,f,g=this,h=a.indexOf(" ");return h>=0&&(d=n.trim(a.slice(h)),a=a.slice(0,h)),n.isFunction(b)?(c=b,b=void 0):b&&"object"==typeof b&&(e="POST"),g.length>0&&n.ajax({url:a,type:e,dataType:"html",data:b}).done(function(a){f=arguments,g.html(d?n("<div>").append(n.parseHTML(a)).find(d):a)}).complete(c&&function(a,b){g.each(c,f||[a.responseText,b,a])}),this},n.expr.filters.animated=function(a){return n.grep(n.timers,function(b){return a===b.elem}).length};var Jc=a.document.documentElement;function Kc(a){return n.isWindow(a)?a:9===a.nodeType&&a.defaultView}n.offset={setOffset:function(a,b,c){var d,e,f,g,h,i,j,k=n.css(a,"position"),l=n(a),m={};"static"===k&&(a.style.position="relative"),h=l.offset(),f=n.css(a,"top"),i=n.css(a,"left"),j=("absolute"===k||"fixed"===k)&&(f+i).indexOf("auto")>-1,j?(d=l.position(),g=d.top,e=d.left):(g=parseFloat(f)||0,e=parseFloat(i)||0),n.isFunction(b)&&(b=b.call(a,c,h)),null!=b.top&&(m.top=b.top-h.top+g),null!=b.left&&(m.left=b.left-h.left+e),"using"in b?b.using.call(a,m):l.css(m)}},n.fn.extend({offset:function(a){if(arguments.length)return void 0===a?this:this.each(function(b){n.offset.setOffset(this,a,b)});var b,c,d=this[0],e={top:0,left:0},f=d&&d.ownerDocument;if(f)return b=f.documentElement,n.contains(b,d)?(typeof d.getBoundingClientRect!==U&&(e=d.getBoundingClientRect()),c=Kc(f),{top:e.top+c.pageYOffset-b.clientTop,left:e.left+c.pageXOffset-b.clientLeft}):e},position:function(){if(this[0]){var a,b,c=this[0],d={top:0,left:0};return"fixed"===n.css(c,"position")?b=c.getBoundingClientRect():(a=this.offsetParent(),b=this.offset(),n.nodeName(a[0],"html")||(d=a.offset()),d.top+=n.css(a[0],"borderTopWidth",!0),d.left+=n.css(a[0],"borderLeftWidth",!0)),{top:b.top-d.top-n.css(c,"marginTop",!0),left:b.left-d.left-n.css(c,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){var a=this.offsetParent||Jc;while(a&&!n.nodeName(a,"html")&&"static"===n.css(a,"position"))a=a.offsetParent;return a||Jc})}}),n.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(b,c){var d="pageYOffset"===c;n.fn[b]=function(e){return J(this,function(b,e,f){var g=Kc(b);return void 0===f?g?g[c]:b[e]:void(g?g.scrollTo(d?a.pageXOffset:f,d?f:a.pageYOffset):b[e]=f)},b,e,arguments.length,null)}}),n.each(["top","left"],function(a,b){n.cssHooks[b]=yb(k.pixelPosition,function(a,c){return c?(c=xb(a,b),vb.test(c)?n(a).position()[b]+"px":c):void 0})}),n.each({Height:"height",Width:"width"},function(a,b){n.each({padding:"inner"+a,content:b,"":"outer"+a},function(c,d){n.fn[d]=function(d,e){var f=arguments.length&&(c||"boolean"!=typeof d),g=c||(d===!0||e===!0?"margin":"border");return J(this,function(b,c,d){var e;return n.isWindow(b)?b.document.documentElement["client"+a]:9===b.nodeType?(e=b.documentElement,Math.max(b.body["scroll"+a],e["scroll"+a],b.body["offset"+a],e["offset"+a],e["client"+a])):void 0===d?n.css(b,c,g):n.style(b,c,d,g)},b,f?d:void 0,f,null)}})}),n.fn.size=function(){return this.length},n.fn.andSelf=n.fn.addBack,"function"==typeof define&&define.amd&&define("jquery",[],function(){return n});var Lc=a.jQuery,Mc=a.$;return n.noConflict=function(b){return a.$===n&&(a.$=Mc),b&&a.jQuery===n&&(a.jQuery=Lc),n},typeof b===U&&(a.jQuery=a.$=n),n});

///#source 1 1 Plugins/foundation.min.js
/*
 * Foundation Responsive Library
 * http://foundation.zurb.com
 * Copyright 2014, ZURB
 * Free to use under the MIT license.
 * http://www.opensource.org/licenses/mit-license.php
*/

(function ($, window, document, undefined) {
  'use strict';

  var header_helpers = function (class_array) {
    var i = class_array.length;
    var head = $('head');

    while (i--) {
      if(head.has('.' + class_array[i]).length === 0) {
        head.append('<meta class="' + class_array[i] + '" />');
      }
    }
  };

  header_helpers([
    'foundation-mq-small',
    'foundation-mq-medium',
    'foundation-mq-large',
    'foundation-mq-xlarge',
    'foundation-mq-xxlarge',
    'foundation-data-attribute-namespace']);

  // Enable FastClick if present

  $(function() {
    if (typeof FastClick !== 'undefined') {
      // Don't attach to body if undefined
      if (typeof document.body !== 'undefined') {
        FastClick.attach(document.body);
      }
    }
  });

  // private Fast Selector wrapper,
  // returns jQuery object. Only use where
  // getElementById is not available.
  var S = function (selector, context) {
    if (typeof selector === 'string') {
      if (context) {
        var cont;
        if (context.jquery) {
          cont = context[0];
          if (!cont) return context;
        } else {
          cont = context;
        }
        return $(cont.querySelectorAll(selector));
      }

      return $(document.querySelectorAll(selector));
    }

    return $(selector, context);
  };

  // Namespace functions.

  var attr_name = function (init) {
    var arr = [];
    if (!init) arr.push('data');
    if (this.namespace.length > 0) arr.push(this.namespace);
    arr.push(this.name);

    return arr.join('-');
  };

  var add_namespace = function (str) {
    var parts = str.split('-'),
        i = parts.length,
        arr = [];

    while (i--) {
      if (i !== 0) {
        arr.push(parts[i]);
      } else {
        if (this.namespace.length > 0) {
          arr.push(this.namespace, parts[i]);
        } else {
          arr.push(parts[i]);
        }
      }
    }

    return arr.reverse().join('-');
  };

  // Event binding and data-options updating.

  var bindings = function (method, options) {
    var self = this,
        should_bind_events = !S(this).data(this.attr_name(true));


    if (S(this.scope).is('[' + this.attr_name() +']')) {
      S(this.scope).data(this.attr_name(true) + '-init', $.extend({}, this.settings, (options || method), this.data_options(S(this.scope))));

      if (should_bind_events) {
        this.events(this.scope);
      }

    } else {
      S('[' + this.attr_name() +']', this.scope).each(function () {
        var should_bind_events = !S(this).data(self.attr_name(true) + '-init');
        S(this).data(self.attr_name(true) + '-init', $.extend({}, self.settings, (options || method), self.data_options(S(this))));

        if (should_bind_events) {
          self.events(this);
        }
      });
    }
    // # Patch to fix #5043 to move this *after* the if/else clause in order for Backbone and similar frameworks to have improved control over event binding and data-options updating.
    if (typeof method === 'string') {
      return this[method].call(this, options);
    }

  };

  var single_image_loaded = function (image, callback) {
    function loaded () {
      callback(image[0]);
    }

    function bindLoad () {
      this.one('load', loaded);

      if (/MSIE (\d+\.\d+);/.test(navigator.userAgent)) {
        var src = this.attr( 'src' ),
            param = src.match( /\?/ ) ? '&' : '?';

        param += 'random=' + (new Date()).getTime();
        this.attr('src', src + param);
      }
    }

    if (!image.attr('src')) {
      loaded();
      return;
    }

    if (image[0].complete || image[0].readyState === 4) {
      loaded();
    } else {
      bindLoad.call(image);
    }
  };

  /*
    https://github.com/paulirish/matchMedia.js
  */

  window.matchMedia = window.matchMedia || (function( doc ) {

    "use strict";

    var bool,
        docElem = doc.documentElement,
        refNode = docElem.firstElementChild || docElem.firstChild,
        // fakeBody required for <FF4 when executed in <head>
        fakeBody = doc.createElement( "body" ),
        div = doc.createElement( "div" );

    div.id = "mq-test-1";
    div.style.cssText = "position:absolute;top:-100em";
    fakeBody.style.background = "none";
    fakeBody.appendChild(div);

    return function (q) {

      div.innerHTML = "&shy;<style media=\"" + q + "\"> #mq-test-1 { width: 42px; }</style>";

      docElem.insertBefore( fakeBody, refNode );
      bool = div.offsetWidth === 42;
      docElem.removeChild( fakeBody );

      return {
        matches: bool,
        media: q
      };

    };

  }( document ));

  /*
   * jquery.requestAnimationFrame
   * https://github.com/gnarf37/jquery-requestAnimationFrame
   * Requires jQuery 1.8+
   *
   * Copyright (c) 2012 Corey Frang
   * Licensed under the MIT license.
   */

  (function($) {

  // requestAnimationFrame polyfill adapted from Erik Möller
  // fixes from Paul Irish and Tino Zijdel
  // http://paulirish.com/2011/requestanimationframe-for-smart-animating/
  // http://my.opera.com/emoller/blog/2011/12/20/requestanimationframe-for-smart-er-animating

  var animating,
      lastTime = 0,
      vendors = ['webkit', 'moz'],
      requestAnimationFrame = window.requestAnimationFrame,
      cancelAnimationFrame = window.cancelAnimationFrame,
      jqueryFxAvailable = 'undefined' !== typeof jQuery.fx;

  for (; lastTime < vendors.length && !requestAnimationFrame; lastTime++) {
    requestAnimationFrame = window[ vendors[lastTime] + "RequestAnimationFrame" ];
    cancelAnimationFrame = cancelAnimationFrame ||
      window[ vendors[lastTime] + "CancelAnimationFrame" ] ||
      window[ vendors[lastTime] + "CancelRequestAnimationFrame" ];
  }

  function raf() {
    if (animating) {
      requestAnimationFrame(raf);

      if (jqueryFxAvailable) {
        jQuery.fx.tick();
      }
    }
  }

  if (requestAnimationFrame) {
    // use rAF
    window.requestAnimationFrame = requestAnimationFrame;
    window.cancelAnimationFrame = cancelAnimationFrame;

    if (jqueryFxAvailable) {
      jQuery.fx.timer = function (timer) {
        if (timer() && jQuery.timers.push(timer) && !animating) {
          animating = true;
          raf();
        }
      };

      jQuery.fx.stop = function () {
        animating = false;
      };
    }
  } else {
    // polyfill
    window.requestAnimationFrame = function (callback) {
      var currTime = new Date().getTime(),
        timeToCall = Math.max(0, 16 - (currTime - lastTime)),
        id = window.setTimeout(function () {
          callback(currTime + timeToCall);
        }, timeToCall);
      lastTime = currTime + timeToCall;
      return id;
    };

    window.cancelAnimationFrame = function (id) {
      clearTimeout(id);
    };

  }

  }( jQuery ));


  function removeQuotes (string) {
    if (typeof string === 'string' || string instanceof String) {
      string = string.replace(/^['\\/"]+|(;\s?})+|['\\/"]+$/g, '');
    }

    return string;
  }

  window.Foundation = {
    name : 'Foundation',

    version : '5.4.6',

    media_queries : {
      small : S('.foundation-mq-small').css('font-family').replace(/^[\/\\'"]+|(;\s?})+|[\/\\'"]+$/g, ''),
      medium : S('.foundation-mq-medium').css('font-family').replace(/^[\/\\'"]+|(;\s?})+|[\/\\'"]+$/g, ''),
      large : S('.foundation-mq-large').css('font-family').replace(/^[\/\\'"]+|(;\s?})+|[\/\\'"]+$/g, ''),
      xlarge: S('.foundation-mq-xlarge').css('font-family').replace(/^[\/\\'"]+|(;\s?})+|[\/\\'"]+$/g, ''),
      xxlarge: S('.foundation-mq-xxlarge').css('font-family').replace(/^[\/\\'"]+|(;\s?})+|[\/\\'"]+$/g, '')
    },

    stylesheet : $('<style></style>').appendTo('head')[0].sheet,

    global: {
      namespace: undefined
    },

    init : function (scope, libraries, method, options, response) {
      var args = [scope, method, options, response],
          responses = [];

      // check RTL
      this.rtl = /rtl/i.test(S('html').attr('dir'));

      // set foundation global scope
      this.scope = scope || this.scope;

      this.set_namespace();

      if (libraries && typeof libraries === 'string' && !/reflow/i.test(libraries)) {
        if (this.libs.hasOwnProperty(libraries)) {
          responses.push(this.init_lib(libraries, args));
        }
      } else {
        for (var lib in this.libs) {
          responses.push(this.init_lib(lib, libraries));
        }
      }

      S(window).load(function(){
        S(window)
          .trigger('resize.fndtn.clearing')
          .trigger('resize.fndtn.dropdown')
          .trigger('resize.fndtn.equalizer')
          .trigger('resize.fndtn.interchange')
          .trigger('resize.fndtn.joyride')
          .trigger('resize.fndtn.magellan')
          .trigger('resize.fndtn.topbar')
          .trigger('resize.fndtn.slider');
      });

      return scope;
    },

    init_lib : function (lib, args) {
      if (this.libs.hasOwnProperty(lib)) {
        this.patch(this.libs[lib]);

        if (args && args.hasOwnProperty(lib)) {
            if (typeof this.libs[lib].settings !== 'undefined') {
                $.extend(true, this.libs[lib].settings, args[lib]);
            }
            else if (typeof this.libs[lib].defaults !== 'undefined') {
                $.extend(true, this.libs[lib].defaults, args[lib]);
            }
          return this.libs[lib].init.apply(this.libs[lib], [this.scope, args[lib]]);
        }

        args = args instanceof Array ? args : new Array(args);    // PATCH: added this line
        return this.libs[lib].init.apply(this.libs[lib], args);
      }

      return function () {};
    },

    patch : function (lib) {
      lib.scope = this.scope;
      lib.namespace = this.global.namespace;
      lib.rtl = this.rtl;
      lib['data_options'] = this.utils.data_options;
      lib['attr_name'] = attr_name;
      lib['add_namespace'] = add_namespace;
      lib['bindings'] = bindings;
      lib['S'] = this.utils.S;
    },

    inherit : function (scope, methods) {
      var methods_arr = methods.split(' '),
          i = methods_arr.length;

      while (i--) {
        if (this.utils.hasOwnProperty(methods_arr[i])) {
          scope[methods_arr[i]] = this.utils[methods_arr[i]];
        }
      }
    },

    set_namespace: function () {

      // Description:
      //    Don't bother reading the namespace out of the meta tag
      //    if the namespace has been set globally in javascript
      //
      // Example:
      //    Foundation.global.namespace = 'my-namespace';
      // or make it an empty string:
      //    Foundation.global.namespace = '';
      //
      //

      // If the namespace has not been set (is undefined), try to read it out of the meta element.
      // Otherwise use the globally defined namespace, even if it's empty ('')
      var namespace = ( this.global.namespace === undefined ) ? $('.foundation-data-attribute-namespace').css('font-family') : this.global.namespace;

      // Finally, if the namsepace is either undefined or false, set it to an empty string.
      // Otherwise use the namespace value.
      this.global.namespace = ( namespace === undefined || /false/i.test(namespace) ) ? '' : namespace;
    },

    libs : {},

    // methods that can be inherited in libraries
    utils : {

      // Description:
      //    Fast Selector wrapper returns jQuery object. Only use where getElementById
      //    is not available.
      //
      // Arguments:
      //    Selector (String): CSS selector describing the element(s) to be
      //    returned as a jQuery object.
      //
      //    Scope (String): CSS selector describing the area to be searched. Default
      //    is document.
      //
      // Returns:
      //    Element (jQuery Object): jQuery object containing elements matching the
      //    selector within the scope.
      S : S,

      // Description:
      //    Executes a function a max of once every n milliseconds
      //
      // Arguments:
      //    Func (Function): Function to be throttled.
      //
      //    Delay (Integer): Function execution threshold in milliseconds.
      //
      // Returns:
      //    Lazy_function (Function): Function with throttling applied.
      throttle : function (func, delay) {
        var timer = null;

        return function () {
          var context = this, args = arguments;

          if (timer == null) {
            timer = setTimeout(function () {
              func.apply(context, args);
              timer = null;
            }, delay);
          }
        };
      },

      // Description:
      //    Executes a function when it stops being invoked for n seconds
      //    Modified version of _.debounce() http://underscorejs.org
      //
      // Arguments:
      //    Func (Function): Function to be debounced.
      //
      //    Delay (Integer): Function execution threshold in milliseconds.
      //
      //    Immediate (Bool): Whether the function should be called at the beginning
      //    of the delay instead of the end. Default is false.
      //
      // Returns:
      //    Lazy_function (Function): Function with debouncing applied.
      debounce : function (func, delay, immediate) {
        var timeout, result;
        return function () {
          var context = this, args = arguments;
          var later = function () {
            timeout = null;
            if (!immediate) result = func.apply(context, args);
          };
          var callNow = immediate && !timeout;
          clearTimeout(timeout);
          timeout = setTimeout(later, delay);
          if (callNow) result = func.apply(context, args);
          return result;
        };
      },

      // Description:
      //    Parses data-options attribute
      //
      // Arguments:
      //    El (jQuery Object): Element to be parsed.
      //
      // Returns:
      //    Options (Javascript Object): Contents of the element's data-options
      //    attribute.
      data_options : function (el, data_attr_name) {
        data_attr_name = data_attr_name || 'options';
        var opts = {}, ii, p, opts_arr,
            data_options = function (el) {
              var namespace = Foundation.global.namespace;

              if (namespace.length > 0) {
                return el.data(namespace + '-' + data_attr_name);
              }

              return el.data(data_attr_name);
            };

        var cached_options = data_options(el);

        if (typeof cached_options === 'object') {
          return cached_options;
        }

        opts_arr = (cached_options || ':').split(';');
        ii = opts_arr.length;

        function isNumber (o) {
          return ! isNaN (o-0) && o !== null && o !== "" && o !== false && o !== true;
        }

        function trim (str) {
          if (typeof str === 'string') return $.trim(str);
          return str;
        }

        while (ii--) {
          p = opts_arr[ii].split(':');
          p = [p[0], p.slice(1).join(':')];

          if (/true/i.test(p[1])) p[1] = true;
          if (/false/i.test(p[1])) p[1] = false;
          if (isNumber(p[1])) {
            if (p[1].indexOf('.') === -1) {
              p[1] = parseInt(p[1], 10);
            } else {
              p[1] = parseFloat(p[1]);
            }
          }

          if (p.length === 2 && p[0].length > 0) {
            opts[trim(p[0])] = trim(p[1]);
          }
        }

        return opts;
      },

      // Description:
      //    Adds JS-recognizable media queries
      //
      // Arguments:
      //    Media (String): Key string for the media query to be stored as in
      //    Foundation.media_queries
      //
      //    Class (String): Class name for the generated <meta> tag
      register_media : function (media, media_class) {
        if(Foundation.media_queries[media] === undefined) {
          $('head').append('<meta class="' + media_class + '"/>');
          Foundation.media_queries[media] = removeQuotes($('.' + media_class).css('font-family'));
        }
      },

      // Description:
      //    Add custom CSS within a JS-defined media query
      //
      // Arguments:
      //    Rule (String): CSS rule to be appended to the document.
      //
      //    Media (String): Optional media query string for the CSS rule to be
      //    nested under.
      add_custom_rule : function (rule, media) {
        if (media === undefined && Foundation.stylesheet) {
          Foundation.stylesheet.insertRule(rule, Foundation.stylesheet.cssRules.length);
        } else {
          var query = Foundation.media_queries[media];

          if (query !== undefined) {
            Foundation.stylesheet.insertRule('@media ' +
              Foundation.media_queries[media] + '{ ' + rule + ' }');
          }
        }
      },

      // Description:
      //    Performs a callback function when an image is fully loaded
      //
      // Arguments:
      //    Image (jQuery Object): Image(s) to check if loaded.
      //
      //    Callback (Function): Function to execute when image is fully loaded.
      image_loaded : function (images, callback) {
        var self = this,
            unloaded = images.length;

        if (unloaded === 0) {
          callback(images);
        }

        images.each(function () {
          single_image_loaded(self.S(this), function () {
            unloaded -= 1;
            if (unloaded === 0) {
              callback(images);
            }
          });
        });
      },

      // Description:
      //    Returns a random, alphanumeric string
      //
      // Arguments:
      //    Length (Integer): Length of string to be generated. Defaults to random
      //    integer.
      //
      // Returns:
      //    Rand (String): Pseudo-random, alphanumeric string.
      random_str : function () {
        if (!this.fidx) this.fidx = 0;
        this.prefix = this.prefix || [(this.name || 'F'), (+new Date).toString(36)].join('-');

        return this.prefix + (this.fidx++).toString(36);
      }
    }
  };

  $.fn.foundation = function () {
    var args = Array.prototype.slice.call(arguments, 0);

    return this.each(function () {
      Foundation.init.apply(Foundation, [this].concat(args));
      return this;
    });
  };

}(jQuery, window, window.document));
;(function ($, window, document, undefined) {
  'use strict';

  Foundation.libs.slider = {
    name : 'slider',

    version : '5.4.6',

    settings: {
      start: 0,
      end: 100,
      step: 1,
      initial: null,
      display_selector: '',
      vertical: false,
      on_change: function(){}
    },

    cache : {},

    init : function (scope, method, options) {
      Foundation.inherit(this,'throttle');
      this.bindings(method, options);
      this.reflow();
    },

    events : function() {
      var self = this;

      $(this.scope)
        .off('.slider')
        .on('mousedown.fndtn.slider touchstart.fndtn.slider pointerdown.fndtn.slider',
        '[' + self.attr_name() + ']:not(.disabled, [disabled]) .range-slider-handle', function(e) {
          if (!self.cache.active) {
            e.preventDefault();
            self.set_active_slider($(e.target));
          }
        })
        .on('mousemove.fndtn.slider touchmove.fndtn.slider pointermove.fndtn.slider', function(e) {
          if (!!self.cache.active) {
            e.preventDefault();
            if ($.data(self.cache.active[0], 'settings').vertical) {
              var scroll_offset = 0;
              if (!e.pageY) {
                scroll_offset = window.scrollY;
              }
              self.calculate_position(self.cache.active, (e.pageY || 
                                                          e.originalEvent.clientY || 
                                                          e.originalEvent.touches[0].clientY || 
                                                          e.currentPoint.y) 
                                                          + scroll_offset);
            } else {
              self.calculate_position(self.cache.active, e.pageX || 
                                                         e.originalEvent.clientX || 
                                                         e.originalEvent.touches[0].clientX || 
                                                         e.currentPoint.x);
            }
          }
        })
        .on('mouseup.fndtn.slider touchend.fndtn.slider pointerup.fndtn.slider', function(e) {
          self.remove_active_slider();
        })
        .on('change.fndtn.slider', function(e) {
          self.settings.on_change();
        });

      self.S(window)
        .on('resize.fndtn.slider', self.throttle(function(e) {
          self.reflow();
        }, 300));
    },

    set_active_slider : function($handle) {
      this.cache.active = $handle;
    },

    remove_active_slider : function() {
      this.cache.active = null;
    },

    calculate_position : function($handle, cursor_x) {
      var self = this,
          settings = $.data($handle[0], 'settings'),
          handle_l = $.data($handle[0], 'handle_l'),
          handle_o = $.data($handle[0], 'handle_o'),
          bar_l = $.data($handle[0], 'bar_l'),
          bar_o = $.data($handle[0], 'bar_o');

      requestAnimationFrame(function(){
        var pct;

        if (Foundation.rtl && !settings.vertical) {
          pct = self.limit_to(((bar_o+bar_l-cursor_x)/bar_l),0,1);
        } else {
          pct = self.limit_to(((cursor_x-bar_o)/bar_l),0,1);
        }

        pct = settings.vertical ? 1-pct : pct;

        var norm = self.normalized_value(pct, settings.start, settings.end, settings.step);

        self.set_ui($handle, norm);
      });
    },

    set_ui : function($handle, value) {
      var settings = $.data($handle[0], 'settings'),
          handle_l = $.data($handle[0], 'handle_l'),
          bar_l = $.data($handle[0], 'bar_l'),
          norm_pct = this.normalized_percentage(value, settings.start, settings.end),
          handle_offset = norm_pct*(bar_l-handle_l)-1,
          progress_bar_length = norm_pct*100;

      if (Foundation.rtl && !settings.vertical) {
        handle_offset = -handle_offset;
      }

      handle_offset = settings.vertical ? -handle_offset + bar_l - handle_l + 1 : handle_offset;
      this.set_translate($handle, handle_offset, settings.vertical);

      if (settings.vertical) {
        $handle.siblings('.range-slider-active-segment').css('height', progress_bar_length + '%');
      } else {
        $handle.siblings('.range-slider-active-segment').css('width', progress_bar_length + '%');
      }

      $handle.parent().attr(this.attr_name(), value).trigger('change').trigger('change.fndtn.slider');

      $handle.parent().children('input[type=hidden]').val(value);

      if (!$handle[0].hasAttribute('aria-valuemin')) {
        $handle.attr({
          'aria-valuemin': settings.start,
          'aria-valuemax': settings.end,
        });
      }
      $handle.attr('aria-valuenow', value);

      if (settings.display_selector != '') {
        $(settings.display_selector).each(function(){
          if (this.hasOwnProperty('value')) {
            $(this).val(value);
          } else {
            $(this).text(value);
          }
        });
      }

    },

    normalized_percentage : function(val, start, end) {
      return Math.min(1, (val - start)/(end - start));
    },

    normalized_value : function(val, start, end, step) {
      var range = end - start,
          point = val*range,
          mod = (point-(point%step)) / step,
          rem = point % step,
          round = ( rem >= step*0.5 ? step : 0);
      return (mod*step + round) + start;
    },

    set_translate : function(ele, offset, vertical) {
      if (vertical) {
        $(ele)
          .css('-webkit-transform', 'translateY('+offset+'px)')
          .css('-moz-transform', 'translateY('+offset+'px)')
          .css('-ms-transform', 'translateY('+offset+'px)')
          .css('-o-transform', 'translateY('+offset+'px)')
          .css('transform', 'translateY('+offset+'px)');
      } else {
        $(ele)
          .css('-webkit-transform', 'translateX('+offset+'px)')
          .css('-moz-transform', 'translateX('+offset+'px)')
          .css('-ms-transform', 'translateX('+offset+'px)')
          .css('-o-transform', 'translateX('+offset+'px)')
          .css('transform', 'translateX('+offset+'px)');
      }
    },

    limit_to : function(val, min, max) {
      return Math.min(Math.max(val, min), max);
    },

    initialize_settings : function(handle) {
      var settings = $.extend({}, this.settings, this.data_options($(handle).parent()));

      if (settings.vertical) {
        $.data(handle, 'bar_o', $(handle).parent().offset().top);
        $.data(handle, 'bar_l', $(handle).parent().outerHeight());
        $.data(handle, 'handle_o', $(handle).offset().top);
        $.data(handle, 'handle_l', $(handle).outerHeight());
      } else {
        $.data(handle, 'bar_o', $(handle).parent().offset().left);
        $.data(handle, 'bar_l', $(handle).parent().outerWidth());
        $.data(handle, 'handle_o', $(handle).offset().left);
        $.data(handle, 'handle_l', $(handle).outerWidth());
      }

      $.data(handle, 'bar', $(handle).parent());
      $.data(handle, 'settings', settings);
    },

    set_initial_position : function($ele) {
      var settings = $.data($ele.children('.range-slider-handle')[0], 'settings'),
          initial = (!!settings.initial ? settings.initial : Math.floor((settings.end-settings.start)*0.5/settings.step)*settings.step+settings.start),
          $handle = $ele.children('.range-slider-handle');
      this.set_ui($handle, initial);
    },

    set_value : function(value) {
      var self = this;
      $('[' + self.attr_name() + ']', this.scope).each(function(){
        $(this).attr(self.attr_name(), value);
      });
      if (!!$(this.scope).attr(self.attr_name())) {
        $(this.scope).attr(self.attr_name(), value);
      }
      self.reflow();
    },

    reflow : function() {
      var self = this;
      self.S('[' + this.attr_name() + ']').each(function() {
        var handle = $(this).children('.range-slider-handle')[0],
            val = $(this).attr(self.attr_name());
        self.initialize_settings(handle);

        if (val) {
          self.set_ui($(handle), parseFloat(val));
        } else {
          self.set_initial_position($(this));
        }
      });
    }
  };

}(jQuery, window, window.document));
;(function ($, window, document, undefined) {
  'use strict';

  var Modernizr = Modernizr || false;

  Foundation.libs.joyride = {
    name : 'joyride',

    version : '5.4.6',

    defaults : {
      expose                   : false,     // turn on or off the expose feature
      modal                    : true,      // Whether to cover page with modal during the tour
      keyboard                 : true,      // enable left, right and esc keystrokes
      tip_location             : 'bottom',  // 'top' or 'bottom' in relation to parent
      nub_position             : 'auto',    // override on a per tooltip bases
      scroll_speed             : 1500,      // Page scrolling speed in milliseconds, 0 = no scroll animation
      scroll_animation         : 'linear',  // supports 'swing' and 'linear', extend with jQuery UI.
      timer                    : 0,         // 0 = no timer , all other numbers = timer in milliseconds
      start_timer_on_click     : true,      // true or false - true requires clicking the first button start the timer
      start_offset             : 0,         // the index of the tooltip you want to start on (index of the li)
      next_button              : true,      // true or false to control whether a next button is used
      prev_button              : true,      // true or false to control whether a prev button is used
      tip_animation            : 'fade',    // 'pop' or 'fade' in each tip
      pause_after              : [],        // array of indexes where to pause the tour after
      exposed                  : [],        // array of expose elements
      tip_animation_fade_speed : 300,       // when tipAnimation = 'fade' this is speed in milliseconds for the transition
      cookie_monster           : false,     // true or false to control whether cookies are used
      cookie_name              : 'joyride', // Name the cookie you'll use
      cookie_domain            : false,     // Will this cookie be attached to a domain, ie. '.notableapp.com'
      cookie_expires           : 365,       // set when you would like the cookie to expire.
      tip_container            : 'body',    // Where will the tip be attached
      abort_on_close           : true,      // When true, the close event will not fire any callback
      tip_location_patterns    : {
        top: ['bottom'],
        bottom: [], // bottom should not need to be repositioned
        left: ['right', 'top', 'bottom'],
        right: ['left', 'top', 'bottom']
      },
      post_ride_callback     : function (){},    // A method to call once the tour closes (canceled or complete)
      post_step_callback     : function (){},    // A method to call after each step
      pre_step_callback      : function (){},    // A method to call before each step
      pre_ride_callback      : function (){},    // A method to call before the tour starts (passed index, tip, and cloned exposed element)
      post_expose_callback   : function (){},    // A method to call after an element has been exposed
      template : { // HTML segments for tip layout
        link          : '<a href="#close" class="joyride-close-tip">&times;</a>',
        timer         : '<div class="joyride-timer-indicator-wrap"><span class="joyride-timer-indicator"></span></div>',
        tip           : '<div class="joyride-tip-guide"><span class="joyride-nub"></span></div>',
        wrapper       : '<div class="joyride-content-wrapper"></div>',
        button        : '<a href="#" class="small button joyride-next-tip"></a>',
        prev_button   : '<a href="#" class="small button joyride-prev-tip"></a>',
        modal         : '<div class="joyride-modal-bg"></div>',
        expose        : '<div class="joyride-expose-wrapper"></div>',
        expose_cover  : '<div class="joyride-expose-cover"></div>'
      },
      expose_add_class : '' // One or more space-separated class names to be added to exposed element
    },

    init : function (scope, method, options) {
      Foundation.inherit(this, 'throttle random_str');

      this.settings = this.settings || $.extend({}, this.defaults, (options || method));

      this.bindings(method, options)
    },

    go_next : function() {
      if (this.settings.$li.next().length < 1) {
        this.end();
      } else if (this.settings.timer > 0) {
        clearTimeout(this.settings.automate);
        this.hide();
        this.show();
        this.startTimer();
      } else {
        this.hide();
        this.show();
      }
    },

    go_prev : function() {
      if (this.settings.$li.prev().length < 1) {
        // Do nothing if there are no prev element
      } else if (this.settings.timer > 0) {
        clearTimeout(this.settings.automate);
        this.hide();
        this.show(null, true);
        this.startTimer();
      } else {
        this.hide();
        this.show(null, true);
      }
    },

    events : function () {
      var self = this;

      $(this.scope)
        .off('.joyride')
        .on('click.fndtn.joyride', '.joyride-next-tip, .joyride-modal-bg', function (e) {
          e.preventDefault();
          this.go_next()
        }.bind(this))
        .on('click.fndtn.joyride', '.joyride-prev-tip', function (e) {
          e.preventDefault();
          this.go_prev();
        }.bind(this))

        .on('click.fndtn.joyride', '.joyride-close-tip', function (e) {
          e.preventDefault();
          this.end(this.settings.abort_on_close);
        }.bind(this))

        .on("keyup.fndtn.joyride", function(e) {
          // Don't do anything if keystrokes are disabled
          // or if the joyride is not being shown
          if (!this.settings.keyboard || !this.settings.riding) return;

          switch (e.which) {
            case 39: // right arrow
              e.preventDefault();
              this.go_next();
              break;
            case 37: // left arrow
              e.preventDefault();
              this.go_prev();
              break;
            case 27: // escape
              e.preventDefault();
              this.end(this.settings.abort_on_close);
          }
        }.bind(this));

      $(window)
        .off('.joyride')
        .on('resize.fndtn.joyride', self.throttle(function () {
          if ($('[' + self.attr_name() + ']').length > 0 && self.settings.$next_tip && self.settings.riding) {
            if (self.settings.exposed.length > 0) {
              var $els = $(self.settings.exposed);

              $els.each(function () {
                var $this = $(this);
                self.un_expose($this);
                self.expose($this);
              });
            }

            if (self.is_phone()) {
              self.pos_phone();
            } else {
              self.pos_default(false);
            }
          }
        }, 100));
    },

    start : function () {
      var self = this,
          $this = $('[' + this.attr_name() + ']', this.scope),
          integer_settings = ['timer', 'scrollSpeed', 'startOffset', 'tipAnimationFadeSpeed', 'cookieExpires'],
          int_settings_count = integer_settings.length;

      if (!$this.length > 0) return;

      if (!this.settings.init) this.events();

      this.settings = $this.data(this.attr_name(true) + '-init');

      // non configureable settings
      this.settings.$content_el = $this;
      this.settings.$body = $(this.settings.tip_container);
      this.settings.body_offset = $(this.settings.tip_container).position();
      this.settings.$tip_content = this.settings.$content_el.find('> li');
      this.settings.paused = false;
      this.settings.attempts = 0;
      this.settings.riding = true;

      // can we create cookies?
      if (typeof $.cookie !== 'function') {
        this.settings.cookie_monster = false;
      }

      // generate the tips and insert into dom.
      if (!this.settings.cookie_monster || this.settings.cookie_monster && !$.cookie(this.settings.cookie_name)) {
        this.settings.$tip_content.each(function (index) {
          var $this = $(this);
          this.settings = $.extend({}, self.defaults, self.data_options($this));

          // Make sure that settings parsed from data_options are integers where necessary
          var i = int_settings_count;
          while (i--) {
            self.settings[integer_settings[i]] = parseInt(self.settings[integer_settings[i]], 10);
          }
          self.create({$li : $this, index : index});
        });

        // show first tip
        if (!this.settings.start_timer_on_click && this.settings.timer > 0) {
          this.show('init');
          this.startTimer();
        } else {
          this.show('init');
        }

      }
    },

    resume : function () {
      this.set_li();
      this.show();
    },

    tip_template : function (opts) {
      var $blank, content;

      opts.tip_class = opts.tip_class || '';

      $blank = $(this.settings.template.tip).addClass(opts.tip_class);
      content = $.trim($(opts.li).html()) +
        this.prev_button_text(opts.prev_button_text, opts.index) +
        this.button_text(opts.button_text) +
        this.settings.template.link +
        this.timer_instance(opts.index);

      $blank.append($(this.settings.template.wrapper));
      $blank.first().attr(this.add_namespace('data-index'), opts.index);
      $('.joyride-content-wrapper', $blank).append(content);

      return $blank[0];
    },

    timer_instance : function (index) {
      var txt;

      if ((index === 0 && this.settings.start_timer_on_click && this.settings.timer > 0) || this.settings.timer === 0) {
        txt = '';
      } else {
        txt = $(this.settings.template.timer)[0].outerHTML;
      }
      return txt;
    },

    button_text : function (txt) {
      if (this.settings.tip_settings.next_button) {
        txt = $.trim(txt) || 'Next';
        txt = $(this.settings.template.button).append(txt)[0].outerHTML;
      } else {
        txt = '';
      }
      return txt;
    },

    prev_button_text : function (txt, idx) {
      if (this.settings.tip_settings.prev_button) {
        txt = $.trim(txt) || 'Previous';

        // Add the disabled class to the button if it's the first element
        if (idx == 0)
          txt = $(this.settings.template.prev_button).append(txt).addClass('disabled')[0].outerHTML;
        else
          txt = $(this.settings.template.prev_button).append(txt)[0].outerHTML;
      } else {
        txt = '';
      }
      return txt;
    },

    create : function (opts) {
      this.settings.tip_settings = $.extend({}, this.settings, this.data_options(opts.$li));
      var buttonText = opts.$li.attr(this.add_namespace('data-button'))
        || opts.$li.attr(this.add_namespace('data-text')),
          prevButtonText = opts.$li.attr(this.add_namespace('data-button-prev'))
        || opts.$li.attr(this.add_namespace('data-prev-text')),
        tipClass = opts.$li.attr('class'),
        $tip_content = $(this.tip_template({
          tip_class : tipClass,
          index : opts.index,
          button_text : buttonText,
          prev_button_text : prevButtonText,
          li : opts.$li
        }));

      $(this.settings.tip_container).append($tip_content);
    },

    show : function (init, is_prev) {
      var $timer = null;

      // are we paused?
      if (this.settings.$li === undefined
        || ($.inArray(this.settings.$li.index(), this.settings.pause_after) === -1)) {

        // don't go to the next li if the tour was paused
        if (this.settings.paused) {
          this.settings.paused = false;
        } else {
          this.set_li(init, is_prev);
        }

        this.settings.attempts = 0;

        if (this.settings.$li.length && this.settings.$target.length > 0) {
          if (init) { //run when we first start
            this.settings.pre_ride_callback(this.settings.$li.index(), this.settings.$next_tip);
            if (this.settings.modal) {
              this.show_modal();
            }
          }

          this.settings.pre_step_callback(this.settings.$li.index(), this.settings.$next_tip);

          if (this.settings.modal && this.settings.expose) {
            this.expose();
          }

          this.settings.tip_settings = $.extend({}, this.settings, this.data_options(this.settings.$li));

          this.settings.timer = parseInt(this.settings.timer, 10);

          this.settings.tip_settings.tip_location_pattern = this.settings.tip_location_patterns[this.settings.tip_settings.tip_location];

          // scroll if not modal
          if (!/body/i.test(this.settings.$target.selector)) {
            this.scroll_to();
          }

          if (this.is_phone()) {
            this.pos_phone(true);
          } else {
            this.pos_default(true);
          }

          $timer = this.settings.$next_tip.find('.joyride-timer-indicator');

          if (/pop/i.test(this.settings.tip_animation)) {

            $timer.width(0);

            if (this.settings.timer > 0) {

              this.settings.$next_tip.show();

              setTimeout(function () {
                $timer.animate({
                  width: $timer.parent().width()
                }, this.settings.timer, 'linear');
              }.bind(this), this.settings.tip_animation_fade_speed);

            } else {
              this.settings.$next_tip.show();

            }


          } else if (/fade/i.test(this.settings.tip_animation)) {

            $timer.width(0);

            if (this.settings.timer > 0) {

              this.settings.$next_tip
                .fadeIn(this.settings.tip_animation_fade_speed)
                .show();

              setTimeout(function () {
                $timer.animate({
                  width: $timer.parent().width()
                }, this.settings.timer, 'linear');
              }.bind(this), this.settings.tip_animation_fade_speed);

            } else {
              this.settings.$next_tip.fadeIn(this.settings.tip_animation_fade_speed);
            }
          }

          this.settings.$current_tip = this.settings.$next_tip;

        // skip non-existant targets
        } else if (this.settings.$li && this.settings.$target.length < 1) {

          this.show(init, is_prev);

        } else {

          this.end();

        }
      } else {

        this.settings.paused = true;

      }

    },

    is_phone : function () {
      return matchMedia(Foundation.media_queries.small).matches &&
        !matchMedia(Foundation.media_queries.medium).matches;
    },

    hide : function () {
      if (this.settings.modal && this.settings.expose) {
        this.un_expose();
      }

      if (!this.settings.modal) {
        $('.joyride-modal-bg').hide();
      }

      // Prevent scroll bouncing...wait to remove from layout
      this.settings.$current_tip.css('visibility', 'hidden');
      setTimeout($.proxy(function() {
        this.hide();
        this.css('visibility', 'visible');
      }, this.settings.$current_tip), 0);
      this.settings.post_step_callback(this.settings.$li.index(),
        this.settings.$current_tip);
    },

    set_li : function (init, is_prev) {
      if (init) {
        this.settings.$li = this.settings.$tip_content.eq(this.settings.start_offset);
        this.set_next_tip();
        this.settings.$current_tip = this.settings.$next_tip;
      } else {
        if (is_prev)
          this.settings.$li = this.settings.$li.prev();
        else
          this.settings.$li = this.settings.$li.next();
        this.set_next_tip();
      }

      this.set_target();
    },

    set_next_tip : function () {
      this.settings.$next_tip = $(".joyride-tip-guide").eq(this.settings.$li.index());
      this.settings.$next_tip.data('closed', '');
    },

    set_target : function () {
      var cl = this.settings.$li.attr(this.add_namespace('data-class')),
          id = this.settings.$li.attr(this.add_namespace('data-id')),
          $sel = function () {
            if (id) {
              return $(document.getElementById(id));
            } else if (cl) {
              return $('.' + cl).first();
            } else {
              return $('body');
            }
          };

      this.settings.$target = $sel();
    },

    scroll_to : function () {
      var window_half, tipOffset;

      window_half = $(window).height() / 2;
      tipOffset = Math.ceil(this.settings.$target.offset().top - window_half + this.settings.$next_tip.outerHeight());

      if (tipOffset != 0) {
        $('html, body').stop().animate({
          scrollTop: tipOffset
        }, this.settings.scroll_speed, 'swing');
      }
    },

    paused : function () {
      return ($.inArray((this.settings.$li.index() + 1), this.settings.pause_after) === -1);
    },

    restart : function () {
      this.hide();
      this.settings.$li = undefined;
      this.show('init');
    },

    pos_default : function (init) {
      var $nub = this.settings.$next_tip.find('.joyride-nub'),
          nub_width = Math.ceil($nub.outerWidth() / 2),
          nub_height = Math.ceil($nub.outerHeight() / 2),
          toggle = init || false;

      // tip must not be "display: none" to calculate position
      if (toggle) {
        this.settings.$next_tip.css('visibility', 'hidden');
        this.settings.$next_tip.show();
      }

      if (!/body/i.test(this.settings.$target.selector)) {
      	  var topAdjustment = this.settings.tip_settings.tipAdjustmentY ? parseInt(this.settings.tip_settings.tipAdjustmentY) : 0,
			        leftAdjustment = this.settings.tip_settings.tipAdjustmentX ? parseInt(this.settings.tip_settings.tipAdjustmentX) : 0;

          if (this.bottom()) {
            if (this.rtl) {
              this.settings.$next_tip.css({
                top: (this.settings.$target.offset().top + nub_height + this.settings.$target.outerHeight() + topAdjustment),
                left: this.settings.$target.offset().left + this.settings.$target.outerWidth() - this.settings.$next_tip.outerWidth() + leftAdjustment});
            } else {
              this.settings.$next_tip.css({
                top: (this.settings.$target.offset().top + nub_height + this.settings.$target.outerHeight() + topAdjustment),
                left: this.settings.$target.offset().left + leftAdjustment});
            }

            this.nub_position($nub, this.settings.tip_settings.nub_position, 'top');

          } else if (this.top()) {
            if (this.rtl) {
              this.settings.$next_tip.css({
                top: (this.settings.$target.offset().top - this.settings.$next_tip.outerHeight() - nub_height + topAdjustment),
                left: this.settings.$target.offset().left + this.settings.$target.outerWidth() - this.settings.$next_tip.outerWidth()});
            } else {
              this.settings.$next_tip.css({
                top: (this.settings.$target.offset().top - this.settings.$next_tip.outerHeight() - nub_height + topAdjustment),
                left: this.settings.$target.offset().left + leftAdjustment});
            }

            this.nub_position($nub, this.settings.tip_settings.nub_position, 'bottom');

          } else if (this.right()) {

            this.settings.$next_tip.css({
              top: this.settings.$target.offset().top + topAdjustment,
              left: (this.settings.$target.outerWidth() + this.settings.$target.offset().left + nub_width + leftAdjustment)});

            this.nub_position($nub, this.settings.tip_settings.nub_position, 'left');

          } else if (this.left()) {

            this.settings.$next_tip.css({
              top: this.settings.$target.offset().top + topAdjustment,
              left: (this.settings.$target.offset().left - this.settings.$next_tip.outerWidth() - nub_width + leftAdjustment)});

            this.nub_position($nub, this.settings.tip_settings.nub_position, 'right');

          }

          if (!this.visible(this.corners(this.settings.$next_tip)) && this.settings.attempts < this.settings.tip_settings.tip_location_pattern.length) {

            $nub.removeClass('bottom')
              .removeClass('top')
              .removeClass('right')
              .removeClass('left');

            this.settings.tip_settings.tip_location = this.settings.tip_settings.tip_location_pattern[this.settings.attempts];

            this.settings.attempts++;

            this.pos_default();

          }

      } else if (this.settings.$li.length) {

        this.pos_modal($nub);

      }

      if (toggle) {
        this.settings.$next_tip.hide();
        this.settings.$next_tip.css('visibility', 'visible');
      }

    },

    pos_phone : function (init) {
      var tip_height = this.settings.$next_tip.outerHeight(),
          tip_offset = this.settings.$next_tip.offset(),
          target_height = this.settings.$target.outerHeight(),
          $nub = $('.joyride-nub', this.settings.$next_tip),
          nub_height = Math.ceil($nub.outerHeight() / 2),
          toggle = init || false;

      $nub.removeClass('bottom')
        .removeClass('top')
        .removeClass('right')
        .removeClass('left');

      if (toggle) {
        this.settings.$next_tip.css('visibility', 'hidden');
        this.settings.$next_tip.show();
      }

      if (!/body/i.test(this.settings.$target.selector)) {

        if (this.top()) {

            this.settings.$next_tip.offset({top: this.settings.$target.offset().top - tip_height - nub_height});
            $nub.addClass('bottom');

        } else {

          this.settings.$next_tip.offset({top: this.settings.$target.offset().top + target_height + nub_height});
          $nub.addClass('top');

        }

      } else if (this.settings.$li.length) {
        this.pos_modal($nub);
      }

      if (toggle) {
        this.settings.$next_tip.hide();
        this.settings.$next_tip.css('visibility', 'visible');
      }
    },

    pos_modal : function ($nub) {
      this.center();
      $nub.hide();

      this.show_modal();
    },

    show_modal : function () {
      if (!this.settings.$next_tip.data('closed')) {
        var joyridemodalbg =  $('.joyride-modal-bg');
        if (joyridemodalbg.length < 1) {
          $('body').append(this.settings.template.modal).show();
        }

        if (/pop/i.test(this.settings.tip_animation)) {
            joyridemodalbg.show();
        } else {
            joyridemodalbg.fadeIn(this.settings.tip_animation_fade_speed);
        }
      }
    },

    expose : function () {
      var expose,
          exposeCover,
          el,
          origCSS,
          origClasses,
          randId = 'expose-' + this.random_str(6);

      if (arguments.length > 0 && arguments[0] instanceof $) {
        el = arguments[0];
      } else if(this.settings.$target && !/body/i.test(this.settings.$target.selector)){
        el = this.settings.$target;
      }  else {
        return false;
      }

      if(el.length < 1){
        if(window.console){
          console.error('element not valid', el);
        }
        return false;
      }

      expose = $(this.settings.template.expose);
      this.settings.$body.append(expose);
      expose.css({
        top: el.offset().top,
        left: el.offset().left,
        width: el.outerWidth(true),
        height: el.outerHeight(true)
      });

      exposeCover = $(this.settings.template.expose_cover);

      origCSS = {
        zIndex: el.css('z-index'),
        position: el.css('position')
      };

      origClasses = el.attr('class') == null ? '' : el.attr('class');

      el.css('z-index',parseInt(expose.css('z-index'))+1);

      if (origCSS.position == 'static') {
        el.css('position','relative');
      }

      el.data('expose-css',origCSS);
      el.data('orig-class', origClasses);
      el.attr('class', origClasses + ' ' + this.settings.expose_add_class);

      exposeCover.css({
        top: el.offset().top,
        left: el.offset().left,
        width: el.outerWidth(true),
        height: el.outerHeight(true)
      });

      if (this.settings.modal) this.show_modal();

      this.settings.$body.append(exposeCover);
      expose.addClass(randId);
      exposeCover.addClass(randId);
      el.data('expose', randId);
      this.settings.post_expose_callback(this.settings.$li.index(), this.settings.$next_tip, el);
      this.add_exposed(el);
    },

    un_expose : function () {
      var exposeId,
          el,
          expose ,
          origCSS,
          origClasses,
          clearAll = false;

      if (arguments.length > 0 && arguments[0] instanceof $) {
        el = arguments[0];
      } else if(this.settings.$target && !/body/i.test(this.settings.$target.selector)){
        el = this.settings.$target;
      }  else {
        return false;
      }

      if(el.length < 1){
        if (window.console) {
          console.error('element not valid', el);
        }
        return false;
      }

      exposeId = el.data('expose');
      expose = $('.' + exposeId);

      if (arguments.length > 1) {
        clearAll = arguments[1];
      }

      if (clearAll === true) {
        $('.joyride-expose-wrapper,.joyride-expose-cover').remove();
      } else {
        expose.remove();
      }

      origCSS = el.data('expose-css');

      if (origCSS.zIndex == 'auto') {
        el.css('z-index', '');
      } else {
        el.css('z-index', origCSS.zIndex);
      }

      if (origCSS.position != el.css('position')) {
        if(origCSS.position == 'static') {// this is default, no need to set it.
          el.css('position', '');
        } else {
          el.css('position', origCSS.position);
        }
      }

      origClasses = el.data('orig-class');
      el.attr('class', origClasses);
      el.removeData('orig-classes');

      el.removeData('expose');
      el.removeData('expose-z-index');
      this.remove_exposed(el);
    },

    add_exposed: function(el){
      this.settings.exposed = this.settings.exposed || [];
      if (el instanceof $ || typeof el === 'object') {
        this.settings.exposed.push(el[0]);
      } else if (typeof el == 'string') {
        this.settings.exposed.push(el);
      }
    },

    remove_exposed: function(el){
      var search, i;
      if (el instanceof $) {
        search = el[0]
      } else if (typeof el == 'string'){
        search = el;
      }

      this.settings.exposed = this.settings.exposed || [];
      i = this.settings.exposed.length;

      while (i--) {
        if (this.settings.exposed[i] == search) {
          this.settings.exposed.splice(i, 1);
          return;
        }
      }
    },

    center : function () {
      var $w = $(window);

      this.settings.$next_tip.css({
        top : ((($w.height() - this.settings.$next_tip.outerHeight()) / 2) + $w.scrollTop()),
        left : ((($w.width() - this.settings.$next_tip.outerWidth()) / 2) + $w.scrollLeft())
      });

      return true;
    },

    bottom : function () {
      return /bottom/i.test(this.settings.tip_settings.tip_location);
    },

    top : function () {
      return /top/i.test(this.settings.tip_settings.tip_location);
    },

    right : function () {
      return /right/i.test(this.settings.tip_settings.tip_location);
    },

    left : function () {
      return /left/i.test(this.settings.tip_settings.tip_location);
    },

    corners : function (el) {
      var w = $(window),
          window_half = w.height() / 2,
          //using this to calculate since scroll may not have finished yet.
          tipOffset = Math.ceil(this.settings.$target.offset().top - window_half + this.settings.$next_tip.outerHeight()),
          right = w.width() + w.scrollLeft(),
          offsetBottom =  w.height() + tipOffset,
          bottom = w.height() + w.scrollTop(),
          top = w.scrollTop();

      if (tipOffset < top) {
        if (tipOffset < 0) {
          top = 0;
        } else {
          top = tipOffset;
        }
      }

      if (offsetBottom > bottom) {
        bottom = offsetBottom;
      }

      return [
        el.offset().top < top,
        right < el.offset().left + el.outerWidth(),
        bottom < el.offset().top + el.outerHeight(),
        w.scrollLeft() > el.offset().left
      ];
    },

    visible : function (hidden_corners) {
      var i = hidden_corners.length;

      while (i--) {
        if (hidden_corners[i]) return false;
      }

      return true;
    },

    nub_position : function (nub, pos, def) {
      if (pos === 'auto') {
        nub.addClass(def);
      } else {
        nub.addClass(pos);
      }
    },

    startTimer : function () {
      if (this.settings.$li.length) {
        this.settings.automate = setTimeout(function () {
          this.hide();
          this.show();
          this.startTimer();
        }.bind(this), this.settings.timer);
      } else {
        clearTimeout(this.settings.automate);
      }
    },

    end : function (abort) {
      if (this.settings.cookie_monster) {
        $.cookie(this.settings.cookie_name, 'ridden', { expires: this.settings.cookie_expires, domain: this.settings.cookie_domain });
      }

      if (this.settings.timer > 0) {
        clearTimeout(this.settings.automate);
      }

      if (this.settings.modal && this.settings.expose) {
        this.un_expose();
      }

      // Unplug keystrokes listener
      $(this.scope).off('keyup.joyride')

      this.settings.$next_tip.data('closed', true);
      this.settings.riding = false;

      $('.joyride-modal-bg').hide();
      this.settings.$current_tip.hide();

      if (typeof abort === 'undefined' || abort === false) {
        this.settings.post_step_callback(this.settings.$li.index(), this.settings.$current_tip);
        this.settings.post_ride_callback(this.settings.$li.index(), this.settings.$current_tip);
      }

      $('.joyride-tip-guide').remove();
    },

    off : function () {
      $(this.scope).off('.joyride');
      $(window).off('.joyride');
      $('.joyride-close-tip, .joyride-next-tip, .joyride-modal-bg').off('.joyride');
      $('.joyride-tip-guide, .joyride-modal-bg').remove();
      clearTimeout(this.settings.automate);
      this.settings = {};
    },

    reflow : function () {}
  };
}(jQuery, window, window.document));
;(function ($, window, document, undefined) {
  'use strict';

  Foundation.libs.equalizer = {
    name : 'equalizer',

    version : '5.4.6',

    settings : {
      use_tallest: true,
      before_height_change: $.noop,
      after_height_change: $.noop,
      equalize_on_stack: false
    },

    init : function (scope, method, options) {
      Foundation.inherit(this, 'image_loaded');
      this.bindings(method, options);
      this.reflow();
    },

    events : function () {
      this.S(window).off('.equalizer').on('resize.fndtn.equalizer', function(e){
        this.reflow();
      }.bind(this));
    },

    equalize: function(equalizer) {
      var isStacked = false,
          vals = equalizer.find('[' + this.attr_name() + '-watch]:visible'),
          settings = equalizer.data(this.attr_name(true)+'-init');

      if (vals.length === 0) return;
      var firstTopOffset = vals.first().offset().top;
      settings.before_height_change();
      equalizer.trigger('before-height-change').trigger('before-height-change.fndth.equalizer');
      vals.height('inherit');
      vals.each(function(){
        var el = $(this);
        if (el.offset().top !== firstTopOffset) {
          isStacked = true;
        }
      });

      if (settings.equalize_on_stack === false) {
        if (isStacked) return;
      };

      var heights = vals.map(function(){ return $(this).outerHeight(false) }).get();

      if (settings.use_tallest) {
        var max = Math.max.apply(null, heights);
        vals.css('height', max);
      } else {
        var min = Math.min.apply(null, heights);
        vals.css('height', min);
      }
      settings.after_height_change();
      equalizer.trigger('after-height-change').trigger('after-height-change.fndtn.equalizer');
    },

    reflow : function () {
      var self = this;

      this.S('[' + this.attr_name() + ']', this.scope).each(function(){
        var $eq_target = $(this);
        self.image_loaded(self.S('img', this), function(){
          self.equalize($eq_target)
        });
      });
    }
  };
})(jQuery, window, window.document);

;(function ($, window, document, undefined) {
  'use strict';

  Foundation.libs.dropdown = {
    name : 'dropdown',

    version : '5.4.6',

    settings : {
      active_class: 'open',
      disabled_class: 'disabled',
      mega_class: 'mega',
      align: 'bottom',
      is_hover: false,
      opened: function(){},
      closed: function(){}
    },

    init : function (scope, method, options) {
      Foundation.inherit(this, 'throttle');

      this.bindings(method, options);
    },

    events : function (scope) {
      var self = this,
          S = self.S;

      S(this.scope)
        .off('.dropdown')
        .on('click.fndtn.dropdown', '[' + this.attr_name() + ']', function (e) {
          var settings = S(this).data(self.attr_name(true) + '-init') || self.settings;
          if (!settings.is_hover || Modernizr.touch) {
            e.preventDefault();
            self.toggle($(this));
          }
        })
        .on('mouseenter.fndtn.dropdown', '[' + this.attr_name() + '], [' + this.attr_name() + '-content]', function (e) {
          var $this = S(this),
              dropdown,
              target;

          clearTimeout(self.timeout);

          if ($this.data(self.data_attr())) {
            dropdown = S('#' + $this.data(self.data_attr()));
            target = $this;
          } else {
            dropdown = $this;
            target = S("[" + self.attr_name() + "='" + dropdown.attr('id') + "']");
          }

          var settings = target.data(self.attr_name(true) + '-init') || self.settings;

          if(S(e.target).data(self.data_attr()) && settings.is_hover) {
            self.closeall.call(self);
          }

          if (settings.is_hover) self.open.apply(self, [dropdown, target]);
        })
        .on('mouseleave.fndtn.dropdown', '[' + this.attr_name() + '], [' + this.attr_name() + '-content]', function (e) {
          var $this = S(this);
          self.timeout = setTimeout(function () {
            if ($this.data(self.data_attr())) {
              var settings = $this.data(self.data_attr(true) + '-init') || self.settings;
              if (settings.is_hover) self.close.call(self, S('#' + $this.data(self.data_attr())));
            } else {
              var target   = S('[' + self.attr_name() + '="' + S(this).attr('id') + '"]'),
                  settings = target.data(self.attr_name(true) + '-init') || self.settings;
              if (settings.is_hover) self.close.call(self, $this);
            }
          }.bind(this), 150);
        })
        .on('click.fndtn.dropdown', function (e) {
          var parent = S(e.target).closest('[' + self.attr_name() + '-content]');

          if (S(e.target).closest('[' + self.attr_name() + ']').length > 0) {
            return;
          }
          if (!(S(e.target).data('revealId')) &&
            (parent.length > 0 && (S(e.target).is('[' + self.attr_name() + '-content]') ||
              $.contains(parent.first()[0], e.target)))) {
            e.stopPropagation();
            return;
          }

          self.close.call(self, S('[' + self.attr_name() + '-content]'));
        })
        .on('opened.fndtn.dropdown', '[' + self.attr_name() + '-content]', function () {
            self.settings.opened.call(this);
        })
        .on('closed.fndtn.dropdown', '[' + self.attr_name() + '-content]', function () {
            self.settings.closed.call(this);
        });

      S(window)
        .off('.dropdown')
        .on('resize.fndtn.dropdown', self.throttle(function () {
          self.resize.call(self);
        }, 50));

      this.resize();
    },

    close: function (dropdown) {
      var self = this;
      dropdown.each(function () {
        var original_target = $('[' + self.attr_name() + '=' + dropdown[0].id + ']') || $('aria-controls=' + dropdown[0].id+ ']');
        original_target.attr('aria-expanded', "false");
        if (self.S(this).hasClass(self.settings.active_class)) {
          self.S(this)
            .css(Foundation.rtl ? 'right':'left', '-99999px')
            .attr('aria-hidden', "true")
            .removeClass(self.settings.active_class)
            .prev('[' + self.attr_name() + ']')
            .removeClass(self.settings.active_class)
            .removeData('target');

          self.S(this).trigger('closed').trigger('closed.fndtn.dropdown', [dropdown]);
        }
      });
    },

    closeall: function() {
      var self = this;
      $.each(self.S('[' + this.attr_name() + '-content]'), function() {
        self.close.call(self, self.S(this));
      });
    },

    open: function (dropdown, target) {
        this
          .css(dropdown
            .addClass(this.settings.active_class), target);
        dropdown.prev('[' + this.attr_name() + ']').addClass(this.settings.active_class);
        dropdown.data('target', target.get(0)).trigger('opened').trigger('opened.fndtn.dropdown', [dropdown, target]);
        dropdown.attr('aria-hidden', 'false');
        target.attr('aria-expanded', 'true');
        dropdown.focus();
    },

    data_attr: function () {
      if (this.namespace.length > 0) {
        return this.namespace + '-' + this.name;
      }

      return this.name;
    },

    toggle : function (target) {
      if (target.hasClass(this.settings.disabled_class)) {
        return;
      }
      var dropdown = this.S('#' + target.data(this.data_attr()));
      if (dropdown.length === 0) {
        // No dropdown found, not continuing
        return;
      }

      this.close.call(this, this.S('[' + this.attr_name() + '-content]').not(dropdown));

      if (dropdown.hasClass(this.settings.active_class)) {
        this.close.call(this, dropdown);
        if (dropdown.data('target') !== target.get(0))
          this.open.call(this, dropdown, target);
      } else {
        this.open.call(this, dropdown, target);
      }
    },

    resize : function () {
      var dropdown = this.S('[' + this.attr_name() + '-content].open'),
          target = this.S("[" + this.attr_name() + "='" + dropdown.attr('id') + "']");

      if (dropdown.length && target.length) {
        this.css(dropdown, target);
      }
    },

    css : function (dropdown, target) {
      var left_offset = Math.max((target.width() - dropdown.width()) / 2, 8),
          settings = target.data(this.attr_name(true) + '-init') || this.settings;

      this.clear_idx();

      if (this.small()) {
        var p = this.dirs.bottom.call(dropdown, target, settings);

        dropdown.attr('style', '').removeClass('drop-left drop-right drop-top').css({
          position : 'absolute',
          width: '95%',
          'max-width': 'none',
          top: p.top
        });

        dropdown.css(Foundation.rtl ? 'right':'left', left_offset);
      } else {

        this.style(dropdown, target, settings);
      }

      return dropdown;
    },

    style : function (dropdown, target, settings) {
      var css = $.extend({position: 'absolute'},
        this.dirs[settings.align].call(dropdown, target, settings));

      dropdown.attr('style', '').css(css);
    },

    // return CSS property object
    // `this` is the dropdown
    dirs : {
      // Calculate target offset
      _base : function (t) {
        var o_p = this.offsetParent(),
            o = o_p.offset(),
            p = t.offset();

        p.top -= o.top;
        p.left -= o.left;

        return p;
      },
      top: function (t, s) {
        var self = Foundation.libs.dropdown,
            p = self.dirs._base.call(this, t);

        this.addClass('drop-top');

        if (t.outerWidth() < this.outerWidth() || self.small() || this.hasClass(s.mega_menu)) {
          self.adjust_pip(this,t,s,p);
        }

        if (Foundation.rtl) {
          return {left: p.left - this.outerWidth() + t.outerWidth(),
            top: p.top - this.outerHeight()};
        }

        return {left: p.left, top: p.top - this.outerHeight()};
      },
      bottom: function (t,s) {
        var self = Foundation.libs.dropdown,
            p = self.dirs._base.call(this, t);

        if (t.outerWidth() < this.outerWidth() || self.small() || this.hasClass(s.mega_menu)) {
          self.adjust_pip(this,t,s,p);
        }

        if (self.rtl) {
          return {left: p.left - this.outerWidth() + t.outerWidth(), top: p.top + t.outerHeight()};
        }

        return {left: p.left, top: p.top + t.outerHeight()};
      },
      left: function (t, s) {
        var p = Foundation.libs.dropdown.dirs._base.call(this, t);

        this.addClass('drop-left');

        return {left: p.left - this.outerWidth(), top: p.top};
      },
      right: function (t, s) {
        var p = Foundation.libs.dropdown.dirs._base.call(this, t);

        this.addClass('drop-right');

        return {left: p.left + t.outerWidth(), top: p.top};
      }
    },

    // Insert rule to style psuedo elements
    adjust_pip : function (dropdown,target,settings,position) {
      var sheet = Foundation.stylesheet,
          pip_offset_base = 8;

      if (dropdown.hasClass(settings.mega_class)) {
        pip_offset_base = position.left + (target.outerWidth()/2) - 8;
      }
      else if (this.small()) {
        pip_offset_base += position.left - 8;
      }

      this.rule_idx = sheet.cssRules.length;

      var sel_before = '.f-dropdown.open:before',
          sel_after  = '.f-dropdown.open:after',
          css_before = 'left: ' + pip_offset_base + 'px;',
          css_after  = 'left: ' + (pip_offset_base - 1) + 'px;';

      if (sheet.insertRule) {
        sheet.insertRule([sel_before, '{', css_before, '}'].join(' '), this.rule_idx);
        sheet.insertRule([sel_after, '{', css_after, '}'].join(' '), this.rule_idx + 1);
      } else {
        sheet.addRule(sel_before, css_before, this.rule_idx);
        sheet.addRule(sel_after, css_after, this.rule_idx + 1);
      }
    },

    // Remove old dropdown rule index
    clear_idx : function () {
      var sheet = Foundation.stylesheet;

      if (this.rule_idx) {
        sheet.deleteRule(this.rule_idx);
        sheet.deleteRule(this.rule_idx);
        delete this.rule_idx;
      }
    },

    small : function () {
      return matchMedia(Foundation.media_queries.small).matches &&
        !matchMedia(Foundation.media_queries.medium).matches;
    },

    off: function () {
      this.S(this.scope).off('.fndtn.dropdown');
      this.S('html, body').off('.fndtn.dropdown');
      this.S(window).off('.fndtn.dropdown');
      this.S('[data-dropdown-content]').off('.fndtn.dropdown');
    },

    reflow : function () {}
  };
}(jQuery, window, window.document));
;(function ($, window, document, undefined) {
  'use strict';

  Foundation.libs.clearing = {
    name : 'clearing',

    version: '5.4.6',

    settings : {
      templates : {
        viewing : '<a href="#" class="clearing-close">&times;</a>' +
          '<div class="visible-img" style="display: none"><div class="clearing-touch-label"></div><img src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs%3D" alt="" />' +
          '<p class="clearing-caption"></p><a href="#" class="clearing-main-prev"><span></span></a>' +
          '<a href="#" class="clearing-main-next"><span></span></a></div>'
      },

      // comma delimited list of selectors that, on click, will close clearing,
      // add 'div.clearing-blackout, div.visible-img' to close on background click
      close_selectors : '.clearing-close, div.clearing-blackout', 

      // Default to the entire li element.
      open_selectors : '',

      // Image will be skipped in carousel.
      skip_selector : '',

      touch_label : '',

      // event initializers and locks
      init : false,
      locked : false
    },

    init : function (scope, method, options) {
      var self = this;
      Foundation.inherit(this, 'throttle image_loaded');

      this.bindings(method, options);

      if (self.S(this.scope).is('[' + this.attr_name() + ']')) {
        this.assemble(self.S('li', this.scope));
      } else {
        self.S('[' + this.attr_name() + ']', this.scope).each(function () {
          self.assemble(self.S('li', this));
        });
      }
    },

    events : function (scope) {
      var self = this,
          S = self.S,
          $scroll_container = $('.scroll-container');

      if ($scroll_container.length > 0) {
        this.scope = $scroll_container;
      }

      S(this.scope)
        .off('.clearing')
        .on('click.fndtn.clearing', 'ul[' + this.attr_name() + '] li ' + this.settings.open_selectors,
          function (e, current, target) {
            var current = current || S(this),
                target = target || current,
                next = current.next('li'),
                settings = current.closest('[' + self.attr_name() + ']').data(self.attr_name(true) + '-init'),
                image = S(e.target);

            e.preventDefault();

            if (!settings) {
              self.init();
              settings = current.closest('[' + self.attr_name() + ']').data(self.attr_name(true) + '-init');
            }

            // if clearing is open and the current image is
            // clicked, go to the next image in sequence
            if (target.hasClass('visible') &&
              current[0] === target[0] &&
              next.length > 0 && self.is_open(current)) {
              target = next;
              image = S('img', target);
            }

            // set current and target to the clicked li if not otherwise defined.
            self.open(image, current, target);
            self.update_paddles(target);
          })

        .on('click.fndtn.clearing', '.clearing-main-next',
          function (e) { self.nav(e, 'next') })
        .on('click.fndtn.clearing', '.clearing-main-prev',
          function (e) { self.nav(e, 'prev') })
        .on('click.fndtn.clearing', this.settings.close_selectors,
          function (e) { Foundation.libs.clearing.close(e, this) });

      $(document).on('keydown.fndtn.clearing',
          function (e) { self.keydown(e) });

      S(window).off('.clearing').on('resize.fndtn.clearing',
        function () { self.resize() });

      this.swipe_events(scope);
    },

    swipe_events : function (scope) {
      var self = this,
      S = self.S;

      S(this.scope)
        .on('touchstart.fndtn.clearing', '.visible-img', function(e) {
          if (!e.touches) { e = e.originalEvent; }
          var data = {
                start_page_x: e.touches[0].pageX,
                start_page_y: e.touches[0].pageY,
                start_time: (new Date()).getTime(),
                delta_x: 0,
                is_scrolling: undefined
              };

          S(this).data('swipe-transition', data);
          e.stopPropagation();
        })
        .on('touchmove.fndtn.clearing', '.visible-img', function(e) {
          if (!e.touches) { e = e.originalEvent; }
          // Ignore pinch/zoom events
          if(e.touches.length > 1 || e.scale && e.scale !== 1) return;

          var data = S(this).data('swipe-transition');

          if (typeof data === 'undefined') {
            data = {};
          }

          data.delta_x = e.touches[0].pageX - data.start_page_x;

          if (Foundation.rtl) {
            data.delta_x = -data.delta_x;
          }

          if (typeof data.is_scrolling === 'undefined') {
            data.is_scrolling = !!( data.is_scrolling || Math.abs(data.delta_x) < Math.abs(e.touches[0].pageY - data.start_page_y) );
          }

          if (!data.is_scrolling && !data.active) {
            e.preventDefault();
            var direction = (data.delta_x < 0) ? 'next' : 'prev';
            data.active = true;
            self.nav(e, direction);
          }
        })
        .on('touchend.fndtn.clearing', '.visible-img', function(e) {
          S(this).data('swipe-transition', {});
          e.stopPropagation();
        });
    },

    assemble : function ($li) {
      var $el = $li.parent();

      if ($el.parent().hasClass('carousel')) {
        return;
      }
      
      $el.after('<div id="foundationClearingHolder"></div>');

      var grid = $el.detach(),
          grid_outerHTML = '';

      if (grid[0] == null) {
        return;
      } else {
        grid_outerHTML = grid[0].outerHTML;
      }
      
      var holder = this.S('#foundationClearingHolder'),
          settings = $el.data(this.attr_name(true) + '-init'),
          data = {
            grid: '<div class="carousel">' + grid_outerHTML + '</div>',
            viewing: settings.templates.viewing
          },
          wrapper = '<div class="clearing-assembled"><div>' + data.viewing +
            data.grid + '</div></div>',
          touch_label = this.settings.touch_label;

      if (Modernizr.touch) {
        wrapper = $(wrapper).find('.clearing-touch-label').html(touch_label).end();
      }

      holder.after(wrapper).remove();
    },

    open : function ($image, current, target) {
      var self = this,
          body = $(document.body),
          root = target.closest('.clearing-assembled'),
          container = self.S('div', root).first(),
          visible_image = self.S('.visible-img', container),
          image = self.S('img', visible_image).not($image),
          label = self.S('.clearing-touch-label', container),
          error = false;

      // Event to disable scrolling on touch devices when Clearing is activated
      $('body').on('touchmove',function(e){
        e.preventDefault();
      });

      image.error(function () {
        error = true;
      });

      function startLoad() {
        setTimeout(function () {
          this.image_loaded(image, function () {
            if (image.outerWidth() === 1 && !error) {
              startLoad.call(this);
            } else {
              cb.call(this, image);
            }
          }.bind(this));
        }.bind(this), 100);
      }

      function cb (image) {
        var $image = $(image);
        $image.css('visibility', 'visible');
        // toggle the gallery
        body.css('overflow', 'hidden');
        root.addClass('clearing-blackout');
        container.addClass('clearing-container');
        visible_image.show();
        this.fix_height(target)
          .caption(self.S('.clearing-caption', visible_image), self.S('img', target))
          .center_and_label(image, label)
          .shift(current, target, function () {
            target.closest('li').siblings().removeClass('visible');
            target.closest('li').addClass('visible');
          });
        visible_image.trigger('opened.fndtn.clearing')
      }

      if (!this.locked()) {
        visible_image.trigger('open.fndtn.clearing');
        // set the image to the selected thumbnail
        image
          .attr('src', this.load($image))
          .css('visibility', 'hidden');

        startLoad.call(this);
      }
    },

    close : function (e, el) {
      e.preventDefault();

      var root = (function (target) {
            if (/blackout/.test(target.selector)) {
              return target;
            } else {
              return target.closest('.clearing-blackout');
            }
          }($(el))),
          body = $(document.body), container, visible_image;

      if (el === e.target && root) {
        body.css('overflow', '');
        container = $('div', root).first();
        visible_image = $('.visible-img', container);
        visible_image.trigger('close.fndtn.clearing');
        this.settings.prev_index = 0;
        $('ul[' + this.attr_name() + ']', root)
          .attr('style', '').closest('.clearing-blackout')
          .removeClass('clearing-blackout');
        container.removeClass('clearing-container');
        visible_image.hide();
        visible_image.trigger('closed.fndtn.clearing');        
      }

      // Event to re-enable scrolling on touch devices
      $('body').off('touchmove');

      return false;
    },

    is_open : function (current) {
      return current.parent().prop('style').length > 0;
    },

    keydown : function (e) {
      var clearing = $('.clearing-blackout ul[' + this.attr_name() + ']'),
          NEXT_KEY = this.rtl ? 37 : 39,
          PREV_KEY = this.rtl ? 39 : 37,
          ESC_KEY = 27;

      if (e.which === NEXT_KEY) this.go(clearing, 'next');
      if (e.which === PREV_KEY) this.go(clearing, 'prev');
      if (e.which === ESC_KEY) this.S('a.clearing-close').trigger('click').trigger('click.fndtn.clearing');
    },

    nav : function (e, direction) {
      var clearing = $('ul[' + this.attr_name() + ']', '.clearing-blackout');

      e.preventDefault();
      this.go(clearing, direction);
    },

    resize : function () {
      var image = $('img', '.clearing-blackout .visible-img'),
          label = $('.clearing-touch-label', '.clearing-blackout');

      if (image.length) {
        this.center_and_label(image, label);
        image.trigger('resized.fndtn.clearing')
      }
    },

    // visual adjustments
    fix_height : function (target) {
      var lis = target.parent().children(),
          self = this;

      lis.each(function () {
        var li = self.S(this),
            image = li.find('img');

        if (li.height() > image.outerHeight()) {
          li.addClass('fix-height');
        }
      })
      .closest('ul')
      .width(lis.length * 100 + '%');

      return this;
    },

    update_paddles : function (target) {
      target = target.closest('li');
      var visible_image = target
        .closest('.carousel')
        .siblings('.visible-img');

      if (target.next().length > 0) {
        this.S('.clearing-main-next', visible_image).removeClass('disabled');
      } else {
        this.S('.clearing-main-next', visible_image).addClass('disabled');
      }

      if (target.prev().length > 0) {
        this.S('.clearing-main-prev', visible_image).removeClass('disabled');
      } else {
        this.S('.clearing-main-prev', visible_image).addClass('disabled');
      }
    },

    center_and_label : function (target, label) {
      if (!this.rtl) {
        target.css({
          marginLeft : -(target.outerWidth() / 2),
          marginTop : -(target.outerHeight() / 2)
        });

        if (label.length > 0) {
          label.css({
            marginLeft : -(label.outerWidth() / 2),
            marginTop : -(target.outerHeight() / 2)-label.outerHeight()-10
          });
        }
      } else {
        target.css({
          marginRight : -(target.outerWidth() / 2),
          marginTop : -(target.outerHeight() / 2),
          left: 'auto',
          right: '50%'
        });

        if (label.length > 0) {
          label.css({
            marginRight : -(label.outerWidth() / 2),
            marginTop : -(target.outerHeight() / 2)-label.outerHeight()-10,
            left: 'auto',
            right: '50%'
          });
        }
      }
      return this;
    },

    // image loading and preloading

    load : function ($image) {
      var href;

      if ($image[0].nodeName === "A") {
        href = $image.attr('href');
      } else {
        href = $image.parent().attr('href');
      }

      this.preload($image);

      if (href) return href;
      return $image.attr('src');
    },

    preload : function ($image) {
      this
        .img($image.closest('li').next())
        .img($image.closest('li').prev());
    },

    img : function (img) {
      if (img.length) {
        var new_img = new Image(),
            new_a = this.S('a', img);

        if (new_a.length) {
          new_img.src = new_a.attr('href');
        } else {
          new_img.src = this.S('img', img).attr('src');
        }
      }
      return this;
    },

    // image caption

    caption : function (container, $image) {
      var caption = $image.attr('data-caption');

      if (caption) {
        container
          .html(caption)
          .show();
      } else {
        container
          .text('')
          .hide();
      }
      return this;
    }, 

    // directional methods

    go : function ($ul, direction) {
      var current = this.S('.visible', $ul),
          target = current[direction]();

      // Check for skip selector.
      if (this.settings.skip_selector && target.find(this.settings.skip_selector).length != 0) {
        target = target[direction]();
      }

      if (target.length) {
        this.S('img', target)
          .trigger('click', [current, target]).trigger('click.fndtn.clearing', [current, target])
          .trigger('change.fndtn.clearing');
      }
    },

    shift : function (current, target, callback) {
      var clearing = target.parent(),
          old_index = this.settings.prev_index || target.index(),
          direction = this.direction(clearing, current, target),
          dir = this.rtl ? 'right' : 'left',
          left = parseInt(clearing.css('left'), 10),
          width = target.outerWidth(),
          skip_shift;

      var dir_obj = {};

      // we use jQuery animate instead of CSS transitions because we
      // need a callback to unlock the next animation
      // needs support for RTL **
      if (target.index() !== old_index && !/skip/.test(direction)){
        if (/left/.test(direction)) {
          this.lock();
          dir_obj[dir] = left + width;
          clearing.animate(dir_obj, 300, this.unlock());
        } else if (/right/.test(direction)) {
          this.lock();
          dir_obj[dir] = left - width;
          clearing.animate(dir_obj, 300, this.unlock());
        }
      } else if (/skip/.test(direction)) {
        // the target image is not adjacent to the current image, so
        // do we scroll right or not
        skip_shift = target.index() - this.settings.up_count;
        this.lock();

        if (skip_shift > 0) {
          dir_obj[dir] = -(skip_shift * width);
          clearing.animate(dir_obj, 300, this.unlock());
        } else {
          dir_obj[dir] = 0;
          clearing.animate(dir_obj, 300, this.unlock());
        }
      }

      callback();
    },

    direction : function ($el, current, target) {
      var lis = this.S('li', $el),
          li_width = lis.outerWidth() + (lis.outerWidth() / 4),
          up_count = Math.floor(this.S('.clearing-container').outerWidth() / li_width) - 1,
          target_index = lis.index(target),
          response;

      this.settings.up_count = up_count;

      if (this.adjacent(this.settings.prev_index, target_index)) {
        if ((target_index > up_count) && target_index > this.settings.prev_index) {
          response = 'right';
        } else if ((target_index > up_count - 1) && target_index <= this.settings.prev_index) {
          response = 'left';
        } else {
          response = false;
        }
      } else {
        response = 'skip';
      }

      this.settings.prev_index = target_index;

      return response;
    },

    adjacent : function (current_index, target_index) {
      for (var i = target_index + 1; i >= target_index - 1; i--) {
        if (i === current_index) return true;
      }
      return false;
    },

    // lock management

    lock : function () {
      this.settings.locked = true;
    },

    unlock : function () {
      this.settings.locked = false;
    },

    locked : function () {
      return this.settings.locked;
    },

    off : function () {
      this.S(this.scope).off('.fndtn.clearing');
      this.S(window).off('.fndtn.clearing');
    },

    reflow : function () {
      this.init();
    }
  };

}(jQuery, window, window.document));
;(function ($, window, document, undefined) {
  'use strict';

  var noop = function() {};

  var Orbit = function(el, settings) {
    // Don't reinitialize plugin
    if (el.hasClass(settings.slides_container_class)) {
      return this;
    }

    var self = this,
        container,
        slides_container = el,
        number_container,
        bullets_container,
        timer_container,
        idx = 0,
        animate,
        timer,
        locked = false,
        adjust_height_after = false;


    self.slides = function() {
      return slides_container.children(settings.slide_selector);
    };

    self.slides().first().addClass(settings.active_slide_class);

    self.update_slide_number = function(index) {
      if (settings.slide_number) {
        number_container.find('span:first').text(parseInt(index)+1);
        number_container.find('span:last').text(self.slides().length);
      }
      if (settings.bullets) {
        bullets_container.children().removeClass(settings.bullets_active_class);
        $(bullets_container.children().get(index)).addClass(settings.bullets_active_class);
      }
    };

    self.update_active_link = function(index) {
      var link = $('[data-orbit-link="'+self.slides().eq(index).attr('data-orbit-slide')+'"]');
      link.siblings().removeClass(settings.bullets_active_class);
      link.addClass(settings.bullets_active_class);
    };

    self.build_markup = function() {
      slides_container.wrap('<div class="'+settings.container_class+'"></div>');
      container = slides_container.parent();
      slides_container.addClass(settings.slides_container_class);

      if (settings.stack_on_small) {
        container.addClass(settings.stack_on_small_class);
      }

      if (settings.navigation_arrows) {
        container.append($('<a href="#"><span></span></a>').addClass(settings.prev_class));
        container.append($('<a href="#"><span></span></a>').addClass(settings.next_class));
      }

      if (settings.timer) {
        timer_container = $('<div>').addClass(settings.timer_container_class);
        timer_container.append('<span>');
        timer_container.append($('<div>').addClass(settings.timer_progress_class));
        timer_container.addClass(settings.timer_paused_class);
        container.append(timer_container);
      }

      if (settings.slide_number) {
        number_container = $('<div>').addClass(settings.slide_number_class);
        number_container.append('<span></span> ' + settings.slide_number_text + ' <span></span>');
        container.append(number_container);
      }

      if (settings.bullets) {
        bullets_container = $('<ol>').addClass(settings.bullets_container_class);
        container.append(bullets_container);
        bullets_container.wrap('<div class="orbit-bullets-container"></div>');
        self.slides().each(function(idx, el) {
          var bullet = $('<li>').attr('data-orbit-slide', idx).on('click', self.link_bullet);;
          bullets_container.append(bullet);
        });
      }

    };

    self._goto = function(next_idx, start_timer) {
      // if (locked) {return false;}
      if (next_idx === idx) {return false;}
      if (typeof timer === 'object') {timer.restart();}
      var slides = self.slides();

      var dir = 'next';
      locked = true;
      if (next_idx < idx) {dir = 'prev';}
      if (next_idx >= slides.length) {
        if (!settings.circular) return false;
        next_idx = 0;
      } else if (next_idx < 0) {
        if (!settings.circular) return false;
        next_idx = slides.length - 1;
      }

      var current = $(slides.get(idx));
      var next = $(slides.get(next_idx));

      current.css('zIndex', 2);
      current.removeClass(settings.active_slide_class);
      next.css('zIndex', 4).addClass(settings.active_slide_class);

      slides_container.trigger('before-slide-change.fndtn.orbit');
      settings.before_slide_change();
      self.update_active_link(next_idx);

      var callback = function() {
        var unlock = function() {
          idx = next_idx;
          locked = false;
          if (start_timer === true) {timer = self.create_timer(); timer.start();}
          self.update_slide_number(idx);
          slides_container.trigger('after-slide-change.fndtn.orbit',[{slide_number: idx, total_slides: slides.length}]);
          settings.after_slide_change(idx, slides.length);
        };
        if (slides_container.height() != next.height() && settings.variable_height) {
          slides_container.animate({'height': next.height()}, 250, 'linear', unlock);
        } else {
          unlock();
        }
      };

      if (slides.length === 1) {callback(); return false;}

      var start_animation = function() {
        if (dir === 'next') {animate.next(current, next, callback);}
        if (dir === 'prev') {animate.prev(current, next, callback);}
      };

      if (next.height() > slides_container.height() && settings.variable_height) {
        slides_container.animate({'height': next.height()}, 250, 'linear', start_animation);
      } else {
        start_animation();
      }
    };

    self.next = function(e) {
      e.stopImmediatePropagation();
      e.preventDefault();
      self._goto(idx + 1);
    };

    self.prev = function(e) {
      e.stopImmediatePropagation();
      e.preventDefault();
      self._goto(idx - 1);
    };

    self.link_custom = function(e) {
      e.preventDefault();
      var link = $(this).attr('data-orbit-link');
      if ((typeof link === 'string') && (link = $.trim(link)) != "") {
        var slide = container.find('[data-orbit-slide='+link+']');
        if (slide.index() != -1) {self._goto(slide.index());}
      }
    };

    self.link_bullet = function(e) {
      var index = $(this).attr('data-orbit-slide');
      if ((typeof index === 'string') && (index = $.trim(index)) != "") {
        if(isNaN(parseInt(index)))
        {
          var slide = container.find('[data-orbit-slide='+index+']');
          if (slide.index() != -1) {self._goto(slide.index() + 1);}
        }
        else
        {
          self._goto(parseInt(index));
        }
      }

    }

    self.timer_callback = function() {
      self._goto(idx + 1, true);
    }

    self.compute_dimensions = function() {
      var current = $(self.slides().get(idx));
      var h = current.height();
      if (!settings.variable_height) {
        self.slides().each(function(){
          if ($(this).height() > h) { h = $(this).height(); }
        });
      }
      slides_container.height(h);
    };

    self.create_timer = function() {
      var t = new Timer(
        container.find('.'+settings.timer_container_class),
        settings,
        self.timer_callback
      );
      return t;
    };

    self.stop_timer = function() {
      if (typeof timer === 'object') timer.stop();
    };

    self.toggle_timer = function() {
      var t = container.find('.'+settings.timer_container_class);
      if (t.hasClass(settings.timer_paused_class)) {
        if (typeof timer === 'undefined') {timer = self.create_timer();}
        timer.start();
      }
      else {
        if (typeof timer === 'object') {timer.stop();}
      }
    };

    self.init = function() {
      self.build_markup();
      if (settings.timer) {
        timer = self.create_timer();
        Foundation.utils.image_loaded(this.slides().children('img'), timer.start);
      }
      animate = new FadeAnimation(settings, slides_container);
      if (settings.animation === 'slide')
        animate = new SlideAnimation(settings, slides_container);

      container.on('click', '.'+settings.next_class, self.next);
      container.on('click', '.'+settings.prev_class, self.prev);

      if (settings.next_on_click) {
        container.on('click', '.'+settings.slides_container_class+' [data-orbit-slide]', self.link_bullet);
      }

      container.on('click', self.toggle_timer);
      if (settings.swipe) {
        container.on('touchstart.fndtn.orbit', function(e) {
          if (!e.touches) {e = e.originalEvent;}
          var data = {
            start_page_x: e.touches[0].pageX,
            start_page_y: e.touches[0].pageY,
            start_time: (new Date()).getTime(),
            delta_x: 0,
            is_scrolling: undefined
          };
          container.data('swipe-transition', data);
          e.stopPropagation();
        })
        .on('touchmove.fndtn.orbit', function(e) {
          if (!e.touches) { e = e.originalEvent; }
          // Ignore pinch/zoom events
          if(e.touches.length > 1 || e.scale && e.scale !== 1) return;

          var data = container.data('swipe-transition');
          if (typeof data === 'undefined') {data = {};}

          data.delta_x = e.touches[0].pageX - data.start_page_x;

          if ( typeof data.is_scrolling === 'undefined') {
            data.is_scrolling = !!( data.is_scrolling || Math.abs(data.delta_x) < Math.abs(e.touches[0].pageY - data.start_page_y) );
          }

          if (!data.is_scrolling && !data.active) {
            e.preventDefault();
            var direction = (data.delta_x < 0) ? (idx+1) : (idx-1);
            data.active = true;
            self._goto(direction);
          }
        })
        .on('touchend.fndtn.orbit', function(e) {
          container.data('swipe-transition', {});
          e.stopPropagation();
        })
      }
      container.on('mouseenter.fndtn.orbit', function(e) {
        if (settings.timer && settings.pause_on_hover) {
          self.stop_timer();
        }
      })
      .on('mouseleave.fndtn.orbit', function(e) {
        if (settings.timer && settings.resume_on_mouseout) {
          timer.start();
        }
      });

      $(document).on('click', '[data-orbit-link]', self.link_custom);
      $(window).on('load resize', self.compute_dimensions);
      Foundation.utils.image_loaded(this.slides().children('img'), self.compute_dimensions);
      Foundation.utils.image_loaded(this.slides().children('img'), function() {
        container.prev('.'+settings.preloader_class).css('display', 'none');
        self.update_slide_number(0);
        self.update_active_link(0);
        slides_container.trigger('ready.fndtn.orbit');
      });
    };

    self.init();
  };

  var Timer = function(el, settings, callback) {
    var self = this,
        duration = settings.timer_speed,
        progress = el.find('.'+settings.timer_progress_class),
        start,
        timeout,
        left = -1;

    this.update_progress = function(w) {
      var new_progress = progress.clone();
      new_progress.attr('style', '');
      new_progress.css('width', w+'%');
      progress.replaceWith(new_progress);
      progress = new_progress;
    };

    this.restart = function() {
      clearTimeout(timeout);
      el.addClass(settings.timer_paused_class);
      left = -1;
      self.update_progress(0);
    };

    this.start = function() {
      if (!el.hasClass(settings.timer_paused_class)) {return true;}
      left = (left === -1) ? duration : left;
      el.removeClass(settings.timer_paused_class);
      start = new Date().getTime();
      progress.animate({'width': '100%'}, left, 'linear');
      timeout = setTimeout(function() {
        self.restart();
        callback();
      }, left);
      el.trigger('timer-started.fndtn.orbit')
    };

    this.stop = function() {
      if (el.hasClass(settings.timer_paused_class)) {return true;}
      clearTimeout(timeout);
      el.addClass(settings.timer_paused_class);
      var end = new Date().getTime();
      left = left - (end - start);
      var w = 100 - ((left / duration) * 100);
      self.update_progress(w);
      el.trigger('timer-stopped.fndtn.orbit');
    };
  };

  var SlideAnimation = function(settings, container) {
    var duration = settings.animation_speed;
    var is_rtl = ($('html[dir=rtl]').length === 1);
    var margin = is_rtl ? 'marginRight' : 'marginLeft';
    var animMargin = {};
    animMargin[margin] = '0%';

    this.next = function(current, next, callback) {
      current.animate({marginLeft:'-100%'}, duration);
      next.animate(animMargin, duration, function() {
        current.css(margin, '100%');
        callback();
      });
    };

    this.prev = function(current, prev, callback) {
      current.animate({marginLeft:'100%'}, duration);
      prev.css(margin, '-100%');
      prev.animate(animMargin, duration, function() {
        current.css(margin, '100%');
        callback();
      });
    };
  };

  var FadeAnimation = function(settings, container) {
    var duration = settings.animation_speed;
    var is_rtl = ($('html[dir=rtl]').length === 1);
    var margin = is_rtl ? 'marginRight' : 'marginLeft';

    this.next = function(current, next, callback) {
      next.css({'margin':'0%', 'opacity':'0.01'});
      next.animate({'opacity':'1'}, duration, 'linear', function() {
        current.css('margin', '100%');
        callback();
      });
    };

    this.prev = function(current, prev, callback) {
      prev.css({'margin':'0%', 'opacity':'0.01'});
      prev.animate({'opacity':'1'}, duration, 'linear', function() {
        current.css('margin', '100%');
        callback();
      });
    };
  };


  Foundation.libs = Foundation.libs || {};

  Foundation.libs.orbit = {
    name: 'orbit',

    version: '5.4.6',

    settings: {
      animation: 'slide',
      timer_speed: 10000,
      pause_on_hover: true,
      resume_on_mouseout: false,
      next_on_click: true,
      animation_speed: 500,
      stack_on_small: false,
      navigation_arrows: true,
      slide_number: true,
      slide_number_text: 'of',
      container_class: 'orbit-container',
      stack_on_small_class: 'orbit-stack-on-small',
      next_class: 'orbit-next',
      prev_class: 'orbit-prev',
      timer_container_class: 'orbit-timer',
      timer_paused_class: 'paused',
      timer_progress_class: 'orbit-progress',
      slides_container_class: 'orbit-slides-container',
      preloader_class: 'preloader',
      slide_selector: '*',
      bullets_container_class: 'orbit-bullets',
      bullets_active_class: 'active',
      slide_number_class: 'orbit-slide-number',
      caption_class: 'orbit-caption',
      active_slide_class: 'active',
      orbit_transition_class: 'orbit-transitioning',
      bullets: true,
      circular: true,
      timer: true,
      variable_height: false,
      swipe: true,
      before_slide_change: noop,
      after_slide_change: noop
    },

    init : function (scope, method, options) {
      var self = this;
      this.bindings(method, options);
    },

    events : function (instance) {
      var orbit_instance = new Orbit(this.S(instance), this.S(instance).data('orbit-init'));
      this.S(instance).data(this.name + '-instance', orbit_instance);
    },

    reflow : function () {
      var self = this;

      if (self.S(self.scope).is('[data-orbit]')) {
        var $el = self.S(self.scope);
        var instance = $el.data(self.name + '-instance');
        instance.compute_dimensions();
      } else {
        self.S('[data-orbit]', self.scope).each(function(idx, el) {
          var $el = self.S(el);
          var opts = self.data_options($el);
          var instance = $el.data(self.name + '-instance');
          instance.compute_dimensions();
        });
      }
    }
  };


}(jQuery, window, window.document));
;(function ($, window, document, undefined) {
  'use strict';

  Foundation.libs.offcanvas = {
    name : 'offcanvas',

    version : '5.4.6',

    settings : {
      open_method: 'move',
      close_on_click: false
    },

    init : function (scope, method, options) {
      this.bindings(method, options);
    },

    events : function () {
      var self = this,
          S = self.S,
          move_class = '',
          right_postfix = '',
          left_postfix = '';

      if (this.settings.open_method === 'move') {
        move_class = 'move-';
        right_postfix = 'right';
        left_postfix = 'left';
      } else if (this.settings.open_method === 'overlap_single') {
        move_class = 'offcanvas-overlap-';
        right_postfix = 'right';
        left_postfix = 'left';
      } else if (this.settings.open_method === 'overlap') {
        move_class = 'offcanvas-overlap';
      }

      S(this.scope).off('.offcanvas')
        .on('click.fndtn.offcanvas', '.left-off-canvas-toggle', function (e) {
          self.click_toggle_class(e, move_class + right_postfix);
          if (self.settings.open_method !== 'overlap'){
            S(".left-submenu").removeClass(move_class + right_postfix);
          }
          $('.left-off-canvas-toggle').attr('aria-expanded', 'true');
        })
        .on('click.fndtn.offcanvas', '.left-off-canvas-menu a', function (e) {
          var settings = self.get_settings(e);
          var parent = S(this).parent();

          if(settings.close_on_click && !parent.hasClass("has-submenu") && !parent.hasClass("back")){
            self.hide.call(self, move_class + right_postfix, self.get_wrapper(e));
            parent.parent().removeClass(move_class + right_postfix);
          }else if(S(this).parent().hasClass("has-submenu")){
            e.preventDefault();
            S(this).siblings(".left-submenu").toggleClass(move_class + right_postfix);
          }else if(parent.hasClass("back")){
            e.preventDefault();
            parent.parent().removeClass(move_class + right_postfix);
          }
          $('.left-off-canvas-toggle').attr('aria-expanded', 'true');
        })
        .on('click.fndtn.offcanvas', '.right-off-canvas-toggle', function (e) {
          self.click_toggle_class(e, move_class + left_postfix);
          if (self.settings.open_method !== 'overlap'){
            S(".right-submenu").removeClass(move_class + left_postfix);
          }
          $('.right-off-canvas-toggle').attr('aria-expanded', 'true');
        })
        .on('click.fndtn.offcanvas', '.right-off-canvas-menu a', function (e) {
          var settings = self.get_settings(e);
          var parent = S(this).parent();

          if(settings.close_on_click && !parent.hasClass("has-submenu") && !parent.hasClass("back")){
            self.hide.call(self, move_class + left_postfix, self.get_wrapper(e));
            parent.parent().removeClass(move_class + left_postfix);
          }else if(S(this).parent().hasClass("has-submenu")){
            e.preventDefault();
            S(this).siblings(".right-submenu").toggleClass(move_class + left_postfix);
          }else if(parent.hasClass("back")){
            e.preventDefault();
            parent.parent().removeClass(move_class + left_postfix);
          }
          $('.right-off-canvas-toggle').attr('aria-expanded', 'true');
        })
        .on('click.fndtn.offcanvas', '.exit-off-canvas', function (e) {
          self.click_remove_class(e, move_class + left_postfix);
          S(".right-submenu").removeClass(move_class + left_postfix);
          if (right_postfix){
            self.click_remove_class(e, move_class + right_postfix);
            S(".left-submenu").removeClass(move_class + left_postfix);
          }
          $('.right-off-canvas-toggle').attr('aria-expanded', 'true');
        })
        .on('click.fndtn.offcanvas', '.exit-off-canvas', function (e) {
          self.click_remove_class(e, move_class + left_postfix);
          $('.left-off-canvas-toggle').attr('aria-expanded', 'false');
          if (right_postfix) {
            self.click_remove_class(e, move_class + right_postfix);
            $('.right-off-canvas-toggle').attr('aria-expanded', "false");
          }
        });
    },

    toggle: function(class_name, $off_canvas) {
      $off_canvas = $off_canvas || this.get_wrapper();
      if ($off_canvas.is('.' + class_name)) {
        this.hide(class_name, $off_canvas);
      } else {
        this.show(class_name, $off_canvas);
      }
    },

    show: function(class_name, $off_canvas) {
      $off_canvas = $off_canvas || this.get_wrapper();
      $off_canvas.trigger('open').trigger('open.fndtn.offcanvas');
      $off_canvas.addClass(class_name);
    },

    hide: function(class_name, $off_canvas) {
      $off_canvas = $off_canvas || this.get_wrapper();
      $off_canvas.trigger('close').trigger('close.fndtn.offcanvas');
      $off_canvas.removeClass(class_name);
    },

    click_toggle_class: function(e, class_name) {
      e.preventDefault();
      var $off_canvas = this.get_wrapper(e);
      this.toggle(class_name, $off_canvas);
    },

    click_remove_class: function(e, class_name) {
      e.preventDefault();
      var $off_canvas = this.get_wrapper(e);
      this.hide(class_name, $off_canvas);
    },

    get_settings: function(e) {
      var offcanvas  = this.S(e.target).closest('[' + this.attr_name() + ']');
      return offcanvas.data(this.attr_name(true) + '-init') || this.settings;
    },

    get_wrapper: function(e) {
      var $off_canvas = this.S(e ? e.target : this.scope).closest('.off-canvas-wrap');

      if ($off_canvas.length === 0) {
        $off_canvas = this.S('.off-canvas-wrap');
      }
      return $off_canvas;
    },

    reflow : function () {}
  };
}(jQuery, window, window.document));
;(function ($, window, document, undefined) {
  'use strict';

  Foundation.libs.alert = {
    name : 'alert',

    version : '5.4.6',

    settings : {
      callback: function (){}
    },

    init : function (scope, method, options) {
      this.bindings(method, options);
    },

    events : function () {
      var self = this,
          S = this.S;

      $(this.scope).off('.alert').on('click.fndtn.alert', '[' + this.attr_name() + '] .close', function (e) {
          var alertBox = S(this).closest('[' + self.attr_name() + ']'),
              settings = alertBox.data(self.attr_name(true) + '-init') || self.settings;

        e.preventDefault();
        if (Modernizr.csstransitions) {
          alertBox.addClass("alert-close");
          alertBox.on('transitionend webkitTransitionEnd oTransitionEnd', function(e) {
            S(this).trigger('close').trigger('close.fndtn.alert').remove();
            settings.callback();
          });
        } else {
          alertBox.fadeOut(300, function () {
            S(this).trigger('close').trigger('close.fndtn.alert').remove();
            settings.callback();
          });
        }
      });
    },

    reflow : function () {}
  };
}(jQuery, window, window.document));
;(function ($, window, document, undefined) {
  'use strict';

  Foundation.libs.reveal = {
    name : 'reveal',

    version : '5.4.6',

    locked : false,

    settings : {
      animation: 'fadeAndPop',
      animation_speed: 250,
      close_on_background_click: true,
      close_on_esc: true,
      dismiss_modal_class: 'close-reveal-modal',
      bg_class: 'reveal-modal-bg',
      root_element: 'body',
      open: function(){},
      opened: function(){},
      close: function(){},
      closed: function(){},
      bg : $('.reveal-modal-bg'),
      css : {
        open : {
          'opacity': 0,
          'visibility': 'visible',
          'display' : 'block'
        },
        close : {
          'opacity': 1,
          'visibility': 'hidden',
          'display': 'none'
        }
      }
    },

    init : function (scope, method, options) {
      $.extend(true, this.settings, method, options);
      this.bindings(method, options);
    },

    events : function (scope) {
      var self = this,
          S = self.S;

      S(this.scope)
        .off('.reveal')
        .on('click.fndtn.reveal', '[' + this.add_namespace('data-reveal-id') + ']:not([disabled])', function (e) {
          e.preventDefault();
        
          if (!self.locked) {
            var element = S(this),
                ajax = element.data(self.data_attr('reveal-ajax'));

            self.locked = true;

            if (typeof ajax === 'undefined') {
              self.open.call(self, element);
            } else {
              var url = ajax === true ? element.attr('href') : ajax;

              self.open.call(self, element, {url: url});
            }
          }
        });

      S(document)
        .on('click.fndtn.reveal', this.close_targets(), function (e) {

          e.preventDefault();

          if (!self.locked) {
            var settings = S('[' + self.attr_name() + '].open').data(self.attr_name(true) + '-init'),
                bg_clicked = S(e.target)[0] === S('.' + settings.bg_class)[0];

            if (bg_clicked) {
              if (settings.close_on_background_click) {
                e.stopPropagation();
              } else {
                return;
              }
            }

            self.locked = true;
            self.close.call(self, bg_clicked ? S('[' + self.attr_name() + '].open') : S(this).closest('[' + self.attr_name() + ']'));
          }
        });

      if(S('[' + self.attr_name() + ']', this.scope).length > 0) {
        S(this.scope)
          // .off('.reveal')
          .on('open.fndtn.reveal', this.settings.open)
          .on('opened.fndtn.reveal', this.settings.opened)
          .on('opened.fndtn.reveal', this.open_video)
          .on('close.fndtn.reveal', this.settings.close)
          .on('closed.fndtn.reveal', this.settings.closed)
          .on('closed.fndtn.reveal', this.close_video);
      } else {
        S(this.scope)
          // .off('.reveal')
          .on('open.fndtn.reveal', '[' + self.attr_name() + ']', this.settings.open)
          .on('opened.fndtn.reveal', '[' + self.attr_name() + ']', this.settings.opened)
          .on('opened.fndtn.reveal', '[' + self.attr_name() + ']', this.open_video)
          .on('close.fndtn.reveal', '[' + self.attr_name() + ']', this.settings.close)
          .on('closed.fndtn.reveal', '[' + self.attr_name() + ']', this.settings.closed)
          .on('closed.fndtn.reveal', '[' + self.attr_name() + ']', this.close_video);
      }

      return true;
    },

    // PATCH #3: turning on key up capture only when a reveal window is open
    key_up_on : function (scope) {
      var self = this;

      // PATCH #1: fixing multiple keyup event trigger from single key press
      self.S('body').off('keyup.fndtn.reveal').on('keyup.fndtn.reveal', function ( event ) {
        var open_modal = self.S('[' + self.attr_name() + '].open'),
            settings = open_modal.data(self.attr_name(true) + '-init') || self.settings ;
        // PATCH #2: making sure that the close event can be called only while unlocked,
        //           so that multiple keyup.fndtn.reveal events don't prevent clean closing of the reveal window.
        if ( settings && event.which === 27  && settings.close_on_esc && !self.locked) { // 27 is the keycode for the Escape key
          self.close.call(self, open_modal);
        }
      });

      return true;
    },

    // PATCH #3: turning on key up capture only when a reveal window is open
    key_up_off : function (scope) {
      this.S('body').off('keyup.fndtn.reveal');
      return true;
    },


    open : function (target, ajax_settings) {
      var self = this,
          modal;

      if (target) {
        if (typeof target.selector !== 'undefined') {
          // Find the named node; only use the first one found, since the rest of the code assumes there's only one node
          modal = self.S('#' + target.data(self.data_attr('reveal-id'))).first();
        } else {
          modal = self.S(this.scope);

          ajax_settings = target;
        }
      } else {
        modal = self.S(this.scope);
      }

      var settings = modal.data(self.attr_name(true) + '-init');
      settings = settings || this.settings;


      if (modal.hasClass('open') && target.attr('data-reveal-id') == modal.attr('id')) {
        return self.close(modal);
      }

      if (!modal.hasClass('open')) {
        var open_modal = self.S('[' + self.attr_name() + '].open');

        if (typeof modal.data('css-top') === 'undefined') {
          modal.data('css-top', parseInt(modal.css('top'), 10))
            .data('offset', this.cache_offset(modal));
        }

        this.key_up_on(modal);    // PATCH #3: turning on key up capture only when a reveal window is open
        modal.trigger('open').trigger('open.fndtn.reveal');

        if (open_modal.length < 1) {
          this.toggle_bg(modal, true);
        }

        if (typeof ajax_settings === 'string') {
          ajax_settings = {
            url: ajax_settings
          };
        }

        if (typeof ajax_settings === 'undefined' || !ajax_settings.url) {
          if (open_modal.length > 0) {
            this.hide(open_modal, settings.css.close);
          }

          this.show(modal, settings.css.open);
        } else {
          var old_success = typeof ajax_settings.success !== 'undefined' ? ajax_settings.success : null;

          $.extend(ajax_settings, {
            success: function (data, textStatus, jqXHR) {
              if ( $.isFunction(old_success) ) {
                old_success(data, textStatus, jqXHR);
              }

              modal.html(data);
              self.S(modal).foundation('section', 'reflow');
              self.S(modal).children().foundation();

              if (open_modal.length > 0) {
                self.hide(open_modal, settings.css.close);
              }
              self.show(modal, settings.css.open);
            }
          });

          $.ajax(ajax_settings);
        }
      }
      self.S(window).trigger('resize');
    },

    close : function (modal) {
      var modal = modal && modal.length ? modal : this.S(this.scope),
          open_modals = this.S('[' + this.attr_name() + '].open'),
          settings = modal.data(this.attr_name(true) + '-init') || this.settings;

      if (open_modals.length > 0) {
        this.locked = true;
        this.key_up_off(modal);   // PATCH #3: turning on key up capture only when a reveal window is open
        modal.trigger('close').trigger('close.fndtn.reveal');
        this.toggle_bg(modal, false);
        this.hide(open_modals, settings.css.close, settings);
      }
    },

    close_targets : function () {
      var base = '.' + this.settings.dismiss_modal_class;

      if (this.settings.close_on_background_click) {
        return base + ', .' + this.settings.bg_class;
      }

      return base;
    },

    toggle_bg : function (modal, state) {
      if (this.S('.' + this.settings.bg_class).length === 0) {
        this.settings.bg = $('<div />', {'class': this.settings.bg_class})
          .appendTo('body').hide();
      }

      var visible = this.settings.bg.filter(':visible').length > 0;
      if ( state != visible ) {
        if ( state == undefined ? visible : !state ) {
          this.hide(this.settings.bg);
        } else {
          this.show(this.settings.bg);
        }
      }
    },

    show : function (el, css) {
      // is modal
      if (css) {
        var settings = el.data(this.attr_name(true) + '-init') || this.settings,
            root_element = settings.root_element;

        if (el.parent(root_element).length === 0) {
          var placeholder = el.wrap('<div style="display: none;" />').parent();

          el.on('closed.fndtn.reveal.wrapped', function() {
            el.detach().appendTo(placeholder);
            el.unwrap().unbind('closed.fndtn.reveal.wrapped');
          });

          el.detach().appendTo(root_element);
        }

        var animData = getAnimationData(settings.animation);
        if (!animData.animate) {
          this.locked = false;
        }
        if (animData.pop) {
          css.top = $(window).scrollTop() - el.data('offset') + 'px';
          var end_css = {
            top: $(window).scrollTop() + el.data('css-top') + 'px',
            opacity: 1
          };

          return setTimeout(function () {
            return el
              .css(css)
              .animate(end_css, settings.animation_speed, 'linear', function () {
                this.locked = false;
                el.trigger('opened').trigger('opened.fndtn.reveal');
              }.bind(this))
              .addClass('open');
          }.bind(this), settings.animation_speed / 2);
        }

        if (animData.fade) {
          css.top = $(window).scrollTop() + el.data('css-top') + 'px';
          var end_css = {opacity: 1};

          return setTimeout(function () {
            return el
              .css(css)
              .animate(end_css, settings.animation_speed, 'linear', function () {
                this.locked = false;
                el.trigger('opened').trigger('opened.fndtn.reveal');
              }.bind(this))
              .addClass('open');
          }.bind(this), settings.animation_speed / 2);
        }

        return el.css(css).show().css({opacity: 1}).addClass('open').trigger('opened').trigger('opened.fndtn.reveal');
      }

      var settings = this.settings;

      // should we animate the background?
      if (getAnimationData(settings.animation).fade) {
        return el.fadeIn(settings.animation_speed / 2);
      }

      this.locked = false;

      return el.show();
    },

    hide : function (el, css) {
      // is modal
      if (css) {
        var settings = el.data(this.attr_name(true) + '-init');
        settings = settings || this.settings;

        var animData = getAnimationData(settings.animation);
        if (!animData.animate) {
          this.locked = false;
        }
        if (animData.pop) {
          var end_css = {
            top: - $(window).scrollTop() - el.data('offset') + 'px',
            opacity: 0
          };

          return setTimeout(function () {
            return el
              .animate(end_css, settings.animation_speed, 'linear', function () {
                this.locked = false;
                el.css(css).trigger('closed').trigger('closed.fndtn.reveal');
              }.bind(this))
              .removeClass('open');
          }.bind(this), settings.animation_speed / 2);
        }

        if (animData.fade) {
          var end_css = {opacity: 0};

          return setTimeout(function () {
            return el
              .animate(end_css, settings.animation_speed, 'linear', function () {
                this.locked = false;
                el.css(css).trigger('closed').trigger('closed.fndtn.reveal');
              }.bind(this))
              .removeClass('open');
          }.bind(this), settings.animation_speed / 2);
        }

        return el.hide().css(css).removeClass('open').trigger('closed').trigger('closed.fndtn.reveal');
      }

      var settings = this.settings;

      // should we animate the background?
      if (getAnimationData(settings.animation).fade) {
        return el.fadeOut(settings.animation_speed / 2);
      }

      return el.hide();
    },

    close_video : function (e) {
      var video = $('.flex-video', e.target),
          iframe = $('iframe', video);

      if (iframe.length > 0) {
        iframe.attr('data-src', iframe[0].src);
        iframe.attr('src', iframe.attr('src'));
        video.hide();
      }
    },

    open_video : function (e) {
      var video = $('.flex-video', e.target),
          iframe = video.find('iframe');

      if (iframe.length > 0) {
        var data_src = iframe.attr('data-src');
        if (typeof data_src === 'string') {
          iframe[0].src = iframe.attr('data-src');
        } else {
          var src = iframe[0].src;
          iframe[0].src = undefined;
          iframe[0].src = src;
        }
        video.show();
      }
    },

    data_attr: function (str) {
      if (this.namespace.length > 0) {
        return this.namespace + '-' + str;
      }

      return str;
    },

    cache_offset : function (modal) {
      var offset = modal.show().height() + parseInt(modal.css('top'), 10);

      modal.hide();

      return offset;
    },

    off : function () {
      $(this.scope).off('.fndtn.reveal');
    },

    reflow : function () {}
  };

  /*
   * getAnimationData('popAndFade') // {animate: true,  pop: true,  fade: true}
   * getAnimationData('fade')       // {animate: true,  pop: false, fade: true}
   * getAnimationData('pop')        // {animate: true,  pop: true,  fade: false}
   * getAnimationData('foo')        // {animate: false, pop: false, fade: false}
   * getAnimationData(null)         // {animate: false, pop: false, fade: false}
   */
  function getAnimationData(str) {
    var fade = /fade/i.test(str);
    var pop = /pop/i.test(str);
    return {
      animate: fade || pop,
      pop: pop,
      fade: fade
    };
  }
}(jQuery, window, window.document));
;(function ($, window, document, undefined) {
  'use strict';

  Foundation.libs.interchange = {
    name : 'interchange',

    version : '5.4.6',

    cache : {},

    images_loaded : false,
    nodes_loaded : false,

    settings : {
      load_attr : 'interchange',

      named_queries : {
        'default' : 'only screen',
        small : Foundation.media_queries.small,
        medium : Foundation.media_queries.medium,
        large : Foundation.media_queries.large,
        xlarge : Foundation.media_queries.xlarge,
        xxlarge: Foundation.media_queries.xxlarge,
        landscape : 'only screen and (orientation: landscape)',
        portrait : 'only screen and (orientation: portrait)',
        retina : 'only screen and (-webkit-min-device-pixel-ratio: 2),' +
          'only screen and (min--moz-device-pixel-ratio: 2),' +
          'only screen and (-o-min-device-pixel-ratio: 2/1),' +
          'only screen and (min-device-pixel-ratio: 2),' +
          'only screen and (min-resolution: 192dpi),' +
          'only screen and (min-resolution: 2dppx)'
      },

      directives : {
        replace: function (el, path, trigger) {
          // The trigger argument, if called within the directive, fires
          // an event named after the directive on the element, passing
          // any parameters along to the event that you pass to trigger.
          //
          // ex. trigger(), trigger([a, b, c]), or trigger(a, b, c)
          //
          // This allows you to bind a callback like so:
          // $('#interchangeContainer').on('replace', function (e, a, b, c) {
          //   console.log($(this).html(), a, b, c);
          // });

          if (/IMG/.test(el[0].nodeName)) {
            var orig_path = el[0].src;

            if (new RegExp(path, 'i').test(orig_path)) return;

            el[0].src = path;

            return trigger(el[0].src);
          }
          var last_path = el.data(this.data_attr + '-last-path'),
              self = this;

          if (last_path == path) return;

          if (/\.(gif|jpg|jpeg|tiff|png)([?#].*)?/i.test(path)) {
            $(el).css('background-image', 'url('+path+')');
            el.data('interchange-last-path', path);
            return trigger(path);
          }

          return $.get(path, function (response) {
            el.html(response);
            el.data(self.data_attr + '-last-path', path);
            trigger();
          });

        }
      }
    },

    init : function (scope, method, options) {
      Foundation.inherit(this, 'throttle random_str');

      this.data_attr = this.set_data_attr();
      $.extend(true, this.settings, method, options);
      this.bindings(method, options);
      this.load('images');
      this.load('nodes');
    },

    get_media_hash : function() {
        var mediaHash='';
        for (var queryName in this.settings.named_queries ) {
            mediaHash += matchMedia(this.settings.named_queries[queryName]).matches.toString();
        }
        return mediaHash;
    },

    events : function () {
      var self = this, prevMediaHash;

      $(window)
        .off('.interchange')
        .on('resize.fndtn.interchange', self.throttle(function () {
            var currMediaHash = self.get_media_hash();
            if (currMediaHash !== prevMediaHash) {
                self.resize();
            }
            prevMediaHash = currMediaHash;
        }, 50));

      return this;
    },

    resize : function () {
      var cache = this.cache;

      if(!this.images_loaded || !this.nodes_loaded) {
        setTimeout($.proxy(this.resize, this), 50);
        return;
      }

      for (var uuid in cache) {
        if (cache.hasOwnProperty(uuid)) {
          var passed = this.results(uuid, cache[uuid]);

          if (passed) {
            this.settings.directives[passed
              .scenario[1]].call(this, passed.el, passed.scenario[0], function () {
                if (arguments[0] instanceof Array) { 
                  var args = arguments[0];
                } else { 
                  var args = Array.prototype.slice.call(arguments, 0);
                }

                passed.el.trigger(passed.scenario[1], args);
              });
          }
        }
      }

    },

    results : function (uuid, scenarios) {
      var count = scenarios.length;

      if (count > 0) {
        var el = this.S('[' + this.add_namespace('data-uuid') + '="' + uuid + '"]');

        while (count--) {
          var mq, rule = scenarios[count][2];
          if (this.settings.named_queries.hasOwnProperty(rule)) {
            mq = matchMedia(this.settings.named_queries[rule]);
          } else {
            mq = matchMedia(rule);
          }
          if (mq.matches) {
            return {el: el, scenario: scenarios[count]};
          }
        }
      }

      return false;
    },

    load : function (type, force_update) {
      if (typeof this['cached_' + type] === 'undefined' || force_update) {
        this['update_' + type]();
      }

      return this['cached_' + type];
    },

    update_images : function () {
      var images = this.S('img[' + this.data_attr + ']'),
          count = images.length,
          i = count,
          loaded_count = 0,
          data_attr = this.data_attr;

      this.cache = {};
      this.cached_images = [];
      this.images_loaded = (count === 0);

      while (i--) {
        loaded_count++;
        if (images[i]) {
          var str = images[i].getAttribute(data_attr) || '';

          if (str.length > 0) {
            this.cached_images.push(images[i]);
          }
        }

        if (loaded_count === count) {
          this.images_loaded = true;
          this.enhance('images');
        }
      }

      return this;
    },

    update_nodes : function () {
      var nodes = this.S('[' + this.data_attr + ']').not('img'),
          count = nodes.length,
          i = count,
          loaded_count = 0,
          data_attr = this.data_attr;

      this.cached_nodes = [];
      this.nodes_loaded = (count === 0);


      while (i--) {
        loaded_count++;
        var str = nodes[i].getAttribute(data_attr) || '';

        if (str.length > 0) {
          this.cached_nodes.push(nodes[i]);
        }

        if(loaded_count === count) {
          this.nodes_loaded = true;
          this.enhance('nodes');
        }
      }

      return this;
    },

    enhance : function (type) {
      var i = this['cached_' + type].length;

      while (i--) {
        this.object($(this['cached_' + type][i]));
      }

      return $(window).trigger('resize').trigger('resize.fndtn.interchange');
    },

    convert_directive : function (directive) {

      var trimmed = this.trim(directive);

      if (trimmed.length > 0) {
        return trimmed;
      }

      return 'replace';
    },

    parse_scenario : function (scenario) {
      // This logic had to be made more complex since some users were using commas in the url path
      // So we cannot simply just split on a comma
      var directive_match = scenario[0].match(/(.+),\s*(\w+)\s*$/),
      media_query         = scenario[1];

      if (directive_match) {
        var path  = directive_match[1],
        directive = directive_match[2];
      }
      else {
        var cached_split = scenario[0].split(/,\s*$/),
        path             = cached_split[0],
        directive        = '';               
      }

      return [this.trim(path), this.convert_directive(directive), this.trim(media_query)];
    },

    object : function(el) {
      var raw_arr = this.parse_data_attr(el),
          scenarios = [], 
          i = raw_arr.length;

      if (i > 0) {
        while (i--) {
          var split = raw_arr[i].split(/\((.*?)(\))$/);

          if (split.length > 1) {
            var params = this.parse_scenario(split);
            scenarios.push(params);
          }
        }
      }

      return this.store(el, scenarios);
    },

    store : function (el, scenarios) {
      var uuid = this.random_str(),
          current_uuid = el.data(this.add_namespace('uuid', true));

      if (this.cache[current_uuid]) return this.cache[current_uuid];

      el.attr(this.add_namespace('data-uuid'), uuid);

      return this.cache[uuid] = scenarios;
    },

    trim : function(str) {

      if (typeof str === 'string') {
        return $.trim(str);
      }

      return str;
    },

    set_data_attr: function (init) {
      if (init) {
        if (this.namespace.length > 0) {
          return this.namespace + '-' + this.settings.load_attr;
        }

        return this.settings.load_attr;
      }

      if (this.namespace.length > 0) {
        return 'data-' + this.namespace + '-' + this.settings.load_attr;
      }

      return 'data-' + this.settings.load_attr;
    },

    parse_data_attr : function (el) {
      var raw = el.attr(this.attr_name()).split(/\[(.*?)\]/),
          i = raw.length, 
          output = [];

      while (i--) {
        if (raw[i].replace(/[\W\d]+/, '').length > 4) {
          output.push(raw[i]);
        }
      }

      return output;
    },

    reflow : function () {
      this.load('images', true);
      this.load('nodes', true);
    }

  };

}(jQuery, window, window.document));
;(function ($, window, document, undefined) {
  'use strict';

  Foundation.libs['magellan-expedition'] = {
    name : 'magellan-expedition',

    version : '5.4.6',

    settings : {
      active_class: 'active',
      threshold: 0, // pixels from the top of the expedition for it to become fixes
      destination_threshold: 20, // pixels from the top of destination for it to be considered active
      throttle_delay: 30, // calculation throttling to increase framerate
      fixed_top: 0 // top distance in pixels assigend to the fixed element on scroll
    },

    init : function (scope, method, options) {
      Foundation.inherit(this, 'throttle');
      this.bindings(method, options);
    },

    events : function () {
      var self = this,
          S = self.S,
          settings = self.settings;

      // initialize expedition offset
      self.set_expedition_position();

      S(self.scope)
        .off('.magellan')
        .on('click.fndtn.magellan', '[' + self.add_namespace('data-magellan-arrival') + '] a[href^="#"]', function (e) {
          e.preventDefault();
          var expedition = $(this).closest('[' + self.attr_name() + ']'),
              settings = expedition.data('magellan-expedition-init'),
              hash = this.hash.split('#').join(''),
              target = $("a[name='"+hash+"']");

          if (target.length === 0) {
            target = $('#'+hash);

          }


          // Account for expedition height if fixed position
          var scroll_top = target.offset().top - settings.destination_threshold + 1;
          scroll_top = scroll_top - expedition.outerHeight();

          $('html, body').stop().animate({
            'scrollTop': scroll_top
          }, 700, 'swing', function () {
            if(history.pushState) {
              history.pushState(null, null, '#'+hash);
            }
            else {
              location.hash = '#'+hash;
            }
          });
        })
        .on('scroll.fndtn.magellan', self.throttle(this.check_for_arrivals.bind(this), settings.throttle_delay));

      $(window)
        .on('resize.fndtn.magellan', self.throttle(this.set_expedition_position.bind(this), settings.throttle_delay));
    },

    check_for_arrivals : function() {
      var self = this;
      self.update_arrivals();
      self.update_expedition_positions();
    },

    set_expedition_position : function() {
      var self = this;
      $('[' + this.attr_name() + '=fixed]', self.scope).each(function(idx, el) {
        var expedition = $(this),
            settings = expedition.data('magellan-expedition-init'),
            styles = expedition.attr('styles'), // save styles
            top_offset, fixed_top;

        expedition.attr('style', '');
        top_offset = expedition.offset().top + settings.threshold;

        //set fixed-top by attribute
        fixed_top = parseInt(expedition.data('magellan-fixed-top'));
        if(!isNaN(fixed_top))
            self.settings.fixed_top = fixed_top;

        expedition.data(self.data_attr('magellan-top-offset'), top_offset);
        expedition.attr('style', styles);
      });
    },

    update_expedition_positions : function() {
      var self = this,
          window_top_offset = $(window).scrollTop();

      $('[' + this.attr_name() + '=fixed]', self.scope).each(function() {
        var expedition = $(this),
            settings = expedition.data('magellan-expedition-init'),
            styles = expedition.attr('style'), // save styles
            top_offset = expedition.data('magellan-top-offset');

        //scroll to the top distance
        if (window_top_offset+self.settings.fixed_top >= top_offset) {
          // Placeholder allows height calculations to be consistent even when
          // appearing to switch between fixed/non-fixed placement
          var placeholder = expedition.prev('[' + self.add_namespace('data-magellan-expedition-clone') + ']');
          if (placeholder.length === 0) {
            placeholder = expedition.clone();
            placeholder.removeAttr(self.attr_name());
            placeholder.attr(self.add_namespace('data-magellan-expedition-clone'),'');
            expedition.before(placeholder);
          }
          expedition.css({position:'fixed', top: settings.fixed_top}).addClass('fixed');
        } else {
          expedition.prev('[' + self.add_namespace('data-magellan-expedition-clone') + ']').remove();
          expedition.attr('style',styles).css('position','').css('top','').removeClass('fixed');
        }
      });
    },

    update_arrivals : function() {
      var self = this,
          window_top_offset = $(window).scrollTop();

      $('[' + this.attr_name() + ']', self.scope).each(function() {
        var expedition = $(this),
            settings = expedition.data(self.attr_name(true) + '-init'),
            offsets = self.offsets(expedition, window_top_offset),
            arrivals = expedition.find('[' + self.add_namespace('data-magellan-arrival') + ']'),
            active_item = false;
        offsets.each(function(idx, item) {
          if (item.viewport_offset >= item.top_offset) {
            var arrivals = expedition.find('[' + self.add_namespace('data-magellan-arrival') + ']');
            arrivals.not(item.arrival).removeClass(settings.active_class);
            item.arrival.addClass(settings.active_class);
            active_item = true;
            return true;
          }
        });

        if (!active_item) arrivals.removeClass(settings.active_class);
      });
    },

    offsets : function(expedition, window_offset) {
      var self = this,
          settings = expedition.data(self.attr_name(true) + '-init'),
          viewport_offset = window_offset;

      return expedition.find('[' + self.add_namespace('data-magellan-arrival') + ']').map(function(idx, el) {
        var name = $(this).data(self.data_attr('magellan-arrival')),
            dest = $('[' + self.add_namespace('data-magellan-destination') + '=' + name + ']');
        if (dest.length > 0) {
          var top_offset = Math.floor(dest.offset().top - settings.destination_threshold - expedition.outerHeight());
          return {
            destination : dest,
            arrival : $(this),
            top_offset : top_offset,
            viewport_offset : viewport_offset
          }
        }
      }).sort(function(a, b) {
        if (a.top_offset < b.top_offset) return -1;
        if (a.top_offset > b.top_offset) return 1;
        return 0;
      });
    },

    data_attr: function (str) {
      if (this.namespace.length > 0) {
        return this.namespace + '-' + str;
      }

      return str;
    },

    off : function () {
      this.S(this.scope).off('.magellan');
      this.S(window).off('.magellan');
    },

    reflow : function () {
      var self = this;
      // remove placeholder expeditions used for height calculation purposes
      $('[' + self.add_namespace('data-magellan-expedition-clone') + ']', self.scope).remove();
    }
  };
}(jQuery, window, window.document));
;(function ($, window, document, undefined) {
  'use strict';

  Foundation.libs.accordion = {
    name : 'accordion',

    version : '5.4.6',

    settings : {
      active_class: 'active',
      multi_expand: false,
      toggleable: true,
      callback : function () {}
    },

    init : function (scope, method, options) {
      this.bindings(method, options);
    },

    events : function () {
      var self = this;
      var S = this.S;
      S(this.scope)
      .off('.fndtn.accordion')
      .on('click.fndtn.accordion', '[' + this.attr_name() + '] > dd > a', function (e) {
        var accordion = S(this).closest('[' + self.attr_name() + ']'),
            groupSelector = self.attr_name() + '=' + accordion.attr(self.attr_name()),
            settings = accordion.data(self.attr_name(true) + '-init'),
            target = S('#' + this.href.split('#')[1]),
            aunts = $('> dd', accordion),
            siblings = aunts.children('.content'),
            active_content = siblings.filter('.' + settings.active_class);
        e.preventDefault();

        if (accordion.attr(self.attr_name())) {
          siblings = siblings.add('[' + groupSelector + '] dd > .content');
          aunts = aunts.add('[' + groupSelector + '] dd');
        }

        if (settings.toggleable && target.is(active_content)) {
          target.parent('dd').toggleClass(settings.active_class, false);
          target.toggleClass(settings.active_class, false);
          settings.callback(target);
          target.triggerHandler('toggled', [accordion]);
          accordion.triggerHandler('toggled', [target]);
          return;
        }

        if (!settings.multi_expand) {
          siblings.removeClass(settings.active_class);
          aunts.removeClass(settings.active_class);
        }

        target.addClass(settings.active_class).parent().addClass(settings.active_class);
        settings.callback(target);
        target.triggerHandler('toggled', [accordion]);
        accordion.triggerHandler('toggled', [target]);
      });
    },

    off : function () {},

    reflow : function () {}
  };
}(jQuery, window, window.document));
;(function ($, window, document, undefined) {
  'use strict';

  Foundation.libs.topbar = {
    name : 'topbar',

    version: '5.4.6',

    settings : {
      index : 0,
      sticky_class : 'sticky',
      custom_back_text: true,
      back_text: 'Back',
      mobile_show_parent_link: true,
      is_hover: true,
      scrolltop : true, // jump to top when sticky nav menu toggle is clicked
      sticky_on : 'all'
    },

    init : function (section, method, options) {
      Foundation.inherit(this, 'add_custom_rule register_media throttle');
      var self = this;

      self.register_media('topbar', 'foundation-mq-topbar');

      this.bindings(method, options);

      self.S('[' + this.attr_name() + ']', this.scope).each(function () {
        var topbar = $(this),
            settings = topbar.data(self.attr_name(true) + '-init'),
            section = self.S('section, .top-bar-section', this);
        topbar.data('index', 0);
        var topbarContainer = topbar.parent();
        if (topbarContainer.hasClass('fixed') || self.is_sticky(topbar, topbarContainer, settings) ) {
          self.settings.sticky_class = settings.sticky_class;
          self.settings.sticky_topbar = topbar;
          topbar.data('height', topbarContainer.outerHeight());
          topbar.data('stickyoffset', topbarContainer.offset().top);
        } else {
          topbar.data('height', topbar.outerHeight());
        }

        if (!settings.assembled) {
          self.assemble(topbar);
        }

        if (settings.is_hover) {
          self.S('.has-dropdown', topbar).addClass('not-click');
        } else {
          self.S('.has-dropdown', topbar).removeClass('not-click');
        }

        // Pad body when sticky (scrolled) or fixed.
        self.add_custom_rule('.f-topbar-fixed { padding-top: ' + topbar.data('height') + 'px }');

        if (topbarContainer.hasClass('fixed')) {
          self.S('body').addClass('f-topbar-fixed');
        }
      });

    },

    is_sticky: function (topbar, topbarContainer, settings) {
      var sticky = topbarContainer.hasClass(settings.sticky_class);

      if (sticky && settings.sticky_on === 'all') {
        return true;
      } else if (sticky && this.small() && settings.sticky_on === 'small') {
        return (matchMedia(Foundation.media_queries.small).matches && !matchMedia(Foundation.media_queries.medium).matches &&
            !matchMedia(Foundation.media_queries.large).matches);
        //return true;
      } else if (sticky && this.medium() && settings.sticky_on === 'medium') {
        return (matchMedia(Foundation.media_queries.small).matches && matchMedia(Foundation.media_queries.medium).matches &&
            !matchMedia(Foundation.media_queries.large).matches);
        //return true;
      } else if(sticky && this.large() && settings.sticky_on === 'large') {
        return (matchMedia(Foundation.media_queries.small).matches && matchMedia(Foundation.media_queries.medium).matches &&
            matchMedia(Foundation.media_queries.large).matches);
        //return true;
      }

      return false;
    },

    toggle: function (toggleEl) {
      var self = this,
          topbar;

      if (toggleEl) {
        topbar = self.S(toggleEl).closest('[' + this.attr_name() + ']');
      } else {
        topbar = self.S('[' + this.attr_name() + ']');
      }

      var settings = topbar.data(this.attr_name(true) + '-init');

      var section = self.S('section, .top-bar-section', topbar);

      if (self.breakpoint()) {
        if (!self.rtl) {
          section.css({left: '0%'});
          $('>.name', section).css({left: '100%'});
        } else {
          section.css({right: '0%'});
          $('>.name', section).css({right: '100%'});
        }

        self.S('li.moved', section).removeClass('moved');
        topbar.data('index', 0);

        topbar
          .toggleClass('expanded')
          .css('height', '');
      }

      if (settings.scrolltop) {
        if (!topbar.hasClass('expanded')) {
          if (topbar.hasClass('fixed')) {
            topbar.parent().addClass('fixed');
            topbar.removeClass('fixed');
            self.S('body').addClass('f-topbar-fixed');
          }
        } else if (topbar.parent().hasClass('fixed')) {
          if (settings.scrolltop) {
            topbar.parent().removeClass('fixed');
            topbar.addClass('fixed');
            self.S('body').removeClass('f-topbar-fixed');

            window.scrollTo(0,0);
          } else {
            topbar.parent().removeClass('expanded');
          }
        }
      } else {
        if (self.is_sticky(topbar, topbar.parent(), settings)) {
          topbar.parent().addClass('fixed');
        }

        if (topbar.parent().hasClass('fixed')) {
          if (!topbar.hasClass('expanded')) {
            topbar.removeClass('fixed');
            topbar.parent().removeClass('expanded');
            self.update_sticky_positioning();
          } else {
            topbar.addClass('fixed');
            topbar.parent().addClass('expanded');
            self.S('body').addClass('f-topbar-fixed');
          }
        }
      }
    },

    timer : null,

    events : function (bar) {
      var self = this,
          S = this.S;

      S(this.scope)
        .off('.topbar')
        .on('click.fndtn.topbar', '[' + this.attr_name() + '] .toggle-topbar', function (e) {
          e.preventDefault();
          self.toggle(this);
        })
        .on('click.fndtn.topbar','.top-bar .top-bar-section li a[href^="#"],[' + this.attr_name() + '] .top-bar-section li a[href^="#"]',function (e) {
            var li = $(this).closest('li');
            if(self.breakpoint() && !li.hasClass('back') && !li.hasClass('has-dropdown'))
            {
            self.toggle();
            }
        })
        .on('click.fndtn.topbar', '[' + this.attr_name() + '] li.has-dropdown', function (e) {
          var li = S(this),
              target = S(e.target),
              topbar = li.closest('[' + self.attr_name() + ']'),
              settings = topbar.data(self.attr_name(true) + '-init');

          if(target.data('revealId')) {
            self.toggle();
            return;
          }

          if (self.breakpoint()) return;
          if (settings.is_hover && !Modernizr.touch) return;

          e.stopImmediatePropagation();

          if (li.hasClass('hover')) {
            li
              .removeClass('hover')
              .find('li')
              .removeClass('hover');

            li.parents('li.hover')
              .removeClass('hover');
          } else {
            li.addClass('hover');

            $(li).siblings().removeClass('hover');

            if (target[0].nodeName === 'A' && target.parent().hasClass('has-dropdown')) {
              e.preventDefault();
            }
          }
        })
        .on('click.fndtn.topbar', '[' + this.attr_name() + '] .has-dropdown>a', function (e) {
          if (self.breakpoint()) {

            e.preventDefault();

            var $this = S(this),
                topbar = $this.closest('[' + self.attr_name() + ']'),
                section = topbar.find('section, .top-bar-section'),
                dropdownHeight = $this.next('.dropdown').outerHeight(),
                $selectedLi = $this.closest('li');

            topbar.data('index', topbar.data('index') + 1);
            $selectedLi.addClass('moved');

            if (!self.rtl) {
              section.css({left: -(100 * topbar.data('index')) + '%'});
              section.find('>.name').css({left: 100 * topbar.data('index') + '%'});
            } else {
              section.css({right: -(100 * topbar.data('index')) + '%'});
              section.find('>.name').css({right: 100 * topbar.data('index') + '%'});
            }

            topbar.css('height', $this.siblings('ul').outerHeight(true) + topbar.data('height'));
          }
        });

      S(window).off(".topbar").on("resize.fndtn.topbar", self.throttle(function() {
          self.resize.call(self);
      }, 50)).trigger("resize").trigger("resize.fndtn.topbar").load(function(){
          // Ensure that the offset is calculated after all of the pages resources have loaded
          S(this).trigger("resize.fndtn.topbar");
      });

      S('body').off('.topbar').on('click.fndtn.topbar', function (e) {
        var parent = S(e.target).closest('li').closest('li.hover');

        if (parent.length > 0) {
          return;
        }

        S('[' + self.attr_name() + '] li.hover').removeClass('hover');
      });

      // Go up a level on Click
      S(this.scope).on('click.fndtn.topbar', '[' + this.attr_name() + '] .has-dropdown .back', function (e) {
        e.preventDefault();

        var $this = S(this),
            topbar = $this.closest('[' + self.attr_name() + ']'),
            section = topbar.find('section, .top-bar-section'),
            settings = topbar.data(self.attr_name(true) + '-init'),
            $movedLi = $this.closest('li.moved'),
            $previousLevelUl = $movedLi.parent();

        topbar.data('index', topbar.data('index') - 1);

        if (!self.rtl) {
          section.css({left: -(100 * topbar.data('index')) + '%'});
          section.find('>.name').css({left: 100 * topbar.data('index') + '%'});
        } else {
          section.css({right: -(100 * topbar.data('index')) + '%'});
          section.find('>.name').css({right: 100 * topbar.data('index') + '%'});
        }

        if (topbar.data('index') === 0) {
          topbar.css('height', '');
        } else {
          topbar.css('height', $previousLevelUl.outerHeight(true) + topbar.data('height'));
        }

        setTimeout(function () {
          $movedLi.removeClass('moved');
        }, 300);
      });

      // Show dropdown menus when their items are focused
      S(this.scope).find('.dropdown a')
        .focus(function() {
          $(this).parents('.has-dropdown').addClass('hover');
        })
        .blur(function() {
          $(this).parents('.has-dropdown').removeClass('hover');
        });
    },

    resize : function () {
      var self = this;
      self.S('[' + this.attr_name() + ']').each(function () {
        var topbar = self.S(this),
            settings = topbar.data(self.attr_name(true) + '-init');

        var stickyContainer = topbar.parent('.' + self.settings.sticky_class);
        var stickyOffset;

        if (!self.breakpoint()) {
          var doToggle = topbar.hasClass('expanded');
          topbar
            .css('height', '')
            .removeClass('expanded')
            .find('li')
            .removeClass('hover');

            if(doToggle) {
              self.toggle(topbar);
            }
        }

        if(self.is_sticky(topbar, stickyContainer, settings)) {
          if(stickyContainer.hasClass('fixed')) {
            // Remove the fixed to allow for correct calculation of the offset.
            stickyContainer.removeClass('fixed');

            stickyOffset = stickyContainer.offset().top;
            if(self.S(document.body).hasClass('f-topbar-fixed')) {
              stickyOffset -= topbar.data('height');
            }

            topbar.data('stickyoffset', stickyOffset);
            stickyContainer.addClass('fixed');
          } else {
            stickyOffset = stickyContainer.offset().top;
            topbar.data('stickyoffset', stickyOffset);
          }
        }

      });
    },

    breakpoint : function () {
      return !matchMedia(Foundation.media_queries['topbar']).matches;
    },

    small : function () {
      return matchMedia(Foundation.media_queries['small']).matches;
    },

    medium : function () {
      return matchMedia(Foundation.media_queries['medium']).matches;
    },

    large : function () {
      return matchMedia(Foundation.media_queries['large']).matches;
    },

    assemble : function (topbar) {
      var self = this,
          settings = topbar.data(this.attr_name(true) + '-init'),
          section = self.S('section, .top-bar-section', topbar);

      // Pull element out of the DOM for manipulation
      section.detach();

      self.S('.has-dropdown>a', section).each(function () {
        var $link = self.S(this),
            $dropdown = $link.siblings('.dropdown'),
            url = $link.attr('href'),
            $titleLi;


        if (!$dropdown.find('.title.back').length) {

          if (settings.mobile_show_parent_link == true && url) {
            $titleLi = $('<li class="title back js-generated"><h5><a href="javascript:void(0)"></a></h5></li><li class="parent-link show-for-small"><a class="parent-link js-generated" href="' + url + '">' + $link.html() +'</a></li>');
          } else {
            $titleLi = $('<li class="title back js-generated"><h5><a href="javascript:void(0)"></a></h5>');
          }

          // Copy link to subnav
          if (settings.custom_back_text == true) {
            $('h5>a', $titleLi).html(settings.back_text);
          } else {
            $('h5>a', $titleLi).html('&laquo; ' + $link.html());
          }
          $dropdown.prepend($titleLi);
        }
      });

      // Put element back in the DOM
      section.appendTo(topbar);

      // check for sticky
      this.sticky();

      this.assembled(topbar);
    },

    assembled : function (topbar) {
      topbar.data(this.attr_name(true), $.extend({}, topbar.data(this.attr_name(true)), {assembled: true}));
    },

    height : function (ul) {
      var total = 0,
          self = this;

      $('> li', ul).each(function () {
        total += self.S(this).outerHeight(true);
      });

      return total;
    },

    sticky : function () {
      var self = this;

      this.S(window).on('scroll', function() {
        self.update_sticky_positioning();
      });
    },

    update_sticky_positioning: function() {
      var klass = '.' + this.settings.sticky_class,
          $window = this.S(window),
          self = this;

      if (self.settings.sticky_topbar && self.is_sticky(this.settings.sticky_topbar,this.settings.sticky_topbar.parent(), this.settings)) {
        var distance = this.settings.sticky_topbar.data('stickyoffset');
        if (!self.S(klass).hasClass('expanded')) {
          if ($window.scrollTop() > (distance)) {
            if (!self.S(klass).hasClass('fixed')) {
              self.S(klass).addClass('fixed');
              self.S('body').addClass('f-topbar-fixed');
            }
          } else if ($window.scrollTop() <= distance) {
            if (self.S(klass).hasClass('fixed')) {
              self.S(klass).removeClass('fixed');
              self.S('body').removeClass('f-topbar-fixed');
            }
          }
        }
      }
    },

    off : function () {
      this.S(this.scope).off('.fndtn.topbar');
      this.S(window).off('.fndtn.topbar');
    },

    reflow : function () {}
  };
}(jQuery, window, window.document));
;(function ($, window, document, undefined) {
  'use strict';

  Foundation.libs.tab = {
    name : 'tab',

    version : '5.4.6',

    settings : {
      active_class: 'active',
      callback : function () {},
      deep_linking: false,
      scroll_to_content: true,
      is_hover: false
    },

    default_tab_hashes: [],

    init : function (scope, method, options) {
      var self = this,
          S = this.S;

      this.bindings(method, options);
      this.handle_location_hash_change();

      // Store the default active tabs which will be referenced when the
      // location hash is absent, as in the case of navigating the tabs and
      // returning to the first viewing via the browser Back button.
      S('[' + this.attr_name() + '] > .active > a', this.scope).each(function () {
        self.default_tab_hashes.push(this.hash);
      });
    },

    events : function () {
      var self = this,
          S = this.S;

      var usual_tab_behavior =  function (e) {
          var settings = S(this).closest('[' + self.attr_name() +']').data(self.attr_name(true) + '-init');
          if (!settings.is_hover || Modernizr.touch) {
            e.preventDefault();
            e.stopPropagation();
            self.toggle_active_tab(S(this).parent());
          }
        };

      S(this.scope)
        .off('.tab')
        // Click event: tab title
        .on('focus.fndtn.tab', '[' + this.attr_name() + '] > * > a', usual_tab_behavior )
        .on('click.fndtn.tab', '[' + this.attr_name() + '] > * > a', usual_tab_behavior )
        // Hover event: tab title
        .on('mouseenter.fndtn.tab', '[' + this.attr_name() + '] > * > a', function (e) {
          var settings = S(this).closest('[' + self.attr_name() +']').data(self.attr_name(true) + '-init');
          if (settings.is_hover) self.toggle_active_tab(S(this).parent());
        });

      // Location hash change event
      S(window).on('hashchange.fndtn.tab', function (e) {
        e.preventDefault();
        self.handle_location_hash_change();
      });
    },

    handle_location_hash_change : function () {

      var self = this,
          S = this.S;

      S('[' + this.attr_name() + ']', this.scope).each(function () {
        var settings = S(this).data(self.attr_name(true) + '-init');
        if (settings.deep_linking) {
          // Match the location hash to a label
          var hash;
          if (settings.scroll_to_content) {
            hash = self.scope.location.hash;
          } else {
            // prefix the hash to prevent anchor scrolling
            hash = self.scope.location.hash.replace('fndtn-', '');
          }
          if (hash != '') {
            // Check whether the location hash references a tab content div or
            // another element on the page (inside or outside the tab content div)
            var hash_element = S(hash);
            if (hash_element.hasClass('content') && hash_element.parent().hasClass('tab-content')) {
              // Tab content div
              self.toggle_active_tab($('[' + self.attr_name() + '] > * > a[href=' + hash + ']').parent());
            } else {
              // Not the tab content div. If inside the tab content, find the
              // containing tab and toggle it as active.
              var hash_tab_container_id = hash_element.closest('.content').attr('id');
              if (hash_tab_container_id != undefined) {
                self.toggle_active_tab($('[' + self.attr_name() + '] > * > a[href=#' + hash_tab_container_id + ']').parent(), hash);
              }
            }
          } else {
            // Reference the default tab hashes which were initialized in the init function
            for (var ind = 0; ind < self.default_tab_hashes.length; ind++) {
              self.toggle_active_tab($('[' + self.attr_name() + '] > * > a[href=' + self.default_tab_hashes[ind] + ']').parent());
            }
          }
        }
       });
     },

    toggle_active_tab: function (tab, location_hash) {
      var S = this.S,
          tabs = tab.closest('[' + this.attr_name() + ']'),
          tab_link = tab.find('a'),
          anchor = tab.children('a').first(),
          target_hash = '#' + anchor.attr('href').split('#')[1],
          target = S(target_hash),
          siblings = tab.siblings(),
          settings = tabs.data(this.attr_name(true) + '-init'),
          interpret_keyup_action = function(e) {
            // Light modification of Heydon Pickering's Practical ARIA Examples: http://heydonworks.com/practical_aria_examples/js/a11y.js 

            // define current, previous and next (possible) tabs

            var $original = $(this);
            var $prev = $(this).parents('li').prev().children('[role="tab"]');
            var $next = $(this).parents('li').next().children('[role="tab"]');
            var $target;

            // find the direction (prev or next)

            switch (e.keyCode) {
              case 37:
                $target = $prev;
                break;
              case 39:
                $target = $next;
                break;
              default:
                $target = false
                  break;
            }

            if ($target.length) {
              $original.attr({
                'tabindex' : '-1',
                'aria-selected' : null
              });
              $target.attr({
                'tabindex' : '0',
                'aria-selected' : true
              }).focus();
            }

            // Hide panels

            $('[role="tabpanel"]')
              .attr('aria-hidden', 'true');

            // Show panel which corresponds to target

            $('#' + $(document.activeElement).attr('href').substring(1))
              .attr('aria-hidden', null);

          };

      // allow usage of data-tab-content attribute instead of href
      if (S(this).data(this.data_attr('tab-content'))) {
        target_hash = '#' + S(this).data(this.data_attr('tab-content')).split('#')[1];
        target = S(target_hash);
      }

      if (settings.deep_linking) {

        if (settings.scroll_to_content) {
          // retain current hash to scroll to content
          window.location.hash = location_hash || target_hash;
          if (location_hash == undefined || location_hash == target_hash) {
            tab.parent()[0].scrollIntoView();
          } else {
            S(target_hash)[0].scrollIntoView();
          }
        } else {
          // prefix the hashes so that the browser doesn't scroll down
          if (location_hash != undefined) {
            window.location.hash = 'fndtn-' + location_hash.replace('#', '');
          } else {
            window.location.hash = 'fndtn-' + target_hash.replace('#', '');
          }
        }
      }

      // WARNING: The activation and deactivation of the tab content must
      // occur after the deep linking in order to properly refresh the browser
      // window (notably in Chrome).
      // Clean up multiple attr instances to done once
      tab.addClass(settings.active_class).triggerHandler('opened');
      tab_link.attr({"aria-selected": "true",  tabindex: 0});
      siblings.removeClass(settings.active_class)
      siblings.find('a').attr({"aria-selected": "false",  tabindex: -1});
      target.siblings().removeClass(settings.active_class).attr({"aria-hidden": "true",  tabindex: -1});
      target.addClass(settings.active_class).attr('aria-hidden', 'false').removeAttr("tabindex");
      settings.callback(tab);
      target.triggerHandler('toggled', [tab]);
      tabs.triggerHandler('toggled', [target]);

      tab_link.off('keydown').on('keydown', interpret_keyup_action );
    },

    data_attr: function (str) {
      if (this.namespace.length > 0) {
        return this.namespace + '-' + str;
      }

      return str;
    },

    off : function () {},

    reflow : function () {}
  };
}(jQuery, window, window.document));
;(function ($, window, document, undefined) {
  'use strict';

  Foundation.libs.abide = {
    name : 'abide',

    version : '5.4.6',

    settings : {
      live_validate : true,
      focus_on_invalid : true,
      error_labels: true, // labels with a for="inputId" will recieve an `error` class
      timeout : 1000,
      patterns : {
        alpha: /^[a-zA-Z]+$/,
        alpha_numeric : /^[a-zA-Z0-9]+$/,
        integer: /^[-+]?\d+$/,
        number: /^[-+]?\d*(?:[\.\,]\d+)?$/,

        // amex, visa, diners
        card : /^(?:4[0-9]{12}(?:[0-9]{3})?|5[1-5][0-9]{14}|6(?:011|5[0-9][0-9])[0-9]{12}|3[47][0-9]{13}|3(?:0[0-5]|[68][0-9])[0-9]{11}|(?:2131|1800|35\d{3})\d{11})$/,
        cvv : /^([0-9]){3,4}$/,

        // http://www.whatwg.org/specs/web-apps/current-work/multipage/states-of-the-type-attribute.html#valid-e-mail-address
        email : /^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+$/,

        url: /^(https?|ftp|file|ssh):\/\/(((([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-zA-Z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-zA-Z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-zA-Z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-zA-Z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-zA-Z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-zA-Z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/,
        // abc.de
        domain: /^([a-zA-Z0-9]([a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,6}$/,

        datetime: /^([0-2][0-9]{3})\-([0-1][0-9])\-([0-3][0-9])T([0-5][0-9])\:([0-5][0-9])\:([0-5][0-9])(Z|([\-\+]([0-1][0-9])\:00))$/,
        // YYYY-MM-DD
        date: /(?:19|20)[0-9]{2}-(?:(?:0[1-9]|1[0-2])-(?:0[1-9]|1[0-9]|2[0-9])|(?:(?!02)(?:0[1-9]|1[0-2])-(?:30))|(?:(?:0[13578]|1[02])-31))$/,
        // HH:MM:SS
        time : /^(0[0-9]|1[0-9]|2[0-3])(:[0-5][0-9]){2}$/,
        dateISO: /^\d{4}[\/\-]\d{1,2}[\/\-]\d{1,2}$/,
        // MM/DD/YYYY
        month_day_year : /^(0[1-9]|1[012])[- \/.](0[1-9]|[12][0-9]|3[01])[- \/.]\d{4}$/,
        // DD/MM/YYYY
        day_month_year : /^(0[1-9]|[12][0-9]|3[01])[- \/.](0[1-9]|1[012])[- \/.]\d{4}$/,

        // #FFF or #FFFFFF
        color: /^#?([a-fA-F0-9]{6}|[a-fA-F0-9]{3})$/
      },
      validators : {
        equalTo: function(el, required, parent) {
          var from  = document.getElementById(el.getAttribute(this.add_namespace('data-equalto'))).value,
              to    = el.value,
              valid = (from === to);

          return valid;
        }
      }
    },

    timer : null,

    init : function (scope, method, options) {
      this.bindings(method, options);
    },

    events : function (scope) {
      var self = this,
          form = self.S(scope).attr('novalidate', 'novalidate'),
          settings = form.data(this.attr_name(true) + '-init') || {};

      this.invalid_attr = this.add_namespace('data-invalid');

      form
        .off('.abide')
        .on('submit.fndtn.abide validate.fndtn.abide', function (e) {
          var is_ajax = /ajax/i.test(self.S(this).attr(self.attr_name()));
          return self.validate(self.S(this).find('input, textarea, select').get(), e, is_ajax);
        })
        .on('reset', function() {
          return self.reset($(this));
        })
        .find('input, textarea, select')
          .off('.abide')
          .on('blur.fndtn.abide change.fndtn.abide', function (e) {
            self.validate([this], e);
          })
          .on('keydown.fndtn.abide', function (e) {
            if (settings.live_validate === true) {
              clearTimeout(self.timer);
              self.timer = setTimeout(function () {
                self.validate([this], e);
              }.bind(this), settings.timeout);
            }
          });
    },

    reset : function (form) {
      form.removeAttr(this.invalid_attr);
      $(this.invalid_attr, form).removeAttr(this.invalid_attr);
      $('.error', form).not('small').removeClass('error');
    },

    validate : function (els, e, is_ajax) {
      var validations = this.parse_patterns(els),
          validation_count = validations.length,
          form = this.S(els[0]).closest('form'),
          submit_event = /submit/.test(e.type);

      // Has to count up to make sure the focus gets applied to the top error
      for (var i=0; i < validation_count; i++) {
        if (!validations[i] && (submit_event || is_ajax)) {
          if (this.settings.focus_on_invalid) els[i].focus();
          form.trigger('invalid');
          this.S(els[i]).closest('form').attr(this.invalid_attr, '');
          return false;
        }
      }

      if (submit_event || is_ajax) {
        form.trigger('valid');
      }

      form.removeAttr(this.invalid_attr);

      if (is_ajax) return false;

      return true;
    },

    parse_patterns : function (els) {
      var i = els.length,
          el_patterns = [];

      while (i--) {
        el_patterns.push(this.pattern(els[i]));
      }

      return this.check_validation_and_apply_styles(el_patterns);
    },

    pattern : function (el) {
      var type = el.getAttribute('type'),
          required = typeof el.getAttribute('required') === 'string';

      var pattern = el.getAttribute('pattern') || '';

      if (this.settings.patterns.hasOwnProperty(pattern) && pattern.length > 0) {
        return [el, this.settings.patterns[pattern], required];
      } else if (pattern.length > 0) {
        return [el, new RegExp(pattern), required];
      }

      if (this.settings.patterns.hasOwnProperty(type)) {
        return [el, this.settings.patterns[type], required];
      }

      pattern = /.*/;

      return [el, pattern, required];
    },

    check_validation_and_apply_styles : function (el_patterns) {
      var i = el_patterns.length,
          validations = [],
          form = this.S(el_patterns[0][0]).closest('[data-' + this.attr_name(true) + ']'),
          settings = form.data(this.attr_name(true) + '-init') || {};
      while (i--) {
        var el = el_patterns[i][0],
            required = el_patterns[i][2],
            value = el.value.trim(),
            direct_parent = this.S(el).parent(),
            validator = el.getAttribute(this.add_namespace('data-abide-validator')),
            is_radio = el.type === "radio",
            is_checkbox = el.type === "checkbox",
            label = this.S('label[for="' + el.getAttribute('id') + '"]'),
            valid_length = (required) ? (el.value.length > 0) : true,
            el_validations = [];

        var parent, valid;

        // support old way to do equalTo validations
        if(el.getAttribute(this.add_namespace('data-equalto'))) { validator = "equalTo" }

        if (!direct_parent.is('label')) {
          parent = direct_parent;
        } else {
          parent = direct_parent.parent();
        }

        if (validator) {
          valid = this.settings.validators[validator].apply(this, [el, required, parent]);
          el_validations.push(valid);
        }

        if (is_radio && required) {
          el_validations.push(this.valid_radio(el, required));
        } else if (is_checkbox && required) {
          el_validations.push(this.valid_checkbox(el, required));
        } else {

          if (el_patterns[i][1].test(value) && valid_length ||
            !required && el.value.length < 1 || $(el).attr('disabled')) {
            el_validations.push(true);
          } else {
            el_validations.push(false);
          }

          el_validations = [el_validations.every(function(valid){return valid;})];

          if(el_validations[0]){
            this.S(el).removeAttr(this.invalid_attr);
            el.setAttribute('aria-invalid', 'false');
            el.removeAttribute('aria-describedby');
            parent.removeClass('error');
            if (label.length > 0 && this.settings.error_labels) {
              label.removeClass('error').removeAttr('role');
            }
            $(el).triggerHandler('valid');
          } else {
            this.S(el).attr(this.invalid_attr, '');
            el.setAttribute('aria-invalid', 'true');

            // Try to find the error associated with the input
            var errorElem = parent.find('small.error, span.error');
            var errorID = errorElem.length > 0 ? errorElem[0].id : "";
            if (errorID.length > 0) el.setAttribute('aria-describedby', errorID);

            // el.setAttribute('aria-describedby', $(el).find('.error')[0].id);
            parent.addClass('error');
            if (label.length > 0 && this.settings.error_labels) {
              label.addClass('error').attr('role', 'alert');
            }
            $(el).triggerHandler('invalid');
          }
        }
        validations.push(el_validations[0]);
      }
      validations = [validations.every(function(valid){return valid;})];
      return validations;
    },

    valid_checkbox : function(el, required) {
      var el = this.S(el),
          valid = (el.is(':checked') || !required);

      if (valid) {
        el.removeAttr(this.invalid_attr).parent().removeClass('error');
      } else {
        el.attr(this.invalid_attr, '').parent().addClass('error');
      }

      return valid;
    },

    valid_radio : function (el, required) {
      var name = el.getAttribute('name'),
          group = this.S(el).closest('[data-' + this.attr_name(true) + ']').find("[name='"+name+"']"),
          count = group.length,
          valid = false;

      // Has to count up to make sure the focus gets applied to the top error
      for (var i=0; i < count; i++) {
        if (group[i].checked) valid = true;
      }

      // Has to count up to make sure the focus gets applied to the top error
      for (var i=0; i < count; i++) {
        if (valid) {
          this.S(group[i]).removeAttr(this.invalid_attr).parent().removeClass('error');
        } else {
          this.S(group[i]).attr(this.invalid_attr, '').parent().addClass('error');
        }
      }

      return valid;
    },

    valid_equal: function(el, required, parent) {
      var from  = document.getElementById(el.getAttribute(this.add_namespace('data-equalto'))).value,
          to    = el.value,
          valid = (from === to);

      if (valid) {
        this.S(el).removeAttr(this.invalid_attr);
        parent.removeClass('error');
        if (label.length > 0 && settings.error_labels) label.removeClass('error');
      } else {
        this.S(el).attr(this.invalid_attr, '');
        parent.addClass('error');
        if (label.length > 0 && settings.error_labels) label.addClass('error');
      }

      return valid;
    },

    valid_oneof: function(el, required, parent, doNotValidateOthers) {
      var el = this.S(el),
        others = this.S('[' + this.add_namespace('data-oneof') + ']'),
        valid = others.filter(':checked').length > 0;

      if (valid) {
        el.removeAttr(this.invalid_attr).parent().removeClass('error');
      } else {
        el.attr(this.invalid_attr, '').parent().addClass('error');
      }

      if (!doNotValidateOthers) {
        var _this = this;
        others.each(function() {
          _this.valid_oneof.call(_this, this, null, null, true);
        });
      }

      return valid;
    }
  };
}(jQuery, window, window.document));
;(function ($, window, document, undefined) {
  'use strict';

  Foundation.libs.tooltip = {
    name : 'tooltip',

    version : '5.4.6',

    settings : {
      additional_inheritable_classes : [],
      tooltip_class : '.tooltip',
      append_to: 'body',
      touch_close_text: 'Tap To Close',
      disable_for_touch: false,
      hover_delay: 200,
      show_on : 'all',
      tip_template : function (selector, content) {
        return '<span data-selector="' + selector + '" id="' + selector + '" class="'
          + Foundation.libs.tooltip.settings.tooltip_class.substring(1)
          + '" role="tooltip">' + content + '<span class="nub"></span></span>';
      }
    },

    cache : {},

    init : function (scope, method, options) {
      Foundation.inherit(this, 'random_str');
      this.bindings(method, options);
    },

    should_show: function (target, tip) {
      var settings = $.extend({}, this.settings, this.data_options(target));

      if (settings.show_on === 'all') {
        return true;
      } else if (this.small() && settings.show_on === 'small') {
        return true;
      } else if (this.medium() && settings.show_on === 'medium') {
        return true;
      } else if (this.large() && settings.show_on === 'large') {
        return true;
      }
      return false;
    },

    medium : function () {
      return matchMedia(Foundation.media_queries['medium']).matches;
    },

    large : function () {
      return matchMedia(Foundation.media_queries['large']).matches;
    },

    events : function (instance) {
      var self = this,
          S = self.S;

      self.create(this.S(instance));

      $(this.scope)
        .off('.tooltip')
        .on('mouseenter.fndtn.tooltip mouseleave.fndtn.tooltip touchstart.fndtn.tooltip MSPointerDown.fndtn.tooltip',
          '[' + this.attr_name() + ']', function (e) {
          var $this = S(this),
              settings = $.extend({}, self.settings, self.data_options($this)),
              is_touch = false;

          if (Modernizr.touch && /touchstart|MSPointerDown/i.test(e.type) && S(e.target).is('a')) {
            return false;
          }

          if (/mouse/i.test(e.type) && self.ie_touch(e)) return false;

          if ($this.hasClass('open')) {
            if (Modernizr.touch && /touchstart|MSPointerDown/i.test(e.type)) e.preventDefault();
            self.hide($this);
          } else {
            if (settings.disable_for_touch && Modernizr.touch && /touchstart|MSPointerDown/i.test(e.type)) {
              return;
            } else if(!settings.disable_for_touch && Modernizr.touch && /touchstart|MSPointerDown/i.test(e.type)) {
              e.preventDefault();
              S(settings.tooltip_class + '.open').hide();
              is_touch = true;
            }

            if (/enter|over/i.test(e.type)) {
              this.timer = setTimeout(function () {
                var tip = self.showTip($this);
              }.bind(this), self.settings.hover_delay);
            } else if (e.type === 'mouseout' || e.type === 'mouseleave') {
              clearTimeout(this.timer);
              self.hide($this);
            } else {
              self.showTip($this);
            }
          }
        })
        .on('mouseleave.fndtn.tooltip touchstart.fndtn.tooltip MSPointerDown.fndtn.tooltip', '[' + this.attr_name() + '].open', function (e) {
          if (/mouse/i.test(e.type) && self.ie_touch(e)) return false;

          if($(this).data('tooltip-open-event-type') == 'touch' && e.type == 'mouseleave') {
            return;
          }
          else if($(this).data('tooltip-open-event-type') == 'mouse' && /MSPointerDown|touchstart/i.test(e.type)) {
            self.convert_to_touch($(this));
          } else {
            self.hide($(this));
          }
        })
        .on('DOMNodeRemoved DOMAttrModified', '[' + this.attr_name() + ']:not(a)', function (e) {
          self.hide(S(this));
        });
    },

    ie_touch : function (e) {
      // How do I distinguish between IE11 and Windows Phone 8?????
      return false;
    },

    showTip : function ($target) {
      var $tip = this.getTip($target);
      if (this.should_show($target, $tip)){
        return this.show($target);
      }
      return;
    },

    getTip : function ($target) {
      var selector = this.selector($target),
          settings = $.extend({}, this.settings, this.data_options($target)),
          tip = null;

      if (selector) {
        tip = this.S('span[data-selector="' + selector + '"]' + settings.tooltip_class);
      }

      return (typeof tip === 'object') ? tip : false;
    },

    selector : function ($target) {
      var id = $target.attr('id'),
          dataSelector = $target.attr(this.attr_name()) || $target.attr('data-selector');

      if ((id && id.length < 1 || !id) && typeof dataSelector != 'string') {
        dataSelector = this.random_str(6);
        $target
          .attr('data-selector', dataSelector)
          .attr('aria-describedby', dataSelector);
      }

      return (id && id.length > 0) ? id : dataSelector;
    },

    create : function ($target) {
      var self = this,
          settings = $.extend({}, this.settings, this.data_options($target)),
          tip_template = this.settings.tip_template;

      if (typeof settings.tip_template === 'string' && window.hasOwnProperty(settings.tip_template)) {
        tip_template = window[settings.tip_template];
      }

      var $tip = $(tip_template(this.selector($target), $('<div></div>').html($target.attr('title')).html())),
          classes = this.inheritable_classes($target);

      $tip.addClass(classes).appendTo(settings.append_to);

      if (Modernizr.touch) {
        $tip.append('<span class="tap-to-close">'+settings.touch_close_text+'</span>');
        $tip.on('touchstart.fndtn.tooltip MSPointerDown.fndtn.tooltip', function(e) {
          self.hide($target);
        });
      }

      $target.removeAttr('title').attr('title','');
    },

    reposition : function (target, tip, classes) {
      var width, nub, nubHeight, nubWidth, column, objPos;

      tip.css('visibility', 'hidden').show();

      width = target.data('width');
      nub = tip.children('.nub');
      nubHeight = nub.outerHeight();
      nubWidth = nub.outerHeight();

      if (this.small()) {
        tip.css({'width' : '100%' });
      } else {
        tip.css({'width' : (width) ? width : 'auto'});
      }

      objPos = function (obj, top, right, bottom, left, width) {
        return obj.css({
          'top' : (top) ? top : 'auto',
          'bottom' : (bottom) ? bottom : 'auto',
          'left' : (left) ? left : 'auto',
          'right' : (right) ? right : 'auto'
        }).end();
      };

      objPos(tip, (target.offset().top + target.outerHeight() + 10), 'auto', 'auto', target.offset().left);

      if (this.small()) {
        objPos(tip, (target.offset().top + target.outerHeight() + 10), 'auto', 'auto', 12.5, $(this.scope).width());
        tip.addClass('tip-override');
        objPos(nub, -nubHeight, 'auto', 'auto', target.offset().left);
      } else {
        var left = target.offset().left;
        if (Foundation.rtl) {
          nub.addClass('rtl');
          left = target.offset().left + target.outerWidth() - tip.outerWidth();
        }
        objPos(tip, (target.offset().top + target.outerHeight() + 10), 'auto', 'auto', left);
        tip.removeClass('tip-override');
        if (classes && classes.indexOf('tip-top') > -1) {
          if (Foundation.rtl) nub.addClass('rtl');
          objPos(tip, (target.offset().top - tip.outerHeight()), 'auto', 'auto', left)
            .removeClass('tip-override');
        } else if (classes && classes.indexOf('tip-left') > -1) {
          objPos(tip, (target.offset().top + (target.outerHeight() / 2) - (tip.outerHeight() / 2)), 'auto', 'auto', (target.offset().left - tip.outerWidth() - nubHeight))
            .removeClass('tip-override');
          nub.removeClass('rtl');
        } else if (classes && classes.indexOf('tip-right') > -1) {
          objPos(tip, (target.offset().top + (target.outerHeight() / 2) - (tip.outerHeight() / 2)), 'auto', 'auto', (target.offset().left + target.outerWidth() + nubHeight))
            .removeClass('tip-override');
          nub.removeClass('rtl');
        }
      }

      tip.css('visibility', 'visible').hide();
    },

    small : function () {
      return matchMedia(Foundation.media_queries.small).matches &&
        !matchMedia(Foundation.media_queries.medium).matches;
    },

    inheritable_classes : function ($target) {
      var settings = $.extend({}, this.settings, this.data_options($target)),
          inheritables = ['tip-top', 'tip-left', 'tip-bottom', 'tip-right', 'radius', 'round'].concat(settings.additional_inheritable_classes),
          classes = $target.attr('class'),
          filtered = classes ? $.map(classes.split(' '), function (el, i) {
            if ($.inArray(el, inheritables) !== -1) {
              return el;
            }
          }).join(' ') : '';

      return $.trim(filtered);
    },

    convert_to_touch : function($target) {
      var self = this,
          $tip = self.getTip($target),
          settings = $.extend({}, self.settings, self.data_options($target));

      if ($tip.find('.tap-to-close').length === 0) {
        $tip.append('<span class="tap-to-close">'+settings.touch_close_text+'</span>');
        $tip.on('click.fndtn.tooltip.tapclose touchstart.fndtn.tooltip.tapclose MSPointerDown.fndtn.tooltip.tapclose', function(e) {
          self.hide($target);
        });
      }

      $target.data('tooltip-open-event-type', 'touch');
    },

    show : function ($target) {
      var $tip = this.getTip($target);

      if ($target.data('tooltip-open-event-type') == 'touch') {
        this.convert_to_touch($target);
      }

      this.reposition($target, $tip, $target.attr('class'));
      $target.addClass('open');
      $tip.fadeIn(150);
    },

    hide : function ($target) {
      var $tip = this.getTip($target);

      $tip.fadeOut(150, function() {
        $tip.find('.tap-to-close').remove();
        $tip.off('click.fndtn.tooltip.tapclose MSPointerDown.fndtn.tapclose');
        $target.removeClass('open');
      });
    },

    off : function () {
      var self = this;
      this.S(this.scope).off('.fndtn.tooltip');
      this.S(this.settings.tooltip_class).each(function (i) {
        $('[' + self.attr_name() + ']').eq(i).attr('title', $(this).text());
      }).remove();
    },

    reflow : function () {}
  };
}(jQuery, window, window.document));

///#source 1 1 Plugins/jquery.idTabs.js
/*! idTabs v3.0 ~ Sean Catchpole - Copyright 2010 MIT/GPL */
;(function($){

/* Changes for 3.0
 - return removed (it was depreciated)
 - passing arguments changed (id,s,e)
 - refresh of code speed and accuracy
 - items now object instead of id's
 - multiple tabs can now point to same id
 - removed autoloading jQuery
 - added item classes support
 - toggle visibility
 - update or remove idTabs
 - grouped areas
 - extend idTabs
*/

/* Options (in any order):

 start (number|string)
    Index number of default tab. ex: $(...).idTabs(0)
    String of id of default tab. ex: $(...).idTabs("#tab1")
    default: class "selected" or index 0
    Passing -1 or null will force it to not select a default tab

 change (boolean)
    True - Url will change. ex: $(...).idTabs(true)
    False - Url will not change. ex: $(...).idTabs(false)
    default: false

 click (function)
    Function will be called when a tab is clicked. ex: $(...).idTabs(function(id,s){...})
    If the function returns false, idTabs will not take any action,
    otherwise idTabs will show/hide the content (as usual).
    The function is passed three variables:
      The id of the element to be shown
      The settings object which has the following additional items:
        area     - the original area $(area).idTabs();
        tabarea  - the current tab area used to find tabs
        tabs     - a jQuery list of tabs
        items    - a jQuery list of the elements the tabs point to
        tab(id)  - a helper function to find a tab with id
        item(id) - a helper function to find an item with id
      The event object that triggered idTabs

 selected (string)
    Class to use for selected. ex: $(...).idTabs(".current")
    default: ".selected"

 event (string)
    Event to trigger idTabs on. ex: $(...).idTabs("!mouseover")
    default: "!click"
    To bind multiple events, call idTabs multiple times
      ex: $(...).idTabs("!click").idTabs("!focus")

 toggle (boolean)
    True - Toggle visibility of tab content. ex: $(...).idTabs("!true")
    False - Ignore clicks on tabs already selected. ex: $(...).idTabs("!false")
    default: false

 grouped (boolean)
    True - Groups all tabs in area together. ex: $(...).idTabs(":grouped")
    False - jQuery selector is seperated into tab areas. ex: $(...).idTabs(":!grouped")
    default: false

 update (boolean)
    True - Rebinds idTabs ex: $(...).idTabs(":update");
    False - Cancels update ex: $(...).idTabs(":!update");

 remove (boolean)
    True - Removes idTabs ex: $(...).idTabs(":remove");
    False - Cancels removal ex: $(...).idTabs(":!remove");

*/

// Helper functions
var idTabs, //shortcut
undefined,  //speed up
href = function(e){ return $(e).attr("href"); },
type = function(o){ //reliable
  return o===null && "Null"
      || o===undefined && "Undefined"
      || ({}).toString.call(o).slice(8,-1);
};

$.fn.idTabs = function(){
  var s = idTabs.args.apply(this,arguments),
  action = s.update&&"update" || s.remove&&"remove" || "bind";
  s.area = this; //save context
  idTabs[action](s);
  return this; //chainable
};

idTabs = $.idTabs = function(tabarea,options,data){
  // Settings
  var e, tabs, items, test=$(), meta = $.metadata?$(tabarea).metadata():{}, //metadata
  s = {tab:idTabs.tab,item:idTabs.item}; //helpers
  s = $.extend(s,idTabs.settings,meta,options||{}); //settings
  s.tabarea = $(tabarea); //save context
  s.data = data||"idTabs"+ +new Date; //save expando

  // Play nice
  $.each({selected:'.',event:'!',start:'#'},function(n,c){
    if(type(s[n])=="String" && s[n].indexOf(c)==0)
      s[n] = s[n].substr(1); }); //removes type characters
  if(s.start===null) s.start=-1; //no tab selected

  // Find tabs
  items = []; //save elements
  s.tabs = tabs = $("a[href^=#]",tabarea); //save tabs
  tabs.each(function(){ //add items
    test = s.item(href(this));
    if(test.length) items=items.concat(test.get());
  });
  s.items = $(items).hide(); //hide items

  // Save Settings
  e="idTabs."+s.event;
  data=s.tabarea.data("idTabs")||{};
  data[e]=s;
  s.tabarea.data("idTabs",data);

  // Bind idTabs
  tabs.trigger(e).data(s.data,s)
      .bind(e,{s:s},function(){ //wrapper function due to jQuery bug
        return idTabs.unbind.apply(this,arguments); })
      .bind(s.event,{s:s},idTabs.find);

  // Select default tab
     type(s.start) == "Number" && (s.start<0 || (test=tabs.eq(s.start)).length)
  || type(s.start) == "String" && (test=tabs.filter("a[href=#"+s.start+"]")).length
  || (test=tabs.filter('.'+s.selected).removeClass(s.selected)).length
  || (s.start===undefined && (test=tabs.eq(0)).length);
  if(test.length) test.trigger(s.event);

  return s; //return current settings (be creative)
};

// Parse arguments into settings
idTabs.args = function(){
  var a,i=0,s={},args=arguments,
  // Handle string flags .!:
  str = function(_,a){
    if(a.indexOf('.')==0) s.selected = a;
    else if(a.indexOf('!')==0)
      if(/^!(true|false)$/i.test(a)) s.toggle = /^!true$/i.test(a);
      else s.event = a;
    else if(a.indexOf(':')==0) {
      a=a.substr(1).toLowerCase();
      if(a.indexOf('!')==0) s[a.substr(1)]=false;
      else s[a]=true;
    } else if(a) s.start = a;
  };
  // Loop through arguments matching options
  while(i<args.length) {
    a=args[i++];
    switch(type(a)){
      case "Object"   : $.extend(s,a); break;
      case "Boolean"  : s.change = a;  break;
      case "Number"   : s.start = a;   break;
      case "Function" : s.click = a;   break;
      case "Null"     : s.start = a;   break;
      case "String"   : $.each(a.split(/\s+/g),str);
      default: break;
    }
  }
  return s; //settings object
};

// Bind idTabs
idTabs.bind = function(s){
  if(!s) return;
  var data = "idTabs"+ +new Date; //instance expando
  if(s.grouped) $.idTabs(s.area,s,data);
  else s.area.each(function(){ $.idTabs(this,s,data); });
};

// Rebind idTabs
idTabs.update = function(s){
  if(!s) return;
  s.update=false;
  var self,data,n,e = s.event;
  e = (e+"").indexOf('!')==0 && e.substr(1) || e;
  e = e?"idTabs."+e:"";
  return s.area.each(function(){
    self = $(this);
    data = self.data("idTabs");
    if(!data) return;
    if(e) {
      n=$.extend({},data[e],s);
      idTabs.remove(data[e])
      idTabs(n.tabarea,n,n.data);
    } else for(e in data) {
      if(!Object.hasOwnProperty.call(data, e)) continue;
      n=$.extend({},data[e],s);
      idTabs.remove(data[e]);
      idTabs(n.tabarea,n,n.data);
    }
  });
};

// Unbind idTabs
idTabs.remove = function(s){
  if(!s) return;
  var data,tabs,e = s.event;
  e = (e+"").indexOf('!')==0 && e.substr(1) || e;
  e = "idTabs"+(e?"."+e:"");
  return s.area.each(function(){
    data=$(this).data("idTabs");
    delete data["idTabs."+s.event];
    $(this).data("idTabs",data);
    tabs = s.tabs || $("a[href^=#]",this); //save tabs
    if(!tabs.length && $(this).is("a[href^=#]")) tabs = $(this);
    tabs.trigger(e);
  });
};

// Find tabs
idTabs.find = function(e){
  // Save self since clicked tab may not be the first tab in the tabarea
  var self=this, ret=false, s=e.data.s;
  // Find first tab within each tabset
  $("a[href="+href(this)+"]:first",s.area).each(function(){
    var t = $(this).data(s.data); //tab's settings
    if(t) ret=idTabs.showtab.call(t.tabarea==s.tabarea?self:this,t,e)||ret;
  });
  return ret;
};

// Show tab
idTabs.showtab = function(s,e){
  if(!s || !s.toggle && $(this).is('.'+s.selected))
    return s&&s.change; //return if already selected
  var id = href(this); //find id
  if(s.click && s.click.call(this,id,s,e)==false) return s.change; //call custom func
  if(s.toggle && $(this).is('.'+s.selected)) id=null; //hide items
  return idTabs.show.call(this,id,s,e); //call default func
};

// Show item
idTabs.show = function(id,s){
  s.tabs.removeClass(s.selected); //clear tabs
  s.tab(id).addClass(s.selected); //select tab(s)
  s.items.hide(); //hide all items
  s.item(id).show(); //show item(s)
  return s.change; //option for changing url
};

// Unbind idTabs
idTabs.unbind = function(e){
  var s = e.data.s;
  $(this).removeData(s.data)
  .unbind("idTabs."+s.event);
  return false;
};

// Extend idTabs
idTabs.extend = function(){
  var args = arguments;
  return function(){
    [].push.apply(args,arguments);
    this.idTabs.apply(this,args);
  };
};

// Matching tabs
idTabs.tab = function(id){
  if(!id) return $([]);
  return $("a[href="+id+"]",this.tabarea);
};

// Matching items
idTabs.item = function(id){
  if(!id) return $([]);
  var item = $(id);
  return item.length?item:$('.'+id.substr(1));
};

// Defaults
idTabs.settings = {
  start:undefined,
  change:false,
  click:null,
  selected:".selected",
  event:"!click",
  toggle:false,
  grouped:false
};

// Version
idTabs.version = "3.0";

// Auto-run
$(function(){ $(".idTabs").idTabs(); });

})(jQuery);

///#source 1 1 Plugins/jquery.collapse.js
(function ($) {
	"use strict"; // jshint ;_;

	$(function () {
		$.support.transition = (function () {
			var transitionEnd = (function () {
				var el = document.createElement('bootstrap')
				  , transEndEventNames = {
				  	'WebkitTransition': 'webkitTransitionEnd'
					, 'MozTransition': 'transitionend'
					, 'OTransition': 'oTransitionEnd otransitionend'
					, 'transition': 'transitionend'
				  }
				  , name

				for (name in transEndEventNames) {
					if (el.style[name] !== undefined) {
						return transEndEventNames[name]
					}
				}
			}())

			return transitionEnd && {
				end: transitionEnd
			}
		})()
	})
})(jQuery);

(function ($) {
	"use strict"; // jshint ;_;

	/* COLLAPSE PUBLIC CLASS DEFINITION
	 * ================================ */

	var Collapse = function (element, options) {
		this.$element = $(element)
		this.options = $.extend({}, $.fn.collapse.defaults, options)

		if (this.options.parent) {
			this.$parent = $(this.options.parent)
		}

		this.options.toggle && this.toggle()
	}

	Collapse.prototype = {
		constructor: Collapse

	, dimension: function () {
		var hasWidth = this.$element.hasClass('width')
		return hasWidth ? 'width' : 'height'
	}

	, show: function () {
		var dimension
		  , scroll
		  , actives
		  , hasData

		if (this.transitioning || this.$element.hasClass('in')) return

		dimension = this.dimension()
		scroll = $.camelCase(['scroll', dimension].join('-'))
		actives = this.$parent && this.$parent.find('> .accordion-group > .in')

		if (actives && actives.length) {
			hasData = actives.data('collapse')
			if (hasData && hasData.transitioning) return
			actives.collapse('hide')
			hasData || actives.data('collapse', null)
		}

		this.$element[dimension](0)
		this.transition('addClass', $.Event('show'), 'shown')
		$.support.transition && this.$element[dimension](this.$element[0][scroll])
	}

	, hide: function () {
		var dimension
		if (this.transitioning || !this.$element.hasClass('in')) return
		dimension = this.dimension()
		this.reset(this.$element[dimension]())
		this.transition('removeClass', $.Event('hide'), 'hidden')
		this.$element[dimension](0)
	}

	, reset: function (size) {
		var dimension = this.dimension()

		this.$element
		  .removeClass('collapse')
		  [dimension](size || 'auto')
		  [0].offsetWidth

		this.$element[size !== null ? 'addClass' : 'removeClass']('collapse')

		return this
	}

	, transition: function (method, startEvent, completeEvent) {
		var that = this
		  , complete = function () {
		  	if (startEvent.type == 'show') that.reset()
		  	that.transitioning = 0
		  	that.$element.trigger(completeEvent)
		  }

		this.$element.trigger(startEvent)

		if (startEvent.isDefaultPrevented()) return

		this.transitioning = 1

		this.$element[method]('in')

		$.support.transition && this.$element.hasClass('collapse') ?
		  this.$element.one($.support.transition.end, complete) :
		  complete()
	}

	, toggle: function () {
		this[this.$element.hasClass('in') ? 'hide' : 'show']()
	}
	}

	/* COLLAPSE PLUGIN DEFINITION
	 * ========================== */

	var old = $.fn.collapse

	$.fn.collapse = function (option) {
		return this.each(function () {
			var $this = $(this)
			  , data = $this.data('collapse')
			  , options = $.extend({}, $.fn.collapse.defaults, $this.data(), typeof option == 'object' && option)
			if (!data) $this.data('collapse', (data = new Collapse(this, options)))
			if (typeof option == 'string') data[option]()
		})
	}

	$.fn.collapse.defaults = {
		toggle: true
	}

	$.fn.collapse.Constructor = Collapse

	/* COLLAPSE NO CONFLICT
	 * ==================== */

	$.fn.collapse.noConflict = function () {
		$.fn.collapse = old
		return this
	}

	/* COLLAPSE DATA-API
	 * ================= */

	$(document).on('click.collapse.data-api', '[data-toggle=collapse]', function (e) {
		if ($(window).width() < 768 || $(this).data('toggle-always')) {
			var $this = $(this), href
              , target = $this.attr('data-target')
                || e.preventDefault()
                || (href = $this.attr('href')) && href.replace(/.*(?=#[^\s]+$)/, '') //strip for ie7
              , option = $(target).data('collapse') ? 'toggle' : $this.data();
			$this[$(target).hasClass('in') ? 'addClass' : 'removeClass']('collapsed');
			$this[$(target).hasClass('in') ? 'removeClass' : 'addClass']('active');
			$(target).collapse(option);
		}
	});

	$('[data-toggle]').on('click', function () {
		if ($(window).width() < 768 || $(this).data('toggle-always')) {
			$(this).toggleClass('active');
		}
	});

	$(window).load(function () {
		$(function () {
			$('#accordion1').on('show', function (e) {
				$(e.target).prev('.nav-link').find('[data-toggle]').addClass('active');
			});

			$('#accordion1').on('hide', function (e) {
				$(this).find('[data-toggle]').not($(e.target)).removeClass('active');
			});
		});
	});//]]>
})(window.jQuery);

(function ($) {
	$(document).ready(function () {
		//ACCORDION BUTTON ACTION (ON CLICK DO THE FOLLOWING)
		$('.accordionButton1').click(function () {
			//REMOVE THE ON CLASS FROM ALL BUTTONS
			$('.accordionButton1').removeClass('active');

			//NO MATTER WHAT WE CLOSE ALL OPEN SLIDES
			$('.accordionContent1').slideUp('normal', function(){
			    //$('.stock-info .dropbox-in article aside .info-box-in p').dotdotdot({height:60}) 
            });

			//IF THE NEXT SLIDE WASN'T OPEN THEN OPEN IT
			if ($(this).next().is(':hidden') == true) {
				//ADD THE ON CLASS TO THE BUTTON
				$(this).addClass('active');

				//OPEN THE SLIDE
				$(this).next().slideDown('normal');
			}
		});

		/*** REMOVE IF MOUSEOVER IS NOT REQUIRED ***/

		//ADDS THE .OVER CLASS FROM THE STYLESHEET ON MOUSEOVER
		$('.accordionButton1').mouseover(function () {
			$(this).addClass('over');

			//ON MOUSEOUT REMOVE THE OVER CLASS
		}).mouseout(function () {
			$(this).removeClass('over');
		});

		/*** END REMOVE IF MOUSEOVER IS NOT REQUIRED ***/
	});

	$(document).ready(function () {
		//ACCORDION BUTTON ACTION (ON CLICK DO THE FOLLOWING)
		$('.accordionButton2').click(function () {
			//REMOVE THE ON CLASS FROM ALL BUTTONS
			$('.accordionButton2').removeClass('active');

			//NO MATTER WHAT WE CLOSE ALL OPEN SLIDES
			$('.accordionContent2').slideUp('normal');

			//IF THE NEXT SLIDE WASN'T OPEN THEN OPEN IT
			if ($(this).next().is(':hidden') == true) {
				//ADD THE ON CLASS TO THE BUTTON
				$(this).addClass('active');

				//OPEN THE SLIDE
				$(this).next().slideDown('normal');
			}
		});

		/*** REMOVE IF MOUSEOVER IS NOT REQUIRED ***/

		//ADDS THE .OVER CLASS FROM THE STYLESHEET ON MOUSEOVER
		$('.accordionButton2').mouseover(function () {
			$(this).addClass('over');

			//ON MOUSEOUT REMOVE THE OVER CLASS
		}).mouseout(function () {
			$(this).removeClass('over');
		});

		/*** END REMOVE IF MOUSEOVER IS NOT REQUIRED ***/
	});

	$(document).ready(function () {
	    //ACCORDION BUTTON ACTION (ON CLICK DO THE FOLLOWING)
	    $('.accordionButton3').click(function () {
	        //REMOVE THE ON CLASS FROM ALL BUTTONS
	        $('.accordionButton3').removeClass('active');

	        //NO MATTER WHAT WE CLOSE ALL OPEN SLIDES
	        $('.accordionContent3').slideUp('normal');

	        //IF THE NEXT SLIDE WASN'T OPEN THEN OPEN IT
	        if ($(this).next().is(':hidden') == true) {
	            //ADD THE ON CLASS TO THE BUTTON
	            $(this).addClass('active');

	            //OPEN THE SLIDE
	            $(this).next().slideDown('normal');
	        }
	    });

	    /*** REMOVE IF MOUSEOVER IS NOT REQUIRED ***/

	    //ADDS THE .OVER CLASS FROM THE STYLESHEET ON MOUSEOVER
	    $('.accordionButton3').mouseover(function () {
	        $(this).addClass('over');

	        //ON MOUSEOUT REMOVE THE OVER CLASS
	    }).mouseout(function () {
	        $(this).removeClass('over');
	    });

	    /*** END REMOVE IF MOUSEOVER IS NOT REQUIRED ***/
	});

	$(document).ready(function () {
		//ACCORDION BUTTON ACTION (ON CLICK DO THE FOLLOWING)
		$('.accordionButton4').click(function () {
			//REMOVE THE ON CLASS FROM ALL BUTTONS
			$('.accordionButton4').removeClass('active');

			//NO MATTER WHAT WE CLOSE ALL OPEN SLIDES
			$('.accordionContent4').slideUp('normal');

			//IF THE NEXT SLIDE WASN'T OPEN THEN OPEN IT
			if ($(this).next().is(':hidden') == true) {
				//ADD THE ON CLASS TO THE BUTTON
				$(this).addClass('active');

				//OPEN THE SLIDE
				$(this).next().slideDown('normal');
			}
		});

		/*** REMOVE IF MOUSEOVER IS NOT REQUIRED ***/

		//ADDS THE .OVER CLASS FROM THE STYLESHEET ON MOUSEOVER
		$('.accordionButton4').mouseover(function () {
			$(this).addClass('over');

			//ON MOUSEOUT REMOVE THE OVER CLASS
		}).mouseout(function () {
			$(this).removeClass('over');
		});

		/*** END REMOVE IF MOUSEOVER IS NOT REQUIRED ***/
	});

	$(document).ready(function () {
		//ACCORDION BUTTON ACTION (ON CLICK DO THE FOLLOWING)
		$('.accordionButton5').click(function () {
			//REMOVE THE ON CLASS FROM ALL BUTTONS
			$('.accordionButton5').removeClass('active');

			//NO MATTER WHAT WE CLOSE ALL OPEN SLIDES
			$('.accordionContent5').slideUp('normal');

			//IF THE NEXT SLIDE WASN'T OPEN THEN OPEN IT
			if ($(this).next().is(':hidden') == true) {
				//ADD THE ON CLASS TO THE BUTTON
				$(this).addClass('active');

				//OPEN THE SLIDE
				$(this).next().slideDown('normal');
			}
		});

		/*** REMOVE IF MOUSEOVER IS NOT REQUIRED ***/

		//ADDS THE .OVER CLASS FROM THE STYLESHEET ON MOUSEOVER
		$('.accordionButton5').mouseover(function () {
			$(this).addClass('over');

			//ON MOUSEOUT REMOVE THE OVER CLASS
		}).mouseout(function () {
			$(this).removeClass('over');
		});

		/*** END REMOVE IF MOUSEOVER IS NOT REQUIRED ***/
	});

	$(document).ready(function () {
		//ACCORDION BUTTON ACTION (ON CLICK DO THE FOLLOWING)
		$('.accordionButton6').click(function () {
			//REMOVE THE ON CLASS FROM ALL BUTTONS
			$('.accordionButton6').removeClass('active');

			//NO MATTER WHAT WE CLOSE ALL OPEN SLIDES
			$('.accordionContent6').slideUp('normal');

			//IF THE NEXT SLIDE WASN'T OPEN THEN OPEN IT
			if ($(this).next().is(':hidden') == true) {
				//ADD THE ON CLASS TO THE BUTTON
				$(this).addClass('active');

				//OPEN THE SLIDE
				$(this).next().slideDown('normal');
			}
		});

		/*** REMOVE IF MOUSEOVER IS NOT REQUIRED ***/

		//ADDS THE .OVER CLASS FROM THE STYLESHEET ON MOUSEOVER
		$('.accordionButton6').mouseover(function () {
			$(this).addClass('over');

			//ON MOUSEOUT REMOVE THE OVER CLASS
		}).mouseout(function () {
			$(this).removeClass('over');
		});

		/*** END REMOVE IF MOUSEOVER IS NOT REQUIRED ***/
	});

	$(document).ready(function () {
		//ACCORDION BUTTON ACTION (ON CLICK DO THE FOLLOWING)
		$('.accordionButton7').click(function () {
			//REMOVE THE ON CLASS FROM ALL BUTTONS
			$('.accordionButton7').removeClass('active');

			//NO MATTER WHAT WE CLOSE ALL OPEN SLIDES
			$('.accordionContent7').slideUp('normal');

			//IF THE NEXT SLIDE WASN'T OPEN THEN OPEN IT
			if ($(this).next().is(':hidden') == true) {
				//ADD THE ON CLASS TO THE BUTTON
				$(this).addClass('active');

				//OPEN THE SLIDE
				$(this).next().slideDown('normal');
			}
		});

		/*** REMOVE IF MOUSEOVER IS NOT REQUIRED ***/

		//ADDS THE .OVER CLASS FROM THE STYLESHEET ON MOUSEOVER
		$('.accordionButton7').mouseover(function () {
			$(this).addClass('over');

			//ON MOUSEOUT REMOVE THE OVER CLASS
		}).mouseout(function () {
			$(this).removeClass('over');
		});

		/*** END REMOVE IF MOUSEOVER IS NOT REQUIRED ***/
	});

	$(document).ready(function () {
		//ACCORDION BUTTON ACTION (ON CLICK DO THE FOLLOWING)
		$('.accordionButton8').click(function () {
			//REMOVE THE ON CLASS FROM ALL BUTTONS
			$('.accordionButton8').removeClass('active');

			//NO MATTER WHAT WE CLOSE ALL OPEN SLIDES
			$('.accordionContent8').slideUp('normal');

			//IF THE NEXT SLIDE WASN'T OPEN THEN OPEN IT
			if ($(this).next().is(':hidden') == true) {
				//ADD THE ON CLASS TO THE BUTTON
				$(this).addClass('active');

				//OPEN THE SLIDE
				$(this).next().slideDown('normal');
			}
		});

		/*** REMOVE IF MOUSEOVER IS NOT REQUIRED ***/

		//ADDS THE .OVER CLASS FROM THE STYLESHEET ON MOUSEOVER
		$('.accordionButton8').mouseover(function () {
			$(this).addClass('over');

			//ON MOUSEOUT REMOVE THE OVER CLASS
		}).mouseout(function () {
			$(this).removeClass('over');
		});

		/*** END REMOVE IF MOUSEOVER IS NOT REQUIRED ***/
	});

	$(document).ready(function () {
		//ACCORDION BUTTON ACTION (ON CLICK DO THE FOLLOWING)
		$('.accordionButton9').click(function () {
			//REMOVE THE ON CLASS FROM ALL BUTTONS
			$('.accordionButton9').removeClass('active');

			//NO MATTER WHAT WE CLOSE ALL OPEN SLIDES
			$('.accordionContent9').slideUp('normal');

			//IF THE NEXT SLIDE WASN'T OPEN THEN OPEN IT
			if ($(this).next().is(':hidden') == true) {
				//ADD THE ON CLASS TO THE BUTTON
				$(this).addClass('active');

				//OPEN THE SLIDE
				$(this).next().slideDown('normal');
			}
		});

		/*** REMOVE IF MOUSEOVER IS NOT REQUIRED ***/

		//ADDS THE .OVER CLASS FROM THE STYLESHEET ON MOUSEOVER
		$('.accordionButton9').mouseover(function () {
			$(this).addClass('over');

			//ON MOUSEOUT REMOVE THE OVER CLASS
		}).mouseout(function () {
			$(this).removeClass('over');
		});

		/*** END REMOVE IF MOUSEOVER IS NOT REQUIRED ***/
	});
})(jQuery);
///#source 1 1 Plugins/placeholder.js
/*! http://mths.be/placeholder v2.0.8 by @mathias */
(function(a,b,c){function d(a){var b={},d=/^jQuery\d+$/;return c.each(a.attributes,function(a,c){c.specified&&!d.test(c.name)&&(b[c.name]=c.value)}),b}function e(a,b){var d=this,e=c(d);if(d.value==e.attr("placeholder")&&e.hasClass("placeholder"))if(e.data("placeholder-password")){if(e=e.hide().next().show().attr("id",e.removeAttr("id").data("placeholder-id")),a===!0)return e[0].value=b;e.focus()}else d.value="",e.removeClass("placeholder"),d==g()&&d.select()}function f(){var a,b=this,f=c(b),g=this.id;if(""==b.value){if("password"==b.type){if(!f.data("placeholder-textinput")){try{a=f.clone().attr({type:"text"})}catch(h){a=c("<input>").attr(c.extend(d(this),{type:"text"}))}a.removeAttr("name").data({"placeholder-password":f,"placeholder-id":g}).bind("focus.placeholder",e),f.data({"placeholder-textinput":a,"placeholder-id":g}).before(a)}f=f.removeAttr("id").hide().prev().attr("id",g).show()}f.addClass("placeholder"),f[0].value=f.attr("placeholder")}else f.removeClass("placeholder")}function g(){try{return b.activeElement}catch(a){}}var h,i,j="[object OperaMini]"==Object.prototype.toString.call(a.operamini),k="placeholder"in b.createElement("input")&&!j,l="placeholder"in b.createElement("textarea")&&!j,m=c.fn,n=c.valHooks,o=c.propHooks;k&&l?(i=m.placeholder=function(){return this},i.input=i.textarea=!0):(i=m.placeholder=function(){var a=this;return a.filter((k?"textarea":":input")+"[placeholder]").not(".placeholder").bind({"focus.placeholder":e,"blur.placeholder":f}).data("placeholder-enabled",!0).trigger("blur.placeholder"),a},i.input=k,i.textarea=l,h={get:function(a){var b=c(a),d=b.data("placeholder-password");return d?d[0].value:b.data("placeholder-enabled")&&b.hasClass("placeholder")?"":a.value},set:function(a,b){var d=c(a),h=d.data("placeholder-password");return h?h[0].value=b:d.data("placeholder-enabled")?(""==b?(a.value=b,a!=g()&&f.call(a)):d.hasClass("placeholder")?e.call(a,!0,b)||(a.value=b):a.value=b,d):a.value=b}},k||(n.input=h,o.value=h),l||(n.textarea=h,o.value=h),c(function(){c(b).delegate("form","submit.placeholder",function(){var a=c(".placeholder",this).each(e);setTimeout(function(){a.each(f)},10)})}),c(a).bind("beforeunload.placeholder",function(){c(".placeholder").each(function(){this.value=""})}))})(this,document,jQuery);

///#source 1 1 Plugins/jquery.flexslider.js
/*
 * jQuery FlexSlider v2.2.2
 * Copyright 2012 WooThemes
 * Contributing Author: Tyler Smith
 */
;
(function ($) {

	//FlexSlider: Object Instance
	$.flexslider = function (el, options) {
		var slider = $(el);

		// making variables public
		slider.vars = $.extend({}, $.flexslider.defaults, options);

		var namespace = slider.vars.namespace,
			msGesture = window.navigator && window.navigator.msPointerEnabled && window.MSGesture,
			touch = (("ontouchstart" in window) || msGesture || window.DocumentTouch && document instanceof DocumentTouch) && slider.vars.touch,
			// depricating this idea, as devices are being released with both of these events
			//eventType = (touch) ? "touchend" : "click",
			eventType = "click touchend MSPointerUp",
			watchedEvent = "",
			watchedEventClearTimer,
			vertical = slider.vars.direction === "vertical",
			reverse = slider.vars.reverse,
			carousel = (slider.vars.itemWidth > 0),
			fade = slider.vars.animation === "fade",
			asNav = slider.vars.asNavFor !== "",
			methods = {},
			focused = true;

		// Store a reference to the slider object
		$.data(el, "flexslider", slider);

		// Private slider methods
		methods = {
			init: function () {
				slider.animating = false;
				// Get current slide and make sure it is a number
				slider.currentSlide = parseInt((slider.vars.startAt ? slider.vars.startAt : 0), 10);
				if (isNaN(slider.currentSlide)) slider.currentSlide = 0;
				slider.animatingTo = slider.currentSlide;
				slider.atEnd = (slider.currentSlide === 0 || slider.currentSlide === slider.last);
				slider.containerSelector = slider.vars.selector.substr(0, slider.vars.selector.search(' '));
				slider.slides = $(slider.vars.selector, slider);
				slider.container = $(slider.containerSelector, slider);
				slider.count = slider.slides.length;
				// SYNC:
				slider.syncExists = $(slider.vars.sync).length > 0;
				// SLIDE:
				if (slider.vars.animation === "slide") slider.vars.animation = "swing";
				slider.prop = (vertical) ? "top" : "marginLeft";
				slider.args = {};
				// SLIDESHOW:
				slider.manualPause = false;
				slider.stopped = false;
				//PAUSE WHEN INVISIBLE
				slider.started = false;
				slider.startTimeout = null;
				// TOUCH/USECSS:
				slider.transitions = !slider.vars.video && !fade && slider.vars.useCSS && (function () {
					var obj = document.createElement('div'),
						props = ['perspectiveProperty', 'WebkitPerspective', 'MozPerspective', 'OPerspective', 'msPerspective'];
					for (var i in props) {
						if (obj.style[props[i]] !== undefined) {
							slider.pfx = props[i].replace('Perspective', '').toLowerCase();
							slider.prop = "-" + slider.pfx + "-transform";
							return true;
						}
					}
					return false;
				}());
				// CONTROLSCONTAINER:
				if (slider.vars.controlsContainer !== "") slider.controlsContainer = $(slider.vars.controlsContainer).length > 0 && $(slider.vars.controlsContainer);
				// MANUAL:
				if (slider.vars.manualControls !== "") slider.manualControls = $(slider.vars.manualControls).length > 0 && $(slider.vars.manualControls);

				// RANDOMIZE:
				if (slider.vars.randomize) {
					slider.slides.sort(function () { return (Math.round(Math.random()) - 0.5); });
					slider.container.empty().append(slider.slides);
				}

				slider.doMath();

				// INIT
				slider.setup("init");

				// CONTROLNAV:
				if (slider.vars.controlNav) methods.controlNav.setup();

				// DIRECTIONNAV:
				if (slider.vars.directionNav) methods.directionNav.setup();

				// KEYBOARD:
				if (slider.vars.keyboard && ($(slider.containerSelector).length === 1 || slider.vars.multipleKeyboard)) {
					$(document).bind('keyup', function (event) {
						var keycode = event.keyCode;
						if (!slider.animating && (keycode === 39 || keycode === 37)) {
							var target = (keycode === 39) ? slider.getTarget('next') :
										 (keycode === 37) ? slider.getTarget('prev') : false;
							slider.flexAnimate(target, slider.vars.pauseOnAction);
						}
					});
				}
				// MOUSEWHEEL:
				if (slider.vars.mousewheel) {
					slider.bind('mousewheel', function (event, delta, deltaX, deltaY) {
						event.preventDefault();
						var target = (delta < 0) ? slider.getTarget('next') : slider.getTarget('prev');
						slider.flexAnimate(target, slider.vars.pauseOnAction);
					});
				}

				// PAUSEPLAY
				if (slider.vars.pausePlay) methods.pausePlay.setup();

				//PAUSE WHEN INVISIBLE
				if (slider.vars.slideshow && slider.vars.pauseInvisible) methods.pauseInvisible.init();

				// SLIDSESHOW
				if (slider.vars.slideshow) {
					if (slider.vars.pauseOnHover) {
						slider.hover(function () {
							if (!slider.manualPlay && !slider.manualPause) slider.pause();
						}, function () {
							if (!slider.manualPause && !slider.manualPlay && !slider.stopped) slider.play();
						});
					}
					// initialize animation
					//If we're visible, or we don't use PageVisibility API
					if (!slider.vars.pauseInvisible || !methods.pauseInvisible.isHidden()) {
						(slider.vars.initDelay > 0) ? slider.startTimeout = setTimeout(slider.play, slider.vars.initDelay) : slider.play();
					}
				}

				// ASNAV:
				if (asNav) methods.asNav.setup();

				// TOUCH
				if (touch && slider.vars.touch) methods.touch();

				// FADE&&SMOOTHHEIGHT || SLIDE:
				if (!fade || (fade && slider.vars.smoothHeight)) $(window).bind("resize orientationchange focus", methods.resize);

				slider.find("img").attr("draggable", "false");

				// API: start() Callback
				setTimeout(function () {
					slider.vars.start(slider);
				}, 200);
			},
			asNav: {
				setup: function () {
					slider.asNav = true;
					slider.animatingTo = Math.floor(slider.currentSlide / slider.move);
					slider.currentItem = slider.currentSlide;
					slider.slides.removeClass(namespace + "active-slide").eq(slider.currentItem).addClass(namespace + "active-slide");
					if (!msGesture) {
						slider.slides.on(eventType, function (e) {
							e.preventDefault();
							var $slide = $(this),
								target = $slide.index();
							var posFromLeft = $slide.offset().left - $(slider).scrollLeft(); // Find position of slide relative to left of slider container
							if (posFromLeft <= 0 && $slide.hasClass(namespace + 'active-slide')) {
								slider.flexAnimate(slider.getTarget("prev"), true);
							} else if (!$(slider.vars.asNavFor).data('flexslider').animating && !$slide.hasClass(namespace + "active-slide")) {
								slider.direction = (slider.currentItem < target) ? "next" : "prev";
								slider.flexAnimate(target, slider.vars.pauseOnAction, false, true, true);
							}
						});
					} else {
						el._slider = slider;
						slider.slides.each(function () {
							var that = this;
							that._gesture = new MSGesture();
							that._gesture.target = that;
							that.addEventListener("MSPointerDown", function (e) {
								e.preventDefault();
								if (e.currentTarget._gesture)
									e.currentTarget._gesture.addPointer(e.pointerId);
							}, false);
							that.addEventListener("MSGestureTap", function (e) {
								e.preventDefault();
								var $slide = $(this),
									target = $slide.index();
								if (!$(slider.vars.asNavFor).data('flexslider').animating && !$slide.hasClass('active')) {
									slider.direction = (slider.currentItem < target) ? "next" : "prev";
									slider.flexAnimate(target, slider.vars.pauseOnAction, false, true, true);
								}
							});
						});
					}
				}
			},
			controlNav: {
				setup: function () {
					if (!slider.manualControls) {
						methods.controlNav.setupPaging();
					} else { // MANUALCONTROLS:
						methods.controlNav.setupManual();
					}
				},
				setupPaging: function () {
					var type = (slider.vars.controlNav === "thumbnails") ? 'control-thumbs' : 'control-paging',
						j = 1,
						item,
						slide;

					slider.controlNavScaffold = $('<ol class="' + namespace + 'control-nav ' + namespace + type + '"></ol>');

					if (slider.pagingCount > 1) {
						for (var i = 0; i < slider.pagingCount; i++) {
							slide = slider.slides.eq(i);
							item = (slider.vars.controlNav === "thumbnails") ? '<img src="' + slide.attr('data-thumb') + '"/>' : '<a>' + j + '</a>';
							if ('thumbnails' === slider.vars.controlNav && true === slider.vars.thumbCaptions) {
								var captn = slide.attr('data-thumbcaption');
								if ('' != captn && undefined != captn) item += '<span class="' + namespace + 'caption">' + captn + '</span>';
							}
							slider.controlNavScaffold.append('<li>' + item + '</li>');
							j++;
						}
					}

					// CONTROLSCONTAINER:
					(slider.controlsContainer) ? $(slider.controlsContainer).append(slider.controlNavScaffold) : slider.append(slider.controlNavScaffold);
					methods.controlNav.set();

					methods.controlNav.active();

					slider.controlNavScaffold.delegate('a, img', eventType, function (event) {
						event.preventDefault();

						if (watchedEvent === "" || watchedEvent === event.type) {
							var $this = $(this),
								target = slider.controlNav.index($this);

							if (!$this.hasClass(namespace + 'active')) {
								slider.direction = (target > slider.currentSlide) ? "next" : "prev";
								slider.flexAnimate(target, slider.vars.pauseOnAction);
							}
						}

						// setup flags to prevent event duplication
						if (watchedEvent === "") {
							watchedEvent = event.type;
						}
						methods.setToClearWatchedEvent();

					});
				},
				setupManual: function () {
					slider.controlNav = slider.manualControls;
					methods.controlNav.active();

					slider.controlNav.bind(eventType, function (event) {
						event.preventDefault();

						if (watchedEvent === "" || watchedEvent === event.type) {
							var $this = $(this),
								target = slider.controlNav.index($this);

							if (!$this.hasClass(namespace + 'active')) {
								(target > slider.currentSlide) ? slider.direction = "next" : slider.direction = "prev";
								slider.flexAnimate(target, slider.vars.pauseOnAction);
							}
						}

						// setup flags to prevent event duplication
						if (watchedEvent === "") {
							watchedEvent = event.type;
						}
						methods.setToClearWatchedEvent();
					});
				},
				set: function () {
					var selector = (slider.vars.controlNav === "thumbnails") ? 'img' : 'a';
					slider.controlNav = $('.' + namespace + 'control-nav li ' + selector, (slider.controlsContainer) ? slider.controlsContainer : slider);
				},
				active: function () {
					slider.controlNav.removeClass(namespace + "active").eq(slider.animatingTo).addClass(namespace + "active");
				},
				update: function (action, pos) {
					if (slider.pagingCount > 1 && action === "add") {
						slider.controlNavScaffold.append($('<li><a>' + slider.count + '</a></li>'));
					} else if (slider.pagingCount === 1) {
						slider.controlNavScaffold.find('li').remove();
					} else {
						slider.controlNav.eq(pos).closest('li').remove();
					}
					methods.controlNav.set();
					(slider.pagingCount > 1 && slider.pagingCount !== slider.controlNav.length) ? slider.update(pos, action) : methods.controlNav.active();
				}
			},
			directionNav: {
				setup: function () {
					var directionNavScaffold = $('<ul class="' + namespace + 'direction-nav"><li><a class="' + namespace + 'prev" href="#">' + slider.vars.prevText + '</a></li><li><a class="' + namespace + 'next" href="#">' + slider.vars.nextText + '</a></li></ul>');

					// CONTROLSCONTAINER:
					if (slider.controlsContainer) {
						$(slider.controlsContainer).append(directionNavScaffold);
						slider.directionNav = $('.' + namespace + 'direction-nav li a', slider.controlsContainer);
					} else {
						slider.append(directionNavScaffold);
						slider.directionNav = $('.' + namespace + 'direction-nav li a', slider);
					}

					methods.directionNav.update();

					slider.directionNav.bind(eventType, function (event) {
						event.preventDefault();
						var target;

						if (watchedEvent === "" || watchedEvent === event.type) {
							target = ($(this).hasClass(namespace + 'next')) ? slider.getTarget('next') : slider.getTarget('prev');
							slider.flexAnimate(target, slider.vars.pauseOnAction);
						}

						// setup flags to prevent event duplication
						if (watchedEvent === "") {
							watchedEvent = event.type;
						}
						methods.setToClearWatchedEvent();
					});
				},
				update: function () {
					var disabledClass = namespace + 'disabled';
					if (slider.pagingCount === 1) {
						slider.directionNav.addClass(disabledClass).attr('tabindex', '-1');
					} else if (!slider.vars.animationLoop) {
						if (slider.animatingTo === 0) {
							slider.directionNav.removeClass(disabledClass).filter('.' + namespace + "prev").addClass(disabledClass).attr('tabindex', '-1');
						} else if (slider.animatingTo === slider.last) {
							slider.directionNav.removeClass(disabledClass).filter('.' + namespace + "next").addClass(disabledClass).attr('tabindex', '-1');
						} else {
							slider.directionNav.removeClass(disabledClass).removeAttr('tabindex');
						}
					} else {
						slider.directionNav.removeClass(disabledClass).removeAttr('tabindex');
					}
				}
			},
			pausePlay: {
				setup: function () {
					var pausePlayScaffold = $('<div class="' + namespace + 'pauseplay"><a></a></div>');

					// CONTROLSCONTAINER:
					if (slider.controlsContainer) {
						slider.controlsContainer.append(pausePlayScaffold);
						slider.pausePlay = $('.' + namespace + 'pauseplay a', slider.controlsContainer);
					} else {
						slider.append(pausePlayScaffold);
						slider.pausePlay = $('.' + namespace + 'pauseplay a', slider);
					}

					methods.pausePlay.update((slider.vars.slideshow) ? namespace + 'pause' : namespace + 'play');

					slider.pausePlay.bind(eventType, function (event) {
						event.preventDefault();

						if (watchedEvent === "" || watchedEvent === event.type) {
							if ($(this).hasClass(namespace + 'pause')) {
								slider.manualPause = true;
								slider.manualPlay = false;
								slider.pause();
							} else {
								slider.manualPause = false;
								slider.manualPlay = true;
								slider.play();
							}
						}

						// setup flags to prevent event duplication
						if (watchedEvent === "") {
							watchedEvent = event.type;
						}
						methods.setToClearWatchedEvent();
					});
				},
				update: function (state) {
					(state === "play") ? slider.pausePlay.removeClass(namespace + 'pause').addClass(namespace + 'play').html(slider.vars.playText) : slider.pausePlay.removeClass(namespace + 'play').addClass(namespace + 'pause').html(slider.vars.pauseText);
				}
			},
			touch: function () {
				var startX,
				  startY,
				  offset,
				  cwidth,
				  dx,
				  startT,
				  onTouchStart,
				  onTouchMove,
				  onTouchEnd,
				  scrolling = false,
				  localX = 0,
				  localY = 0,
				  accDx = 0;

				if (!msGesture) {
					onTouchMove = function (e) {
						// Local vars for X and Y points.

						localX = e.touches[0].pageX;
						localY = e.touches[0].pageY;

						dx = (vertical) ? startX - localY : startX - localX;
						scrolling = (vertical) ? (Math.abs(dx) < Math.abs(localX - startY)) : (Math.abs(dx) < Math.abs(localY - startY));

						var fxms = 500;

						if (!scrolling || Number(new Date()) - startT > fxms) {
							e.preventDefault();
							if (!fade && slider.transitions) {
								if (!slider.vars.animationLoop) {
									dx = dx / ((slider.currentSlide === 0 && dx < 0 || slider.currentSlide === slider.last && dx > 0) ? (Math.abs(dx) / cwidth + 2) : 1);
								}
								slider.setProps(offset + dx, "setTouch");
							}
						}
					};

					onTouchEnd = function (e) {
						// finish the touch by undoing the touch session
						el.removeEventListener('touchmove', onTouchMove, false);

						if (slider.animatingTo === slider.currentSlide && !scrolling && !(dx === null)) {
							var updateDx = (reverse) ? -dx : dx,
								target = (updateDx > 0) ? slider.getTarget('next') : slider.getTarget('prev');

							if (slider.canAdvance(target) && (Number(new Date()) - startT < 550 && Math.abs(updateDx) > 50 || Math.abs(updateDx) > cwidth / 2)) {
								slider.flexAnimate(target, slider.vars.pauseOnAction);
							} else {
								if (!fade) slider.flexAnimate(slider.currentSlide, slider.vars.pauseOnAction, true);
							}
						}
						el.removeEventListener('touchend', onTouchEnd, false);

						startX = null;
						startY = null;
						dx = null;
						offset = null;
					};

					onTouchStart = function (e) {
						if (slider.animating) {
							e.preventDefault();
						} else if ((window.navigator.msPointerEnabled) || e.touches.length === 1) {
							slider.pause();
							// CAROUSEL:
							cwidth = (vertical) ? slider.h : slider.w;
							startT = Number(new Date());
							// CAROUSEL:

							// Local vars for X and Y points.
							localX = e.touches[0].pageX;
							localY = e.touches[0].pageY;

							offset = (carousel && reverse && slider.animatingTo === slider.last) ? 0 :
									 (carousel && reverse) ? slider.limit - (((slider.itemW + slider.vars.itemMargin) * slider.move) * slider.animatingTo) :
									 (carousel && slider.currentSlide === slider.last) ? slider.limit :
									 (carousel) ? ((slider.itemW + slider.vars.itemMargin) * slider.move) * slider.currentSlide :
									 (reverse) ? (slider.last - slider.currentSlide + slider.cloneOffset) * cwidth : (slider.currentSlide + slider.cloneOffset) * cwidth;
							startX = (vertical) ? localY : localX;
							startY = (vertical) ? localX : localY;

							el.addEventListener('touchmove', onTouchMove, false);
							el.addEventListener('touchend', onTouchEnd, false);
						}
					};

					el.addEventListener('touchstart', onTouchStart, false);
				} else {
					el.style.msTouchAction = "none";
					el._gesture = new MSGesture();
					el._gesture.target = el;
					el.addEventListener("MSPointerDown", onMSPointerDown, false);
					el._slider = slider;
					el.addEventListener("MSGestureChange", onMSGestureChange, false);
					el.addEventListener("MSGestureEnd", onMSGestureEnd, false);

					function onMSPointerDown(e) {
						e.stopPropagation();
						if (slider.animating) {
							e.preventDefault();
						} else {
							slider.pause();
							el._gesture.addPointer(e.pointerId);
							accDx = 0;
							cwidth = (vertical) ? slider.h : slider.w;
							startT = Number(new Date());
							// CAROUSEL:

							offset = (carousel && reverse && slider.animatingTo === slider.last) ? 0 :
								(carousel && reverse) ? slider.limit - (((slider.itemW + slider.vars.itemMargin) * slider.move) * slider.animatingTo) :
									(carousel && slider.currentSlide === slider.last) ? slider.limit :
										(carousel) ? ((slider.itemW + slider.vars.itemMargin) * slider.move) * slider.currentSlide :
											(reverse) ? (slider.last - slider.currentSlide + slider.cloneOffset) * cwidth : (slider.currentSlide + slider.cloneOffset) * cwidth;
						}
					}

					function onMSGestureChange(e) {
						e.stopPropagation();
						var slider = e.target._slider;
						if (!slider) {
							return;
						}
						var transX = -e.translationX,
							transY = -e.translationY;

						//Accumulate translations.
						accDx = accDx + ((vertical) ? transY : transX);
						dx = accDx;
						scrolling = (vertical) ? (Math.abs(accDx) < Math.abs(-transX)) : (Math.abs(accDx) < Math.abs(-transY));

						if (e.detail === e.MSGESTURE_FLAG_INERTIA) {
							setImmediate(function () {
								el._gesture.stop();
							});

							return;
						}

						if (!scrolling || Number(new Date()) - startT > 500) {
							e.preventDefault();
							if (!fade && slider.transitions) {
								if (!slider.vars.animationLoop) {
									dx = accDx / ((slider.currentSlide === 0 && accDx < 0 || slider.currentSlide === slider.last && accDx > 0) ? (Math.abs(accDx) / cwidth + 2) : 1);
								}
								slider.setProps(offset + dx, "setTouch");
							}
						}
					}

					function onMSGestureEnd(e) {
						e.stopPropagation();
						var slider = e.target._slider;
						if (!slider) {
							return;
						}
						if (slider.animatingTo === slider.currentSlide && !scrolling && !(dx === null)) {
							var updateDx = (reverse) ? -dx : dx,
								target = (updateDx > 0) ? slider.getTarget('next') : slider.getTarget('prev');

							if (slider.canAdvance(target) && (Number(new Date()) - startT < 550 && Math.abs(updateDx) > 50 || Math.abs(updateDx) > cwidth / 2)) {
								slider.flexAnimate(target, slider.vars.pauseOnAction);
							} else {
								if (!fade) slider.flexAnimate(slider.currentSlide, slider.vars.pauseOnAction, true);
							}
						}

						startX = null;
						startY = null;
						dx = null;
						offset = null;
						accDx = 0;
					}
				}
			},
			resize: function () {
				if (!slider.animating && slider.is(':visible')) {
					if (!carousel) slider.doMath();

					if (fade) {
						// SMOOTH HEIGHT:
						methods.smoothHeight();
					} else if (carousel) { //CAROUSEL:
						slider.slides.width(slider.computedW);
						slider.update(slider.pagingCount);
						slider.setProps();
					}
					else if (vertical) { //VERTICAL:
						slider.viewport.height(slider.h);
						slider.setProps(slider.h, "setTotal");
					} else {
						// SMOOTH HEIGHT:
						if (slider.vars.smoothHeight) methods.smoothHeight();
						slider.newSlides.width(slider.computedW);
						slider.setProps(slider.computedW, "setTotal");
					}
				}
			},
			smoothHeight: function (dur) {
				if (!vertical || fade) {
					var $obj = (fade) ? slider : slider.viewport;
					(dur) ? $obj.animate({ "height": slider.slides.eq(slider.animatingTo).height() }, dur) : $obj.height(slider.slides.eq(slider.animatingTo).height());
				}
			},
			sync: function (action) {
				var $obj = $(slider.vars.sync).data("flexslider"),
					target = slider.animatingTo;

				switch (action) {
					case "animate": $obj.flexAnimate(target, slider.vars.pauseOnAction, false, true); break;
					case "play": if (!$obj.playing && !$obj.asNav) { $obj.play(); } break;
					case "pause": $obj.pause(); break;
				}
			},
			uniqueID: function ($clone) {
				$clone.find('[id]').each(function () {
					var $this = $(this);
					$this.attr('id', $this.attr('id') + '_clone');
				});
				return $clone;
			},
			pauseInvisible: {
				visProp: null,
				init: function () {
					var prefixes = ['webkit', 'moz', 'ms', 'o'];

					if ('hidden' in document) return 'hidden';
					for (var i = 0; i < prefixes.length; i++) {
						if ((prefixes[i] + 'Hidden') in document)
							methods.pauseInvisible.visProp = prefixes[i] + 'Hidden';
					}
					if (methods.pauseInvisible.visProp) {
						var evtname = methods.pauseInvisible.visProp.replace(/[H|h]idden/, '') + 'visibilitychange';
						document.addEventListener(evtname, function () {
							if (methods.pauseInvisible.isHidden()) {
								if (slider.startTimeout) clearTimeout(slider.startTimeout); //If clock is ticking, stop timer and prevent from starting while invisible
								else slider.pause(); //Or just pause
							}
							else {
								if (slider.started) slider.play(); //Initiated before, just play
								else (slider.vars.initDelay > 0) ? setTimeout(slider.play, slider.vars.initDelay) : slider.play(); //Didn't init before: simply init or wait for it
							}
						});
					}
				},
				isHidden: function () {
					return document[methods.pauseInvisible.visProp] || false;
				}
			},
			setToClearWatchedEvent: function () {
				clearTimeout(watchedEventClearTimer);
				watchedEventClearTimer = setTimeout(function () {
					watchedEvent = "";
				}, 3000);
			}
		};

		// public methods
		slider.flexAnimate = function (target, pause, override, withSync, fromNav) {
			if (!slider.vars.animationLoop && target !== slider.currentSlide) {
				slider.direction = (target > slider.currentSlide) ? "next" : "prev";
			}

			if (asNav && slider.pagingCount === 1) slider.direction = (slider.currentItem < target) ? "next" : "prev";

			if (!slider.animating && (slider.canAdvance(target, fromNav) || override) && slider.is(":visible")) {
				if (asNav && withSync) {
					var master = $(slider.vars.asNavFor).data('flexslider');
					slider.atEnd = target === 0 || target === slider.count - 1;
					master.flexAnimate(target, true, false, true, fromNav);
					slider.direction = (slider.currentItem < target) ? "next" : "prev";
					master.direction = slider.direction;

					if (Math.ceil((target + 1) / slider.visible) - 1 !== slider.currentSlide && target !== 0) {
						slider.currentItem = target;
						slider.slides.removeClass(namespace + "active-slide").eq(target).addClass(namespace + "active-slide");
						target = Math.floor(target / slider.visible);
					} else {
						slider.currentItem = target;
						slider.slides.removeClass(namespace + "active-slide").eq(target).addClass(namespace + "active-slide");
						return false;
					}
				}

				slider.animating = true;
				slider.animatingTo = target;

				// SLIDESHOW:
				if (pause) slider.pause();

				// API: before() animation Callback
				slider.vars.before(slider);

				// SYNC:
				if (slider.syncExists && !fromNav) methods.sync("animate");

				// CONTROLNAV
				if (slider.vars.controlNav) methods.controlNav.active();

				// !CAROUSEL:
				// CANDIDATE: slide active class (for add/remove slide)
				if (!carousel) slider.slides.removeClass(namespace + 'active-slide').eq(target).addClass(namespace + 'active-slide');

				// INFINITE LOOP:
				// CANDIDATE: atEnd
				slider.atEnd = target === 0 || target === slider.last;

				// DIRECTIONNAV:
				if (slider.vars.directionNav) methods.directionNav.update();

				if (target === slider.last) {
					// API: end() of cycle Callback
					slider.vars.end(slider);
					// SLIDESHOW && !INFINITE LOOP:
					if (!slider.vars.animationLoop) slider.pause();
				}

				// SLIDE:
				if (!fade) {
					var dimension = (vertical) ? slider.slides.filter(':first').height() : slider.computedW,
						margin, slideString, calcNext;

					// INFINITE LOOP / REVERSE:
					if (carousel) {
						//margin = (slider.vars.itemWidth > slider.w) ? slider.vars.itemMargin * 2 : slider.vars.itemMargin;
						margin = slider.vars.itemMargin;
						calcNext = ((slider.itemW + margin) * slider.move) * slider.animatingTo;
						slideString = (calcNext > slider.limit && slider.visible !== 1) ? slider.limit : calcNext;
					} else if (slider.currentSlide === 0 && target === slider.count - 1 && slider.vars.animationLoop && slider.direction !== "next") {
						slideString = (reverse) ? (slider.count + slider.cloneOffset) * dimension : 0;
					} else if (slider.currentSlide === slider.last && target === 0 && slider.vars.animationLoop && slider.direction !== "prev") {
						slideString = (reverse) ? 0 : (slider.count + 1) * dimension;
					} else {
						slideString = (reverse) ? ((slider.count - 1) - target + slider.cloneOffset) * dimension : (target + slider.cloneOffset) * dimension;
					}
					slider.setProps(slideString, "", slider.vars.animationSpeed);
					if (slider.transitions) {
						if (!slider.vars.animationLoop || !slider.atEnd) {
							slider.animating = false;
							slider.currentSlide = slider.animatingTo;
						}
						slider.container.unbind("webkitTransitionEnd transitionend");
						slider.container.bind("webkitTransitionEnd transitionend", function () {
							slider.wrapup(dimension);
						});
					} else {
						slider.container.animate(slider.args, slider.vars.animationSpeed, slider.vars.easing, function () {
							slider.wrapup(dimension);
						});
					}
				} else { // FADE:
					if (!touch) {
						//slider.slides.eq(slider.currentSlide).fadeOut(slider.vars.animationSpeed, slider.vars.easing);
						//slider.slides.eq(target).fadeIn(slider.vars.animationSpeed, slider.vars.easing, slider.wrapup);

						slider.slides.eq(slider.currentSlide).css({ "zIndex": 1 }).animate({ "opacity": 0 }, slider.vars.animationSpeed, slider.vars.easing);
						slider.slides.eq(target).css({ "zIndex": 2 }).animate({ "opacity": 1 }, slider.vars.animationSpeed, slider.vars.easing, slider.wrapup);

					} else {
						slider.slides.eq(slider.currentSlide).css({ "opacity": 0, "zIndex": 1 });
						slider.slides.eq(target).css({ "opacity": 1, "zIndex": 2 });
						slider.wrapup(dimension);
					}
				}
				// SMOOTH HEIGHT:
				if (slider.vars.smoothHeight) methods.smoothHeight(slider.vars.animationSpeed);
			}
		};
		slider.wrapup = function (dimension) {
			// SLIDE:
			if (!fade && !carousel) {
				if (slider.currentSlide === 0 && slider.animatingTo === slider.last && slider.vars.animationLoop) {
					slider.setProps(dimension, "jumpEnd");
				} else if (slider.currentSlide === slider.last && slider.animatingTo === 0 && slider.vars.animationLoop) {
					slider.setProps(dimension, "jumpStart");
				}
			}
			slider.animating = false;
			slider.currentSlide = slider.animatingTo;
			// API: after() animation Callback
			slider.vars.after(slider);
		};

		// SLIDESHOW:
		slider.animateSlides = function () {
			if (!slider.animating && focused) slider.flexAnimate(slider.getTarget("next"));
		};
		// SLIDESHOW:
		slider.pause = function () {
			clearInterval(slider.animatedSlides);
			slider.animatedSlides = null;
			slider.playing = false;
			// PAUSEPLAY:
			if (slider.vars.pausePlay) methods.pausePlay.update("play");
			// SYNC:
			if (slider.syncExists) methods.sync("pause");
		};
		// SLIDESHOW:
		slider.play = function () {
			if (slider.playing) clearInterval(slider.animatedSlides);
			slider.animatedSlides = slider.animatedSlides || setInterval(slider.animateSlides, slider.vars.slideshowSpeed);
			slider.started = slider.playing = true;
			// PAUSEPLAY:
			if (slider.vars.pausePlay) methods.pausePlay.update("pause");
			// SYNC:
			if (slider.syncExists) methods.sync("play");
		};
		// STOP:
		slider.stop = function () {
			slider.pause();
			slider.stopped = true;
		};
		slider.canAdvance = function (target, fromNav) {
			// ASNAV:
			var last = (asNav) ? slider.pagingCount - 1 : slider.last;
			return (fromNav) ? true :
				   (asNav && slider.currentItem === slider.count - 1 && target === 0 && slider.direction === "prev") ? true :
				   (asNav && slider.currentItem === 0 && target === slider.pagingCount - 1 && slider.direction !== "next") ? false :
				   (target === slider.currentSlide && !asNav) ? false :
				   (slider.vars.animationLoop) ? true :
				   (slider.atEnd && slider.currentSlide === 0 && target === last && slider.direction !== "next") ? false :
				   (slider.atEnd && slider.currentSlide === last && target === 0 && slider.direction === "next") ? false :
				   true;
		};
		slider.getTarget = function (dir) {
			slider.direction = dir;
			if (dir === "next") {
				return (slider.currentSlide === slider.last) ? 0 : slider.currentSlide + 1;
			} else {
				return (slider.currentSlide === 0) ? slider.last : slider.currentSlide - 1;
			}
		};

		// SLIDE:
		slider.setProps = function (pos, special, dur) {
			var target = (function () {
				var posCheck = (pos) ? pos : ((slider.itemW + slider.vars.itemMargin) * slider.move) * slider.animatingTo,
					posCalc = (function () {
						if (carousel) {
							return (special === "setTouch") ? pos :
								   (reverse && slider.animatingTo === slider.last) ? 0 :
								   (reverse) ? slider.limit - (((slider.itemW + slider.vars.itemMargin) * slider.move) * slider.animatingTo) :
								   (slider.animatingTo === slider.last) ? slider.limit : posCheck;
						} else {
							switch (special) {
								case "setTotal": return (reverse) ? ((slider.count - 1) - slider.currentSlide + slider.cloneOffset) * pos : (slider.currentSlide + slider.cloneOffset) * pos;
								case "setTouch": return (reverse) ? pos : pos;
								case "jumpEnd": return (reverse) ? pos : slider.count * pos;
								case "jumpStart": return (reverse) ? slider.count * pos : pos;
								default: return pos;
							}
						}
					}());

				return (posCalc * -1) + "px";
			}());

			if (slider.transitions) {
				target = (vertical) ? "translate3d(0," + target + ",0)" : "translate3d(" + target + ",0,0)";
				dur = (dur !== undefined) ? (dur / 1000) + "s" : "0s";
				slider.container.css("-" + slider.pfx + "-transition-duration", dur);
				slider.container.css("transition-duration", dur);
			}

			slider.args[slider.prop] = target;
			if (slider.transitions || dur === undefined) slider.container.css(slider.args);

			slider.container.css('transform', target);
		};

		slider.setup = function (type) {
			// SLIDE:
			if (!fade) {
				var sliderOffset, arr;

				if (type === "init") {
					slider.viewport = $('<div class="' + namespace + 'viewport"></div>').css({ "overflow": "hidden", "position": "relative" }).appendTo(slider).append(slider.container);
					// INFINITE LOOP:
					slider.cloneCount = 0;
					slider.cloneOffset = 0;
					// REVERSE:
					if (reverse) {
						arr = $.makeArray(slider.slides).reverse();
						slider.slides = $(arr);
						slider.container.empty().append(slider.slides);
					}
				}
				// INFINITE LOOP && !CAROUSEL:
				if (slider.vars.animationLoop && !carousel) {
					slider.cloneCount = 2;
					slider.cloneOffset = 1;
					// clear out old clones
					if (type !== "init") slider.container.find('.clone').remove();
					slider.container.append(slider.slides.first().clone().addClass('clone').attr('aria-hidden', 'true')).prepend(slider.slides.last().clone().addClass('clone').attr('aria-hidden', 'true'));
					methods.uniqueID(slider.slides.first().clone().addClass('clone')).appendTo(slider.container);
					methods.uniqueID(slider.slides.last().clone().addClass('clone')).prependTo(slider.container);
				}
				slider.newSlides = $(slider.vars.selector, slider);

				sliderOffset = (reverse) ? slider.count - 1 - slider.currentSlide + slider.cloneOffset : slider.currentSlide + slider.cloneOffset;
				// VERTICAL:
				if (vertical && !carousel) {
					slider.container.height((slider.count + slider.cloneCount) * 200 + "%").css("position", "absolute").width("100%");
					setTimeout(function () {
						slider.newSlides.css({ "display": "block" });
						slider.doMath();
						slider.viewport.height(slider.h);
						slider.setProps(sliderOffset * slider.h, "init");
					}, (type === "init") ? 100 : 0);
				} else {
					slider.container.width((slider.count + slider.cloneCount) * 200 + "%");
					slider.setProps(sliderOffset * slider.computedW, "init");
					setTimeout(function () {
						slider.doMath();
						slider.newSlides.css({ "width": slider.computedW, "float": "left", "display": "block" });
						// SMOOTH HEIGHT:
						if (slider.vars.smoothHeight) methods.smoothHeight();
					}, (type === "init") ? 100 : 0);
				}
			} else { // FADE:
				slider.slides.css({ "width": "100%", "float": "left", "marginRight": "-100%", "position": "relative" });
				if (type === "init") {
					if (!touch) {
						//slider.slides.eq(slider.currentSlide).fadeIn(slider.vars.animationSpeed, slider.vars.easing);
						slider.slides.css({ "opacity": 0, "display": "block", "zIndex": 1 }).eq(slider.currentSlide).css({ "zIndex": 2 }).animate({ "opacity": 1 }, slider.vars.animationSpeed, slider.vars.easing);
					} else {
						slider.slides.css({ "opacity": 0, "display": "block", "webkitTransition": "opacity " + slider.vars.animationSpeed / 1000 + "s ease", "zIndex": 1 }).eq(slider.currentSlide).css({ "opacity": 1, "zIndex": 2 });
					}
				}
				// SMOOTH HEIGHT:
				if (slider.vars.smoothHeight) methods.smoothHeight();
			}
			// !CAROUSEL:
			// CANDIDATE: active slide
			if (!carousel) slider.slides.removeClass(namespace + "active-slide").eq(slider.currentSlide).addClass(namespace + "active-slide");

			//FlexSlider: init() Callback
			slider.vars.init(slider);
		};

		slider.doMath = function () {
			var slide = slider.slides.first(),
				slideMargin = slider.vars.itemMargin,
				minItems = slider.vars.minItems,
				maxItems = slider.vars.maxItems;

			slider.w = (slider.viewport === undefined) ? slider.width() : slider.viewport.width();
			slider.h = slide.height();
			slider.boxPadding = slide.outerWidth() - slide.width();

			// CAROUSEL:
			if (carousel) {
				slider.itemT = slider.vars.itemWidth + slideMargin;
				slider.minW = (minItems) ? minItems * slider.itemT : slider.w;
				slider.maxW = (maxItems) ? (maxItems * slider.itemT) - slideMargin : slider.w;
				slider.itemW = (slider.minW > slider.w) ? (slider.w - (slideMargin * (minItems - 1))) / minItems :
							   (slider.maxW < slider.w) ? (slider.w - (slideMargin * (maxItems - 1))) / maxItems :
							   (slider.vars.itemWidth > slider.w) ? slider.w : slider.vars.itemWidth;

				slider.visible = Math.floor(slider.w / (slider.itemW));
				slider.move = (slider.vars.move > 0 && slider.vars.move < slider.visible) ? slider.vars.move : slider.visible;
				slider.pagingCount = Math.ceil(((slider.count - slider.visible) / slider.move) + 1);
				slider.last = slider.pagingCount - 1;
				slider.limit = (slider.pagingCount === 1) ? 0 :
							   (slider.vars.itemWidth > slider.w) ? (slider.itemW * (slider.count - 1)) + (slideMargin * (slider.count - 1)) : ((slider.itemW + slideMargin) * slider.count) - slider.w - slideMargin;
			} else {
				slider.itemW = slider.w;
				slider.pagingCount = slider.count;
				slider.last = slider.count - 1;
			}
			slider.computedW = slider.itemW - slider.boxPadding;
		};

		slider.update = function (pos, action) {
			slider.doMath();

			// update currentSlide and slider.animatingTo if necessary
			if (!carousel) {
				if (pos < slider.currentSlide) {
					slider.currentSlide += 1;
				} else if (pos <= slider.currentSlide && pos !== 0) {
					slider.currentSlide -= 1;
				}
				slider.animatingTo = slider.currentSlide;
			}

			// update controlNav
			if (slider.vars.controlNav && !slider.manualControls) {
				if ((action === "add" && !carousel) || slider.pagingCount > slider.controlNav.length) {
					methods.controlNav.update("add");
				} else if ((action === "remove" && !carousel) || slider.pagingCount < slider.controlNav.length) {
					if (carousel && slider.currentSlide > slider.last) {
						slider.currentSlide -= 1;
						slider.animatingTo -= 1;
					}
					methods.controlNav.update("remove", slider.last);
				}
			}
			// update directionNav
			if (slider.vars.directionNav) methods.directionNav.update();

		};

		slider.addSlide = function (obj, pos) {
			var $obj = $(obj);

			slider.count += 1;
			slider.last = slider.count - 1;

			// append new slide
			if (vertical && reverse) {
				(pos !== undefined) ? slider.slides.eq(slider.count - pos).after($obj) : slider.container.prepend($obj);
			} else {
				(pos !== undefined) ? slider.slides.eq(pos).before($obj) : slider.container.append($obj);
			}

			// update currentSlide, animatingTo, controlNav, and directionNav
			slider.update(pos, "add");

			// update slider.slides
			slider.slides = $(slider.vars.selector + ':not(.clone)', slider);
			// re-setup the slider to accomdate new slide
			slider.setup();

			//FlexSlider: added() Callback
			slider.vars.added(slider);
		};
		slider.removeSlide = function (obj) {
			var pos = (isNaN(obj)) ? slider.slides.index($(obj)) : obj;

			// update count
			slider.count -= 1;
			slider.last = slider.count - 1;

			// remove slide
			if (isNaN(obj)) {
				$(obj, slider.slides).remove();
			} else {
				(vertical && reverse) ? slider.slides.eq(slider.last).remove() : slider.slides.eq(obj).remove();
			}

			// update currentSlide, animatingTo, controlNav, and directionNav
			slider.doMath();
			slider.update(pos, "remove");

			// update slider.slides
			slider.slides = $(slider.vars.selector + ':not(.clone)', slider);
			// re-setup the slider to accomdate new slide
			slider.setup();

			// FlexSlider: removed() Callback
			slider.vars.removed(slider);
		};

		//FlexSlider: Initialize
		methods.init();
	};

	// Ensure the slider isn't focussed if the window loses focus.
	$(window).blur(function (e) {
		focused = false;
	}).focus(function (e) {
		focused = true;
	});

	//FlexSlider: Default Settings
	$.flexslider.defaults = {
		namespace: "flex-",             //{NEW} String: Prefix string attached to the class of every element generated by the plugin
		selector: ".slides > li",       //{NEW} Selector: Must match a simple pattern. '{container} > {slide}' -- Ignore pattern at your own peril
		animation: "fade",              //String: Select your animation type, "fade" or "slide"
		easing: "swing",                //{NEW} String: Determines the easing method used in jQuery transitions. jQuery easing plugin is supported!
		direction: "horizontal",        //String: Select the sliding direction, "horizontal" or "vertical"
		reverse: false,                 //{NEW} Boolean: Reverse the animation direction
		animationLoop: true,            //Boolean: Should the animation loop? If false, directionNav will received "disable" classes at either end
		smoothHeight: false,            //{NEW} Boolean: Allow height of the slider to animate smoothly in horizontal mode
		startAt: 0,                     //Integer: The slide that the slider should start on. Array notation (0 = first slide)
		slideshow: true,                //Boolean: Animate slider automatically
		slideshowSpeed: 7000,           //Integer: Set the speed of the slideshow cycling, in milliseconds
		animationSpeed: 600,            //Integer: Set the speed of animations, in milliseconds
		initDelay: 0,                   //{NEW} Integer: Set an initialization delay, in milliseconds
		randomize: false,               //Boolean: Randomize slide order
		thumbCaptions: false,           //Boolean: Whether or not to put captions on thumbnails when using the "thumbnails" controlNav.

		// Usability features
		pauseOnAction: true,            //Boolean: Pause the slideshow when interacting with control elements, highly recommended.
		pauseOnHover: false,            //Boolean: Pause the slideshow when hovering over slider, then resume when no longer hovering
		pauseInvisible: true,   		//{NEW} Boolean: Pause the slideshow when tab is invisible, resume when visible. Provides better UX, lower CPU usage.
		useCSS: true,                   //{NEW} Boolean: Slider will use CSS3 transitions if available
		touch: true,                    //{NEW} Boolean: Allow touch swipe navigation of the slider on touch-enabled devices
		video: false,                   //{NEW} Boolean: If using video in the slider, will prevent CSS3 3D Transforms to avoid graphical glitches

		// Primary Controls
		controlNav: true,               //Boolean: Create navigation for paging control of each clide? Note: Leave true for manualControls usage
		directionNav: true,             //Boolean: Create navigation for previous/next navigation? (true/false)
		prevText: "Previous",           //String: Set the text for the "previous" directionNav item
		nextText: "Next",               //String: Set the text for the "next" directionNav item

		// Secondary Navigation
		keyboard: true,                 //Boolean: Allow slider navigating via keyboard left/right keys
		multipleKeyboard: false,        //{NEW} Boolean: Allow keyboard navigation to affect multiple sliders. Default behavior cuts out keyboard navigation with more than one slider present.
		mousewheel: false,              //{UPDATED} Boolean: Requires jquery.mousewheel.js (https://github.com/brandonaaron/jquery-mousewheel) - Allows slider navigating via mousewheel
		pausePlay: false,               //Boolean: Create pause/play dynamic element
		pauseText: "Pause",             //String: Set the text for the "pause" pausePlay item
		playText: "Play",               //String: Set the text for the "play" pausePlay item

		// Special properties
		controlsContainer: "",          //{UPDATED} jQuery Object/Selector: Declare which container the navigation elements should be appended too. Default container is the FlexSlider element. Example use would be $(".flexslider-container"). Property is ignored if given element is not found.
		manualControls: "",             //{UPDATED} jQuery Object/Selector: Declare custom control navigation. Examples would be $(".flex-control-nav li") or "#tabs-nav li img", etc. The number of elements in your controlNav should match the number of slides/tabs.
		sync: "",                       //{NEW} Selector: Mirror the actions performed on this slider with another slider. Use with care.
		asNavFor: "",                   //{NEW} Selector: Internal property exposed for turning the slider into a thumbnail navigation for another slider

		// Carousel Options
		itemWidth: 0,                   //{NEW} Integer: Box-model width of individual carousel items, including horizontal borders and padding.
		itemMargin: 0,                  //{NEW} Integer: Margin between carousel items.
		minItems: 1,                    //{NEW} Integer: Minimum number of carousel items that should be visible. Items will resize fluidly when below this.
		maxItems: 0,                    //{NEW} Integer: Maxmimum number of carousel items that should be visible. Items will resize fluidly when above this limit.
		move: 0,                        //{NEW} Integer: Number of carousel items that should move on animation. If 0, slider will move all visible items.
		allowOneSlide: true,           //{NEW} Boolean: Whether or not to allow a slider comprised of a single slide

		// Callback API
		start: function () { },            //Callback: function(slider) - Fires when the slider loads the first slide
		before: function () { },           //Callback: function(slider) - Fires asynchronously with each slider animation
		after: function () { },            //Callback: function(slider) - Fires after each slider animation completes
		end: function () { },              //Callback: function(slider) - Fires when the slider reaches the last slide (asynchronous)
		added: function () { },            //{NEW} Callback: function(slider) - Fires after a slide is added
		removed: function () { },           //{NEW} Callback: function(slider) - Fires after a slide is removed
		init: function () { }             //{NEW} Callback: function(slider) - Fires after the slider is initially setup
	};

	//FlexSlider: Plugin Function
	$.fn.flexslider = function (options) {
		if (options === undefined) options = {};

		if (typeof options === "object") {
			return this.each(function () {
				var $this = $(this),
					selector = (options.selector) ? options.selector : ".slides > li",
					$slides = $this.find(selector);

				if (($slides.length === 1 && options.allowOneSlide === true) || $slides.length === 0) {
					$slides.fadeIn(400);
					if (options.start) options.start($this);
				} else if ($this.data('flexslider') === undefined) {
					new $.flexslider(this, options);
				}
			});
		} else {
			// Helper strings to quickly perform functions on the slider
			var $slider = $(this).data('flexslider');
			switch (options) {
				case "play": $slider.play(); break;
				case "pause": $slider.pause(); break;
				case "stop": $slider.stop(); break;
				case "next": $slider.flexAnimate($slider.getTarget("next"), true); break;
				case "prev":
				case "previous": $slider.flexAnimate($slider.getTarget("prev"), true); break;
				default: if (typeof options === "number") $slider.flexAnimate(options, true);
			}
		}
	};
})(jQuery);
///#source 1 1 Plugins/owl.carousel.js
/*
 *	jQuery OwlCarousel v1.31
 *
 *	Copyright (c) 2013 Bartosz Wojciechowski
 *	http://www.owlgraphic.com/owlcarousel/
 *
 *	Licensed under MIT
 *
 */

if ( typeof Object.create !== "function" ) {
	Object.create = function( obj ) {
		function F() {};
		F.prototype = obj;
		return new F();
	};
}
(function( $, window, document, undefined ) {

	var Carousel = {
		init :function(options, el){
			var base = this;

			base.$elem = $(el);

			// options passed via js override options passed via data attributes
			base.options = $.extend({}, $.fn.owlCarousel.options, base.$elem.data(), options);

			base.userOptions = options;
			base.loadContent();
		},

		loadContent : function(){
			var base = this;

			if (typeof base.options.beforeInit === "function") {
				base.options.beforeInit.apply(this,[base.$elem]);
			}

			if (typeof base.options.jsonPath === "string") {
				var url = base.options.jsonPath;

				function getData(data) {
					if (typeof base.options.jsonSuccess === "function") {
						base.options.jsonSuccess.apply(this,[data]);
					} else {
						var content = "";
						for(var i in data["owl"]){
							content += data["owl"][i]["item"];
						}
						base.$elem.html(content);
					}
					base.logIn();
				}
				$.getJSON(url,getData);
			} else {
				base.logIn();
			}
		},

		logIn : function(action){
			var base = this;

			base.$elem.data("owl-originalStyles", base.$elem.attr("style"))
					  .data("owl-originalClasses", base.$elem.attr("class"));

			base.$elem.css({opacity: 0});
			base.orignalItems = base.options.items;
			base.checkBrowser();
			base.wrapperWidth = 0;
			base.checkVisible;
			base.setVars();
		},

		setVars : function(){
			var base = this;
			if(base.$elem.children().length === 0){return false}
			base.baseClass();
			base.eventTypes();
			base.$userItems = base.$elem.children();
			base.itemsAmount = base.$userItems.length;
			base.wrapItems();
			base.$owlItems = base.$elem.find(".owl-item");
			base.$owlWrapper = base.$elem.find(".owl-wrapper");
			base.playDirection = "next";
			base.prevItem = 0;
			base.prevArr = [0];
			base.currentItem = 0;
			base.customEvents();
			base.onStartup();
		},

		onStartup : function(){
			var base = this;
			base.updateItems();
			base.calculateAll();
			base.buildControls();
			base.updateControls();
			base.response();
			base.moveEvents();
			base.stopOnHover();
			base.owlStatus();

			if(base.options.transitionStyle !== false){
				base.transitionTypes(base.options.transitionStyle);
			}
			if(base.options.autoPlay === true){
				base.options.autoPlay = 5000;
			}
			base.play();

			base.$elem.find(".owl-wrapper").css("display","block")

			if(!base.$elem.is(":visible")){
				base.watchVisibility();
			} else {
				base.$elem.css("opacity",1);
			}
			base.onstartup = false;
			base.eachMoveUpdate();
			if (typeof base.options.afterInit === "function") {
				base.options.afterInit.apply(this,[base.$elem]);
			}
		},

		eachMoveUpdate : function(){
			var base = this;

			if(base.options.lazyLoad === true){
				base.lazyLoad();
			}
			if(base.options.autoHeight === true){
				base.autoHeight();
			}
			base.onVisibleItems();

			if (typeof base.options.afterAction === "function") {
				base.options.afterAction.apply(this,[base.$elem]);
			}
		},

		updateVars : function(){
			var base = this;
			if(typeof base.options.beforeUpdate === "function") {
				base.options.beforeUpdate.apply(this,[base.$elem]);
			}
			base.watchVisibility();
			base.updateItems();
			base.calculateAll();
			base.updatePosition();
			base.updateControls();
			base.eachMoveUpdate();
			if(typeof base.options.afterUpdate === "function") {
				base.options.afterUpdate.apply(this,[base.$elem]);
			}
		},

		reload : function(elements){
			var base = this;
			setTimeout(function(){
				base.updateVars();
			},0)
		},

		watchVisibility : function(){
			var base = this;

			if(base.$elem.is(":visible") === false){
				base.$elem.css({opacity: 0});
				clearInterval(base.autoPlayInterval);
				clearInterval(base.checkVisible);
			} else {
				return false;
			}
			base.checkVisible = setInterval(function(){
				if (base.$elem.is(":visible")) {
					base.reload();
					base.$elem.animate({opacity: 1},200);
					clearInterval(base.checkVisible);
				}
			}, 500);
		},

		wrapItems : function(){
			var base = this;
			base.$userItems.wrapAll("<div class=\"owl-wrapper\">").wrap("<div class=\"owl-item\"></div>");
			base.$elem.find(".owl-wrapper").wrap("<div class=\"owl-wrapper-outer\">");
			base.wrapperOuter = base.$elem.find(".owl-wrapper-outer");
			base.$elem.css("display","block");
		},

		baseClass : function(){
			var base = this;
			var hasBaseClass = base.$elem.hasClass(base.options.baseClass);
			var hasThemeClass = base.$elem.hasClass(base.options.theme);

			if(!hasBaseClass){
				base.$elem.addClass(base.options.baseClass);
			}

			if(!hasThemeClass){
				base.$elem.addClass(base.options.theme);
			}
		},

		updateItems : function(){
			var base = this;

			if(base.options.responsive === false){
				return false;
			}
			if(base.options.singleItem === true){
				base.options.items = base.orignalItems = 1;
				base.options.itemsCustom = false;
				base.options.itemsDesktop = false;
				base.options.itemsDesktopSmall = false;
				base.options.itemsTablet = false;
				base.options.itemsTabletSmall = false;
				base.options.itemsMobile = false;
				return false;
			}

			var width = $(base.options.responsiveBaseWidth).width();

			if(width > (base.options.itemsDesktop[0] || base.orignalItems) ){
				base.options.items = base.orignalItems;
			}

			if(typeof(base.options.itemsCustom) !== 'undefined' && base.options.itemsCustom !== false){
				//Reorder array by screen size
				base.options.itemsCustom.sort(function(a,b){return a[0]-b[0];});
				for(var i in base.options.itemsCustom){
					if(typeof(base.options.itemsCustom[i]) !== 'undefined' && base.options.itemsCustom[i][0] <= width){
						base.options.items = base.options.itemsCustom[i][1];
					}
				}
			} else {

				if(width <= base.options.itemsDesktop[0] && base.options.itemsDesktop !== false){
					base.options.items = base.options.itemsDesktop[1];
				}

				if(width <= base.options.itemsDesktopSmall[0] && base.options.itemsDesktopSmall !== false){
					base.options.items = base.options.itemsDesktopSmall[1];
				}

				if(width <= base.options.itemsTablet[0]  && base.options.itemsTablet !== false){
					base.options.items = base.options.itemsTablet[1];
				}

				if(width <= base.options.itemsTabletSmall[0]  && base.options.itemsTabletSmall !== false){
					base.options.items = base.options.itemsTabletSmall[1];
				}

				if(width <= base.options.itemsMobile[0] && base.options.itemsMobile !== false){
					base.options.items = base.options.itemsMobile[1];
				}
			}

			//if number of items is less than declared
			if(base.options.items > base.itemsAmount && base.options.itemsScaleUp === true){
				base.options.items = base.itemsAmount;
			}
		},

		response : function(){
			var base = this,
				smallDelay;
			if(base.options.responsive !== true){
				return false
			}
			var lastWindowWidth = $(window).width();

			base.resizer = function(){
				if($(window).width() !== lastWindowWidth){
					if(base.options.autoPlay !== false){
						clearInterval(base.autoPlayInterval);
					}
					clearTimeout(smallDelay);
					smallDelay = setTimeout(function(){
						lastWindowWidth = $(window).width();
						base.updateVars();
					},base.options.responsiveRefreshRate);
				}
			}
			$(window).resize(base.resizer)
		},

		updatePosition : function(){
			var base = this;
			base.jumpTo(base.currentItem);
			if(base.options.autoPlay !== false){
				base.checkAp();
			}
		},

		appendItemsSizes : function(){
			var base = this;

			var roundPages = 0;
			var lastItem = base.itemsAmount - base.options.items;

			base.$owlItems.each(function(index){
				var $this = $(this);
				$this
					.css({"width": base.itemWidth})
					.data("owl-item",Number(index));

				if(index % base.options.items === 0 || index === lastItem){
					if(!(index > lastItem)){
						roundPages +=1;
					}
				}
				$this.data("owl-roundPages",roundPages)
			});
		},

		appendWrapperSizes : function(){
			var base = this;
			var width = 0;

			var width = base.$owlItems.length * base.itemWidth;

			base.$owlWrapper.css({
				"width": width*2,
				"left": 0
			});
			base.appendItemsSizes();
		},

		calculateAll : function(){
			var base = this;
			base.calculateWidth();
			base.appendWrapperSizes();
			base.loops();
			base.max();
		},

		calculateWidth : function(){
			var base = this;
			base.itemWidth = Math.round(base.$elem.width()/base.options.items)
		},

		max : function(){
			var base = this;
			var maximum = ((base.itemsAmount * base.itemWidth) - base.options.items * base.itemWidth) * -1;
			if(base.options.items > base.itemsAmount){
				base.maximumItem = 0;
				maximum = 0
				base.maximumPixels = 0;
			} else {
				base.maximumItem = base.itemsAmount - base.options.items;
				base.maximumPixels = maximum;
			}
			return maximum;
		},

		min : function(){
			return 0;
		},

		loops : function(){
			var base = this;

			base.positionsInArray = [0];
			base.pagesInArray = [];
			var prev = 0;
			var elWidth = 0;

			for(var i = 0; i<base.itemsAmount; i++){
				elWidth += base.itemWidth;
				base.positionsInArray.push(-elWidth);

				if(base.options.scrollPerPage === true){
					var item = $(base.$owlItems[i]);
					var roundPageNum = item.data("owl-roundPages");
					if(roundPageNum !== prev){
						base.pagesInArray[prev] = base.positionsInArray[i];
						prev = roundPageNum;
					}
				}
			}
		},

		buildControls : function(){
			var base = this;
			if(base.options.navigation === true || base.options.pagination === true){
				base.owlControls = $("<div class=\"owl-controls\"/>").toggleClass("clickable", !base.browser.isTouch).appendTo(base.$elem);
			}
			if(base.options.pagination === true){
				base.buildPagination();
			}
			if(base.options.navigation === true){
				base.buildButtons();
			}
		},

		buildButtons : function(){
			var base = this;
			var buttonsWrapper = $("<div class=\"owl-buttons\"/>")
			base.owlControls.append(buttonsWrapper);

			base.buttonPrev = $("<div/>",{
				"class" : "owl-prev",
				"html" : base.options.navigationText[0] || ""
				});

			base.buttonNext = $("<div/>",{
				"class" : "owl-next",
				"html" : base.options.navigationText[1] || ""
				});

			buttonsWrapper
			.append(base.buttonPrev)
			.append(base.buttonNext);

			buttonsWrapper.on("touchstart.owlControls mousedown.owlControls", "div[class^=\"owl\"]", function(event){
				event.preventDefault();
			})

			buttonsWrapper.on("touchend.owlControls mouseup.owlControls", "div[class^=\"owl\"]", function(event){
				event.preventDefault();
				if($(this).hasClass("owl-next")){
					base.next();
				} else{
					base.prev();
				}
			})
		},

		buildPagination : function(){
			var base = this;

			base.paginationWrapper = $("<div class=\"owl-pagination\"/>");
			base.owlControls.append(base.paginationWrapper);

			base.paginationWrapper.on("touchend.owlControls mouseup.owlControls", ".owl-page", function(event){
				event.preventDefault();
				if(Number($(this).data("owl-page")) !== base.currentItem){
					base.goTo( Number($(this).data("owl-page")), true);
				}
			});
		},

		updatePagination : function(){
			var base = this;
			if(base.options.pagination === false){
				return false;
			}

			base.paginationWrapper.html("");

			var counter = 0;
			var lastPage = base.itemsAmount - base.itemsAmount % base.options.items;

			for(var i = 0; i<base.itemsAmount; i++){
				if(i % base.options.items === 0){
					counter +=1;
					if(lastPage === i){
						var lastItem = base.itemsAmount - base.options.items;
					}
					var paginationButton = $("<div/>",{
						"class" : "owl-page"
						});
					var paginationButtonInner = $("<span></span>",{
						"text": base.options.paginationNumbers === true ? counter : "",
						"class": base.options.paginationNumbers === true ? "owl-numbers" : ""
					});
					paginationButton.append(paginationButtonInner);

					paginationButton.data("owl-page",lastPage === i ? lastItem : i);
					paginationButton.data("owl-roundPages",counter);

					base.paginationWrapper.append(paginationButton);
				}
			}
			base.checkPagination();
		},
		checkPagination : function(){
			var base = this;
			if(base.options.pagination === false){
				return false;
			}
			base.paginationWrapper.find(".owl-page").each(function(i,v){
				if($(this).data("owl-roundPages") === $(base.$owlItems[base.currentItem]).data("owl-roundPages") ){
					base.paginationWrapper
						.find(".owl-page")
						.removeClass("active");
					$(this).addClass("active");
				}
			});
		},

		checkNavigation : function(){
			var base = this;

			if(base.options.navigation === false){
				return false;
			}
			if(base.options.rewindNav === false){
				if(base.currentItem === 0 && base.maximumItem === 0){
					base.buttonPrev.addClass("disabled");
					base.buttonNext.addClass("disabled");
				} else if(base.currentItem === 0 && base.maximumItem !== 0){
					base.buttonPrev.addClass("disabled");
					base.buttonNext.removeClass("disabled");
				} else if (base.currentItem === base.maximumItem){
					base.buttonPrev.removeClass("disabled");
					base.buttonNext.addClass("disabled");
				} else if(base.currentItem !== 0 && base.currentItem !== base.maximumItem){
					base.buttonPrev.removeClass("disabled");
					base.buttonNext.removeClass("disabled");
				}
			}
		},

		updateControls : function(){
			var base = this;
			base.updatePagination();
			base.checkNavigation();
			if(base.owlControls){
				if(base.options.items >= base.itemsAmount){
					base.owlControls.hide();
				} else {
					base.owlControls.show();
				}
			}
		},

		destroyControls : function(){
			var base = this;
			if(base.owlControls){
				base.owlControls.remove();
			}
		},

		next : function(speed){
			var base = this;

			if(base.isTransition){
				return false;
			}

			base.currentItem += base.options.scrollPerPage === true ? base.options.items : 1;
			if(base.currentItem > base.maximumItem + (base.options.scrollPerPage == true ? (base.options.items - 1) : 0)){
				if(base.options.rewindNav === true){
					base.currentItem = 0;
					speed = "rewind";
				} else {
					base.currentItem = base.maximumItem;
					return false;
				}
			}
			base.goTo(base.currentItem,speed);
		},

		prev : function(speed){
			var base = this;

			if(base.isTransition){
				return false;
			}

			if(base.options.scrollPerPage === true && base.currentItem > 0 && base.currentItem < base.options.items){
				base.currentItem = 0
			} else {
				base.currentItem -= base.options.scrollPerPage === true ? base.options.items : 1;
			}
			if(base.currentItem < 0){
				if(base.options.rewindNav === true){
					base.currentItem = base.maximumItem;
					speed = "rewind"
				} else {
					base.currentItem =0;
					return false;
				}
			}
			base.goTo(base.currentItem,speed);
		},

		goTo : function(position,speed,drag){
			var base = this;

			if(base.isTransition){
				return false;
			}
			if(typeof base.options.beforeMove === "function") {
				base.options.beforeMove.apply(this,[base.$elem]);
			}
			if(position >= base.maximumItem){
				position = base.maximumItem;
			}
			else if( position <= 0 ){
				position = 0;
			}

			base.currentItem = base.owl.currentItem = position;
			if( base.options.transitionStyle !== false && drag !== "drag" && base.options.items === 1 && base.browser.support3d === true){
				base.swapSpeed(0)
				if(base.browser.support3d === true){
					base.transition3d(base.positionsInArray[position]);
				} else {
					base.css2slide(base.positionsInArray[position],1);
				}
				base.afterGo();
				base.singleItemTransition();
				
				return false;
			}
			var goToPixel = base.positionsInArray[position];

			if(base.browser.support3d === true){
				base.isCss3Finish = false;

				if(speed === true){
					base.swapSpeed("paginationSpeed");
					setTimeout(function() {
						base.isCss3Finish = true;
					}, base.options.paginationSpeed);

				} else if(speed === "rewind" ){
					base.swapSpeed(base.options.rewindSpeed);
					setTimeout(function() {
						base.isCss3Finish = true;
					}, base.options.rewindSpeed);

				} else {
					base.swapSpeed("slideSpeed");
					setTimeout(function() {
						base.isCss3Finish = true;
					}, base.options.slideSpeed);
				}
				base.transition3d(goToPixel);
			} else {
				if(speed === true){
					base.css2slide(goToPixel, base.options.paginationSpeed);
				} else if(speed === "rewind" ){
					base.css2slide(goToPixel, base.options.rewindSpeed);
				} else {
					base.css2slide(goToPixel, base.options.slideSpeed);
				}
			}
			base.afterGo();
		},

		jumpTo : function(position){
			var base = this;
			if(typeof base.options.beforeMove === "function") {
				base.options.beforeMove.apply(this,[base.$elem]);
			}
			if(position >= base.maximumItem || position === -1){
				position = base.maximumItem;
			}
			else if( position <= 0 ){
				position = 0;
			}
			base.swapSpeed(0)
			if(base.browser.support3d === true){
				base.transition3d(base.positionsInArray[position]);
			} else {
				base.css2slide(base.positionsInArray[position],1);
			}
			base.currentItem = base.owl.currentItem = position;
			base.afterGo();
		},

		afterGo : function(){
			var base = this;

			base.prevArr.push(base.currentItem);
			base.prevItem = base.owl.prevItem = base.prevArr[base.prevArr.length -2];
			base.prevArr.shift(0)

			if(base.prevItem !== base.currentItem){
				base.checkPagination();
				base.checkNavigation();
				base.eachMoveUpdate();

				if(base.options.autoPlay !== false){
					base.checkAp();
				}
			}
			if(typeof base.options.afterMove === "function" && base.prevItem !== base.currentItem) {
				base.options.afterMove.apply(this,[base.$elem]);
			}
		},

		stop : function(){
			var base = this;
			base.apStatus = "stop";
			clearInterval(base.autoPlayInterval);
		},

		checkAp : function(){
			var base = this;
			if(base.apStatus !== "stop"){
				base.play();
			}
		},

		play : function(){
			var base = this;
			base.apStatus = "play";
			if(base.options.autoPlay === false){
				return false;
			}
			clearInterval(base.autoPlayInterval);
			base.autoPlayInterval = setInterval(function(){
				base.next(true);
			},base.options.autoPlay);
		},

		swapSpeed : function(action){
			var base = this;
			if(action === "slideSpeed"){
				base.$owlWrapper.css(base.addCssSpeed(base.options.slideSpeed));
			} else if(action === "paginationSpeed" ){
				base.$owlWrapper.css(base.addCssSpeed(base.options.paginationSpeed));
			} else if(typeof action !== "string"){
				base.$owlWrapper.css(base.addCssSpeed(action));
			}
		},

		addCssSpeed : function(speed){
			var base = this;
			return {
				"-webkit-transition": "all "+ speed +"ms ease",
				"-moz-transition": "all "+ speed +"ms ease",
				"-o-transition": "all "+ speed +"ms ease",
				"transition": "all "+ speed +"ms ease"
			};
		},

		removeTransition : function(){
			return {
				"-webkit-transition": "",
				"-moz-transition": "",
				"-o-transition": "",
				"transition": ""
			};
		},

		doTranslate : function(pixels){
			return {
				"-webkit-transform": "translate3d("+pixels+"px, 0px, 0px)",
				"-moz-transform": "translate3d("+pixels+"px, 0px, 0px)",
				"-o-transform": "translate3d("+pixels+"px, 0px, 0px)",
				"-ms-transform": "translate3d("+pixels+"px, 0px, 0px)",
				"transform": "translate3d("+pixels+"px, 0px,0px)"
			};
		},

		transition3d : function(value){
			var base = this;
			base.$owlWrapper.css(base.doTranslate(value));
		},

		css2move : function(value){
			var base = this;
			base.$owlWrapper.css({"left" : value})
		},

		css2slide : function(value,speed){
			var base = this;

			base.isCssFinish = false;
			base.$owlWrapper.stop(true,true).animate({
				"left" : value
			}, {
				duration : speed || base.options.slideSpeed ,
				complete : function(){
					base.isCssFinish = true;
				}
			});
		},

		checkBrowser : function(){
			var base = this;

			//Check 3d support
			var	translate3D = "translate3d(0px, 0px, 0px)",
				tempElem = document.createElement("div");

			tempElem.style.cssText= "  -moz-transform:"    + translate3D +
								  "; -ms-transform:"     + translate3D +
								  "; -o-transform:"      + translate3D +
								  "; -webkit-transform:" + translate3D +
								  "; transform:"         + translate3D;
			var	regex = /translate3d\(0px, 0px, 0px\)/g,
				asSupport = tempElem.style.cssText.match(regex),
				support3d = (asSupport !== null && asSupport.length === 1);

			var isTouch = "ontouchstart" in window || navigator.msMaxTouchPoints;

			base.browser = {
				"support3d" : support3d,
				"isTouch" : isTouch
			}
		},

		moveEvents : function(){
			var base = this;
			if(base.options.mouseDrag !== false || base.options.touchDrag !== false){
				base.gestures();
				base.disabledEvents();
			}
		},

		eventTypes : function(){
			var base = this;
			var types = ["s","e","x"];

			base.ev_types = {};

			if(base.options.mouseDrag === true && base.options.touchDrag === true){
				types = [
					"touchstart.owl mousedown.owl",
					"touchmove.owl mousemove.owl",
					"touchend.owl touchcancel.owl mouseup.owl"
				];
			} else if(base.options.mouseDrag === false && base.options.touchDrag === true){
				types = [
					"touchstart.owl",
					"touchmove.owl",
					"touchend.owl touchcancel.owl"
				];
			} else if(base.options.mouseDrag === true && base.options.touchDrag === false){
				types = [
					"mousedown.owl",
					"mousemove.owl",
					"mouseup.owl"
				];
			}

			base.ev_types["start"] = types[0];
			base.ev_types["move"] = types[1];
			base.ev_types["end"] = types[2];
		},

		disabledEvents :  function(){
			var base = this;
			base.$elem.on("dragstart.owl", function(event) { event.preventDefault();});
			base.$elem.on("mousedown.disableTextSelect", function(e) {
				return $(e.target).is('input, textarea, select, option');
			});
		},

		gestures : function(){
			var base = this;

			var locals = {
				offsetX : 0,
				offsetY : 0,
				baseElWidth : 0,
				relativePos : 0,
				position: null,
				minSwipe : null,
				maxSwipe: null,
				sliding : null,
				dargging: null,
				targetElement : null
			}

			base.isCssFinish = true;

			function getTouches(event){
				if(event.touches){
					return {
						x : event.touches[0].pageX,
						y : event.touches[0].pageY
					}
				} else {
					if(event.pageX !== undefined){
						return {
							x : event.pageX,
							y : event.pageY
						}
					} else {
						return {
							x : event.clientX,
							y : event.clientY
						}
					}
				}
			}

			function swapEvents(type){
				if(type === "on"){
					$(document).on(base.ev_types["move"], dragMove);
					$(document).on(base.ev_types["end"], dragEnd);
				} else if(type === "off"){
					$(document).off(base.ev_types["move"]);
					$(document).off(base.ev_types["end"]);
				}
			}

			function dragStart(event) {
				var event = event.originalEvent || event || window.event;

				if (event.which === 3) {
					return false;
				}
				if(base.itemsAmount <= base.options.items){
					return;
				}
				if(base.isCssFinish === false && !base.options.dragBeforeAnimFinish ){
					return false;
				}
				if(base.isCss3Finish === false && !base.options.dragBeforeAnimFinish ){
					return false;
				}

				if(base.options.autoPlay !== false){
					clearInterval(base.autoPlayInterval);
				}

				if(base.browser.isTouch !== true && !base.$owlWrapper.hasClass("grabbing")){
					base.$owlWrapper.addClass("grabbing")
				}

				base.newPosX = 0;
				base.newRelativeX = 0;

				$(this).css(base.removeTransition());

				var position = $(this).position();
				locals.relativePos = position.left;
				
				locals.offsetX = getTouches(event).x - position.left;
				locals.offsetY = getTouches(event).y - position.top;

				swapEvents("on");

				locals.sliding = false;
				locals.targetElement = event.target || event.srcElement;
			}

			function dragMove(event){
				var event = event.originalEvent || event || window.event;

				base.newPosX = getTouches(event).x- locals.offsetX;
				base.newPosY = getTouches(event).y - locals.offsetY;
				base.newRelativeX = base.newPosX - locals.relativePos;	

				if (typeof base.options.startDragging === "function" && locals.dragging !== true && base.newRelativeX !== 0) {
					locals.dragging = true;
					base.options.startDragging.apply(base,[base.$elem]);
				}

				if(base.newRelativeX > 8 || base.newRelativeX < -8 && base.browser.isTouch === true){
					event.preventDefault ? event.preventDefault() : event.returnValue = false;
					locals.sliding = true;
				}

				if((base.newPosY > 10 || base.newPosY < -10) && locals.sliding === false){
					$(document).off("touchmove.owl");
				}

				var minSwipe = function(){
					return  base.newRelativeX / 5;
				}
				var maxSwipe = function(){
					return  base.maximumPixels + base.newRelativeX / 5;
				}

				base.newPosX = Math.max(Math.min( base.newPosX, minSwipe() ), maxSwipe() );
				if(base.browser.support3d === true){
					base.transition3d(base.newPosX);
				} else {
					base.css2move(base.newPosX);
				}
			}

			function dragEnd(event){
				var event = event.originalEvent || event || window.event;
				event.target = event.target || event.srcElement;

				locals.dragging = false;

				if(base.browser.isTouch !== true){
					base.$owlWrapper.removeClass("grabbing");
				}

				if(base.newRelativeX<0){
					base.dragDirection = base.owl.dragDirection = "left"
				} else {
					base.dragDirection = base.owl.dragDirection = "right"
				}

				if(base.newRelativeX !== 0){
					var newPosition = base.getNewPosition();
					base.goTo(newPosition,false,"drag");
					if(locals.targetElement === event.target && base.browser.isTouch !== true){
						$(event.target).on("click.disable", function(ev){
							ev.stopImmediatePropagation();
							ev.stopPropagation();
							ev.preventDefault();
							$(event.target).off("click.disable");
						});
						var handlers = $._data(event.target, "events")["click"];
						var owlStopEvent = handlers.pop();
						handlers.splice(0, 0, owlStopEvent);
					}
				}
				swapEvents("off");
			}
			base.$elem.on(base.ev_types["start"], ".owl-wrapper", dragStart); 
		},

		getNewPosition : function(){
			var base = this,
				newPosition;
			
			newPosition = base.closestItem();

			if(newPosition>base.maximumItem){
				base.currentItem = base.maximumItem;
				newPosition  = base.maximumItem;
			} else if( base.newPosX >=0 ){
				newPosition = 0;
				base.currentItem = 0;
			}
			return newPosition;
		},
		closestItem : function(){
			var base = this,
				array = base.options.scrollPerPage === true ? base.pagesInArray : base.positionsInArray,
				goal = base.newPosX,
				closest = null;

			$.each(array, function(i,v){
				if( goal - (base.itemWidth/20) > array[i+1] && goal - (base.itemWidth/20)< v && base.moveDirection() === "left") {
					closest = v;
					if(base.options.scrollPerPage === true){
						base.currentItem = $.inArray(closest, base.positionsInArray);
					} else {
						base.currentItem = i;
					}
				} 
				else if (goal + (base.itemWidth/20) < v && goal + (base.itemWidth/20) > (array[i+1] || array[i]-base.itemWidth) && base.moveDirection() === "right"){
					if(base.options.scrollPerPage === true){
						closest = array[i+1] || array[array.length-1];
						base.currentItem = $.inArray(closest, base.positionsInArray);
					} else {
						closest = array[i+1];
						base.currentItem = i+1;
					}
				}
			});
			return base.currentItem;
		},

		moveDirection : function(){
			var base = this,
				direction;
			if(base.newRelativeX < 0 ){
				direction = "right"
				base.playDirection = "next"
			} else {
				direction = "left"
				base.playDirection = "prev"
			}
			return direction
		},

		customEvents : function(){
			var base = this;
			base.$elem.on("owl.next",function(){
				base.next();
			});
			base.$elem.on("owl.prev",function(){
				base.prev();
			});
			base.$elem.on("owl.play",function(event,speed){
				base.options.autoPlay = speed;
				base.play();
				base.hoverStatus = "play";
			});
			base.$elem.on("owl.stop",function(){
				base.stop();
				base.hoverStatus = "stop";
			});
			base.$elem.on("owl.goTo",function(event,item){
				base.goTo(item)
			});
			base.$elem.on("owl.jumpTo",function(event,item){
				base.jumpTo(item)
			});
		},
		
		stopOnHover : function(){
			var base = this;
			if(base.options.stopOnHover === true && base.browser.isTouch !== true && base.options.autoPlay !== false){
				base.$elem.on("mouseover", function(){
					base.stop();
				});
				base.$elem.on("mouseout", function(){
					if(base.hoverStatus !== "stop"){
						base.play();
					}
				});
			}
		},

		lazyLoad : function(){
			var base = this;

			if(base.options.lazyLoad === false){
				return false;
			}
			for(var i=0; i<base.itemsAmount; i++){
				var $item = $(base.$owlItems[i]);

				if($item.data("owl-loaded") === "loaded"){
					continue;
				}

				var	itemNumber = $item.data("owl-item"),
					$lazyImg = $item.find(".lazyOwl"),
					follow;

				if( typeof $lazyImg.data("src") !== "string"){
					$item.data("owl-loaded","loaded");
					continue;
				}				
				if($item.data("owl-loaded") === undefined){
					$lazyImg.hide();
					$item.addClass("loading").data("owl-loaded","checked");
				}
				if(base.options.lazyFollow === true){
					follow = itemNumber >= base.currentItem;
				} else {
					follow = true;
				}
				if(follow && itemNumber < base.currentItem + base.options.items && $lazyImg.length){
					base.lazyPreload($item,$lazyImg);
				}
			}
		},

		lazyPreload : function($item,$lazyImg){
			var base = this,
				iterations = 0;
				if ($lazyImg.prop("tagName") === "DIV") {
					$lazyImg.css("background-image", "url(" + $lazyImg.data("src")+ ")" );
					var isBackgroundImg=true;
				} else {
					$lazyImg[0].src = $lazyImg.data("src");
				}
				checkLazyImage();

			function checkLazyImage(){
				iterations += 1;
				if (base.completeImg($lazyImg.get(0)) || isBackgroundImg === true) {
					showImage();
				} else if(iterations <= 100){//if image loads in less than 10 seconds 
					setTimeout(checkLazyImage,100);
				} else {
					showImage();
				}
			}
			function showImage(){
				$item.data("owl-loaded", "loaded").removeClass("loading");
				$lazyImg.removeAttr("data-src");
				base.options.lazyEffect === "fade" ? $lazyImg.fadeIn(400) : $lazyImg.show();
				if(typeof base.options.afterLazyLoad === "function") {
					base.options.afterLazyLoad.apply(this,[base.$elem]);
				}
			}
		},

		autoHeight : function(){
			var base = this;
			var $currentimg = $(base.$owlItems[base.currentItem]).find("img");

			if($currentimg.get(0) !== undefined ){
				var iterations = 0;
				checkImage();
			} else {
				addHeight();
			}
			function checkImage(){
				iterations += 1;
				if ( base.completeImg($currentimg.get(0)) ) {
					addHeight();
				} else if(iterations <= 100){ //if image loads in less than 10 seconds 
					setTimeout(checkImage,100);
				} else {
					base.wrapperOuter.css("height", ""); //Else remove height attribute
				}
			}

			function addHeight(){
				var $currentItem = $(base.$owlItems[base.currentItem]).height();
				base.wrapperOuter.css("height",$currentItem+"px");
				if(!base.wrapperOuter.hasClass("autoHeight")){
					setTimeout(function(){
						base.wrapperOuter.addClass("autoHeight");
					},0);
				}
			}
		},

		completeImg : function(img) {
		    if (!img.complete) {
		        return false;
		    }
		    if (typeof img.naturalWidth !== "undefined" && img.naturalWidth == 0) {
		        return false;
		    }
		    return true;
		},

		onVisibleItems : function(){
			var base = this;

			if(base.options.addClassActive === true){
				base.$owlItems.removeClass("active");
			}
			base.visibleItems = [];
			for(var i=base.currentItem; i<base.currentItem + base.options.items; i++){
				base.visibleItems.push(i);

				if(base.options.addClassActive === true){
					$(base.$owlItems[i]).addClass("active");
				}
			}
			base.owl.visibleItems = base.visibleItems;
		},

		transitionTypes : function(className){
			var base = this;
			//Currently available: "fade","backSlide","goDown","fadeUp"
			base.outClass = "owl-"+className+"-out";
			base.inClass = "owl-"+className+"-in";
		},

		singleItemTransition : function(){
			var base = this;
			base.isTransition = true;

			var outClass = base.outClass,
				inClass = base.inClass,
				$currentItem = base.$owlItems.eq(base.currentItem),
				$prevItem = base.$owlItems.eq(base.prevItem),
				prevPos = Math.abs(base.positionsInArray[base.currentItem]) + base.positionsInArray[base.prevItem],
				origin = Math.abs(base.positionsInArray[base.currentItem])+base.itemWidth/2;

            base.$owlWrapper
	            .addClass('owl-origin')
	            .css({
	            	"-webkit-transform-origin" : origin+"px",
	            	"-moz-perspective-origin" : origin+"px",
	            	"perspective-origin" : origin+"px"
	            });
	        function transStyles(prevPos,zindex){
				return {
					"position" : "relative",
					"left" : prevPos+"px"
				};
			}

	        var animEnd = 'webkitAnimationEnd oAnimationEnd MSAnimationEnd animationend';

			$prevItem
			.css(transStyles(prevPos,10))
			.addClass(outClass)
			.on(animEnd, function() {
				base.endPrev = true;
				$prevItem.off(animEnd);
		    	base.clearTransStyle($prevItem,outClass);
			});

			$currentItem
			.addClass(inClass)
			.on(animEnd, function() {
				base.endCurrent = true;
				$currentItem.off(animEnd);
		    	base.clearTransStyle($currentItem,inClass);
		    });
		},

		clearTransStyle : function(item,classToRemove){
			var base = this;
			item.css({
					"position" : "",
					"left" : ""
				})
				.removeClass(classToRemove);
			if(base.endPrev && base.endCurrent){
				base.$owlWrapper.removeClass('owl-origin');
				base.endPrev = false;
				base.endCurrent = false;
				base.isTransition = false;
			}
		},

		owlStatus : function(){
			var base = this;
			base.owl = {
				"userOptions"	: base.userOptions,
				"baseElement" 	: base.$elem,
				"userItems"		: base.$userItems,
				"owlItems"		: base.$owlItems,
				"currentItem"	: base.currentItem,
				"prevItem"		: base.prevItem,
				"visibleItems"	: base.visibleItems,
				"isTouch" 		: base.browser.isTouch,
				"browser"		: base.browser,
				"dragDirection" : base.dragDirection
			}
		},

		clearEvents : function(){
			var base = this;
			base.$elem.off(".owl owl mousedown.disableTextSelect");
			$(document).off(".owl owl");
			$(window).off("resize", base.resizer);
		},

		unWrap : function(){
			var base = this;
			if(base.$elem.children().length !== 0){
				base.$owlWrapper.unwrap();
				base.$userItems.unwrap().unwrap();
				if(base.owlControls){
					base.owlControls.remove();
				}
			}
			base.clearEvents();
			base.$elem
				.attr("style", base.$elem.data("owl-originalStyles") || "")
				.attr("class", base.$elem.data("owl-originalClasses"));
		},

		destroy : function(){
			var base = this;
			base.stop();
			clearInterval(base.checkVisible);
			base.unWrap();
			base.$elem.removeData();
		},

		reinit : function(newOptions){
			var base = this;
			var options = $.extend({}, base.userOptions, newOptions);
		 	base.unWrap();
		 	base.init(options,base.$elem);
		},

		addItem : function(htmlString,targetPosition){
			var base = this,
				position;

			if(!htmlString){return false}

			if(base.$elem.children().length === 0){
				base.$elem.append(htmlString);
				base.setVars();
				return false;
			}
			base.unWrap();
			if(targetPosition === undefined || targetPosition === -1){
				position = -1;
			} else {
				position = targetPosition;
			}
			if(position >= base.$userItems.length || position === -1){
				base.$userItems.eq(-1).after(htmlString)
			} else {
				base.$userItems.eq(position).before(htmlString)
			}

			base.setVars();
		},

		removeItem : function(targetPosition){
			var base = this,
				position;

			if(base.$elem.children().length === 0){return false}
			
			if(targetPosition === undefined || targetPosition === -1){
				position = -1;
			} else {
				position = targetPosition;
			}

			base.unWrap();
			base.$userItems.eq(position).remove();
			base.setVars();
		}

	};

	$.fn.owlCarousel = function( options ){
		return this.each(function() {
			if($(this).data("owl-init") === true){
				return false;
			}
			$(this).data("owl-init", true);
			var carousel = Object.create( Carousel );
			carousel.init( options, this );
			$.data( this, "owlCarousel", carousel );
		});
	};

	$.fn.owlCarousel.options = {

		items : 1,
		itemsCustom : false,
		itemsDesktop : [1199,1],
		itemsDesktopSmall : [1006,1],
		itemsTablet : [768,1],
		itemsTabletSmall : false,
		itemsMobile : [767,1],
		singleItem : true,
		itemsScaleUp : false,

		slideSpeed : 200,
		paginationSpeed : 800,
		rewindSpeed : 1000,

		autoPlay : true,
		stopOnHover : false,

		navigation : true,
		navigationText : false,
		rewindNav : true,
		scrollPerPage : false,

		pagination : true,
		paginationNumbers : false,

		responsive : true,
		responsiveRefreshRate : 200,
		responsiveBaseWidth	: window,
		

		baseClass : "owl-carousel",
		theme : "owl-theme",

		lazyLoad : false,
		lazyFollow : true,
		lazyEffect : "fade",

		autoHeight : true,

		jsonPath : false,
		jsonSuccess : false,

		dragBeforeAnimFinish : true,
		mouseDrag : true,
		touchDrag : true,

		addClassActive : false,
		transitionStyle : false,

		beforeUpdate : false,
		afterUpdate : false,
		beforeInit : false,
		afterInit : false,
		beforeMove : false,
		afterMove : false,
		afterAction : false,
		startDragging : false,
		afterLazyLoad: false
		
	};
})( jQuery, window, document );

///#source 1 1 Plugins/jquery.mCustomScrollbar.min.js
/* == malihu jquery custom scrollbar plugin == Version: 3.0.6, License: MIT License (MIT) */
!function(e,t,a){!function(t){var o="function"==typeof define&&define.amd,n="https:"==a.location.protocol?"https:":"http:",i="cdnjs.cloudflare.com/ajax/libs/jquery-mousewheel/3.1.12/jquery.mousewheel.min.js";o||e.event.special.mousewheel||e("head").append(decodeURI("%3Cscript src="+n+"//"+i+"%3E%3C/script%3E")),t()}(function(){var o="mCustomScrollbar",n="mCS",i=".mCustomScrollbar",r={setTop:0,setLeft:0,axis:"y",scrollbarPosition:"inside",scrollInertia:950,autoDraggerLength:!0,alwaysShowScrollbar:0,snapOffset:0,mouseWheel:{enable:!0,scrollAmount:"auto",axis:"y",deltaFactor:"auto",disableOver:["select","option","keygen","datalist","textarea"]},scrollButtons:{scrollType:"stepless",scrollAmount:"auto"},keyboard:{enable:!0,scrollType:"stepless",scrollAmount:"auto"},contentTouchScroll:25,advanced:{autoScrollOnFocus:"input,textarea,select,button,datalist,keygen,a[tabindex],area,object,[contenteditable='true']",updateOnContentResize:!0,updateOnImageLoad:!0},theme:"light",callbacks:{onTotalScrollOffset:0,onTotalScrollBackOffset:0,alwaysTriggerOffsets:!0}},l=0,s={},c=t.attachEvent&&!t.addEventListener?1:0,d=!1,u=["mCSB_dragger_onDrag","mCSB_scrollTools_onDrag","mCS_img_loaded","mCS_disabled","mCS_destroyed","mCS_no_scrollbar","mCS-autoHide","mCS-dir-rtl","mCS_no_scrollbar_y","mCS_no_scrollbar_x","mCS_y_hidden","mCS_x_hidden","mCSB_draggerContainer","mCSB_buttonUp","mCSB_buttonDown","mCSB_buttonLeft","mCSB_buttonRight"],f={init:function(t){var t=e.extend(!0,{},r,t),a=h.call(this);if(t.live){var o=t.liveSelector||this.selector||i,c=e(o);if("off"===t.live)return void p(o);s[o]=setTimeout(function(){c.mCustomScrollbar(t),"once"===t.live&&c.length&&p(o)},500)}else p(o);return t.setWidth=t.set_width?t.set_width:t.setWidth,t.setHeight=t.set_height?t.set_height:t.setHeight,t.axis=t.horizontalScroll?"x":g(t.axis),t.scrollInertia=t.scrollInertia>0&&t.scrollInertia<17?17:t.scrollInertia,"object"!=typeof t.mouseWheel&&1==t.mouseWheel&&(t.mouseWheel={enable:!0,scrollAmount:"auto",axis:"y",preventDefault:!1,deltaFactor:"auto",normalizeDelta:!1,invert:!1}),t.mouseWheel.scrollAmount=t.mouseWheelPixels?t.mouseWheelPixels:t.mouseWheel.scrollAmount,t.mouseWheel.normalizeDelta=t.advanced.normalizeMouseWheelDelta?t.advanced.normalizeMouseWheelDelta:t.mouseWheel.normalizeDelta,t.scrollButtons.scrollType=v(t.scrollButtons.scrollType),m(t),e(a).each(function(){var a=e(this);if(!a.data(n)){a.data(n,{idx:++l,opt:t,scrollRatio:{y:null,x:null},overflowed:null,contentReset:{y:null,x:null},bindEvents:!1,tweenRunning:!1,sequential:{},langDir:a.css("direction"),cbOffsets:null,trigger:null});var o=a.data(n),i=o.opt,r=a.data("mcs-axis"),s=a.data("mcs-scrollbar-position"),c=a.data("mcs-theme");r&&(i.axis=r),s&&(i.scrollbarPosition=s),c&&(i.theme=c,m(i)),x.call(this),e("#mCSB_"+o.idx+"_container img:not(."+u[2]+")").addClass(u[2]),f.update.call(null,a)}})},update:function(t,a){var o=t||h.call(this);return e(o).each(function(){var t=e(this);if(t.data(n)){var o=t.data(n),i=o.opt,r=e("#mCSB_"+o.idx+"_container"),l=[e("#mCSB_"+o.idx+"_dragger_vertical"),e("#mCSB_"+o.idx+"_dragger_horizontal")];if(!r.length)return;o.tweenRunning&&V(t),t.hasClass(u[3])&&t.removeClass(u[3]),t.hasClass(u[4])&&t.removeClass(u[4]),b.call(this),S.call(this),"y"===i.axis||i.advanced.autoExpandHorizontalScroll||r.css("width",_(r.children())),o.overflowed=T.call(this),I.call(this),i.autoDraggerLength&&C.call(this),y.call(this),M.call(this);var s=[Math.abs(r[0].offsetTop),Math.abs(r[0].offsetLeft)];"x"!==i.axis&&(o.overflowed[0]?l[0].height()>l[0].parent().height()?k.call(this):(Q(t,s[0].toString(),{dir:"y",dur:0,overwrite:"none"}),o.contentReset.y=null):(k.call(this),"y"===i.axis?O.call(this):"yx"===i.axis&&o.overflowed[1]&&Q(t,s[1].toString(),{dir:"x",dur:0,overwrite:"none"}))),"y"!==i.axis&&(o.overflowed[1]?l[1].width()>l[1].parent().width()?k.call(this):(Q(t,s[1].toString(),{dir:"x",dur:0,overwrite:"none"}),o.contentReset.x=null):(k.call(this),"x"===i.axis?O.call(this):"yx"===i.axis&&o.overflowed[0]&&Q(t,s[0].toString(),{dir:"y",dur:0,overwrite:"none"}))),a&&o&&(2===a&&i.callbacks.onImageLoad&&"function"==typeof i.callbacks.onImageLoad?i.callbacks.onImageLoad.call(this):3===a&&i.callbacks.onSelectorChange&&"function"==typeof i.callbacks.onSelectorChange?i.callbacks.onSelectorChange.call(this):i.callbacks.onUpdate&&"function"==typeof i.callbacks.onUpdate&&i.callbacks.onUpdate.call(this)),X.call(this)}})},scrollTo:function(t,a){if("undefined"!=typeof t&&null!=t){var o=h.call(this);return e(o).each(function(){var o=e(this);if(o.data(n)){var i=o.data(n),r=i.opt,l={trigger:"external",scrollInertia:r.scrollInertia,scrollEasing:"mcsEaseInOut",moveDragger:!1,timeout:60,callbacks:!0,onStart:!0,onUpdate:!0,onComplete:!0},s=e.extend(!0,{},l,a),c=j.call(this,t),d=s.scrollInertia>0&&s.scrollInertia<17?17:s.scrollInertia;c[0]=Y.call(this,c[0],"y"),c[1]=Y.call(this,c[1],"x"),s.moveDragger&&(c[0]*=i.scrollRatio.y,c[1]*=i.scrollRatio.x),s.dur=d,setTimeout(function(){null!==c[0]&&"undefined"!=typeof c[0]&&"x"!==r.axis&&i.overflowed[0]&&(s.dir="y",s.overwrite="all",Q(o,c[0].toString(),s)),null!==c[1]&&"undefined"!=typeof c[1]&&"y"!==r.axis&&i.overflowed[1]&&(s.dir="x",s.overwrite="none",Q(o,c[1].toString(),s))},s.timeout)}})}},stop:function(){var t=h.call(this);return e(t).each(function(){var t=e(this);t.data(n)&&V(t)})},disable:function(t){var a=h.call(this);return e(a).each(function(){var a=e(this);if(a.data(n)){{a.data(n)}X.call(this,"remove"),O.call(this),t&&k.call(this),I.call(this,!0),a.addClass(u[3])}})},destroy:function(){var t=h.call(this);return e(t).each(function(){var a=e(this);if(a.data(n)){var i=a.data(n),r=i.opt,l=e("#mCSB_"+i.idx),s=e("#mCSB_"+i.idx+"_container"),c=e(".mCSB_"+i.idx+"_scrollbar");r.live&&p(r.liveSelector||e(t).selector),X.call(this,"remove"),O.call(this),k.call(this),a.removeData(n),Z(this,"mcs"),c.remove(),s.find("img."+u[2]).removeClass(u[2]),l.replaceWith(s.contents()),a.removeClass(o+" _"+n+"_"+i.idx+" "+u[6]+" "+u[7]+" "+u[5]+" "+u[3]).addClass(u[4])}})}},h=function(){return"object"!=typeof e(this)||e(this).length<1?i:this},m=function(t){var a=["rounded","rounded-dark","rounded-dots","rounded-dots-dark"],o=["rounded-dots","rounded-dots-dark","3d","3d-dark","3d-thick","3d-thick-dark","inset","inset-dark","inset-2","inset-2-dark","inset-3","inset-3-dark"],n=["minimal","minimal-dark"],i=["minimal","minimal-dark"],r=["minimal","minimal-dark"];t.autoDraggerLength=e.inArray(t.theme,a)>-1?!1:t.autoDraggerLength,t.autoExpandScrollbar=e.inArray(t.theme,o)>-1?!1:t.autoExpandScrollbar,t.scrollButtons.enable=e.inArray(t.theme,n)>-1?!1:t.scrollButtons.enable,t.autoHideScrollbar=e.inArray(t.theme,i)>-1?!0:t.autoHideScrollbar,t.scrollbarPosition=e.inArray(t.theme,r)>-1?"outside":t.scrollbarPosition},p=function(e){s[e]&&(clearTimeout(s[e]),Z(s,e))},g=function(e){return"yx"===e||"xy"===e||"auto"===e?"yx":"x"===e||"horizontal"===e?"x":"y"},v=function(e){return"stepped"===e||"pixels"===e||"step"===e||"click"===e?"stepped":"stepless"},x=function(){var t=e(this),a=t.data(n),i=a.opt,r=i.autoExpandScrollbar?" "+u[1]+"_expand":"",l=["<div id='mCSB_"+a.idx+"_scrollbar_vertical' class='mCSB_scrollTools mCSB_"+a.idx+"_scrollbar mCS-"+i.theme+" mCSB_scrollTools_vertical"+r+"'><div class='"+u[12]+"'><div id='mCSB_"+a.idx+"_dragger_vertical' class='mCSB_dragger' style='position:absolute;' oncontextmenu='return false;'><div class='mCSB_dragger_bar' /></div><div class='mCSB_draggerRail' /></div></div>","<div id='mCSB_"+a.idx+"_scrollbar_horizontal' class='mCSB_scrollTools mCSB_"+a.idx+"_scrollbar mCS-"+i.theme+" mCSB_scrollTools_horizontal"+r+"'><div class='"+u[12]+"'><div id='mCSB_"+a.idx+"_dragger_horizontal' class='mCSB_dragger' style='position:absolute;' oncontextmenu='return false;'><div class='mCSB_dragger_bar' /></div><div class='mCSB_draggerRail' /></div></div>"],s="yx"===i.axis?"mCSB_vertical_horizontal":"x"===i.axis?"mCSB_horizontal":"mCSB_vertical",c="yx"===i.axis?l[0]+l[1]:"x"===i.axis?l[1]:l[0],d="yx"===i.axis?"<div id='mCSB_"+a.idx+"_container_wrapper' class='mCSB_container_wrapper' />":"",f=i.autoHideScrollbar?" "+u[6]:"",h="x"!==i.axis&&"rtl"===a.langDir?" "+u[7]:"";i.setWidth&&t.css("width",i.setWidth),i.setHeight&&t.css("height",i.setHeight),i.setLeft="y"!==i.axis&&"rtl"===a.langDir?"989999px":i.setLeft,t.addClass(o+" _"+n+"_"+a.idx+f+h).wrapInner("<div id='mCSB_"+a.idx+"' class='mCustomScrollBox mCS-"+i.theme+" "+s+"'><div id='mCSB_"+a.idx+"_container' class='mCSB_container' style='position:relative; top:"+i.setTop+"; left:"+i.setLeft+";' dir="+a.langDir+" /></div>");var m=e("#mCSB_"+a.idx),p=e("#mCSB_"+a.idx+"_container");"y"===i.axis||i.advanced.autoExpandHorizontalScroll||p.css("width",_(p.children())),"outside"===i.scrollbarPosition?("static"===t.css("position")&&t.css("position","relative"),t.css("overflow","visible"),m.addClass("mCSB_outside").after(c)):(m.addClass("mCSB_inside").append(c),p.wrap(d)),w.call(this);var g=[e("#mCSB_"+a.idx+"_dragger_vertical"),e("#mCSB_"+a.idx+"_dragger_horizontal")];g[0].css("min-height",g[0].height()),g[1].css("min-width",g[1].width())},_=function(t){return Math.max.apply(Math,t.map(function(){return e(this).outerWidth(!0)}).get())},S=function(){var t=e(this),a=t.data(n),o=a.opt,i=e("#mCSB_"+a.idx+"_container");o.advanced.autoExpandHorizontalScroll&&"y"!==o.axis&&i.css({position:"absolute",width:"auto"}).wrap("<div class='mCSB_h_wrapper' style='position:relative; left:0; width:999999px;' />").css({width:Math.ceil(i[0].getBoundingClientRect().right+.4)-Math.floor(i[0].getBoundingClientRect().left),position:"relative"}).unwrap()},w=function(){var t=e(this),a=t.data(n),o=a.opt,i=e(".mCSB_"+a.idx+"_scrollbar:first"),r=tt(o.scrollButtons.tabindex)?"tabindex='"+o.scrollButtons.tabindex+"'":"",l=["<a href='#' class='"+u[13]+"' oncontextmenu='return false;' "+r+" />","<a href='#' class='"+u[14]+"' oncontextmenu='return false;' "+r+" />","<a href='#' class='"+u[15]+"' oncontextmenu='return false;' "+r+" />","<a href='#' class='"+u[16]+"' oncontextmenu='return false;' "+r+" />"],s=["x"===o.axis?l[2]:l[0],"x"===o.axis?l[3]:l[1],l[2],l[3]];o.scrollButtons.enable&&i.prepend(s[0]).append(s[1]).next(".mCSB_scrollTools").prepend(s[2]).append(s[3])},b=function(){var t=e(this),a=t.data(n),o=e("#mCSB_"+a.idx),i=t.css("max-height")||"none",r=-1!==i.indexOf("%"),l=t.css("box-sizing");if("none"!==i){var s=r?t.parent().height()*parseInt(i)/100:parseInt(i);"border-box"===l&&(s-=t.innerHeight()-t.height()+(t.outerHeight()-t.innerHeight())),o.css("max-height",Math.round(s))}},C=function(){var t=e(this),a=t.data(n),o=e("#mCSB_"+a.idx),i=e("#mCSB_"+a.idx+"_container"),r=[e("#mCSB_"+a.idx+"_dragger_vertical"),e("#mCSB_"+a.idx+"_dragger_horizontal")],l=[o.height()/i.outerHeight(!1),o.width()/i.outerWidth(!1)],s=[parseInt(r[0].css("min-height")),Math.round(l[0]*r[0].parent().height()),parseInt(r[1].css("min-width")),Math.round(l[1]*r[1].parent().width())],d=c&&s[1]<s[0]?s[0]:s[1],u=c&&s[3]<s[2]?s[2]:s[3];r[0].css({height:d,"max-height":r[0].parent().height()-10}).find(".mCSB_dragger_bar").css({"line-height":s[0]+"px"}),r[1].css({width:u,"max-width":r[1].parent().width()-10})},y=function(){var t=e(this),a=t.data(n),o=e("#mCSB_"+a.idx),i=e("#mCSB_"+a.idx+"_container"),r=[e("#mCSB_"+a.idx+"_dragger_vertical"),e("#mCSB_"+a.idx+"_dragger_horizontal")],l=[i.outerHeight(!1)-o.height(),i.outerWidth(!1)-o.width()],s=[l[0]/(r[0].parent().height()-r[0].height()),l[1]/(r[1].parent().width()-r[1].width())];a.scrollRatio={y:s[0],x:s[1]}},B=function(e,t,a){var o=a?u[0]+"_expanded":"",n=e.closest(".mCSB_scrollTools");"active"===t?(e.toggleClass(u[0]+" "+o),n.toggleClass(u[1]),e[0]._draggable=e[0]._draggable?0:1):e[0]._draggable||("hide"===t?(e.removeClass(u[0]),n.removeClass(u[1])):(e.addClass(u[0]),n.addClass(u[1])))},T=function(){var t=e(this),a=t.data(n),o=e("#mCSB_"+a.idx),i=e("#mCSB_"+a.idx+"_container"),r=null==a.overflowed?i.height():i.outerHeight(!1),l=null==a.overflowed?i.width():i.outerWidth(!1);return[r>o.height(),l>o.width()]},k=function(){var t=e(this),a=t.data(n),o=a.opt,i=e("#mCSB_"+a.idx),r=e("#mCSB_"+a.idx+"_container"),l=[e("#mCSB_"+a.idx+"_dragger_vertical"),e("#mCSB_"+a.idx+"_dragger_horizontal")];if(V(t),("x"!==o.axis&&!a.overflowed[0]||"y"===o.axis&&a.overflowed[0])&&(l[0].add(r).css("top",0),Q(t,"_resetY")),"y"!==o.axis&&!a.overflowed[1]||"x"===o.axis&&a.overflowed[1]){var s=dx=0;"rtl"===a.langDir&&(s=i.width()-r.outerWidth(!1),dx=Math.abs(s/a.scrollRatio.x)),r.css("left",s),l[1].css("left",dx),Q(t,"_resetX")}},M=function(){function t(){r=setTimeout(function(){e.event.special.mousewheel?(clearTimeout(r),W.call(a[0])):t()},100)}var a=e(this),o=a.data(n),i=o.opt;if(!o.bindEvents){if(E.call(this),i.contentTouchScroll&&D.call(this),L.call(this),i.mouseWheel.enable){var r;t()}P.call(this),H.call(this),i.advanced.autoScrollOnFocus&&z.call(this),i.scrollButtons.enable&&U.call(this),i.keyboard.enable&&F.call(this),o.bindEvents=!0}},O=function(){var t=e(this),o=t.data(n),i=o.opt,r=n+"_"+o.idx,l=".mCSB_"+o.idx+"_scrollbar",s=e("#mCSB_"+o.idx+",#mCSB_"+o.idx+"_container,#mCSB_"+o.idx+"_container_wrapper,"+l+" ."+u[12]+",#mCSB_"+o.idx+"_dragger_vertical,#mCSB_"+o.idx+"_dragger_horizontal,"+l+">a"),c=e("#mCSB_"+o.idx+"_container");i.advanced.releaseDraggableSelectors&&s.add(e(i.advanced.releaseDraggableSelectors)),o.bindEvents&&(e(a).unbind("."+r),s.each(function(){e(this).unbind("."+r)}),clearTimeout(t[0]._focusTimeout),Z(t[0],"_focusTimeout"),clearTimeout(o.sequential.step),Z(o.sequential,"step"),clearTimeout(c[0].onCompleteTimeout),Z(c[0],"onCompleteTimeout"),o.bindEvents=!1)},I=function(t){var a=e(this),o=a.data(n),i=o.opt,r=e("#mCSB_"+o.idx+"_container_wrapper"),l=r.length?r:e("#mCSB_"+o.idx+"_container"),s=[e("#mCSB_"+o.idx+"_scrollbar_vertical"),e("#mCSB_"+o.idx+"_scrollbar_horizontal")],c=[s[0].find(".mCSB_dragger"),s[1].find(".mCSB_dragger")];"x"!==i.axis&&(o.overflowed[0]&&!t?(s[0].add(c[0]).add(s[0].children("a")).css("display","block"),l.removeClass(u[8]+" "+u[10])):(i.alwaysShowScrollbar?(2!==i.alwaysShowScrollbar&&c[0].add(s[0].children("a")).css("display","none"),l.removeClass(u[10])):(s[0].css("display","none"),l.addClass(u[10])),l.addClass(u[8]))),"y"!==i.axis&&(o.overflowed[1]&&!t?(s[1].add(c[1]).add(s[1].children("a")).css("display","block"),l.removeClass(u[9]+" "+u[11])):(i.alwaysShowScrollbar?(2!==i.alwaysShowScrollbar&&c[1].add(s[1].children("a")).css("display","none"),l.removeClass(u[11])):(s[1].css("display","none"),l.addClass(u[11])),l.addClass(u[9]))),o.overflowed[0]||o.overflowed[1]?a.removeClass(u[5]):a.addClass(u[5])},R=function(e){var t=e.type;switch(t){case"pointerdown":case"MSPointerDown":case"pointermove":case"MSPointerMove":case"pointerup":case"MSPointerUp":return[e.originalEvent.pageY,e.originalEvent.pageX,!1];case"touchstart":case"touchmove":case"touchend":var a=e.originalEvent.touches[0]||e.originalEvent.changedTouches[0],o=e.originalEvent.touches.length||e.originalEvent.changedTouches.length;return[a.pageY,a.pageX,o>1];default:return[e.pageY,e.pageX,!1]}},E=function(){function t(e){var t=p.find("iframe");if(t.length){var a=e?"auto":"none";t.css("pointer-events",a)}}function o(e,t,a,o){if(p[0].idleTimer=f.scrollInertia<233?250:0,i.attr("id")===m[1])var n="x",r=(i[0].offsetLeft-t+o)*u.scrollRatio.x;else var n="y",r=(i[0].offsetTop-e+a)*u.scrollRatio.y;Q(s,r.toString(),{dir:n,drag:!0})}var i,r,l,s=e(this),u=s.data(n),f=u.opt,h=n+"_"+u.idx,m=["mCSB_"+u.idx+"_dragger_vertical","mCSB_"+u.idx+"_dragger_horizontal"],p=e("#mCSB_"+u.idx+"_container"),g=e("#"+m[0]+",#"+m[1]),v=f.advanced.releaseDraggableSelectors?g.add(e(f.advanced.releaseDraggableSelectors)):g;g.bind("mousedown."+h+" touchstart."+h+" pointerdown."+h+" MSPointerDown."+h,function(o){if(o.stopImmediatePropagation(),o.preventDefault(),$(o)){d=!0,c&&(a.onselectstart=function(){return!1}),t(!1),V(s),i=e(this);var n=i.offset(),u=R(o)[0]-n.top,h=R(o)[1]-n.left,m=i.height()+n.top,p=i.width()+n.left;m>u&&u>0&&p>h&&h>0&&(r=u,l=h),B(i,"active",f.autoExpandScrollbar)}}).bind("touchmove."+h,function(e){e.stopImmediatePropagation(),e.preventDefault();var t=i.offset(),a=R(e)[0]-t.top,n=R(e)[1]-t.left;o(r,l,a,n)}),e(a).bind("mousemove."+h+" pointermove."+h+" MSPointerMove."+h,function(e){if(i){var t=i.offset(),a=R(e)[0]-t.top,n=R(e)[1]-t.left;if(r===a)return;o(r,l,a,n)}}).add(v).bind("mouseup."+h+" touchend."+h+" pointerup."+h+" MSPointerUp."+h,function(){i&&(B(i,"active",f.autoExpandScrollbar),i=null),d=!1,c&&(a.onselectstart=null),t(!0)})},D=function(){function t(e,t){var a=[1.5*t,2*t,t/1.5,t/2];return e>90?t>4?a[0]:a[3]:e>60?t>3?a[3]:a[2]:e>30?t>8?a[1]:t>6?a[0]:t>4?t:a[2]:t>8?t:a[3]}function a(e,t,a,o,n,i){e&&Q(g,e.toString(),{dur:t,scrollEasing:a,dir:o,overwrite:n,drag:i})}var o,i,r,l,s,c,u,f,h,m,p,g=e(this),v=g.data(n),x=v.opt,_=n+"_"+v.idx,S=e("#mCSB_"+v.idx),w=e("#mCSB_"+v.idx+"_container"),b=[e("#mCSB_"+v.idx+"_dragger_vertical"),e("#mCSB_"+v.idx+"_dragger_horizontal")],C=[],y=[],B=0,T="yx"===x.axis?"none":"all",k=[];w.bind("touchstart."+_+" pointerdown."+_+" MSPointerDown."+_,function(e){if(et(e)&&!d&&!R(e)[2]){var t=w.offset();o=R(e)[0]-t.top,i=R(e)[1]-t.left,k=[R(e)[0],R(e)[1]]}}).bind("touchmove."+_+" pointermove."+_+" MSPointerMove."+_,function(e){if(et(e)&&!d&&!R(e)[2]){e.stopImmediatePropagation(),c=J();var t=S.offset(),n=R(e)[0]-t.top,r=R(e)[1]-t.left,l="mcsLinearOut";if(C.push(n),y.push(r),k[2]=Math.abs(R(e)[0]-k[0]),k[3]=Math.abs(R(e)[1]-k[1]),v.overflowed[0])var s=b[0].parent().height()-b[0].height(),u=o-n>0&&n-o>-(s*v.scrollRatio.y)&&(2*k[3]<k[2]||"yx"===x.axis);if(v.overflowed[1])var f=b[1].parent().width()-b[1].width(),h=i-r>0&&r-i>-(f*v.scrollRatio.x)&&(2*k[2]<k[3]||"yx"===x.axis);(u||h)&&e.preventDefault(),m="yx"===x.axis?[o-n,i-r]:"x"===x.axis?[null,i-r]:[o-n,null],w[0].idleTimer=250,v.overflowed[0]&&a(m[0],B,l,"y","all",!0),v.overflowed[1]&&a(m[1],B,l,"x",T,!0)}}),S.bind("touchstart."+_+" pointerdown."+_+" MSPointerDown."+_,function(e){if(et(e)&&!d&&!R(e)[2]){e.stopImmediatePropagation(),V(g),s=J();var t=S.offset();r=R(e)[0]-t.top,l=R(e)[1]-t.left,C=[],y=[]}}).bind("touchend."+_+" pointerup."+_+" MSPointerUp."+_,function(e){if(et(e)&&!d&&!R(e)[2]){e.stopImmediatePropagation(),u=J();var o=S.offset(),n=R(e)[0]-o.top,i=R(e)[1]-o.left;if(!(u-c>30)){h=1e3/(u-s);var g="mcsEaseOut",_=2.5>h,b=_?[C[C.length-2],y[y.length-2]]:[0,0];f=_?[n-b[0],i-b[1]]:[n-r,i-l];var B=[Math.abs(f[0]),Math.abs(f[1])];h=_?[Math.abs(f[0]/4),Math.abs(f[1]/4)]:[h,h];var k=[Math.abs(w[0].offsetTop)-f[0]*t(B[0]/h[0],h[0]),Math.abs(w[0].offsetLeft)-f[1]*t(B[1]/h[1],h[1])];m="yx"===x.axis?[k[0],k[1]]:"x"===x.axis?[null,k[1]]:[k[0],null],p=[4*B[0]+x.scrollInertia,4*B[1]+x.scrollInertia];var M=parseInt(x.contentTouchScroll)||0;m[0]=B[0]>M?m[0]:0,m[1]=B[1]>M?m[1]:0,v.overflowed[0]&&a(m[0],p[0],g,"y",T,!1),v.overflowed[1]&&a(m[1],p[1],g,"x",T,!1)}}})},L=function(){function o(){return t.getSelection?t.getSelection().toString():a.selection&&"Control"!=a.selection.type?a.selection.createRange().text:0}function i(e,t,a){u.type=a&&r?"stepped":"stepless",u.scrollAmount=10,q(l,e,t,"mcsLinearOut",a?60:null)}var r,l=e(this),s=l.data(n),c=s.opt,u=s.sequential,f=n+"_"+s.idx,h=e("#mCSB_"+s.idx+"_container"),m=h.parent();h.bind("mousedown."+f,function(){r||(r=1,d=!0)}).add(a).bind("mousemove."+f,function(e){if(r&&o()){var t=h.offset(),a=R(e)[0]-t.top+h[0].offsetTop,n=R(e)[1]-t.left+h[0].offsetLeft;a>0&&a<m.height()&&n>0&&n<m.width()?u.step&&i("off",null,"stepped"):("x"!==c.axis&&s.overflowed[0]&&(0>a?i("on",38):a>m.height()&&i("on",40)),"y"!==c.axis&&s.overflowed[1]&&(0>n?i("on",37):n>m.width()&&i("on",39)))}}).bind("mouseup."+f,function(){r&&(r=0,i("off",null)),d=!1})},W=function(){function t(e){var t=null;try{var a=e.contentDocument||e.contentWindow.document;t=a.body.innerHTML}catch(o){}return null!==t}var a=e(this),o=a.data(n);if(o){var i=o.opt,r=n+"_"+o.idx,l=e("#mCSB_"+o.idx),s=[e("#mCSB_"+o.idx+"_dragger_vertical"),e("#mCSB_"+o.idx+"_dragger_horizontal")],d=e("#mCSB_"+o.idx+"_container").find("iframe"),u=l;d.length&&d.each(function(){var a=this;t(a)&&(u=u.add(e(a).contents().find("body")))}),u.bind("mousewheel."+r,function(t,n){if(V(a),!A(a,t.target)){var r="auto"!==i.mouseWheel.deltaFactor?parseInt(i.mouseWheel.deltaFactor):c&&t.deltaFactor<100?100:t.deltaFactor||100;if("x"===i.axis||"x"===i.mouseWheel.axis)var d="x",u=[Math.round(r*o.scrollRatio.x),parseInt(i.mouseWheel.scrollAmount)],f="auto"!==i.mouseWheel.scrollAmount?u[1]:u[0]>=l.width()?.9*l.width():u[0],h=Math.abs(e("#mCSB_"+o.idx+"_container")[0].offsetLeft),m=s[1][0].offsetLeft,p=s[1].parent().width()-s[1].width(),g=t.deltaX||t.deltaY||n;else var d="y",u=[Math.round(r*o.scrollRatio.y),parseInt(i.mouseWheel.scrollAmount)],f="auto"!==i.mouseWheel.scrollAmount?u[1]:u[0]>=l.height()?.9*l.height():u[0],h=Math.abs(e("#mCSB_"+o.idx+"_container")[0].offsetTop),m=s[0][0].offsetTop,p=s[0].parent().height()-s[0].height(),g=t.deltaY||n;"y"===d&&!o.overflowed[0]||"x"===d&&!o.overflowed[1]||(i.mouseWheel.invert&&(g=-g),i.mouseWheel.normalizeDelta&&(g=0>g?-1:1),(g>0&&0!==m||0>g&&m!==p||i.mouseWheel.preventDefault)&&(t.stopImmediatePropagation(),t.preventDefault()),Q(a,(h-g*f).toString(),{dir:d}))}})}},A=function(t,a){var o=a.nodeName.toLowerCase(),i=t.data(n).opt.mouseWheel.disableOver,r=["select","textarea"];return e.inArray(o,i)>-1&&!(e.inArray(o,r)>-1&&!e(a).is(":focus"))},P=function(){var t=e(this),a=t.data(n),o=n+"_"+a.idx,i=e("#mCSB_"+a.idx+"_container"),r=i.parent(),l=e(".mCSB_"+a.idx+"_scrollbar ."+u[12]);l.bind("touchstart."+o+" pointerdown."+o+" MSPointerDown."+o,function(){d=!0}).bind("touchend."+o+" pointerup."+o+" MSPointerUp."+o,function(){d=!1}).bind("click."+o,function(o){if(e(o.target).hasClass(u[12])||e(o.target).hasClass("mCSB_draggerRail")){V(t);var n=e(this),l=n.find(".mCSB_dragger");if(n.parent(".mCSB_scrollTools_horizontal").length>0){if(!a.overflowed[1])return;var s="x",c=o.pageX>l.offset().left?-1:1,d=Math.abs(i[0].offsetLeft)-.9*c*r.width()}else{if(!a.overflowed[0])return;var s="y",c=o.pageY>l.offset().top?-1:1,d=Math.abs(i[0].offsetTop)-.9*c*r.height()}Q(t,d.toString(),{dir:s,scrollEasing:"mcsEaseInOut"})}})},z=function(){var t=e(this),o=t.data(n),i=o.opt,r=n+"_"+o.idx,l=e("#mCSB_"+o.idx+"_container"),s=l.parent();l.bind("focusin."+r,function(){var o=e(a.activeElement),n=l.find(".mCustomScrollBox").length,r=0;o.is(i.advanced.autoScrollOnFocus)&&(V(t),clearTimeout(t[0]._focusTimeout),t[0]._focusTimer=n?(r+17)*n:0,t[0]._focusTimeout=setTimeout(function(){var e=[at(o)[0],at(o)[1]],a=[l[0].offsetTop,l[0].offsetLeft],n=[a[0]+e[0]>=0&&a[0]+e[0]<s.height()-o.outerHeight(!1),a[1]+e[1]>=0&&a[0]+e[1]<s.width()-o.outerWidth(!1)],c="yx"!==i.axis||n[0]||n[1]?"all":"none";"x"===i.axis||n[0]||Q(t,e[0].toString(),{dir:"y",scrollEasing:"mcsEaseInOut",overwrite:c,dur:r}),"y"===i.axis||n[1]||Q(t,e[1].toString(),{dir:"x",scrollEasing:"mcsEaseInOut",overwrite:c,dur:r})},t[0]._focusTimer))})},H=function(){var t=e(this),a=t.data(n),o=n+"_"+a.idx,i=e("#mCSB_"+a.idx+"_container").parent();i.bind("scroll."+o,function(){(0!==i.scrollTop()||0!==i.scrollLeft())&&e(".mCSB_"+a.idx+"_scrollbar").css("visibility","hidden")})},U=function(){var t=e(this),a=t.data(n),o=a.opt,i=a.sequential,r=n+"_"+a.idx,l=".mCSB_"+a.idx+"_scrollbar",s=e(l+">a");s.bind("mousedown."+r+" touchstart."+r+" pointerdown."+r+" MSPointerDown."+r+" mouseup."+r+" touchend."+r+" pointerup."+r+" MSPointerUp."+r+" mouseout."+r+" pointerout."+r+" MSPointerOut."+r+" click."+r,function(n){function r(e,a){i.scrollAmount=o.snapAmount||o.scrollButtons.scrollAmount,q(t,e,a)}if(n.preventDefault(),$(n)){var l=e(this).attr("class");switch(i.type=o.scrollButtons.scrollType,n.type){case"mousedown":case"touchstart":case"pointerdown":case"MSPointerDown":if("stepped"===i.type)return;d=!0,a.tweenRunning=!1,r("on",l);break;case"mouseup":case"touchend":case"pointerup":case"MSPointerUp":case"mouseout":case"pointerout":case"MSPointerOut":if("stepped"===i.type)return;d=!1,i.dir&&r("off",l);break;case"click":if("stepped"!==i.type||a.tweenRunning)return;r("on",l)}}})},F=function(){var t=e(this),o=t.data(n),i=o.opt,r=o.sequential,l=n+"_"+o.idx,s=e("#mCSB_"+o.idx),c=e("#mCSB_"+o.idx+"_container"),d=c.parent(),u="input,textarea,select,datalist,keygen,[contenteditable='true']";s.attr("tabindex","0").bind("blur."+l+" keydown."+l+" keyup."+l,function(n){function l(e,a){r.type=i.keyboard.scrollType,r.scrollAmount=i.snapAmount||i.keyboard.scrollAmount,"stepped"===r.type&&o.tweenRunning||q(t,e,a)}switch(n.type){case"blur":o.tweenRunning&&r.dir&&l("off",null);break;case"keydown":case"keyup":var s=n.keyCode?n.keyCode:n.which,f="on";if("x"!==i.axis&&(38===s||40===s)||"y"!==i.axis&&(37===s||39===s)){if((38===s||40===s)&&!o.overflowed[0]||(37===s||39===s)&&!o.overflowed[1])return;"keyup"===n.type&&(f="off"),e(a.activeElement).is(u)||(n.preventDefault(),n.stopImmediatePropagation(),l(f,s))}else if(33===s||34===s){if((o.overflowed[0]||o.overflowed[1])&&(n.preventDefault(),n.stopImmediatePropagation()),"keyup"===n.type){V(t);var h=34===s?-1:1;if("x"===i.axis||"yx"===i.axis&&o.overflowed[1]&&!o.overflowed[0])var m="x",p=Math.abs(c[0].offsetLeft)-.9*h*d.width();else var m="y",p=Math.abs(c[0].offsetTop)-.9*h*d.height();Q(t,p.toString(),{dir:m,scrollEasing:"mcsEaseInOut"})}}else if((35===s||36===s)&&!e(a.activeElement).is(u)&&((o.overflowed[0]||o.overflowed[1])&&(n.preventDefault(),n.stopImmediatePropagation()),"keyup"===n.type)){if("x"===i.axis||"yx"===i.axis&&o.overflowed[1]&&!o.overflowed[0])var m="x",p=35===s?Math.abs(d.width()-c.outerWidth(!1)):0;else var m="y",p=35===s?Math.abs(d.height()-c.outerHeight(!1)):0;Q(t,p.toString(),{dir:m,scrollEasing:"mcsEaseInOut"})}}})},q=function(t,a,o,i,r){function l(e){var a="stepped"!==f.type,o=r?r:e?a?d.scrollInertia/1.5:d.scrollInertia:1e3/60,n=e?a?7.5:40:2.5,s=[Math.abs(h[0].offsetTop),Math.abs(h[0].offsetLeft)],u=[c.scrollRatio.y>10?10:c.scrollRatio.y,c.scrollRatio.x>10?10:c.scrollRatio.x],m="x"===f.dir[0]?s[1]+f.dir[1]*u[1]*n:s[0]+f.dir[1]*u[0]*n,p="x"===f.dir[0]?s[1]+f.dir[1]*parseInt(f.scrollAmount):s[0]+f.dir[1]*parseInt(f.scrollAmount),g="auto"!==f.scrollAmount?p:m,v=i?i:e?a?"mcsLinearOut":"mcsEaseInOut":"mcsLinear",x=e?!0:!1;return e&&17>o&&(g="x"===f.dir[0]?s[1]:s[0]),Q(t,g.toString(),{dir:f.dir[0],scrollEasing:v,dur:o,onComplete:x}),e?void(f.dir=!1):(clearTimeout(f.step),void(f.step=setTimeout(function(){l()},o)))}function s(){clearTimeout(f.step),Z(f,"step"),V(t)}var c=t.data(n),d=c.opt,f=c.sequential,h=e("#mCSB_"+c.idx+"_container"),m="stepped"===f.type?!0:!1;switch(a){case"on":if(f.dir=[o===u[16]||o===u[15]||39===o||37===o?"x":"y",o===u[13]||o===u[15]||38===o||37===o?-1:1],V(t),tt(o)&&"stepped"===f.type)return;l(m);break;case"off":s(),(m||c.tweenRunning&&f.dir)&&l(!0)}},j=function(t){var a=e(this).data(n).opt,o=[];return"function"==typeof t&&(t=t()),t instanceof Array?o=t.length>1?[t[0],t[1]]:"x"===a.axis?[null,t[0]]:[t[0],null]:(o[0]=t.y?t.y:t.x||"x"===a.axis?null:t,o[1]=t.x?t.x:t.y||"y"===a.axis?null:t),"function"==typeof o[0]&&(o[0]=o[0]()),"function"==typeof o[1]&&(o[1]=o[1]()),o},Y=function(t,a){if(null!=t&&"undefined"!=typeof t){var o=e(this),i=o.data(n),r=i.opt,l=e("#mCSB_"+i.idx+"_container"),s=l.parent(),c=typeof t;a||(a="x"===r.axis?"x":"y");var d="x"===a?l.outerWidth(!1):l.outerHeight(!1),u="x"===a?l[0].offsetLeft:l[0].offsetTop,h="x"===a?"left":"top";switch(c){case"function":return t();case"object":var m=t.jquery?t:e(t);if(!m.length)return;return"x"===a?at(m)[1]:at(m)[0];case"string":case"number":if(tt(t))return Math.abs(t);if(-1!==t.indexOf("%"))return Math.abs(d*parseInt(t)/100);if(-1!==t.indexOf("-="))return Math.abs(u-parseInt(t.split("-=")[1]));if(-1!==t.indexOf("+=")){var p=u+parseInt(t.split("+=")[1]);return p>=0?0:Math.abs(p)}if(-1!==t.indexOf("px")&&tt(t.split("px")[0]))return Math.abs(t.split("px")[0]);if("top"===t||"left"===t)return 0;if("bottom"===t)return Math.abs(s.height()-l.outerHeight(!1));if("right"===t)return Math.abs(s.width()-l.outerWidth(!1));if("first"===t||"last"===t){var m=l.find(":"+t);return"x"===a?at(m)[1]:at(m)[0]}return e(t).length?"x"===a?at(e(t))[1]:at(e(t))[0]:(l.css(h,t),void f.update.call(null,o[0]))}}},X=function(t){function a(){clearTimeout(h[0].autoUpdate),h[0].autoUpdate=setTimeout(function(){return d.advanced.updateOnSelectorChange&&(m=r(),m!==S)?(l(3),void(S=m)):(d.advanced.updateOnContentResize&&(p=[h.outerHeight(!1),h.outerWidth(!1),v.height(),v.width(),_()[0],_()[1]],(p[0]!==w[0]||p[1]!==w[1]||p[2]!==w[2]||p[3]!==w[3]||p[4]!==w[4]||p[5]!==w[5])&&(l(p[0]!==w[0]||p[1]!==w[1]),w=p)),d.advanced.updateOnImageLoad&&(g=o(),g!==b&&(h.find("img").each(function(){i(this)}),b=g)),void((d.advanced.updateOnSelectorChange||d.advanced.updateOnContentResize||d.advanced.updateOnImageLoad)&&a()))},60)}function o(){var e=0;return d.advanced.updateOnImageLoad&&(e=h.find("img").length),e}function i(t){function a(e,t){return function(){return t.apply(e,arguments)}}function o(){this.onload=null,e(t).addClass(u[2]),l(2)}if(e(t).hasClass(u[2]))return void l();var n=new Image;n.onload=a(n,o),n.src=t.src}function r(){d.advanced.updateOnSelectorChange===!0&&(d.advanced.updateOnSelectorChange="*");var t=0,a=h.find(d.advanced.updateOnSelectorChange);return d.advanced.updateOnSelectorChange&&a.length>0&&a.each(function(){t+=e(this).height()+e(this).width()}),t}function l(e){clearTimeout(h[0].autoUpdate),f.update.call(null,s[0],e)}var s=e(this),c=s.data(n),d=c.opt,h=e("#mCSB_"+c.idx+"_container");if(t)return clearTimeout(h[0].autoUpdate),void Z(h[0],"autoUpdate");var m,p,g,v=h.parent(),x=[e("#mCSB_"+c.idx+"_scrollbar_vertical"),e("#mCSB_"+c.idx+"_scrollbar_horizontal")],_=function(){return[x[0].is(":visible")?x[0].outerHeight(!0):0,x[1].is(":visible")?x[1].outerWidth(!0):0]},S=r(),w=[h.outerHeight(!1),h.outerWidth(!1),v.height(),v.width(),_()[0],_()[1]],b=o();a()},N=function(e,t,a){return Math.round(e/t)*t-a},V=function(t){var a=t.data(n),o=e("#mCSB_"+a.idx+"_container,#mCSB_"+a.idx+"_container_wrapper,#mCSB_"+a.idx+"_dragger_vertical,#mCSB_"+a.idx+"_dragger_horizontal");o.each(function(){K.call(this)})},Q=function(t,a,o){function i(e){return s&&c.callbacks[e]&&"function"==typeof c.callbacks[e]}function r(){return[c.callbacks.alwaysTriggerOffsets||_>=S[0]+b,c.callbacks.alwaysTriggerOffsets||-C>=_]}function l(){var e=[h[0].offsetTop,h[0].offsetLeft],a=[v[0].offsetTop,v[0].offsetLeft],n=[h.outerHeight(!1),h.outerWidth(!1)],i=[f.height(),f.width()];t[0].mcs={content:h,top:e[0],left:e[1],draggerTop:a[0],draggerLeft:a[1],topPct:Math.round(100*Math.abs(e[0])/(Math.abs(n[0])-i[0])),leftPct:Math.round(100*Math.abs(e[1])/(Math.abs(n[1])-i[1])),direction:o.dir}}var s=t.data(n),c=s.opt,d={trigger:"internal",dir:"y",scrollEasing:"mcsEaseOut",drag:!1,dur:c.scrollInertia,overwrite:"all",callbacks:!0,onStart:!0,onUpdate:!0,onComplete:!0},o=e.extend(d,o),u=[o.dur,o.drag?0:o.dur],f=e("#mCSB_"+s.idx),h=e("#mCSB_"+s.idx+"_container"),m=h.parent(),p=c.callbacks.onTotalScrollOffset?j.call(t,c.callbacks.onTotalScrollOffset):[0,0],g=c.callbacks.onTotalScrollBackOffset?j.call(t,c.callbacks.onTotalScrollBackOffset):[0,0];if(s.trigger=o.trigger,(0!==m.scrollTop()||0!==m.scrollLeft())&&(e(".mCSB_"+s.idx+"_scrollbar").css("visibility","visible"),m.scrollTop(0).scrollLeft(0)),"_resetY"!==a||s.contentReset.y||(i("onOverflowYNone")&&c.callbacks.onOverflowYNone.call(t[0]),s.contentReset.y=1),"_resetX"!==a||s.contentReset.x||(i("onOverflowXNone")&&c.callbacks.onOverflowXNone.call(t[0]),s.contentReset.x=1),"_resetY"!==a&&"_resetX"!==a){switch(!s.contentReset.y&&t[0].mcs||!s.overflowed[0]||(i("onOverflowY")&&c.callbacks.onOverflowY.call(t[0]),s.contentReset.x=null),!s.contentReset.x&&t[0].mcs||!s.overflowed[1]||(i("onOverflowX")&&c.callbacks.onOverflowX.call(t[0]),s.contentReset.x=null),c.snapAmount&&(a=N(a,c.snapAmount,c.snapOffset)),o.dir){case"x":var v=e("#mCSB_"+s.idx+"_dragger_horizontal"),x="left",_=h[0].offsetLeft,S=[f.width()-h.outerWidth(!1),v.parent().width()-v.width()],w=[a,0===a?0:a/s.scrollRatio.x],b=p[1],C=g[1],y=b>0?b/s.scrollRatio.x:0,T=C>0?C/s.scrollRatio.x:0;break;
case"y":var v=e("#mCSB_"+s.idx+"_dragger_vertical"),x="top",_=h[0].offsetTop,S=[f.height()-h.outerHeight(!1),v.parent().height()-v.height()],w=[a,0===a?0:a/s.scrollRatio.y],b=p[0],C=g[0],y=b>0?b/s.scrollRatio.y:0,T=C>0?C/s.scrollRatio.y:0}w[1]<0||0===w[0]&&0===w[1]?w=[0,0]:w[1]>=S[1]?w=[S[0],S[1]]:w[0]=-w[0],t[0].mcs||(l(),i("onInit")&&c.callbacks.onInit.call(t[0])),clearTimeout(h[0].onCompleteTimeout),(s.tweenRunning||!(0===_&&w[0]>=0||_===S[0]&&w[0]<=S[0]))&&(G(v[0],x,Math.round(w[1]),u[1],o.scrollEasing),G(h[0],x,Math.round(w[0]),u[0],o.scrollEasing,o.overwrite,{onStart:function(){o.callbacks&&o.onStart&&!s.tweenRunning&&(i("onScrollStart")&&(l(),c.callbacks.onScrollStart.call(t[0])),s.tweenRunning=!0,B(v),s.cbOffsets=r())},onUpdate:function(){o.callbacks&&o.onUpdate&&i("whileScrolling")&&(l(),c.callbacks.whileScrolling.call(t[0]))},onComplete:function(){if(o.callbacks&&o.onComplete){"yx"===c.axis&&clearTimeout(h[0].onCompleteTimeout);var e=h[0].idleTimer||0;h[0].onCompleteTimeout=setTimeout(function(){i("onScroll")&&(l(),c.callbacks.onScroll.call(t[0])),i("onTotalScroll")&&w[1]>=S[1]-y&&s.cbOffsets[0]&&(l(),c.callbacks.onTotalScroll.call(t[0])),i("onTotalScrollBack")&&w[1]<=T&&s.cbOffsets[1]&&(l(),c.callbacks.onTotalScrollBack.call(t[0])),s.tweenRunning=!1,h[0].idleTimer=0,B(v,"hide")},e)}}}))}},G=function(e,a,o,n,i,r,l){function s(){b.stop||(_||p.call(),_=J()-x,c(),_>=b.time&&(b.time=_>b.time?_+h-(_-b.time):_+h-1,b.time<_+1&&(b.time=_+1)),b.time<n?b.id=m(s):v.call())}function c(){n>0?(b.currVal=f(b.time,S,C,n,i),w[a]=Math.round(b.currVal)+"px"):w[a]=o+"px",g.call()}function d(){h=1e3/60,b.time=_+h,m=t.requestAnimationFrame?t.requestAnimationFrame:function(e){return c(),setTimeout(e,.01)},b.id=m(s)}function u(){null!=b.id&&(t.requestAnimationFrame?t.cancelAnimationFrame(b.id):clearTimeout(b.id),b.id=null)}function f(e,t,a,o,n){switch(n){case"linear":case"mcsLinear":return a*e/o+t;case"mcsLinearOut":return e/=o,e--,a*Math.sqrt(1-e*e)+t;case"easeInOutSmooth":return e/=o/2,1>e?a/2*e*e+t:(e--,-a/2*(e*(e-2)-1)+t);case"easeInOutStrong":return e/=o/2,1>e?a/2*Math.pow(2,10*(e-1))+t:(e--,a/2*(-Math.pow(2,-10*e)+2)+t);case"easeInOut":case"mcsEaseInOut":return e/=o/2,1>e?a/2*e*e*e+t:(e-=2,a/2*(e*e*e+2)+t);case"easeOutSmooth":return e/=o,e--,-a*(e*e*e*e-1)+t;case"easeOutStrong":return a*(-Math.pow(2,-10*e/o)+1)+t;case"easeOut":case"mcsEaseOut":default:var i=(e/=o)*e,r=i*e;return t+a*(.499999999999997*r*i+-2.5*i*i+5.5*r+-6.5*i+4*e)}}e._mTween||(e._mTween={top:{},left:{}});var h,m,l=l||{},p=l.onStart||function(){},g=l.onUpdate||function(){},v=l.onComplete||function(){},x=J(),_=0,S=e.offsetTop,w=e.style,b=e._mTween[a];"left"===a&&(S=e.offsetLeft);var C=o-S;b.stop=0,"none"!==r&&u(),d()},J=function(){return t.performance&&t.performance.now?t.performance.now():t.performance&&t.performance.webkitNow?t.performance.webkitNow():Date.now?Date.now():(new Date).getTime()},K=function(){var e=this;e._mTween||(e._mTween={top:{},left:{}});for(var a=["top","left"],o=0;o<a.length;o++){var n=a[o];e._mTween[n].id&&(t.requestAnimationFrame?t.cancelAnimationFrame(e._mTween[n].id):clearTimeout(e._mTween[n].id),e._mTween[n].id=null,e._mTween[n].stop=1)}},Z=function(e,t){try{delete e[t]}catch(a){e[t]=null}},$=function(e){return!(e.which&&1!==e.which)},et=function(e){var t=e.originalEvent.pointerType;return!(t&&"touch"!==t&&2!==t)},tt=function(e){return!isNaN(parseFloat(e))&&isFinite(e)},at=function(e){var t=e.parents(".mCSB_container");return[e.offset().top-t.offset().top,e.offset().left-t.offset().left]};e.fn[o]=function(t){return f[t]?f[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?void e.error("Method "+t+" does not exist"):f.init.apply(this,arguments)},e[o]=function(t){return f[t]?f[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?void e.error("Method "+t+" does not exist"):f.init.apply(this,arguments)},e[o].defaults=r,t[o]=!0,e(t).load(function(){e(i)[o](),e.extend(e.expr[":"],{mcsInView:e.expr[":"].mcsInView||function(t){var a,o,n=e(t),i=n.parents(".mCSB_container");if(i.length)return a=i.parent(),o=[i[0].offsetTop,i[0].offsetLeft],o[0]+at(n)[0]>=0&&o[0]+at(n)[0]<a.height()-n.outerHeight(!1)&&o[1]+at(n)[1]>=0&&o[1]+at(n)[1]<a.width()-n.outerWidth(!1)},mcsOverflow:e.expr[":"].mcsOverflow||function(t){var a=e(t).data(n);if(a)return a.overflowed[0]||a.overflowed[1]}})})})}(jQuery,window,document);
///#source 1 1 Plugins/jquery-dateFormat.min.js
/*! jquery-dateFormat 05-10-2014 */
var DateFormat={};!function(a){var b=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],c=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],d=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],e=["January","February","March","April","May","June","July","August","September","October","November","December"],f={Jan:"01",Feb:"02",Mar:"03",Apr:"04",May:"05",Jun:"06",Jul:"07",Aug:"08",Sep:"09",Oct:"10",Nov:"11",Dec:"12"},g=/\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}\.?\d{0,3}[Z\-+]?(\d{2}:?\d{2})?/;a.format=function(){function a(a){return b[parseInt(a,10)]||a}function h(a){return c[parseInt(a,10)]||a}function i(a){var b=parseInt(a,10)-1;return d[b]||a}function j(a){var b=parseInt(a,10)-1;return e[b]||a}function k(a){return f[a]||a}function l(a){var b,c,d,e,f,g=a,h="";return-1!==g.indexOf(".")&&(e=g.split("."),g=e[0],h=e[1]),f=g.split(":"),3===f.length?(b=f[0],c=f[1],d=f[2].replace(/\s.+/,"").replace(/[a-z]/gi,""),g=g.replace(/\s.+/,"").replace(/[a-z]/gi,""),{time:g,hour:b,minute:c,second:d,millis:h}):{time:"",hour:"",minute:"",second:"",millis:""}}function m(a,b){for(var c=b-String(a).length,d=0;c>d;d++)a="0"+a;return a}return{parseDate:function(a){var b={date:null,year:null,month:null,dayOfMonth:null,dayOfWeek:null,time:null};if("number"==typeof a)return this.parseDate(new Date(a));if("function"==typeof a.getFullYear)b.year=String(a.getFullYear()),b.month=String(a.getMonth()+1),b.dayOfMonth=String(a.getDate()),b.time=l(a.toTimeString()+"."+a.getMilliseconds());else if(-1!=a.search(g))values=a.split(/[T\+-]/),b.year=values[0],b.month=values[1],b.dayOfMonth=values[2],b.time=l(values[3].split(".")[0]);else switch(values=a.split(" "),6===values.length&&isNaN(values[5])&&(values[values.length]="()"),values.length){case 6:b.year=values[5],b.month=k(values[1]),b.dayOfMonth=values[2],b.time=l(values[3]);break;case 2:subValues=values[0].split("-"),b.year=subValues[0],b.month=subValues[1],b.dayOfMonth=subValues[2],b.time=l(values[1]);break;case 7:case 9:case 10:b.year=values[3],b.month=k(values[1]),b.dayOfMonth=values[2],b.time=l(values[4]);break;case 1:subValues=values[0].split(""),b.year=subValues[0]+subValues[1]+subValues[2]+subValues[3],b.month=subValues[5]+subValues[6],b.dayOfMonth=subValues[8]+subValues[9],b.time=l(subValues[13]+subValues[14]+subValues[15]+subValues[16]+subValues[17]+subValues[18]+subValues[19]+subValues[20]);break;default:return null}return b.date=new Date(b.year,b.month-1,b.dayOfMonth),b.dayOfWeek=String(b.date.getDay()),b},date:function(b,c){try{var d=this.parseDate(b);if(null===d)return b;for(var e=(d.date,d.year),f=d.month,g=d.dayOfMonth,k=d.dayOfWeek,l=d.time,n="",o="",p="",q=!1,r=0;r<c.length;r++){var s=c.charAt(r),t=c.charAt(r+1);if(q)"'"==s?(o+=""===n?"'":n,n="",q=!1):n+=s;else switch(n+=s,p="",n){case"ddd":o+=a(k),n="";break;case"dd":if("d"===t)break;o+=m(g,2),n="";break;case"d":if("d"===t)break;o+=parseInt(g,10),n="";break;case"D":g=1==g||21==g||31==g?parseInt(g,10)+"st":2==g||22==g?parseInt(g,10)+"nd":3==g||23==g?parseInt(g,10)+"rd":parseInt(g,10)+"th",o+=g,n="";break;case"MMMM":o+=j(f),n="";break;case"MMM":if("M"===t)break;o+=i(f),n="";break;case"MM":if("M"===t)break;o+=m(f,2),n="";break;case"M":if("M"===t)break;o+=parseInt(f,10),n="";break;case"y":case"yyy":if("y"===t)break;o+=n,n="";break;case"yy":if("y"===t)break;o+=String(e).slice(-2),n="";break;case"yyyy":o+=e,n="";break;case"HH":o+=m(l.hour,2),n="";break;case"H":if("H"===t)break;o+=parseInt(l.hour,10),n="";break;case"hh":hour=0===parseInt(l.hour,10)?12:l.hour<13?l.hour:l.hour-12,o+=m(hour,2),n="";break;case"h":if("h"===t)break;hour=0===parseInt(l.hour,10)?12:l.hour<13?l.hour:l.hour-12,o+=parseInt(hour,10),n="";break;case"mm":o+=m(l.minute,2),n="";break;case"m":if("m"===t)break;o+=l.minute,n="";break;case"ss":o+=m(l.second.substring(0,2),2),n="";break;case"s":if("s"===t)break;o+=l.second,n="";break;case"S":case"SS":if("S"===t)break;o+=n,n="";break;case"SSS":o+=l.millis.substring(0,3),n="";break;case"a":o+=l.hour>=12?"PM":"AM",n="";break;case"p":o+=l.hour>=12?"p.m.":"a.m.",n="";break;case"E":o+=h(k),n="";break;case"'":n="",q=!0;break;default:o+=s,n=""}}return o+=p}catch(u){return console&&console.log&&console.log(u),b}},prettyDate:function(a){var b,c,d;return("string"==typeof a||"number"==typeof a)&&(b=new Date(a)),"object"==typeof a&&(b=new Date(a.toString())),c=((new Date).getTime()-b.getTime())/1e3,d=Math.floor(c/86400),isNaN(d)||0>d?void 0:60>c?"just now":120>c?"1 minute ago":3600>c?Math.floor(c/60)+" minutes ago":7200>c?"1 hour ago":86400>c?Math.floor(c/3600)+" hours ago":1===d?"Yesterday":7>d?d+" days ago":31>d?Math.ceil(d/7)+" weeks ago":d>=31?"more than 5 weeks ago":void 0},toBrowserTimeZone:function(a,b){return this.date(new Date(a),b||"MM/dd/yyyy HH:mm:ss")}}}()}(DateFormat),function(a){a.format=DateFormat.format}(jQuery);
///#source 1 1 Plugins/handlebars-v2.0.0.js
/*!

 handlebars v2.0.0

Copyright (C) 2011-2014 by Yehuda Katz

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.

@license
*/
/* exported Handlebars */
(function (root, factory) {
  if (typeof define === 'function' && define.amd) {
    define([], factory);
  } else if (typeof exports === 'object') {
    module.exports = factory();
  } else {
    root.Handlebars = root.Handlebars || factory();
  }
}(this, function () {
// handlebars/safe-string.js
var __module4__ = (function() {
  "use strict";
  var __exports__;
  // Build out our basic SafeString type
  function SafeString(string) {
    this.string = string;
  }

  SafeString.prototype.toString = function() {
    return "" + this.string;
  };

  __exports__ = SafeString;
  return __exports__;
})();

// handlebars/utils.js
var __module3__ = (function(__dependency1__) {
  "use strict";
  var __exports__ = {};
  /*jshint -W004 */
  var SafeString = __dependency1__;

  var escape = {
    "&": "&amp;",
    "<": "&lt;",
    ">": "&gt;",
    '"': "&quot;",
    "'": "&#x27;",
    "`": "&#x60;"
  };

  var badChars = /[&<>"'`]/g;
  var possible = /[&<>"'`]/;

  function escapeChar(chr) {
    return escape[chr];
  }

  function extend(obj /* , ...source */) {
    for (var i = 1; i < arguments.length; i++) {
      for (var key in arguments[i]) {
        if (Object.prototype.hasOwnProperty.call(arguments[i], key)) {
          obj[key] = arguments[i][key];
        }
      }
    }

    return obj;
  }

  __exports__.extend = extend;var toString = Object.prototype.toString;
  __exports__.toString = toString;
  // Sourced from lodash
  // https://github.com/bestiejs/lodash/blob/master/LICENSE.txt
  var isFunction = function(value) {
    return typeof value === 'function';
  };
  // fallback for older versions of Chrome and Safari
  /* istanbul ignore next */
  if (isFunction(/x/)) {
    isFunction = function(value) {
      return typeof value === 'function' && toString.call(value) === '[object Function]';
    };
  }
  var isFunction;
  __exports__.isFunction = isFunction;
  /* istanbul ignore next */
  var isArray = Array.isArray || function(value) {
    return (value && typeof value === 'object') ? toString.call(value) === '[object Array]' : false;
  };
  __exports__.isArray = isArray;

  function escapeExpression(string) {
    // don't escape SafeStrings, since they're already safe
    if (string instanceof SafeString) {
      return string.toString();
    } else if (string == null) {
      return "";
    } else if (!string) {
      return string + '';
    }

    // Force a string conversion as this will be done by the append regardless and
    // the regex test will do this transparently behind the scenes, causing issues if
    // an object's to string has escaped characters in it.
    string = "" + string;

    if(!possible.test(string)) { return string; }
    return string.replace(badChars, escapeChar);
  }

  __exports__.escapeExpression = escapeExpression;function isEmpty(value) {
    if (!value && value !== 0) {
      return true;
    } else if (isArray(value) && value.length === 0) {
      return true;
    } else {
      return false;
    }
  }

  __exports__.isEmpty = isEmpty;function appendContextPath(contextPath, id) {
    return (contextPath ? contextPath + '.' : '') + id;
  }

  __exports__.appendContextPath = appendContextPath;
  return __exports__;
})(__module4__);

// handlebars/exception.js
var __module5__ = (function() {
  "use strict";
  var __exports__;

  var errorProps = ['description', 'fileName', 'lineNumber', 'message', 'name', 'number', 'stack'];

  function Exception(message, node) {
    var line;
    if (node && node.firstLine) {
      line = node.firstLine;

      message += ' - ' + line + ':' + node.firstColumn;
    }

    var tmp = Error.prototype.constructor.call(this, message);

    // Unfortunately errors are not enumerable in Chrome (at least), so `for prop in tmp` doesn't work.
    for (var idx = 0; idx < errorProps.length; idx++) {
      this[errorProps[idx]] = tmp[errorProps[idx]];
    }

    if (line) {
      this.lineNumber = line;
      this.column = node.firstColumn;
    }
  }

  Exception.prototype = new Error();

  __exports__ = Exception;
  return __exports__;
})();

// handlebars/base.js
var __module2__ = (function(__dependency1__, __dependency2__) {
  "use strict";
  var __exports__ = {};
  var Utils = __dependency1__;
  var Exception = __dependency2__;

  var VERSION = "2.0.0";
  __exports__.VERSION = VERSION;var COMPILER_REVISION = 6;
  __exports__.COMPILER_REVISION = COMPILER_REVISION;
  var REVISION_CHANGES = {
    1: '<= 1.0.rc.2', // 1.0.rc.2 is actually rev2 but doesn't report it
    2: '== 1.0.0-rc.3',
    3: '== 1.0.0-rc.4',
    4: '== 1.x.x',
    5: '== 2.0.0-alpha.x',
    6: '>= 2.0.0-beta.1'
  };
  __exports__.REVISION_CHANGES = REVISION_CHANGES;
  var isArray = Utils.isArray,
      isFunction = Utils.isFunction,
      toString = Utils.toString,
      objectType = '[object Object]';

  function HandlebarsEnvironment(helpers, partials) {
    this.helpers = helpers || {};
    this.partials = partials || {};

    registerDefaultHelpers(this);
  }

  __exports__.HandlebarsEnvironment = HandlebarsEnvironment;HandlebarsEnvironment.prototype = {
    constructor: HandlebarsEnvironment,

    logger: logger,
    log: log,

    registerHelper: function(name, fn) {
      if (toString.call(name) === objectType) {
        if (fn) { throw new Exception('Arg not supported with multiple helpers'); }
        Utils.extend(this.helpers, name);
      } else {
        this.helpers[name] = fn;
      }
    },
    unregisterHelper: function(name) {
      delete this.helpers[name];
    },

    registerPartial: function(name, partial) {
      if (toString.call(name) === objectType) {
        Utils.extend(this.partials,  name);
      } else {
        this.partials[name] = partial;
      }
    },
    unregisterPartial: function(name) {
      delete this.partials[name];
    }
  };

  function registerDefaultHelpers(instance) {
    instance.registerHelper('helperMissing', function(/* [args, ]options */) {
      if(arguments.length === 1) {
        // A missing field in a {{foo}} constuct.
        return undefined;
      } else {
        // Someone is actually trying to call something, blow up.
        throw new Exception("Missing helper: '" + arguments[arguments.length-1].name + "'");
      }
    });

    instance.registerHelper('blockHelperMissing', function(context, options) {
      var inverse = options.inverse,
          fn = options.fn;

      if(context === true) {
        return fn(this);
      } else if(context === false || context == null) {
        return inverse(this);
      } else if (isArray(context)) {
        if(context.length > 0) {
          if (options.ids) {
            options.ids = [options.name];
          }

          return instance.helpers.each(context, options);
        } else {
          return inverse(this);
        }
      } else {
        if (options.data && options.ids) {
          var data = createFrame(options.data);
          data.contextPath = Utils.appendContextPath(options.data.contextPath, options.name);
          options = {data: data};
        }

        return fn(context, options);
      }
    });

    instance.registerHelper('each', function(context, options) {
      if (!options) {
        throw new Exception('Must pass iterator to #each');
      }

      var fn = options.fn, inverse = options.inverse;
      var i = 0, ret = "", data;

      var contextPath;
      if (options.data && options.ids) {
        contextPath = Utils.appendContextPath(options.data.contextPath, options.ids[0]) + '.';
      }

      if (isFunction(context)) { context = context.call(this); }

      if (options.data) {
        data = createFrame(options.data);
      }

      if(context && typeof context === 'object') {
        if (isArray(context)) {
          for(var j = context.length; i<j; i++) {
            if (data) {
              data.index = i;
              data.first = (i === 0);
              data.last  = (i === (context.length-1));

              if (contextPath) {
                data.contextPath = contextPath + i;
              }
            }
            ret = ret + fn(context[i], { data: data });
          }
        } else {
          for(var key in context) {
            if(context.hasOwnProperty(key)) {
              if(data) {
                data.key = key;
                data.index = i;
                data.first = (i === 0);

                if (contextPath) {
                  data.contextPath = contextPath + key;
                }
              }
              ret = ret + fn(context[key], {data: data});
              i++;
            }
          }
        }
      }

      if(i === 0){
        ret = inverse(this);
      }

      return ret;
    });

    instance.registerHelper('if', function(conditional, options) {
      if (isFunction(conditional)) { conditional = conditional.call(this); }

      // Default behavior is to render the positive path if the value is truthy and not empty.
      // The `includeZero` option may be set to treat the condtional as purely not empty based on the
      // behavior of isEmpty. Effectively this determines if 0 is handled by the positive path or negative.
      if ((!options.hash.includeZero && !conditional) || Utils.isEmpty(conditional)) {
        return options.inverse(this);
      } else {
        return options.fn(this);
      }
    });

    instance.registerHelper('unless', function(conditional, options) {
      return instance.helpers['if'].call(this, conditional, {fn: options.inverse, inverse: options.fn, hash: options.hash});
    });

    instance.registerHelper('with', function(context, options) {
      if (isFunction(context)) { context = context.call(this); }

      var fn = options.fn;

      if (!Utils.isEmpty(context)) {
        if (options.data && options.ids) {
          var data = createFrame(options.data);
          data.contextPath = Utils.appendContextPath(options.data.contextPath, options.ids[0]);
          options = {data:data};
        }

        return fn(context, options);
      } else {
        return options.inverse(this);
      }
    });

    instance.registerHelper('log', function(message, options) {
      var level = options.data && options.data.level != null ? parseInt(options.data.level, 10) : 1;
      instance.log(level, message);
    });

    instance.registerHelper('lookup', function(obj, field) {
      return obj && obj[field];
    });
  }

  var logger = {
    methodMap: { 0: 'debug', 1: 'info', 2: 'warn', 3: 'error' },

    // State enum
    DEBUG: 0,
    INFO: 1,
    WARN: 2,
    ERROR: 3,
    level: 3,

    // can be overridden in the host environment
    log: function(level, message) {
      if (logger.level <= level) {
        var method = logger.methodMap[level];
        if (typeof console !== 'undefined' && console[method]) {
          console[method].call(console, message);
        }
      }
    }
  };
  __exports__.logger = logger;
  var log = logger.log;
  __exports__.log = log;
  var createFrame = function(object) {
    var frame = Utils.extend({}, object);
    frame._parent = object;
    return frame;
  };
  __exports__.createFrame = createFrame;
  return __exports__;
})(__module3__, __module5__);

// handlebars/runtime.js
var __module6__ = (function(__dependency1__, __dependency2__, __dependency3__) {
  "use strict";
  var __exports__ = {};
  var Utils = __dependency1__;
  var Exception = __dependency2__;
  var COMPILER_REVISION = __dependency3__.COMPILER_REVISION;
  var REVISION_CHANGES = __dependency3__.REVISION_CHANGES;
  var createFrame = __dependency3__.createFrame;

  function checkRevision(compilerInfo) {
    var compilerRevision = compilerInfo && compilerInfo[0] || 1,
        currentRevision = COMPILER_REVISION;

    if (compilerRevision !== currentRevision) {
      if (compilerRevision < currentRevision) {
        var runtimeVersions = REVISION_CHANGES[currentRevision],
            compilerVersions = REVISION_CHANGES[compilerRevision];
        throw new Exception("Template was precompiled with an older version of Handlebars than the current runtime. "+
              "Please update your precompiler to a newer version ("+runtimeVersions+") or downgrade your runtime to an older version ("+compilerVersions+").");
      } else {
        // Use the embedded version info since the runtime doesn't know about this revision yet
        throw new Exception("Template was precompiled with a newer version of Handlebars than the current runtime. "+
              "Please update your runtime to a newer version ("+compilerInfo[1]+").");
      }
    }
  }

  __exports__.checkRevision = checkRevision;// TODO: Remove this line and break up compilePartial

  function template(templateSpec, env) {
    /* istanbul ignore next */
    if (!env) {
      throw new Exception("No environment passed to template");
    }
    if (!templateSpec || !templateSpec.main) {
      throw new Exception('Unknown template object: ' + typeof templateSpec);
    }

    // Note: Using env.VM references rather than local var references throughout this section to allow
    // for external users to override these as psuedo-supported APIs.
    env.VM.checkRevision(templateSpec.compiler);

    var invokePartialWrapper = function(partial, indent, name, context, hash, helpers, partials, data, depths) {
      if (hash) {
        context = Utils.extend({}, context, hash);
      }

      var result = env.VM.invokePartial.call(this, partial, name, context, helpers, partials, data, depths);

      if (result == null && env.compile) {
        var options = { helpers: helpers, partials: partials, data: data, depths: depths };
        partials[name] = env.compile(partial, { data: data !== undefined, compat: templateSpec.compat }, env);
        result = partials[name](context, options);
      }
      if (result != null) {
        if (indent) {
          var lines = result.split('\n');
          for (var i = 0, l = lines.length; i < l; i++) {
            if (!lines[i] && i + 1 === l) {
              break;
            }

            lines[i] = indent + lines[i];
          }
          result = lines.join('\n');
        }
        return result;
      } else {
        throw new Exception("The partial " + name + " could not be compiled when running in runtime-only mode");
      }
    };

    // Just add water
    var container = {
      lookup: function(depths, name) {
        var len = depths.length;
        for (var i = 0; i < len; i++) {
          if (depths[i] && depths[i][name] != null) {
            return depths[i][name];
          }
        }
      },
      lambda: function(current, context) {
        return typeof current === 'function' ? current.call(context) : current;
      },

      escapeExpression: Utils.escapeExpression,
      invokePartial: invokePartialWrapper,

      fn: function(i) {
        return templateSpec[i];
      },

      programs: [],
      program: function(i, data, depths) {
        var programWrapper = this.programs[i],
            fn = this.fn(i);
        if (data || depths) {
          programWrapper = program(this, i, fn, data, depths);
        } else if (!programWrapper) {
          programWrapper = this.programs[i] = program(this, i, fn);
        }
        return programWrapper;
      },

      data: function(data, depth) {
        while (data && depth--) {
          data = data._parent;
        }
        return data;
      },
      merge: function(param, common) {
        var ret = param || common;

        if (param && common && (param !== common)) {
          ret = Utils.extend({}, common, param);
        }

        return ret;
      },

      noop: env.VM.noop,
      compilerInfo: templateSpec.compiler
    };

    var ret = function(context, options) {
      options = options || {};
      var data = options.data;

      ret._setup(options);
      if (!options.partial && templateSpec.useData) {
        data = initData(context, data);
      }
      var depths;
      if (templateSpec.useDepths) {
        depths = options.depths ? [context].concat(options.depths) : [context];
      }

      return templateSpec.main.call(container, context, container.helpers, container.partials, data, depths);
    };
    ret.isTop = true;

    ret._setup = function(options) {
      if (!options.partial) {
        container.helpers = container.merge(options.helpers, env.helpers);

        if (templateSpec.usePartial) {
          container.partials = container.merge(options.partials, env.partials);
        }
      } else {
        container.helpers = options.helpers;
        container.partials = options.partials;
      }
    };

    ret._child = function(i, data, depths) {
      if (templateSpec.useDepths && !depths) {
        throw new Exception('must pass parent depths');
      }

      return program(container, i, templateSpec[i], data, depths);
    };
    return ret;
  }

  __exports__.template = template;function program(container, i, fn, data, depths) {
    var prog = function(context, options) {
      options = options || {};

      return fn.call(container, context, container.helpers, container.partials, options.data || data, depths && [context].concat(depths));
    };
    prog.program = i;
    prog.depth = depths ? depths.length : 0;
    return prog;
  }

  __exports__.program = program;function invokePartial(partial, name, context, helpers, partials, data, depths) {
    var options = { partial: true, helpers: helpers, partials: partials, data: data, depths: depths };

    if(partial === undefined) {
      throw new Exception("The partial " + name + " could not be found");
    } else if(partial instanceof Function) {
      return partial(context, options);
    }
  }

  __exports__.invokePartial = invokePartial;function noop() { return ""; }

  __exports__.noop = noop;function initData(context, data) {
    if (!data || !('root' in data)) {
      data = data ? createFrame(data) : {};
      data.root = context;
    }
    return data;
  }
  return __exports__;
})(__module3__, __module5__, __module2__);

// handlebars.runtime.js
var __module1__ = (function(__dependency1__, __dependency2__, __dependency3__, __dependency4__, __dependency5__) {
  "use strict";
  var __exports__;
  /*globals Handlebars: true */
  var base = __dependency1__;

  // Each of these augment the Handlebars object. No need to setup here.
  // (This is done to easily share code between commonjs and browse envs)
  var SafeString = __dependency2__;
  var Exception = __dependency3__;
  var Utils = __dependency4__;
  var runtime = __dependency5__;

  // For compatibility and usage outside of module systems, make the Handlebars object a namespace
  var create = function() {
    var hb = new base.HandlebarsEnvironment();

    Utils.extend(hb, base);
    hb.SafeString = SafeString;
    hb.Exception = Exception;
    hb.Utils = Utils;
    hb.escapeExpression = Utils.escapeExpression;

    hb.VM = runtime;
    hb.template = function(spec) {
      return runtime.template(spec, hb);
    };

    return hb;
  };

  var Handlebars = create();
  Handlebars.create = create;

  Handlebars['default'] = Handlebars;

  __exports__ = Handlebars;
  return __exports__;
})(__module2__, __module4__, __module5__, __module3__, __module6__);

// handlebars/compiler/ast.js
var __module7__ = (function(__dependency1__) {
  "use strict";
  var __exports__;
  var Exception = __dependency1__;

  function LocationInfo(locInfo) {
    locInfo = locInfo || {};
    this.firstLine   = locInfo.first_line;
    this.firstColumn = locInfo.first_column;
    this.lastColumn  = locInfo.last_column;
    this.lastLine    = locInfo.last_line;
  }

  var AST = {
    ProgramNode: function(statements, strip, locInfo) {
      LocationInfo.call(this, locInfo);
      this.type = "program";
      this.statements = statements;
      this.strip = strip;
    },

    MustacheNode: function(rawParams, hash, open, strip, locInfo) {
      LocationInfo.call(this, locInfo);
      this.type = "mustache";
      this.strip = strip;

      // Open may be a string parsed from the parser or a passed boolean flag
      if (open != null && open.charAt) {
        // Must use charAt to support IE pre-10
        var escapeFlag = open.charAt(3) || open.charAt(2);
        this.escaped = escapeFlag !== '{' && escapeFlag !== '&';
      } else {
        this.escaped = !!open;
      }

      if (rawParams instanceof AST.SexprNode) {
        this.sexpr = rawParams;
      } else {
        // Support old AST API
        this.sexpr = new AST.SexprNode(rawParams, hash);
      }

      // Support old AST API that stored this info in MustacheNode
      this.id = this.sexpr.id;
      this.params = this.sexpr.params;
      this.hash = this.sexpr.hash;
      this.eligibleHelper = this.sexpr.eligibleHelper;
      this.isHelper = this.sexpr.isHelper;
    },

    SexprNode: function(rawParams, hash, locInfo) {
      LocationInfo.call(this, locInfo);

      this.type = "sexpr";
      this.hash = hash;

      var id = this.id = rawParams[0];
      var params = this.params = rawParams.slice(1);

      // a mustache is definitely a helper if:
      // * it is an eligible helper, and
      // * it has at least one parameter or hash segment
      this.isHelper = !!(params.length || hash);

      // a mustache is an eligible helper if:
      // * its id is simple (a single part, not `this` or `..`)
      this.eligibleHelper = this.isHelper || id.isSimple;

      // if a mustache is an eligible helper but not a definite
      // helper, it is ambiguous, and will be resolved in a later
      // pass or at runtime.
    },

    PartialNode: function(partialName, context, hash, strip, locInfo) {
      LocationInfo.call(this, locInfo);
      this.type         = "partial";
      this.partialName  = partialName;
      this.context      = context;
      this.hash = hash;
      this.strip = strip;

      this.strip.inlineStandalone = true;
    },

    BlockNode: function(mustache, program, inverse, strip, locInfo) {
      LocationInfo.call(this, locInfo);

      this.type = 'block';
      this.mustache = mustache;
      this.program  = program;
      this.inverse  = inverse;
      this.strip = strip;

      if (inverse && !program) {
        this.isInverse = true;
      }
    },

    RawBlockNode: function(mustache, content, close, locInfo) {
      LocationInfo.call(this, locInfo);

      if (mustache.sexpr.id.original !== close) {
        throw new Exception(mustache.sexpr.id.original + " doesn't match " + close, this);
      }

      content = new AST.ContentNode(content, locInfo);

      this.type = 'block';
      this.mustache = mustache;
      this.program = new AST.ProgramNode([content], {}, locInfo);
    },

    ContentNode: function(string, locInfo) {
      LocationInfo.call(this, locInfo);
      this.type = "content";
      this.original = this.string = string;
    },

    HashNode: function(pairs, locInfo) {
      LocationInfo.call(this, locInfo);
      this.type = "hash";
      this.pairs = pairs;
    },

    IdNode: function(parts, locInfo) {
      LocationInfo.call(this, locInfo);
      this.type = "ID";

      var original = "",
          dig = [],
          depth = 0,
          depthString = '';

      for(var i=0,l=parts.length; i<l; i++) {
        var part = parts[i].part;
        original += (parts[i].separator || '') + part;

        if (part === ".." || part === "." || part === "this") {
          if (dig.length > 0) {
            throw new Exception("Invalid path: " + original, this);
          } else if (part === "..") {
            depth++;
            depthString += '../';
          } else {
            this.isScoped = true;
          }
        } else {
          dig.push(part);
        }
      }

      this.original = original;
      this.parts    = dig;
      this.string   = dig.join('.');
      this.depth    = depth;
      this.idName   = depthString + this.string;

      // an ID is simple if it only has one part, and that part is not
      // `..` or `this`.
      this.isSimple = parts.length === 1 && !this.isScoped && depth === 0;

      this.stringModeValue = this.string;
    },

    PartialNameNode: function(name, locInfo) {
      LocationInfo.call(this, locInfo);
      this.type = "PARTIAL_NAME";
      this.name = name.original;
    },

    DataNode: function(id, locInfo) {
      LocationInfo.call(this, locInfo);
      this.type = "DATA";
      this.id = id;
      this.stringModeValue = id.stringModeValue;
      this.idName = '@' + id.stringModeValue;
    },

    StringNode: function(string, locInfo) {
      LocationInfo.call(this, locInfo);
      this.type = "STRING";
      this.original =
        this.string =
        this.stringModeValue = string;
    },

    NumberNode: function(number, locInfo) {
      LocationInfo.call(this, locInfo);
      this.type = "NUMBER";
      this.original =
        this.number = number;
      this.stringModeValue = Number(number);
    },

    BooleanNode: function(bool, locInfo) {
      LocationInfo.call(this, locInfo);
      this.type = "BOOLEAN";
      this.bool = bool;
      this.stringModeValue = bool === "true";
    },

    CommentNode: function(comment, locInfo) {
      LocationInfo.call(this, locInfo);
      this.type = "comment";
      this.comment = comment;

      this.strip = {
        inlineStandalone: true
      };
    }
  };

  // Must be exported as an object rather than the root of the module as the jison lexer
  // most modify the object to operate properly.
  __exports__ = AST;
  return __exports__;
})(__module5__);

// handlebars/compiler/parser.js
var __module9__ = (function() {
  "use strict";
  var __exports__;
  /* jshint ignore:start */
  /* istanbul ignore next */
  /* Jison generated parser */
  var handlebars = (function(){
  var parser = {trace: function trace() { },
  yy: {},
  symbols_: {"error":2,"root":3,"program":4,"EOF":5,"program_repetition0":6,"statement":7,"mustache":8,"block":9,"rawBlock":10,"partial":11,"CONTENT":12,"COMMENT":13,"openRawBlock":14,"END_RAW_BLOCK":15,"OPEN_RAW_BLOCK":16,"sexpr":17,"CLOSE_RAW_BLOCK":18,"openBlock":19,"block_option0":20,"closeBlock":21,"openInverse":22,"block_option1":23,"OPEN_BLOCK":24,"CLOSE":25,"OPEN_INVERSE":26,"inverseAndProgram":27,"INVERSE":28,"OPEN_ENDBLOCK":29,"path":30,"OPEN":31,"OPEN_UNESCAPED":32,"CLOSE_UNESCAPED":33,"OPEN_PARTIAL":34,"partialName":35,"param":36,"partial_option0":37,"partial_option1":38,"sexpr_repetition0":39,"sexpr_option0":40,"dataName":41,"STRING":42,"NUMBER":43,"BOOLEAN":44,"OPEN_SEXPR":45,"CLOSE_SEXPR":46,"hash":47,"hash_repetition_plus0":48,"hashSegment":49,"ID":50,"EQUALS":51,"DATA":52,"pathSegments":53,"SEP":54,"$accept":0,"$end":1},
  terminals_: {2:"error",5:"EOF",12:"CONTENT",13:"COMMENT",15:"END_RAW_BLOCK",16:"OPEN_RAW_BLOCK",18:"CLOSE_RAW_BLOCK",24:"OPEN_BLOCK",25:"CLOSE",26:"OPEN_INVERSE",28:"INVERSE",29:"OPEN_ENDBLOCK",31:"OPEN",32:"OPEN_UNESCAPED",33:"CLOSE_UNESCAPED",34:"OPEN_PARTIAL",42:"STRING",43:"NUMBER",44:"BOOLEAN",45:"OPEN_SEXPR",46:"CLOSE_SEXPR",50:"ID",51:"EQUALS",52:"DATA",54:"SEP"},
  productions_: [0,[3,2],[4,1],[7,1],[7,1],[7,1],[7,1],[7,1],[7,1],[10,3],[14,3],[9,4],[9,4],[19,3],[22,3],[27,2],[21,3],[8,3],[8,3],[11,5],[11,4],[17,3],[17,1],[36,1],[36,1],[36,1],[36,1],[36,1],[36,3],[47,1],[49,3],[35,1],[35,1],[35,1],[41,2],[30,1],[53,3],[53,1],[6,0],[6,2],[20,0],[20,1],[23,0],[23,1],[37,0],[37,1],[38,0],[38,1],[39,0],[39,2],[40,0],[40,1],[48,1],[48,2]],
  performAction: function anonymous(yytext,yyleng,yylineno,yy,yystate,$$,_$) {
  var $0 = $$.length - 1;
  switch (yystate) {
  case 1: yy.prepareProgram($$[$0-1].statements, true); return $$[$0-1];
  break;
  case 2:this.$ = new yy.ProgramNode(yy.prepareProgram($$[$0]), {}, this._$);
  break;
  case 3:this.$ = $$[$0];
  break;
  case 4:this.$ = $$[$0];
  break;
  case 5:this.$ = $$[$0];
  break;
  case 6:this.$ = $$[$0];
  break;
  case 7:this.$ = new yy.ContentNode($$[$0], this._$);
  break;
  case 8:this.$ = new yy.CommentNode($$[$0], this._$);
  break;
  case 9:this.$ = new yy.RawBlockNode($$[$0-2], $$[$0-1], $$[$0], this._$);
  break;
  case 10:this.$ = new yy.MustacheNode($$[$0-1], null, '', '', this._$);
  break;
  case 11:this.$ = yy.prepareBlock($$[$0-3], $$[$0-2], $$[$0-1], $$[$0], false, this._$);
  break;
  case 12:this.$ = yy.prepareBlock($$[$0-3], $$[$0-2], $$[$0-1], $$[$0], true, this._$);
  break;
  case 13:this.$ = new yy.MustacheNode($$[$0-1], null, $$[$0-2], yy.stripFlags($$[$0-2], $$[$0]), this._$);
  break;
  case 14:this.$ = new yy.MustacheNode($$[$0-1], null, $$[$0-2], yy.stripFlags($$[$0-2], $$[$0]), this._$);
  break;
  case 15:this.$ = { strip: yy.stripFlags($$[$0-1], $$[$0-1]), program: $$[$0] };
  break;
  case 16:this.$ = {path: $$[$0-1], strip: yy.stripFlags($$[$0-2], $$[$0])};
  break;
  case 17:this.$ = new yy.MustacheNode($$[$0-1], null, $$[$0-2], yy.stripFlags($$[$0-2], $$[$0]), this._$);
  break;
  case 18:this.$ = new yy.MustacheNode($$[$0-1], null, $$[$0-2], yy.stripFlags($$[$0-2], $$[$0]), this._$);
  break;
  case 19:this.$ = new yy.PartialNode($$[$0-3], $$[$0-2], $$[$0-1], yy.stripFlags($$[$0-4], $$[$0]), this._$);
  break;
  case 20:this.$ = new yy.PartialNode($$[$0-2], undefined, $$[$0-1], yy.stripFlags($$[$0-3], $$[$0]), this._$);
  break;
  case 21:this.$ = new yy.SexprNode([$$[$0-2]].concat($$[$0-1]), $$[$0], this._$);
  break;
  case 22:this.$ = new yy.SexprNode([$$[$0]], null, this._$);
  break;
  case 23:this.$ = $$[$0];
  break;
  case 24:this.$ = new yy.StringNode($$[$0], this._$);
  break;
  case 25:this.$ = new yy.NumberNode($$[$0], this._$);
  break;
  case 26:this.$ = new yy.BooleanNode($$[$0], this._$);
  break;
  case 27:this.$ = $$[$0];
  break;
  case 28:$$[$0-1].isHelper = true; this.$ = $$[$0-1];
  break;
  case 29:this.$ = new yy.HashNode($$[$0], this._$);
  break;
  case 30:this.$ = [$$[$0-2], $$[$0]];
  break;
  case 31:this.$ = new yy.PartialNameNode($$[$0], this._$);
  break;
  case 32:this.$ = new yy.PartialNameNode(new yy.StringNode($$[$0], this._$), this._$);
  break;
  case 33:this.$ = new yy.PartialNameNode(new yy.NumberNode($$[$0], this._$));
  break;
  case 34:this.$ = new yy.DataNode($$[$0], this._$);
  break;
  case 35:this.$ = new yy.IdNode($$[$0], this._$);
  break;
  case 36: $$[$0-2].push({part: $$[$0], separator: $$[$0-1]}); this.$ = $$[$0-2];
  break;
  case 37:this.$ = [{part: $$[$0]}];
  break;
  case 38:this.$ = [];
  break;
  case 39:$$[$0-1].push($$[$0]);
  break;
  case 48:this.$ = [];
  break;
  case 49:$$[$0-1].push($$[$0]);
  break;
  case 52:this.$ = [$$[$0]];
  break;
  case 53:$$[$0-1].push($$[$0]);
  break;
  }
  },
  table: [{3:1,4:2,5:[2,38],6:3,12:[2,38],13:[2,38],16:[2,38],24:[2,38],26:[2,38],31:[2,38],32:[2,38],34:[2,38]},{1:[3]},{5:[1,4]},{5:[2,2],7:5,8:6,9:7,10:8,11:9,12:[1,10],13:[1,11],14:16,16:[1,20],19:14,22:15,24:[1,18],26:[1,19],28:[2,2],29:[2,2],31:[1,12],32:[1,13],34:[1,17]},{1:[2,1]},{5:[2,39],12:[2,39],13:[2,39],16:[2,39],24:[2,39],26:[2,39],28:[2,39],29:[2,39],31:[2,39],32:[2,39],34:[2,39]},{5:[2,3],12:[2,3],13:[2,3],16:[2,3],24:[2,3],26:[2,3],28:[2,3],29:[2,3],31:[2,3],32:[2,3],34:[2,3]},{5:[2,4],12:[2,4],13:[2,4],16:[2,4],24:[2,4],26:[2,4],28:[2,4],29:[2,4],31:[2,4],32:[2,4],34:[2,4]},{5:[2,5],12:[2,5],13:[2,5],16:[2,5],24:[2,5],26:[2,5],28:[2,5],29:[2,5],31:[2,5],32:[2,5],34:[2,5]},{5:[2,6],12:[2,6],13:[2,6],16:[2,6],24:[2,6],26:[2,6],28:[2,6],29:[2,6],31:[2,6],32:[2,6],34:[2,6]},{5:[2,7],12:[2,7],13:[2,7],16:[2,7],24:[2,7],26:[2,7],28:[2,7],29:[2,7],31:[2,7],32:[2,7],34:[2,7]},{5:[2,8],12:[2,8],13:[2,8],16:[2,8],24:[2,8],26:[2,8],28:[2,8],29:[2,8],31:[2,8],32:[2,8],34:[2,8]},{17:21,30:22,41:23,50:[1,26],52:[1,25],53:24},{17:27,30:22,41:23,50:[1,26],52:[1,25],53:24},{4:28,6:3,12:[2,38],13:[2,38],16:[2,38],24:[2,38],26:[2,38],28:[2,38],29:[2,38],31:[2,38],32:[2,38],34:[2,38]},{4:29,6:3,12:[2,38],13:[2,38],16:[2,38],24:[2,38],26:[2,38],28:[2,38],29:[2,38],31:[2,38],32:[2,38],34:[2,38]},{12:[1,30]},{30:32,35:31,42:[1,33],43:[1,34],50:[1,26],53:24},{17:35,30:22,41:23,50:[1,26],52:[1,25],53:24},{17:36,30:22,41:23,50:[1,26],52:[1,25],53:24},{17:37,30:22,41:23,50:[1,26],52:[1,25],53:24},{25:[1,38]},{18:[2,48],25:[2,48],33:[2,48],39:39,42:[2,48],43:[2,48],44:[2,48],45:[2,48],46:[2,48],50:[2,48],52:[2,48]},{18:[2,22],25:[2,22],33:[2,22],46:[2,22]},{18:[2,35],25:[2,35],33:[2,35],42:[2,35],43:[2,35],44:[2,35],45:[2,35],46:[2,35],50:[2,35],52:[2,35],54:[1,40]},{30:41,50:[1,26],53:24},{18:[2,37],25:[2,37],33:[2,37],42:[2,37],43:[2,37],44:[2,37],45:[2,37],46:[2,37],50:[2,37],52:[2,37],54:[2,37]},{33:[1,42]},{20:43,27:44,28:[1,45],29:[2,40]},{23:46,27:47,28:[1,45],29:[2,42]},{15:[1,48]},{25:[2,46],30:51,36:49,38:50,41:55,42:[1,52],43:[1,53],44:[1,54],45:[1,56],47:57,48:58,49:60,50:[1,59],52:[1,25],53:24},{25:[2,31],42:[2,31],43:[2,31],44:[2,31],45:[2,31],50:[2,31],52:[2,31]},{25:[2,32],42:[2,32],43:[2,32],44:[2,32],45:[2,32],50:[2,32],52:[2,32]},{25:[2,33],42:[2,33],43:[2,33],44:[2,33],45:[2,33],50:[2,33],52:[2,33]},{25:[1,61]},{25:[1,62]},{18:[1,63]},{5:[2,17],12:[2,17],13:[2,17],16:[2,17],24:[2,17],26:[2,17],28:[2,17],29:[2,17],31:[2,17],32:[2,17],34:[2,17]},{18:[2,50],25:[2,50],30:51,33:[2,50],36:65,40:64,41:55,42:[1,52],43:[1,53],44:[1,54],45:[1,56],46:[2,50],47:66,48:58,49:60,50:[1,59],52:[1,25],53:24},{50:[1,67]},{18:[2,34],25:[2,34],33:[2,34],42:[2,34],43:[2,34],44:[2,34],45:[2,34],46:[2,34],50:[2,34],52:[2,34]},{5:[2,18],12:[2,18],13:[2,18],16:[2,18],24:[2,18],26:[2,18],28:[2,18],29:[2,18],31:[2,18],32:[2,18],34:[2,18]},{21:68,29:[1,69]},{29:[2,41]},{4:70,6:3,12:[2,38],13:[2,38],16:[2,38],24:[2,38],26:[2,38],29:[2,38],31:[2,38],32:[2,38],34:[2,38]},{21:71,29:[1,69]},{29:[2,43]},{5:[2,9],12:[2,9],13:[2,9],16:[2,9],24:[2,9],26:[2,9],28:[2,9],29:[2,9],31:[2,9],32:[2,9],34:[2,9]},{25:[2,44],37:72,47:73,48:58,49:60,50:[1,74]},{25:[1,75]},{18:[2,23],25:[2,23],33:[2,23],42:[2,23],43:[2,23],44:[2,23],45:[2,23],46:[2,23],50:[2,23],52:[2,23]},{18:[2,24],25:[2,24],33:[2,24],42:[2,24],43:[2,24],44:[2,24],45:[2,24],46:[2,24],50:[2,24],52:[2,24]},{18:[2,25],25:[2,25],33:[2,25],42:[2,25],43:[2,25],44:[2,25],45:[2,25],46:[2,25],50:[2,25],52:[2,25]},{18:[2,26],25:[2,26],33:[2,26],42:[2,26],43:[2,26],44:[2,26],45:[2,26],46:[2,26],50:[2,26],52:[2,26]},{18:[2,27],25:[2,27],33:[2,27],42:[2,27],43:[2,27],44:[2,27],45:[2,27],46:[2,27],50:[2,27],52:[2,27]},{17:76,30:22,41:23,50:[1,26],52:[1,25],53:24},{25:[2,47]},{18:[2,29],25:[2,29],33:[2,29],46:[2,29],49:77,50:[1,74]},{18:[2,37],25:[2,37],33:[2,37],42:[2,37],43:[2,37],44:[2,37],45:[2,37],46:[2,37],50:[2,37],51:[1,78],52:[2,37],54:[2,37]},{18:[2,52],25:[2,52],33:[2,52],46:[2,52],50:[2,52]},{12:[2,13],13:[2,13],16:[2,13],24:[2,13],26:[2,13],28:[2,13],29:[2,13],31:[2,13],32:[2,13],34:[2,13]},{12:[2,14],13:[2,14],16:[2,14],24:[2,14],26:[2,14],28:[2,14],29:[2,14],31:[2,14],32:[2,14],34:[2,14]},{12:[2,10]},{18:[2,21],25:[2,21],33:[2,21],46:[2,21]},{18:[2,49],25:[2,49],33:[2,49],42:[2,49],43:[2,49],44:[2,49],45:[2,49],46:[2,49],50:[2,49],52:[2,49]},{18:[2,51],25:[2,51],33:[2,51],46:[2,51]},{18:[2,36],25:[2,36],33:[2,36],42:[2,36],43:[2,36],44:[2,36],45:[2,36],46:[2,36],50:[2,36],52:[2,36],54:[2,36]},{5:[2,11],12:[2,11],13:[2,11],16:[2,11],24:[2,11],26:[2,11],28:[2,11],29:[2,11],31:[2,11],32:[2,11],34:[2,11]},{30:79,50:[1,26],53:24},{29:[2,15]},{5:[2,12],12:[2,12],13:[2,12],16:[2,12],24:[2,12],26:[2,12],28:[2,12],29:[2,12],31:[2,12],32:[2,12],34:[2,12]},{25:[1,80]},{25:[2,45]},{51:[1,78]},{5:[2,20],12:[2,20],13:[2,20],16:[2,20],24:[2,20],26:[2,20],28:[2,20],29:[2,20],31:[2,20],32:[2,20],34:[2,20]},{46:[1,81]},{18:[2,53],25:[2,53],33:[2,53],46:[2,53],50:[2,53]},{30:51,36:82,41:55,42:[1,52],43:[1,53],44:[1,54],45:[1,56],50:[1,26],52:[1,25],53:24},{25:[1,83]},{5:[2,19],12:[2,19],13:[2,19],16:[2,19],24:[2,19],26:[2,19],28:[2,19],29:[2,19],31:[2,19],32:[2,19],34:[2,19]},{18:[2,28],25:[2,28],33:[2,28],42:[2,28],43:[2,28],44:[2,28],45:[2,28],46:[2,28],50:[2,28],52:[2,28]},{18:[2,30],25:[2,30],33:[2,30],46:[2,30],50:[2,30]},{5:[2,16],12:[2,16],13:[2,16],16:[2,16],24:[2,16],26:[2,16],28:[2,16],29:[2,16],31:[2,16],32:[2,16],34:[2,16]}],
  defaultActions: {4:[2,1],44:[2,41],47:[2,43],57:[2,47],63:[2,10],70:[2,15],73:[2,45]},
  parseError: function parseError(str, hash) {
      throw new Error(str);
  },
  parse: function parse(input) {
      var self = this, stack = [0], vstack = [null], lstack = [], table = this.table, yytext = "", yylineno = 0, yyleng = 0, recovering = 0, TERROR = 2, EOF = 1;
      this.lexer.setInput(input);
      this.lexer.yy = this.yy;
      this.yy.lexer = this.lexer;
      this.yy.parser = this;
      if (typeof this.lexer.yylloc == "undefined")
          this.lexer.yylloc = {};
      var yyloc = this.lexer.yylloc;
      lstack.push(yyloc);
      var ranges = this.lexer.options && this.lexer.options.ranges;
      if (typeof this.yy.parseError === "function")
          this.parseError = this.yy.parseError;
      function popStack(n) {
          stack.length = stack.length - 2 * n;
          vstack.length = vstack.length - n;
          lstack.length = lstack.length - n;
      }
      function lex() {
          var token;
          token = self.lexer.lex() || 1;
          if (typeof token !== "number") {
              token = self.symbols_[token] || token;
          }
          return token;
      }
      var symbol, preErrorSymbol, state, action, a, r, yyval = {}, p, len, newState, expected;
      while (true) {
          state = stack[stack.length - 1];
          if (this.defaultActions[state]) {
              action = this.defaultActions[state];
          } else {
              if (symbol === null || typeof symbol == "undefined") {
                  symbol = lex();
              }
              action = table[state] && table[state][symbol];
          }
          if (typeof action === "undefined" || !action.length || !action[0]) {
              var errStr = "";
              if (!recovering) {
                  expected = [];
                  for (p in table[state])
                      if (this.terminals_[p] && p > 2) {
                          expected.push("'" + this.terminals_[p] + "'");
                      }
                  if (this.lexer.showPosition) {
                      errStr = "Parse error on line " + (yylineno + 1) + ":\n" + this.lexer.showPosition() + "\nExpecting " + expected.join(", ") + ", got '" + (this.terminals_[symbol] || symbol) + "'";
                  } else {
                      errStr = "Parse error on line " + (yylineno + 1) + ": Unexpected " + (symbol == 1?"end of input":"'" + (this.terminals_[symbol] || symbol) + "'");
                  }
                  this.parseError(errStr, {text: this.lexer.match, token: this.terminals_[symbol] || symbol, line: this.lexer.yylineno, loc: yyloc, expected: expected});
              }
          }
          if (action[0] instanceof Array && action.length > 1) {
              throw new Error("Parse Error: multiple actions possible at state: " + state + ", token: " + symbol);
          }
          switch (action[0]) {
          case 1:
              stack.push(symbol);
              vstack.push(this.lexer.yytext);
              lstack.push(this.lexer.yylloc);
              stack.push(action[1]);
              symbol = null;
              if (!preErrorSymbol) {
                  yyleng = this.lexer.yyleng;
                  yytext = this.lexer.yytext;
                  yylineno = this.lexer.yylineno;
                  yyloc = this.lexer.yylloc;
                  if (recovering > 0)
                      recovering--;
              } else {
                  symbol = preErrorSymbol;
                  preErrorSymbol = null;
              }
              break;
          case 2:
              len = this.productions_[action[1]][1];
              yyval.$ = vstack[vstack.length - len];
              yyval._$ = {first_line: lstack[lstack.length - (len || 1)].first_line, last_line: lstack[lstack.length - 1].last_line, first_column: lstack[lstack.length - (len || 1)].first_column, last_column: lstack[lstack.length - 1].last_column};
              if (ranges) {
                  yyval._$.range = [lstack[lstack.length - (len || 1)].range[0], lstack[lstack.length - 1].range[1]];
              }
              r = this.performAction.call(yyval, yytext, yyleng, yylineno, this.yy, action[1], vstack, lstack);
              if (typeof r !== "undefined") {
                  return r;
              }
              if (len) {
                  stack = stack.slice(0, -1 * len * 2);
                  vstack = vstack.slice(0, -1 * len);
                  lstack = lstack.slice(0, -1 * len);
              }
              stack.push(this.productions_[action[1]][0]);
              vstack.push(yyval.$);
              lstack.push(yyval._$);
              newState = table[stack[stack.length - 2]][stack[stack.length - 1]];
              stack.push(newState);
              break;
          case 3:
              return true;
          }
      }
      return true;
  }
  };
  /* Jison generated lexer */
  var lexer = (function(){
  var lexer = ({EOF:1,
  parseError:function parseError(str, hash) {
          if (this.yy.parser) {
              this.yy.parser.parseError(str, hash);
          } else {
              throw new Error(str);
          }
      },
  setInput:function (input) {
          this._input = input;
          this._more = this._less = this.done = false;
          this.yylineno = this.yyleng = 0;
          this.yytext = this.matched = this.match = '';
          this.conditionStack = ['INITIAL'];
          this.yylloc = {first_line:1,first_column:0,last_line:1,last_column:0};
          if (this.options.ranges) this.yylloc.range = [0,0];
          this.offset = 0;
          return this;
      },
  input:function () {
          var ch = this._input[0];
          this.yytext += ch;
          this.yyleng++;
          this.offset++;
          this.match += ch;
          this.matched += ch;
          var lines = ch.match(/(?:\r\n?|\n).*/g);
          if (lines) {
              this.yylineno++;
              this.yylloc.last_line++;
          } else {
              this.yylloc.last_column++;
          }
          if (this.options.ranges) this.yylloc.range[1]++;

          this._input = this._input.slice(1);
          return ch;
      },
  unput:function (ch) {
          var len = ch.length;
          var lines = ch.split(/(?:\r\n?|\n)/g);

          this._input = ch + this._input;
          this.yytext = this.yytext.substr(0, this.yytext.length-len-1);
          //this.yyleng -= len;
          this.offset -= len;
          var oldLines = this.match.split(/(?:\r\n?|\n)/g);
          this.match = this.match.substr(0, this.match.length-1);
          this.matched = this.matched.substr(0, this.matched.length-1);

          if (lines.length-1) this.yylineno -= lines.length-1;
          var r = this.yylloc.range;

          this.yylloc = {first_line: this.yylloc.first_line,
            last_line: this.yylineno+1,
            first_column: this.yylloc.first_column,
            last_column: lines ?
                (lines.length === oldLines.length ? this.yylloc.first_column : 0) + oldLines[oldLines.length - lines.length].length - lines[0].length:
                this.yylloc.first_column - len
            };

          if (this.options.ranges) {
              this.yylloc.range = [r[0], r[0] + this.yyleng - len];
          }
          return this;
      },
  more:function () {
          this._more = true;
          return this;
      },
  less:function (n) {
          this.unput(this.match.slice(n));
      },
  pastInput:function () {
          var past = this.matched.substr(0, this.matched.length - this.match.length);
          return (past.length > 20 ? '...':'') + past.substr(-20).replace(/\n/g, "");
      },
  upcomingInput:function () {
          var next = this.match;
          if (next.length < 20) {
              next += this._input.substr(0, 20-next.length);
          }
          return (next.substr(0,20)+(next.length > 20 ? '...':'')).replace(/\n/g, "");
      },
  showPosition:function () {
          var pre = this.pastInput();
          var c = new Array(pre.length + 1).join("-");
          return pre + this.upcomingInput() + "\n" + c+"^";
      },
  next:function () {
          if (this.done) {
              return this.EOF;
          }
          if (!this._input) this.done = true;

          var token,
              match,
              tempMatch,
              index,
              col,
              lines;
          if (!this._more) {
              this.yytext = '';
              this.match = '';
          }
          var rules = this._currentRules();
          for (var i=0;i < rules.length; i++) {
              tempMatch = this._input.match(this.rules[rules[i]]);
              if (tempMatch && (!match || tempMatch[0].length > match[0].length)) {
                  match = tempMatch;
                  index = i;
                  if (!this.options.flex) break;
              }
          }
          if (match) {
              lines = match[0].match(/(?:\r\n?|\n).*/g);
              if (lines) this.yylineno += lines.length;
              this.yylloc = {first_line: this.yylloc.last_line,
                             last_line: this.yylineno+1,
                             first_column: this.yylloc.last_column,
                             last_column: lines ? lines[lines.length-1].length-lines[lines.length-1].match(/\r?\n?/)[0].length : this.yylloc.last_column + match[0].length};
              this.yytext += match[0];
              this.match += match[0];
              this.matches = match;
              this.yyleng = this.yytext.length;
              if (this.options.ranges) {
                  this.yylloc.range = [this.offset, this.offset += this.yyleng];
              }
              this._more = false;
              this._input = this._input.slice(match[0].length);
              this.matched += match[0];
              token = this.performAction.call(this, this.yy, this, rules[index],this.conditionStack[this.conditionStack.length-1]);
              if (this.done && this._input) this.done = false;
              if (token) return token;
              else return;
          }
          if (this._input === "") {
              return this.EOF;
          } else {
              return this.parseError('Lexical error on line '+(this.yylineno+1)+'. Unrecognized text.\n'+this.showPosition(),
                      {text: "", token: null, line: this.yylineno});
          }
      },
  lex:function lex() {
          var r = this.next();
          if (typeof r !== 'undefined') {
              return r;
          } else {
              return this.lex();
          }
      },
  begin:function begin(condition) {
          this.conditionStack.push(condition);
      },
  popState:function popState() {
          return this.conditionStack.pop();
      },
  _currentRules:function _currentRules() {
          return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules;
      },
  topState:function () {
          return this.conditionStack[this.conditionStack.length-2];
      },
  pushState:function begin(condition) {
          this.begin(condition);
      }});
  lexer.options = {};
  lexer.performAction = function anonymous(yy,yy_,$avoiding_name_collisions,YY_START) {
  function strip(start, end) {
    return yy_.yytext = yy_.yytext.substr(start, yy_.yyleng-end);
  }

  var YYSTATE=YY_START
  switch($avoiding_name_collisions) {
  case 0:
                                     if(yy_.yytext.slice(-2) === "\\\\") {
                                       strip(0,1);
                                       this.begin("mu");
                                     } else if(yy_.yytext.slice(-1) === "\\") {
                                       strip(0,1);
                                       this.begin("emu");
                                     } else {
                                       this.begin("mu");
                                     }
                                     if(yy_.yytext) return 12;

  break;
  case 1:return 12;
  break;
  case 2:
                                     this.popState();
                                     return 12;

  break;
  case 3:
                                    yy_.yytext = yy_.yytext.substr(5, yy_.yyleng-9);
                                    this.popState();
                                    return 15;

  break;
  case 4: return 12;
  break;
  case 5:strip(0,4); this.popState(); return 13;
  break;
  case 6:return 45;
  break;
  case 7:return 46;
  break;
  case 8: return 16;
  break;
  case 9:
                                    this.popState();
                                    this.begin('raw');
                                    return 18;

  break;
  case 10:return 34;
  break;
  case 11:return 24;
  break;
  case 12:return 29;
  break;
  case 13:this.popState(); return 28;
  break;
  case 14:this.popState(); return 28;
  break;
  case 15:return 26;
  break;
  case 16:return 26;
  break;
  case 17:return 32;
  break;
  case 18:return 31;
  break;
  case 19:this.popState(); this.begin('com');
  break;
  case 20:strip(3,5); this.popState(); return 13;
  break;
  case 21:return 31;
  break;
  case 22:return 51;
  break;
  case 23:return 50;
  break;
  case 24:return 50;
  break;
  case 25:return 54;
  break;
  case 26:// ignore whitespace
  break;
  case 27:this.popState(); return 33;
  break;
  case 28:this.popState(); return 25;
  break;
  case 29:yy_.yytext = strip(1,2).replace(/\\"/g,'"'); return 42;
  break;
  case 30:yy_.yytext = strip(1,2).replace(/\\'/g,"'"); return 42;
  break;
  case 31:return 52;
  break;
  case 32:return 44;
  break;
  case 33:return 44;
  break;
  case 34:return 43;
  break;
  case 35:return 50;
  break;
  case 36:yy_.yytext = strip(1,2); return 50;
  break;
  case 37:return 'INVALID';
  break;
  case 38:return 5;
  break;
  }
  };
  lexer.rules = [/^(?:[^\x00]*?(?=(\{\{)))/,/^(?:[^\x00]+)/,/^(?:[^\x00]{2,}?(?=(\{\{|\\\{\{|\\\\\{\{|$)))/,/^(?:\{\{\{\{\/[^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=[=}\s\/.])\}\}\}\})/,/^(?:[^\x00]*?(?=(\{\{\{\{\/)))/,/^(?:[\s\S]*?--\}\})/,/^(?:\()/,/^(?:\))/,/^(?:\{\{\{\{)/,/^(?:\}\}\}\})/,/^(?:\{\{(~)?>)/,/^(?:\{\{(~)?#)/,/^(?:\{\{(~)?\/)/,/^(?:\{\{(~)?\^\s*(~)?\}\})/,/^(?:\{\{(~)?\s*else\s*(~)?\}\})/,/^(?:\{\{(~)?\^)/,/^(?:\{\{(~)?\s*else\b)/,/^(?:\{\{(~)?\{)/,/^(?:\{\{(~)?&)/,/^(?:\{\{!--)/,/^(?:\{\{![\s\S]*?\}\})/,/^(?:\{\{(~)?)/,/^(?:=)/,/^(?:\.\.)/,/^(?:\.(?=([=~}\s\/.)])))/,/^(?:[\/.])/,/^(?:\s+)/,/^(?:\}(~)?\}\})/,/^(?:(~)?\}\})/,/^(?:"(\\["]|[^"])*")/,/^(?:'(\\[']|[^'])*')/,/^(?:@)/,/^(?:true(?=([~}\s)])))/,/^(?:false(?=([~}\s)])))/,/^(?:-?[0-9]+(?:\.[0-9]+)?(?=([~}\s)])))/,/^(?:([^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=([=~}\s\/.)]))))/,/^(?:\[[^\]]*\])/,/^(?:.)/,/^(?:$)/];
  lexer.conditions = {"mu":{"rules":[6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38],"inclusive":false},"emu":{"rules":[2],"inclusive":false},"com":{"rules":[5],"inclusive":false},"raw":{"rules":[3,4],"inclusive":false},"INITIAL":{"rules":[0,1,38],"inclusive":true}};
  return lexer;})()
  parser.lexer = lexer;
  function Parser () { this.yy = {}; }Parser.prototype = parser;parser.Parser = Parser;
  return new Parser;
  })();__exports__ = handlebars;
  /* jshint ignore:end */
  return __exports__;
})();

// handlebars/compiler/helpers.js
var __module10__ = (function(__dependency1__) {
  "use strict";
  var __exports__ = {};
  var Exception = __dependency1__;

  function stripFlags(open, close) {
    return {
      left: open.charAt(2) === '~',
      right: close.charAt(close.length-3) === '~'
    };
  }

  __exports__.stripFlags = stripFlags;
  function prepareBlock(mustache, program, inverseAndProgram, close, inverted, locInfo) {
    /*jshint -W040 */
    if (mustache.sexpr.id.original !== close.path.original) {
      throw new Exception(mustache.sexpr.id.original + ' doesn\'t match ' + close.path.original, mustache);
    }

    var inverse = inverseAndProgram && inverseAndProgram.program;

    var strip = {
      left: mustache.strip.left,
      right: close.strip.right,

      // Determine the standalone candiacy. Basically flag our content as being possibly standalone
      // so our parent can determine if we actually are standalone
      openStandalone: isNextWhitespace(program.statements),
      closeStandalone: isPrevWhitespace((inverse || program).statements)
    };

    if (mustache.strip.right) {
      omitRight(program.statements, null, true);
    }

    if (inverse) {
      var inverseStrip = inverseAndProgram.strip;

      if (inverseStrip.left) {
        omitLeft(program.statements, null, true);
      }
      if (inverseStrip.right) {
        omitRight(inverse.statements, null, true);
      }
      if (close.strip.left) {
        omitLeft(inverse.statements, null, true);
      }

      // Find standalone else statments
      if (isPrevWhitespace(program.statements)
          && isNextWhitespace(inverse.statements)) {
        omitLeft(program.statements);
        omitRight(inverse.statements);
      }
    } else {
      if (close.strip.left) {
        omitLeft(program.statements, null, true);
      }
    }

    if (inverted) {
      return new this.BlockNode(mustache, inverse, program, strip, locInfo);
    } else {
      return new this.BlockNode(mustache, program, inverse, strip, locInfo);
    }
  }

  __exports__.prepareBlock = prepareBlock;
  function prepareProgram(statements, isRoot) {
    for (var i = 0, l = statements.length; i < l; i++) {
      var current = statements[i],
          strip = current.strip;

      if (!strip) {
        continue;
      }

      var _isPrevWhitespace = isPrevWhitespace(statements, i, isRoot, current.type === 'partial'),
          _isNextWhitespace = isNextWhitespace(statements, i, isRoot),

          openStandalone = strip.openStandalone && _isPrevWhitespace,
          closeStandalone = strip.closeStandalone && _isNextWhitespace,
          inlineStandalone = strip.inlineStandalone && _isPrevWhitespace && _isNextWhitespace;

      if (strip.right) {
        omitRight(statements, i, true);
      }
      if (strip.left) {
        omitLeft(statements, i, true);
      }

      if (inlineStandalone) {
        omitRight(statements, i);

        if (omitLeft(statements, i)) {
          // If we are on a standalone node, save the indent info for partials
          if (current.type === 'partial') {
            current.indent = (/([ \t]+$)/).exec(statements[i-1].original) ? RegExp.$1 : '';
          }
        }
      }
      if (openStandalone) {
        omitRight((current.program || current.inverse).statements);

        // Strip out the previous content node if it's whitespace only
        omitLeft(statements, i);
      }
      if (closeStandalone) {
        // Always strip the next node
        omitRight(statements, i);

        omitLeft((current.inverse || current.program).statements);
      }
    }

    return statements;
  }

  __exports__.prepareProgram = prepareProgram;function isPrevWhitespace(statements, i, isRoot) {
    if (i === undefined) {
      i = statements.length;
    }

    // Nodes that end with newlines are considered whitespace (but are special
    // cased for strip operations)
    var prev = statements[i-1],
        sibling = statements[i-2];
    if (!prev) {
      return isRoot;
    }

    if (prev.type === 'content') {
      return (sibling || !isRoot ? (/\r?\n\s*?$/) : (/(^|\r?\n)\s*?$/)).test(prev.original);
    }
  }
  function isNextWhitespace(statements, i, isRoot) {
    if (i === undefined) {
      i = -1;
    }

    var next = statements[i+1],
        sibling = statements[i+2];
    if (!next) {
      return isRoot;
    }

    if (next.type === 'content') {
      return (sibling || !isRoot ? (/^\s*?\r?\n/) : (/^\s*?(\r?\n|$)/)).test(next.original);
    }
  }

  // Marks the node to the right of the position as omitted.
  // I.e. {{foo}}' ' will mark the ' ' node as omitted.
  //
  // If i is undefined, then the first child will be marked as such.
  //
  // If mulitple is truthy then all whitespace will be stripped out until non-whitespace
  // content is met.
  function omitRight(statements, i, multiple) {
    var current = statements[i == null ? 0 : i + 1];
    if (!current || current.type !== 'content' || (!multiple && current.rightStripped)) {
      return;
    }

    var original = current.string;
    current.string = current.string.replace(multiple ? (/^\s+/) : (/^[ \t]*\r?\n?/), '');
    current.rightStripped = current.string !== original;
  }

  // Marks the node to the left of the position as omitted.
  // I.e. ' '{{foo}} will mark the ' ' node as omitted.
  //
  // If i is undefined then the last child will be marked as such.
  //
  // If mulitple is truthy then all whitespace will be stripped out until non-whitespace
  // content is met.
  function omitLeft(statements, i, multiple) {
    var current = statements[i == null ? statements.length - 1 : i - 1];
    if (!current || current.type !== 'content' || (!multiple && current.leftStripped)) {
      return;
    }

    // We omit the last node if it's whitespace only and not preceeded by a non-content node.
    var original = current.string;
    current.string = current.string.replace(multiple ? (/\s+$/) : (/[ \t]+$/), '');
    current.leftStripped = current.string !== original;
    return current.leftStripped;
  }
  return __exports__;
})(__module5__);

// handlebars/compiler/base.js
var __module8__ = (function(__dependency1__, __dependency2__, __dependency3__, __dependency4__) {
  "use strict";
  var __exports__ = {};
  var parser = __dependency1__;
  var AST = __dependency2__;
  var Helpers = __dependency3__;
  var extend = __dependency4__.extend;

  __exports__.parser = parser;

  var yy = {};
  extend(yy, Helpers, AST);

  function parse(input) {
    // Just return if an already-compile AST was passed in.
    if (input.constructor === AST.ProgramNode) { return input; }

    parser.yy = yy;

    return parser.parse(input);
  }

  __exports__.parse = parse;
  return __exports__;
})(__module9__, __module7__, __module10__, __module3__);

// handlebars/compiler/compiler.js
var __module11__ = (function(__dependency1__, __dependency2__) {
  "use strict";
  var __exports__ = {};
  var Exception = __dependency1__;
  var isArray = __dependency2__.isArray;

  var slice = [].slice;

  function Compiler() {}

  __exports__.Compiler = Compiler;// the foundHelper register will disambiguate helper lookup from finding a
  // function in a context. This is necessary for mustache compatibility, which
  // requires that context functions in blocks are evaluated by blockHelperMissing,
  // and then proceed as if the resulting value was provided to blockHelperMissing.

  Compiler.prototype = {
    compiler: Compiler,

    equals: function(other) {
      var len = this.opcodes.length;
      if (other.opcodes.length !== len) {
        return false;
      }

      for (var i = 0; i < len; i++) {
        var opcode = this.opcodes[i],
            otherOpcode = other.opcodes[i];
        if (opcode.opcode !== otherOpcode.opcode || !argEquals(opcode.args, otherOpcode.args)) {
          return false;
        }
      }

      // We know that length is the same between the two arrays because they are directly tied
      // to the opcode behavior above.
      len = this.children.length;
      for (i = 0; i < len; i++) {
        if (!this.children[i].equals(other.children[i])) {
          return false;
        }
      }

      return true;
    },

    guid: 0,

    compile: function(program, options) {
      this.opcodes = [];
      this.children = [];
      this.depths = {list: []};
      this.options = options;
      this.stringParams = options.stringParams;
      this.trackIds = options.trackIds;

      // These changes will propagate to the other compiler components
      var knownHelpers = this.options.knownHelpers;
      this.options.knownHelpers = {
        'helperMissing': true,
        'blockHelperMissing': true,
        'each': true,
        'if': true,
        'unless': true,
        'with': true,
        'log': true,
        'lookup': true
      };
      if (knownHelpers) {
        for (var name in knownHelpers) {
          this.options.knownHelpers[name] = knownHelpers[name];
        }
      }

      return this.accept(program);
    },

    accept: function(node) {
      return this[node.type](node);
    },

    program: function(program) {
      var statements = program.statements;

      for(var i=0, l=statements.length; i<l; i++) {
        this.accept(statements[i]);
      }
      this.isSimple = l === 1;

      this.depths.list = this.depths.list.sort(function(a, b) {
        return a - b;
      });

      return this;
    },

    compileProgram: function(program) {
      var result = new this.compiler().compile(program, this.options);
      var guid = this.guid++, depth;

      this.usePartial = this.usePartial || result.usePartial;

      this.children[guid] = result;

      for(var i=0, l=result.depths.list.length; i<l; i++) {
        depth = result.depths.list[i];

        if(depth < 2) { continue; }
        else { this.addDepth(depth - 1); }
      }

      return guid;
    },

    block: function(block) {
      var mustache = block.mustache,
          program = block.program,
          inverse = block.inverse;

      if (program) {
        program = this.compileProgram(program);
      }

      if (inverse) {
        inverse = this.compileProgram(inverse);
      }

      var sexpr = mustache.sexpr;
      var type = this.classifySexpr(sexpr);

      if (type === "helper") {
        this.helperSexpr(sexpr, program, inverse);
      } else if (type === "simple") {
        this.simpleSexpr(sexpr);

        // now that the simple mustache is resolved, we need to
        // evaluate it by executing `blockHelperMissing`
        this.opcode('pushProgram', program);
        this.opcode('pushProgram', inverse);
        this.opcode('emptyHash');
        this.opcode('blockValue', sexpr.id.original);
      } else {
        this.ambiguousSexpr(sexpr, program, inverse);

        // now that the simple mustache is resolved, we need to
        // evaluate it by executing `blockHelperMissing`
        this.opcode('pushProgram', program);
        this.opcode('pushProgram', inverse);
        this.opcode('emptyHash');
        this.opcode('ambiguousBlockValue');
      }

      this.opcode('append');
    },

    hash: function(hash) {
      var pairs = hash.pairs, i, l;

      this.opcode('pushHash');

      for(i=0, l=pairs.length; i<l; i++) {
        this.pushParam(pairs[i][1]);
      }
      while(i--) {
        this.opcode('assignToHash', pairs[i][0]);
      }
      this.opcode('popHash');
    },

    partial: function(partial) {
      var partialName = partial.partialName;
      this.usePartial = true;

      if (partial.hash) {
        this.accept(partial.hash);
      } else {
        this.opcode('push', 'undefined');
      }

      if (partial.context) {
        this.accept(partial.context);
      } else {
        this.opcode('getContext', 0);
        this.opcode('pushContext');
      }

      this.opcode('invokePartial', partialName.name, partial.indent || '');
      this.opcode('append');
    },

    content: function(content) {
      if (content.string) {
        this.opcode('appendContent', content.string);
      }
    },

    mustache: function(mustache) {
      this.sexpr(mustache.sexpr);

      if(mustache.escaped && !this.options.noEscape) {
        this.opcode('appendEscaped');
      } else {
        this.opcode('append');
      }
    },

    ambiguousSexpr: function(sexpr, program, inverse) {
      var id = sexpr.id,
          name = id.parts[0],
          isBlock = program != null || inverse != null;

      this.opcode('getContext', id.depth);

      this.opcode('pushProgram', program);
      this.opcode('pushProgram', inverse);

      this.ID(id);

      this.opcode('invokeAmbiguous', name, isBlock);
    },

    simpleSexpr: function(sexpr) {
      var id = sexpr.id;

      if (id.type === 'DATA') {
        this.DATA(id);
      } else if (id.parts.length) {
        this.ID(id);
      } else {
        // Simplified ID for `this`
        this.addDepth(id.depth);
        this.opcode('getContext', id.depth);
        this.opcode('pushContext');
      }

      this.opcode('resolvePossibleLambda');
    },

    helperSexpr: function(sexpr, program, inverse) {
      var params = this.setupFullMustacheParams(sexpr, program, inverse),
          id = sexpr.id,
          name = id.parts[0];

      if (this.options.knownHelpers[name]) {
        this.opcode('invokeKnownHelper', params.length, name);
      } else if (this.options.knownHelpersOnly) {
        throw new Exception("You specified knownHelpersOnly, but used the unknown helper " + name, sexpr);
      } else {
        id.falsy = true;

        this.ID(id);
        this.opcode('invokeHelper', params.length, id.original, id.isSimple);
      }
    },

    sexpr: function(sexpr) {
      var type = this.classifySexpr(sexpr);

      if (type === "simple") {
        this.simpleSexpr(sexpr);
      } else if (type === "helper") {
        this.helperSexpr(sexpr);
      } else {
        this.ambiguousSexpr(sexpr);
      }
    },

    ID: function(id) {
      this.addDepth(id.depth);
      this.opcode('getContext', id.depth);

      var name = id.parts[0];
      if (!name) {
        // Context reference, i.e. `{{foo .}}` or `{{foo ..}}`
        this.opcode('pushContext');
      } else {
        this.opcode('lookupOnContext', id.parts, id.falsy, id.isScoped);
      }
    },

    DATA: function(data) {
      this.options.data = true;
      this.opcode('lookupData', data.id.depth, data.id.parts);
    },

    STRING: function(string) {
      this.opcode('pushString', string.string);
    },

    NUMBER: function(number) {
      this.opcode('pushLiteral', number.number);
    },

    BOOLEAN: function(bool) {
      this.opcode('pushLiteral', bool.bool);
    },

    comment: function() {},

    // HELPERS
    opcode: function(name) {
      this.opcodes.push({ opcode: name, args: slice.call(arguments, 1) });
    },

    addDepth: function(depth) {
      if(depth === 0) { return; }

      if(!this.depths[depth]) {
        this.depths[depth] = true;
        this.depths.list.push(depth);
      }
    },

    classifySexpr: function(sexpr) {
      var isHelper   = sexpr.isHelper;
      var isEligible = sexpr.eligibleHelper;
      var options    = this.options;

      // if ambiguous, we can possibly resolve the ambiguity now
      // An eligible helper is one that does not have a complex path, i.e. `this.foo`, `../foo` etc.
      if (isEligible && !isHelper) {
        var name = sexpr.id.parts[0];

        if (options.knownHelpers[name]) {
          isHelper = true;
        } else if (options.knownHelpersOnly) {
          isEligible = false;
        }
      }

      if (isHelper) { return "helper"; }
      else if (isEligible) { return "ambiguous"; }
      else { return "simple"; }
    },

    pushParams: function(params) {
      for(var i=0, l=params.length; i<l; i++) {
        this.pushParam(params[i]);
      }
    },

    pushParam: function(val) {
      if (this.stringParams) {
        if(val.depth) {
          this.addDepth(val.depth);
        }
        this.opcode('getContext', val.depth || 0);
        this.opcode('pushStringParam', val.stringModeValue, val.type);

        if (val.type === 'sexpr') {
          // Subexpressions get evaluated and passed in
          // in string params mode.
          this.sexpr(val);
        }
      } else {
        if (this.trackIds) {
          this.opcode('pushId', val.type, val.idName || val.stringModeValue);
        }
        this.accept(val);
      }
    },

    setupFullMustacheParams: function(sexpr, program, inverse) {
      var params = sexpr.params;
      this.pushParams(params);

      this.opcode('pushProgram', program);
      this.opcode('pushProgram', inverse);

      if (sexpr.hash) {
        this.hash(sexpr.hash);
      } else {
        this.opcode('emptyHash');
      }

      return params;
    }
  };

  function precompile(input, options, env) {
    if (input == null || (typeof input !== 'string' && input.constructor !== env.AST.ProgramNode)) {
      throw new Exception("You must pass a string or Handlebars AST to Handlebars.precompile. You passed " + input);
    }

    options = options || {};
    if (!('data' in options)) {
      options.data = true;
    }
    if (options.compat) {
      options.useDepths = true;
    }

    var ast = env.parse(input);
    var environment = new env.Compiler().compile(ast, options);
    return new env.JavaScriptCompiler().compile(environment, options);
  }

  __exports__.precompile = precompile;function compile(input, options, env) {
    if (input == null || (typeof input !== 'string' && input.constructor !== env.AST.ProgramNode)) {
      throw new Exception("You must pass a string or Handlebars AST to Handlebars.compile. You passed " + input);
    }

    options = options || {};

    if (!('data' in options)) {
      options.data = true;
    }
    if (options.compat) {
      options.useDepths = true;
    }

    var compiled;

    function compileInput() {
      var ast = env.parse(input);
      var environment = new env.Compiler().compile(ast, options);
      var templateSpec = new env.JavaScriptCompiler().compile(environment, options, undefined, true);
      return env.template(templateSpec);
    }

    // Template is only compiled on first use and cached after that point.
    var ret = function(context, options) {
      if (!compiled) {
        compiled = compileInput();
      }
      return compiled.call(this, context, options);
    };
    ret._setup = function(options) {
      if (!compiled) {
        compiled = compileInput();
      }
      return compiled._setup(options);
    };
    ret._child = function(i, data, depths) {
      if (!compiled) {
        compiled = compileInput();
      }
      return compiled._child(i, data, depths);
    };
    return ret;
  }

  __exports__.compile = compile;function argEquals(a, b) {
    if (a === b) {
      return true;
    }

    if (isArray(a) && isArray(b) && a.length === b.length) {
      for (var i = 0; i < a.length; i++) {
        if (!argEquals(a[i], b[i])) {
          return false;
        }
      }
      return true;
    }
  }
  return __exports__;
})(__module5__, __module3__);

// handlebars/compiler/javascript-compiler.js
var __module12__ = (function(__dependency1__, __dependency2__) {
  "use strict";
  var __exports__;
  var COMPILER_REVISION = __dependency1__.COMPILER_REVISION;
  var REVISION_CHANGES = __dependency1__.REVISION_CHANGES;
  var Exception = __dependency2__;

  function Literal(value) {
    this.value = value;
  }

  function JavaScriptCompiler() {}

  JavaScriptCompiler.prototype = {
    // PUBLIC API: You can override these methods in a subclass to provide
    // alternative compiled forms for name lookup and buffering semantics
    nameLookup: function(parent, name /* , type*/) {
      if (JavaScriptCompiler.isValidJavaScriptVariableName(name)) {
        return parent + "." + name;
      } else {
        return parent + "['" + name + "']";
      }
    },
    depthedLookup: function(name) {
      this.aliases.lookup = 'this.lookup';

      return 'lookup(depths, "' + name + '")';
    },

    compilerInfo: function() {
      var revision = COMPILER_REVISION,
          versions = REVISION_CHANGES[revision];
      return [revision, versions];
    },

    appendToBuffer: function(string) {
      if (this.environment.isSimple) {
        return "return " + string + ";";
      } else {
        return {
          appendToBuffer: true,
          content: string,
          toString: function() { return "buffer += " + string + ";"; }
        };
      }
    },

    initializeBuffer: function() {
      return this.quotedString("");
    },

    namespace: "Handlebars",
    // END PUBLIC API

    compile: function(environment, options, context, asObject) {
      this.environment = environment;
      this.options = options;
      this.stringParams = this.options.stringParams;
      this.trackIds = this.options.trackIds;
      this.precompile = !asObject;

      this.name = this.environment.name;
      this.isChild = !!context;
      this.context = context || {
        programs: [],
        environments: []
      };

      this.preamble();

      this.stackSlot = 0;
      this.stackVars = [];
      this.aliases = {};
      this.registers = { list: [] };
      this.hashes = [];
      this.compileStack = [];
      this.inlineStack = [];

      this.compileChildren(environment, options);

      this.useDepths = this.useDepths || environment.depths.list.length || this.options.compat;

      var opcodes = environment.opcodes,
          opcode,
          i,
          l;

      for (i = 0, l = opcodes.length; i < l; i++) {
        opcode = opcodes[i];

        this[opcode.opcode].apply(this, opcode.args);
      }

      // Flush any trailing content that might be pending.
      this.pushSource('');

      /* istanbul ignore next */
      if (this.stackSlot || this.inlineStack.length || this.compileStack.length) {
        throw new Exception('Compile completed with content left on stack');
      }

      var fn = this.createFunctionContext(asObject);
      if (!this.isChild) {
        var ret = {
          compiler: this.compilerInfo(),
          main: fn
        };
        var programs = this.context.programs;
        for (i = 0, l = programs.length; i < l; i++) {
          if (programs[i]) {
            ret[i] = programs[i];
          }
        }

        if (this.environment.usePartial) {
          ret.usePartial = true;
        }
        if (this.options.data) {
          ret.useData = true;
        }
        if (this.useDepths) {
          ret.useDepths = true;
        }
        if (this.options.compat) {
          ret.compat = true;
        }

        if (!asObject) {
          ret.compiler = JSON.stringify(ret.compiler);
          ret = this.objectLiteral(ret);
        }

        return ret;
      } else {
        return fn;
      }
    },

    preamble: function() {
      // track the last context pushed into place to allow skipping the
      // getContext opcode when it would be a noop
      this.lastContext = 0;
      this.source = [];
    },

    createFunctionContext: function(asObject) {
      var varDeclarations = '';

      var locals = this.stackVars.concat(this.registers.list);
      if(locals.length > 0) {
        varDeclarations += ", " + locals.join(", ");
      }

      // Generate minimizer alias mappings
      for (var alias in this.aliases) {
        if (this.aliases.hasOwnProperty(alias)) {
          varDeclarations += ', ' + alias + '=' + this.aliases[alias];
        }
      }

      var params = ["depth0", "helpers", "partials", "data"];

      if (this.useDepths) {
        params.push('depths');
      }

      // Perform a second pass over the output to merge content when possible
      var source = this.mergeSource(varDeclarations);

      if (asObject) {
        params.push(source);

        return Function.apply(this, params);
      } else {
        return 'function(' + params.join(',') + ') {\n  ' + source + '}';
      }
    },
    mergeSource: function(varDeclarations) {
      var source = '',
          buffer,
          appendOnly = !this.forceBuffer,
          appendFirst;

      for (var i = 0, len = this.source.length; i < len; i++) {
        var line = this.source[i];
        if (line.appendToBuffer) {
          if (buffer) {
            buffer = buffer + '\n    + ' + line.content;
          } else {
            buffer = line.content;
          }
        } else {
          if (buffer) {
            if (!source) {
              appendFirst = true;
              source = buffer + ';\n  ';
            } else {
              source += 'buffer += ' + buffer + ';\n  ';
            }
            buffer = undefined;
          }
          source += line + '\n  ';

          if (!this.environment.isSimple) {
            appendOnly = false;
          }
        }
      }

      if (appendOnly) {
        if (buffer || !source) {
          source += 'return ' + (buffer || '""') + ';\n';
        }
      } else {
        varDeclarations += ", buffer = " + (appendFirst ? '' : this.initializeBuffer());
        if (buffer) {
          source += 'return buffer + ' + buffer + ';\n';
        } else {
          source += 'return buffer;\n';
        }
      }

      if (varDeclarations) {
        source = 'var ' + varDeclarations.substring(2) + (appendFirst ? '' : ';\n  ') + source;
      }

      return source;
    },

    // [blockValue]
    //
    // On stack, before: hash, inverse, program, value
    // On stack, after: return value of blockHelperMissing
    //
    // The purpose of this opcode is to take a block of the form
    // `{{#this.foo}}...{{/this.foo}}`, resolve the value of `foo`, and
    // replace it on the stack with the result of properly
    // invoking blockHelperMissing.
    blockValue: function(name) {
      this.aliases.blockHelperMissing = 'helpers.blockHelperMissing';

      var params = [this.contextName(0)];
      this.setupParams(name, 0, params);

      var blockName = this.popStack();
      params.splice(1, 0, blockName);

      this.push('blockHelperMissing.call(' + params.join(', ') + ')');
    },

    // [ambiguousBlockValue]
    //
    // On stack, before: hash, inverse, program, value
    // Compiler value, before: lastHelper=value of last found helper, if any
    // On stack, after, if no lastHelper: same as [blockValue]
    // On stack, after, if lastHelper: value
    ambiguousBlockValue: function() {
      this.aliases.blockHelperMissing = 'helpers.blockHelperMissing';

      // We're being a bit cheeky and reusing the options value from the prior exec
      var params = [this.contextName(0)];
      this.setupParams('', 0, params, true);

      this.flushInline();

      var current = this.topStack();
      params.splice(1, 0, current);

      this.pushSource("if (!" + this.lastHelper + ") { " + current + " = blockHelperMissing.call(" + params.join(", ") + "); }");
    },

    // [appendContent]
    //
    // On stack, before: ...
    // On stack, after: ...
    //
    // Appends the string value of `content` to the current buffer
    appendContent: function(content) {
      if (this.pendingContent) {
        content = this.pendingContent + content;
      }

      this.pendingContent = content;
    },

    // [append]
    //
    // On stack, before: value, ...
    // On stack, after: ...
    //
    // Coerces `value` to a String and appends it to the current buffer.
    //
    // If `value` is truthy, or 0, it is coerced into a string and appended
    // Otherwise, the empty string is appended
    append: function() {
      // Force anything that is inlined onto the stack so we don't have duplication
      // when we examine local
      this.flushInline();
      var local = this.popStack();
      this.pushSource('if (' + local + ' != null) { ' + this.appendToBuffer(local) + ' }');
      if (this.environment.isSimple) {
        this.pushSource("else { " + this.appendToBuffer("''") + " }");
      }
    },

    // [appendEscaped]
    //
    // On stack, before: value, ...
    // On stack, after: ...
    //
    // Escape `value` and append it to the buffer
    appendEscaped: function() {
      this.aliases.escapeExpression = 'this.escapeExpression';

      this.pushSource(this.appendToBuffer("escapeExpression(" + this.popStack() + ")"));
    },

    // [getContext]
    //
    // On stack, before: ...
    // On stack, after: ...
    // Compiler value, after: lastContext=depth
    //
    // Set the value of the `lastContext` compiler value to the depth
    getContext: function(depth) {
      this.lastContext = depth;
    },

    // [pushContext]
    //
    // On stack, before: ...
    // On stack, after: currentContext, ...
    //
    // Pushes the value of the current context onto the stack.
    pushContext: function() {
      this.pushStackLiteral(this.contextName(this.lastContext));
    },

    // [lookupOnContext]
    //
    // On stack, before: ...
    // On stack, after: currentContext[name], ...
    //
    // Looks up the value of `name` on the current context and pushes
    // it onto the stack.
    lookupOnContext: function(parts, falsy, scoped) {
      /*jshint -W083 */
      var i = 0,
          len = parts.length;

      if (!scoped && this.options.compat && !this.lastContext) {
        // The depthed query is expected to handle the undefined logic for the root level that
        // is implemented below, so we evaluate that directly in compat mode
        this.push(this.depthedLookup(parts[i++]));
      } else {
        this.pushContext();
      }

      for (; i < len; i++) {
        this.replaceStack(function(current) {
          var lookup = this.nameLookup(current, parts[i], 'context');
          // We want to ensure that zero and false are handled properly if the context (falsy flag)
          // needs to have the special handling for these values.
          if (!falsy) {
            return ' != null ? ' + lookup + ' : ' + current;
          } else {
            // Otherwise we can use generic falsy handling
            return ' && ' + lookup;
          }
        });
      }
    },

    // [lookupData]
    //
    // On stack, before: ...
    // On stack, after: data, ...
    //
    // Push the data lookup operator
    lookupData: function(depth, parts) {
      /*jshint -W083 */
      if (!depth) {
        this.pushStackLiteral('data');
      } else {
        this.pushStackLiteral('this.data(data, ' + depth + ')');
      }

      var len = parts.length;
      for (var i = 0; i < len; i++) {
        this.replaceStack(function(current) {
          return ' && ' + this.nameLookup(current, parts[i], 'data');
        });
      }
    },

    // [resolvePossibleLambda]
    //
    // On stack, before: value, ...
    // On stack, after: resolved value, ...
    //
    // If the `value` is a lambda, replace it on the stack by
    // the return value of the lambda
    resolvePossibleLambda: function() {
      this.aliases.lambda = 'this.lambda';

      this.push('lambda(' + this.popStack() + ', ' + this.contextName(0) + ')');
    },

    // [pushStringParam]
    //
    // On stack, before: ...
    // On stack, after: string, currentContext, ...
    //
    // This opcode is designed for use in string mode, which
    // provides the string value of a parameter along with its
    // depth rather than resolving it immediately.
    pushStringParam: function(string, type) {
      this.pushContext();
      this.pushString(type);

      // If it's a subexpression, the string result
      // will be pushed after this opcode.
      if (type !== 'sexpr') {
        if (typeof string === 'string') {
          this.pushString(string);
        } else {
          this.pushStackLiteral(string);
        }
      }
    },

    emptyHash: function() {
      this.pushStackLiteral('{}');

      if (this.trackIds) {
        this.push('{}'); // hashIds
      }
      if (this.stringParams) {
        this.push('{}'); // hashContexts
        this.push('{}'); // hashTypes
      }
    },
    pushHash: function() {
      if (this.hash) {
        this.hashes.push(this.hash);
      }
      this.hash = {values: [], types: [], contexts: [], ids: []};
    },
    popHash: function() {
      var hash = this.hash;
      this.hash = this.hashes.pop();

      if (this.trackIds) {
        this.push('{' + hash.ids.join(',') + '}');
      }
      if (this.stringParams) {
        this.push('{' + hash.contexts.join(',') + '}');
        this.push('{' + hash.types.join(',') + '}');
      }

      this.push('{\n    ' + hash.values.join(',\n    ') + '\n  }');
    },

    // [pushString]
    //
    // On stack, before: ...
    // On stack, after: quotedString(string), ...
    //
    // Push a quoted version of `string` onto the stack
    pushString: function(string) {
      this.pushStackLiteral(this.quotedString(string));
    },

    // [push]
    //
    // On stack, before: ...
    // On stack, after: expr, ...
    //
    // Push an expression onto the stack
    push: function(expr) {
      this.inlineStack.push(expr);
      return expr;
    },

    // [pushLiteral]
    //
    // On stack, before: ...
    // On stack, after: value, ...
    //
    // Pushes a value onto the stack. This operation prevents
    // the compiler from creating a temporary variable to hold
    // it.
    pushLiteral: function(value) {
      this.pushStackLiteral(value);
    },

    // [pushProgram]
    //
    // On stack, before: ...
    // On stack, after: program(guid), ...
    //
    // Push a program expression onto the stack. This takes
    // a compile-time guid and converts it into a runtime-accessible
    // expression.
    pushProgram: function(guid) {
      if (guid != null) {
        this.pushStackLiteral(this.programExpression(guid));
      } else {
        this.pushStackLiteral(null);
      }
    },

    // [invokeHelper]
    //
    // On stack, before: hash, inverse, program, params..., ...
    // On stack, after: result of helper invocation
    //
    // Pops off the helper's parameters, invokes the helper,
    // and pushes the helper's return value onto the stack.
    //
    // If the helper is not found, `helperMissing` is called.
    invokeHelper: function(paramSize, name, isSimple) {
      this.aliases.helperMissing = 'helpers.helperMissing';

      var nonHelper = this.popStack();
      var helper = this.setupHelper(paramSize, name);

      var lookup = (isSimple ? helper.name + ' || ' : '') + nonHelper + ' || helperMissing';
      this.push('((' + lookup + ').call(' + helper.callParams + '))');
    },

    // [invokeKnownHelper]
    //
    // On stack, before: hash, inverse, program, params..., ...
    // On stack, after: result of helper invocation
    //
    // This operation is used when the helper is known to exist,
    // so a `helperMissing` fallback is not required.
    invokeKnownHelper: function(paramSize, name) {
      var helper = this.setupHelper(paramSize, name);
      this.push(helper.name + ".call(" + helper.callParams + ")");
    },

    // [invokeAmbiguous]
    //
    // On stack, before: hash, inverse, program, params..., ...
    // On stack, after: result of disambiguation
    //
    // This operation is used when an expression like `{{foo}}`
    // is provided, but we don't know at compile-time whether it
    // is a helper or a path.
    //
    // This operation emits more code than the other options,
    // and can be avoided by passing the `knownHelpers` and
    // `knownHelpersOnly` flags at compile-time.
    invokeAmbiguous: function(name, helperCall) {
      this.aliases.functionType = '"function"';
      this.aliases.helperMissing = 'helpers.helperMissing';
      this.useRegister('helper');

      var nonHelper = this.popStack();

      this.emptyHash();
      var helper = this.setupHelper(0, name, helperCall);

      var helperName = this.lastHelper = this.nameLookup('helpers', name, 'helper');

      this.push(
        '((helper = (helper = ' + helperName + ' || ' + nonHelper + ') != null ? helper : helperMissing'
          + (helper.paramsInit ? '),(' + helper.paramsInit : '') + '),'
        + '(typeof helper === functionType ? helper.call(' + helper.callParams + ') : helper))');
    },

    // [invokePartial]
    //
    // On stack, before: context, ...
    // On stack after: result of partial invocation
    //
    // This operation pops off a context, invokes a partial with that context,
    // and pushes the result of the invocation back.
    invokePartial: function(name, indent) {
      var params = [this.nameLookup('partials', name, 'partial'), "'" + indent + "'", "'" + name + "'", this.popStack(), this.popStack(), "helpers", "partials"];

      if (this.options.data) {
        params.push("data");
      } else if (this.options.compat) {
        params.push('undefined');
      }
      if (this.options.compat) {
        params.push('depths');
      }

      this.push("this.invokePartial(" + params.join(", ") + ")");
    },

    // [assignToHash]
    //
    // On stack, before: value, ..., hash, ...
    // On stack, after: ..., hash, ...
    //
    // Pops a value off the stack and assigns it to the current hash
    assignToHash: function(key) {
      var value = this.popStack(),
          context,
          type,
          id;

      if (this.trackIds) {
        id = this.popStack();
      }
      if (this.stringParams) {
        type = this.popStack();
        context = this.popStack();
      }

      var hash = this.hash;
      if (context) {
        hash.contexts.push("'" + key + "': " + context);
      }
      if (type) {
        hash.types.push("'" + key + "': " + type);
      }
      if (id) {
        hash.ids.push("'" + key + "': " + id);
      }
      hash.values.push("'" + key + "': (" + value + ")");
    },

    pushId: function(type, name) {
      if (type === 'ID' || type === 'DATA') {
        this.pushString(name);
      } else if (type === 'sexpr') {
        this.pushStackLiteral('true');
      } else {
        this.pushStackLiteral('null');
      }
    },

    // HELPERS

    compiler: JavaScriptCompiler,

    compileChildren: function(environment, options) {
      var children = environment.children, child, compiler;

      for(var i=0, l=children.length; i<l; i++) {
        child = children[i];
        compiler = new this.compiler();

        var index = this.matchExistingProgram(child);

        if (index == null) {
          this.context.programs.push('');     // Placeholder to prevent name conflicts for nested children
          index = this.context.programs.length;
          child.index = index;
          child.name = 'program' + index;
          this.context.programs[index] = compiler.compile(child, options, this.context, !this.precompile);
          this.context.environments[index] = child;

          this.useDepths = this.useDepths || compiler.useDepths;
        } else {
          child.index = index;
          child.name = 'program' + index;
        }
      }
    },
    matchExistingProgram: function(child) {
      for (var i = 0, len = this.context.environments.length; i < len; i++) {
        var environment = this.context.environments[i];
        if (environment && environment.equals(child)) {
          return i;
        }
      }
    },

    programExpression: function(guid) {
      var child = this.environment.children[guid],
          depths = child.depths.list,
          useDepths = this.useDepths,
          depth;

      var programParams = [child.index, 'data'];

      if (useDepths) {
        programParams.push('depths');
      }

      return 'this.program(' + programParams.join(', ') + ')';
    },

    useRegister: function(name) {
      if(!this.registers[name]) {
        this.registers[name] = true;
        this.registers.list.push(name);
      }
    },

    pushStackLiteral: function(item) {
      return this.push(new Literal(item));
    },

    pushSource: function(source) {
      if (this.pendingContent) {
        this.source.push(this.appendToBuffer(this.quotedString(this.pendingContent)));
        this.pendingContent = undefined;
      }

      if (source) {
        this.source.push(source);
      }
    },

    pushStack: function(item) {
      this.flushInline();

      var stack = this.incrStack();
      this.pushSource(stack + " = " + item + ";");
      this.compileStack.push(stack);
      return stack;
    },

    replaceStack: function(callback) {
      var prefix = '',
          inline = this.isInline(),
          stack,
          createdStack,
          usedLiteral;

      /* istanbul ignore next */
      if (!this.isInline()) {
        throw new Exception('replaceStack on non-inline');
      }

      // We want to merge the inline statement into the replacement statement via ','
      var top = this.popStack(true);

      if (top instanceof Literal) {
        // Literals do not need to be inlined
        prefix = stack = top.value;
        usedLiteral = true;
      } else {
        // Get or create the current stack name for use by the inline
        createdStack = !this.stackSlot;
        var name = !createdStack ? this.topStackName() : this.incrStack();

        prefix = '(' + this.push(name) + ' = ' + top + ')';
        stack = this.topStack();
      }

      var item = callback.call(this, stack);

      if (!usedLiteral) {
        this.popStack();
      }
      if (createdStack) {
        this.stackSlot--;
      }
      this.push('(' + prefix + item + ')');
    },

    incrStack: function() {
      this.stackSlot++;
      if(this.stackSlot > this.stackVars.length) { this.stackVars.push("stack" + this.stackSlot); }
      return this.topStackName();
    },
    topStackName: function() {
      return "stack" + this.stackSlot;
    },
    flushInline: function() {
      var inlineStack = this.inlineStack;
      if (inlineStack.length) {
        this.inlineStack = [];
        for (var i = 0, len = inlineStack.length; i < len; i++) {
          var entry = inlineStack[i];
          if (entry instanceof Literal) {
            this.compileStack.push(entry);
          } else {
            this.pushStack(entry);
          }
        }
      }
    },
    isInline: function() {
      return this.inlineStack.length;
    },

    popStack: function(wrapped) {
      var inline = this.isInline(),
          item = (inline ? this.inlineStack : this.compileStack).pop();

      if (!wrapped && (item instanceof Literal)) {
        return item.value;
      } else {
        if (!inline) {
          /* istanbul ignore next */
          if (!this.stackSlot) {
            throw new Exception('Invalid stack pop');
          }
          this.stackSlot--;
        }
        return item;
      }
    },

    topStack: function() {
      var stack = (this.isInline() ? this.inlineStack : this.compileStack),
          item = stack[stack.length - 1];

      if (item instanceof Literal) {
        return item.value;
      } else {
        return item;
      }
    },

    contextName: function(context) {
      if (this.useDepths && context) {
        return 'depths[' + context + ']';
      } else {
        return 'depth' + context;
      }
    },

    quotedString: function(str) {
      return '"' + str
        .replace(/\\/g, '\\\\')
        .replace(/"/g, '\\"')
        .replace(/\n/g, '\\n')
        .replace(/\r/g, '\\r')
        .replace(/\u2028/g, '\\u2028')   // Per Ecma-262 7.3 + 7.8.4
        .replace(/\u2029/g, '\\u2029') + '"';
    },

    objectLiteral: function(obj) {
      var pairs = [];

      for (var key in obj) {
        if (obj.hasOwnProperty(key)) {
          pairs.push(this.quotedString(key) + ':' + obj[key]);
        }
      }

      return '{' + pairs.join(',') + '}';
    },

    setupHelper: function(paramSize, name, blockHelper) {
      var params = [],
          paramsInit = this.setupParams(name, paramSize, params, blockHelper);
      var foundHelper = this.nameLookup('helpers', name, 'helper');

      return {
        params: params,
        paramsInit: paramsInit,
        name: foundHelper,
        callParams: [this.contextName(0)].concat(params).join(", ")
      };
    },

    setupOptions: function(helper, paramSize, params) {
      var options = {}, contexts = [], types = [], ids = [], param, inverse, program;

      options.name = this.quotedString(helper);
      options.hash = this.popStack();

      if (this.trackIds) {
        options.hashIds = this.popStack();
      }
      if (this.stringParams) {
        options.hashTypes = this.popStack();
        options.hashContexts = this.popStack();
      }

      inverse = this.popStack();
      program = this.popStack();

      // Avoid setting fn and inverse if neither are set. This allows
      // helpers to do a check for `if (options.fn)`
      if (program || inverse) {
        if (!program) {
          program = 'this.noop';
        }

        if (!inverse) {
          inverse = 'this.noop';
        }

        options.fn = program;
        options.inverse = inverse;
      }

      // The parameters go on to the stack in order (making sure that they are evaluated in order)
      // so we need to pop them off the stack in reverse order
      var i = paramSize;
      while (i--) {
        param = this.popStack();
        params[i] = param;

        if (this.trackIds) {
          ids[i] = this.popStack();
        }
        if (this.stringParams) {
          types[i] = this.popStack();
          contexts[i] = this.popStack();
        }
      }

      if (this.trackIds) {
        options.ids = "[" + ids.join(",") + "]";
      }
      if (this.stringParams) {
        options.types = "[" + types.join(",") + "]";
        options.contexts = "[" + contexts.join(",") + "]";
      }

      if (this.options.data) {
        options.data = "data";
      }

      return options;
    },

    // the params and contexts arguments are passed in arrays
    // to fill in
    setupParams: function(helperName, paramSize, params, useRegister) {
      var options = this.objectLiteral(this.setupOptions(helperName, paramSize, params));

      if (useRegister) {
        this.useRegister('options');
        params.push('options');
        return 'options=' + options;
      } else {
        params.push(options);
        return '';
      }
    }
  };

  var reservedWords = (
    "break else new var" +
    " case finally return void" +
    " catch for switch while" +
    " continue function this with" +
    " default if throw" +
    " delete in try" +
    " do instanceof typeof" +
    " abstract enum int short" +
    " boolean export interface static" +
    " byte extends long super" +
    " char final native synchronized" +
    " class float package throws" +
    " const goto private transient" +
    " debugger implements protected volatile" +
    " double import public let yield"
  ).split(" ");

  var compilerWords = JavaScriptCompiler.RESERVED_WORDS = {};

  for(var i=0, l=reservedWords.length; i<l; i++) {
    compilerWords[reservedWords[i]] = true;
  }

  JavaScriptCompiler.isValidJavaScriptVariableName = function(name) {
    return !JavaScriptCompiler.RESERVED_WORDS[name] && /^[a-zA-Z_$][0-9a-zA-Z_$]*$/.test(name);
  };

  __exports__ = JavaScriptCompiler;
  return __exports__;
})(__module2__, __module5__);

// handlebars.js
var __module0__ = (function(__dependency1__, __dependency2__, __dependency3__, __dependency4__, __dependency5__) {
  "use strict";
  var __exports__;
  /*globals Handlebars: true */
  var Handlebars = __dependency1__;

  // Compiler imports
  var AST = __dependency2__;
  var Parser = __dependency3__.parser;
  var parse = __dependency3__.parse;
  var Compiler = __dependency4__.Compiler;
  var compile = __dependency4__.compile;
  var precompile = __dependency4__.precompile;
  var JavaScriptCompiler = __dependency5__;

  var _create = Handlebars.create;
  var create = function() {
    var hb = _create();

    hb.compile = function(input, options) {
      return compile(input, options, hb);
    };
    hb.precompile = function (input, options) {
      return precompile(input, options, hb);
    };

    hb.AST = AST;
    hb.Compiler = Compiler;
    hb.JavaScriptCompiler = JavaScriptCompiler;
    hb.Parser = Parser;
    hb.parse = parse;

    return hb;
  };

  Handlebars = create();
  Handlebars.create = create;

  Handlebars['default'] = Handlebars;

  __exports__ = Handlebars;
  return __exports__;
})(__module1__, __module7__, __module8__, __module11__, __module12__);

  return __module0__;
}));
///#source 1 1 Plugins/lazy.js
/*
 * @name lazy.js
 *
 * @fileOverview
 * lazy.js is a lazy evaluation library for JavaScript.
 *
 * This has been done before. For examples see:
 *
 * - [wu.js](http://fitzgen.github.io/wu.js/)
 * - [Linq.js](http://linqjs.codeplex.com/)
 * - [from.js](https://github.com/suckgamoni/fromjs/)
 * - [IxJS](http://rx.codeplex.com/)
 * - [sloth.js](http://rfw.name/sloth.js/)
 *
 * However, at least at present, lazy.js is faster (on average) than any of
 * those libraries. It is also more complete, with nearly all of the
 * functionality of [Underscore](http://underscorejs.org/) and
 * [Lo-Dash](http://lodash.com/).
 *
 * Finding your way around the code
 * --------------------------------
 *
 * At the heart of lazy.js is the {@link Sequence} object. You create an initial
 * sequence using {@link lazy}, which can accept an array, object, or string.
 * You can then "chain" together methods from this sequence, creating a new
 * sequence with each call.
 *
 * Here's an example:
 *
 *     var data = getReallyBigArray();
 *
 *     var statistics = lazy(data)
 *       .map(transform)
 *       .filter(validate)
 *       .reduce(aggregate);
 *
 * {@link Sequence} is the foundation of other, more specific sequence types.
 *
 * An {@link ArrayLikeSequence} provides indexed access to its elements.
 *
 * An {@link ObjectLikeSequence} consists of key/value pairs.
 *
 * A {@link StringLikeSequence} is like a string (duh): actually, it is an
 * {@link ArrayLikeSequence} whose elements happen to be characters.
 *
 * An {@link AsyncSequence} is special: it iterates over its elements
 * asynchronously (so calling `each` generally begins an asynchronous loop and
 * returns immediately).
 *
 * For more information
 * --------------------
 *
 * I wrote a blog post that explains a little bit more about lazy.js, which you
 * can read [here](http://philosopherdeveloper.com/posts/introducing-lazy-js.html).
 *
 * You can also [create an issue on GitHub](https://github.com/dtao/lazy.js/issues)
 * if you have any issues with the library. I work through them eventually.
 *
 * [@dtao](https://github.com/dtao)
 */

(function(context) {
  /**
   * Wraps an object and returns a {@link Sequence}. For `null` or `undefined`,
   * simply returns an empty sequence (see {@link lazy.strict} for a stricter
   * implementation).
   *
   * - For **arrays**, lazy will create a sequence comprising the elements in
   *   the array (an {@link ArrayLikeSequence}).
   * - For **objects**, lazy will create a sequence of key/value pairs
   *   (an {@link ObjectLikeSequence}).
   * - For **strings**, lazy will create a sequence of characters (a
   *   {@link StringLikeSequence}).
   *
   * @public
   * @param {Array|Object|string} source An array, object, or string to wrap.
   * @returns {Sequence} The wrapped lazy object.
   *
   * @exampleHelpers
   * // Utility functions to provide to all examples
   * function increment(x) { return x + 1; }
   * function isEven(x) { return x % 2 === 0; }
   * function isPositive(x) { return x > 0; }
   * function isNegative(x) { return x < 0; }
   *
   * @examples
   * lazy([1, 2, 4])       // instanceof lazy.ArrayLikeSequence
   * lazy({ foo: "bar" })  // instanceof lazy.ObjectLikeSequence
   * lazy("hello, world!") // instanceof lazy.StringLikeSequence
   * lazy()                // sequence: []
   * lazy(null)            // sequence: []
   */
  function lazy(source) {
    if (source instanceof Array) {
      return new ArrayWrapper(source);

    } else if (typeof source === "string") {
      return new StringWrapper(source);

    } else if (source instanceof Sequence) {
      return source;
    }

    if (lazy.extensions) {
      var extensions = lazy.extensions, length = extensions.length, result;
      while (!result && length--) {
        result = extensions[length](source);
      }
      if (result) {
        return result;
      }
    }

    return new ObjectWrapper(source);
  }

  lazy.VERSION = '0.3.2';

  /*** Utility methods of questionable value ***/

  lazy.noop = function noop() {};
  lazy.identity = function identity(x) { return x; };

  /**
   * Provides a stricter version of {@link lazy} which throws an error when
   * attempting to wrap `null`, `undefined`, or numeric or boolean values as a
   * sequence.
   *
   * @public
   * @returns {Function} A stricter version of the {@link lazy} helper function.
   *
   * @examples
   * var Strict = lazy.strict();
   *
   * Strict()                  // throws
   * Strict(null)              // throws
   * Strict(true)              // throws
   * Strict(5)                 // throws
   * Strict([1, 2, 3])         // instanceof lazy.ArrayLikeSequence
   * Strict({ foo: "bar" })    // instanceof lazy.ObjectLikeSequence
   * Strict("hello, world!")   // instanceof lazy.StringLikeSequence
   *
   * // Let's also ensure the static functions are still there.
   * Strict.range(3)           // sequence: [0, 1, 2]
   * Strict.generate(Date.now) // instanceof lazy.GeneratedSequence
   */
  lazy.strict = function strict() {
    function Strictlazy(source) {
      if (source == null) {
        throw new Error("You cannot wrap null or undefined using lazy.");
      }

      if (typeof source === "number" || typeof source === "boolean") {
        throw new Error("You cannot wrap primitive values using lazy.");
      }

      return lazy(source);
    };

    lazy(lazy).each(function(property, name) {
      Strictlazy[name] = property;
    });

    return Strictlazy;
  };

  /**
   * The `Sequence` object provides a unified API encapsulating the notion of
   * zero or more consecutive elements in a collection, stream, etc.
   *
   * lazy evaluation
   * ---------------
   *
   * Generally speaking, creating a sequence should not be an expensive operation,
   * and should not iterate over an underlying source or trigger any side effects.
   * This means that chaining together methods that return sequences incurs only
   * the cost of creating the `Sequence` objects themselves and not the cost of
   * iterating an underlying data source multiple times.
   *
   * The following code, for example, creates 4 sequences and does nothing with
   * `source`:
   *
   *     var seq = lazy(source) // 1st sequence
   *       .map(func)           // 2nd
   *       .filter(pred)        // 3rd
   *       .reverse();          // 4th
   *
   * lazy's convention is to hold off on iterating or otherwise *doing* anything
   * (aside from creating `Sequence` objects) until you call `each`:
   *
   *     seq.each(function(x) { console.log(x); });
   *
   * Defining custom sequences
   * -------------------------
   *
   * Defining your own type of sequence is relatively simple:
   *
   * 1. Pass a *method name* and an object containing *function overrides* to
   *    {@link Sequence.define}. If the object includes a function called `init`,
   *    this function will be called upon initialization.
   * 2. The object should include at least either a `getIterator` method or an
   *    `each` method. The former supports both asynchronous and synchronous
   *    iteration, but is slightly more cumbersome to implement. The latter
   *    supports synchronous iteration and can be automatically implemented in
   *    terms of the former. You can also implement both if you want, e.g. to
   *    optimize performance. For more info, see {@link Iterator} and
   *    {@link AsyncSequence}.
   *
   * As a trivial example, the following code defines a new method, `sample`,
   * which randomly may or may not include each element from its parent.
   *
   *     lazy.Sequence.define("sample", {
   *       each: function(fn) {
   *         return this.parent.each(function(e) {
   *           // 50/50 chance of including this element.
   *           if (Math.random() > 0.5) {
   *             return fn(e);
   *           }
   *         });
   *       }
   *     });
   *
   * (Of course, the above could also easily have been implemented using
   * {@link #filter} instead of creating a custom sequence. But I *did* say this
   * was a trivial example, to be fair.)
   *
   * Now it will be possible to create this type of sequence from any parent
   * sequence by calling the method name you specified. In other words, you can
   * now do this:
   *
   *     lazy(arr).sample();
   *     lazy(arr).map(func).sample();
   *     lazy(arr).map(func).filter(pred).sample();
   *
   * Etc., etc.
   *
   * @public
   * @constructor
   */
  function Sequence() {}

  /**
   * Create a new constructor function for a type inheriting from `Sequence`.
   *
   * @public
   * @param {string|Array.<string>} methodName The name(s) of the method(s) to be
   *     used for constructing the new sequence. The method will be attached to
   *     the `Sequence` prototype so that it can be chained with any other
   *     sequence methods, like {@link #map}, {@link #filter}, etc.
   * @param {Object} overrides An object containing function overrides for this
   *     new sequence type. **Must** include either `getIterator` or `each` (or
   *     both). *May* include an `init` method as well. For these overrides,
   *     `this` will be the new sequence, and `this.parent` will be the base
   *     sequence from which the new sequence was constructed.
   * @returns {Function} A constructor for a new type inheriting from `Sequence`.
   *
   * @examples
   * // This sequence type logs every element to the specified logger as it
   * // iterates over it.
   * lazy.Sequence.define("verbose", {
   *   init: function(logger) {
   *     this.logger = logger;
   *   },
   *
   *   each: function(fn) {
   *     var logger = this.logger;
   *     return this.parent.each(function(e, i) {
   *       logger(e);
   *       return fn(e, i);
   *     });
   *   }
   * });
   *
   * lazy([1, 2, 3]).verbose(logger).each(lazy.noop) // calls logger 3 times
   */
  Sequence.define = function define(methodName, overrides) {
    if (!overrides || (!overrides.getIterator && !overrides.each)) {
      throw new Error("A custom sequence must implement *at least* getIterator or each!");
    }

    return defineSequenceType(Sequence, methodName, overrides);
  };

  /**
   * Gets the number of elements in the sequence. In some cases, this may
   * require eagerly evaluating the sequence.
   *
   * @public
   * @returns {number} The number of elements in the sequence.
   *
   * @examples
   * lazy([1, 2, 3]).size();                 // => 3
   * lazy([1, 2]).map(lazy.identity).size(); // => 2
   * lazy([1, 2, 3]).reject(isEven).size();  // => 2
   * lazy([1, 2, 3]).take(1).size();         // => 1
   * lazy({ foo: 1, bar: 2 }).size();        // => 2
   * lazy('hello').size();                   // => 5
   */
  Sequence.prototype.size = function size() {
    return this.getIndex().length();
  };

  /**
   * Creates an {@link Iterator} object with two methods, `moveNext` -- returning
   * true or false -- and `current` -- returning the current value.
   *
   * This method is used when asynchronously iterating over sequences. Any type
   * inheriting from `Sequence` must implement this method or it can't support
   * asynchronous iteration.
   *
   * Note that **this method is not intended to be used directly by application
   * code.** Rather, it is intended as a means for implementors to potentially
   * define custom sequence types that support either synchronous or
   * asynchronous iteration.
   *
   * @public
   * @returns {Iterator} An iterator object.
   *
   * @examples
   * var iterator = lazy([1, 2]).getIterator();
   *
   * iterator.moveNext(); // => true
   * iterator.current();  // => 1
   * iterator.moveNext(); // => true
   * iterator.current();  // => 2
   * iterator.moveNext(); // => false
   */
  Sequence.prototype.getIterator = function getIterator() {
    return new Iterator(this);
  };

  /**
   * Gets the root sequence underlying the current chain of sequences.
   */
  Sequence.prototype.root = function root() {
    return this.parent.root();
  };

  /**
   * Whether or not the current sequence is an asynchronous one. This is more
   * accurate than checking `instanceof {@link AsyncSequence}` because, for
   * example, `lazy([1, 2, 3]).async().map(lazy.identity)` returns a sequence
   * that iterates asynchronously even though it's not an instance of
   * `AsyncSequence`.
   */
  Sequence.prototype.isAsync = function isAsync() {
    return this.parent ? this.parent.isAsync() : false;
  };

  /**
   * Evaluates the sequence and produces an appropriate value (an array in most
   * cases, an object for {@link ObjectLikeSequence}s or a string for
   * {@link StringLikeSequence}s).
   */
  Sequence.prototype.value = function value() {
    return this.toArray();
  };

  /**
   * Applies the current transformation chain to a given source.
   *
   * @examples
   * var sequence = lazy([])
   *   .map(function(x) { return x * -1; })
   *   .filter(function(x) { return x % 2 === 0; });
   *
   * sequence.apply([1, 2, 3, 4]); // => [-2, -4]
   */
  Sequence.prototype.apply = function apply(source) {
    var root = this.root(),
        previousSource = root.source,
        result;

    try {
      root.source = source;
      result = this.value();
    } finally {
      root.source = previousSource;
    }

    return result;
  };

  /**
   * The Iterator object provides an API for iterating over a sequence.
   *
   * The purpose of the `Iterator` type is mainly to offer an agnostic way of
   * iterating over a sequence -- either synchronous (i.e. with a `while` loop)
   * or asynchronously (with recursive calls to either `setTimeout` or --- if
   * available --- `setImmediate`). It is not intended to be used directly by
   * application code.
   *
   * @public
   * @constructor
   * @param {Sequence} sequence The sequence to iterate over.
   */
  function Iterator(sequence) {
    this.sequence = sequence;
    this.index    = -1;
  }

  /**
   * Gets the current item this iterator is pointing to.
   *
   * @public
   * @returns {*} The current item.
   */
  Iterator.prototype.current = function current() {
    return this.cachedIndex && this.cachedIndex.get(this.index);
  };

  /**
   * Moves the iterator to the next item in a sequence, if possible.
   *
   * @public
   * @returns {boolean} True if the iterator is able to move to a new item, or else
   *     false.
   */
  Iterator.prototype.moveNext = function moveNext() {
    var cachedIndex = this.cachedIndex;

    if (!cachedIndex) {
      cachedIndex = this.cachedIndex = this.sequence.getIndex();
    }

    if (this.index >= cachedIndex.length() - 1) {
      return false;
    }

    ++this.index;
    return true;
  };

  /**
   * Creates an array snapshot of a sequence.
   *
   * Note that for indefinite sequences, this method may raise an exception or
   * (worse) cause the environment to hang.
   *
   * @public
   * @returns {Array} An array containing the current contents of the sequence.
   *
   * @examples
   * lazy([1, 2, 3]).toArray() // => [1, 2, 3]
   */
  Sequence.prototype.toArray = function toArray() {
    return this.reduce(function(arr, element) {
      arr.push(element);
      return arr;
    }, []);
  };

  /**
   * Provides an indexed view into the sequence.
   *
   * For sequences that are already indexed, this will simply return the
   * sequence. For non-indexed sequences, this will eagerly evaluate the
   * sequence and cache the result (so subsequent calls will not create
   * additional arrays).
   *
   * @returns {ArrayLikeSequence} A sequence containing the current contents of
   *     the sequence.
   *
   * @examples
   * lazy([1, 2, 3]).filter(isEven)            // instanceof lazy.Sequence
   * lazy([1, 2, 3]).filter(isEven).getIndex() // instanceof lazy.ArrayLikeSequence
   */
  Sequence.prototype.getIndex = function getIndex() {
    if (!this.cachedIndex) {
      this.cachedIndex = new ArrayWrapper(this.toArray());
    }
    return this.cachedIndex;
  };

  /**
   * Provides an indexed, memoized view into the sequence. This will cache the
   * result whenever the sequence is first iterated, so that subsequent
   * iterations will access the same element objects.
   *
   * @public
   * @returns {ArrayLikeSequence} An indexed, memoized sequence containing this
   *     sequence's elements, cached after the first iteration.
   *
   * @example
   * function createObject() { return new Object(); }
   *
   * var plain    = lazy.generate(createObject, 10),
   *     memoized = lazy.generate(createObject, 10).memoize();
   *
   * plain.toArray()[0] === plain.toArray()[0];       // => false
   * memoized.toArray()[0] === memoized.toArray()[0]; // => true
   */
  Sequence.prototype.memoize = function memoize() {
    return new MemoizedSequence(this);
  };

  /**
   * @constructor
   */
  function MemoizedSequence(parent) {
    this.parent = parent;
  }

  // MemoizedSequence needs to have its prototype set up after ArrayLikeSequence

  /**
   * Creates an object from a sequence of key/value pairs.
   *
   * @public
   * @returns {Object} An object with keys and values corresponding to the pairs
   *     of elements in the sequence.
   *
   * @examples
   * var details = [
   *   ["first", "Dan"],
   *   ["last", "Tao"],
   *   ["age", 29]
   * ];
   *
   * lazy(details).toObject() // => { first: "Dan", last: "Tao", age: 29 }
   */
  Sequence.prototype.toObject = function toObject() {
    return this.reduce(function(object, pair) {
      object[pair[0]] = pair[1];
      return object;
    }, {});
  };

  /**
   * Iterates over this sequence and executes a function for every element.
   *
   * @public
   * @aka forEach
   * @param {Function} fn The function to call on each element in the sequence.
   *     Return false from the function to end the iteration.
   *
   * @examples
   * lazy([1, 2, 3, 4]).each(fn) // calls fn 4 times
   */
  Sequence.prototype.each = function each(fn) {
    var iterator = this.getIterator(),
        i = -1;

    while (iterator.moveNext()) {
      if (fn(iterator.current(), ++i) === false) {
        return false;
      }
    }

    return true;
  };

  Sequence.prototype.forEach = function forEach(fn) {
    return this.each(fn);
  };

  /**
   * Creates a new sequence whose values are calculated by passing this sequence's
   * elements through some mapping function.
   *
   * @public
   * @aka collect
   * @param {Function} mapFn The mapping function used to project this sequence's
   *     elements onto a new sequence.
   * @returns {Sequence} The new sequence.
   *
   * @examples
   * lazy([]).map(increment)        // sequence: []
   * lazy([1, 2, 3]).map(increment) // sequence: [2, 3, 4]
   *
   * @benchmarks
   * function increment(x) { return x + 1; }
   *
   * var smArr = lazy.range(10).toArray(),
   *     lgArr = lazy.range(100).toArray();
   *
   * lazy(smArr).map(increment).each(lazy.noop) // lazy - 10 elements
   * lazy(lgArr).map(increment).each(lazy.noop) // lazy - 100 elements
   * _.each(_.map(smArr, increment), _.noop)    // lodash - 10 elements
   * _.each(_.map(lgArr, increment), _.noop)    // lodash - 100 elements
   */
  Sequence.prototype.map = function map(mapFn) {
    return new MappedSequence(this, createCallback(mapFn));
  };

  Sequence.prototype.collect = function collect(mapFn) {
    return this.map(mapFn);
  };

  /**
   * @constructor
   */
  function MappedSequence(parent, mapFn) {
    this.parent = parent;
    this.mapFn  = mapFn;
  }

  MappedSequence.prototype = new Sequence();

  MappedSequence.prototype.getIterator = function getIterator() {
    return new MappingIterator(this.parent, this.mapFn);
  };

  MappedSequence.prototype.each = function each(fn) {
    var mapFn = this.mapFn;
    return this.parent.each(function(e, i) {
      return fn(mapFn(e, i), i);
    });
  };

  /**
   * @constructor
   */
  function MappingIterator(sequence, mapFn) {
    this.iterator = sequence.getIterator();
    this.mapFn    = mapFn;
    this.index    = -1;
  }

  MappingIterator.prototype.current = function current() {
    return this.mapFn(this.iterator.current(), this.index);
  };

  MappingIterator.prototype.moveNext = function moveNext() {
    if (this.iterator.moveNext()) {
      ++this.index;
      return true;
    }

    return false;
  };

  /**
   * Creates a new sequence whose values are calculated by accessing the specified
   * property from each element in this sequence.
   *
   * @public
   * @param {string} propertyName The name of the property to access for every
   *     element in this sequence.
   * @returns {Sequence} The new sequence.
   *
   * @examples
   * var people = [
   *   { first: "Dan", last: "Tao" },
   *   { first: "Bob", last: "Smith" }
   * ];
   *
   * lazy(people).pluck("last") // sequence: ["Tao", "Smith"]
   */
  Sequence.prototype.pluck = function pluck(property) {
    return this.map(property);
  };

  /**
   * Creates a new sequence whose values are calculated by invoking the specified
   * function on each element in this sequence.
   *
   * @public
   * @param {string} methodName The name of the method to invoke for every element
   *     in this sequence.
   * @returns {Sequence} The new sequence.
   *
   * @examples
   * function Person(first, last) {
   *   this.fullName = function fullName() {
   *     return first + " " + last;
   *   };
   * }
   *
   * var people = [
   *   new Person("Dan", "Tao"),
   *   new Person("Bob", "Smith")
   * ];
   *
   * lazy(people).invoke("fullName") // sequence: ["Dan Tao", "Bob Smith"]
   */
  Sequence.prototype.invoke = function invoke(methodName) {
    return this.map(function(e) {
      return e[methodName]();
    });
  };

  /**
   * Creates a new sequence whose values are the elements of this sequence which
   * satisfy the specified predicate.
   *
   * @public
   * @aka select
   * @param {Function} filterFn The predicate to call on each element in this
   *     sequence, which returns true if the element should be included.
   * @returns {Sequence} The new sequence.
   *
   * @examples
   * var numbers = [1, 2, 3, 4, 5, 6];
   *
   * lazy(numbers).filter(isEven) // sequence: [2, 4, 6]
   *
   * @benchmarks
   * function isEven(x) { return x % 2 === 0; }
   *
   * var smArr = lazy.range(10).toArray(),
   *     lgArr = lazy.range(100).toArray();
   *
   * lazy(smArr).filter(isEven).each(lazy.noop) // lazy - 10 elements
   * lazy(lgArr).filter(isEven).each(lazy.noop) // lazy - 100 elements
   * _.each(_.filter(smArr, isEven), _.noop)    // lodash - 10 elements
   * _.each(_.filter(lgArr, isEven), _.noop)    // lodash - 100 elements
   */
  Sequence.prototype.filter = function filter(filterFn) {
    return new FilteredSequence(this, createCallback(filterFn));
  };

  Sequence.prototype.select = function select(filterFn) {
    return this.filter(filterFn);
  };

  /**
   * @constructor
   */
  function FilteredSequence(parent, filterFn) {
    this.parent   = parent;
    this.filterFn = filterFn;
  }

  FilteredSequence.prototype = new Sequence();

  FilteredSequence.prototype.getIterator = function getIterator() {
    return new FilteringIterator(this.parent, this.filterFn);
  };

  FilteredSequence.prototype.each = function each(fn) {
    var filterFn = this.filterFn;

    // I'm not proud of this, but it'll get the job done for now.
    if (this.parent instanceof ObjectLikeSequence) {
      return this.parent.each(function(v, k) {
        if (filterFn(v, k)) {
          return fn(v, k);
        }
      });

    } else {
      var j = 0;
      return this.parent.each(function(e, i) {
        if (filterFn(e, i)) {
          return fn(e, j++);
        }
      });
    }
  };

  FilteredSequence.prototype.reverse = function reverse() {
    return this.parent.reverse().filter(this.filterFn);
  };

  /**
   * @constructor
   */
  function FilteringIterator(sequence, filterFn) {
    this.iterator = sequence.getIterator();
    this.filterFn = filterFn;
    this.index    = 0;
  }

  FilteringIterator.prototype.current = function current() {
    return this.value;
  };

  FilteringIterator.prototype.moveNext = function moveNext() {
    var iterator = this.iterator,
        filterFn = this.filterFn,
        value;

    while (iterator.moveNext()) {
      value = iterator.current();
      if (filterFn(value, this.index++)) {
        this.value = value;
        return true;
      }
    }

    this.value = undefined;
    return false;
  };

  /**
   * Creates a new sequence whose values exclude the elements of this sequence
   * identified by the specified predicate.
   *
   * @public
   * @param {Function} rejectFn The predicate to call on each element in this
   *     sequence, which returns true if the element should be omitted.
   * @returns {Sequence} The new sequence.
   *
   * @examples
   * lazy([1, 2, 3, 4, 5]).reject(isEven)              // sequence: [1, 3, 5]
   * lazy([{ foo: 1 }, { bar: 2 }]).reject('foo')      // sequence: [{ bar: 2 }]
   * lazy([{ foo: 1 }, { foo: 2 }]).reject({ foo: 2 }) // sequence: [{ foo: 1 }]
   */
  Sequence.prototype.reject = function reject(rejectFn) {
    rejectFn = createCallback(rejectFn);
    return this.filter(function(e) { return !rejectFn(e); });
  };

  /**
   * Creates a new sequence whose values have the specified type, as determined
   * by the `typeof` operator.
   *
   * @public
   * @param {string} type The type of elements to include from the underlying
   *     sequence, i.e. where `typeof [element] === [type]`.
   * @returns {Sequence} The new sequence, comprising elements of the specified
   *     type.
   *
   * @examples
   * lazy([1, 2, 'foo', 'bar']).ofType('number')  // sequence: [1, 2]
   * lazy([1, 2, 'foo', 'bar']).ofType('string')  // sequence: ['foo', 'bar']
   * lazy([1, 2, 'foo', 'bar']).ofType('boolean') // sequence: []
   */
  Sequence.prototype.ofType = function ofType(type) {
    return this.filter(function(e) { return typeof e === type; });
  };

  /**
   * Creates a new sequence whose values are the elements of this sequence with
   * property names and values matching those of the specified object.
   *
   * @public
   * @param {Object} properties The properties that should be found on every
   *     element that is to be included in this sequence.
   * @returns {Sequence} The new sequence.
   *
   * @examples
   * var people = [
   *   { first: "Dan", last: "Tao" },
   *   { first: "Bob", last: "Smith" }
   * ];
   *
   * lazy(people).where({ first: "Dan" }) // sequence: [{ first: "Dan", last: "Tao" }]
   *
   * @benchmarks
   * var animals = ["dog", "cat", "mouse", "horse", "pig", "snake"];
   *
   * lazy(animals).where({ length: 3 }).each(lazy.noop) // lazy
   * _.each(_.where(animals, { length: 3 }), _.noop)    // lodash
   */
  Sequence.prototype.where = function where(properties) {
    return this.filter(properties);
  };

  /**
   * Creates a new sequence with the same elements as this one, but to be iterated
   * in the opposite order.
   *
   * Note that in some (but not all) cases, the only way to create such a sequence
   * may require iterating the entire underlying source when `each` is called.
   *
   * @public
   * @returns {Sequence} The new sequence.
   *
   * @examples
   * lazy([1, 2, 3]).reverse() // sequence: [3, 2, 1]
   * lazy([]).reverse()        // sequence: []
   */
  Sequence.prototype.reverse = function reverse() {
    return new ReversedSequence(this);
  };

  /**
   * @constructor
   */
  function ReversedSequence(parent) {
    this.parent = parent;
  }

  ReversedSequence.prototype = new Sequence();

  ReversedSequence.prototype.getIterator = function getIterator() {
    return new ReversedIterator(this.parent);
  };

  /**
   * @constuctor
   */
  function ReversedIterator(sequence) {
    this.sequence = sequence;
  }

  ReversedIterator.prototype.current = function current() {
    return this.sequence.getIndex().get(this.index);
  };

  ReversedIterator.prototype.moveNext = function moveNext() {
    var indexed = this.sequence.getIndex(),
        length  = indexed.length();

    if (typeof this.index === "undefined") {
      this.index = length;
    }

    return (--this.index >= 0);
  };

  /**
   * Creates a new sequence with all of the elements of this one, plus those of
   * the given array(s).
   *
   * @public
   * @param {...*} var_args One or more values (or arrays of values) to use for
   *     additional items after this sequence.
   * @returns {Sequence} The new sequence.
   *
   * @examples
   * var left  = [1, 2, 3];
   * var right = [4, 5, 6];
   *
   * lazy(left).concat(right)         // sequence: [1, 2, 3, 4, 5, 6]
   * lazy(left).concat(lazy(right))   // sequence: [1, 2, 3, 4, 5, 6]
   * lazy(left).concat(right, [7, 8]) // sequence: [1, 2, 3, 4, 5, 6, 7, 8]
   */
  Sequence.prototype.concat = function concat(var_args) {
    return new ConcatenatedSequence(this, arraySlice.call(arguments, 0));
  };

  /**
   * @constructor
   */
  function ConcatenatedSequence(parent, arrays) {
    this.parent = parent;
    this.arrays = arrays;
  }

  ConcatenatedSequence.prototype = new Sequence();

  ConcatenatedSequence.prototype.each = function each(fn) {
    var done = false,
        i = 0;

    this.parent.each(function(e) {
      if (fn(e, i++) === false) {
        done = true;
        return false;
      }
    });

    if (!done) {
      lazy(this.arrays).flatten().each(function(e) {
        if (fn(e, i++) === false) {
          return false;
        }
      });
    }
  };

  /**
   * Creates a new sequence comprising the first N elements from this sequence, OR
   * (if N is `undefined`) simply returns the first element of this sequence.
   *
   * @public
   * @aka head, take
   * @param {number=} count The number of elements to take from this sequence. If
   *     this value exceeds the length of the sequence, the resulting sequence
   *     will be essentially the same as this one.
   * @returns {*} The new sequence (or the first element from this sequence if
   *     no count was given).
   *
   * @examples
   * function powerOfTwo(exp) {
   *   return Math.pow(2, exp);
   * }
   *
   * lazy.generate(powerOfTwo).first()          // => 1
   * lazy.generate(powerOfTwo).first(5)         // sequence: [1, 2, 4, 8, 16]
   * lazy.generate(powerOfTwo).skip(2).first()  // => 4
   * lazy.generate(powerOfTwo).skip(2).first(2) // sequence: [4, 8]
   */
  Sequence.prototype.first = function first(count) {
    if (typeof count === "undefined") {
      return getFirst(this);
    }
    return new TakeSequence(this, count);
  };

  Sequence.prototype.head =
  Sequence.prototype.take = function (count) {
    return this.first(count);
  };

  /**
   * @constructor
   */
  function TakeSequence(parent, count) {
    this.parent = parent;
    this.count  = count;
  }

  TakeSequence.prototype = new Sequence();

  TakeSequence.prototype.getIterator = function getIterator() {
    return new TakeIterator(this.parent, this.count);
  };

  TakeSequence.prototype.each = function each(fn) {
    var count = this.count,
        i     = 0;

    var handle = this.parent.each(function(e) {
      var result;
      if (i < count) { result = fn(e, i++); }
      if (i >= count) { return false; }
      return result;
    });

    if (handle instanceof AsyncHandle) {
      return handle;
    }

    return i === count;
  };

  /**
   * @constructor
   */
  function TakeIterator(sequence, count) {
    this.iterator = sequence.getIterator();
    this.count    = count;
  }

  TakeIterator.prototype.current = function current() {
    return this.iterator.current();
  };

  TakeIterator.prototype.moveNext = function moveNext() {
    return ((--this.count >= 0) && this.iterator.moveNext());
  };

  /**
   * Creates a new sequence comprising the elements from the head of this sequence
   * that satisfy some predicate. Once an element is encountered that doesn't
   * satisfy the predicate, iteration will stop.
   *
   * @public
   * @param {Function} predicate
   * @returns {Sequence} The new sequence
   *
   * @examples
   * function lessThan(x) {
   *   return function(y) {
   *     return y < x;
   *   };
   * }
   *
   * lazy([1, 2, 3, 4]).takeWhile(lessThan(3)) // sequence: [1, 2]
   * lazy([1, 2, 3, 4]).takeWhile(lessThan(0)) // sequence: []
   */
  Sequence.prototype.takeWhile = function takeWhile(predicate) {
    return new TakeWhileSequence(this, predicate);
  };

  /**
   * @constructor
   */
  function TakeWhileSequence(parent, predicate) {
    this.parent    = parent;
    this.predicate = predicate;
  }

  TakeWhileSequence.prototype = new Sequence();

  TakeWhileSequence.prototype.each = function each(fn) {
    var predicate = this.predicate,
        finished = false,
        j = 0;

    var result = this.parent.each(function(e, i) {
      if (!predicate(e, i)) {
        finished = true;
        return false;
      }

      return fn(e, j++);
    });

    if (result instanceof AsyncHandle) {
      return result;
    }

    return finished;
  };

  /**
   * Creates a new sequence comprising all but the last N elements of this
   * sequence.
   *
   * @public
   * @param {number=} count The number of items to omit from the end of the
   *     sequence (defaults to 1).
   * @returns {Sequence} The new sequence.
   *
   * @examples
   * lazy([1, 2, 3, 4]).initial()                    // sequence: [1, 2, 3]
   * lazy([1, 2, 3, 4]).initial(2)                   // sequence: [1, 2]
   * lazy([1, 2, 3]).filter(lazy.identity).initial() // sequence: [1, 2]
   */
  Sequence.prototype.initial = function initial(count) {
    if (typeof count === "undefined") {
      count = 1;
    }
    return this.take(this.getIndex().length() - count);
  };

  /**
   * Creates a new sequence comprising the last N elements of this sequence, OR
   * (if N is `undefined`) simply returns the last element of this sequence.
   *
   * @public
   * @param {number=} count The number of items to take from the end of the
   *     sequence.
   * @returns {*} The new sequence (or the last element from this sequence
   *     if no count was given).
   *
   * @examples
   * lazy([1, 2, 3]).last()                 // => 3
   * lazy([1, 2, 3]).last(2)                // sequence: [2, 3]
   * lazy([1, 2, 3]).filter(isEven).last(2) // sequence: [2]
   */
  Sequence.prototype.last = function last(count) {
    if (typeof count === "undefined") {
      return this.reverse().first();
    }
    return this.reverse().take(count).reverse();
  };

  /**
   * Returns the first element in this sequence with property names and values
   * matching those of the specified object.
   *
   * @public
   * @param {Object} properties The properties that should be found on some
   *     element in this sequence.
   * @returns {*} The found element, or `undefined` if none exists in this
   *     sequence.
   *
   * @examples
   * var words = ["foo", "bar"];
   *
   * lazy(words).findWhere({ 0: "f" }); // => "foo"
   * lazy(words).findWhere({ 0: "z" }); // => undefined
   */
  Sequence.prototype.findWhere = function findWhere(properties) {
    return this.where(properties).first();
  };

  /**
   * Creates a new sequence comprising all but the first N elements of this
   * sequence.
   *
   * @public
   * @aka skip, tail, rest
   * @param {number=} count The number of items to omit from the beginning of the
   *     sequence (defaults to 1).
   * @returns {Sequence} The new sequence.
   *
   * @examples
   * lazy([1, 2, 3, 4]).rest()  // sequence: [2, 3, 4]
   * lazy([1, 2, 3, 4]).rest(0) // sequence: [1, 2, 3, 4]
   * lazy([1, 2, 3, 4]).rest(2) // sequence: [3, 4]
   * lazy([1, 2, 3, 4]).rest(5) // sequence: []
   */
  Sequence.prototype.rest = function rest(count) {
    return new DropSequence(this, count);
  };

  Sequence.prototype.skip =
  Sequence.prototype.tail =
  Sequence.prototype.drop = function drop(count) {
    return this.rest(count);
  };

  /**
   * @constructor
   */
  function DropSequence(parent, count) {
    this.parent = parent;
    this.count  = typeof count === "number" ? count : 1;
  }

  DropSequence.prototype = new Sequence();

  DropSequence.prototype.each = function each(fn) {
    var count   = this.count,
        dropped = 0,
        i       = 0;

    return this.parent.each(function(e) {
      if (dropped++ < count) { return; }
      return fn(e, i++);
    });
  };

  /**
   * Creates a new sequence comprising the elements from this sequence *after*
   * those that satisfy some predicate. The sequence starts with the first
   * element that does not match the predicate.
   *
   * @public
   * @aka skipWhile
   * @param {Function} predicate
   * @returns {Sequence} The new sequence
   */
  Sequence.prototype.dropWhile = function dropWhile(predicate) {
    return new DropWhileSequence(this, predicate);
  };

  Sequence.prototype.skipWhile = function skipWhile(predicate) {
    return this.dropWhile(predicate);
  };

  /**
   * @constructor
   */
  function DropWhileSequence(parent, predicate) {
    this.parent    = parent;
    this.predicate = predicate;
  }

  DropWhileSequence.prototype = new Sequence();

  DropWhileSequence.prototype.each = function each(fn) {
    var predicate = this.predicate,
        done      = false;

    return this.parent.each(function(e) {
      if (!done) {
        if (predicate(e)) {
          return;
        }

        done = true;
      }

      return fn(e);
    });
  };

  /**
   * Creates a new sequence with the same elements as this one, but ordered
   * using the specified comparison function.
   *
   * This has essentially the same behavior as calling
   * [`Array#sort`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/sort),
   * but obviously instead of modifying the collection it returns a new
   * {@link Sequence} object.
   *
   * @public
   * @param {Function=} sortFn The function used to compare elements in the
   *     sequence. The function will be passed two elements and should return:
   *     - 1 if the first is greater
   *     - -1 if the second is greater
   *     - 0 if the two values are the same
   * @param {boolean} descending Whether or not the resulting sequence should be
   *     in descending order (defaults to `false`).
   * @returns {Sequence} The new sequence.
   *
   * @examples
   * lazy([5, 10, 1]).sort()                // sequence: [1, 5, 10]
   * lazy(['foo', 'bar']).sort()            // sequence: ['bar', 'foo']
   * lazy(['b', 'c', 'a']).sort(null, true) // sequence: ['c', 'b', 'a']
   * lazy([5, 10, 1]).sort(null, true)      // sequence: [10, 5, 1]
   *
   * // Sorting w/ custom comparison function
   * lazy(['a', 'ab', 'aa', 'ba', 'b', 'abc']).sort(function compare(x, y) {
   *   if (x.length && (x.length !== y.length)) { return compare(x.length, y.length); }
   *   if (x === y) { return 0; }
   *   return x > y ? 1 : -1;
   * });
   * // => sequence: ['a', 'b', 'aa', 'ab', 'ba', 'abc']
   */
  Sequence.prototype.sort = function sort(sortFn, descending) {
    sortFn || (sortFn = compare);
    if (descending) { sortFn = reverseArguments(sortFn); }
    return new SortedSequence(this, sortFn);
  };

  /**
   * Creates a new sequence with the same elements as this one, but ordered by
   * the results of the given function.
   *
   * You can pass:
   *
   * - a *string*, to sort by the named property
   * - a function, to sort by the result of calling the function on each element
   *
   * @public
   * @param {Function} sortFn The function to call on the elements in this
   *     sequence, in order to sort them.
   * @param {boolean} descending Whether or not the resulting sequence should be
   *     in descending order (defaults to `false`).
   * @returns {Sequence} The new sequence.
   *
   * @examples
   * function population(country) {
   *   return country.pop;
   * }
   *
   * function area(country) {
   *   return country.sqkm;
   * }
   *
   * var countries = [
   *   { name: "USA", pop: 320000000, sqkm: 9600000 },
   *   { name: "Brazil", pop: 194000000, sqkm: 8500000 },
   *   { name: "Nigeria", pop: 174000000, sqkm: 924000 },
   *   { name: "China", pop: 1350000000, sqkm: 9700000 },
   *   { name: "Russia", pop: 143000000, sqkm: 17000000 },
   *   { name: "Australia", pop: 23000000, sqkm: 7700000 }
   * ];
   *
   * lazy(countries).sortBy(population).last(3).pluck('name') // sequence: ["Brazil", "USA", "China"]
   * lazy(countries).sortBy(area).last(3).pluck('name')       // sequence: ["USA", "China", "Russia"]
   * lazy(countries).sortBy(area, true).first(3).pluck('name') // sequence: ["Russia", "China", "USA"]
   *
   * @benchmarks
   * var randoms = lazy.generate(Math.random).take(100).toArray();
   *
   * lazy(randoms).sortBy(lazy.identity).each(lazy.noop) // lazy
   * _.each(_.sortBy(randoms, lazy.identity), _.noop)    // lodash
   */
  Sequence.prototype.sortBy = function sortBy(sortFn, descending) {
    sortFn = createComparator(sortFn);
    if (descending) { sortFn = reverseArguments(sortFn); }
    return new SortedSequence(this, sortFn);
  };

  /**
   * @constructor
   */
  function SortedSequence(parent, sortFn) {
    this.parent = parent;
    this.sortFn = sortFn;
  }

  SortedSequence.prototype = new Sequence();

  SortedSequence.prototype.each = function each(fn) {
    var sortFn = this.sortFn,
        result = this.parent.toArray();

    result.sort(sortFn);

    return forEach(result, fn);
  };

  /**
   * @examples
   * var items = [{ a: 4 }, { a: 3 }, { a: 5 }];
   *
   * lazy(items).sortBy('a').reverse();
   * // => sequence: [{ a: 5 }, { a: 4 }, { a: 3 }]
   *
   * lazy(items).sortBy('a').reverse().reverse();
   * // => sequence: [{ a: 3 }, { a: 4 }, { a: 5 }]
   */
  SortedSequence.prototype.reverse = function reverse() {
    return new SortedSequence(this.parent, reverseArguments(this.sortFn));
  };

  /**
   * Creates a new {@link ObjectLikeSequence} comprising the elements in this
   * one, grouped together according to some key. The value associated with each
   * key in the resulting object-like sequence is an array containing all of
   * the elements in this sequence with that key.
   *
   * @public
   * @param {Function|string} keyFn The function to call on the elements in this
   *     sequence to obtain a key by which to group them, or a string representing
   *     a parameter to read from all the elements in this sequence.
   * @returns {Sequence} The new sequence.
   *
   * @examples
   * function oddOrEven(x) {
   *   return x % 2 === 0 ? 'even' : 'odd';
   * }
   *
   * var numbers = [1, 2, 3, 4, 5];
   *
   * lazy(numbers).groupBy(oddOrEven)            // sequence: { odd: [1, 3, 5], even: [2, 4] }
   * lazy(numbers).groupBy(oddOrEven).get("odd") // => [1, 3, 5]
   * lazy(numbers).groupBy(oddOrEven).get("foo") // => undefined
   *
   * lazy([
   *   { name: 'toString' },
   *   { name: 'toString' }
   * ]).groupBy('name');
   * // => sequence: {
   *   'toString': [
   *     { name: 'toString' },
   *     { name: 'toString' }
   *   ]
   * }
   */
  Sequence.prototype.groupBy = function groupBy(keyFn) {
    return new GroupedSequence(this, keyFn);
  };

  /**
   * @constructor
   */
  function GroupedSequence(parent, keyFn) {
    this.parent = parent;
    this.keyFn  = keyFn;
  }

  // GroupedSequence must have its prototype set after ObjectLikeSequence has
  // been fully initialized.

  /**
   * Creates a new {@link ObjectLikeSequence} comprising the elements in this
   * one, indexed according to some key.
   *
   * @public
   * @param {Function|string} keyFn The function to call on the elements in this
   *     sequence to obtain a key by which to index them, or a string
   *     representing a property to read from all the elements in this sequence.
   * @returns {Sequence} The new sequence.
   *
   * @examples
   * var people = [
   *   { name: 'Bob', age: 25 },
   *   { name: 'Fred', age: 34 }
   * ];
   *
   * var bob  = people[0],
   *     fred = people[1];
   *
   * lazy(people).indexBy('name') // sequence: { 'Bob': bob, 'Fred': fred }
   */
  Sequence.prototype.indexBy = function(keyFn) {
    return new IndexedSequence(this, keyFn);
  };

  /**
   * @constructor
   */
  function IndexedSequence(parent, keyFn) {
    this.parent = parent;
    this.keyFn  = keyFn;
  }

  // IndexedSequence must have its prototype set after ObjectLikeSequence has
  // been fully initialized.

  /**
   * Creates a new {@link ObjectLikeSequence} containing the unique keys of all
   * the elements in this sequence, each paired with the number of elements
   * in this sequence having that key.
   *
   * @public
   * @param {Function|string} keyFn The function to call on the elements in this
   *     sequence to obtain a key by which to count them, or a string representing
   *     a parameter to read from all the elements in this sequence.
   * @returns {Sequence} The new sequence.
   *
   * @examples
   * function oddOrEven(x) {
   *   return x % 2 === 0 ? 'even' : 'odd';
   * }
   *
   * var numbers = [1, 2, 3, 4, 5];
   *
   * lazy(numbers).countBy(oddOrEven)            // sequence: { odd: 3, even: 2 }
   * lazy(numbers).countBy(oddOrEven).get("odd") // => 3
   * lazy(numbers).countBy(oddOrEven).get("foo") // => undefined
   */
  Sequence.prototype.countBy = function countBy(keyFn) {
    return new CountedSequence(this, keyFn);
  };

  /**
   * @constructor
   */
  function CountedSequence(parent, keyFn) {
    this.parent = parent;
    this.keyFn  = keyFn;
  }

  // CountedSequence, like GroupedSequence, must have its prototype set after
  // ObjectLikeSequence has been fully initialized.

  /**
   * Creates a new sequence with every unique element from this one appearing
   * exactly once (i.e., with duplicates removed).
   *
   * @public
   * @aka unique
   * @returns {Sequence} The new sequence.
   *
   * @examples
   * lazy([1, 2, 2, 3, 3, 3]).uniq() // sequence: [1, 2, 3]
   *
   * @benchmarks
   * function randomOf(array) {
   *   return function() {
   *     return array[Math.floor(Math.random() * array.length)];
   *   };
   * }
   *
   * var mostUnique = lazy.generate(randomOf(_.range(100)), 100).toArray(),
   *     someUnique = lazy.generate(randomOf(_.range(50)), 100).toArray(),
   *     mostDupes  = lazy.generate(randomOf(_.range(5)), 100).toArray();
   *
   * lazy(mostUnique).uniq().each(lazy.noop) // lazy - mostly unique elements
   * lazy(someUnique).uniq().each(lazy.noop) // lazy - some unique elements
   * lazy(mostDupes).uniq().each(lazy.noop)  // lazy - mostly duplicate elements
   * _.each(_.uniq(mostUnique), _.noop)      // lodash - mostly unique elements
   * _.each(_.uniq(someUnique), _.noop)      // lodash - some unique elements
   * _.each(_.uniq(mostDupes), _.noop)       // lodash - mostly duplicate elements
   */
  Sequence.prototype.uniq = function uniq(keyFn) {
    return new UniqueSequence(this, keyFn);
  };

  Sequence.prototype.unique = function unique(keyFn) {
    return this.uniq(keyFn);
  };

  /**
   * @constructor
   */
  function UniqueSequence(parent, keyFn) {
    this.parent = parent;
    this.keyFn  = keyFn;
  }

  UniqueSequence.prototype = new Sequence();

  UniqueSequence.prototype.each = function each(fn) {
    var cache = new Set(),
        keyFn = this.keyFn,
        i     = 0;

    if (keyFn) {
      keyFn = createCallback(keyFn);
      return this.parent.each(function(e) {
        if (cache.add(keyFn(e))) {
          return fn(e, i++);
        }
      });

    } else {
      return this.parent.each(function(e) {
        if (cache.add(e)) {
          return fn(e, i++);
        }
      });
    }
  };

  /**
   * Creates a new sequence by combining the elements from this sequence with
   * corresponding elements from the specified array(s).
   *
   * @public
   * @param {...Array} var_args One or more arrays of elements to combine with
   *     those of this sequence.
   * @returns {Sequence} The new sequence.
   *
   * @examples
   * lazy([1, 2]).zip([3, 4]) // sequence: [[1, 3], [2, 4]]
   *
   * @benchmarks
   * var smArrL = lazy.range(10).toArray(),
   *     smArrR = lazy.range(10, 20).toArray(),
   *     lgArrL = lazy.range(100).toArray(),
   *     lgArrR = lazy.range(100, 200).toArray();
   *
   * lazy(smArrL).zip(smArrR).each(lazy.noop) // lazy - zipping 10-element arrays
   * lazy(lgArrL).zip(lgArrR).each(lazy.noop) // lazy - zipping 100-element arrays
   * _.each(_.zip(smArrL, smArrR), _.noop)    // lodash - zipping 10-element arrays
   * _.each(_.zip(lgArrL, lgArrR), _.noop)    // lodash - zipping 100-element arrays
   */
  Sequence.prototype.zip = function zip(var_args) {
    if (arguments.length === 1) {
      return new SimpleZippedSequence(this, (/** @type {Array} */ var_args));
    } else {
      return new ZippedSequence(this, arraySlice.call(arguments, 0));
    }
  };

  /**
   * @constructor
   */
  function ZippedSequence(parent, arrays) {
    this.parent = parent;
    this.arrays = arrays;
  }

  ZippedSequence.prototype = new Sequence();

  ZippedSequence.prototype.each = function each(fn) {
    var arrays = this.arrays,
        i = 0;
    this.parent.each(function(e) {
      var group = [e];
      for (var j = 0; j < arrays.length; ++j) {
        if (arrays[j].length > i) {
          group.push(arrays[j][i]);
        }
      }
      return fn(group, i++);
    });
  };

  /**
   * Creates a new sequence with the same elements as this one, in a randomized
   * order.
   *
   * @public
   * @returns {Sequence} The new sequence.
   *
   * @examples
   * lazy([1, 2, 3, 4, 5]).shuffle().value() // =~ [1, 2, 3, 4, 5]
   */
  Sequence.prototype.shuffle = function shuffle() {
    return new ShuffledSequence(this);
  };

  /**
   * @constructor
   */
  function ShuffledSequence(parent) {
    this.parent = parent;
  }

  ShuffledSequence.prototype = new Sequence();

  ShuffledSequence.prototype.each = function each(fn) {
    var shuffled = this.parent.toArray(),
        floor = Math.floor,
        random = Math.random,
        j = 0;

    for (var i = shuffled.length - 1; i > 0; --i) {
      swap(shuffled, i, floor(random() * i) + 1);
      if (fn(shuffled[i], j++) === false) {
        return;
      }
    }
    fn(shuffled[0], j);
  };

  /**
   * Creates a new sequence with every element from this sequence, and with arrays
   * exploded so that a sequence of arrays (of arrays) becomes a flat sequence of
   * values.
   *
   * @public
   * @returns {Sequence} The new sequence.
   *
   * @examples
   * lazy([1, [2, 3], [4, [5]]]).flatten() // sequence: [1, 2, 3, 4, 5]
   * lazy([1, lazy([2, 3])]).flatten()     // sequence: [1, 2, 3]
   */
  Sequence.prototype.flatten = function flatten() {
    return new FlattenedSequence(this);
  };

  /**
   * @constructor
   */
  function FlattenedSequence(parent) {
    this.parent = parent;
  }

  FlattenedSequence.prototype = new Sequence();

  FlattenedSequence.prototype.each = function each(fn) {
    var index = 0;

    return this.parent.each(function recurseVisitor(e) {
      if (e instanceof Array) {
        return forEach(e, recurseVisitor);
      }

      if (e instanceof Sequence) {
        return e.each(recurseVisitor);
      }

      return fn(e, index++);
    });
  };

  /**
   * Creates a new sequence with the same elements as this one, except for all
   * falsy values (`false`, `0`, `""`, `null`, and `undefined`).
   *
   * @public
   * @returns {Sequence} The new sequence.
   *
   * @examples
   * lazy(["foo", null, "bar", undefined]).compact() // sequence: ["foo", "bar"]
   */
  Sequence.prototype.compact = function compact() {
    return this.filter(function(e) { return !!e; });
  };

  /**
   * Creates a new sequence with all the elements of this sequence that are not
   * also among the specified arguments.
   *
   * @public
   * @aka difference
   * @param {...*} var_args The values, or array(s) of values, to be excluded from the
   *     resulting sequence.
   * @returns {Sequence} The new sequence.
   *
   * @examples
   * lazy([1, 2, 3, 4, 5]).without(2, 3)   // sequence: [1, 4, 5]
   * lazy([1, 2, 3, 4, 5]).without([4, 5]) // sequence: [1, 2, 3]
   */
  Sequence.prototype.without = function without(var_args) {
    return new WithoutSequence(this, arraySlice.call(arguments, 0));
  };

  Sequence.prototype.difference = function difference(var_args) {
    return this.without.apply(this, arguments);
  };

  /**
   * @constructor
   */
  function WithoutSequence(parent, values) {
    this.parent = parent;
    this.values = values;
  }

  WithoutSequence.prototype = new Sequence();

  WithoutSequence.prototype.each = function each(fn) {
    var set = createSet(this.values),
        i = 0;
    return this.parent.each(function(e) {
      if (!set.contains(e)) {
        return fn(e, i++);
      }
    });
  };

  /**
   * Creates a new sequence with all the unique elements either in this sequence
   * or among the specified arguments.
   *
   * @public
   * @param {...*} var_args The values, or array(s) of values, to be additionally
   *     included in the resulting sequence.
   * @returns {Sequence} The new sequence.
   *
   * @examples
   * lazy(["foo", "bar"]).union([])             // sequence: ["foo", "bar"]
   * lazy(["foo", "bar"]).union(["bar", "baz"]) // sequence: ["foo", "bar", "baz"]
   */
  Sequence.prototype.union = function union(var_args) {
    return this.concat(var_args).uniq();
  };

  /**
   * Creates a new sequence with all the elements of this sequence that also
   * appear among the specified arguments.
   *
   * @public
   * @param {...*} var_args The values, or array(s) of values, in which elements
   *     from this sequence must also be included to end up in the resulting sequence.
   * @returns {Sequence} The new sequence.
   *
   * @examples
   * lazy(["foo", "bar"]).intersection([])             // sequence: []
   * lazy(["foo", "bar"]).intersection(["bar", "baz"]) // sequence: ["bar"]
   */
  Sequence.prototype.intersection = function intersection(var_args) {
    if (arguments.length === 1 && arguments[0] instanceof Array) {
      return new SimpleIntersectionSequence(this, (/** @type {Array} */ var_args));
    } else {
      return new IntersectionSequence(this, arraySlice.call(arguments, 0));
    }
  };

  /**
   * @constructor
   */
  function IntersectionSequence(parent, arrays) {
    this.parent = parent;
    this.arrays = arrays;
  }

  IntersectionSequence.prototype = new Sequence();

  IntersectionSequence.prototype.each = function each(fn) {
    var sets = lazy(this.arrays).map(function(values) {
      return new UniqueMemoizer(lazy(values).getIterator());
    });

    var setIterator = new UniqueMemoizer(sets.getIterator()),
        i = 0;

    return this.parent.each(function(e) {
      var includedInAll = true;
      setIterator.each(function(set) {
        if (!set.contains(e)) {
          includedInAll = false;
          return false;
        }
      });

      if (includedInAll) {
        return fn(e, i++);
      }
    });
  };

  /**
   * @constructor
   */
  function UniqueMemoizer(iterator) {
    this.iterator     = iterator;
    this.set          = new Set();
    this.memo         = [];
    this.currentValue = undefined;
  }

  UniqueMemoizer.prototype.current = function current() {
    return this.currentValue;
  };

  UniqueMemoizer.prototype.moveNext = function moveNext() {
    var iterator = this.iterator,
        set = this.set,
        memo = this.memo,
        current;

    while (iterator.moveNext()) {
      current = iterator.current();
      if (set.add(current)) {
        memo.push(current);
        this.currentValue = current;
        return true;
      }
    }
    return false;
  };

  UniqueMemoizer.prototype.each = function each(fn) {
    var memo = this.memo,
        length = memo.length,
        i = -1;

    while (++i < length) {
      if (fn(memo[i], i) === false) {
        return false;
      }
    }

    while (this.moveNext()) {
      if (fn(this.currentValue, i++) === false) {
        break;
      }
    }
  };

  UniqueMemoizer.prototype.contains = function contains(e) {
    if (this.set.contains(e)) {
      return true;
    }

    while (this.moveNext()) {
      if (this.currentValue === e) {
        return true;
      }
    }

    return false;
  };

  /**
   * Checks whether every element in this sequence satisfies a given predicate.
   *
   * @public
   * @aka all
   * @param {Function} predicate A function to call on (potentially) every element
   *     in this sequence.
   * @returns {boolean} True if `predicate` returns true for every element in the
   *     sequence (or the sequence is empty). False if `predicate` returns false
   *     for at least one element.
   *
   * @examples
   * var numbers = [1, 2, 3, 4, 5];
   *
   * var objects = [{ foo: true }, { foo: false, bar: true }];
   *
   * lazy(numbers).every(isEven)     // => false
   * lazy(numbers).every(isPositive) // => true
   * lazy(objects).all('foo')        // => false
   * lazy(objects).all('bar')        // => false
   */
  Sequence.prototype.every = function every(predicate) {
    predicate = createCallback(predicate);

    return this.each(function(e, i) {
      return !!predicate(e, i);
    });
  };

  Sequence.prototype.all = function all(predicate) {
    return this.every(predicate);
  };

  /**
   * Checks whether at least one element in this sequence satisfies a given
   * predicate (or, if no predicate is specified, whether the sequence contains at
   * least one element).
   *
   * @public
   * @aka any
   * @param {Function=} predicate A function to call on (potentially) every element
   *     in this sequence.
   * @returns {boolean} True if `predicate` returns true for at least one element
   *     in the sequence. False if `predicate` returns false for every element (or
   *     the sequence is empty).
   *
   * @examples
   * var numbers = [1, 2, 3, 4, 5];
   *
   * lazy(numbers).some()           // => true
   * lazy(numbers).some(isEven)     // => true
   * lazy(numbers).some(isNegative) // => false
   * lazy([]).some()                // => false
   */
  Sequence.prototype.some = function some(predicate) {
    predicate = createCallback(predicate, true);

    var success = false;
    this.each(function(e) {
      if (predicate(e)) {
        success = true;
        return false;
      }
    });
    return success;
  };

  Sequence.prototype.any = function any(predicate) {
    return this.some(predicate);
  };

  /**
   * Checks whether NO elements in this sequence satisfy the given predicate
   * (the opposite of {@link Sequence#all}, basically).
   *
   * @public
   * @param {Function=} predicate A function to call on (potentially) every element
   *     in this sequence.
   * @returns {boolean} True if `predicate` does not return true for any element
   *     in the sequence. False if `predicate` returns true for at least one
   *     element.
   *
   * @examples
   * var numbers = [1, 2, 3, 4, 5];
   *
   * lazy(numbers).none()           // => false
   * lazy(numbers).none(isEven)     // => false
   * lazy(numbers).none(isNegative) // => true
   * lazy([]).none(isEven)          // => true
   * lazy([]).none(isNegative)      // => true
   * lazy([]).none()                // => true
   */
  Sequence.prototype.none = function none(predicate) {
    return !this.any(predicate);
  };

  /**
   * Checks whether the sequence has no elements.
   *
   * @public
   * @returns {boolean} True if the sequence is empty, false if it contains at
   *     least one element.
   *
   * @examples
   * lazy([]).isEmpty()        // => true
   * lazy([1, 2, 3]).isEmpty() // => false
   */
  Sequence.prototype.isEmpty = function isEmpty() {
    return !this.any();
  };

  /**
   * Performs (at worst) a linear search from the head of this sequence,
   * returning the first index at which the specified value is found.
   *
   * @public
   * @param {*} value The element to search for in the sequence.
   * @returns {number} The index within this sequence where the given value is
   *     located, or -1 if the sequence doesn't contain the value.
   *
   * @examples
   * function reciprocal(x) { return 1 / x; }
   *
   * lazy(["foo", "bar", "baz"]).indexOf("bar")   // => 1
   * lazy([1, 2, 3]).indexOf(4)                   // => -1
   * lazy([1, 2, 3]).map(reciprocal).indexOf(0.5) // => 1
   */
  Sequence.prototype.indexOf = function indexOf(value) {
    var foundIndex = -1;
    this.each(function(e, i) {
      if (e === value) {
        foundIndex = i;
        return false;
      }
    });
    return foundIndex;
  };

  /**
   * Performs (at worst) a linear search from the tail of this sequence,
   * returning the last index at which the specified value is found.
   *
   * @public
   * @param {*} value The element to search for in the sequence.
   * @returns {number} The last index within this sequence where the given value
   *     is located, or -1 if the sequence doesn't contain the value.
   *
   * @examples
   * lazy(["a", "b", "c", "b", "a"]).lastIndexOf("b")    // => 3
   * lazy([1, 2, 3]).lastIndexOf(0)                      // => -1
   * lazy([2, 2, 1, 2, 4]).filter(isEven).lastIndexOf(2) // 2
   */
  Sequence.prototype.lastIndexOf = function lastIndexOf(value) {
    var index = this.reverse().indexOf(value);
    if (index !== -1) {
      index = this.getIndex().length() - index - 1;
    }
    return index;
  };

  /**
   * Performs a binary search of this sequence, returning the lowest index where
   * the given value is either found, or where it belongs (if it is not already
   * in the sequence).
   *
   * This method assumes the sequence is in sorted order and will fail otherwise.
   *
   * @public
   * @param {*} value The element to search for in the sequence.
   * @returns {number} An index within this sequence where the given value is
   *     located, or where it belongs in sorted order.
   *
   * @examples
   * lazy([1, 3, 6, 9]).sortedIndex(3)                    // => 1
   * lazy([1, 3, 6, 9]).sortedIndex(7)                    // => 3
   * lazy([5, 10, 15, 20]).filter(isEven).sortedIndex(10) // => 0
   * lazy([5, 10, 15, 20]).filter(isEven).sortedIndex(12) // => 1
   */
  Sequence.prototype.sortedIndex = function sortedIndex(value) {
    var indexed = this.getIndex(),
        lower   = 0,
        upper   = indexed.length(),
        i;

    while (lower < upper) {
      i = (lower + upper) >>> 1;
      if (compare(indexed.get(i), value) === -1) {
        lower = i + 1;
      } else {
        upper = i;
      }
    }
    return lower;
  };

  /**
   * Checks whether the given value is in this sequence.
   *
   * @public
   * @param {*} value The element to search for in the sequence.
   * @returns {boolean} True if the sequence contains the value, false if not.
   *
   * @examples
   * var numbers = [5, 10, 15, 20];
   *
   * lazy(numbers).contains(15) // => true
   * lazy(numbers).contains(13) // => false
   */
  Sequence.prototype.contains = function contains(value) {
    return this.indexOf(value) !== -1;
  };

  /**
   * Aggregates a sequence into a single value according to some accumulator
   * function.
   *
   * For an asynchronous sequence, instead of immediately returning a result
   * (which it can't, obviously), this method returns an {@link AsyncHandle}
   * whose `onComplete` method can be called to supply a callback to handle the
   * final result once iteration has completed.
   *
   * @public
   * @aka inject, foldl
   * @param {Function} aggregator The function through which to pass every element
   *     in the sequence. For every element, the function will be passed the total
   *     aggregated result thus far and the element itself, and should return a
   *     new aggregated result.
   * @param {*=} memo The starting value to use for the aggregated result
   *     (defaults to the first element in the sequence).
   * @returns {*} The result of the aggregation, or, for asynchronous sequences,
   *     an {@link AsyncHandle} whose `onComplete` method accepts a callback to
   *     handle the final result.
   *
   * @examples
   * function multiply(x, y) { return x * y; }
   *
   * var numbers = [1, 2, 3, 4];
   *
   * lazy(numbers).reduce(multiply)    // => 24
   * lazy(numbers).reduce(multiply, 5) // => 120
   */
  Sequence.prototype.reduce = function reduce(aggregator, memo) {
    if (arguments.length < 2) {
      return this.tail().reduce(aggregator, this.head());
    }

    var eachResult = this.each(function(e, i) {
      memo = aggregator(memo, e, i);
    });

    // TODO: Think of a way more efficient solution to this problem.
    if (eachResult instanceof AsyncHandle) {
      return eachResult.then(function() { return memo; });
    }

    return memo;
  };

  Sequence.prototype.inject =
  Sequence.prototype.foldl = function foldl(aggregator, memo) {
    return this.reduce(aggregator, memo);
  };

  /**
   * Aggregates a sequence, from the tail, into a single value according to some
   * accumulator function.
   *
   * @public
   * @aka foldr
   * @param {Function} aggregator The function through which to pass every element
   *     in the sequence. For every element, the function will be passed the total
   *     aggregated result thus far and the element itself, and should return a
   *     new aggregated result.
   * @param {*} memo The starting value to use for the aggregated result.
   * @returns {*} The result of the aggregation.
   *
   * @examples
   * function append(s1, s2) {
   *   return s1 + s2;
   * }
   *
   * function isVowel(str) {
   *   return "aeiou".indexOf(str) !== -1;
   * }
   *
   * lazy("abcde").reduceRight(append)                 // => "edcba"
   * lazy("abcde").filter(isVowel).reduceRight(append) // => "ea"
   */
  Sequence.prototype.reduceRight = function reduceRight(aggregator, memo) {
    if (arguments.length < 2) {
      return this.initial(1).reduceRight(aggregator, this.last());
    }

    // This bothers me... but frankly, calling reverse().reduce() is potentially
    // going to eagerly evaluate the sequence anyway; so it's really not an issue.
    var i = this.getIndex().length() - 1;
    return this.reverse().reduce(function(m, e) {
      return aggregator(m, e, i--);
    }, memo);
  };

  Sequence.prototype.foldr = function foldr(aggregator, memo) {
    return this.reduceRight(aggregator, memo);
  };

  /**
   * Groups this sequence into consecutive (overlapping) segments of a specified
   * length. If the underlying sequence has fewer elements than the specfied
   * length, then this sequence will be empty.
   *
   * @public
   * @param {number} length The length of each consecutive segment.
   * @returns {Sequence} The resulting sequence of consecutive segments.
   *
   * @examples
   * lazy([]).consecutive(2)        // => sequence: []
   * lazy([1]).consecutive(2)       // => sequence: []
   * lazy([1, 2]).consecutive(2)    // => sequence: [[1, 2]]
   * lazy([1, 2, 3]).consecutive(2) // => sequence: [[1, 2], [2, 3]]
   * lazy([1, 2, 3]).consecutive(0) // => sequence: [[]]
   * lazy([1, 2, 3]).consecutive(1) // => sequence: [[1], [2], [3]]
   */
  Sequence.prototype.consecutive = function consecutive(count) {
    var queue    = new Queue(count);
    var segments = this.map(function(element) {
      if (queue.add(element).count === count) {
        return queue.toArray();
      }
    });
    return segments.compact();
  };

  /**
   * Breaks this sequence into chunks (arrays) of a specified length.
   *
   * @public
   * @param {number} size The size of each chunk.
   * @returns {Sequence} The resulting sequence of chunks.
   *
   * @examples
   * lazy([]).chunk(2)        // sequence: []
   * lazy([1, 2, 3]).chunk(2) // sequence: [[1, 2], [3]]
   * lazy([1, 2, 3]).chunk(1) // sequence: [[1], [2], [3]]
   * lazy([1, 2, 3]).chunk(4) // sequence: [[1, 2, 3]]
   * lazy([1, 2, 3]).chunk(0) // throws
   */
  Sequence.prototype.chunk = function chunk(size) {
    if (size < 1) {
      throw new Error("You must specify a positive chunk size.");
    }

    return new ChunkedSequence(this, size);
  };

  /**
   * @constructor
   */
  function ChunkedSequence(parent, size) {
    this.parent    = parent;
    this.chunkSize = size;
  }

  ChunkedSequence.prototype = new Sequence();

  ChunkedSequence.prototype.getIterator = function getIterator() {
    return new ChunkedIterator(this.parent, this.chunkSize);
  };

  /**
   * @constructor
   */
  function ChunkedIterator(sequence, size) {
    this.iterator = sequence.getIterator();
    this.size     = size;
  }

  ChunkedIterator.prototype.current = function current() {
    return this.currentChunk;
  };

  ChunkedIterator.prototype.moveNext = function moveNext() {
    var iterator  = this.iterator,
        chunkSize = this.size,
        chunk     = [];

    while (chunk.length < chunkSize && iterator.moveNext()) {
      chunk.push(iterator.current());
    }

    if (chunk.length === 0) {
      return false;
    }

    this.currentChunk = chunk;
    return true;
  };

  /**
   * Passes each element in the sequence to the specified callback during
   * iteration. This is like {@link Sequence#each}, except that it can be
   * inserted anywhere in the middle of a chain of methods to "intercept" the
   * values in the sequence at that point.
   *
   * @public
   * @param {Function} callback A function to call on every element in the
   *     sequence during iteration. The return value of this function does not
   *     matter.
   * @returns {Sequence} A sequence comprising the same elements as this one.
   *
   * @examples
   * lazy([1, 2, 3]).tap(fn).each(lazy.noop); // calls fn 3 times
   */
  Sequence.prototype.tap = function tap(callback) {
    return new TappedSequence(this, callback);
  };

  /**
   * @constructor
   */
  function TappedSequence(parent, callback) {
    this.parent = parent;
    this.callback = callback;
  }

  TappedSequence.prototype = new Sequence();

  TappedSequence.prototype.each = function each(fn) {
    var callback = this.callback;
    return this.parent.each(function(e, i) {
      callback(e, i);
      return fn(e, i);
    });
  };

  /**
   * Seaches for the first element in the sequence satisfying a given predicate.
   *
   * @public
   * @aka detect
   * @param {Function} predicate A function to call on (potentially) every element
   *     in the sequence.
   * @returns {*} The first element in the sequence for which `predicate` returns
   *     `true`, or `undefined` if no such element is found.
   *
   * @examples
   * function divisibleBy3(x) {
   *   return x % 3 === 0;
   * }
   *
   * var numbers = [5, 6, 7, 8, 9, 10];
   *
   * lazy(numbers).find(divisibleBy3) // => 6
   * lazy(numbers).find(isNegative)   // => undefined
   */
  Sequence.prototype.find = function find(predicate) {
    return this.filter(predicate).first();
  };

  Sequence.prototype.detect = function detect(predicate) {
    return this.find(predicate);
  };

  /**
   * Gets the minimum value in the sequence.
   *
   * @public
   * @param {Function=} valueFn The function by which the value for comparison is
   *     calculated for each element in the sequence.
   * @returns {*} The element with the lowest value in the sequence, or
   *     `Infinity` if the sequence is empty.
   *
   * @examples
   * function negate(x) { return x * -1; }
   *
   * lazy([]).min()                       // => Infinity
   * lazy([6, 18, 2, 49, 34]).min()       // => 2
   * lazy([6, 18, 2, 49, 34]).min(negate) // => 49
   */
  Sequence.prototype.min = function min(valueFn) {
    if (typeof valueFn !== "undefined") {
      return this.minBy(valueFn);
    }

    return this.reduce(function(x, y) { return y < x ? y : x; }, Infinity);
  };

  Sequence.prototype.minBy = function minBy(valueFn) {
    valueFn = createCallback(valueFn);
    return this.reduce(function(x, y) { return valueFn(y) < valueFn(x) ? y : x; });
  };

  /**
   * Gets the maximum value in the sequence.
   *
   * @public
   * @param {Function=} valueFn The function by which the value for comparison is
   *     calculated for each element in the sequence.
   * @returns {*} The element with the highest value in the sequence, or
   *     `-Infinity` if the sequence is empty.
   *
   * @examples
   * function reverseDigits(x) {
   *   return Number(String(x).split('').reverse().join(''));
   * }
   *
   * lazy([]).max()                              // => -Infinity
   * lazy([6, 18, 2, 48, 29]).max()              // => 48
   * lazy([6, 18, 2, 48, 29]).max(reverseDigits) // => 29
   */
  Sequence.prototype.max = function max(valueFn) {
    if (typeof valueFn !== "undefined") {
      return this.maxBy(valueFn);
    }

    return this.reduce(function(x, y) { return y > x ? y : x; }, -Infinity);
  };

  Sequence.prototype.maxBy = function maxBy(valueFn) {
    valueFn = createCallback(valueFn);
    return this.reduce(function(x, y) { return valueFn(y) > valueFn(x) ? y : x; });
  };

  /**
   * Gets the sum of the values in the sequence.
   *
   * @public
   * @param {Function=} valueFn The function used to select the values that will
   *     be summed up.
   * @returns {*} The sum.
   *
   * @examples
   * lazy([]).sum()                     // => 0
   * lazy([1, 2, 3, 4]).sum()           // => 10
   * lazy([1.2, 3.4]).sum(Math.floor)   // => 4
   * lazy(['foo', 'bar']).sum('length') // => 6
   */
  Sequence.prototype.sum = function sum(valueFn) {
    if (typeof valueFn !== "undefined") {
      return this.sumBy(valueFn);
    }

    return this.reduce(function(x, y) { return x + y; }, 0);
  };

  Sequence.prototype.sumBy = function sumBy(valueFn) {
    valueFn = createCallback(valueFn);
    return this.reduce(function(x, y) { return x + valueFn(y); }, 0);
  };

  /**
   * Creates a string from joining together all of the elements in this sequence,
   * separated by the given delimiter.
   *
   * @public
   * @aka toString
   * @param {string=} delimiter The separator to insert between every element from
   *     this sequence in the resulting string (defaults to `","`).
   * @returns {string} The delimited string.
   *
   * @examples
   * lazy([6, 29, 1984]).join("/")  // => "6/29/1984"
   * lazy(["a", "b", "c"]).join()   // => "a,b,c"
   * lazy(["a", "b", "c"]).join("") // => "abc"
   * lazy([1, 2, 3]).join()         // => "1,2,3"
   * lazy([1, 2, 3]).join("")       // => "123"
   */
  Sequence.prototype.join = function join(delimiter) {
    delimiter = typeof delimiter === "string" ? delimiter : ",";

    return this.reduce(function(str, e) {
      if (str.length > 0) {
        str += delimiter;
      }
      return str + e;
    }, "");
  };

  Sequence.prototype.toString = function toString(delimiter) {
    return this.join(delimiter);
  };

  /**
   * Creates a sequence, with the same elements as this one, that will be iterated
   * over asynchronously when calling `each`.
   *
   * @public
   * @param {number=} interval The approximate period, in milliseconds, that
   *     should elapse between each element in the resulting sequence. Omitting
   *     this argument will result in the fastest possible asynchronous iteration.
   * @returns {AsyncSequence} The new asynchronous sequence.
   *
   * @examples
   * lazy([1, 2, 3]).async(100).each(fn) // calls fn 3 times asynchronously
   */
  Sequence.prototype.async = function async(interval) {
    return new AsyncSequence(this, interval);
  };

  /**
   * @constructor
   */
  function SimpleIntersectionSequence(parent, array) {
    this.parent = parent;
    this.array  = array;
    this.each   = getEachForIntersection(array);
  }

  SimpleIntersectionSequence.prototype = new Sequence();

  SimpleIntersectionSequence.prototype.eachMemoizerCache = function eachMemoizerCache(fn) {
    var iterator = new UniqueMemoizer(lazy(this.array).getIterator()),
        i = 0;

    return this.parent.each(function(e) {
      if (iterator.contains(e)) {
        return fn(e, i++);
      }
    });
  };

  SimpleIntersectionSequence.prototype.eachArrayCache = function eachArrayCache(fn) {
    var array = this.array,
        find  = arrayContains,
        i = 0;

    return this.parent.each(function(e) {
      if (find(array, e)) {
        return fn(e, i++);
      }
    });
  };

  function getEachForIntersection(source) {
    if (source.length < 40) {
      return SimpleIntersectionSequence.prototype.eachArrayCache;
    } else {
      return SimpleIntersectionSequence.prototype.eachMemoizerCache;
    }
  }

  /**
   * An optimized version of {@link ZippedSequence}, when zipping a sequence with
   * only one array.
   *
   * @param {Sequence} parent The underlying sequence.
   * @param {Array} array The array with which to zip the sequence.
   * @constructor
   */
  function SimpleZippedSequence(parent, array) {
    this.parent = parent;
    this.array  = array;
  }

  SimpleZippedSequence.prototype = new Sequence();

  SimpleZippedSequence.prototype.each = function each(fn) {
    var array = this.array;
    return this.parent.each(function(e, i) {
      return fn([e, array[i]], i);
    });
  };

  /**
   * An `ArrayLikeSequence` is a {@link Sequence} that provides random access to
   * its elements. This extends the API for iterating with the additional methods
   * {@link #get} and {@link #length}, allowing a sequence to act as a "view" into
   * a collection or other indexed data source.
   *
   * The initial sequence created by wrapping an array with `lazy(array)` is an
   * `ArrayLikeSequence`.
   *
   * All methods of `ArrayLikeSequence` that conceptually should return
   * something like a array (with indexed access) return another
   * `ArrayLikeSequence`, for example:
   *
   * - {@link Sequence#map}
   * - {@link ArrayLikeSequence#slice}
   * - {@link Sequence#take} and {@link Sequence#drop}
   * - {@link Sequence#reverse}
   *
   * The above is not an exhaustive list. There are also certain other cases
   * where it might be possible to return an `ArrayLikeSequence` (e.g., calling
   * {@link Sequence#concat} with a single array argument), but this is not
   * guaranteed by the API.
   *
   * Note that in many cases, it is not possible to provide indexed access
   * without first performing at least a partial iteration of the underlying
   * sequence. In these cases an `ArrayLikeSequence` will not be returned:
   *
   * - {@link Sequence#filter}
   * - {@link Sequence#uniq}
   * - {@link Sequence#union}
   * - {@link Sequence#intersect}
   *
   * etc. The above methods only return ordinary {@link Sequence} objects.
   *
   * Defining custom array-like sequences
   * ------------------------------------
   *
   * Creating a custom `ArrayLikeSequence` is essentially the same as creating a
   * custom {@link Sequence}. You just have a couple more methods you need to
   * implement: `get` and (optionally) `length`.
   *
   * Here's an example. Let's define a sequence type called `OffsetSequence` that
   * offsets each of its parent's elements by a set distance, and circles back to
   * the beginning after reaching the end. **Remember**: the initialization
   * function you pass to {@link #define} should always accept a `parent` as its
   * first parameter.
   *
   *     ArrayLikeSequence.define("offset", {
   *       init: function(parent, offset) {
   *         this.offset = offset;
   *       },
   *
   *       get: function(i) {
   *         return this.parent.get((i + this.offset) % this.parent.length());
   *       }
   *     });
   *
   * It's worth noting a couple of things here.
   *
   * First, lazy's default implementation of `length` simply returns the parent's
   * length. In this case, since an `OffsetSequence` will always have the same
   * number of elements as its parent, that implementation is fine; so we don't
   * need to override it.
   *
   * Second, the default implementation of `each` uses `get` and `length` to
   * essentially create a `for` loop, which is fine here. If you want to implement
   * `each` your own way, you can do that; but in most cases (as here), you can
   * probably just stick with the default.
   *
   * So we're already done, after only implementing `get`! Pretty easy, huh?
   *
   * Now the `offset` method will be chainable from any `ArrayLikeSequence`. So
   * for example:
   *
   *     lazy([1, 2, 3]).map(mapFn).offset(3);
   *
   * ...will work, but:
   *
   *     lazy([1, 2, 3]).filter(mapFn).offset(3);
   *
   * ...will not (because `filter` does not return an `ArrayLikeSequence`).
   *
   * (Also, as with the example provided for defining custom {@link Sequence}
   * types, this example really could have been implemented using a function
   * already available as part of lazy.js: in this case, {@link Sequence#map}.)
   *
   * @public
   * @constructor
   *
   * @examples
   * lazy([1, 2, 3])                    // instanceof lazy.ArrayLikeSequence
   * lazy([1, 2, 3]).map(lazy.identity) // instanceof lazy.ArrayLikeSequence
   * lazy([1, 2, 3]).take(2)            // instanceof lazy.ArrayLikeSequence
   * lazy([1, 2, 3]).drop(2)            // instanceof lazy.ArrayLikeSequence
   * lazy([1, 2, 3]).reverse()          // instanceof lazy.ArrayLikeSequence
   * lazy([1, 2, 3]).slice(1, 2)        // instanceof lazy.ArrayLikeSequence
   */
  function ArrayLikeSequence() {}

  ArrayLikeSequence.prototype = new Sequence();

  /**
   * Create a new constructor function for a type inheriting from
   * `ArrayLikeSequence`.
   *
   * @public
   * @param {string|Array.<string>} methodName The name(s) of the method(s) to be
   *     used for constructing the new sequence. The method will be attached to
   *     the `ArrayLikeSequence` prototype so that it can be chained with any other
   *     methods that return array-like sequences.
   * @param {Object} overrides An object containing function overrides for this
   *     new sequence type. **Must** include `get`. *May* include `init`,
   *     `length`, `getIterator`, and `each`. For each function, `this` will be
   *     the new sequence and `this.parent` will be the source sequence.
   * @returns {Function} A constructor for a new type inheriting from
   *     `ArrayLikeSequence`.
   *
   * @examples
   * lazy.ArrayLikeSequence.define("offset", {
   *   init: function(offset) {
   *     this.offset = offset;
   *   },
   *
   *   get: function(i) {
   *     return this.parent.get((i + this.offset) % this.parent.length());
   *   }
   * });
   *
   * lazy([1, 2, 3]).offset(1) // sequence: [2, 3, 1]
   */
  ArrayLikeSequence.define = function define(methodName, overrides) {
    if (!overrides || typeof overrides.get !== 'function') {
      throw new Error("A custom array-like sequence must implement *at least* get!");
    }

    return defineSequenceType(ArrayLikeSequence, methodName, overrides);
  };

  /**
   * Returns the element at the specified index.
   *
   * @public
   * @param {number} i The index to access.
   * @returns {*} The element.
   *
   * @examples
   * function increment(x) { return x + 1; }
   *
   * lazy([1, 2, 3]).get(1)                // => 2
   * lazy([1, 2, 3]).get(-1)               // => undefined
   * lazy([1, 2, 3]).map(increment).get(1) // => 3
   */
  ArrayLikeSequence.prototype.get = function get(i) {
    return this.parent.get(i);
  };

  /**
   * Returns the length of the sequence.
   *
   * @public
   * @returns {number} The length.
   *
   * @examples
   * function increment(x) { return x + 1; }
   *
   * lazy([]).length()                       // => 0
   * lazy([1, 2, 3]).length()                // => 3
   * lazy([1, 2, 3]).map(increment).length() // => 3
   */
  ArrayLikeSequence.prototype.length = function length() {
    return this.parent.length();
  };

  /**
   * Returns the current sequence (since it is already indexed).
   */
  ArrayLikeSequence.prototype.getIndex = function getIndex() {
    return this;
  };

  /**
   * An optimized version of {@link Sequence#getIterator}.
   */
  ArrayLikeSequence.prototype.getIterator = function getIterator() {
    return new IndexedIterator(this);
  };

  /**
   * An optimized version of {@link Iterator} meant to work with already-indexed
   * sequences.
   *
   * @param {ArrayLikeSequence} sequence The sequence to iterate over.
   * @constructor
   */
  function IndexedIterator(sequence) {
    this.sequence = sequence;
    this.index    = -1;
  }

  IndexedIterator.prototype.current = function current() {
    return this.sequence.get(this.index);
  };

  IndexedIterator.prototype.moveNext = function moveNext() {
    if (this.index >= this.sequence.length() - 1) {
      return false;
    }

    ++this.index;
    return true;
  };

  /**
   * An optimized version of {@link Sequence#each}.
   */
  ArrayLikeSequence.prototype.each = function each(fn) {
    var length = this.length(),
        i = -1;

    while (++i < length) {
      if (fn(this.get(i), i) === false) {
        return false;
      }
    }

    return true;
  };

  /**
   * Returns a new sequence with the same elements as this one, minus the last
   * element.
   *
   * @public
   * @returns {ArrayLikeSequence} The new array-like sequence.
   *
   * @examples
   * lazy([1, 2, 3]).pop() // sequence: [1, 2]
   * lazy([]).pop()        // sequence: []
   */
  ArrayLikeSequence.prototype.pop = function pop() {
    return this.initial();
  };

  /**
   * Returns a new sequence with the same elements as this one, minus the first
   * element.
   *
   * @public
   * @returns {ArrayLikeSequence} The new array-like sequence.
   *
   * @examples
   * lazy([1, 2, 3]).shift() // sequence: [2, 3]
   * lazy([]).shift()        // sequence: []
   */
  ArrayLikeSequence.prototype.shift = function shift() {
    return this.drop();
  };

  /**
   * Returns a new sequence comprising the portion of this sequence starting
   * from the specified starting index and continuing until the specified ending
   * index or to the end of the sequence.
   *
   * @public
   * @param {number} begin The index at which the new sequence should start.
   * @param {number=} end The index at which the new sequence should end.
   * @returns {ArrayLikeSequence} The new array-like sequence.
   *
   * @examples
   * lazy([1, 2, 3, 4, 5]).slice(0)     // sequence: [1, 2, 3, 4, 5]
   * lazy([1, 2, 3, 4, 5]).slice(2)     // sequence: [3, 4, 5]
   * lazy([1, 2, 3, 4, 5]).slice(2, 4)  // sequence: [3, 4]
   * lazy([1, 2, 3, 4, 5]).slice(-1)    // sequence: [5]
   * lazy([1, 2, 3, 4, 5]).slice(1, -1) // sequence: [2, 3, 4]
   * lazy([1, 2, 3, 4, 5]).slice(0, 10) // sequence: [1, 2, 3, 4, 5]
   */
  ArrayLikeSequence.prototype.slice = function slice(begin, end) {
    var length = this.length();

    if (begin < 0) {
      begin = length + begin;
    }

    var result = this.drop(begin);

    if (typeof end === "number") {
      if (end < 0) {
        end = length + end;
      }
      result = result.take(end - begin);
    }

    return result;
  };

  /**
   * An optimized version of {@link Sequence#map}, which creates an
   * {@link ArrayLikeSequence} so that the result still provides random access.
   *
   * @public
   *
   * @examples
   * lazy([1, 2, 3]).map(lazy.identity) // instanceof lazy.ArrayLikeSequence
   */
  ArrayLikeSequence.prototype.map = function map(mapFn) {
    return new IndexedMappedSequence(this, createCallback(mapFn));
  };

  /**
   * @constructor
   */
  function IndexedMappedSequence(parent, mapFn) {
    this.parent = parent;
    this.mapFn  = mapFn;
  }

  IndexedMappedSequence.prototype = new ArrayLikeSequence();

  IndexedMappedSequence.prototype.get = function get(i) {
    if (i < 0 || i >= this.parent.length()) {
      return undefined;
    }

    return this.mapFn(this.parent.get(i), i);
  };

  /**
   * An optimized version of {@link Sequence#filter}.
   */
  ArrayLikeSequence.prototype.filter = function filter(filterFn) {
    return new IndexedFilteredSequence(this, createCallback(filterFn));
  };

  /**
   * @constructor
   */
  function IndexedFilteredSequence(parent, filterFn) {
    this.parent   = parent;
    this.filterFn = filterFn;
  }

  IndexedFilteredSequence.prototype = new FilteredSequence();

  IndexedFilteredSequence.prototype.each = function each(fn) {
    var parent = this.parent,
        filterFn = this.filterFn,
        length = this.parent.length(),
        i = -1,
        j = 0,
        e;

    while (++i < length) {
      e = parent.get(i);
      if (filterFn(e, i) && fn(e, j++) === false) {
        return false;
      }
    }

    return true;
  };

  /**
   * An optimized version of {@link Sequence#reverse}, which creates an
   * {@link ArrayLikeSequence} so that the result still provides random access.
   *
   * @public
   *
   * @examples
   * lazy([1, 2, 3]).reverse() // instanceof lazy.ArrayLikeSequence
   */
  ArrayLikeSequence.prototype.reverse = function reverse() {
    return new IndexedReversedSequence(this);
  };

  /**
   * @constructor
   */
  function IndexedReversedSequence(parent) {
    this.parent = parent;
  }

  IndexedReversedSequence.prototype = new ArrayLikeSequence();

  IndexedReversedSequence.prototype.get = function get(i) {
    return this.parent.get(this.length() - i - 1);
  };

  /**
   * An optimized version of {@link Sequence#first}, which creates an
   * {@link ArrayLikeSequence} so that the result still provides random access.
   *
   * @public
   *
   * @examples
   * lazy([1, 2, 3]).first(2) // instanceof lazy.ArrayLikeSequence
   */
  ArrayLikeSequence.prototype.first = function first(count) {
    if (typeof count === "undefined") {
      return this.get(0);
    }

    return new IndexedTakeSequence(this, count);
  };

  /**
   * @constructor
   */
  function IndexedTakeSequence(parent, count) {
    this.parent = parent;
    this.count  = count;
  }

  IndexedTakeSequence.prototype = new ArrayLikeSequence();

  IndexedTakeSequence.prototype.length = function length() {
    var parentLength = this.parent.length();
    return this.count <= parentLength ? this.count : parentLength;
  };

  /**
   * An optimized version of {@link Sequence#rest}, which creates an
   * {@link ArrayLikeSequence} so that the result still provides random access.
   *
   * @public
   *
   * @examples
   * lazy([1, 2, 3]).rest() // instanceof lazy.ArrayLikeSequence
   */
  ArrayLikeSequence.prototype.rest = function rest(count) {
    return new IndexedDropSequence(this, count);
  };

  /**
   * @constructor
   */
  function IndexedDropSequence(parent, count) {
    this.parent = parent;
    this.count  = typeof count === "number" ? count : 1;
  }

  IndexedDropSequence.prototype = new ArrayLikeSequence();

  IndexedDropSequence.prototype.get = function get(i) {
    return this.parent.get(this.count + i);
  };

  IndexedDropSequence.prototype.length = function length() {
    var parentLength = this.parent.length();
    return this.count <= parentLength ? parentLength - this.count : 0;
  };

  /**
   * An optimized version of {@link Sequence#concat} that returns another
   * {@link ArrayLikeSequence} *if* the argument is an array.
   *
   * @public
   * @param {...*} var_args
   *
   * @examples
   * lazy([1, 2]).concat([3, 4]) // instanceof lazy.ArrayLikeSequence
   * lazy([1, 2]).concat([3, 4]) // sequence: [1, 2, 3, 4]
   */
  ArrayLikeSequence.prototype.concat = function concat(var_args) {
    if (arguments.length === 1 && arguments[0] instanceof Array) {
      return new IndexedConcatenatedSequence(this, (/** @type {Array} */ var_args));
    } else {
      return Sequence.prototype.concat.apply(this, arguments);
    }
  };

  /**
   * @constructor
   */
  function IndexedConcatenatedSequence(parent, other) {
    this.parent = parent;
    this.other  = other;
  }

  IndexedConcatenatedSequence.prototype = new ArrayLikeSequence();

  IndexedConcatenatedSequence.prototype.get = function get(i) {
    var parentLength = this.parent.length();
    if (i < parentLength) {
      return this.parent.get(i);
    } else {
      return this.other[i - parentLength];
    }
  };

  IndexedConcatenatedSequence.prototype.length = function length() {
    return this.parent.length() + this.other.length;
  };

  /**
   * An optimized version of {@link Sequence#uniq}.
   */
  ArrayLikeSequence.prototype.uniq = function uniq(keyFn) {
    return new IndexedUniqueSequence(this, createCallback(keyFn));
  };

  /**
   * @param {ArrayLikeSequence} parent
   * @constructor
   */
  function IndexedUniqueSequence(parent, keyFn) {
    this.parent = parent;
    this.each   = getEachForParent(parent);
    this.keyFn  = keyFn;
  }

  IndexedUniqueSequence.prototype = new Sequence();

  IndexedUniqueSequence.prototype.eachArrayCache = function eachArrayCache(fn) {
    // Basically the same implementation as w/ the set, but using an array because
    // it's cheaper for smaller sequences.
    var parent = this.parent,
        keyFn  = this.keyFn,
        length = parent.length(),
        cache  = [],
        find   = arrayContains,
        key, value,
        i = -1,
        j = 0;

    while (++i < length) {
      value = parent.get(i);
      key = keyFn(value);
      if (!find(cache, key)) {
        cache.push(key);
        if (fn(value, j++) === false) {
          return false;
        }
      }
    }
  };

  IndexedUniqueSequence.prototype.eachSetCache = UniqueSequence.prototype.each;

  function getEachForParent(parent) {
    if (parent.length() < 100) {
      return IndexedUniqueSequence.prototype.eachArrayCache;
    } else {
      return UniqueSequence.prototype.each;
    }
  }

  // Now that we've fully initialized the ArrayLikeSequence prototype, we can
  // set the prototype for MemoizedSequence.

  MemoizedSequence.prototype = new ArrayLikeSequence();

  MemoizedSequence.prototype.cache = function cache() {
    return this.cachedResult || (this.cachedResult = this.parent.toArray());
  };

  MemoizedSequence.prototype.get = function get(i) {
    return this.cache()[i];
  };

  MemoizedSequence.prototype.length = function length() {
    return this.cache().length;
  };

  MemoizedSequence.prototype.slice = function slice(begin, end) {
    return this.cache().slice(begin, end);
  };

  MemoizedSequence.prototype.toArray = function toArray() {
    return this.cache().slice(0);
  };

  /**
   * ArrayWrapper is the most basic {@link Sequence}. It directly wraps an array
   * and implements the same methods as {@link ArrayLikeSequence}, but more
   * efficiently.
   *
   * @constructor
   */
  function ArrayWrapper(source) {
    this.source = source;
  }

  ArrayWrapper.prototype = new ArrayLikeSequence();

  ArrayWrapper.prototype.root = function root() {
    return this;
  };

  ArrayWrapper.prototype.isAsync = function isAsync() {
    return false;
  };

  /**
   * Returns the element at the specified index in the source array.
   *
   * @param {number} i The index to access.
   * @returns {*} The element.
   */
  ArrayWrapper.prototype.get = function get(i) {
    return this.source[i];
  };

  /**
   * Returns the length of the source array.
   *
   * @returns {number} The length.
   */
  ArrayWrapper.prototype.length = function length() {
    return this.source.length;
  };

  /**
   * An optimized version of {@link Sequence#each}.
   */
  ArrayWrapper.prototype.each = function each(fn) {
    return forEach(this.source, fn);
  };

  /**
   * An optimized version of {@link Sequence#map}.
   */
  ArrayWrapper.prototype.map = function map(mapFn) {
    return new MappedArrayWrapper(this, createCallback(mapFn));
  };

  /**
   * An optimized version of {@link Sequence#filter}.
   */
  ArrayWrapper.prototype.filter = function filter(filterFn) {
    return new FilteredArrayWrapper(this, createCallback(filterFn));
  };

  /**
   * An optimized version of {@link Sequence#uniq}.
   */
  ArrayWrapper.prototype.uniq = function uniq(keyFn) {
    return new UniqueArrayWrapper(this, keyFn);
  };

  /**
   * An optimized version of {@link ArrayLikeSequence#concat}.
   *
   * @param {...*} var_args
   */
  ArrayWrapper.prototype.concat = function concat(var_args) {
    if (arguments.length === 1 && arguments[0] instanceof Array) {
      return new ConcatArrayWrapper(this, (/** @type {Array} */ var_args));
    } else {
      return ArrayLikeSequence.prototype.concat.apply(this, arguments);
    }
  };

  /**
   * An optimized version of {@link Sequence#toArray}.
   */
  ArrayWrapper.prototype.toArray = function toArray() {
    return this.source.slice(0);
  };

  /**
   * @constructor
   */
  function MappedArrayWrapper(parent, mapFn) {
    this.parent = parent;
    this.mapFn  = mapFn;
  }

  MappedArrayWrapper.prototype = new ArrayLikeSequence();

  MappedArrayWrapper.prototype.get = function get(i) {
    var source = this.parent.source;

    if (i < 0 || i >= source.length) {
      return undefined;
    }

    return this.mapFn(source[i]);
  };

  MappedArrayWrapper.prototype.length = function length() {
    return this.parent.source.length;
  };

  MappedArrayWrapper.prototype.each = function each(fn) {
    var source = this.parent.source,
        length = source.length,
        mapFn  = this.mapFn,
        i = -1;

    while (++i < length) {
      if (fn(mapFn(source[i], i), i) === false) {
        return false;
      }
    }

    return true;
  };

  /**
   * @constructor
   */
  function FilteredArrayWrapper(parent, filterFn) {
    this.parent   = parent;
    this.filterFn = filterFn;
  }

  FilteredArrayWrapper.prototype = new FilteredSequence();

  FilteredArrayWrapper.prototype.each = function each(fn) {
    var source = this.parent.source,
        filterFn = this.filterFn,
        length = source.length,
        i = -1,
        j = 0,
        e;

    while (++i < length) {
      e = source[i];
      if (filterFn(e, i) && fn(e, j++) === false) {
        return false;
      }
    }

    return true;
  };

  /**
   * @constructor
   */
  function UniqueArrayWrapper(parent, keyFn) {
    this.parent = parent;
    this.each   = getEachForSource(parent.source);
    this.keyFn  = keyFn;
  }

  UniqueArrayWrapper.prototype = new Sequence();

  UniqueArrayWrapper.prototype.eachNoCache = function eachNoCache(fn) {
    var source = this.parent.source,
        keyFn  = this.keyFn,
        length = source.length,
        find   = arrayContainsBefore,
        value,

        // Yes, this is hideous.
        // Trying to get performance first, will refactor next!
        i = -1,
        k = 0;

    while (++i < length) {
      value = source[i];
      if (!find(source, value, i, keyFn) && fn(value, k++) === false) {
        return false;
      }
    }

    return true;
  };

  UniqueArrayWrapper.prototype.eachArrayCache = function eachArrayCache(fn) {
    // Basically the same implementation as w/ the set, but using an array because
    // it's cheaper for smaller sequences.
    var source = this.parent.source,
        keyFn  = this.keyFn,
        length = source.length,
        cache  = [],
        find   = arrayContains,
        key, value,
        i = -1,
        j = 0;

    if (keyFn) {
      keyFn = createCallback(keyFn);
      while (++i < length) {
        value = source[i];
        key = keyFn(value);
        if (!find(cache, key)) {
          cache.push(key);
          if (fn(value, j++) === false) {
            return false;
          }
        }
      }

    } else {
      while (++i < length) {
        value = source[i];
        if (!find(cache, value)) {
          cache.push(value);
          if (fn(value, j++) === false) {
            return false;
          }
        }
      }
    }

    return true;
  };

  UniqueArrayWrapper.prototype.eachSetCache = UniqueSequence.prototype.each;

  /**
   * My latest findings here...
   *
   * So I hadn't really given the set-based approach enough credit. The main issue
   * was that my Set implementation was totally not optimized at all. After pretty
   * heavily optimizing it (just take a look; it's a monstrosity now!), it now
   * becomes the fastest option for much smaller values of N.
   */
  function getEachForSource(source) {
    if (source.length < 40) {
      return UniqueArrayWrapper.prototype.eachNoCache;
    } else if (source.length < 100) {
      return UniqueArrayWrapper.prototype.eachArrayCache;
    } else {
      return UniqueArrayWrapper.prototype.eachSetCache;
    }
  }

  /**
   * @constructor
   */
  function ConcatArrayWrapper(parent, other) {
    this.parent = parent;
    this.other  = other;
  }

  ConcatArrayWrapper.prototype = new ArrayLikeSequence();

  ConcatArrayWrapper.prototype.get = function get(i) {
    var source = this.parent.source,
        sourceLength = source.length;

    if (i < sourceLength) {
      return source[i];
    } else {
      return this.other[i - sourceLength];
    }
  };

  ConcatArrayWrapper.prototype.length = function length() {
    return this.parent.source.length + this.other.length;
  };

  ConcatArrayWrapper.prototype.each = function each(fn) {
    var source = this.parent.source,
        sourceLength = source.length,
        other = this.other,
        otherLength = other.length,
        i = 0,
        j = -1;

    while (++j < sourceLength) {
      if (fn(source[j], i++) === false) {
        return false;
      }
    }

    j = -1;
    while (++j < otherLength) {
      if (fn(other[j], i++) === false) {
        return false;
      }
    }

    return true;
  };

  /**
   * An `ObjectLikeSequence` object represents a sequence of key/value pairs.
   *
   * The initial sequence you get by wrapping an object with `lazy(object)` is
   * an `ObjectLikeSequence`.
   *
   * All methods of `ObjectLikeSequence` that conceptually should return
   * something like an object return another `ObjectLikeSequence`.
   *
   * @public
   * @constructor
   *
   * @examples
   * var obj = { foo: 'bar' };
   *
   * lazy(obj).assign({ bar: 'baz' })   // instanceof lazy.ObjectLikeSequence
   * lazy(obj).defaults({ bar: 'baz' }) // instanceof lazy.ObjectLikeSequence
   * lazy(obj).invert()                 // instanceof lazy.ObjectLikeSequence
   */
  function ObjectLikeSequence() {}

  ObjectLikeSequence.prototype = new Sequence();

  /**
   * Create a new constructor function for a type inheriting from
   * `ObjectLikeSequence`.
   *
   * @public
   * @param {string|Array.<string>} methodName The name(s) of the method(s) to be
   *     used for constructing the new sequence. The method will be attached to
   *     the `ObjectLikeSequence` prototype so that it can be chained with any other
   *     methods that return object-like sequences.
   * @param {Object} overrides An object containing function overrides for this
   *     new sequence type. **Must** include `each`. *May* include `init` and
   *     `get` (for looking up an element by key).
   * @returns {Function} A constructor for a new type inheriting from
   *     `ObjectLikeSequence`.
   *
   * @examples
   * function downcaseKey(value, key) {
   *   return [key.toLowerCase(), value];
   * }
   *
   * lazy.ObjectLikeSequence.define("caseInsensitive", {
   *   init: function() {
   *     var downcased = this.parent
   *       .map(downcaseKey)
   *       .toObject();
   *     this.downcased = lazy(downcased);
   *   },
   *
   *   get: function(key) {
   *     return this.downcased.get(key.toLowerCase());
   *   },
   *
   *   each: function(fn) {
   *     return this.downcased.each(fn);
   *   }
   * });
   *
   * lazy({ Foo: 'bar' }).caseInsensitive()            // sequence: { foo: 'bar' }
   * lazy({ FOO: 'bar' }).caseInsensitive().get('foo') // => 'bar'
   * lazy({ FOO: 'bar' }).caseInsensitive().get('FOO') // => 'bar'
   */
  ObjectLikeSequence.define = function define(methodName, overrides) {
    if (!overrides || typeof overrides.each !== 'function') {
      throw new Error("A custom object-like sequence must implement *at least* each!");
    }

    return defineSequenceType(ObjectLikeSequence, methodName, overrides);
  };

  ObjectLikeSequence.prototype.value = function value() {
    return this.toObject();
  };

  /**
   * Gets the element at the specified key in this sequence.
   *
   * @public
   * @param {string} key The key.
   * @returns {*} The element.
   *
   * @examples
   * lazy({ foo: "bar" }).get("foo")                          // => "bar"
   * lazy({ foo: "bar" }).extend({ foo: "baz" }).get("foo")   // => "baz"
   * lazy({ foo: "bar" }).defaults({ bar: "baz" }).get("bar") // => "baz"
   * lazy({ foo: "bar" }).invert().get("bar")                 // => "foo"
   * lazy({ foo: 1, bar: 2 }).pick(["foo"]).get("foo")        // => 1
   * lazy({ foo: 1, bar: 2 }).pick(["foo"]).get("bar")        // => undefined
   * lazy({ foo: 1, bar: 2 }).omit(["foo"]).get("bar")        // => 2
   * lazy({ foo: 1, bar: 2 }).omit(["foo"]).get("foo")        // => undefined
   */
  ObjectLikeSequence.prototype.get = function get(key) {
    var pair = this.pairs().find(function(pair) {
      return pair[0] === key;
    });

    return pair ? pair[1] : undefined;
  };

  /**
   * Returns a {@link Sequence} whose elements are the keys of this object-like
   * sequence.
   *
   * @public
   * @returns {Sequence} The sequence based on this sequence's keys.
   *
   * @examples
   * lazy({ hello: "hola", goodbye: "hasta luego" }).keys() // sequence: ["hello", "goodbye"]
   */
  ObjectLikeSequence.prototype.keys = function keys() {
    return this.map(function(v, k) { return k; });
  };

  /**
   * Returns a {@link Sequence} whose elements are the values of this object-like
   * sequence.
   *
   * @public
   * @returns {Sequence} The sequence based on this sequence's values.
   *
   * @examples
   * lazy({ hello: "hola", goodbye: "hasta luego" }).values() // sequence: ["hola", "hasta luego"]
   */
  ObjectLikeSequence.prototype.values = function values() {
    return this.map(function(v, k) { return v; });
  };

  /**
   * Throws an exception. Asynchronous iteration over object-like sequences is
   * not supported.
   *
   * @public
   * @examples
   * lazy({ foo: 'bar' }).async() // throws
   */
  ObjectLikeSequence.prototype.async = function async() {
    throw new Error('An ObjectLikeSequence does not support asynchronous iteration.');
  };

  /**
   * Returns this same sequence. (Reversing an object-like sequence doesn't make
   * any sense.)
   */
  ObjectLikeSequence.prototype.reverse = function reverse() {
    return this;
  };

  /**
   * Returns an {@link ObjectLikeSequence} whose elements are the combination of
   * this sequence and another object. In the case of a key appearing in both this
   * sequence and the given object, the other object's value will override the
   * one in this sequence.
   *
   * @public
   * @aka extend
   * @param {Object} other The other object to assign to this sequence.
   * @returns {ObjectLikeSequence} A new sequence comprising elements from this
   *     sequence plus the contents of `other`.
   *
   * @examples
   * lazy({ "uno": 1, "dos": 2 }).assign({ "tres": 3 }) // sequence: { uno: 1, dos: 2, tres: 3 }
   * lazy({ foo: "bar" }).assign({ foo: "baz" });       // sequence: { foo: "baz" }
   */
  ObjectLikeSequence.prototype.assign = function assign(other) {
    return new AssignSequence(this, other);
  };

  ObjectLikeSequence.prototype.extend = function extend(other) {
    return this.assign(other);
  };

  /**
   * @constructor
   */
  function AssignSequence(parent, other) {
    this.parent = parent;
    this.other  = other;
  }

  AssignSequence.prototype = new ObjectLikeSequence();

  AssignSequence.prototype.get = function get(key) {
    return this.other[key] || this.parent.get(key);
  };

  AssignSequence.prototype.each = function each(fn) {
    var merged = new Set(),
        done   = false;

    lazy(this.other).each(function(value, key) {
      if (fn(value, key) === false) {
        done = true;
        return false;
      }

      merged.add(key);
    });

    if (!done) {
      return this.parent.each(function(value, key) {
        if (!merged.contains(key) && fn(value, key) === false) {
          return false;
        }
      });
    }
  };

  /**
   * Returns an {@link ObjectLikeSequence} whose elements are the combination of
   * this sequence and a 'default' object. In the case of a key appearing in both
   * this sequence and the given object, this sequence's value will override the
   * default object's.
   *
   * @public
   * @param {Object} defaults The 'default' object to use for missing keys in this
   *     sequence.
   * @returns {ObjectLikeSequence} A new sequence comprising elements from this
   *     sequence supplemented by the contents of `defaults`.
   *
   * @examples
   * lazy({ name: "Dan" }).defaults({ name: "User", password: "passw0rd" }) // sequence: { name: "Dan", password: "passw0rd" }
   */
  ObjectLikeSequence.prototype.defaults = function defaults(defaults) {
    return new DefaultsSequence(this, defaults);
  };

  /**
   * @constructor
   */
  function DefaultsSequence(parent, defaults) {
    this.parent   = parent;
    this.defaults = defaults;
  }

  DefaultsSequence.prototype = new ObjectLikeSequence();

  DefaultsSequence.prototype.get = function get(key) {
    return this.parent.get(key) || this.defaults[key];
  };

  DefaultsSequence.prototype.each = function each(fn) {
    var merged = new Set(),
        done   = false;

    this.parent.each(function(value, key) {
      if (fn(value, key) === false) {
        done = true;
        return false;
      }

      if (typeof value !== "undefined") {
        merged.add(key);
      }
    });

    if (!done) {
      lazy(this.defaults).each(function(value, key) {
        if (!merged.contains(key) && fn(value, key) === false) {
          return false;
        }
      });
    }
  };

  /**
   * Returns an {@link ObjectLikeSequence} whose values are this sequence's keys,
   * and whose keys are this sequence's values.
   *
   * @public
   * @returns {ObjectLikeSequence} A new sequence comprising the inverted keys and
   *     values from this sequence.
   *
   * @examples
   * lazy({ first: "Dan", last: "Tao" }).invert() // sequence: { Dan: "first", Tao: "last" }
   */
  ObjectLikeSequence.prototype.invert = function invert() {
    return new InvertedSequence(this);
  };

  /**
   * @constructor
   */
  function InvertedSequence(parent) {
    this.parent = parent;
  }

  InvertedSequence.prototype = new ObjectLikeSequence();

  InvertedSequence.prototype.each = function each(fn) {
    this.parent.each(function(value, key) {
      return fn(key, value);
    });
  };

  /**
   * Produces an {@link ObjectLikeSequence} consisting of all the recursively
   * merged values from this and the given object(s) or sequence(s).
   *
   * @public
   * @param {...Object|ObjectLikeSequence} others The other object(s) or
   *     sequence(s) whose values will be merged into this one.
   * @param {Function=} mergeFn An optional function used to customize merging
   *     behavior.
   * @returns {ObjectLikeSequence} The new sequence consisting of merged values.
   *
   * @examples
   * // These examples are completely stolen from Lo-Dash's documentation:
   * // lodash.com/docs#merge
   *
   * var names = {
   *   'characters': [
   *     { 'name': 'barney' },
   *     { 'name': 'fred' }
   *   ]
   * };
   *
   * var ages = {
   *   'characters': [
   *     { 'age': 36 },
   *     { 'age': 40 }
   *   ]
   * };
   *
   * var food = {
   *   'fruits': ['apple'],
   *   'vegetables': ['beet']
   * };
   *
   * var otherFood = {
   *   'fruits': ['banana'],
   *   'vegetables': ['carrot']
   * };
   *
   * function mergeArrays(a, b) {
   *   return Array.isArray(a) ? a.concat(b) : undefined;
   * }
   *
   * lazy(names).merge(ages); // => sequence: { 'characters': [{ 'name': 'barney', 'age': 36 }, { 'name': 'fred', 'age': 40 }] }
   * lazy(food).merge(otherFood, mergeArrays); // => sequence: { 'fruits': ['apple', 'banana'], 'vegetables': ['beet', 'carrot'] }
   *
   * // ----- Now for my own tests: -----
   *
   * // merges objects
   * lazy({ foo: 1 }).merge({ foo: 2 }); // => sequence: { foo: 2 }
   * lazy({ foo: 1 }).merge({ bar: 2 }); // => sequence: { foo: 1, bar: 2 }
   *
   * // goes deep
   * lazy({ foo: { bar: 1 } }).merge({ foo: { bar: 2 } }); // => sequence: { foo: { bar: 2 } }
   * lazy({ foo: { bar: 1 } }).merge({ foo: { baz: 2 } }); // => sequence: { foo: { bar: 1, baz: 2 } }
   * lazy({ foo: { bar: 1 } }).merge({ foo: { baz: 2 } }); // => sequence: { foo: { bar: 1, baz: 2 } }
   *
   * // gives precedence to later sources
   * lazy({ foo: 1 }).merge({ bar: 2 }, { bar: 3 }); // => sequence: { foo: 1, bar: 3 }
   *
   * // undefined gets passed over
   * lazy({ foo: 1 }).merge({ foo: undefined }); // => sequence: { foo: 1 }
   *
   * // null doesn't get passed over
   * lazy({ foo: 1 }).merge({ foo: null }); // => sequence: { foo: null }
   *
   * // array contents get merged as well
   * lazy({ foo: [{ bar: 1 }] }).merge({ foo: [{ baz: 2 }] }); // => sequence: { foo: [{ bar: 1, baz: 2}] }
   */
  ObjectLikeSequence.prototype.merge = function merge(var_args) {
    var mergeFn = arguments.length > 1 && typeof arguments[arguments.length - 1] === "function" ?
      arrayPop.call(arguments) : null;
    return new MergedSequence(this, arraySlice.call(arguments, 0), mergeFn);
  };

  /**
   * @constructor
   */
  function MergedSequence(parent, others, mergeFn) {
    this.parent  = parent;
    this.others  = others;
    this.mergeFn = mergeFn;
  }

  MergedSequence.prototype = new ObjectLikeSequence();

  MergedSequence.prototype.each = function each(fn) {
    var others  = this.others,
        mergeFn = this.mergeFn || mergeObjects,
        keys    = {};

    var iteratedFullSource = this.parent.each(function(value, key) {
      var merged = value;

      forEach(others, function(other) {
        if (key in other) {
          merged = mergeFn(merged, other[key]);
        }
      });

      keys[key] = true;

      return fn(merged, key);
    });

    if (iteratedFullSource === false) {
      return false;
    }

    var remaining = {};

    forEach(others, function(other) {
      for (var k in other) {
        if (!keys[k]) {
          remaining[k] = mergeFn(remaining[k], other[k]);
        }
      }
    });

    return lazy(remaining).each(fn);
  };

  /**
   * @private
   * @examples
   * mergeObjects({ foo: 1 }, { bar: 2 }); // => { foo: 1, bar: 2 }
   * mergeObjects({ foo: { bar: 1 } }, { foo: { baz: 2 } }); // => { foo: { bar: 1, baz: 2 } }
   * mergeObjects({ foo: { bar: 1 } }, { foo: undefined }); // => { foo: { bar: 1 } }
   * mergeObjects({ foo: { bar: 1 } }, { foo: null }); // => { foo: null }
   */
  function mergeObjects(a, b) {
    if (typeof b === 'undefined') {
      return a;
    }

    // Unless we're dealing with two objects, there's no merging to do --
    // just replace a w/ b.
    if (typeof a !== 'object' || a === null || typeof b !== 'object' || b === null) {
      return b;
    }

    var merged = {}, prop;
    for (prop in a) {
      merged[prop] = mergeObjects(a[prop], b[prop]);
    }
    for (prop in b) {
      if (!merged[prop]) {
        merged[prop] = b[prop];
      }
    }
    return merged;
  }

  /**
   * Creates a {@link Sequence} consisting of the keys from this sequence whose
   *     values are functions.
   *
   * @public
   * @aka methods
   * @returns {Sequence} The new sequence.
   *
   * @examples
   * var dog = {
   *   name: "Fido",
   *   breed: "Golden Retriever",
   *   bark: function() { console.log("Woof!"); },
   *   wagTail: function() { console.log("TODO: implement robotic dog interface"); }
   * };
   *
   * lazy(dog).functions() // sequence: ["bark", "wagTail"]
   */
  ObjectLikeSequence.prototype.functions = function functions() {
    return this
      .filter(function(v, k) { return typeof(v) === "function"; })
      .map(function(v, k) { return k; });
  };

  ObjectLikeSequence.prototype.methods = function methods() {
    return this.functions();
  };

  /**
   * Creates an {@link ObjectLikeSequence} consisting of the key/value pairs from
   * this sequence whose keys are included in the given array of property names.
   *
   * @public
   * @param {Array} properties An array of the properties to "pick" from this
   *     sequence.
   * @returns {ObjectLikeSequence} The new sequence.
   *
   * @examples
   * var players = {
   *   "who": "first",
   *   "what": "second",
   *   "i don't know": "third"
   * };
   *
   * lazy(players).pick(["who", "what"]) // sequence: { who: "first", what: "second" }
   */
  ObjectLikeSequence.prototype.pick = function pick(properties) {
    return new PickSequence(this, properties);
  };

  /**
   * @constructor
   */
  function PickSequence(parent, properties) {
    this.parent     = parent;
    this.properties = properties;
  }

  PickSequence.prototype = new ObjectLikeSequence();

  PickSequence.prototype.get = function get(key) {
    return arrayContains(this.properties, key) ? this.parent.get(key) : undefined;
  };

  PickSequence.prototype.each = function each(fn) {
    var inArray    = arrayContains,
        properties = this.properties;

    return this.parent.each(function(value, key) {
      if (inArray(properties, key)) {
        return fn(value, key);
      }
    });
  };

  /**
   * Creates an {@link ObjectLikeSequence} consisting of the key/value pairs from
   * this sequence excluding those with the specified keys.
   *
   * @public
   * @param {Array} properties An array of the properties to *omit* from this
   *     sequence.
   * @returns {ObjectLikeSequence} The new sequence.
   *
   * @examples
   * var players = {
   *   "who": "first",
   *   "what": "second",
   *   "i don't know": "third"
   * };
   *
   * lazy(players).omit(["who", "what"]) // sequence: { "i don't know": "third" }
   */
  ObjectLikeSequence.prototype.omit = function omit(properties) {
    return new OmitSequence(this, properties);
  };

  /**
   * @constructor
   */
  function OmitSequence(parent, properties) {
    this.parent     = parent;
    this.properties = properties;
  }

  OmitSequence.prototype = new ObjectLikeSequence();

  OmitSequence.prototype.get = function get(key) {
    return arrayContains(this.properties, key) ? undefined : this.parent.get(key);
  };

  OmitSequence.prototype.each = function each(fn) {
    var inArray    = arrayContains,
        properties = this.properties;

    return this.parent.each(function(value, key) {
      if (!inArray(properties, key)) {
        return fn(value, key);
      }
    });
  };

  /**
   * Maps the key/value pairs in this sequence to arrays.
   *
   * @public
   * @aka toArray
   * @returns {Sequence} An sequence of `[key, value]` pairs.
   *
   * @examples
   * var colorCodes = {
   *   red: "#f00",
   *   green: "#0f0",
   *   blue: "#00f"
   * };
   *
   * lazy(colorCodes).pairs() // sequence: [["red", "#f00"], ["green", "#0f0"], ["blue", "#00f"]]
   */
  ObjectLikeSequence.prototype.pairs = function pairs() {
    return this.map(function(v, k) { return [k, v]; });
  };

  /**
   * Creates an array from the key/value pairs in this sequence.
   *
   * @public
   * @returns {Array} An array of `[key, value]` elements.
   *
   * @examples
   * var colorCodes = {
   *   red: "#f00",
   *   green: "#0f0",
   *   blue: "#00f"
   * };
   *
   * lazy(colorCodes).toArray() // => [["red", "#f00"], ["green", "#0f0"], ["blue", "#00f"]]
   */
  ObjectLikeSequence.prototype.toArray = function toArray() {
    return this.pairs().toArray();
  };

  /**
   * Creates an object with the key/value pairs from this sequence.
   *
   * @public
   * @returns {Object} An object with the same key/value pairs as this sequence.
   *
   * @examples
   * var colorCodes = {
   *   red: "#f00",
   *   green: "#0f0",
   *   blue: "#00f"
   * };
   *
   * lazy(colorCodes).toObject() // => { red: "#f00", green: "#0f0", blue: "#00f" }
   */
  ObjectLikeSequence.prototype.toObject = function toObject() {
    return this.reduce(function(object, value, key) {
      object[key] = value;
      return object;
    }, {});
  };

  // Now that we've fully initialized the ObjectLikeSequence prototype, we can
  // actually set the prototypes for GroupedSequence, IndexedSequence, and
  // CountedSequence.

  GroupedSequence.prototype = new ObjectLikeSequence();

  GroupedSequence.prototype.each = function each(fn) {
    var keyFn   = createCallback(this.keyFn),
        result;

    result = this.parent.reduce(function(grouped,e) {
      var key = keyFn(e);
      if (!(grouped[key] instanceof Array)) {
        grouped[key] = [e];
      } else {
        grouped[key].push(e);
      }
      return grouped;
    },{});

    return transform(function(grouped) {
      for (var key in grouped) {
        if (fn(grouped[key], key) === false) {
          return false;
        }
      }
    }, result);
  };

  IndexedSequence.prototype = new ObjectLikeSequence();

  IndexedSequence.prototype.each = function each(fn) {
    var keyFn   = createCallback(this.keyFn),
        indexed = {};

    return this.parent.each(function(e) {
      var key = keyFn(e);
      if (!indexed[key]) {
        indexed[key] = e;
        return fn(e, key);
      }
    });
  };

  CountedSequence.prototype = new ObjectLikeSequence();

  CountedSequence.prototype.each = function each(fn) {
    var keyFn   = createCallback(this.keyFn),
        counted = {};

    this.parent.each(function(e) {
      var key = keyFn(e);
      if (!counted[key]) {
        counted[key] = 1;
      } else {
        counted[key] += 1;
      }
    });

    for (var key in counted) {
      if (fn(counted[key], key) === false) {
        return false;
      }
    }

    return true;
  };

  /**
   * Watches for all changes to a specified property (or properties) of an
   * object and produces a sequence whose elements have the properties
   * `{ property, value }` indicating which property changed and what it was
   * changed to.
   *
   * Note that this method **only works on directly wrapped objects**; it will
   * *not* work on any arbitrary {@link ObjectLikeSequence}.
   *
   * @public
   * @param {(string|Array)=} propertyNames A property name or array of property
   *     names to watch. If this parameter is `undefined`, all of the object's
   *     current (enumerable) properties will be watched.
   * @returns {Sequence} A sequence comprising `{ property, value }` objects
   *     describing each change to the specified property/properties.
   *
   * @examples
   * var obj = {},
   *     changes = [];
   *
   * lazy(obj).watch('foo').each(function(change) {
   *   changes.push(change);
   * });
   *
   * obj.foo = 1;
   * obj.bar = 2;
   * obj.foo = 3;
   *
   * obj.foo; // => 3
   * changes; // => [{ property: 'foo', value: 1 }, { property: 'foo', value: 3 }]
   */
  ObjectLikeSequence.prototype.watch = function watch(propertyNames) {
    throw new Error('You can only call #watch on a directly wrapped object.');
  };

  /**
   * @constructor
   */
  function ObjectWrapper(source) {
    this.source = source;
  }

  ObjectWrapper.prototype = new ObjectLikeSequence();

  ObjectWrapper.prototype.root = function root() {
    return this;
  };

  ObjectWrapper.prototype.isAsync = function isAsync() {
    return false;
  };

  ObjectWrapper.prototype.get = function get(key) {
    return this.source[key];
  };

  ObjectWrapper.prototype.each = function each(fn) {
    var source = this.source,
        key;

    for (key in source) {
      if (fn(source[key], key) === false) {
        return false;
      }
    }

    return true;
  };

  /**
   * A `StringLikeSequence` represents a sequence of characters.
   *
   * The initial sequence you get by wrapping a string with `lazy(string)` is a
   * `StringLikeSequence`.
   *
   * All methods of `StringLikeSequence` that conceptually should return
   * something like a string return another `StringLikeSequence`.
   *
   * @public
   * @constructor
   *
   * @examples
   * function upcase(str) { return str.toUpperCase(); }
   *
   * lazy('foo')               // instanceof lazy.StringLikeSequence
   * lazy('foo').toUpperCase() // instanceof lazy.StringLikeSequence
   * lazy('foo').reverse()     // instanceof lazy.StringLikeSequence
   * lazy('foo').take(2)       // instanceof lazy.StringLikeSequence
   * lazy('foo').drop(1)       // instanceof lazy.StringLikeSequence
   * lazy('foo').substring(1)  // instanceof lazy.StringLikeSequence
   *
   * // Note that `map` does not create a `StringLikeSequence` because there's
   * // no guarantee the mapping function will return characters. In the event
   * // you do want to map a string onto a string-like sequence, use
   * // `mapString`:
   * lazy('foo').map(lazy.identity)       // instanceof lazy.ArrayLikeSequence
   * lazy('foo').mapString(lazy.identity) // instanceof lazy.StringLikeSequence
   */
  function StringLikeSequence() {}

  StringLikeSequence.prototype = new ArrayLikeSequence();

  /**
   * Create a new constructor function for a type inheriting from
   * `StringLikeSequence`.
   *
   * @public
   * @param {string|Array.<string>} methodName The name(s) of the method(s) to be
   *     used for constructing the new sequence. The method will be attached to
   *     the `StringLikeSequence` prototype so that it can be chained with any other
   *     methods that return string-like sequences.
   * @param {Object} overrides An object containing function overrides for this
   *     new sequence type. Has the same requirements as
   *     {@link ArrayLikeSequence.define}.
   * @returns {Function} A constructor for a new type inheriting from
   *     `StringLikeSequence`.
   *
   * @examples
   * lazy.StringLikeSequence.define("zomg", {
   *   length: function() {
   *     return this.parent.length() + "!!ZOMG!!!1".length;
   *   },
   *
   *   get: function(i) {
   *     if (i < this.parent.length()) {
   *       return this.parent.get(i);
   *     }
   *     return "!!ZOMG!!!1".charAt(i - this.parent.length());
   *   }
   * });
   *
   * lazy('foo').zomg() // sequence: "foo!!ZOMG!!!1"
   */
  StringLikeSequence.define = function define(methodName, overrides) {
    if (!overrides || typeof overrides.get !== 'function') {
      throw new Error("A custom string-like sequence must implement *at least* get!");
    }

    return defineSequenceType(StringLikeSequence, methodName, overrides);
  };

  StringLikeSequence.prototype.value = function value() {
    return this.toString();
  };

  /**
   * Returns an {@link IndexedIterator} that will step over each character in this
   * sequence one by one.
   *
   * @returns {IndexedIterator} The iterator.
   */
  StringLikeSequence.prototype.getIterator = function getIterator() {
    return new CharIterator(this);
  };

  /**
   * @constructor
   */
  function CharIterator(source) {
    this.source = lazy(source);
    this.index = -1;
  }

  CharIterator.prototype.current = function current() {
    return this.source.charAt(this.index);
  };

  CharIterator.prototype.moveNext = function moveNext() {
    return (++this.index < this.source.length());
  };

  /**
   * Returns the character at the given index of this sequence, or the empty
   * string if the specified index lies outside the bounds of the sequence.
   *
   * @public
   * @param {number} i The index of this sequence.
   * @returns {string} The character at the specified index.
   *
   * @examples
   * lazy("foo").charAt(0)  // => "f"
   * lazy("foo").charAt(-1) // => ""
   * lazy("foo").charAt(10) // => ""
   */
  StringLikeSequence.prototype.charAt = function charAt(i) {
    return this.get(i);
  };

  /**
   * Returns the character code at the given index of this sequence, or `NaN` if
   * the index lies outside the bounds of the sequence.
   *
   * @public
   * @param {number} i The index of the character whose character code you want.
   * @returns {number} The character code.
   *
   * @examples
   * lazy("abc").charCodeAt(0)  // => 97
   * lazy("abc").charCodeAt(-1) // => NaN
   * lazy("abc").charCodeAt(10) // => NaN
   */
  StringLikeSequence.prototype.charCodeAt = function charCodeAt(i) {
    var char = this.charAt(i);
    if (!char) { return NaN; }

    return char.charCodeAt(0);
  };

  /**
   * Returns a {@link StringLikeSequence} comprising the characters from *this*
   * sequence starting at `start` and ending at `stop` (exclusive), or---if
   * `stop` is `undefined`, including the rest of the sequence.
   *
   * @public
   * @param {number} start The index where this sequence should begin.
   * @param {number=} stop The index (exclusive) where this sequence should end.
   * @returns {StringLikeSequence} The new sequence.
   *
   * @examples
   * lazy("foo").substring(1)      // sequence: "oo"
   * lazy("foo").substring(-1)     // sequence: "foo"
   * lazy("hello").substring(1, 3) // sequence: "el"
   * lazy("hello").substring(1, 9) // sequence: "ello"
   */
  StringLikeSequence.prototype.substring = function substring(start, stop) {
    return new StringSegment(this, start, stop);
  };

  /**
   * @constructor
   */
  function StringSegment(parent, start, stop) {
    this.parent = parent;
    this.start  = Math.max(0, start);
    this.stop   = stop;
  }

  StringSegment.prototype = new StringLikeSequence();

  StringSegment.prototype.get = function get(i) {
    return this.parent.get(i + this.start);
  };

  StringSegment.prototype.length = function length() {
    return (typeof this.stop === "number" ? this.stop : this.parent.length()) - this.start;
  };

  /**
   * An optimized version of {@link Sequence#first} that returns another
   * {@link StringLikeSequence} (or just the first character, if `count` is
   * undefined).
   *
   * @public
   * @examples
   * lazy('foo').first()                // => 'f'
   * lazy('fo').first(2)                // sequence: 'fo'
   * lazy('foo').first(10)              // sequence: 'foo'
   * lazy('foo').toUpperCase().first()  // => 'F'
   * lazy('foo').toUpperCase().first(2) // sequence: 'FO'
   */
  StringLikeSequence.prototype.first = function first(count) {
    if (typeof count === "undefined") {
      return this.charAt(0);
    }

    return this.substring(0, count);
  };

  /**
   * An optimized version of {@link Sequence#last} that returns another
   * {@link StringLikeSequence} (or just the last character, if `count` is
   * undefined).
   *
   * @public
   * @examples
   * lazy('foo').last()                // => 'o'
   * lazy('foo').last(2)               // sequence: 'oo'
   * lazy('foo').last(10)              // sequence: 'foo'
   * lazy('foo').toUpperCase().last()  // => 'O'
   * lazy('foo').toUpperCase().last(2) // sequence: 'OO'
   */
  StringLikeSequence.prototype.last = function last(count) {
    if (typeof count === "undefined") {
      return this.charAt(this.length() - 1);
    }

    return this.substring(this.length() - count);
  };

  StringLikeSequence.prototype.drop = function drop(count) {
    return this.substring(count);
  };

  /**
   * Finds the index of the first occurrence of the given substring within this
   * sequence, starting from the specified index (or the beginning of the
   * sequence).
   *
   * @public
   * @param {string} substring The substring to search for.
   * @param {number=} startIndex The index from which to start the search.
   * @returns {number} The first index where the given substring is found, or
   *     -1 if it isn't in the sequence.
   *
   * @examples
   * lazy('canal').indexOf('a')    // => 1
   * lazy('canal').indexOf('a', 2) // => 3
   * lazy('canal').indexOf('ana')  // => 1
   * lazy('canal').indexOf('andy') // => -1
   * lazy('canal').indexOf('x')    // => -1
   */
  StringLikeSequence.prototype.indexOf = function indexOf(substring, startIndex) {
    return this.toString().indexOf(substring, startIndex);
  };

  /**
   * Finds the index of the last occurrence of the given substring within this
   * sequence, starting from the specified index (or the end of the sequence)
   * and working backwards.
   *
   * @public
   * @param {string} substring The substring to search for.
   * @param {number=} startIndex The index from which to start the search.
   * @returns {number} The last index where the given substring is found, or
   *     -1 if it isn't in the sequence.
   *
   * @examples
   * lazy('canal').lastIndexOf('a')    // => 3
   * lazy('canal').lastIndexOf('a', 2) // => 1
   * lazy('canal').lastIndexOf('ana')  // => 1
   * lazy('canal').lastIndexOf('andy') // => -1
   * lazy('canal').lastIndexOf('x')    // => -1
   */
  StringLikeSequence.prototype.lastIndexOf = function lastIndexOf(substring, startIndex) {
    return this.toString().lastIndexOf(substring, startIndex);
  };

  /**
   * Checks if this sequence contains a given substring.
   *
   * @public
   * @param {string} substring The substring to check for.
   * @returns {boolean} Whether or not this sequence contains `substring`.
   *
   * @examples
   * lazy('hello').contains('ell') // => true
   * lazy('hello').contains('')    // => true
   * lazy('hello').contains('abc') // => false
   */
  StringLikeSequence.prototype.contains = function contains(substring) {
    return this.indexOf(substring) !== -1;
  };

  /**
   * Checks if this sequence ends with a given suffix.
   *
   * @public
   * @param {string} suffix The suffix to check for.
   * @returns {boolean} Whether or not this sequence ends with `suffix`.
   *
   * @examples
   * lazy('foo').endsWith('oo')  // => true
   * lazy('foo').endsWith('')    // => true
   * lazy('foo').endsWith('abc') // => false
   */
  StringLikeSequence.prototype.endsWith = function endsWith(suffix) {
    return this.substring(this.length() - suffix.length).toString() === suffix;
  };

  /**
   * Checks if this sequence starts with a given prefix.
   *
   * @public
   * @param {string} prefix The prefix to check for.
   * @returns {boolean} Whether or not this sequence starts with `prefix`.
   *
   * @examples
   * lazy('foo').startsWith('fo')  // => true
   * lazy('foo').startsWith('')    // => true
   * lazy('foo').startsWith('abc') // => false
   */
  StringLikeSequence.prototype.startsWith = function startsWith(prefix) {
    return this.substring(0, prefix.length).toString() === prefix;
  };

  /**
   * Converts all of the characters in this string to uppercase.
   *
   * @public
   * @returns {StringLikeSequence} A new sequence with the same characters as
   *     this sequence, all uppercase.
   *
   * @examples
   * function nextLetter(a) {
   *   return String.fromCharCode(a.charCodeAt(0) + 1);
   * }
   *
   * lazy('foo').toUpperCase()                       // sequence: 'FOO'
   * lazy('foo').substring(1).toUpperCase()          // sequence: 'OO'
   * lazy('abc').mapString(nextLetter).toUpperCase() // sequence: 'BCD'
   */
  StringLikeSequence.prototype.toUpperCase = function toUpperCase() {
    return this.mapString(function(char) { return char.toUpperCase(); });
  };

  /**
   * Converts all of the characters in this string to lowercase.
   *
   * @public
   * @returns {StringLikeSequence} A new sequence with the same characters as
   *     this sequence, all lowercase.
   *
   * @examples
   * function nextLetter(a) {
   *   return String.fromCharCode(a.charCodeAt(0) + 1);
   * }
   *
   * lazy('FOO').toLowerCase()                       // sequence: 'foo'
   * lazy('FOO').substring(1).toLowerCase()          // sequence: 'oo'
   * lazy('ABC').mapString(nextLetter).toLowerCase() // sequence: 'bcd'
   */
  StringLikeSequence.prototype.toLowerCase = function toLowerCase() {
    return this.mapString(function(char) { return char.toLowerCase(); });
  };

  /**
   * Maps the characters of this sequence onto a new {@link StringLikeSequence}.
   *
   * @public
   * @param {Function} mapFn The function used to map characters from this
   *     sequence onto the new sequence.
   * @returns {StringLikeSequence} The new sequence.
   *
   * @examples
   * function upcase(char) { return char.toUpperCase(); }
   *
   * lazy("foo").mapString(upcase)               // sequence: "FOO"
   * lazy("foo").mapString(upcase).charAt(0)     // => "F"
   * lazy("foo").mapString(upcase).charCodeAt(0) // => 70
   * lazy("foo").mapString(upcase).substring(1)  // sequence: "OO"
   */
  StringLikeSequence.prototype.mapString = function mapString(mapFn) {
    return new MappedStringLikeSequence(this, mapFn);
  };

  /**
   * @constructor
   */
  function MappedStringLikeSequence(parent, mapFn) {
    this.parent = parent;
    this.mapFn  = mapFn;
  }

  MappedStringLikeSequence.prototype = new StringLikeSequence();
  MappedStringLikeSequence.prototype.get = IndexedMappedSequence.prototype.get;
  MappedStringLikeSequence.prototype.length = IndexedMappedSequence.prototype.length;

  /**
   * Returns a copy of this sequence that reads back to front.
   *
   * @public
   *
   * @examples
   * lazy("abcdefg").reverse() // sequence: "gfedcba"
   */
  StringLikeSequence.prototype.reverse = function reverse() {
    return new ReversedStringLikeSequence(this);
  };

  /**
   * @constructor
   */
  function ReversedStringLikeSequence(parent) {
    this.parent = parent;
  }

  ReversedStringLikeSequence.prototype = new StringLikeSequence();
  ReversedStringLikeSequence.prototype.get = IndexedReversedSequence.prototype.get;
  ReversedStringLikeSequence.prototype.length = IndexedReversedSequence.prototype.length;

  StringLikeSequence.prototype.toString = function toString() {
    return this.join("");
  };

  /**
   * Creates a {@link Sequence} comprising all of the matches for the specified
   * pattern in the underlying string.
   *
   * @public
   * @param {RegExp} pattern The pattern to match.
   * @returns {Sequence} A sequence of all the matches.
   *
   * @examples
   * lazy("abracadabra").match(/a[bcd]/) // sequence: ["ab", "ac", "ad", "ab"]
   * lazy("fee fi fo fum").match(/\w+/)  // sequence: ["fee", "fi", "fo", "fum"]
   * lazy("hello").match(/xyz/)          // sequence: []
   */
  StringLikeSequence.prototype.match = function match(pattern) {
    return new StringMatchSequence(this.source, pattern);
  };

  /**
   * @constructor
   */
  function StringMatchSequence(source, pattern) {
    this.source = source;
    this.pattern = pattern;
  }

  StringMatchSequence.prototype = new Sequence();

  StringMatchSequence.prototype.getIterator = function getIterator() {
    return new StringMatchIterator(this.source, this.pattern);
  };

  /**
   * @constructor
   */
  function StringMatchIterator(source, pattern) {
    this.source  = source;
    this.pattern = cloneRegex(pattern);
  }

  StringMatchIterator.prototype.current = function current() {
    return this.match[0];
  };

  StringMatchIterator.prototype.moveNext = function moveNext() {
    return !!(this.match = this.pattern.exec(this.source));
  };

  /**
   * Creates a {@link Sequence} comprising all of the substrings of this string
   * separated by the given delimiter, which can be either a string or a regular
   * expression.
   *
   * @public
   * @param {string|RegExp} delimiter The delimiter to use for recognizing
   *     substrings.
   * @returns {Sequence} A sequence of all the substrings separated by the given
   *     delimiter.
   *
   * @examples
   * lazy("foo").split("")                      // sequence: ["f", "o", "o"]
   * lazy("yo dawg").split(" ")                 // sequence: ["yo", "dawg"]
   * lazy("bah bah\tblack  sheep").split(/\s+/) // sequence: ["bah", "bah", "black", "sheep"]
   */
  StringLikeSequence.prototype.split = function split(delimiter) {
    return new SplitStringSequence(this.source, delimiter);
  };

  /**
   * @constructor
   */
  function SplitStringSequence(source, pattern) {
    this.source = source;
    this.pattern = pattern;
  }

  SplitStringSequence.prototype = new Sequence();

  SplitStringSequence.prototype.getIterator = function getIterator() {
    if (this.pattern instanceof RegExp) {
      if (this.pattern.source === "" || this.pattern.source === "(?:)") {
        return new CharIterator(this.source);
      } else {
        return new SplitWithRegExpIterator(this.source, this.pattern);
      }
    } else if (this.pattern === "") {
      return new CharIterator(this.source);
    } else {
      return new SplitWithStringIterator(this.source, this.pattern);
    }
  };

  /**
   * @constructor
   */
  function SplitWithRegExpIterator(source, pattern) {
    this.source  = source;
    this.pattern = cloneRegex(pattern);
  }

  SplitWithRegExpIterator.prototype.current = function current() {
    return this.source.substring(this.start, this.end);
  };

  SplitWithRegExpIterator.prototype.moveNext = function moveNext() {
    if (!this.pattern) {
      return false;
    }

    var match = this.pattern.exec(this.source);

    if (match) {
      this.start = this.nextStart ? this.nextStart : 0;
      this.end = match.index;
      this.nextStart = match.index + match[0].length;
      return true;

    } else if (this.pattern) {
      this.start = this.nextStart;
      this.end = undefined;
      this.nextStart = undefined;
      this.pattern = undefined;
      return true;
    }

    return false;
  };

  /**
   * @constructor
   */
  function SplitWithStringIterator(source, delimiter) {
    this.source = source;
    this.delimiter = delimiter;
  }

  SplitWithStringIterator.prototype.current = function current() {
    return this.source.substring(this.leftIndex, this.rightIndex);
  };

  SplitWithStringIterator.prototype.moveNext = function moveNext() {
    if (!this.finished) {
      this.leftIndex = typeof this.leftIndex !== "undefined" ?
        this.rightIndex + this.delimiter.length :
        0;
      this.rightIndex = this.source.indexOf(this.delimiter, this.leftIndex);
    }

    if (this.rightIndex === -1) {
      this.finished = true;
      this.rightIndex = undefined;
      return true;
    }

    return !this.finished;
  };

  /**
   * Wraps a string exposing {@link #match} and {@link #split} methods that return
   * {@link Sequence} objects instead of arrays, improving on the efficiency of
   * JavaScript's built-in `String#split` and `String.match` methods and
   * supporting asynchronous iteration.
   *
   * @param {string} source The string to wrap.
   * @constructor
   */
  function StringWrapper(source) {
    this.source = source;
  }

  StringWrapper.prototype = new StringLikeSequence();

  StringWrapper.prototype.root = function root() {
    return this;
  };

  StringWrapper.prototype.isAsync = function isAsync() {
    return false;
  };

  StringWrapper.prototype.get = function get(i) {
    return this.source.charAt(i);
  };

  StringWrapper.prototype.length = function length() {
    return this.source.length;
  };

  /**
   * A `GeneratedSequence` does not wrap an in-memory colllection but rather
   * determines its elements on-the-fly during iteration according to a generator
   * function.
   *
   * You create a `GeneratedSequence` by calling {@link lazy.generate}.
   *
   * @public
   * @constructor
   * @param {function(number):*} generatorFn A function which accepts an index
   *     and returns a value for the element at that position in the sequence.
   * @param {number=} length The length of the sequence. If this argument is
   *     omitted, the sequence will go on forever.
   */
  function GeneratedSequence(generatorFn, length) {
    this.get = generatorFn;
    this.fixedLength = length;
  }

  GeneratedSequence.prototype = new Sequence();

  GeneratedSequence.prototype.isAsync = function isAsync() {
    return false;
  };

  /**
   * Returns the length of this sequence.
   *
   * @public
   * @returns {number} The length, or `undefined` if this is an indefinite
   *     sequence.
   */
  GeneratedSequence.prototype.length = function length() {
    return this.fixedLength;
  };

  /**
   * Iterates over the sequence produced by invoking this sequence's generator
   * function up to its specified length, or, if length is `undefined`,
   * indefinitely (in which case the sequence will go on forever--you would need
   * to call, e.g., {@link Sequence#take} to limit iteration).
   *
   * @public
   * @param {Function} fn The function to call on each output from the generator
   *     function.
   */
  GeneratedSequence.prototype.each = function each(fn) {
    var generatorFn = this.get,
        length = this.fixedLength,
        i = 0;

    while (typeof length === "undefined" || i < length) {
      if (fn(generatorFn(i++)) === false) {
        return false;
      }
    }

    return true;
  };

  GeneratedSequence.prototype.getIterator = function getIterator() {
    return new GeneratedIterator(this);
  };

  /**
   * Iterates over a generated sequence. (This allows generated sequences to be
   * iterated asynchronously.)
   *
   * @param {GeneratedSequence} sequence The generated sequence to iterate over.
   * @constructor
   */
  function GeneratedIterator(sequence) {
    this.sequence     = sequence;
    this.index        = 0;
    this.currentValue = null;
  }

  GeneratedIterator.prototype.current = function current() {
    return this.currentValue;
  };

  GeneratedIterator.prototype.moveNext = function moveNext() {
    var sequence = this.sequence;

    if (typeof sequence.fixedLength === "number" && this.index >= sequence.fixedLength) {
      return false;
    }

    this.currentValue = sequence.get(this.index++);
    return true;
  };

  /**
   * An `AsyncSequence` iterates over its elements asynchronously when
   * {@link #each} is called.
   *
   * You get an `AsyncSequence` by calling {@link Sequence#async} on any
   * sequence. Note that some sequence types may not support asynchronous
   * iteration.
   *
   * Returning values
   * ----------------
   *
   * Because of its asynchronous nature, an `AsyncSequence` cannot be used in the
   * same way as other sequences for functions that return values directly (e.g.,
   * `reduce`, `max`, `any`, even `toArray`).
   *
   * Instead, these methods return an `AsyncHandle` whose `onComplete` method
   * accepts a callback that will be called with the final result once iteration
   * has finished.
   *
   * Defining custom asynchronous sequences
   * --------------------------------------
   *
   * There are plenty of ways to define an asynchronous sequence. Here's one.
   *
   * 1. First, implement an {@link Iterator}. This is an object whose prototype
   *    has the methods {@link Iterator#moveNext} (which returns a `boolean`) and
   *    {@link current} (which returns the current value).
   * 2. Next, create a simple wrapper that inherits from `AsyncSequence`, whose
   *    `getIterator` function returns an instance of the iterator type you just
   *    defined.
   *
   * The default implementation for {@link #each} on an `AsyncSequence` is to
   * create an iterator and then asynchronously call {@link Iterator#moveNext}
   * (using `setImmediate`, if available, otherwise `setTimeout`) until the iterator
   * can't move ahead any more.
   *
   * @public
   * @constructor
   * @param {Sequence} parent A {@link Sequence} to wrap, to expose asynchronous
   *     iteration.
   * @param {number=} interval How many milliseconds should elapse between each
   *     element when iterating over this sequence. If this argument is omitted,
   *     asynchronous iteration will be executed as fast as possible.
   */
  function AsyncSequence(parent, interval) {
    if (parent instanceof AsyncSequence) {
      throw new Error("Sequence is already asynchronous!");
    }

    this.parent         = parent;
    this.interval       = interval;
    this.onNextCallback = getOnNextCallback(interval);
    this.cancelCallback = getCancelCallback(interval);
  }

  AsyncSequence.prototype = new Sequence();

  AsyncSequence.prototype.isAsync = function isAsync() {
    return true;
  };

  /**
   * Throws an exception. You cannot manually iterate over an asynchronous
   * sequence.
   *
   * @public
   * @example
   * lazy([1, 2, 3]).async().getIterator() // throws
   */
  AsyncSequence.prototype.getIterator = function getIterator() {
    throw new Error('An AsyncSequence does not support synchronous iteration.');
  };

  /**
   * An asynchronous version of {@link Sequence#each}.
   *
   * @public
   * @param {Function} fn The function to invoke asynchronously on each element in
   *     the sequence one by one.
   * @returns {AsyncHandle} An {@link AsyncHandle} providing the ability to
   *     cancel the asynchronous iteration (by calling `cancel()`) as well as
   *     supply callback(s) for when an error is encountered (`onError`) or when
   *     iteration is complete (`onComplete`).
   */
  AsyncSequence.prototype.each = function each(fn) {
    var iterator = this.parent.getIterator(),
        onNextCallback = this.onNextCallback,
        cancelCallback = this.cancelCallback,
        i = 0;

    var handle = new AsyncHandle(function cancel() {
      if (cancellationId) {
        cancelCallback(cancellationId);
      }
    });

    var cancellationId = onNextCallback(function iterate() {
      cancellationId = null;

      try {
        if (iterator.moveNext() && fn(iterator.current(), i++) !== false) {
          cancellationId = onNextCallback(iterate);

        } else {
          handle._resolve();
        }

      } catch (e) {
        handle._reject(e);
      }
    });

    return handle;
  };

  /**
   * An `AsyncHandle` provides a [Promises/A+](http://promises-aplus.github.io/promises-spec/)
   * compliant interface for an {@link AsyncSequence} that is currently (or was)
   * iterating over its elements.
   *
   * In addition to behaving as a promise, an `AsyncHandle` provides the ability
   * to {@link AsyncHandle#cancel} iteration (if `cancelFn` is provided)
   * and also offers convenient {@link AsyncHandle#onComplete} and
   * {@link AsyncHandle#onError} methods to attach listeners for when iteration
   * is complete or an error is thrown during iteration.
   *
   * @public
   * @param {Function} cancelFn A function to cancel asynchronous iteration.
   *     This is passed in to support different cancellation mechanisms for
   *     different forms of asynchronous sequences (e.g., timeout-based
   *     sequences, sequences based on I/O, etc.).
   * @constructor
   *
   * @example
   * // Create a sequence of 100,000 random numbers, in chunks of 100.
   * var sequence = lazy.generate(Math.random)
   *   .chunk(100)
   *   .async()
   *   .take(1000);
   *
   * // Reduce-style operations -- i.e., operations that return a *value* (as
   * // opposed to a *sequence*) -- return an AsyncHandle for async sequences.
   * var handle = sequence.toArray();
   *
   * handle.onComplete(function(array) {
   *   console.log('Created array with ' + array.length + ' elements!');
   * });
   *
   * // Since an AsyncHandle is a promise, you can also use it to create
   * // subsequent promises using `then` (see the Promises/A+ spec for more
   * // info).
   * var flattened = handle.then(function(array) {
   *   return lazy(array).flatten();
   * });
   */
  function AsyncHandle(cancelFn) {
    this.resolveListeners = [];
    this.rejectListeners = [];
    this.state = PENDING;
    this.cancelFn = cancelFn;
  }

  // Async handle states
  var PENDING  = 1,
      RESOLVED = 2,
      REJECTED = 3;

  AsyncHandle.prototype.then = function then(onFulfilled, onRejected) {
    var promise = new AsyncHandle(this.cancelFn);

    this.resolveListeners.push(function(value) {
      try {
        if (typeof onFulfilled !== 'function') {
          resolve(promise, value);
          return;
        }

        resolve(promise, onFulfilled(value));

      } catch (e) {
        promise._reject(e);
      }
    });

    this.rejectListeners.push(function(reason) {
      try {
        if (typeof onRejected !== 'function') {
          promise._reject(reason);
          return;
        }

        resolve(promise, onRejected(reason));

      } catch (e) {
        promise._reject(e);
      }
    });

    if (this.state === RESOLVED) {
      this._resolve(this.value);
    }

    if (this.state === REJECTED) {
      this._reject(this.reason);
    }

    return promise;
  };

  AsyncHandle.prototype._resolve = function _resolve(value) {
    if (this.state === REJECTED) {
      return;
    }

    if (this.state === PENDING) {
      this.state = RESOLVED;
      this.value = value;
    }

    consumeListeners(this.resolveListeners, this.value);
  };

  AsyncHandle.prototype._reject = function _reject(reason) {
    if (this.state === RESOLVED) {
      return;
    }

    if (this.state === PENDING) {
      this.state = REJECTED;
      this.reason = reason;
    }

    consumeListeners(this.rejectListeners, this.reason);
  };

  /**
   * Cancels asynchronous iteration.
   *
   * @public
   */
  AsyncHandle.prototype.cancel = function cancel() {
    if (this.cancelFn) {
      this.cancelFn();
      this.cancelFn = null;
      this._resolve(false);
    }
  };

  /**
   * Updates the handle with a callback to execute when iteration is completed.
   *
   * @public
   * @param {Function} callback The function to call when the asynchronous
   *     iteration is completed.
   * @return {AsyncHandle} A reference to the handle (for chaining).
   */
  AsyncHandle.prototype.onComplete = function onComplete(callback) {
    this.resolveListeners.push(callback);
    return this;
  };

  /**
   * Updates the handle with a callback to execute if/when any error is
   * encountered during asynchronous iteration.
   *
   * @public
   * @param {Function} callback The function to call, with any associated error
   *     object, when an error occurs.
   * @return {AsyncHandle} A reference to the handle (for chaining).
   */
  AsyncHandle.prototype.onError = function onError(callback) {
    this.rejectListeners.push(callback);
    return this;
  };

  /**
   * Promise resolution procedure:
   * http://promises-aplus.github.io/promises-spec/#the_promise_resolution_procedure
   */
  function resolve(promise, x) {
    if (promise === x) {
      promise._reject(new TypeError('Cannot resolve a promise to itself'));
      return;
    }

    if (x instanceof AsyncHandle) {
      x.then(
        function(value) { resolve(promise, value); },
        function(reason) { promise._reject(reason); }
      );
      return;
    }

    var then;
    try {
      then = (/function|object/).test(typeof x) && x !== null && x.then;
    } catch (e) {
      promise._reject(e);
      return;
    }

    var thenableState = PENDING;
    if (typeof then === 'function') {
      try {
        then.call(
          x,
          function resolvePromise(value) {
            if (thenableState !== PENDING) {
              return;
            }
            thenableState = RESOLVED;
            resolve(promise, value);
          },
          function rejectPromise(reason) {
            if (thenableState !== PENDING) {
              return;
            }
            thenableState = REJECTED;
            promise._reject(reason);
          }
        );
      } catch (e) {
        if (thenableState !== PENDING) {
          return;
        }

        promise._reject(e);
      }

      return;
    }

    promise._resolve(x);
  }

  function consumeListeners(listeners, value, callback) {
    callback || (callback = getOnNextCallback());

    callback(function() {
      if (listeners.length > 0) {
        listeners.shift()(value);
        consumeListeners(listeners, value, callback);
      }
    });
  }

  function getOnNextCallback(interval) {
    if (typeof interval === "undefined") {
      if (typeof setImmediate === "function") {
        return setImmediate;
      }
    }

    interval = interval || 0;
    return function(fn) {
      return setTimeout(fn, interval);
    };
  }

  function getCancelCallback(interval) {
    if (typeof interval === "undefined") {
      if (typeof clearImmediate === "function") {
        return clearImmediate;
      }
    }

    return clearTimeout;
  }

  /**
   * Transform a value, whether the value is retrieved asynchronously or directly.
   *
   * @private
   * @param {Function} fn The function that transforms the value.
   * @param {*} value The value to be transformed. This can be an {@link AsyncHandle} when the value
   *     is retrieved asynchronously, otherwise it can be anything.
   * @returns {*} An {@link AsyncHandle} when `value` is also an {@link AsyncHandle}, otherwise
   *     whatever `fn` resulted in.
   */
  function transform(fn, value) {
    if (value instanceof AsyncHandle) {
      return value.then(function() { fn(value); });
    }
    return fn(value);
  }

  /**
   * An async version of {@link Sequence#reverse}.
   */
  AsyncSequence.prototype.reverse = function reverse() {
    return this.parent.reverse().async();
  };

  /**
   * A version of {@link Sequence#find} which returns an {@link AsyncHandle}.
   *
   * @public
   * @param {Function} predicate A function to call on (potentially) every element
   *     in the sequence.
   * @returns {AsyncHandle} An {@link AsyncHandle} (promise) which resolves to
   *     the found element, once it is detected, or else `undefined`.
   */
  AsyncSequence.prototype.find = function find(predicate) {
    var found;

    var handle = this.each(function(e, i) {
      if (predicate(e, i)) {
        found = e;
        return false;
      }
    });

    return handle.then(function() { return found; });
  };

  /**
   * A version of {@link Sequence#indexOf} which returns an {@link AsyncHandle}.
   *
   * @public
   * @param {*} value The element to search for in the sequence.
   * @returns {AsyncHandle} An {@link AsyncHandle} (promise) which resolves to
   *     the found index, once it is detected, or -1.
   */
  AsyncSequence.prototype.indexOf = function indexOf(value) {
    var foundIndex = -1;

    var handle = this.each(function(e, i) {
      if (e === value) {
        foundIndex = i;
        return false;
      }
    });

    return handle.then(function() {
      return foundIndex;
    });
  };

  /**
   * A version of {@link Sequence#contains} which returns an {@link AsyncHandle}.
   *
   * @public
   * @param {*} value The element to search for in the sequence.
   * @returns {AsyncHandle} An {@link AsyncHandle} (promise) which resolves to
   *     either `true` or `false` to indicate whether the element was found.
   */
  AsyncSequence.prototype.contains = function contains(value) {
    var found = false;

    var handle = this.each(function(e) {
      if (e === value) {
        found = true;
        return false;
      }
    });

    return handle.then(function() {
      return found;
    });
  };

  /**
   * Just return the same sequence for `AsyncSequence#async` (I see no harm in this).
   */
  AsyncSequence.prototype.async = function async() {
    return this;
  };

  /**
   * See {@link ObjectLikeSequence#watch} for docs.
   */
  ObjectWrapper.prototype.watch = function watch(propertyNames) {
    return new WatchedPropertySequence(this.source, propertyNames);
  };

  function WatchedPropertySequence(object, propertyNames) {
    this.listeners = [];

    if (!propertyNames) {
      propertyNames = lazy(object).keys().toArray();
    } else if (!(propertyNames instanceof Array)) {
      propertyNames = [propertyNames];
    }

    var listeners = this.listeners,
        index     = 0;

    lazy(propertyNames).each(function(propertyName) {
      var propertyValue = object[propertyName];

      Object.defineProperty(object, propertyName, {
        get: function() {
          return propertyValue;
        },

        set: function(value) {
          for (var i = listeners.length - 1; i >= 0; --i) {
            if (listeners[i]({ property: propertyName, value: value }, index) === false) {
              listeners.splice(i, 1);
            }
          }
          propertyValue = value;
          ++index;
        }
      });
    });
  }

  WatchedPropertySequence.prototype = new AsyncSequence();

  WatchedPropertySequence.prototype.each = function each(fn) {
    this.listeners.push(fn);
  };

  /**
   * A StreamLikeSequence comprises a sequence of 'chunks' of data, which are
   * typically multiline strings.
   *
   * @constructor
   */
  function StreamLikeSequence() {}

  StreamLikeSequence.prototype = new AsyncSequence();

  StreamLikeSequence.prototype.isAsync = function isAsync() {
    return true;
  };

  StreamLikeSequence.prototype.split = function split(delimiter) {
    return new SplitStreamSequence(this, delimiter);
  };

  /**
   * @constructor
   */
  function SplitStreamSequence(parent, delimiter) {
    this.parent    = parent;
    this.delimiter = delimiter;
    this.each      = this.getEachForDelimiter(delimiter);
  }

  SplitStreamSequence.prototype = new Sequence();

  SplitStreamSequence.prototype.getEachForDelimiter = function getEachForDelimiter(delimiter) {
    if (delimiter instanceof RegExp) {
      return this.regexEach;
    }

    return this.stringEach;
  };

  SplitStreamSequence.prototype.regexEach = function each(fn) {
    var delimiter = cloneRegex(this.delimiter),
        buffer = '',
        start = 0, end,
        index = 0;

    var handle = this.parent.each(function(chunk) {
      buffer += chunk;

      var match;
      while (match = delimiter.exec(buffer)) {
        end = match.index;
        if (fn(buffer.substring(start, end), index++) === false) {
          return false;
        }
        start = end + match[0].length;
      }

      buffer = buffer.substring(start);
      start = 0;
    });

    handle.onComplete(function() {
      if (buffer.length > 0) {
        fn(buffer);
      }
    });

    return handle;
  };

  SplitStreamSequence.prototype.stringEach = function each(fn) {
    var delimiter  = this.delimiter,
        pieceIndex = 0,
        buffer = '',
        bufferIndex = 0;

    var handle = this.parent.each(function(chunk) {
      buffer += chunk;
      var delimiterIndex;
      while ((delimiterIndex = buffer.indexOf(delimiter)) >= 0) {
        var piece = buffer.substr(0,delimiterIndex);
        buffer = buffer.substr(delimiterIndex+delimiter.length);
        if (fn(piece,pieceIndex++) === false) {
          return false;
        }
      }
      return true;
    });

    handle.onComplete(function() {
      fn(buffer, pieceIndex++);
    });

    return handle;
  };

  StreamLikeSequence.prototype.lines = function lines() {
    return this.split("\n");
  };

  StreamLikeSequence.prototype.match = function match(pattern) {
    return new MatchedStreamSequence(this, pattern);
  };

  /**
   * @constructor
   */
  function MatchedStreamSequence(parent, pattern) {
    this.parent  = parent;
    this.pattern = cloneRegex(pattern);
  }

  MatchedStreamSequence.prototype = new AsyncSequence();

  MatchedStreamSequence.prototype.each = function each(fn) {
    var pattern = this.pattern,
        done      = false,
        i         = 0;

    return this.parent.each(function(chunk) {
      lazy(chunk).match(pattern).each(function(match) {
        if (fn(match, i++) === false) {
          done = true;
          return false;
        }
      });

      return !done;
    });
  };

  /**
   * Defines a wrapper for custom {@link StreamLikeSequence}s. This is useful
   * if you want a way to handle a stream of events as a sequence, but you can't
   * use lazy's existing interface (i.e., you're wrapping an object from a
   * library with its own custom events).
   *
   * This method defines a *factory*: that is, it produces a function that can
   * be used to wrap objects and return a {@link Sequence}. Hopefully the
   * example will make this clear.
   *
   * @public
   * @param {Function} initializer An initialization function called on objects
   *     created by this factory. `this` will be bound to the created object,
   *     which is an instance of {@link StreamLikeSequence}. Use `emit` to
   *     generate data for the sequence.
   * @returns {Function} A function that creates a new {@link StreamLikeSequence},
   *     initializes it using the specified function, and returns it.
   *
   * @example
   * var factory = lazy.createWrapper(function(eventSource) {
   *   var sequence = this;
   *
   *   eventSource.handleEvent(function(data) {
   *     sequence.emit(data);
   *   });
   * });
   *
   * var eventEmitter = {
   *   triggerEvent: function(data) {
   *     eventEmitter.eventHandler(data);
   *   },
   *   handleEvent: function(handler) {
   *     eventEmitter.eventHandler = handler;
   *   },
   *   eventHandler: function() {}
   * };
   *
   * var events = [];
   *
   * factory(eventEmitter).each(function(e) {
   *   events.push(e);
   * });
   *
   * eventEmitter.triggerEvent('foo');
   * eventEmitter.triggerEvent('bar');
   *
   * events // => ['foo', 'bar']
   */
  lazy.createWrapper = function createWrapper(initializer) {
    var ctor = function() {
      this.listeners = [];
    };

    ctor.prototype = new StreamLikeSequence();

    ctor.prototype.each = function(listener) {
      this.listeners.push(listener);
    };

    ctor.prototype.emit = function(data) {
      var listeners = this.listeners;

      for (var len = listeners.length, i = len - 1; i >= 0; --i) {
        if (listeners[i](data) === false) {
          listeners.splice(i, 1);
        }
      }
    };

    return function() {
      var sequence = new ctor();
      initializer.apply(sequence, arguments);
      return sequence;
    };
  };

  /**
   * Creates a {@link GeneratedSequence} using the specified generator function
   * and (optionally) length.
   *
   * @public
   * @param {function(number):*} generatorFn The function used to generate the
   *     sequence. This function accepts an index as a parameter and should return
   *     a value for that index in the resulting sequence.
   * @param {number=} length The length of the sequence, for sequences with a
   *     definite length.
   * @returns {GeneratedSequence} The generated sequence.
   *
   * @examples
   * var randomNumbers = lazy.generate(Math.random);
   * var countingNumbers = lazy.generate(function(i) { return i + 1; }, 5);
   *
   * randomNumbers          // instanceof lazy.GeneratedSequence
   * randomNumbers.length() // => undefined
   * countingNumbers          // sequence: [1, 2, 3, 4, 5]
   * countingNumbers.length() // => 5
   */
  lazy.generate = function generate(generatorFn, length) {
    return new GeneratedSequence(generatorFn, length);
  };

  /**
   * Creates a sequence from a given starting value, up to a specified stopping
   * value, incrementing by a given step.
   *
   * @public
   * @returns {GeneratedSequence} The sequence defined by the given ranges.
   *
   * @examples
   * lazy.range(3)         // sequence: [0, 1, 2]
   * lazy.range(1, 4)      // sequence: [1, 2, 3]
   * lazy.range(2, 10, 2)  // sequence: [2, 4, 6, 8]
   * lazy.range(5, 1, 2)   // sequence: []
   * lazy.range(5, 15, -2) // sequence: []
   */
  lazy.range = function range() {
    var start = arguments.length > 1 ? arguments[0] : 0,
        stop  = arguments.length > 1 ? arguments[1] : arguments[0],
        step  = arguments.length > 2 ? arguments[2] : 1;
    return this.generate(function(i) { return start + (step * i); })
      .take(Math.floor((stop - start) / step));
  };

  /**
   * Creates a sequence consisting of the given value repeated a specified number
   * of times.
   *
   * @public
   * @param {*} value The value to repeat.
   * @param {number=} count The number of times the value should be repeated in
   *     the sequence. If this argument is omitted, the value will repeat forever.
   * @returns {GeneratedSequence} The sequence containing the repeated value.
   *
   * @examples
   * lazy.repeat("hi", 3)          // sequence: ["hi", "hi", "hi"]
   * lazy.repeat("young")          // instanceof lazy.GeneratedSequence
   * lazy.repeat("young").length() // => undefined
   * lazy.repeat("young").take(3)  // sequence: ["young", "young", "young"]
   */
  lazy.repeat = function repeat(value, count) {
    return lazy.generate(function() { return value; }, count);
  };

  lazy.Sequence           = Sequence;
  lazy.ArrayLikeSequence  = ArrayLikeSequence;
  lazy.ObjectLikeSequence = ObjectLikeSequence;
  lazy.StringLikeSequence = StringLikeSequence;
  lazy.StreamLikeSequence = StreamLikeSequence;
  lazy.GeneratedSequence  = GeneratedSequence;
  lazy.AsyncSequence      = AsyncSequence;
  lazy.AsyncHandle        = AsyncHandle;

  /*** Useful utility methods ***/

  /**
   * Creates a shallow copy of an array or object.
   *
   * @examples
   * var array  = [1, 2, 3], clonedArray,
   *     object = { foo: 1, bar: 2 }, clonedObject;
   *
   * clonedArray = lazy.clone(array); // => [1, 2, 3]
   * clonedArray.push(4); // clonedArray == [1, 2, 3, 4]
   * array; // => [1, 2, 3]
   *
   * clonedObject = lazy.clone(object); // => { foo: 1, bar: 2 }
   * clonedObject.baz = 3; // clonedObject == { foo: 1, bar: 2, baz: 3 }
   * object; // => { foo: 1, bar: 2 }
   */
  lazy.clone = function clone(target) {
    return lazy(target).value();
  };

  /**
   * Marks a method as deprecated, so calling it will issue a console warning.
   */
  lazy.deprecate = function deprecate(message, fn) {
    return function() {
      console.warn(message);
      return fn.apply(this, arguments);
    };
  };

  var arrayPop   = Array.prototype.pop,
      arraySlice = Array.prototype.slice;

  /**
   * Creates a callback... you know, Lo-Dash style.
   *
   * - for functions, just returns the function
   * - for strings, returns a pluck-style callback
   * - for objects, returns a where-style callback
   *
   * @private
   * @param {Function|string|Object} callback A function, string, or object to
   *     convert to a callback.
   * @param {*} defaultReturn If the callback is undefined, a default return
   *     value to use for the function.
   * @returns {Function} The callback function.
   *
   * @examples
   * createCallback(function() {})                  // instanceof Function
   * createCallback('foo')                          // instanceof Function
   * createCallback('foo')({ foo: 'bar'})           // => 'bar'
   * createCallback({ foo: 'bar' })({ foo: 'bar' }) // => true
   * createCallback({ foo: 'bar' })({ foo: 'baz' }) // => false
   */
  function createCallback(callback, defaultValue) {
    switch (typeof callback) {
      case "function":
        return callback;

      case "string":
        return function(e) {
          return e[callback];
        };

      case "object":
        return function(e) {
          return lazy(callback).all(function(value, key) {
            return e[key] === value;
          });
        };

      case "undefined":
        return defaultValue ?
          function() { return defaultValue; } :
          lazy.identity;

      default:
        throw new Error("Don't know how to make a callback from a " + typeof callback + "!");
    }
  }

  /**
   * Takes a function that returns a value for one argument and produces a
   * function that compares two arguments.
   *
   * @private
   * @param {Function|string|Object} callback A function, string, or object to
   *     convert to a callback using `createCallback`.
   * @returns {Function} A function that accepts two values and returns 1 if
   *     the first is greater, -1 if the second is greater, or 0 if they are
   *     equivalent.
   *
   * @examples
   * createComparator('a')({ a: 1 }, { a: 2 });       // => -1
   * createComparator('a')({ a: 6 }, { a: 2 });       // => 1
   * createComparator('a')({ a: 1 }, { a: 1 });       // => 0
   * createComparator()(3, 5);                        // => -1
   * createComparator()(7, 5);                        // => 1
   * createComparator()(3, 3);                        // => 0
   */
  function createComparator(callback, descending) {
    if (!callback) { return compare; }

    callback = createCallback(callback);

    return function(x, y) {
      return compare(callback(x), callback(y));
    };
  }

  /**
   * Takes a function and returns a function with the same logic but the
   * arguments reversed. Only applies to functions w/ arity=2 as this is private
   * and I can do what I want.
   *
   * @private
   * @param {Function} fn The function to "reverse"
   * @returns {Function} The "reversed" function
   *
   * @examples
   * reverseArguments(function(x, y) { return x + y; })('a', 'b'); // => 'ba'
   */
  function reverseArguments(fn) {
    return function(x, y) { return fn(y, x); };
  }

  /**
   * Creates a Set containing the specified values.
   *
   * @param {...Array} values One or more array(s) of values used to populate the
   *     set.
   * @returns {Set} A new set containing the values passed in.
   */
  function createSet(values) {
    var set = new Set();
    lazy(values || []).flatten().each(function(e) {
      set.add(e);
    });
    return set;
  }

  /**
   * Compares two elements for sorting purposes.
   *
   * @private
   * @param {*} x The left element to compare.
   * @param {*} y The right element to compare.
   * @returns {number} 1 if x > y, -1 if x < y, or 0 if x and y are equal.
   *
   * @examples
   * compare(1, 2)     // => -1
   * compare(1, 1)     // => 0
   * compare(2, 1)     // => 1
   * compare('a', 'b') // => -1
   */
  function compare(x, y) {
    if (x === y) {
      return 0;
    }

    return x > y ? 1 : -1;
  }

  /**
   * Iterates over every element in an array.
   *
   * @param {Array} array The array.
   * @param {Function} fn The function to call on every element, which can return
   *     false to stop the iteration early.
   * @returns {boolean} True if every element in the entire sequence was iterated,
   *     otherwise false.
   */
  function forEach(array, fn) {
    var i = -1,
        len = array.length;

    while (++i < len) {
      if (fn(array[i], i) === false) {
        return false;
      }
    }

    return true;
  }

  function getFirst(sequence) {
    var result;
    sequence.each(function(e) {
      result = e;
      return false;
    });
    return result;
  }

  /**
   * Checks if an element exists in an array.
   *
   * @private
   * @param {Array} array
   * @param {*} element
   * @returns {boolean} Whether or not the element exists in the array.
   *
   * @examples
   * arrayContains([1, 2], 2)              // => true
   * arrayContains([1, 2], 3)              // => false
   * arrayContains([undefined], undefined) // => true
   * arrayContains([NaN], NaN)             // => true
   */
  function arrayContains(array, element) {
    var i = -1,
        length = array.length;

    // Special handling for NaN
    if (element !== element) {
      while (++i < length) {
        if (array[i] !== array[i]) {
          return true;
        }
      }
      return false;
    }

    while (++i < length) {
      if (array[i] === element) {
        return true;
      }
    }
    return false;
  }

  /**
   * Checks if an element exists in an array before a given index.
   *
   * @private
   * @param {Array} array
   * @param {*} element
   * @param {number} index
   * @param {Function} keyFn
   * @returns {boolean}
   *
   * @examples
   * arrayContainsBefore([1, 2, 3], 3, 2) // => false
   * arrayContainsBefore([1, 2, 3], 3, 3) // => true
   */
  function arrayContainsBefore(array, element, index, keyFn) {
    var i = -1;

    if (keyFn) {
      keyFn = createCallback(keyFn);
      while (++i < index) {
        if (keyFn(array[i]) === keyFn(element)) {
          return true;
        }
      }

    } else {
      while (++i < index) {
        if (array[i] === element) {
          return true;
        }
      }
    }

    return false;
  }

  /**
   * Swaps the elements at two specified positions of an array.
   *
   * @private
   * @param {Array} array
   * @param {number} i
   * @param {number} j
   *
   * @examples
   * var array = [1, 2, 3, 4, 5];
   *
   * swap(array, 2, 3) // array == [1, 2, 4, 3, 5]
   */
  function swap(array, i, j) {
    var temp = array[i];
    array[i] = array[j];
    array[j] = temp;
  }

  /**
   * "Clones" a regular expression (but makes it always global).
   *
   * @private
   * @param {RegExp|string} pattern
   * @returns {RegExp}
   */
  function cloneRegex(pattern) {
    return eval("" + pattern + (!pattern.global ? "g" : ""));
  };

  /**
   * A collection of unique elements.
   *
   * @private
   * @constructor
   *
   * @examples
   * var set  = new Set(),
   *     obj1 = {},
   *     obj2 = {},
   *     fn1 = function fn1() {},
   *     fn2 = function fn2() {};
   *
   * set.add('foo')            // => true
   * set.add('foo')            // => false
   * set.add(1)                // => true
   * set.add(1)                // => false
   * set.add('1')              // => true
   * set.add('1')              // => false
   * set.add(obj1)             // => true
   * set.add(obj1)             // => false
   * set.add(obj2)             // => true
   * set.add(fn1)              // => true
   * set.add(fn2)              // => true
   * set.add(fn2)              // => false
   * set.contains('__proto__') // => false
   * set.add('__proto__')      // => true
   * set.add('__proto__')      // => false
   * set.contains('add')       // => false
   * set.add('add')            // => true
   * set.add('add')            // => false
   * set.contains(undefined)   // => false
   * set.add(undefined)        // => true
   * set.contains(undefined)   // => true
   * set.contains('undefined') // => false
   * set.add('undefined')      // => true
   * set.contains('undefined') // => true
   * set.contains(NaN)         // => false
   * set.add(NaN)              // => true
   * set.contains(NaN)         // => true
   * set.contains('NaN')       // => false
   * set.add('NaN')            // => true
   * set.contains('NaN')       // => true
   * set.contains('@foo')      // => false
   * set.add('@foo')           // => true
   * set.contains('@foo')      // => true
   */
  function Set() {
    this.table   = {};
    this.objects = [];
  }

  /**
   * Attempts to add a unique value to the set.
   *
   * @param {*} value The value to add.
   * @returns {boolean} True if the value was added to the set (meaning an equal
   *     value was not already present), or else false.
   */
  Set.prototype.add = function add(value) {
    var table = this.table,
        type  = typeof value,

        // only applies for strings
        firstChar,

        // only applies for objects
        objects;

    switch (type) {
      case "number":
      case "boolean":
      case "undefined":
        if (!table[value]) {
          table[value] = true;
          return true;
        }
        return false;

      case "string":
        // Essentially, escape the first character if it could possibly collide
        // with a number, boolean, or undefined (or a string that happens to start
        // with the escape character!), OR if it could override a special property
        // such as '__proto__' or 'constructor'.
        switch (value.charAt(0)) {
          case "_": // e.g., __proto__
          case "f": // for 'false'
          case "t": // for 'true'
          case "c": // for 'constructor'
          case "u": // for 'undefined'
          case "@": // escaped
          case "0":
          case "1":
          case "2":
          case "3":
          case "4":
          case "5":
          case "6":
          case "7":
          case "8":
          case "9":
          case "N": // for NaN
            value = "@" + value;
        }
        if (!table[value]) {
          table[value] = true;
          return true;
        }
        return false;

      default:
        // For objects and functions, we can't really do anything other than store
        // them in an array and do a linear search for reference equality.
        objects = this.objects;
        if (!arrayContains(objects, value)) {
          objects.push(value);
          return true;
        }
        return false;
    }
  };

  /**
   * Checks whether the set contains a value.
   *
   * @param {*} value The value to check for.
   * @returns {boolean} True if the set contains the value, or else false.
   */
  Set.prototype.contains = function contains(value) {
    var type = typeof value,

        // only applies for strings
        firstChar;

    switch (type) {
      case "number":
      case "boolean":
      case "undefined":
        return !!this.table[value];

      case "string":
        // Essentially, escape the first character if it could possibly collide
        // with a number, boolean, or undefined (or a string that happens to start
        // with the escape character!), OR if it could override a special property
        // such as '__proto__' or 'constructor'.
        switch (value.charAt(0)) {
          case "_": // e.g., __proto__
          case "f": // for 'false'
          case "t": // for 'true'
          case "c": // for 'constructor'
          case "u": // for 'undefined'
          case "@": // escaped
          case "0":
          case "1":
          case "2":
          case "3":
          case "4":
          case "5":
          case "6":
          case "7":
          case "8":
          case "9":
          case "N": // for NaN
            value = "@" + value;
        }
        return !!this.table[value];

      default:
        // For objects and functions, we can't really do anything other than store
        // them in an array and do a linear search for reference equality.
        return arrayContains(this.objects, value);
    }
  };

  /**
   * A "rolling" queue, with a fixed capacity. As items are added to the head,
   * excess items are dropped from the tail.
   *
   * @private
   * @constructor
   *
   * @examples
   * var queue = new Queue(3);
   *
   * queue.add(1).toArray()        // => [1]
   * queue.add(2).toArray()        // => [1, 2]
   * queue.add(3).toArray()        // => [1, 2, 3]
   * queue.add(4).toArray()        // => [2, 3, 4]
   * queue.add(5).add(6).toArray() // => [4, 5, 6]
   * queue.add(7).add(8).toArray() // => [6, 7, 8]
   *
   * // also want to check corner cases
   * new Queue(1).add('foo').add('bar').toArray() // => ['bar']
   * new Queue(0).add('foo').toArray()            // => []
   * new Queue(-1)                                // throws
   *
   * @benchmarks
   * function populateQueue(count, capacity) {
   *   var q = new Queue(capacity);
   *   for (var i = 0; i < count; ++i) {
   *     q.add(i);
   *   }
   * }
   *
   * function populateArray(count, capacity) {
   *   var arr = [];
   *   for (var i = 0; i < count; ++i) {
   *     if (arr.length === capacity) { arr.shift(); }
   *     arr.push(i);
   *   }
   * }
   *
   * populateQueue(100, 10); // populating a Queue
   * populateArray(100, 10); // populating an Array
   */
  function Queue(capacity) {
    this.contents = new Array(capacity);
    this.start    = 0;
    this.count    = 0;
  }

  /**
   * Adds an item to the queue, and returns the queue.
   */
  Queue.prototype.add = function add(element) {
    var contents = this.contents,
        capacity = contents.length,
        start    = this.start;

    if (this.count === capacity) {
      contents[start] = element;
      this.start = (start + 1) % capacity;

    } else {
      contents[this.count++] = element;
    }

    return this;
  };

  /**
   * Returns an array containing snapshot of the queue's contents.
   */
  Queue.prototype.toArray = function toArray() {
    var contents = this.contents,
        start    = this.start,
        count    = this.count;

    var snapshot = contents.slice(start, start + count);
    if (snapshot.length < count) {
      snapshot = snapshot.concat(contents.slice(0, count - snapshot.length));
    }

    return snapshot;
  };

  /**
   * Shared base method for defining new sequence types.
   */
  function defineSequenceType(base, name, overrides) {
    /** @constructor */
    var ctor = function ctor() {};

    // Make this type inherit from the specified base.
    ctor.prototype = new base();

    // Attach overrides to the new sequence type's prototype.
    for (var override in overrides) {
      ctor.prototype[override] = overrides[override];
    }

    // Define a factory method that sets the new sequence's parent to the caller
    // and (optionally) applies any additional initialization logic.
    // Expose this as a chainable method so that we can do:
    // lazy(...).map(...).filter(...).blah(...);
    var factory = function factory() {
      var sequence = new ctor();

      // Every sequence needs a reference to its parent in order to work.
      sequence.parent = this;

      // If a custom init function was supplied, call it now.
      if (sequence.init) {
        sequence.init.apply(sequence, arguments);
      }

      return sequence;
    };

    var methodNames = typeof name === 'string' ? [name] : name;
    for (var i = 0; i < methodNames.length; ++i) {
      base.prototype[methodNames[i]] = factory;
    }

    return ctor;
  }

  /*** Exposing lazy to the world ***/

  // For Node.js
  if (typeof module === "object" && module && module.exports === context) {
    module.exports = lazy;

  // For browsers
  } else {
    context.lazy = lazy;
  }

}(this));

///#source 1 1 Plugins/selectBox.js
/*!
 * jQuery Selectbox plugin 0.1.3
 *
 * Copyright 2011, Dimitar Ivanov (http://www.bulgaria-web-developers.com/projects/javascript/selectbox/)
 * Licensed under the MIT (http://www.opensource.org/licenses/mit-license.php) license.
 * 
 * Date: Wed Jul 29 23:20:57 2011 +0200
 */
(function ($, undefined) {
	var PROP_NAME = 'selectbox',
		FALSE = false,
		TRUE = true;
	/**
	 * Selectbox manager.
	 * Use the singleton instance of this class, $.selectbox, to interact with the select box.
	 * Settings for (groups of) select boxes are maintained in an instance object,
	 * allowing multiple different settings on the same page
	 */
	function Selectbox() {
		this._state = [];
		this._defaults = { // Global defaults for all the select box instances
			classHolder: "sbHolder",
			classHolderDisabled: "sbHolderDisabled",
			classSelector: "sbSelector",
			classOptions: "sbOptions",
			classGroup: "sbGroup",
			classSub: "sbSub",
			classDisabled: "sbDisabled",
			classToggleOpen: "sbToggleOpen",
			classToggle: "sbToggle",
			speed: 200,
			effect: "slide", // "slide" or "fade"
			onChange: null, //Define a callback function when the selectbox is changed
			onOpen: null, //Define a callback function when the selectbox is open
			onClose: null //Define a callback function when the selectbox is closed
		};
	}
	
	$.extend(Selectbox.prototype, {
		/**
		 * Is the first field in a jQuery collection open as a selectbox
		 * 
		 * @param {Object} target
		 * @return {Boolean}
		 */
		_isOpenSelectbox: function (target) {
			if (!target) {
				return FALSE;
			}
			var inst = this._getInst(target);
			return inst.isOpen;
		},
		/**
		 * Is the first field in a jQuery collection disabled as a selectbox
		 * 
		 * @param {HTMLElement} target
		 * @return {Boolean}
		 */
		_isDisabledSelectbox: function (target) {
			if (!target) {
				return FALSE;
			}
			var inst = this._getInst(target);
			return inst.isDisabled;
		},
		/**
		 * Attach the select box to a jQuery selection.
		 * 
		 * @param {HTMLElement} target
		 * @param {Object} settings
		 */
		_attachSelectbox: function (target, settings) {
			if (this._getInst(target)) {
				return FALSE;
			}
			var $target = $(target),
				self = this,
				inst = self._newInst($target),
				sbHolder, sbSelector, sbToggle, sbOptions,
				s = FALSE, optGroup = $target.find("optgroup"), opts = $target.find("option"), olen = opts.length;
				
			$target.attr("sb", inst.uid);
				
			$.extend(inst.settings, self._defaults, settings);
			self._state[inst.uid] = FALSE;
			$target.hide();
			
			function closeOthers() {
				var key, uid = this.attr("id").split("_")[1];
				for (key in self._state) {
					if (key !== uid) {
						if (self._state.hasOwnProperty(key)) {
							if ($(":input[sb='" + key + "']")[0]) {
								self._closeSelectbox($(":input[sb='" + key + "']")[0]);
							}
						}
					}
				}
			}
			
			sbHolder = $("<div>", {
				"id": "sbHolder_" + inst.uid,
				"class": inst.settings.classHolder
			});
			
			sbSelector = $("<a>", {
				"id": "sbSelector_" + inst.uid,
				"href": "#",
				"class": inst.settings.classSelector,
				"click": function (e) {
					e.preventDefault();
					closeOthers.apply($(this), []);
					var uid = $(this).attr("id").split("_")[1];
					if (self._state[uid]) {
						self._closeSelectbox(target);
					} else {
						self._openSelectbox(target);
					}
				}
			});
			
			sbToggle = $("<a>", {
				"id": "sbToggle_" + inst.uid,
				"href": "#",
				"class": inst.settings.classToggle,
				"click": function (e) {
					e.preventDefault();
					closeOthers.apply($(this), []);
					var uid = $(this).attr("id").split("_")[1];
					if (self._state[uid]) {
						self._closeSelectbox(target);
					} else {
						self._openSelectbox(target);
					}
				}
			});
			sbToggle.appendTo(sbHolder);

			sbOptions = $("<ul>", {
				"id": "sbOptions_" + inst.uid,
				"class": inst.settings.classOptions,
				"css": {
					"display": "none"

				}
			});
			
			$target.children().each(function(i) {
				var that = $(this), li, config = {};
				if (that.is("option")) {
					getOptions(that);
				} else if (that.is("optgroup")) {
					li = $("<li>");
					$("<span>", {
						"text": that.attr("label")
					}).addClass(inst.settings.classGroup).appendTo(li);
					li.appendTo(sbOptions);
					if (that.is(":disabled")) {
						config.disabled = true;
					}
					config.sub = true;
					getOptions(that.find("option"), config);
				}
			});
			
			function getOptions () {
				var sub = arguments[1] && arguments[1].sub ? true : false,
					disabled = arguments[1] && arguments[1].disabled ? true : false;
				arguments[0].each(function (i) {
					var that = $(this),
						li = $("<li>"),
						child;
					if (that.is(":selected")) {
						sbSelector.text(that.text());
						s = TRUE;
					}
					if (i === olen - 1) {
						li.addClass("last");
					}
					if (!that.is(":disabled") && !disabled) {
						child = $("<a>", {
							"href": "#" + that.val(),
							"rel": that.val(), 
							"text": that.text(),
							"click": function (e) {
								e.preventDefault();
								var t = sbToggle,
									uid = t.attr("id").split("_")[1];
								self._changeSelectbox(target, $(this).attr("rel"), $(this).text());
								self._closeSelectbox(target);
							}
						});
						if (sub) {
							child.addClass(inst.settings.classSub);
						}
						child.appendTo(li);
					} else {
						child = $("<span>", {
							"text": that.text()
						}).addClass(inst.settings.classDisabled);
						if (sub) {
							child.addClass(inst.settings.classSub);
						}
						child.appendTo(li);
					}
					li.appendTo(sbOptions);
				});
			}
			
			if (!s) {
				sbSelector.text(opts.first().text());
			}
			
			$.data(target, PROP_NAME, inst);
			
			sbSelector.appendTo(sbHolder);
			sbOptions.appendTo(sbHolder);			
			sbHolder.insertAfter($target);
		},
		/**
		 * Remove the selectbox functionality completely. This will return the element back to its pre-init state.
		 * 
		 * @param {HTMLElement} target
		 */
		_detachSelectbox: function (target) {
			var inst = this._getInst(target);
			if (!inst) {
				return FALSE;
			}
			$("#sbHolder_" + inst.uid).remove();
			$.data(target, PROP_NAME, null);
			$(target).show();			
		},
		/**
		 * Change selected attribute of the selectbox.
		 * 
		 * @param {HTMLElement} target
		 * @param {String} value
		 * @param {String} text
		 */
		_changeSelectbox: function (target, value, text) {
			var inst = this._getInst(target),
				onChange = this._get(inst, 'onChange');
			$("#sbSelector_" + inst.uid).text(text);
			$(target).find("option[value='" + value + "']").attr("selected", TRUE);
			if (onChange) {
				onChange.apply((inst.input ? inst.input[0] : null), [value, inst]);
			} else if (inst.input) {
				inst.input.trigger('change');
			}
		},
		/**
		 * Enable the selectbox.
		 * 
		 * @param {HTMLElement} target
		 */
		_enableSelectbox: function (target) {
			var inst = this._getInst(target);
			if (!inst || !inst.isDisabled) {
				return FALSE;
			}
			$("#sbHolder_" + inst.uid).removeClass(inst.settings.classHolderDisabled);
			inst.isDisabled = FALSE;
			$.data(target, PROP_NAME, inst);
		},
		/**
		 * Disable the selectbox.
		 * 
		 * @param {HTMLElement} target
		 */
		_disableSelectbox: function (target) {
			var inst = this._getInst(target);
			if (!inst || inst.isDisabled) {
				return FALSE;
			}
			$("#sbHolder_" + inst.uid).addClass(inst.settings.classHolderDisabled);
			inst.isDisabled = TRUE;
			$.data(target, PROP_NAME, inst);
		},
		/**
		 * Get or set any selectbox option. If no value is specified, will act as a getter.
		 * 
		 * @param {HTMLElement} target
		 * @param {String} name
		 * @param {Object} value
		 */
		_optionSelectbox: function (target, name, value) {
			var inst = this._getInst(target);
			if (!inst) {
				return FALSE;
			}
			//TODO check name
			inst[name] = value;
			$.data(target, PROP_NAME, inst);
		},
		/**
		 * Call up attached selectbox
		 * 
		 * @param {HTMLElement} target
		 */
		_openSelectbox: function (target) {
			var inst = this._getInst(target);
			//if (!inst || this._state[inst.uid] || inst.isDisabled) {
			if (!inst || inst.isOpen || inst.isDisabled) {
				return;
			}
			var	el = $("#sbOptions_" + inst.uid),
				viewportHeight = parseInt($(window).height(), 10),
				offset = $("#sbHolder_" + inst.uid).offset(),
				scrollTop = $(window).scrollTop(),
				height = el.prev().height(),
				diff = viewportHeight - (offset.top - scrollTop) - height / 2,
				onOpen = this._get(inst, 'onOpen');
			var maxHeight = diff - height <= 300 ? 300 : diff - height;
			el.css({
				"top": height + "px",
				"maxHeight": maxHeight  + "px"
			});
			inst.settings.effect === "fade" ? el.fadeIn(inst.settings.speed) : el.slideDown(inst.settings.speed);
			$("#sbToggle_" + inst.uid).addClass(inst.settings.classToggleOpen);
			this._state[inst.uid] = TRUE;
			inst.isOpen = TRUE;
			if (onOpen) {
				onOpen.apply((inst.input ? inst.input[0] : null), [inst]);
			}
			$.data(target, PROP_NAME, inst);
		},
		/**
		 * Close opened selectbox
		 * 
		 * @param {HTMLElement} target
		 */
		_closeSelectbox: function (target) {
			var inst = this._getInst(target);
			//if (!inst || !this._state[inst.uid]) {
			if (!inst || !inst.isOpen) {
				return;
			}
			var onClose = this._get(inst, 'onClose');
			inst.settings.effect === "fade" ? $("#sbOptions_" + inst.uid).fadeOut(inst.settings.speed) : $("#sbOptions_" + inst.uid).slideUp(inst.settings.speed);
			$("#sbToggle_" + inst.uid).removeClass(inst.settings.classToggleOpen);
			this._state[inst.uid] = FALSE;
			inst.isOpen = FALSE;
			if (onClose) {
				onClose.apply((inst.input ? inst.input[0] : null), [inst]);
			}
			$.data(target, PROP_NAME, inst);
		},
		/**
		 * Create a new instance object
		 * 
		 * @param {HTMLElement} target
		 * @return {Object}
		 */
		_newInst: function(target) {
			var id = target[0].id.replace(/([^A-Za-z0-9_-])/g, '\\\\$1');
			return {
				id: id, 
				input: target, 
				uid: Math.floor(Math.random() * 99999999),
				isOpen: FALSE,
				isDisabled: FALSE,
				settings: {}
			}; 
		},
		/**
		 * Retrieve the instance data for the target control.
		 * 
		 * @param {HTMLElement} target
		 * @return {Object} - the associated instance data
		 * @throws error if a jQuery problem getting data
		 */
		_getInst: function(target) {
			try {
				return $.data(target, PROP_NAME);
			}
			catch (err) {
				throw 'Missing instance data for this selectbox';
			}
		},
		/**
		 * Get a setting value, defaulting if necessary
		 * 
		 * @param {Object} inst
		 * @param {String} name
		 * @return {Mixed}
		 */
		_get: function(inst, name) {
			return inst.settings[name] !== undefined ? inst.settings[name] : this._defaults[name];
		}
	});

	/**
	 * Invoke the selectbox functionality.
	 * 
	 * @param {Object|String} options
	 * @return {Object}
	 */
	$.fn.selectbox = function (options) {
		
		var otherArgs = Array.prototype.slice.call(arguments, 1);
		if (typeof options == 'string' && options == 'isDisabled') {
			return $.selectbox['_' + options + 'Selectbox'].apply($.selectbox, [this[0]].concat(otherArgs));
		}
		
		if (options == 'option' && arguments.length == 2 && typeof arguments[1] == 'string') {
			return $.selectbox['_' + options + 'Selectbox'].apply($.selectbox, [this[0]].concat(otherArgs));
		}
		
		return this.each(function() {
			typeof options == 'string' ?
				$.selectbox['_' + options + 'Selectbox'].apply($.selectbox, [this].concat(otherArgs)) :
				$.selectbox._attachSelectbox(this, options);
		});
	};
	
	$.selectbox = new Selectbox(); // singleton instance
	$.selectbox.version = "0.1.3";
})(jQuery);


(function ($) {
    $(function () {
        $(".select").selectbox({
        });
    });
})(jQuery);


///#source 1 1 Plugins/jquery.dotdotdot.min.js
/*	
 *	jQuery dotdotdot 1.6.10
 *	
 *	Copyright (c) 2013 Fred Heusschen
 *	www.frebsite.nl
 *
 *	Plugin website:
 *	dotdotdot.frebsite.nl
 *
 *	Dual licensed under the MIT and GPL licenses.
 *	http://en.wikipedia.org/wiki/MIT_License
 *	http://en.wikipedia.org/wiki/GNU_General_Public_License
 */
!function(t,e){function n(t,e,n){var r=t.children(),o=!1;t.empty();for(var i=0,d=r.length;d>i;i++){var l=r.eq(i);if(t.append(l),n&&t.append(n),a(t,e)){l.remove(),o=!0;break}n&&n.detach()}return o}function r(e,n,i,d,l){var s=!1,c="table, thead, tbody, tfoot, tr, col, colgroup, object, embed, param, ol, ul, dl, blockquote, select, optgroup, option, textarea, script, style",u="script";return e.contents().detach().each(function(){var h=this,f=t(h);if("undefined"==typeof h||3==h.nodeType&&0==t.trim(h.data).length)return!0;if(f.is(u))e.append(f);else{if(s)return!0;e.append(f),l&&e[e.is(c)?"after":"append"](l),a(i,d)&&(s=3==h.nodeType?o(f,n,i,d,l):r(f,n,i,d,l),s||(f.detach(),s=!0)),s||l&&l.detach()}}),s}function o(e,n,r,o,d){var c=e[0];if(!c)return!1;var h=s(c),f=-1!==h.indexOf(" ")?" ":"　",p="letter"==o.wrap?"":f,g=h.split(p),v=-1,w=-1,b=0,y=g.length-1;for(o.fallbackToLetter&&0==b&&0==y&&(p="",g=h.split(p),y=g.length-1);y>=b&&(0!=b||0!=y);){var m=Math.floor((b+y)/2);if(m==w)break;w=m,l(c,g.slice(0,w+1).join(p)+o.ellipsis),a(r,o)?(y=w,o.fallbackToLetter&&0==b&&0==y&&(p="",g=g[0].split(p),v=-1,w=-1,b=0,y=g.length-1)):(v=w,b=w)}if(-1==v||1==g.length&&0==g[0].length){var x=e.parent();e.detach();var T=d&&d.closest(x).length?d.length:0;x.contents().length>T?c=u(x.contents().eq(-1-T),n):(c=u(x,n,!0),T||x.detach()),c&&(h=i(s(c),o),l(c,h),T&&d&&t(c).parent().append(d))}else h=i(g.slice(0,v+1).join(p),o),l(c,h);return!0}function a(t,e){return t.innerHeight()>e.maxHeight}function i(e,n){for(;t.inArray(e.slice(-1),n.lastCharacter.remove)>-1;)e=e.slice(0,-1);return t.inArray(e.slice(-1),n.lastCharacter.noEllipsis)<0&&(e+=n.ellipsis),e}function d(t){return{width:t.innerWidth(),height:t.innerHeight()}}function l(t,e){t.innerText?t.innerText=e:t.nodeValue?t.nodeValue=e:t.textContent&&(t.textContent=e)}function s(t){return t.innerText?t.innerText:t.nodeValue?t.nodeValue:t.textContent?t.textContent:""}function c(t){do t=t.previousSibling;while(t&&1!==t.nodeType&&3!==t.nodeType);return t}function u(e,n,r){var o,a=e&&e[0];if(a){if(!r){if(3===a.nodeType)return a;if(t.trim(e.text()))return u(e.contents().last(),n)}for(o=c(a);!o;){if(e=e.parent(),e.is(n)||!e.length)return!1;o=c(e[0])}if(o)return u(t(o),n)}return!1}function h(e,n){return e?"string"==typeof e?(e=t(e,n),e.length?e:!1):e.jquery?e:!1:!1}function f(t){for(var e=t.innerHeight(),n=["paddingTop","paddingBottom"],r=0,o=n.length;o>r;r++){var a=parseInt(t.css(n[r]),10);isNaN(a)&&(a=0),e-=a}return e}if(!t.fn.dotdotdot){t.fn.dotdotdot=function(e){if(0==this.length)return t.fn.dotdotdot.debug('No element found for "'+this.selector+'".'),this;if(this.length>1)return this.each(function(){t(this).dotdotdot(e)});var o=this;o.data("dotdotdot")&&o.trigger("destroy.dot"),o.data("dotdotdot-style",o.attr("style")||""),o.css("word-wrap","break-word"),"nowrap"===o.css("white-space")&&o.css("white-space","normal"),o.bind_events=function(){return o.bind("update.dot",function(e,d){e.preventDefault(),e.stopPropagation(),l.maxHeight="number"==typeof l.height?l.height:f(o),l.maxHeight+=l.tolerance,"undefined"!=typeof d&&(("string"==typeof d||d instanceof HTMLElement)&&(d=t("<div />").append(d).contents()),d instanceof t&&(i=d)),g=o.wrapInner('<div class="dotdotdot" />').children(),g.contents().detach().end().append(i.clone(!0)).find("br").replaceWith("  <br />  ").end().css({height:"auto",width:"auto",border:"none",padding:0,margin:0});var c=!1,u=!1;return s.afterElement&&(c=s.afterElement.clone(!0),c.show(),s.afterElement.detach()),a(g,l)&&(u="children"==l.wrap?n(g,l,c):r(g,o,g,l,c)),g.replaceWith(g.contents()),g=null,t.isFunction(l.callback)&&l.callback.call(o[0],u,i),s.isTruncated=u,u}).bind("isTruncated.dot",function(t,e){return t.preventDefault(),t.stopPropagation(),"function"==typeof e&&e.call(o[0],s.isTruncated),s.isTruncated}).bind("originalContent.dot",function(t,e){return t.preventDefault(),t.stopPropagation(),"function"==typeof e&&e.call(o[0],i),i}).bind("destroy.dot",function(t){t.preventDefault(),t.stopPropagation(),o.unwatch().unbind_events().contents().detach().end().append(i).attr("style",o.data("dotdotdot-style")||"").data("dotdotdot",!1)}),o},o.unbind_events=function(){return o.unbind(".dot"),o},o.watch=function(){if(o.unwatch(),"window"==l.watch){var e=t(window),n=e.width(),r=e.height();e.bind("resize.dot"+s.dotId,function(){n==e.width()&&r==e.height()&&l.windowResizeFix||(n=e.width(),r=e.height(),u&&clearInterval(u),u=setTimeout(function(){o.trigger("update.dot")},10))})}else c=d(o),u=setInterval(function(){var t=d(o);(c.width!=t.width||c.height!=t.height)&&(o.trigger("update.dot"),c=d(o))},100);return o},o.unwatch=function(){return t(window).unbind("resize.dot"+s.dotId),u&&clearInterval(u),o};var i=o.contents(),l=t.extend(!0,{},t.fn.dotdotdot.defaults,e),s={},c={},u=null,g=null;return l.lastCharacter.remove instanceof Array||(l.lastCharacter.remove=t.fn.dotdotdot.defaultArrays.lastCharacter.remove),l.lastCharacter.noEllipsis instanceof Array||(l.lastCharacter.noEllipsis=t.fn.dotdotdot.defaultArrays.lastCharacter.noEllipsis),s.afterElement=h(l.after,o),s.isTruncated=!1,s.dotId=p++,o.data("dotdotdot",!0).bind_events().trigger("update.dot"),l.watch&&o.watch(),o},t.fn.dotdotdot.defaults={ellipsis:"... ",wrap:"word",fallbackToLetter:!0,lastCharacter:{},tolerance:0,callback:null,after:null,height:null,watch:!1,windowResizeFix:!0},t.fn.dotdotdot.defaultArrays={lastCharacter:{remove:[" ","　",",",";",".","!","?"],noEllipsis:[]}},t.fn.dotdotdot.debug=function(){};var p=1,g=t.fn.html;t.fn.html=function(n){return n!=e&&!t.isFunction(n)&&this.data("dotdotdot")?this.trigger("update",[n]):g.apply(this,arguments)};var v=t.fn.text;t.fn.text=function(n){return n!=e&&!t.isFunction(n)&&this.data("dotdotdot")?(n=t("<div />").text(n).html(),this.trigger("update",[n])):v.apply(this,arguments)}}}(jQuery);
///#source 1 1 Plugins/jquery-ui.min.js
/*! jQuery UI - v1.11.2 - 2014-10-16
* http://jqueryui.com
* Includes: core.js, widget.js, mouse.js, position.js, accordion.js, autocomplete.js, button.js, datepicker.js, dialog.js, draggable.js, droppable.js, effect.js, effect-blind.js, effect-bounce.js, effect-clip.js, effect-drop.js, effect-explode.js, effect-fade.js, effect-fold.js, effect-highlight.js, effect-puff.js, effect-pulsate.js, effect-scale.js, effect-shake.js, effect-size.js, effect-slide.js, effect-transfer.js, menu.js, progressbar.js, resizable.js, selectable.js, selectmenu.js, slider.js, sortable.js, spinner.js, tabs.js, tooltip.js
* Copyright 2014 jQuery Foundation and other contributors; Licensed MIT */

(function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e(jQuery)})(function(e){function t(t,s){var n,a,o,r=t.nodeName.toLowerCase();return"area"===r?(n=t.parentNode,a=n.name,t.href&&a&&"map"===n.nodeName.toLowerCase()?(o=e("img[usemap='#"+a+"']")[0],!!o&&i(o)):!1):(/input|select|textarea|button|object/.test(r)?!t.disabled:"a"===r?t.href||s:s)&&i(t)}function i(t){return e.expr.filters.visible(t)&&!e(t).parents().addBack().filter(function(){return"hidden"===e.css(this,"visibility")}).length}function s(e){for(var t,i;e.length&&e[0]!==document;){if(t=e.css("position"),("absolute"===t||"relative"===t||"fixed"===t)&&(i=parseInt(e.css("zIndex"),10),!isNaN(i)&&0!==i))return i;e=e.parent()}return 0}function n(){this._curInst=null,this._keyEvent=!1,this._disabledInputs=[],this._datepickerShowing=!1,this._inDialog=!1,this._mainDivId="ui-datepicker-div",this._inlineClass="ui-datepicker-inline",this._appendClass="ui-datepicker-append",this._triggerClass="ui-datepicker-trigger",this._dialogClass="ui-datepicker-dialog",this._disableClass="ui-datepicker-disabled",this._unselectableClass="ui-datepicker-unselectable",this._currentClass="ui-datepicker-current-day",this._dayOverClass="ui-datepicker-days-cell-over",this.regional=[],this.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk",dateFormat:"mm/dd/yy",firstDay:0,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},this._defaults={showOn:"focus",showAnim:"fadeIn",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:!1,hideIfNoPrevNext:!1,navigationAsDateFormat:!1,gotoCurrent:!1,changeMonth:!1,changeYear:!1,yearRange:"c-10:c+10",showOtherMonths:!1,selectOtherMonths:!1,showWeek:!1,calculateWeek:this.iso8601Week,shortYearCutoff:"+10",minDate:null,maxDate:null,duration:"fast",beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:!0,showButtonPanel:!1,autoSize:!1,disabled:!1},e.extend(this._defaults,this.regional[""]),this.regional.en=e.extend(!0,{},this.regional[""]),this.regional["en-US"]=e.extend(!0,{},this.regional.en),this.dpDiv=a(e("<div id='"+this._mainDivId+"' class='ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>"))}function a(t){var i="button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a";return t.delegate(i,"mouseout",function(){e(this).removeClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&e(this).removeClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&e(this).removeClass("ui-datepicker-next-hover")}).delegate(i,"mouseover",o)}function o(){e.datepicker._isDisabledDatepicker(v.inline?v.dpDiv.parent()[0]:v.input[0])||(e(this).parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover"),e(this).addClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&e(this).addClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&e(this).addClass("ui-datepicker-next-hover"))}function r(t,i){e.extend(t,i);for(var s in i)null==i[s]&&(t[s]=i[s]);return t}function h(e){return function(){var t=this.element.val();e.apply(this,arguments),this._refresh(),t!==this.element.val()&&this._trigger("change")}}e.ui=e.ui||{},e.extend(e.ui,{version:"1.11.2",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),e.fn.extend({scrollParent:function(t){var i=this.css("position"),s="absolute"===i,n=t?/(auto|scroll|hidden)/:/(auto|scroll)/,a=this.parents().filter(function(){var t=e(this);return s&&"static"===t.css("position")?!1:n.test(t.css("overflow")+t.css("overflow-y")+t.css("overflow-x"))}).eq(0);return"fixed"!==i&&a.length?a:e(this[0].ownerDocument||document)},uniqueId:function(){var e=0;return function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++e)})}}(),removeUniqueId:function(){return this.each(function(){/^ui-id-\d+$/.test(this.id)&&e(this).removeAttr("id")})}}),e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(i){return!!e.data(i,t)}}):function(t,i,s){return!!e.data(t,s[3])},focusable:function(i){return t(i,!isNaN(e.attr(i,"tabindex")))},tabbable:function(i){var s=e.attr(i,"tabindex"),n=isNaN(s);return(n||s>=0)&&t(i,!n)}}),e("<a>").outerWidth(1).jquery||e.each(["Width","Height"],function(t,i){function s(t,i,s,a){return e.each(n,function(){i-=parseFloat(e.css(t,"padding"+this))||0,s&&(i-=parseFloat(e.css(t,"border"+this+"Width"))||0),a&&(i-=parseFloat(e.css(t,"margin"+this))||0)}),i}var n="Width"===i?["Left","Right"]:["Top","Bottom"],a=i.toLowerCase(),o={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};e.fn["inner"+i]=function(t){return void 0===t?o["inner"+i].call(this):this.each(function(){e(this).css(a,s(this,t)+"px")})},e.fn["outer"+i]=function(t,n){return"number"!=typeof t?o["outer"+i].call(this,t):this.each(function(){e(this).css(a,s(this,t,!0,n)+"px")})}}),e.fn.addBack||(e.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}),e("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(e.fn.removeData=function(t){return function(i){return arguments.length?t.call(this,e.camelCase(i)):t.call(this)}}(e.fn.removeData)),e.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),e.fn.extend({focus:function(t){return function(i,s){return"number"==typeof i?this.each(function(){var t=this;setTimeout(function(){e(t).focus(),s&&s.call(t)},i)}):t.apply(this,arguments)}}(e.fn.focus),disableSelection:function(){var e="onselectstart"in document.createElement("div")?"selectstart":"mousedown";return function(){return this.bind(e+".ui-disableSelection",function(e){e.preventDefault()})}}(),enableSelection:function(){return this.unbind(".ui-disableSelection")},zIndex:function(t){if(void 0!==t)return this.css("zIndex",t);if(this.length)for(var i,s,n=e(this[0]);n.length&&n[0]!==document;){if(i=n.css("position"),("absolute"===i||"relative"===i||"fixed"===i)&&(s=parseInt(n.css("zIndex"),10),!isNaN(s)&&0!==s))return s;n=n.parent()}return 0}}),e.ui.plugin={add:function(t,i,s){var n,a=e.ui[t].prototype;for(n in s)a.plugins[n]=a.plugins[n]||[],a.plugins[n].push([i,s[n]])},call:function(e,t,i,s){var n,a=e.plugins[t];if(a&&(s||e.element[0].parentNode&&11!==e.element[0].parentNode.nodeType))for(n=0;a.length>n;n++)e.options[a[n][0]]&&a[n][1].apply(e.element,i)}};var l=0,u=Array.prototype.slice;e.cleanData=function(t){return function(i){var s,n,a;for(a=0;null!=(n=i[a]);a++)try{s=e._data(n,"events"),s&&s.remove&&e(n).triggerHandler("remove")}catch(o){}t(i)}}(e.cleanData),e.widget=function(t,i,s){var n,a,o,r,h={},l=t.split(".")[0];return t=t.split(".")[1],n=l+"-"+t,s||(s=i,i=e.Widget),e.expr[":"][n.toLowerCase()]=function(t){return!!e.data(t,n)},e[l]=e[l]||{},a=e[l][t],o=e[l][t]=function(e,t){return this._createWidget?(arguments.length&&this._createWidget(e,t),void 0):new o(e,t)},e.extend(o,a,{version:s.version,_proto:e.extend({},s),_childConstructors:[]}),r=new i,r.options=e.widget.extend({},r.options),e.each(s,function(t,s){return e.isFunction(s)?(h[t]=function(){var e=function(){return i.prototype[t].apply(this,arguments)},n=function(e){return i.prototype[t].apply(this,e)};return function(){var t,i=this._super,a=this._superApply;return this._super=e,this._superApply=n,t=s.apply(this,arguments),this._super=i,this._superApply=a,t}}(),void 0):(h[t]=s,void 0)}),o.prototype=e.widget.extend(r,{widgetEventPrefix:a?r.widgetEventPrefix||t:t},h,{constructor:o,namespace:l,widgetName:t,widgetFullName:n}),a?(e.each(a._childConstructors,function(t,i){var s=i.prototype;e.widget(s.namespace+"."+s.widgetName,o,i._proto)}),delete a._childConstructors):i._childConstructors.push(o),e.widget.bridge(t,o),o},e.widget.extend=function(t){for(var i,s,n=u.call(arguments,1),a=0,o=n.length;o>a;a++)for(i in n[a])s=n[a][i],n[a].hasOwnProperty(i)&&void 0!==s&&(t[i]=e.isPlainObject(s)?e.isPlainObject(t[i])?e.widget.extend({},t[i],s):e.widget.extend({},s):s);return t},e.widget.bridge=function(t,i){var s=i.prototype.widgetFullName||t;e.fn[t]=function(n){var a="string"==typeof n,o=u.call(arguments,1),r=this;return n=!a&&o.length?e.widget.extend.apply(null,[n].concat(o)):n,a?this.each(function(){var i,a=e.data(this,s);return"instance"===n?(r=a,!1):a?e.isFunction(a[n])&&"_"!==n.charAt(0)?(i=a[n].apply(a,o),i!==a&&void 0!==i?(r=i&&i.jquery?r.pushStack(i.get()):i,!1):void 0):e.error("no such method '"+n+"' for "+t+" widget instance"):e.error("cannot call methods on "+t+" prior to initialization; "+"attempted to call method '"+n+"'")}):this.each(function(){var t=e.data(this,s);t?(t.option(n||{}),t._init&&t._init()):e.data(this,s,new i(n,this))}),r}},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(t,i){i=e(i||this.defaultElement||this)[0],this.element=e(i),this.uuid=l++,this.eventNamespace="."+this.widgetName+this.uuid,this.bindings=e(),this.hoverable=e(),this.focusable=e(),i!==this&&(e.data(i,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===i&&this.destroy()}}),this.document=e(i.style?i.ownerDocument:i.document||i),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this.options=e.widget.extend({},this.options,this._getCreateOptions(),t),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:e.noop,_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled "+"ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:e.noop,widget:function(){return this.element},option:function(t,i){var s,n,a,o=t;if(0===arguments.length)return e.widget.extend({},this.options);if("string"==typeof t)if(o={},s=t.split("."),t=s.shift(),s.length){for(n=o[t]=e.widget.extend({},this.options[t]),a=0;s.length-1>a;a++)n[s[a]]=n[s[a]]||{},n=n[s[a]];if(t=s.pop(),1===arguments.length)return void 0===n[t]?null:n[t];n[t]=i}else{if(1===arguments.length)return void 0===this.options[t]?null:this.options[t];o[t]=i}return this._setOptions(o),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return this.options[e]=t,"disabled"===e&&(this.widget().toggleClass(this.widgetFullName+"-disabled",!!t),t&&(this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus"))),this},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_on:function(t,i,s){var n,a=this;"boolean"!=typeof t&&(s=i,i=t,t=!1),s?(i=n=e(i),this.bindings=this.bindings.add(i)):(s=i,i=this.element,n=this.widget()),e.each(s,function(s,o){function r(){return t||a.options.disabled!==!0&&!e(this).hasClass("ui-state-disabled")?("string"==typeof o?a[o]:o).apply(a,arguments):void 0}"string"!=typeof o&&(r.guid=o.guid=o.guid||r.guid||e.guid++);var h=s.match(/^([\w:-]*)\s*(.*)$/),l=h[1]+a.eventNamespace,u=h[2];u?n.delegate(u,l,r):i.bind(l,r)})},_off:function(t,i){i=(i||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,t.unbind(i).undelegate(i),this.bindings=e(this.bindings.not(t).get()),this.focusable=e(this.focusable.not(t).get()),this.hoverable=e(this.hoverable.not(t).get())},_delay:function(e,t){function i(){return("string"==typeof e?s[e]:e).apply(s,arguments)}var s=this;return setTimeout(i,t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){e(t.currentTarget).addClass("ui-state-hover")},mouseleave:function(t){e(t.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){e(t.currentTarget).addClass("ui-state-focus")},focusout:function(t){e(t.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(t,i,s){var n,a,o=this.options[t];if(s=s||{},i=e.Event(i),i.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),i.target=this.element[0],a=i.originalEvent)for(n in a)n in i||(i[n]=a[n]);return this.element.trigger(i,s),!(e.isFunction(o)&&o.apply(this.element[0],[i].concat(s))===!1||i.isDefaultPrevented())}},e.each({show:"fadeIn",hide:"fadeOut"},function(t,i){e.Widget.prototype["_"+t]=function(s,n,a){"string"==typeof n&&(n={effect:n});var o,r=n?n===!0||"number"==typeof n?i:n.effect||i:t;n=n||{},"number"==typeof n&&(n={duration:n}),o=!e.isEmptyObject(n),n.complete=a,n.delay&&s.delay(n.delay),o&&e.effects&&e.effects.effect[r]?s[t](n):r!==t&&s[r]?s[r](n.duration,n.easing,a):s.queue(function(i){e(this)[t](),a&&a.call(s[0]),i()})}}),e.widget;var d=!1;e(document).mouseup(function(){d=!1}),e.widget("ui.mouse",{version:"1.11.2",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.bind("mousedown."+this.widgetName,function(e){return t._mouseDown(e)}).bind("click."+this.widgetName,function(i){return!0===e.data(i.target,t.widgetName+".preventClickEvent")?(e.removeData(i.target,t.widgetName+".preventClickEvent"),i.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(t){if(!d){this._mouseMoved=!1,this._mouseStarted&&this._mouseUp(t),this._mouseDownEvent=t;var i=this,s=1===t.which,n="string"==typeof this.options.cancel&&t.target.nodeName?e(t.target).closest(this.options.cancel).length:!1;return s&&!n&&this._mouseCapture(t)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){i.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(t)!==!1,!this._mouseStarted)?(t.preventDefault(),!0):(!0===e.data(t.target,this.widgetName+".preventClickEvent")&&e.removeData(t.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(e){return i._mouseMove(e)},this._mouseUpDelegate=function(e){return i._mouseUp(e)},this.document.bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),t.preventDefault(),d=!0,!0)):!0}},_mouseMove:function(t){if(this._mouseMoved){if(e.ui.ie&&(!document.documentMode||9>document.documentMode)&&!t.button)return this._mouseUp(t);if(!t.which)return this._mouseUp(t)}return(t.which||t.button)&&(this._mouseMoved=!0),this._mouseStarted?(this._mouseDrag(t),t.preventDefault()):(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,t)!==!1,this._mouseStarted?this._mouseDrag(t):this._mouseUp(t)),!this._mouseStarted)},_mouseUp:function(t){return this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,t.target===this._mouseDownEvent.target&&e.data(t.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(t)),d=!1,!1},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}}),function(){function t(e,t,i){return[parseFloat(e[0])*(p.test(e[0])?t/100:1),parseFloat(e[1])*(p.test(e[1])?i/100:1)]}function i(t,i){return parseInt(e.css(t,i),10)||0}function s(t){var i=t[0];return 9===i.nodeType?{width:t.width(),height:t.height(),offset:{top:0,left:0}}:e.isWindow(i)?{width:t.width(),height:t.height(),offset:{top:t.scrollTop(),left:t.scrollLeft()}}:i.preventDefault?{width:0,height:0,offset:{top:i.pageY,left:i.pageX}}:{width:t.outerWidth(),height:t.outerHeight(),offset:t.offset()}}e.ui=e.ui||{};var n,a,o=Math.max,r=Math.abs,h=Math.round,l=/left|center|right/,u=/top|center|bottom/,d=/[\+\-]\d+(\.[\d]+)?%?/,c=/^\w+/,p=/%$/,f=e.fn.position;e.position={scrollbarWidth:function(){if(void 0!==n)return n;var t,i,s=e("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),a=s.children()[0];return e("body").append(s),t=a.offsetWidth,s.css("overflow","scroll"),i=a.offsetWidth,t===i&&(i=s[0].clientWidth),s.remove(),n=t-i},getScrollInfo:function(t){var i=t.isWindow||t.isDocument?"":t.element.css("overflow-x"),s=t.isWindow||t.isDocument?"":t.element.css("overflow-y"),n="scroll"===i||"auto"===i&&t.width<t.element[0].scrollWidth,a="scroll"===s||"auto"===s&&t.height<t.element[0].scrollHeight;return{width:a?e.position.scrollbarWidth():0,height:n?e.position.scrollbarWidth():0}},getWithinInfo:function(t){var i=e(t||window),s=e.isWindow(i[0]),n=!!i[0]&&9===i[0].nodeType;return{element:i,isWindow:s,isDocument:n,offset:i.offset()||{left:0,top:0},scrollLeft:i.scrollLeft(),scrollTop:i.scrollTop(),width:s||n?i.width():i.outerWidth(),height:s||n?i.height():i.outerHeight()}}},e.fn.position=function(n){if(!n||!n.of)return f.apply(this,arguments);n=e.extend({},n);var p,m,g,v,y,b,_=e(n.of),x=e.position.getWithinInfo(n.within),w=e.position.getScrollInfo(x),k=(n.collision||"flip").split(" "),T={};return b=s(_),_[0].preventDefault&&(n.at="left top"),m=b.width,g=b.height,v=b.offset,y=e.extend({},v),e.each(["my","at"],function(){var e,t,i=(n[this]||"").split(" ");1===i.length&&(i=l.test(i[0])?i.concat(["center"]):u.test(i[0])?["center"].concat(i):["center","center"]),i[0]=l.test(i[0])?i[0]:"center",i[1]=u.test(i[1])?i[1]:"center",e=d.exec(i[0]),t=d.exec(i[1]),T[this]=[e?e[0]:0,t?t[0]:0],n[this]=[c.exec(i[0])[0],c.exec(i[1])[0]]}),1===k.length&&(k[1]=k[0]),"right"===n.at[0]?y.left+=m:"center"===n.at[0]&&(y.left+=m/2),"bottom"===n.at[1]?y.top+=g:"center"===n.at[1]&&(y.top+=g/2),p=t(T.at,m,g),y.left+=p[0],y.top+=p[1],this.each(function(){var s,l,u=e(this),d=u.outerWidth(),c=u.outerHeight(),f=i(this,"marginLeft"),b=i(this,"marginTop"),D=d+f+i(this,"marginRight")+w.width,S=c+b+i(this,"marginBottom")+w.height,M=e.extend({},y),C=t(T.my,u.outerWidth(),u.outerHeight());"right"===n.my[0]?M.left-=d:"center"===n.my[0]&&(M.left-=d/2),"bottom"===n.my[1]?M.top-=c:"center"===n.my[1]&&(M.top-=c/2),M.left+=C[0],M.top+=C[1],a||(M.left=h(M.left),M.top=h(M.top)),s={marginLeft:f,marginTop:b},e.each(["left","top"],function(t,i){e.ui.position[k[t]]&&e.ui.position[k[t]][i](M,{targetWidth:m,targetHeight:g,elemWidth:d,elemHeight:c,collisionPosition:s,collisionWidth:D,collisionHeight:S,offset:[p[0]+C[0],p[1]+C[1]],my:n.my,at:n.at,within:x,elem:u})}),n.using&&(l=function(e){var t=v.left-M.left,i=t+m-d,s=v.top-M.top,a=s+g-c,h={target:{element:_,left:v.left,top:v.top,width:m,height:g},element:{element:u,left:M.left,top:M.top,width:d,height:c},horizontal:0>i?"left":t>0?"right":"center",vertical:0>a?"top":s>0?"bottom":"middle"};d>m&&m>r(t+i)&&(h.horizontal="center"),c>g&&g>r(s+a)&&(h.vertical="middle"),h.important=o(r(t),r(i))>o(r(s),r(a))?"horizontal":"vertical",n.using.call(this,e,h)}),u.offset(e.extend(M,{using:l}))})},e.ui.position={fit:{left:function(e,t){var i,s=t.within,n=s.isWindow?s.scrollLeft:s.offset.left,a=s.width,r=e.left-t.collisionPosition.marginLeft,h=n-r,l=r+t.collisionWidth-a-n;t.collisionWidth>a?h>0&&0>=l?(i=e.left+h+t.collisionWidth-a-n,e.left+=h-i):e.left=l>0&&0>=h?n:h>l?n+a-t.collisionWidth:n:h>0?e.left+=h:l>0?e.left-=l:e.left=o(e.left-r,e.left)},top:function(e,t){var i,s=t.within,n=s.isWindow?s.scrollTop:s.offset.top,a=t.within.height,r=e.top-t.collisionPosition.marginTop,h=n-r,l=r+t.collisionHeight-a-n;t.collisionHeight>a?h>0&&0>=l?(i=e.top+h+t.collisionHeight-a-n,e.top+=h-i):e.top=l>0&&0>=h?n:h>l?n+a-t.collisionHeight:n:h>0?e.top+=h:l>0?e.top-=l:e.top=o(e.top-r,e.top)}},flip:{left:function(e,t){var i,s,n=t.within,a=n.offset.left+n.scrollLeft,o=n.width,h=n.isWindow?n.scrollLeft:n.offset.left,l=e.left-t.collisionPosition.marginLeft,u=l-h,d=l+t.collisionWidth-o-h,c="left"===t.my[0]?-t.elemWidth:"right"===t.my[0]?t.elemWidth:0,p="left"===t.at[0]?t.targetWidth:"right"===t.at[0]?-t.targetWidth:0,f=-2*t.offset[0];0>u?(i=e.left+c+p+f+t.collisionWidth-o-a,(0>i||r(u)>i)&&(e.left+=c+p+f)):d>0&&(s=e.left-t.collisionPosition.marginLeft+c+p+f-h,(s>0||d>r(s))&&(e.left+=c+p+f))},top:function(e,t){var i,s,n=t.within,a=n.offset.top+n.scrollTop,o=n.height,h=n.isWindow?n.scrollTop:n.offset.top,l=e.top-t.collisionPosition.marginTop,u=l-h,d=l+t.collisionHeight-o-h,c="top"===t.my[1],p=c?-t.elemHeight:"bottom"===t.my[1]?t.elemHeight:0,f="top"===t.at[1]?t.targetHeight:"bottom"===t.at[1]?-t.targetHeight:0,m=-2*t.offset[1];0>u?(s=e.top+p+f+m+t.collisionHeight-o-a,e.top+p+f+m>u&&(0>s||r(u)>s)&&(e.top+=p+f+m)):d>0&&(i=e.top-t.collisionPosition.marginTop+p+f+m-h,e.top+p+f+m>d&&(i>0||d>r(i))&&(e.top+=p+f+m))}},flipfit:{left:function(){e.ui.position.flip.left.apply(this,arguments),e.ui.position.fit.left.apply(this,arguments)},top:function(){e.ui.position.flip.top.apply(this,arguments),e.ui.position.fit.top.apply(this,arguments)}}},function(){var t,i,s,n,o,r=document.getElementsByTagName("body")[0],h=document.createElement("div");t=document.createElement(r?"div":"body"),s={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},r&&e.extend(s,{position:"absolute",left:"-1000px",top:"-1000px"});for(o in s)t.style[o]=s[o];t.appendChild(h),i=r||document.documentElement,i.insertBefore(t,i.firstChild),h.style.cssText="position: absolute; left: 10.7432222px;",n=e(h).offset().left,a=n>10&&11>n,t.innerHTML="",i.removeChild(t)}()}(),e.ui.position,e.widget("ui.accordion",{version:"1.11.2",options:{active:0,animate:{},collapsible:!1,event:"click",header:"> li > :first-child,> :not(li):even",heightStyle:"auto",icons:{activeHeader:"ui-icon-triangle-1-s",header:"ui-icon-triangle-1-e"},activate:null,beforeActivate:null},hideProps:{borderTopWidth:"hide",borderBottomWidth:"hide",paddingTop:"hide",paddingBottom:"hide",height:"hide"},showProps:{borderTopWidth:"show",borderBottomWidth:"show",paddingTop:"show",paddingBottom:"show",height:"show"},_create:function(){var t=this.options;this.prevShow=this.prevHide=e(),this.element.addClass("ui-accordion ui-widget ui-helper-reset").attr("role","tablist"),t.collapsible||t.active!==!1&&null!=t.active||(t.active=0),this._processPanels(),0>t.active&&(t.active+=this.headers.length),this._refresh()},_getCreateEventData:function(){return{header:this.active,panel:this.active.length?this.active.next():e()}},_createIcons:function(){var t=this.options.icons;t&&(e("<span>").addClass("ui-accordion-header-icon ui-icon "+t.header).prependTo(this.headers),this.active.children(".ui-accordion-header-icon").removeClass(t.header).addClass(t.activeHeader),this.headers.addClass("ui-accordion-icons"))},_destroyIcons:function(){this.headers.removeClass("ui-accordion-icons").children(".ui-accordion-header-icon").remove()},_destroy:function(){var e;this.element.removeClass("ui-accordion ui-widget ui-helper-reset").removeAttr("role"),this.headers.removeClass("ui-accordion-header ui-accordion-header-active ui-state-default ui-corner-all ui-state-active ui-state-disabled ui-corner-top").removeAttr("role").removeAttr("aria-expanded").removeAttr("aria-selected").removeAttr("aria-controls").removeAttr("tabIndex").removeUniqueId(),this._destroyIcons(),e=this.headers.next().removeClass("ui-helper-reset ui-widget-content ui-corner-bottom ui-accordion-content ui-accordion-content-active ui-state-disabled").css("display","").removeAttr("role").removeAttr("aria-hidden").removeAttr("aria-labelledby").removeUniqueId(),"content"!==this.options.heightStyle&&e.css("height","")},_setOption:function(e,t){return"active"===e?(this._activate(t),void 0):("event"===e&&(this.options.event&&this._off(this.headers,this.options.event),this._setupEvents(t)),this._super(e,t),"collapsible"!==e||t||this.options.active!==!1||this._activate(0),"icons"===e&&(this._destroyIcons(),t&&this._createIcons()),"disabled"===e&&(this.element.toggleClass("ui-state-disabled",!!t).attr("aria-disabled",t),this.headers.add(this.headers.next()).toggleClass("ui-state-disabled",!!t)),void 0)},_keydown:function(t){if(!t.altKey&&!t.ctrlKey){var i=e.ui.keyCode,s=this.headers.length,n=this.headers.index(t.target),a=!1;switch(t.keyCode){case i.RIGHT:case i.DOWN:a=this.headers[(n+1)%s];break;case i.LEFT:case i.UP:a=this.headers[(n-1+s)%s];break;case i.SPACE:case i.ENTER:this._eventHandler(t);break;case i.HOME:a=this.headers[0];break;case i.END:a=this.headers[s-1]}a&&(e(t.target).attr("tabIndex",-1),e(a).attr("tabIndex",0),a.focus(),t.preventDefault())}},_panelKeyDown:function(t){t.keyCode===e.ui.keyCode.UP&&t.ctrlKey&&e(t.currentTarget).prev().focus()},refresh:function(){var t=this.options;this._processPanels(),t.active===!1&&t.collapsible===!0||!this.headers.length?(t.active=!1,this.active=e()):t.active===!1?this._activate(0):this.active.length&&!e.contains(this.element[0],this.active[0])?this.headers.length===this.headers.find(".ui-state-disabled").length?(t.active=!1,this.active=e()):this._activate(Math.max(0,t.active-1)):t.active=this.headers.index(this.active),this._destroyIcons(),this._refresh()},_processPanels:function(){var e=this.headers,t=this.panels;this.headers=this.element.find(this.options.header).addClass("ui-accordion-header ui-state-default ui-corner-all"),this.panels=this.headers.next().addClass("ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom").filter(":not(.ui-accordion-content-active)").hide(),t&&(this._off(e.not(this.headers)),this._off(t.not(this.panels)))},_refresh:function(){var t,i=this.options,s=i.heightStyle,n=this.element.parent();this.active=this._findActive(i.active).addClass("ui-accordion-header-active ui-state-active ui-corner-top").removeClass("ui-corner-all"),this.active.next().addClass("ui-accordion-content-active").show(),this.headers.attr("role","tab").each(function(){var t=e(this),i=t.uniqueId().attr("id"),s=t.next(),n=s.uniqueId().attr("id");t.attr("aria-controls",n),s.attr("aria-labelledby",i)}).next().attr("role","tabpanel"),this.headers.not(this.active).attr({"aria-selected":"false","aria-expanded":"false",tabIndex:-1}).next().attr({"aria-hidden":"true"}).hide(),this.active.length?this.active.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0}).next().attr({"aria-hidden":"false"}):this.headers.eq(0).attr("tabIndex",0),this._createIcons(),this._setupEvents(i.event),"fill"===s?(t=n.height(),this.element.siblings(":visible").each(function(){var i=e(this),s=i.css("position");"absolute"!==s&&"fixed"!==s&&(t-=i.outerHeight(!0))}),this.headers.each(function(){t-=e(this).outerHeight(!0)}),this.headers.next().each(function(){e(this).height(Math.max(0,t-e(this).innerHeight()+e(this).height()))}).css("overflow","auto")):"auto"===s&&(t=0,this.headers.next().each(function(){t=Math.max(t,e(this).css("height","").height())}).height(t))},_activate:function(t){var i=this._findActive(t)[0];i!==this.active[0]&&(i=i||this.active[0],this._eventHandler({target:i,currentTarget:i,preventDefault:e.noop}))},_findActive:function(t){return"number"==typeof t?this.headers.eq(t):e()},_setupEvents:function(t){var i={keydown:"_keydown"};t&&e.each(t.split(" "),function(e,t){i[t]="_eventHandler"}),this._off(this.headers.add(this.headers.next())),this._on(this.headers,i),this._on(this.headers.next(),{keydown:"_panelKeyDown"}),this._hoverable(this.headers),this._focusable(this.headers)},_eventHandler:function(t){var i=this.options,s=this.active,n=e(t.currentTarget),a=n[0]===s[0],o=a&&i.collapsible,r=o?e():n.next(),h=s.next(),l={oldHeader:s,oldPanel:h,newHeader:o?e():n,newPanel:r};t.preventDefault(),a&&!i.collapsible||this._trigger("beforeActivate",t,l)===!1||(i.active=o?!1:this.headers.index(n),this.active=a?e():n,this._toggle(l),s.removeClass("ui-accordion-header-active ui-state-active"),i.icons&&s.children(".ui-accordion-header-icon").removeClass(i.icons.activeHeader).addClass(i.icons.header),a||(n.removeClass("ui-corner-all").addClass("ui-accordion-header-active ui-state-active ui-corner-top"),i.icons&&n.children(".ui-accordion-header-icon").removeClass(i.icons.header).addClass(i.icons.activeHeader),n.next().addClass("ui-accordion-content-active")))},_toggle:function(t){var i=t.newPanel,s=this.prevShow.length?this.prevShow:t.oldPanel;this.prevShow.add(this.prevHide).stop(!0,!0),this.prevShow=i,this.prevHide=s,this.options.animate?this._animate(i,s,t):(s.hide(),i.show(),this._toggleComplete(t)),s.attr({"aria-hidden":"true"}),s.prev().attr("aria-selected","false"),i.length&&s.length?s.prev().attr({tabIndex:-1,"aria-expanded":"false"}):i.length&&this.headers.filter(function(){return 0===e(this).attr("tabIndex")}).attr("tabIndex",-1),i.attr("aria-hidden","false").prev().attr({"aria-selected":"true",tabIndex:0,"aria-expanded":"true"})},_animate:function(e,t,i){var s,n,a,o=this,r=0,h=e.length&&(!t.length||e.index()<t.index()),l=this.options.animate||{},u=h&&l.down||l,d=function(){o._toggleComplete(i)};return"number"==typeof u&&(a=u),"string"==typeof u&&(n=u),n=n||u.easing||l.easing,a=a||u.duration||l.duration,t.length?e.length?(s=e.show().outerHeight(),t.animate(this.hideProps,{duration:a,easing:n,step:function(e,t){t.now=Math.round(e)}}),e.hide().animate(this.showProps,{duration:a,easing:n,complete:d,step:function(e,i){i.now=Math.round(e),"height"!==i.prop?r+=i.now:"content"!==o.options.heightStyle&&(i.now=Math.round(s-t.outerHeight()-r),r=0)}}),void 0):t.animate(this.hideProps,a,n,d):e.animate(this.showProps,a,n,d)},_toggleComplete:function(e){var t=e.oldPanel;t.removeClass("ui-accordion-content-active").prev().removeClass("ui-corner-top").addClass("ui-corner-all"),t.length&&(t.parent()[0].className=t.parent()[0].className),this._trigger("activate",null,e)}}),e.widget("ui.menu",{version:"1.11.2",defaultElement:"<ul>",delay:300,options:{icons:{submenu:"ui-icon-carat-1-e"},items:"> *",menus:"ul",position:{my:"left-1 top",at:"right top"},role:"menu",blur:null,focus:null,select:null},_create:function(){this.activeMenu=this.element,this.mouseHandled=!1,this.element.uniqueId().addClass("ui-menu ui-widget ui-widget-content").toggleClass("ui-menu-icons",!!this.element.find(".ui-icon").length).attr({role:this.options.role,tabIndex:0}),this.options.disabled&&this.element.addClass("ui-state-disabled").attr("aria-disabled","true"),this._on({"mousedown .ui-menu-item":function(e){e.preventDefault()},"click .ui-menu-item":function(t){var i=e(t.target);!this.mouseHandled&&i.not(".ui-state-disabled").length&&(this.select(t),t.isPropagationStopped()||(this.mouseHandled=!0),i.has(".ui-menu").length?this.expand(t):!this.element.is(":focus")&&e(this.document[0].activeElement).closest(".ui-menu").length&&(this.element.trigger("focus",[!0]),this.active&&1===this.active.parents(".ui-menu").length&&clearTimeout(this.timer)))},"mouseenter .ui-menu-item":function(t){if(!this.previousFilter){var i=e(t.currentTarget);i.siblings(".ui-state-active").removeClass("ui-state-active"),this.focus(t,i)
}},mouseleave:"collapseAll","mouseleave .ui-menu":"collapseAll",focus:function(e,t){var i=this.active||this.element.find(this.options.items).eq(0);t||this.focus(e,i)},blur:function(t){this._delay(function(){e.contains(this.element[0],this.document[0].activeElement)||this.collapseAll(t)})},keydown:"_keydown"}),this.refresh(),this._on(this.document,{click:function(e){this._closeOnDocumentClick(e)&&this.collapseAll(e),this.mouseHandled=!1}})},_destroy:function(){this.element.removeAttr("aria-activedescendant").find(".ui-menu").addBack().removeClass("ui-menu ui-widget ui-widget-content ui-menu-icons ui-front").removeAttr("role").removeAttr("tabIndex").removeAttr("aria-labelledby").removeAttr("aria-expanded").removeAttr("aria-hidden").removeAttr("aria-disabled").removeUniqueId().show(),this.element.find(".ui-menu-item").removeClass("ui-menu-item").removeAttr("role").removeAttr("aria-disabled").removeUniqueId().removeClass("ui-state-hover").removeAttr("tabIndex").removeAttr("role").removeAttr("aria-haspopup").children().each(function(){var t=e(this);t.data("ui-menu-submenu-carat")&&t.remove()}),this.element.find(".ui-menu-divider").removeClass("ui-menu-divider ui-widget-content")},_keydown:function(t){var i,s,n,a,o=!0;switch(t.keyCode){case e.ui.keyCode.PAGE_UP:this.previousPage(t);break;case e.ui.keyCode.PAGE_DOWN:this.nextPage(t);break;case e.ui.keyCode.HOME:this._move("first","first",t);break;case e.ui.keyCode.END:this._move("last","last",t);break;case e.ui.keyCode.UP:this.previous(t);break;case e.ui.keyCode.DOWN:this.next(t);break;case e.ui.keyCode.LEFT:this.collapse(t);break;case e.ui.keyCode.RIGHT:this.active&&!this.active.is(".ui-state-disabled")&&this.expand(t);break;case e.ui.keyCode.ENTER:case e.ui.keyCode.SPACE:this._activate(t);break;case e.ui.keyCode.ESCAPE:this.collapse(t);break;default:o=!1,s=this.previousFilter||"",n=String.fromCharCode(t.keyCode),a=!1,clearTimeout(this.filterTimer),n===s?a=!0:n=s+n,i=this._filterMenuItems(n),i=a&&-1!==i.index(this.active.next())?this.active.nextAll(".ui-menu-item"):i,i.length||(n=String.fromCharCode(t.keyCode),i=this._filterMenuItems(n)),i.length?(this.focus(t,i),this.previousFilter=n,this.filterTimer=this._delay(function(){delete this.previousFilter},1e3)):delete this.previousFilter}o&&t.preventDefault()},_activate:function(e){this.active.is(".ui-state-disabled")||(this.active.is("[aria-haspopup='true']")?this.expand(e):this.select(e))},refresh:function(){var t,i,s=this,n=this.options.icons.submenu,a=this.element.find(this.options.menus);this.element.toggleClass("ui-menu-icons",!!this.element.find(".ui-icon").length),a.filter(":not(.ui-menu)").addClass("ui-menu ui-widget ui-widget-content ui-front").hide().attr({role:this.options.role,"aria-hidden":"true","aria-expanded":"false"}).each(function(){var t=e(this),i=t.parent(),s=e("<span>").addClass("ui-menu-icon ui-icon "+n).data("ui-menu-submenu-carat",!0);i.attr("aria-haspopup","true").prepend(s),t.attr("aria-labelledby",i.attr("id"))}),t=a.add(this.element),i=t.find(this.options.items),i.not(".ui-menu-item").each(function(){var t=e(this);s._isDivider(t)&&t.addClass("ui-widget-content ui-menu-divider")}),i.not(".ui-menu-item, .ui-menu-divider").addClass("ui-menu-item").uniqueId().attr({tabIndex:-1,role:this._itemRole()}),i.filter(".ui-state-disabled").attr("aria-disabled","true"),this.active&&!e.contains(this.element[0],this.active[0])&&this.blur()},_itemRole:function(){return{menu:"menuitem",listbox:"option"}[this.options.role]},_setOption:function(e,t){"icons"===e&&this.element.find(".ui-menu-icon").removeClass(this.options.icons.submenu).addClass(t.submenu),"disabled"===e&&this.element.toggleClass("ui-state-disabled",!!t).attr("aria-disabled",t),this._super(e,t)},focus:function(e,t){var i,s;this.blur(e,e&&"focus"===e.type),this._scrollIntoView(t),this.active=t.first(),s=this.active.addClass("ui-state-focus").removeClass("ui-state-active"),this.options.role&&this.element.attr("aria-activedescendant",s.attr("id")),this.active.parent().closest(".ui-menu-item").addClass("ui-state-active"),e&&"keydown"===e.type?this._close():this.timer=this._delay(function(){this._close()},this.delay),i=t.children(".ui-menu"),i.length&&e&&/^mouse/.test(e.type)&&this._startOpening(i),this.activeMenu=t.parent(),this._trigger("focus",e,{item:t})},_scrollIntoView:function(t){var i,s,n,a,o,r;this._hasScroll()&&(i=parseFloat(e.css(this.activeMenu[0],"borderTopWidth"))||0,s=parseFloat(e.css(this.activeMenu[0],"paddingTop"))||0,n=t.offset().top-this.activeMenu.offset().top-i-s,a=this.activeMenu.scrollTop(),o=this.activeMenu.height(),r=t.outerHeight(),0>n?this.activeMenu.scrollTop(a+n):n+r>o&&this.activeMenu.scrollTop(a+n-o+r))},blur:function(e,t){t||clearTimeout(this.timer),this.active&&(this.active.removeClass("ui-state-focus"),this.active=null,this._trigger("blur",e,{item:this.active}))},_startOpening:function(e){clearTimeout(this.timer),"true"===e.attr("aria-hidden")&&(this.timer=this._delay(function(){this._close(),this._open(e)},this.delay))},_open:function(t){var i=e.extend({of:this.active},this.options.position);clearTimeout(this.timer),this.element.find(".ui-menu").not(t.parents(".ui-menu")).hide().attr("aria-hidden","true"),t.show().removeAttr("aria-hidden").attr("aria-expanded","true").position(i)},collapseAll:function(t,i){clearTimeout(this.timer),this.timer=this._delay(function(){var s=i?this.element:e(t&&t.target).closest(this.element.find(".ui-menu"));s.length||(s=this.element),this._close(s),this.blur(t),this.activeMenu=s},this.delay)},_close:function(e){e||(e=this.active?this.active.parent():this.element),e.find(".ui-menu").hide().attr("aria-hidden","true").attr("aria-expanded","false").end().find(".ui-state-active").not(".ui-state-focus").removeClass("ui-state-active")},_closeOnDocumentClick:function(t){return!e(t.target).closest(".ui-menu").length},_isDivider:function(e){return!/[^\-\u2014\u2013\s]/.test(e.text())},collapse:function(e){var t=this.active&&this.active.parent().closest(".ui-menu-item",this.element);t&&t.length&&(this._close(),this.focus(e,t))},expand:function(e){var t=this.active&&this.active.children(".ui-menu ").find(this.options.items).first();t&&t.length&&(this._open(t.parent()),this._delay(function(){this.focus(e,t)}))},next:function(e){this._move("next","first",e)},previous:function(e){this._move("prev","last",e)},isFirstItem:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},isLastItem:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},_move:function(e,t,i){var s;this.active&&(s="first"===e||"last"===e?this.active["first"===e?"prevAll":"nextAll"](".ui-menu-item").eq(-1):this.active[e+"All"](".ui-menu-item").eq(0)),s&&s.length&&this.active||(s=this.activeMenu.find(this.options.items)[t]()),this.focus(i,s)},nextPage:function(t){var i,s,n;return this.active?(this.isLastItem()||(this._hasScroll()?(s=this.active.offset().top,n=this.element.height(),this.active.nextAll(".ui-menu-item").each(function(){return i=e(this),0>i.offset().top-s-n}),this.focus(t,i)):this.focus(t,this.activeMenu.find(this.options.items)[this.active?"last":"first"]())),void 0):(this.next(t),void 0)},previousPage:function(t){var i,s,n;return this.active?(this.isFirstItem()||(this._hasScroll()?(s=this.active.offset().top,n=this.element.height(),this.active.prevAll(".ui-menu-item").each(function(){return i=e(this),i.offset().top-s+n>0}),this.focus(t,i)):this.focus(t,this.activeMenu.find(this.options.items).first())),void 0):(this.next(t),void 0)},_hasScroll:function(){return this.element.outerHeight()<this.element.prop("scrollHeight")},select:function(t){this.active=this.active||e(t.target).closest(".ui-menu-item");var i={item:this.active};this.active.has(".ui-menu").length||this.collapseAll(t,!0),this._trigger("select",t,i)},_filterMenuItems:function(t){var i=t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&"),s=RegExp("^"+i,"i");return this.activeMenu.find(this.options.items).filter(".ui-menu-item").filter(function(){return s.test(e.trim(e(this).text()))})}}),e.widget("ui.autocomplete",{version:"1.11.2",defaultElement:"<input>",options:{appendTo:null,autoFocus:!1,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null,change:null,close:null,focus:null,open:null,response:null,search:null,select:null},requestIndex:0,pending:0,_create:function(){var t,i,s,n=this.element[0].nodeName.toLowerCase(),a="textarea"===n,o="input"===n;this.isMultiLine=a?!0:o?!1:this.element.prop("isContentEditable"),this.valueMethod=this.element[a||o?"val":"text"],this.isNewMenu=!0,this.element.addClass("ui-autocomplete-input").attr("autocomplete","off"),this._on(this.element,{keydown:function(n){if(this.element.prop("readOnly"))return t=!0,s=!0,i=!0,void 0;t=!1,s=!1,i=!1;var a=e.ui.keyCode;switch(n.keyCode){case a.PAGE_UP:t=!0,this._move("previousPage",n);break;case a.PAGE_DOWN:t=!0,this._move("nextPage",n);break;case a.UP:t=!0,this._keyEvent("previous",n);break;case a.DOWN:t=!0,this._keyEvent("next",n);break;case a.ENTER:this.menu.active&&(t=!0,n.preventDefault(),this.menu.select(n));break;case a.TAB:this.menu.active&&this.menu.select(n);break;case a.ESCAPE:this.menu.element.is(":visible")&&(this.isMultiLine||this._value(this.term),this.close(n),n.preventDefault());break;default:i=!0,this._searchTimeout(n)}},keypress:function(s){if(t)return t=!1,(!this.isMultiLine||this.menu.element.is(":visible"))&&s.preventDefault(),void 0;if(!i){var n=e.ui.keyCode;switch(s.keyCode){case n.PAGE_UP:this._move("previousPage",s);break;case n.PAGE_DOWN:this._move("nextPage",s);break;case n.UP:this._keyEvent("previous",s);break;case n.DOWN:this._keyEvent("next",s)}}},input:function(e){return s?(s=!1,e.preventDefault(),void 0):(this._searchTimeout(e),void 0)},focus:function(){this.selectedItem=null,this.previous=this._value()},blur:function(e){return this.cancelBlur?(delete this.cancelBlur,void 0):(clearTimeout(this.searching),this.close(e),this._change(e),void 0)}}),this._initSource(),this.menu=e("<ul>").addClass("ui-autocomplete ui-front").appendTo(this._appendTo()).menu({role:null}).hide().menu("instance"),this._on(this.menu.element,{mousedown:function(t){t.preventDefault(),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur});var i=this.menu.element[0];e(t.target).closest(".ui-menu-item").length||this._delay(function(){var t=this;this.document.one("mousedown",function(s){s.target===t.element[0]||s.target===i||e.contains(i,s.target)||t.close()})})},menufocus:function(t,i){var s,n;return this.isNewMenu&&(this.isNewMenu=!1,t.originalEvent&&/^mouse/.test(t.originalEvent.type))?(this.menu.blur(),this.document.one("mousemove",function(){e(t.target).trigger(t.originalEvent)}),void 0):(n=i.item.data("ui-autocomplete-item"),!1!==this._trigger("focus",t,{item:n})&&t.originalEvent&&/^key/.test(t.originalEvent.type)&&this._value(n.value),s=i.item.attr("aria-label")||n.value,s&&e.trim(s).length&&(this.liveRegion.children().hide(),e("<div>").text(s).appendTo(this.liveRegion)),void 0)},menuselect:function(e,t){var i=t.item.data("ui-autocomplete-item"),s=this.previous;this.element[0]!==this.document[0].activeElement&&(this.element.focus(),this.previous=s,this._delay(function(){this.previous=s,this.selectedItem=i})),!1!==this._trigger("select",e,{item:i})&&this._value(i.value),this.term=this._value(),this.close(e),this.selectedItem=i}}),this.liveRegion=e("<span>",{role:"status","aria-live":"assertive","aria-relevant":"additions"}).addClass("ui-helper-hidden-accessible").appendTo(this.document[0].body),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_destroy:function(){clearTimeout(this.searching),this.element.removeClass("ui-autocomplete-input").removeAttr("autocomplete"),this.menu.element.remove(),this.liveRegion.remove()},_setOption:function(e,t){this._super(e,t),"source"===e&&this._initSource(),"appendTo"===e&&this.menu.element.appendTo(this._appendTo()),"disabled"===e&&t&&this.xhr&&this.xhr.abort()},_appendTo:function(){var t=this.options.appendTo;return t&&(t=t.jquery||t.nodeType?e(t):this.document.find(t).eq(0)),t&&t[0]||(t=this.element.closest(".ui-front")),t.length||(t=this.document[0].body),t},_initSource:function(){var t,i,s=this;e.isArray(this.options.source)?(t=this.options.source,this.source=function(i,s){s(e.ui.autocomplete.filter(t,i.term))}):"string"==typeof this.options.source?(i=this.options.source,this.source=function(t,n){s.xhr&&s.xhr.abort(),s.xhr=e.ajax({url:i,data:t,dataType:"json",success:function(e){n(e)},error:function(){n([])}})}):this.source=this.options.source},_searchTimeout:function(e){clearTimeout(this.searching),this.searching=this._delay(function(){var t=this.term===this._value(),i=this.menu.element.is(":visible"),s=e.altKey||e.ctrlKey||e.metaKey||e.shiftKey;(!t||t&&!i&&!s)&&(this.selectedItem=null,this.search(null,e))},this.options.delay)},search:function(e,t){return e=null!=e?e:this._value(),this.term=this._value(),e.length<this.options.minLength?this.close(t):this._trigger("search",t)!==!1?this._search(e):void 0},_search:function(e){this.pending++,this.element.addClass("ui-autocomplete-loading"),this.cancelSearch=!1,this.source({term:e},this._response())},_response:function(){var t=++this.requestIndex;return e.proxy(function(e){t===this.requestIndex&&this.__response(e),this.pending--,this.pending||this.element.removeClass("ui-autocomplete-loading")},this)},__response:function(e){e&&(e=this._normalize(e)),this._trigger("response",null,{content:e}),!this.options.disabled&&e&&e.length&&!this.cancelSearch?(this._suggest(e),this._trigger("open")):this._close()},close:function(e){this.cancelSearch=!0,this._close(e)},_close:function(e){this.menu.element.is(":visible")&&(this.menu.element.hide(),this.menu.blur(),this.isNewMenu=!0,this._trigger("close",e))},_change:function(e){this.previous!==this._value()&&this._trigger("change",e,{item:this.selectedItem})},_normalize:function(t){return t.length&&t[0].label&&t[0].value?t:e.map(t,function(t){return"string"==typeof t?{label:t,value:t}:e.extend({},t,{label:t.label||t.value,value:t.value||t.label})})},_suggest:function(t){var i=this.menu.element.empty();this._renderMenu(i,t),this.isNewMenu=!0,this.menu.refresh(),i.show(),this._resizeMenu(),i.position(e.extend({of:this.element},this.options.position)),this.options.autoFocus&&this.menu.next()},_resizeMenu:function(){var e=this.menu.element;e.outerWidth(Math.max(e.width("").outerWidth()+1,this.element.outerWidth()))},_renderMenu:function(t,i){var s=this;e.each(i,function(e,i){s._renderItemData(t,i)})},_renderItemData:function(e,t){return this._renderItem(e,t).data("ui-autocomplete-item",t)},_renderItem:function(t,i){return e("<li>").text(i.label).appendTo(t)},_move:function(e,t){return this.menu.element.is(":visible")?this.menu.isFirstItem()&&/^previous/.test(e)||this.menu.isLastItem()&&/^next/.test(e)?(this.isMultiLine||this._value(this.term),this.menu.blur(),void 0):(this.menu[e](t),void 0):(this.search(null,t),void 0)},widget:function(){return this.menu.element},_value:function(){return this.valueMethod.apply(this.element,arguments)},_keyEvent:function(e,t){(!this.isMultiLine||this.menu.element.is(":visible"))&&(this._move(e,t),t.preventDefault())}}),e.extend(e.ui.autocomplete,{escapeRegex:function(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},filter:function(t,i){var s=RegExp(e.ui.autocomplete.escapeRegex(i),"i");return e.grep(t,function(e){return s.test(e.label||e.value||e)})}}),e.widget("ui.autocomplete",e.ui.autocomplete,{options:{messages:{noResults:"No search results.",results:function(e){return e+(e>1?" results are":" result is")+" available, use up and down arrow keys to navigate."}}},__response:function(t){var i;this._superApply(arguments),this.options.disabled||this.cancelSearch||(i=t&&t.length?this.options.messages.results(t.length):this.options.messages.noResults,this.liveRegion.children().hide(),e("<div>").text(i).appendTo(this.liveRegion))}}),e.ui.autocomplete;var c,p="ui-button ui-widget ui-state-default ui-corner-all",f="ui-button-icons-only ui-button-icon-only ui-button-text-icons ui-button-text-icon-primary ui-button-text-icon-secondary ui-button-text-only",m=function(){var t=e(this);setTimeout(function(){t.find(":ui-button").button("refresh")},1)},g=function(t){var i=t.name,s=t.form,n=e([]);return i&&(i=i.replace(/'/g,"\\'"),n=s?e(s).find("[name='"+i+"'][type=radio]"):e("[name='"+i+"'][type=radio]",t.ownerDocument).filter(function(){return!this.form})),n};e.widget("ui.button",{version:"1.11.2",defaultElement:"<button>",options:{disabled:null,text:!0,label:null,icons:{primary:null,secondary:null}},_create:function(){this.element.closest("form").unbind("reset"+this.eventNamespace).bind("reset"+this.eventNamespace,m),"boolean"!=typeof this.options.disabled?this.options.disabled=!!this.element.prop("disabled"):this.element.prop("disabled",this.options.disabled),this._determineButtonType(),this.hasTitle=!!this.buttonElement.attr("title");var t=this,i=this.options,s="checkbox"===this.type||"radio"===this.type,n=s?"":"ui-state-active";null===i.label&&(i.label="input"===this.type?this.buttonElement.val():this.buttonElement.html()),this._hoverable(this.buttonElement),this.buttonElement.addClass(p).attr("role","button").bind("mouseenter"+this.eventNamespace,function(){i.disabled||this===c&&e(this).addClass("ui-state-active")}).bind("mouseleave"+this.eventNamespace,function(){i.disabled||e(this).removeClass(n)}).bind("click"+this.eventNamespace,function(e){i.disabled&&(e.preventDefault(),e.stopImmediatePropagation())}),this._on({focus:function(){this.buttonElement.addClass("ui-state-focus")},blur:function(){this.buttonElement.removeClass("ui-state-focus")}}),s&&this.element.bind("change"+this.eventNamespace,function(){t.refresh()}),"checkbox"===this.type?this.buttonElement.bind("click"+this.eventNamespace,function(){return i.disabled?!1:void 0}):"radio"===this.type?this.buttonElement.bind("click"+this.eventNamespace,function(){if(i.disabled)return!1;e(this).addClass("ui-state-active"),t.buttonElement.attr("aria-pressed","true");var s=t.element[0];g(s).not(s).map(function(){return e(this).button("widget")[0]}).removeClass("ui-state-active").attr("aria-pressed","false")}):(this.buttonElement.bind("mousedown"+this.eventNamespace,function(){return i.disabled?!1:(e(this).addClass("ui-state-active"),c=this,t.document.one("mouseup",function(){c=null}),void 0)}).bind("mouseup"+this.eventNamespace,function(){return i.disabled?!1:(e(this).removeClass("ui-state-active"),void 0)}).bind("keydown"+this.eventNamespace,function(t){return i.disabled?!1:((t.keyCode===e.ui.keyCode.SPACE||t.keyCode===e.ui.keyCode.ENTER)&&e(this).addClass("ui-state-active"),void 0)}).bind("keyup"+this.eventNamespace+" blur"+this.eventNamespace,function(){e(this).removeClass("ui-state-active")}),this.buttonElement.is("a")&&this.buttonElement.keyup(function(t){t.keyCode===e.ui.keyCode.SPACE&&e(this).click()})),this._setOption("disabled",i.disabled),this._resetButton()},_determineButtonType:function(){var e,t,i;this.type=this.element.is("[type=checkbox]")?"checkbox":this.element.is("[type=radio]")?"radio":this.element.is("input")?"input":"button","checkbox"===this.type||"radio"===this.type?(e=this.element.parents().last(),t="label[for='"+this.element.attr("id")+"']",this.buttonElement=e.find(t),this.buttonElement.length||(e=e.length?e.siblings():this.element.siblings(),this.buttonElement=e.filter(t),this.buttonElement.length||(this.buttonElement=e.find(t))),this.element.addClass("ui-helper-hidden-accessible"),i=this.element.is(":checked"),i&&this.buttonElement.addClass("ui-state-active"),this.buttonElement.prop("aria-pressed",i)):this.buttonElement=this.element},widget:function(){return this.buttonElement},_destroy:function(){this.element.removeClass("ui-helper-hidden-accessible"),this.buttonElement.removeClass(p+" ui-state-active "+f).removeAttr("role").removeAttr("aria-pressed").html(this.buttonElement.find(".ui-button-text").html()),this.hasTitle||this.buttonElement.removeAttr("title")},_setOption:function(e,t){return this._super(e,t),"disabled"===e?(this.widget().toggleClass("ui-state-disabled",!!t),this.element.prop("disabled",!!t),t&&("checkbox"===this.type||"radio"===this.type?this.buttonElement.removeClass("ui-state-focus"):this.buttonElement.removeClass("ui-state-focus ui-state-active")),void 0):(this._resetButton(),void 0)},refresh:function(){var t=this.element.is("input, button")?this.element.is(":disabled"):this.element.hasClass("ui-button-disabled");t!==this.options.disabled&&this._setOption("disabled",t),"radio"===this.type?g(this.element[0]).each(function(){e(this).is(":checked")?e(this).button("widget").addClass("ui-state-active").attr("aria-pressed","true"):e(this).button("widget").removeClass("ui-state-active").attr("aria-pressed","false")}):"checkbox"===this.type&&(this.element.is(":checked")?this.buttonElement.addClass("ui-state-active").attr("aria-pressed","true"):this.buttonElement.removeClass("ui-state-active").attr("aria-pressed","false"))},_resetButton:function(){if("input"===this.type)return this.options.label&&this.element.val(this.options.label),void 0;var t=this.buttonElement.removeClass(f),i=e("<span></span>",this.document[0]).addClass("ui-button-text").html(this.options.label).appendTo(t.empty()).text(),s=this.options.icons,n=s.primary&&s.secondary,a=[];s.primary||s.secondary?(this.options.text&&a.push("ui-button-text-icon"+(n?"s":s.primary?"-primary":"-secondary")),s.primary&&t.prepend("<span class='ui-button-icon-primary ui-icon "+s.primary+"'></span>"),s.secondary&&t.append("<span class='ui-button-icon-secondary ui-icon "+s.secondary+"'></span>"),this.options.text||(a.push(n?"ui-button-icons-only":"ui-button-icon-only"),this.hasTitle||t.attr("title",e.trim(i)))):a.push("ui-button-text-only"),t.addClass(a.join(" "))}}),e.widget("ui.buttonset",{version:"1.11.2",options:{items:"button, input[type=button], input[type=submit], input[type=reset], input[type=checkbox], input[type=radio], a, :data(ui-button)"},_create:function(){this.element.addClass("ui-buttonset")},_init:function(){this.refresh()},_setOption:function(e,t){"disabled"===e&&this.buttons.button("option",e,t),this._super(e,t)},refresh:function(){var t="rtl"===this.element.css("direction"),i=this.element.find(this.options.items),s=i.filter(":ui-button");i.not(":ui-button").button(),s.button("refresh"),this.buttons=i.map(function(){return e(this).button("widget")[0]}).removeClass("ui-corner-all ui-corner-left ui-corner-right").filter(":first").addClass(t?"ui-corner-right":"ui-corner-left").end().filter(":last").addClass(t?"ui-corner-left":"ui-corner-right").end().end()},_destroy:function(){this.element.removeClass("ui-buttonset"),this.buttons.map(function(){return e(this).button("widget")[0]}).removeClass("ui-corner-left ui-corner-right").end().button("destroy")}}),e.ui.button,e.extend(e.ui,{datepicker:{version:"1.11.2"}});var v;e.extend(n.prototype,{markerClassName:"hasDatepicker",maxRows:4,_widgetDatepicker:function(){return this.dpDiv},setDefaults:function(e){return r(this._defaults,e||{}),this},_attachDatepicker:function(t,i){var s,n,a;s=t.nodeName.toLowerCase(),n="div"===s||"span"===s,t.id||(this.uuid+=1,t.id="dp"+this.uuid),a=this._newInst(e(t),n),a.settings=e.extend({},i||{}),"input"===s?this._connectDatepicker(t,a):n&&this._inlineDatepicker(t,a)},_newInst:function(t,i){var s=t[0].id.replace(/([^A-Za-z0-9_\-])/g,"\\\\$1");return{id:s,input:t,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:i,dpDiv:i?a(e("<div class='"+this._inlineClass+" ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>")):this.dpDiv}},_connectDatepicker:function(t,i){var s=e(t);i.append=e([]),i.trigger=e([]),s.hasClass(this.markerClassName)||(this._attachments(s,i),s.addClass(this.markerClassName).keydown(this._doKeyDown).keypress(this._doKeyPress).keyup(this._doKeyUp),this._autoSize(i),e.data(t,"datepicker",i),i.settings.disabled&&this._disableDatepicker(t))},_attachments:function(t,i){var s,n,a,o=this._get(i,"appendText"),r=this._get(i,"isRTL");i.append&&i.append.remove(),o&&(i.append=e("<span class='"+this._appendClass+"'>"+o+"</span>"),t[r?"before":"after"](i.append)),t.unbind("focus",this._showDatepicker),i.trigger&&i.trigger.remove(),s=this._get(i,"showOn"),("focus"===s||"both"===s)&&t.focus(this._showDatepicker),("button"===s||"both"===s)&&(n=this._get(i,"buttonText"),a=this._get(i,"buttonImage"),i.trigger=e(this._get(i,"buttonImageOnly")?e("<img/>").addClass(this._triggerClass).attr({src:a,alt:n,title:n}):e("<button type='button'></button>").addClass(this._triggerClass).html(a?e("<img/>").attr({src:a,alt:n,title:n}):n)),t[r?"before":"after"](i.trigger),i.trigger.click(function(){return e.datepicker._datepickerShowing&&e.datepicker._lastInput===t[0]?e.datepicker._hideDatepicker():e.datepicker._datepickerShowing&&e.datepicker._lastInput!==t[0]?(e.datepicker._hideDatepicker(),e.datepicker._showDatepicker(t[0])):e.datepicker._showDatepicker(t[0]),!1}))},_autoSize:function(e){if(this._get(e,"autoSize")&&!e.inline){var t,i,s,n,a=new Date(2009,11,20),o=this._get(e,"dateFormat");o.match(/[DM]/)&&(t=function(e){for(i=0,s=0,n=0;e.length>n;n++)e[n].length>i&&(i=e[n].length,s=n);return s},a.setMonth(t(this._get(e,o.match(/MM/)?"monthNames":"monthNamesShort"))),a.setDate(t(this._get(e,o.match(/DD/)?"dayNames":"dayNamesShort"))+20-a.getDay())),e.input.attr("size",this._formatDate(e,a).length)}},_inlineDatepicker:function(t,i){var s=e(t);s.hasClass(this.markerClassName)||(s.addClass(this.markerClassName).append(i.dpDiv),e.data(t,"datepicker",i),this._setDate(i,this._getDefaultDate(i),!0),this._updateDatepicker(i),this._updateAlternate(i),i.settings.disabled&&this._disableDatepicker(t),i.dpDiv.css("display","block"))},_dialogDatepicker:function(t,i,s,n,a){var o,h,l,u,d,c=this._dialogInst;return c||(this.uuid+=1,o="dp"+this.uuid,this._dialogInput=e("<input type='text' id='"+o+"' style='position: absolute; top: -100px; width: 0px;'/>"),this._dialogInput.keydown(this._doKeyDown),e("body").append(this._dialogInput),c=this._dialogInst=this._newInst(this._dialogInput,!1),c.settings={},e.data(this._dialogInput[0],"datepicker",c)),r(c.settings,n||{}),i=i&&i.constructor===Date?this._formatDate(c,i):i,this._dialogInput.val(i),this._pos=a?a.length?a:[a.pageX,a.pageY]:null,this._pos||(h=document.documentElement.clientWidth,l=document.documentElement.clientHeight,u=document.documentElement.scrollLeft||document.body.scrollLeft,d=document.documentElement.scrollTop||document.body.scrollTop,this._pos=[h/2-100+u,l/2-150+d]),this._dialogInput.css("left",this._pos[0]+20+"px").css("top",this._pos[1]+"px"),c.settings.onSelect=s,this._inDialog=!0,this.dpDiv.addClass(this._dialogClass),this._showDatepicker(this._dialogInput[0]),e.blockUI&&e.blockUI(this.dpDiv),e.data(this._dialogInput[0],"datepicker",c),this},_destroyDatepicker:function(t){var i,s=e(t),n=e.data(t,"datepicker");s.hasClass(this.markerClassName)&&(i=t.nodeName.toLowerCase(),e.removeData(t,"datepicker"),"input"===i?(n.append.remove(),n.trigger.remove(),s.removeClass(this.markerClassName).unbind("focus",this._showDatepicker).unbind("keydown",this._doKeyDown).unbind("keypress",this._doKeyPress).unbind("keyup",this._doKeyUp)):("div"===i||"span"===i)&&s.removeClass(this.markerClassName).empty())},_enableDatepicker:function(t){var i,s,n=e(t),a=e.data(t,"datepicker");n.hasClass(this.markerClassName)&&(i=t.nodeName.toLowerCase(),"input"===i?(t.disabled=!1,a.trigger.filter("button").each(function(){this.disabled=!1}).end().filter("img").css({opacity:"1.0",cursor:""})):("div"===i||"span"===i)&&(s=n.children("."+this._inlineClass),s.children().removeClass("ui-state-disabled"),s.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!1)),this._disabledInputs=e.map(this._disabledInputs,function(e){return e===t?null:e}))},_disableDatepicker:function(t){var i,s,n=e(t),a=e.data(t,"datepicker");n.hasClass(this.markerClassName)&&(i=t.nodeName.toLowerCase(),"input"===i?(t.disabled=!0,a.trigger.filter("button").each(function(){this.disabled=!0}).end().filter("img").css({opacity:"0.5",cursor:"default"})):("div"===i||"span"===i)&&(s=n.children("."+this._inlineClass),s.children().addClass("ui-state-disabled"),s.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!0)),this._disabledInputs=e.map(this._disabledInputs,function(e){return e===t?null:e}),this._disabledInputs[this._disabledInputs.length]=t)},_isDisabledDatepicker:function(e){if(!e)return!1;for(var t=0;this._disabledInputs.length>t;t++)if(this._disabledInputs[t]===e)return!0;return!1},_getInst:function(t){try{return e.data(t,"datepicker")}catch(i){throw"Missing instance data for this datepicker"}},_optionDatepicker:function(t,i,s){var n,a,o,h,l=this._getInst(t);return 2===arguments.length&&"string"==typeof i?"defaults"===i?e.extend({},e.datepicker._defaults):l?"all"===i?e.extend({},l.settings):this._get(l,i):null:(n=i||{},"string"==typeof i&&(n={},n[i]=s),l&&(this._curInst===l&&this._hideDatepicker(),a=this._getDateDatepicker(t,!0),o=this._getMinMaxDate(l,"min"),h=this._getMinMaxDate(l,"max"),r(l.settings,n),null!==o&&void 0!==n.dateFormat&&void 0===n.minDate&&(l.settings.minDate=this._formatDate(l,o)),null!==h&&void 0!==n.dateFormat&&void 0===n.maxDate&&(l.settings.maxDate=this._formatDate(l,h)),"disabled"in n&&(n.disabled?this._disableDatepicker(t):this._enableDatepicker(t)),this._attachments(e(t),l),this._autoSize(l),this._setDate(l,a),this._updateAlternate(l),this._updateDatepicker(l)),void 0)},_changeDatepicker:function(e,t,i){this._optionDatepicker(e,t,i)},_refreshDatepicker:function(e){var t=this._getInst(e);t&&this._updateDatepicker(t)},_setDateDatepicker:function(e,t){var i=this._getInst(e);i&&(this._setDate(i,t),this._updateDatepicker(i),this._updateAlternate(i))},_getDateDatepicker:function(e,t){var i=this._getInst(e);return i&&!i.inline&&this._setDateFromField(i,t),i?this._getDate(i):null},_doKeyDown:function(t){var i,s,n,a=e.datepicker._getInst(t.target),o=!0,r=a.dpDiv.is(".ui-datepicker-rtl");if(a._keyEvent=!0,e.datepicker._datepickerShowing)switch(t.keyCode){case 9:e.datepicker._hideDatepicker(),o=!1;break;case 13:return n=e("td."+e.datepicker._dayOverClass+":not(."+e.datepicker._currentClass+")",a.dpDiv),n[0]&&e.datepicker._selectDay(t.target,a.selectedMonth,a.selectedYear,n[0]),i=e.datepicker._get(a,"onSelect"),i?(s=e.datepicker._formatDate(a),i.apply(a.input?a.input[0]:null,[s,a])):e.datepicker._hideDatepicker(),!1;case 27:e.datepicker._hideDatepicker();break;case 33:e.datepicker._adjustDate(t.target,t.ctrlKey?-e.datepicker._get(a,"stepBigMonths"):-e.datepicker._get(a,"stepMonths"),"M");break;case 34:e.datepicker._adjustDate(t.target,t.ctrlKey?+e.datepicker._get(a,"stepBigMonths"):+e.datepicker._get(a,"stepMonths"),"M");break;case 35:(t.ctrlKey||t.metaKey)&&e.datepicker._clearDate(t.target),o=t.ctrlKey||t.metaKey;break;case 36:(t.ctrlKey||t.metaKey)&&e.datepicker._gotoToday(t.target),o=t.ctrlKey||t.metaKey;break;case 37:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,r?1:-1,"D"),o=t.ctrlKey||t.metaKey,t.originalEvent.altKey&&e.datepicker._adjustDate(t.target,t.ctrlKey?-e.datepicker._get(a,"stepBigMonths"):-e.datepicker._get(a,"stepMonths"),"M");break;case 38:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,-7,"D"),o=t.ctrlKey||t.metaKey;break;case 39:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,r?-1:1,"D"),o=t.ctrlKey||t.metaKey,t.originalEvent.altKey&&e.datepicker._adjustDate(t.target,t.ctrlKey?+e.datepicker._get(a,"stepBigMonths"):+e.datepicker._get(a,"stepMonths"),"M");break;case 40:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,7,"D"),o=t.ctrlKey||t.metaKey;break;default:o=!1}else 36===t.keyCode&&t.ctrlKey?e.datepicker._showDatepicker(this):o=!1;o&&(t.preventDefault(),t.stopPropagation())},_doKeyPress:function(t){var i,s,n=e.datepicker._getInst(t.target);return e.datepicker._get(n,"constrainInput")?(i=e.datepicker._possibleChars(e.datepicker._get(n,"dateFormat")),s=String.fromCharCode(null==t.charCode?t.keyCode:t.charCode),t.ctrlKey||t.metaKey||" ">s||!i||i.indexOf(s)>-1):void 0
},_doKeyUp:function(t){var i,s=e.datepicker._getInst(t.target);if(s.input.val()!==s.lastVal)try{i=e.datepicker.parseDate(e.datepicker._get(s,"dateFormat"),s.input?s.input.val():null,e.datepicker._getFormatConfig(s)),i&&(e.datepicker._setDateFromField(s),e.datepicker._updateAlternate(s),e.datepicker._updateDatepicker(s))}catch(n){}return!0},_showDatepicker:function(t){if(t=t.target||t,"input"!==t.nodeName.toLowerCase()&&(t=e("input",t.parentNode)[0]),!e.datepicker._isDisabledDatepicker(t)&&e.datepicker._lastInput!==t){var i,n,a,o,h,l,u;i=e.datepicker._getInst(t),e.datepicker._curInst&&e.datepicker._curInst!==i&&(e.datepicker._curInst.dpDiv.stop(!0,!0),i&&e.datepicker._datepickerShowing&&e.datepicker._hideDatepicker(e.datepicker._curInst.input[0])),n=e.datepicker._get(i,"beforeShow"),a=n?n.apply(t,[t,i]):{},a!==!1&&(r(i.settings,a),i.lastVal=null,e.datepicker._lastInput=t,e.datepicker._setDateFromField(i),e.datepicker._inDialog&&(t.value=""),e.datepicker._pos||(e.datepicker._pos=e.datepicker._findPos(t),e.datepicker._pos[1]+=t.offsetHeight),o=!1,e(t).parents().each(function(){return o|="fixed"===e(this).css("position"),!o}),h={left:e.datepicker._pos[0],top:e.datepicker._pos[1]},e.datepicker._pos=null,i.dpDiv.empty(),i.dpDiv.css({position:"absolute",display:"block",top:"-1000px"}),e.datepicker._updateDatepicker(i),h=e.datepicker._checkOffset(i,h,o),i.dpDiv.css({position:e.datepicker._inDialog&&e.blockUI?"static":o?"fixed":"absolute",display:"none",left:h.left+"px",top:h.top+"px"}),i.inline||(l=e.datepicker._get(i,"showAnim"),u=e.datepicker._get(i,"duration"),i.dpDiv.css("z-index",s(e(t))+1),e.datepicker._datepickerShowing=!0,e.effects&&e.effects.effect[l]?i.dpDiv.show(l,e.datepicker._get(i,"showOptions"),u):i.dpDiv[l||"show"](l?u:null),e.datepicker._shouldFocusInput(i)&&i.input.focus(),e.datepicker._curInst=i))}},_updateDatepicker:function(t){this.maxRows=4,v=t,t.dpDiv.empty().append(this._generateHTML(t)),this._attachHandlers(t);var i,s=this._getNumberOfMonths(t),n=s[1],a=17,r=t.dpDiv.find("."+this._dayOverClass+" a");r.length>0&&o.apply(r.get(0)),t.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width(""),n>1&&t.dpDiv.addClass("ui-datepicker-multi-"+n).css("width",a*n+"em"),t.dpDiv[(1!==s[0]||1!==s[1]?"add":"remove")+"Class"]("ui-datepicker-multi"),t.dpDiv[(this._get(t,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl"),t===e.datepicker._curInst&&e.datepicker._datepickerShowing&&e.datepicker._shouldFocusInput(t)&&t.input.focus(),t.yearshtml&&(i=t.yearshtml,setTimeout(function(){i===t.yearshtml&&t.yearshtml&&t.dpDiv.find("select.ui-datepicker-year:first").replaceWith(t.yearshtml),i=t.yearshtml=null},0))},_shouldFocusInput:function(e){return e.input&&e.input.is(":visible")&&!e.input.is(":disabled")&&!e.input.is(":focus")},_checkOffset:function(t,i,s){var n=t.dpDiv.outerWidth(),a=t.dpDiv.outerHeight(),o=t.input?t.input.outerWidth():0,r=t.input?t.input.outerHeight():0,h=document.documentElement.clientWidth+(s?0:e(document).scrollLeft()),l=document.documentElement.clientHeight+(s?0:e(document).scrollTop());return i.left-=this._get(t,"isRTL")?n-o:0,i.left-=s&&i.left===t.input.offset().left?e(document).scrollLeft():0,i.top-=s&&i.top===t.input.offset().top+r?e(document).scrollTop():0,i.left-=Math.min(i.left,i.left+n>h&&h>n?Math.abs(i.left+n-h):0),i.top-=Math.min(i.top,i.top+a>l&&l>a?Math.abs(a+r):0),i},_findPos:function(t){for(var i,s=this._getInst(t),n=this._get(s,"isRTL");t&&("hidden"===t.type||1!==t.nodeType||e.expr.filters.hidden(t));)t=t[n?"previousSibling":"nextSibling"];return i=e(t).offset(),[i.left,i.top]},_hideDatepicker:function(t){var i,s,n,a,o=this._curInst;!o||t&&o!==e.data(t,"datepicker")||this._datepickerShowing&&(i=this._get(o,"showAnim"),s=this._get(o,"duration"),n=function(){e.datepicker._tidyDialog(o)},e.effects&&(e.effects.effect[i]||e.effects[i])?o.dpDiv.hide(i,e.datepicker._get(o,"showOptions"),s,n):o.dpDiv["slideDown"===i?"slideUp":"fadeIn"===i?"fadeOut":"hide"](i?s:null,n),i||n(),this._datepickerShowing=!1,a=this._get(o,"onClose"),a&&a.apply(o.input?o.input[0]:null,[o.input?o.input.val():"",o]),this._lastInput=null,this._inDialog&&(this._dialogInput.css({position:"absolute",left:"0",top:"-100px"}),e.blockUI&&(e.unblockUI(),e("body").append(this.dpDiv))),this._inDialog=!1)},_tidyDialog:function(e){e.dpDiv.removeClass(this._dialogClass).unbind(".ui-datepicker-calendar")},_checkExternalClick:function(t){if(e.datepicker._curInst){var i=e(t.target),s=e.datepicker._getInst(i[0]);(i[0].id!==e.datepicker._mainDivId&&0===i.parents("#"+e.datepicker._mainDivId).length&&!i.hasClass(e.datepicker.markerClassName)&&!i.closest("."+e.datepicker._triggerClass).length&&e.datepicker._datepickerShowing&&(!e.datepicker._inDialog||!e.blockUI)||i.hasClass(e.datepicker.markerClassName)&&e.datepicker._curInst!==s)&&e.datepicker._hideDatepicker()}},_adjustDate:function(t,i,s){var n=e(t),a=this._getInst(n[0]);this._isDisabledDatepicker(n[0])||(this._adjustInstDate(a,i+("M"===s?this._get(a,"showCurrentAtPos"):0),s),this._updateDatepicker(a))},_gotoToday:function(t){var i,s=e(t),n=this._getInst(s[0]);this._get(n,"gotoCurrent")&&n.currentDay?(n.selectedDay=n.currentDay,n.drawMonth=n.selectedMonth=n.currentMonth,n.drawYear=n.selectedYear=n.currentYear):(i=new Date,n.selectedDay=i.getDate(),n.drawMonth=n.selectedMonth=i.getMonth(),n.drawYear=n.selectedYear=i.getFullYear()),this._notifyChange(n),this._adjustDate(s)},_selectMonthYear:function(t,i,s){var n=e(t),a=this._getInst(n[0]);a["selected"+("M"===s?"Month":"Year")]=a["draw"+("M"===s?"Month":"Year")]=parseInt(i.options[i.selectedIndex].value,10),this._notifyChange(a),this._adjustDate(n)},_selectDay:function(t,i,s,n){var a,o=e(t);e(n).hasClass(this._unselectableClass)||this._isDisabledDatepicker(o[0])||(a=this._getInst(o[0]),a.selectedDay=a.currentDay=e("a",n).html(),a.selectedMonth=a.currentMonth=i,a.selectedYear=a.currentYear=s,this._selectDate(t,this._formatDate(a,a.currentDay,a.currentMonth,a.currentYear)))},_clearDate:function(t){var i=e(t);this._selectDate(i,"")},_selectDate:function(t,i){var s,n=e(t),a=this._getInst(n[0]);i=null!=i?i:this._formatDate(a),a.input&&a.input.val(i),this._updateAlternate(a),s=this._get(a,"onSelect"),s?s.apply(a.input?a.input[0]:null,[i,a]):a.input&&a.input.trigger("change"),a.inline?this._updateDatepicker(a):(this._hideDatepicker(),this._lastInput=a.input[0],"object"!=typeof a.input[0]&&a.input.focus(),this._lastInput=null)},_updateAlternate:function(t){var i,s,n,a=this._get(t,"altField");a&&(i=this._get(t,"altFormat")||this._get(t,"dateFormat"),s=this._getDate(t),n=this.formatDate(i,s,this._getFormatConfig(t)),e(a).each(function(){e(this).val(n)}))},noWeekends:function(e){var t=e.getDay();return[t>0&&6>t,""]},iso8601Week:function(e){var t,i=new Date(e.getTime());return i.setDate(i.getDate()+4-(i.getDay()||7)),t=i.getTime(),i.setMonth(0),i.setDate(1),Math.floor(Math.round((t-i)/864e5)/7)+1},parseDate:function(t,i,s){if(null==t||null==i)throw"Invalid arguments";if(i="object"==typeof i?""+i:i+"",""===i)return null;var n,a,o,r,h=0,l=(s?s.shortYearCutoff:null)||this._defaults.shortYearCutoff,u="string"!=typeof l?l:(new Date).getFullYear()%100+parseInt(l,10),d=(s?s.dayNamesShort:null)||this._defaults.dayNamesShort,c=(s?s.dayNames:null)||this._defaults.dayNames,p=(s?s.monthNamesShort:null)||this._defaults.monthNamesShort,f=(s?s.monthNames:null)||this._defaults.monthNames,m=-1,g=-1,v=-1,y=-1,b=!1,_=function(e){var i=t.length>n+1&&t.charAt(n+1)===e;return i&&n++,i},x=function(e){var t=_(e),s="@"===e?14:"!"===e?20:"y"===e&&t?4:"o"===e?3:2,n="y"===e?s:1,a=RegExp("^\\d{"+n+","+s+"}"),o=i.substring(h).match(a);if(!o)throw"Missing number at position "+h;return h+=o[0].length,parseInt(o[0],10)},w=function(t,s,n){var a=-1,o=e.map(_(t)?n:s,function(e,t){return[[t,e]]}).sort(function(e,t){return-(e[1].length-t[1].length)});if(e.each(o,function(e,t){var s=t[1];return i.substr(h,s.length).toLowerCase()===s.toLowerCase()?(a=t[0],h+=s.length,!1):void 0}),-1!==a)return a+1;throw"Unknown name at position "+h},k=function(){if(i.charAt(h)!==t.charAt(n))throw"Unexpected literal at position "+h;h++};for(n=0;t.length>n;n++)if(b)"'"!==t.charAt(n)||_("'")?k():b=!1;else switch(t.charAt(n)){case"d":v=x("d");break;case"D":w("D",d,c);break;case"o":y=x("o");break;case"m":g=x("m");break;case"M":g=w("M",p,f);break;case"y":m=x("y");break;case"@":r=new Date(x("@")),m=r.getFullYear(),g=r.getMonth()+1,v=r.getDate();break;case"!":r=new Date((x("!")-this._ticksTo1970)/1e4),m=r.getFullYear(),g=r.getMonth()+1,v=r.getDate();break;case"'":_("'")?k():b=!0;break;default:k()}if(i.length>h&&(o=i.substr(h),!/^\s+/.test(o)))throw"Extra/unparsed characters found in date: "+o;if(-1===m?m=(new Date).getFullYear():100>m&&(m+=(new Date).getFullYear()-(new Date).getFullYear()%100+(u>=m?0:-100)),y>-1)for(g=1,v=y;;){if(a=this._getDaysInMonth(m,g-1),a>=v)break;g++,v-=a}if(r=this._daylightSavingAdjust(new Date(m,g-1,v)),r.getFullYear()!==m||r.getMonth()+1!==g||r.getDate()!==v)throw"Invalid date";return r},ATOM:"yy-mm-dd",COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TICKS:"!",TIMESTAMP:"@",W3C:"yy-mm-dd",_ticksTo1970:1e7*60*60*24*(718685+Math.floor(492.5)-Math.floor(19.7)+Math.floor(4.925)),formatDate:function(e,t,i){if(!t)return"";var s,n=(i?i.dayNamesShort:null)||this._defaults.dayNamesShort,a=(i?i.dayNames:null)||this._defaults.dayNames,o=(i?i.monthNamesShort:null)||this._defaults.monthNamesShort,r=(i?i.monthNames:null)||this._defaults.monthNames,h=function(t){var i=e.length>s+1&&e.charAt(s+1)===t;return i&&s++,i},l=function(e,t,i){var s=""+t;if(h(e))for(;i>s.length;)s="0"+s;return s},u=function(e,t,i,s){return h(e)?s[t]:i[t]},d="",c=!1;if(t)for(s=0;e.length>s;s++)if(c)"'"!==e.charAt(s)||h("'")?d+=e.charAt(s):c=!1;else switch(e.charAt(s)){case"d":d+=l("d",t.getDate(),2);break;case"D":d+=u("D",t.getDay(),n,a);break;case"o":d+=l("o",Math.round((new Date(t.getFullYear(),t.getMonth(),t.getDate()).getTime()-new Date(t.getFullYear(),0,0).getTime())/864e5),3);break;case"m":d+=l("m",t.getMonth()+1,2);break;case"M":d+=u("M",t.getMonth(),o,r);break;case"y":d+=h("y")?t.getFullYear():(10>t.getYear()%100?"0":"")+t.getYear()%100;break;case"@":d+=t.getTime();break;case"!":d+=1e4*t.getTime()+this._ticksTo1970;break;case"'":h("'")?d+="'":c=!0;break;default:d+=e.charAt(s)}return d},_possibleChars:function(e){var t,i="",s=!1,n=function(i){var s=e.length>t+1&&e.charAt(t+1)===i;return s&&t++,s};for(t=0;e.length>t;t++)if(s)"'"!==e.charAt(t)||n("'")?i+=e.charAt(t):s=!1;else switch(e.charAt(t)){case"d":case"m":case"y":case"@":i+="0123456789";break;case"D":case"M":return null;case"'":n("'")?i+="'":s=!0;break;default:i+=e.charAt(t)}return i},_get:function(e,t){return void 0!==e.settings[t]?e.settings[t]:this._defaults[t]},_setDateFromField:function(e,t){if(e.input.val()!==e.lastVal){var i=this._get(e,"dateFormat"),s=e.lastVal=e.input?e.input.val():null,n=this._getDefaultDate(e),a=n,o=this._getFormatConfig(e);try{a=this.parseDate(i,s,o)||n}catch(r){s=t?"":s}e.selectedDay=a.getDate(),e.drawMonth=e.selectedMonth=a.getMonth(),e.drawYear=e.selectedYear=a.getFullYear(),e.currentDay=s?a.getDate():0,e.currentMonth=s?a.getMonth():0,e.currentYear=s?a.getFullYear():0,this._adjustInstDate(e)}},_getDefaultDate:function(e){return this._restrictMinMax(e,this._determineDate(e,this._get(e,"defaultDate"),new Date))},_determineDate:function(t,i,s){var n=function(e){var t=new Date;return t.setDate(t.getDate()+e),t},a=function(i){try{return e.datepicker.parseDate(e.datepicker._get(t,"dateFormat"),i,e.datepicker._getFormatConfig(t))}catch(s){}for(var n=(i.toLowerCase().match(/^c/)?e.datepicker._getDate(t):null)||new Date,a=n.getFullYear(),o=n.getMonth(),r=n.getDate(),h=/([+\-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,l=h.exec(i);l;){switch(l[2]||"d"){case"d":case"D":r+=parseInt(l[1],10);break;case"w":case"W":r+=7*parseInt(l[1],10);break;case"m":case"M":o+=parseInt(l[1],10),r=Math.min(r,e.datepicker._getDaysInMonth(a,o));break;case"y":case"Y":a+=parseInt(l[1],10),r=Math.min(r,e.datepicker._getDaysInMonth(a,o))}l=h.exec(i)}return new Date(a,o,r)},o=null==i||""===i?s:"string"==typeof i?a(i):"number"==typeof i?isNaN(i)?s:n(i):new Date(i.getTime());return o=o&&"Invalid Date"==""+o?s:o,o&&(o.setHours(0),o.setMinutes(0),o.setSeconds(0),o.setMilliseconds(0)),this._daylightSavingAdjust(o)},_daylightSavingAdjust:function(e){return e?(e.setHours(e.getHours()>12?e.getHours()+2:0),e):null},_setDate:function(e,t,i){var s=!t,n=e.selectedMonth,a=e.selectedYear,o=this._restrictMinMax(e,this._determineDate(e,t,new Date));e.selectedDay=e.currentDay=o.getDate(),e.drawMonth=e.selectedMonth=e.currentMonth=o.getMonth(),e.drawYear=e.selectedYear=e.currentYear=o.getFullYear(),n===e.selectedMonth&&a===e.selectedYear||i||this._notifyChange(e),this._adjustInstDate(e),e.input&&e.input.val(s?"":this._formatDate(e))},_getDate:function(e){var t=!e.currentYear||e.input&&""===e.input.val()?null:this._daylightSavingAdjust(new Date(e.currentYear,e.currentMonth,e.currentDay));return t},_attachHandlers:function(t){var i=this._get(t,"stepMonths"),s="#"+t.id.replace(/\\\\/g,"\\");t.dpDiv.find("[data-handler]").map(function(){var t={prev:function(){e.datepicker._adjustDate(s,-i,"M")},next:function(){e.datepicker._adjustDate(s,+i,"M")},hide:function(){e.datepicker._hideDatepicker()},today:function(){e.datepicker._gotoToday(s)},selectDay:function(){return e.datepicker._selectDay(s,+this.getAttribute("data-month"),+this.getAttribute("data-year"),this),!1},selectMonth:function(){return e.datepicker._selectMonthYear(s,this,"M"),!1},selectYear:function(){return e.datepicker._selectMonthYear(s,this,"Y"),!1}};e(this).bind(this.getAttribute("data-event"),t[this.getAttribute("data-handler")])})},_generateHTML:function(e){var t,i,s,n,a,o,r,h,l,u,d,c,p,f,m,g,v,y,b,_,x,w,k,T,D,S,M,C,N,A,P,I,z,H,F,E,O,j,W,L=new Date,R=this._daylightSavingAdjust(new Date(L.getFullYear(),L.getMonth(),L.getDate())),Y=this._get(e,"isRTL"),B=this._get(e,"showButtonPanel"),J=this._get(e,"hideIfNoPrevNext"),q=this._get(e,"navigationAsDateFormat"),K=this._getNumberOfMonths(e),V=this._get(e,"showCurrentAtPos"),U=this._get(e,"stepMonths"),Q=1!==K[0]||1!==K[1],G=this._daylightSavingAdjust(e.currentDay?new Date(e.currentYear,e.currentMonth,e.currentDay):new Date(9999,9,9)),X=this._getMinMaxDate(e,"min"),$=this._getMinMaxDate(e,"max"),Z=e.drawMonth-V,et=e.drawYear;if(0>Z&&(Z+=12,et--),$)for(t=this._daylightSavingAdjust(new Date($.getFullYear(),$.getMonth()-K[0]*K[1]+1,$.getDate())),t=X&&X>t?X:t;this._daylightSavingAdjust(new Date(et,Z,1))>t;)Z--,0>Z&&(Z=11,et--);for(e.drawMonth=Z,e.drawYear=et,i=this._get(e,"prevText"),i=q?this.formatDate(i,this._daylightSavingAdjust(new Date(et,Z-U,1)),this._getFormatConfig(e)):i,s=this._canAdjustMonth(e,-1,et,Z)?"<a class='ui-datepicker-prev ui-corner-all' data-handler='prev' data-event='click' title='"+i+"'><span class='ui-icon ui-icon-circle-triangle-"+(Y?"e":"w")+"'>"+i+"</span></a>":J?"":"<a class='ui-datepicker-prev ui-corner-all ui-state-disabled' title='"+i+"'><span class='ui-icon ui-icon-circle-triangle-"+(Y?"e":"w")+"'>"+i+"</span></a>",n=this._get(e,"nextText"),n=q?this.formatDate(n,this._daylightSavingAdjust(new Date(et,Z+U,1)),this._getFormatConfig(e)):n,a=this._canAdjustMonth(e,1,et,Z)?"<a class='ui-datepicker-next ui-corner-all' data-handler='next' data-event='click' title='"+n+"'><span class='ui-icon ui-icon-circle-triangle-"+(Y?"w":"e")+"'>"+n+"</span></a>":J?"":"<a class='ui-datepicker-next ui-corner-all ui-state-disabled' title='"+n+"'><span class='ui-icon ui-icon-circle-triangle-"+(Y?"w":"e")+"'>"+n+"</span></a>",o=this._get(e,"currentText"),r=this._get(e,"gotoCurrent")&&e.currentDay?G:R,o=q?this.formatDate(o,r,this._getFormatConfig(e)):o,h=e.inline?"":"<button type='button' class='ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all' data-handler='hide' data-event='click'>"+this._get(e,"closeText")+"</button>",l=B?"<div class='ui-datepicker-buttonpane ui-widget-content'>"+(Y?h:"")+(this._isInRange(e,r)?"<button type='button' class='ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all' data-handler='today' data-event='click'>"+o+"</button>":"")+(Y?"":h)+"</div>":"",u=parseInt(this._get(e,"firstDay"),10),u=isNaN(u)?0:u,d=this._get(e,"showWeek"),c=this._get(e,"dayNames"),p=this._get(e,"dayNamesMin"),f=this._get(e,"monthNames"),m=this._get(e,"monthNamesShort"),g=this._get(e,"beforeShowDay"),v=this._get(e,"showOtherMonths"),y=this._get(e,"selectOtherMonths"),b=this._getDefaultDate(e),_="",w=0;K[0]>w;w++){for(k="",this.maxRows=4,T=0;K[1]>T;T++){if(D=this._daylightSavingAdjust(new Date(et,Z,e.selectedDay)),S=" ui-corner-all",M="",Q){if(M+="<div class='ui-datepicker-group",K[1]>1)switch(T){case 0:M+=" ui-datepicker-group-first",S=" ui-corner-"+(Y?"right":"left");break;case K[1]-1:M+=" ui-datepicker-group-last",S=" ui-corner-"+(Y?"left":"right");break;default:M+=" ui-datepicker-group-middle",S=""}M+="'>"}for(M+="<div class='ui-datepicker-header ui-widget-header ui-helper-clearfix"+S+"'>"+(/all|left/.test(S)&&0===w?Y?a:s:"")+(/all|right/.test(S)&&0===w?Y?s:a:"")+this._generateMonthYearHeader(e,Z,et,X,$,w>0||T>0,f,m)+"</div><table class='ui-datepicker-calendar'><thead>"+"<tr>",C=d?"<th class='ui-datepicker-week-col'>"+this._get(e,"weekHeader")+"</th>":"",x=0;7>x;x++)N=(x+u)%7,C+="<th scope='col'"+((x+u+6)%7>=5?" class='ui-datepicker-week-end'":"")+">"+"<span title='"+c[N]+"'>"+p[N]+"</span></th>";for(M+=C+"</tr></thead><tbody>",A=this._getDaysInMonth(et,Z),et===e.selectedYear&&Z===e.selectedMonth&&(e.selectedDay=Math.min(e.selectedDay,A)),P=(this._getFirstDayOfMonth(et,Z)-u+7)%7,I=Math.ceil((P+A)/7),z=Q?this.maxRows>I?this.maxRows:I:I,this.maxRows=z,H=this._daylightSavingAdjust(new Date(et,Z,1-P)),F=0;z>F;F++){for(M+="<tr>",E=d?"<td class='ui-datepicker-week-col'>"+this._get(e,"calculateWeek")(H)+"</td>":"",x=0;7>x;x++)O=g?g.apply(e.input?e.input[0]:null,[H]):[!0,""],j=H.getMonth()!==Z,W=j&&!y||!O[0]||X&&X>H||$&&H>$,E+="<td class='"+((x+u+6)%7>=5?" ui-datepicker-week-end":"")+(j?" ui-datepicker-other-month":"")+(H.getTime()===D.getTime()&&Z===e.selectedMonth&&e._keyEvent||b.getTime()===H.getTime()&&b.getTime()===D.getTime()?" "+this._dayOverClass:"")+(W?" "+this._unselectableClass+" ui-state-disabled":"")+(j&&!v?"":" "+O[1]+(H.getTime()===G.getTime()?" "+this._currentClass:"")+(H.getTime()===R.getTime()?" ui-datepicker-today":""))+"'"+(j&&!v||!O[2]?"":" title='"+O[2].replace(/'/g,"&#39;")+"'")+(W?"":" data-handler='selectDay' data-event='click' data-month='"+H.getMonth()+"' data-year='"+H.getFullYear()+"'")+">"+(j&&!v?"&#xa0;":W?"<span class='ui-state-default'>"+H.getDate()+"</span>":"<a class='ui-state-default"+(H.getTime()===R.getTime()?" ui-state-highlight":"")+(H.getTime()===G.getTime()?" ui-state-active":"")+(j?" ui-priority-secondary":"")+"' href='#'>"+H.getDate()+"</a>")+"</td>",H.setDate(H.getDate()+1),H=this._daylightSavingAdjust(H);M+=E+"</tr>"}Z++,Z>11&&(Z=0,et++),M+="</tbody></table>"+(Q?"</div>"+(K[0]>0&&T===K[1]-1?"<div class='ui-datepicker-row-break'></div>":""):""),k+=M}_+=k}return _+=l,e._keyEvent=!1,_},_generateMonthYearHeader:function(e,t,i,s,n,a,o,r){var h,l,u,d,c,p,f,m,g=this._get(e,"changeMonth"),v=this._get(e,"changeYear"),y=this._get(e,"showMonthAfterYear"),b="<div class='ui-datepicker-title'>",_="";if(a||!g)_+="<span class='ui-datepicker-month'>"+o[t]+"</span>";else{for(h=s&&s.getFullYear()===i,l=n&&n.getFullYear()===i,_+="<select class='ui-datepicker-month' data-handler='selectMonth' data-event='change'>",u=0;12>u;u++)(!h||u>=s.getMonth())&&(!l||n.getMonth()>=u)&&(_+="<option value='"+u+"'"+(u===t?" selected='selected'":"")+">"+r[u]+"</option>");_+="</select>"}if(y||(b+=_+(!a&&g&&v?"":"&#xa0;")),!e.yearshtml)if(e.yearshtml="",a||!v)b+="<span class='ui-datepicker-year'>"+i+"</span>";else{for(d=this._get(e,"yearRange").split(":"),c=(new Date).getFullYear(),p=function(e){var t=e.match(/c[+\-].*/)?i+parseInt(e.substring(1),10):e.match(/[+\-].*/)?c+parseInt(e,10):parseInt(e,10);return isNaN(t)?c:t},f=p(d[0]),m=Math.max(f,p(d[1]||"")),f=s?Math.max(f,s.getFullYear()):f,m=n?Math.min(m,n.getFullYear()):m,e.yearshtml+="<select class='ui-datepicker-year' data-handler='selectYear' data-event='change'>";m>=f;f++)e.yearshtml+="<option value='"+f+"'"+(f===i?" selected='selected'":"")+">"+f+"</option>";e.yearshtml+="</select>",b+=e.yearshtml,e.yearshtml=null}return b+=this._get(e,"yearSuffix"),y&&(b+=(!a&&g&&v?"":"&#xa0;")+_),b+="</div>"},_adjustInstDate:function(e,t,i){var s=e.drawYear+("Y"===i?t:0),n=e.drawMonth+("M"===i?t:0),a=Math.min(e.selectedDay,this._getDaysInMonth(s,n))+("D"===i?t:0),o=this._restrictMinMax(e,this._daylightSavingAdjust(new Date(s,n,a)));e.selectedDay=o.getDate(),e.drawMonth=e.selectedMonth=o.getMonth(),e.drawYear=e.selectedYear=o.getFullYear(),("M"===i||"Y"===i)&&this._notifyChange(e)},_restrictMinMax:function(e,t){var i=this._getMinMaxDate(e,"min"),s=this._getMinMaxDate(e,"max"),n=i&&i>t?i:t;return s&&n>s?s:n},_notifyChange:function(e){var t=this._get(e,"onChangeMonthYear");t&&t.apply(e.input?e.input[0]:null,[e.selectedYear,e.selectedMonth+1,e])},_getNumberOfMonths:function(e){var t=this._get(e,"numberOfMonths");return null==t?[1,1]:"number"==typeof t?[1,t]:t},_getMinMaxDate:function(e,t){return this._determineDate(e,this._get(e,t+"Date"),null)},_getDaysInMonth:function(e,t){return 32-this._daylightSavingAdjust(new Date(e,t,32)).getDate()},_getFirstDayOfMonth:function(e,t){return new Date(e,t,1).getDay()},_canAdjustMonth:function(e,t,i,s){var n=this._getNumberOfMonths(e),a=this._daylightSavingAdjust(new Date(i,s+(0>t?t:n[0]*n[1]),1));return 0>t&&a.setDate(this._getDaysInMonth(a.getFullYear(),a.getMonth())),this._isInRange(e,a)},_isInRange:function(e,t){var i,s,n=this._getMinMaxDate(e,"min"),a=this._getMinMaxDate(e,"max"),o=null,r=null,h=this._get(e,"yearRange");return h&&(i=h.split(":"),s=(new Date).getFullYear(),o=parseInt(i[0],10),r=parseInt(i[1],10),i[0].match(/[+\-].*/)&&(o+=s),i[1].match(/[+\-].*/)&&(r+=s)),(!n||t.getTime()>=n.getTime())&&(!a||t.getTime()<=a.getTime())&&(!o||t.getFullYear()>=o)&&(!r||r>=t.getFullYear())},_getFormatConfig:function(e){var t=this._get(e,"shortYearCutoff");return t="string"!=typeof t?t:(new Date).getFullYear()%100+parseInt(t,10),{shortYearCutoff:t,dayNamesShort:this._get(e,"dayNamesShort"),dayNames:this._get(e,"dayNames"),monthNamesShort:this._get(e,"monthNamesShort"),monthNames:this._get(e,"monthNames")}},_formatDate:function(e,t,i,s){t||(e.currentDay=e.selectedDay,e.currentMonth=e.selectedMonth,e.currentYear=e.selectedYear);var n=t?"object"==typeof t?t:this._daylightSavingAdjust(new Date(s,i,t)):this._daylightSavingAdjust(new Date(e.currentYear,e.currentMonth,e.currentDay));return this.formatDate(this._get(e,"dateFormat"),n,this._getFormatConfig(e))}}),e.fn.datepicker=function(t){if(!this.length)return this;e.datepicker.initialized||(e(document).mousedown(e.datepicker._checkExternalClick),e.datepicker.initialized=!0),0===e("#"+e.datepicker._mainDivId).length&&e("body").append(e.datepicker.dpDiv);var i=Array.prototype.slice.call(arguments,1);return"string"!=typeof t||"isDisabled"!==t&&"getDate"!==t&&"widget"!==t?"option"===t&&2===arguments.length&&"string"==typeof arguments[1]?e.datepicker["_"+t+"Datepicker"].apply(e.datepicker,[this[0]].concat(i)):this.each(function(){"string"==typeof t?e.datepicker["_"+t+"Datepicker"].apply(e.datepicker,[this].concat(i)):e.datepicker._attachDatepicker(this,t)}):e.datepicker["_"+t+"Datepicker"].apply(e.datepicker,[this[0]].concat(i))},e.datepicker=new n,e.datepicker.initialized=!1,e.datepicker.uuid=(new Date).getTime(),e.datepicker.version="1.11.2",e.datepicker,e.widget("ui.draggable",e.ui.mouse,{version:"1.11.2",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"===this.options.helper&&this._setPositionRelative(),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._setHandleClassName(),this._mouseInit()},_setOption:function(e,t){this._super(e,t),"handle"===e&&(this._removeHandleClassName(),this._setHandleClassName())},_destroy:function(){return(this.helper||this.element).is(".ui-draggable-dragging")?(this.destroyOnClear=!0,void 0):(this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._removeHandleClassName(),this._mouseDestroy(),void 0)},_mouseCapture:function(t){var i=this.options;return this._blurActiveElement(t),this.helper||i.disabled||e(t.target).closest(".ui-resizable-handle").length>0?!1:(this.handle=this._getHandle(t),this.handle?(this._blockFrames(i.iframeFix===!0?"iframe":i.iframeFix),!0):!1)},_blockFrames:function(t){this.iframeBlocks=this.document.find(t).map(function(){var t=e(this);return e("<div>").css("position","absolute").appendTo(t.parent()).outerWidth(t.outerWidth()).outerHeight(t.outerHeight()).offset(t.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_blurActiveElement:function(t){var i=this.document[0];if(this.handleElement.is(t.target))try{i.activeElement&&"body"!==i.activeElement.nodeName.toLowerCase()&&e(i.activeElement).blur()}catch(s){}},_mouseStart:function(t){var i=this.options;return this.helper=this._createHelper(t),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),e.ui.ddmanager&&(e.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(!0),this.offsetParent=this.helper.offsetParent(),this.hasFixedAncestor=this.helper.parents().filter(function(){return"fixed"===e(this).css("position")}).length>0,this.positionAbs=this.element.offset(),this._refreshOffsets(t),this.originalPosition=this.position=this._generatePosition(t,!1),this.originalPageX=t.pageX,this.originalPageY=t.pageY,i.cursorAt&&this._adjustOffsetFromHelper(i.cursorAt),this._setContainment(),this._trigger("start",t)===!1?(this._clear(),!1):(this._cacheHelperProportions(),e.ui.ddmanager&&!i.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this._normalizeRightBottom(),this._mouseDrag(t,!0),e.ui.ddmanager&&e.ui.ddmanager.dragStart(this,t),!0)},_refreshOffsets:function(e){this.offset={top:this.positionAbs.top-this.margins.top,left:this.positionAbs.left-this.margins.left,scroll:!1,parent:this._getParentOffset(),relative:this._getRelativeOffset()},this.offset.click={left:e.pageX-this.offset.left,top:e.pageY-this.offset.top}},_mouseDrag:function(t,i){if(this.hasFixedAncestor&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(t,!0),this.positionAbs=this._convertPositionTo("absolute"),!i){var s=this._uiHash();if(this._trigger("drag",t,s)===!1)return this._mouseUp({}),!1;this.position=s.position}return this.helper[0].style.left=this.position.left+"px",this.helper[0].style.top=this.position.top+"px",e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),!1},_mouseStop:function(t){var i=this,s=!1;return e.ui.ddmanager&&!this.options.dropBehaviour&&(s=e.ui.ddmanager.drop(this,t)),this.dropped&&(s=this.dropped,this.dropped=!1),"invalid"===this.options.revert&&!s||"valid"===this.options.revert&&s||this.options.revert===!0||e.isFunction(this.options.revert)&&this.options.revert.call(this.element,s)?e(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){i._trigger("stop",t)!==!1&&i._clear()}):this._trigger("stop",t)!==!1&&this._clear(),!1},_mouseUp:function(t){return this._unblockFrames(),e.ui.ddmanager&&e.ui.ddmanager.dragStop(this,t),this.handleElement.is(t.target)&&this.element.focus(),e.ui.mouse.prototype._mouseUp.call(this,t)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(t){return this.options.handle?!!e(t.target).closest(this.element.find(this.options.handle)).length:!0},_setHandleClassName:function(){this.handleElement=this.options.handle?this.element.find(this.options.handle):this.element,this.handleElement.addClass("ui-draggable-handle")},_removeHandleClassName:function(){this.handleElement.removeClass("ui-draggable-handle")},_createHelper:function(t){var i=this.options,s=e.isFunction(i.helper),n=s?e(i.helper.apply(this.element[0],[t])):"clone"===i.helper?this.element.clone().removeAttr("id"):this.element;return n.parents("body").length||n.appendTo("parent"===i.appendTo?this.element[0].parentNode:i.appendTo),s&&n[0]===this.element[0]&&this._setPositionRelative(),n[0]===this.element[0]||/(fixed|absolute)/.test(n.css("position"))||n.css("position","absolute"),n},_setPositionRelative:function(){/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative")},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_isRootNode:function(e){return/(html|body)/i.test(e.tagName)||e===this.document[0]},_getParentOffset:function(){var t=this.offsetParent.offset(),i=this.document[0];return"absolute"===this.cssPosition&&this.scrollParent[0]!==i&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),this._isRootNode(this.offsetParent[0])&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"!==this.cssPosition)return{top:0,left:0};var e=this.element.position(),t=this._isRootNode(this.scrollParent[0]);return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+(t?0:this.scrollParent.scrollTop()),left:e.left-(parseInt(this.helper.css("left"),10)||0)+(t?0:this.scrollParent.scrollLeft())}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t,i,s,n=this.options,a=this.document[0];return this.relativeContainer=null,n.containment?"window"===n.containment?(this.containment=[e(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,e(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,e(window).scrollLeft()+e(window).width()-this.helperProportions.width-this.margins.left,e(window).scrollTop()+(e(window).height()||a.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top],void 0):"document"===n.containment?(this.containment=[0,0,e(a).width()-this.helperProportions.width-this.margins.left,(e(a).height()||a.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top],void 0):n.containment.constructor===Array?(this.containment=n.containment,void 0):("parent"===n.containment&&(n.containment=this.helper[0].parentNode),i=e(n.containment),s=i[0],s&&(t=/(scroll|auto)/.test(i.css("overflow")),this.containment=[(parseInt(i.css("borderLeftWidth"),10)||0)+(parseInt(i.css("paddingLeft"),10)||0),(parseInt(i.css("borderTopWidth"),10)||0)+(parseInt(i.css("paddingTop"),10)||0),(t?Math.max(s.scrollWidth,s.offsetWidth):s.offsetWidth)-(parseInt(i.css("borderRightWidth"),10)||0)-(parseInt(i.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(t?Math.max(s.scrollHeight,s.offsetHeight):s.offsetHeight)-(parseInt(i.css("borderBottomWidth"),10)||0)-(parseInt(i.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relativeContainer=i),void 0):(this.containment=null,void 0)
},_convertPositionTo:function(e,t){t||(t=this.position);var i="absolute"===e?1:-1,s=this._isRootNode(this.scrollParent[0]);return{top:t.top+this.offset.relative.top*i+this.offset.parent.top*i-("fixed"===this.cssPosition?-this.offset.scroll.top:s?0:this.offset.scroll.top)*i,left:t.left+this.offset.relative.left*i+this.offset.parent.left*i-("fixed"===this.cssPosition?-this.offset.scroll.left:s?0:this.offset.scroll.left)*i}},_generatePosition:function(e,t){var i,s,n,a,o=this.options,r=this._isRootNode(this.scrollParent[0]),h=e.pageX,l=e.pageY;return r&&this.offset.scroll||(this.offset.scroll={top:this.scrollParent.scrollTop(),left:this.scrollParent.scrollLeft()}),t&&(this.containment&&(this.relativeContainer?(s=this.relativeContainer.offset(),i=[this.containment[0]+s.left,this.containment[1]+s.top,this.containment[2]+s.left,this.containment[3]+s.top]):i=this.containment,e.pageX-this.offset.click.left<i[0]&&(h=i[0]+this.offset.click.left),e.pageY-this.offset.click.top<i[1]&&(l=i[1]+this.offset.click.top),e.pageX-this.offset.click.left>i[2]&&(h=i[2]+this.offset.click.left),e.pageY-this.offset.click.top>i[3]&&(l=i[3]+this.offset.click.top)),o.grid&&(n=o.grid[1]?this.originalPageY+Math.round((l-this.originalPageY)/o.grid[1])*o.grid[1]:this.originalPageY,l=i?n-this.offset.click.top>=i[1]||n-this.offset.click.top>i[3]?n:n-this.offset.click.top>=i[1]?n-o.grid[1]:n+o.grid[1]:n,a=o.grid[0]?this.originalPageX+Math.round((h-this.originalPageX)/o.grid[0])*o.grid[0]:this.originalPageX,h=i?a-this.offset.click.left>=i[0]||a-this.offset.click.left>i[2]?a:a-this.offset.click.left>=i[0]?a-o.grid[0]:a+o.grid[0]:a),"y"===o.axis&&(h=this.originalPageX),"x"===o.axis&&(l=this.originalPageY)),{top:l-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.offset.scroll.top:r?0:this.offset.scroll.top),left:h-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.offset.scroll.left:r?0:this.offset.scroll.left)}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1,this.destroyOnClear&&this.destroy()},_normalizeRightBottom:function(){"y"!==this.options.axis&&"auto"!==this.helper.css("right")&&(this.helper.width(this.helper.width()),this.helper.css("right","auto")),"x"!==this.options.axis&&"auto"!==this.helper.css("bottom")&&(this.helper.height(this.helper.height()),this.helper.css("bottom","auto"))},_trigger:function(t,i,s){return s=s||this._uiHash(),e.ui.plugin.call(this,t,[i,s,this],!0),/^(drag|start|stop)/.test(t)&&(this.positionAbs=this._convertPositionTo("absolute"),s.offset=this.positionAbs),e.Widget.prototype._trigger.call(this,t,i,s)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),e.ui.plugin.add("draggable","connectToSortable",{start:function(t,i,s){var n=e.extend({},i,{item:s.element});s.sortables=[],e(s.options.connectToSortable).each(function(){var i=e(this).sortable("instance");i&&!i.options.disabled&&(s.sortables.push(i),i.refreshPositions(),i._trigger("activate",t,n))})},stop:function(t,i,s){var n=e.extend({},i,{item:s.element});s.cancelHelperRemoval=!1,e.each(s.sortables,function(){var e=this;e.isOver?(e.isOver=0,s.cancelHelperRemoval=!0,e.cancelHelperRemoval=!1,e._storedCSS={position:e.placeholder.css("position"),top:e.placeholder.css("top"),left:e.placeholder.css("left")},e._mouseStop(t),e.options.helper=e.options._helper):(e.cancelHelperRemoval=!0,e._trigger("deactivate",t,n))})},drag:function(t,i,s){e.each(s.sortables,function(){var n=!1,a=this;a.positionAbs=s.positionAbs,a.helperProportions=s.helperProportions,a.offset.click=s.offset.click,a._intersectsWith(a.containerCache)&&(n=!0,e.each(s.sortables,function(){return this.positionAbs=s.positionAbs,this.helperProportions=s.helperProportions,this.offset.click=s.offset.click,this!==a&&this._intersectsWith(this.containerCache)&&e.contains(a.element[0],this.element[0])&&(n=!1),n})),n?(a.isOver||(a.isOver=1,a.currentItem=i.helper.appendTo(a.element).data("ui-sortable-item",!0),a.options._helper=a.options.helper,a.options.helper=function(){return i.helper[0]},t.target=a.currentItem[0],a._mouseCapture(t,!0),a._mouseStart(t,!0,!0),a.offset.click.top=s.offset.click.top,a.offset.click.left=s.offset.click.left,a.offset.parent.left-=s.offset.parent.left-a.offset.parent.left,a.offset.parent.top-=s.offset.parent.top-a.offset.parent.top,s._trigger("toSortable",t),s.dropped=a.element,e.each(s.sortables,function(){this.refreshPositions()}),s.currentItem=s.element,a.fromOutside=s),a.currentItem&&(a._mouseDrag(t),i.position=a.position)):a.isOver&&(a.isOver=0,a.cancelHelperRemoval=!0,a.options._revert=a.options.revert,a.options.revert=!1,a._trigger("out",t,a._uiHash(a)),a._mouseStop(t,!0),a.options.revert=a.options._revert,a.options.helper=a.options._helper,a.placeholder&&a.placeholder.remove(),s._refreshOffsets(t),i.position=s._generatePosition(t,!0),s._trigger("fromSortable",t),s.dropped=!1,e.each(s.sortables,function(){this.refreshPositions()}))})}}),e.ui.plugin.add("draggable","cursor",{start:function(t,i,s){var n=e("body"),a=s.options;n.css("cursor")&&(a._cursor=n.css("cursor")),n.css("cursor",a.cursor)},stop:function(t,i,s){var n=s.options;n._cursor&&e("body").css("cursor",n._cursor)}}),e.ui.plugin.add("draggable","opacity",{start:function(t,i,s){var n=e(i.helper),a=s.options;n.css("opacity")&&(a._opacity=n.css("opacity")),n.css("opacity",a.opacity)},stop:function(t,i,s){var n=s.options;n._opacity&&e(i.helper).css("opacity",n._opacity)}}),e.ui.plugin.add("draggable","scroll",{start:function(e,t,i){i.scrollParentNotHidden||(i.scrollParentNotHidden=i.helper.scrollParent(!1)),i.scrollParentNotHidden[0]!==i.document[0]&&"HTML"!==i.scrollParentNotHidden[0].tagName&&(i.overflowOffset=i.scrollParentNotHidden.offset())},drag:function(t,i,s){var n=s.options,a=!1,o=s.scrollParentNotHidden[0],r=s.document[0];o!==r&&"HTML"!==o.tagName?(n.axis&&"x"===n.axis||(s.overflowOffset.top+o.offsetHeight-t.pageY<n.scrollSensitivity?o.scrollTop=a=o.scrollTop+n.scrollSpeed:t.pageY-s.overflowOffset.top<n.scrollSensitivity&&(o.scrollTop=a=o.scrollTop-n.scrollSpeed)),n.axis&&"y"===n.axis||(s.overflowOffset.left+o.offsetWidth-t.pageX<n.scrollSensitivity?o.scrollLeft=a=o.scrollLeft+n.scrollSpeed:t.pageX-s.overflowOffset.left<n.scrollSensitivity&&(o.scrollLeft=a=o.scrollLeft-n.scrollSpeed))):(n.axis&&"x"===n.axis||(t.pageY-e(r).scrollTop()<n.scrollSensitivity?a=e(r).scrollTop(e(r).scrollTop()-n.scrollSpeed):e(window).height()-(t.pageY-e(r).scrollTop())<n.scrollSensitivity&&(a=e(r).scrollTop(e(r).scrollTop()+n.scrollSpeed))),n.axis&&"y"===n.axis||(t.pageX-e(r).scrollLeft()<n.scrollSensitivity?a=e(r).scrollLeft(e(r).scrollLeft()-n.scrollSpeed):e(window).width()-(t.pageX-e(r).scrollLeft())<n.scrollSensitivity&&(a=e(r).scrollLeft(e(r).scrollLeft()+n.scrollSpeed)))),a!==!1&&e.ui.ddmanager&&!n.dropBehaviour&&e.ui.ddmanager.prepareOffsets(s,t)}}),e.ui.plugin.add("draggable","snap",{start:function(t,i,s){var n=s.options;s.snapElements=[],e(n.snap.constructor!==String?n.snap.items||":data(ui-draggable)":n.snap).each(function(){var t=e(this),i=t.offset();this!==s.element[0]&&s.snapElements.push({item:this,width:t.outerWidth(),height:t.outerHeight(),top:i.top,left:i.left})})},drag:function(t,i,s){var n,a,o,r,h,l,u,d,c,p,f=s.options,m=f.snapTolerance,g=i.offset.left,v=g+s.helperProportions.width,y=i.offset.top,b=y+s.helperProportions.height;for(c=s.snapElements.length-1;c>=0;c--)h=s.snapElements[c].left-s.margins.left,l=h+s.snapElements[c].width,u=s.snapElements[c].top-s.margins.top,d=u+s.snapElements[c].height,h-m>v||g>l+m||u-m>b||y>d+m||!e.contains(s.snapElements[c].item.ownerDocument,s.snapElements[c].item)?(s.snapElements[c].snapping&&s.options.snap.release&&s.options.snap.release.call(s.element,t,e.extend(s._uiHash(),{snapItem:s.snapElements[c].item})),s.snapElements[c].snapping=!1):("inner"!==f.snapMode&&(n=m>=Math.abs(u-b),a=m>=Math.abs(d-y),o=m>=Math.abs(h-v),r=m>=Math.abs(l-g),n&&(i.position.top=s._convertPositionTo("relative",{top:u-s.helperProportions.height,left:0}).top),a&&(i.position.top=s._convertPositionTo("relative",{top:d,left:0}).top),o&&(i.position.left=s._convertPositionTo("relative",{top:0,left:h-s.helperProportions.width}).left),r&&(i.position.left=s._convertPositionTo("relative",{top:0,left:l}).left)),p=n||a||o||r,"outer"!==f.snapMode&&(n=m>=Math.abs(u-y),a=m>=Math.abs(d-b),o=m>=Math.abs(h-g),r=m>=Math.abs(l-v),n&&(i.position.top=s._convertPositionTo("relative",{top:u,left:0}).top),a&&(i.position.top=s._convertPositionTo("relative",{top:d-s.helperProportions.height,left:0}).top),o&&(i.position.left=s._convertPositionTo("relative",{top:0,left:h}).left),r&&(i.position.left=s._convertPositionTo("relative",{top:0,left:l-s.helperProportions.width}).left)),!s.snapElements[c].snapping&&(n||a||o||r||p)&&s.options.snap.snap&&s.options.snap.snap.call(s.element,t,e.extend(s._uiHash(),{snapItem:s.snapElements[c].item})),s.snapElements[c].snapping=n||a||o||r||p)}}),e.ui.plugin.add("draggable","stack",{start:function(t,i,s){var n,a=s.options,o=e.makeArray(e(a.stack)).sort(function(t,i){return(parseInt(e(t).css("zIndex"),10)||0)-(parseInt(e(i).css("zIndex"),10)||0)});o.length&&(n=parseInt(e(o[0]).css("zIndex"),10)||0,e(o).each(function(t){e(this).css("zIndex",n+t)}),this.css("zIndex",n+o.length))}}),e.ui.plugin.add("draggable","zIndex",{start:function(t,i,s){var n=e(i.helper),a=s.options;n.css("zIndex")&&(a._zIndex=n.css("zIndex")),n.css("zIndex",a.zIndex)},stop:function(t,i,s){var n=s.options;n._zIndex&&e(i.helper).css("zIndex",n._zIndex)}}),e.ui.draggable,e.widget("ui.resizable",e.ui.mouse,{version:"1.11.2",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_num:function(e){return parseInt(e,10)||0},_isNumber:function(e){return!isNaN(parseInt(e,10))},_hasScroll:function(t,i){if("hidden"===e(t).css("overflow"))return!1;var s=i&&"left"===i?"scrollLeft":"scrollTop",n=!1;return t[s]>0?!0:(t[s]=1,n=t[s]>0,t[s]=0,n)},_create:function(){var t,i,s,n,a,o=this,r=this.options;if(this.element.addClass("ui-resizable"),e.extend(this,{_aspectRatio:!!r.aspectRatio,aspectRatio:r.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:r.helper||r.ghost||r.animate?r.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/canvas|textarea|input|select|button|img/i)&&(this.element.wrap(e("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("ui-resizable",this.element.resizable("instance")),this.elementIsWrapper=!0,this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")}),this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0}),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css({margin:this.originalElement.css("margin")}),this._proportionallyResize()),this.handles=r.handles||(e(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this.handles.constructor===String)for("all"===this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw"),t=this.handles.split(","),this.handles={},i=0;t.length>i;i++)s=e.trim(t[i]),a="ui-resizable-"+s,n=e("<div class='ui-resizable-handle "+a+"'></div>"),n.css({zIndex:r.zIndex}),"se"===s&&n.addClass("ui-icon ui-icon-gripsmall-diagonal-se"),this.handles[s]=".ui-resizable-"+s,this.element.append(n);this._renderAxis=function(t){var i,s,n,a;t=t||this.element;for(i in this.handles)this.handles[i].constructor===String&&(this.handles[i]=this.element.children(this.handles[i]).first().show()),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/textarea|input|select|button/i)&&(s=e(this.handles[i],this.element),a=/sw|ne|nw|se|n|s/.test(i)?s.outerHeight():s.outerWidth(),n=["padding",/ne|nw|n/.test(i)?"Top":/se|sw|s/.test(i)?"Bottom":/^e$/.test(i)?"Right":"Left"].join(""),t.css(n,a),this._proportionallyResize()),e(this.handles[i]).length},this._renderAxis(this.element),this._handles=e(".ui-resizable-handle",this.element).disableSelection(),this._handles.mouseover(function(){o.resizing||(this.className&&(n=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),o.axis=n&&n[1]?n[1]:"se")}),r.autoHide&&(this._handles.hide(),e(this.element).addClass("ui-resizable-autohide").mouseenter(function(){r.disabled||(e(this).removeClass("ui-resizable-autohide"),o._handles.show())}).mouseleave(function(){r.disabled||o.resizing||(e(this).addClass("ui-resizable-autohide"),o._handles.hide())})),this._mouseInit()},_destroy:function(){this._mouseDestroy();var t,i=function(t){e(t).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").removeData("ui-resizable").unbind(".resizable").find(".ui-resizable-handle").remove()};return this.elementIsWrapper&&(i(this.element),t=this.element,this.originalElement.css({position:t.css("position"),width:t.outerWidth(),height:t.outerHeight(),top:t.css("top"),left:t.css("left")}).insertAfter(t),t.remove()),this.originalElement.css("resize",this.originalResizeStyle),i(this.originalElement),this},_mouseCapture:function(t){var i,s,n=!1;for(i in this.handles)s=e(this.handles[i])[0],(s===t.target||e.contains(s,t.target))&&(n=!0);return!this.options.disabled&&n},_mouseStart:function(t){var i,s,n,a=this.options,o=this.element;return this.resizing=!0,this._renderProxy(),i=this._num(this.helper.css("left")),s=this._num(this.helper.css("top")),a.containment&&(i+=e(a.containment).scrollLeft()||0,s+=e(a.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:i,top:s},this.size=this._helper?{width:this.helper.width(),height:this.helper.height()}:{width:o.width(),height:o.height()},this.originalSize=this._helper?{width:o.outerWidth(),height:o.outerHeight()}:{width:o.width(),height:o.height()},this.sizeDiff={width:o.outerWidth()-o.width(),height:o.outerHeight()-o.height()},this.originalPosition={left:i,top:s},this.originalMousePosition={left:t.pageX,top:t.pageY},this.aspectRatio="number"==typeof a.aspectRatio?a.aspectRatio:this.originalSize.width/this.originalSize.height||1,n=e(".ui-resizable-"+this.axis).css("cursor"),e("body").css("cursor","auto"===n?this.axis+"-resize":n),o.addClass("ui-resizable-resizing"),this._propagate("start",t),!0},_mouseDrag:function(t){var i,s,n=this.originalMousePosition,a=this.axis,o=t.pageX-n.left||0,r=t.pageY-n.top||0,h=this._change[a];return this._updatePrevProperties(),h?(i=h.apply(this,[t,o,r]),this._updateVirtualBoundaries(t.shiftKey),(this._aspectRatio||t.shiftKey)&&(i=this._updateRatio(i,t)),i=this._respectSize(i,t),this._updateCache(i),this._propagate("resize",t),s=this._applyChanges(),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),e.isEmptyObject(s)||(this._updatePrevProperties(),this._trigger("resize",t,this.ui()),this._applyChanges()),!1):!1},_mouseStop:function(t){this.resizing=!1;var i,s,n,a,o,r,h,l=this.options,u=this;return this._helper&&(i=this._proportionallyResizeElements,s=i.length&&/textarea/i.test(i[0].nodeName),n=s&&this._hasScroll(i[0],"left")?0:u.sizeDiff.height,a=s?0:u.sizeDiff.width,o={width:u.helper.width()-a,height:u.helper.height()-n},r=parseInt(u.element.css("left"),10)+(u.position.left-u.originalPosition.left)||null,h=parseInt(u.element.css("top"),10)+(u.position.top-u.originalPosition.top)||null,l.animate||this.element.css(e.extend(o,{top:h,left:r})),u.helper.height(u.size.height),u.helper.width(u.size.width),this._helper&&!l.animate&&this._proportionallyResize()),e("body").css("cursor","auto"),this.element.removeClass("ui-resizable-resizing"),this._propagate("stop",t),this._helper&&this.helper.remove(),!1},_updatePrevProperties:function(){this.prevPosition={top:this.position.top,left:this.position.left},this.prevSize={width:this.size.width,height:this.size.height}},_applyChanges:function(){var e={};return this.position.top!==this.prevPosition.top&&(e.top=this.position.top+"px"),this.position.left!==this.prevPosition.left&&(e.left=this.position.left+"px"),this.size.width!==this.prevSize.width&&(e.width=this.size.width+"px"),this.size.height!==this.prevSize.height&&(e.height=this.size.height+"px"),this.helper.css(e),e},_updateVirtualBoundaries:function(e){var t,i,s,n,a,o=this.options;a={minWidth:this._isNumber(o.minWidth)?o.minWidth:0,maxWidth:this._isNumber(o.maxWidth)?o.maxWidth:1/0,minHeight:this._isNumber(o.minHeight)?o.minHeight:0,maxHeight:this._isNumber(o.maxHeight)?o.maxHeight:1/0},(this._aspectRatio||e)&&(t=a.minHeight*this.aspectRatio,s=a.minWidth/this.aspectRatio,i=a.maxHeight*this.aspectRatio,n=a.maxWidth/this.aspectRatio,t>a.minWidth&&(a.minWidth=t),s>a.minHeight&&(a.minHeight=s),a.maxWidth>i&&(a.maxWidth=i),a.maxHeight>n&&(a.maxHeight=n)),this._vBoundaries=a},_updateCache:function(e){this.offset=this.helper.offset(),this._isNumber(e.left)&&(this.position.left=e.left),this._isNumber(e.top)&&(this.position.top=e.top),this._isNumber(e.height)&&(this.size.height=e.height),this._isNumber(e.width)&&(this.size.width=e.width)},_updateRatio:function(e){var t=this.position,i=this.size,s=this.axis;return this._isNumber(e.height)?e.width=e.height*this.aspectRatio:this._isNumber(e.width)&&(e.height=e.width/this.aspectRatio),"sw"===s&&(e.left=t.left+(i.width-e.width),e.top=null),"nw"===s&&(e.top=t.top+(i.height-e.height),e.left=t.left+(i.width-e.width)),e},_respectSize:function(e){var t=this._vBoundaries,i=this.axis,s=this._isNumber(e.width)&&t.maxWidth&&t.maxWidth<e.width,n=this._isNumber(e.height)&&t.maxHeight&&t.maxHeight<e.height,a=this._isNumber(e.width)&&t.minWidth&&t.minWidth>e.width,o=this._isNumber(e.height)&&t.minHeight&&t.minHeight>e.height,r=this.originalPosition.left+this.originalSize.width,h=this.position.top+this.size.height,l=/sw|nw|w/.test(i),u=/nw|ne|n/.test(i);return a&&(e.width=t.minWidth),o&&(e.height=t.minHeight),s&&(e.width=t.maxWidth),n&&(e.height=t.maxHeight),a&&l&&(e.left=r-t.minWidth),s&&l&&(e.left=r-t.maxWidth),o&&u&&(e.top=h-t.minHeight),n&&u&&(e.top=h-t.maxHeight),e.width||e.height||e.left||!e.top?e.width||e.height||e.top||!e.left||(e.left=null):e.top=null,e},_getPaddingPlusBorderDimensions:function(e){for(var t=0,i=[],s=[e.css("borderTopWidth"),e.css("borderRightWidth"),e.css("borderBottomWidth"),e.css("borderLeftWidth")],n=[e.css("paddingTop"),e.css("paddingRight"),e.css("paddingBottom"),e.css("paddingLeft")];4>t;t++)i[t]=parseInt(s[t],10)||0,i[t]+=parseInt(n[t],10)||0;return{height:i[0]+i[2],width:i[1]+i[3]}},_proportionallyResize:function(){if(this._proportionallyResizeElements.length)for(var e,t=0,i=this.helper||this.element;this._proportionallyResizeElements.length>t;t++)e=this._proportionallyResizeElements[t],this.outerDimensions||(this.outerDimensions=this._getPaddingPlusBorderDimensions(e)),e.css({height:i.height()-this.outerDimensions.height||0,width:i.width()-this.outerDimensions.width||0})},_renderProxy:function(){var t=this.element,i=this.options;this.elementOffset=t.offset(),this._helper?(this.helper=this.helper||e("<div style='overflow:hidden;'></div>"),this.helper.addClass(this._helper).css({width:this.element.outerWidth()-1,height:this.element.outerHeight()-1,position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++i.zIndex}),this.helper.appendTo("body").disableSelection()):this.helper=this.element},_change:{e:function(e,t){return{width:this.originalSize.width+t}},w:function(e,t){var i=this.originalSize,s=this.originalPosition;return{left:s.left+t,width:i.width-t}},n:function(e,t,i){var s=this.originalSize,n=this.originalPosition;return{top:n.top+i,height:s.height-i}},s:function(e,t,i){return{height:this.originalSize.height+i}},se:function(t,i,s){return e.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[t,i,s]))},sw:function(t,i,s){return e.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[t,i,s]))},ne:function(t,i,s){return e.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[t,i,s]))},nw:function(t,i,s){return e.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[t,i,s]))}},_propagate:function(t,i){e.ui.plugin.call(this,t,[i,this.ui()]),"resize"!==t&&this._trigger(t,i,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),e.ui.plugin.add("resizable","animate",{stop:function(t){var i=e(this).resizable("instance"),s=i.options,n=i._proportionallyResizeElements,a=n.length&&/textarea/i.test(n[0].nodeName),o=a&&i._hasScroll(n[0],"left")?0:i.sizeDiff.height,r=a?0:i.sizeDiff.width,h={width:i.size.width-r,height:i.size.height-o},l=parseInt(i.element.css("left"),10)+(i.position.left-i.originalPosition.left)||null,u=parseInt(i.element.css("top"),10)+(i.position.top-i.originalPosition.top)||null;i.element.animate(e.extend(h,u&&l?{top:u,left:l}:{}),{duration:s.animateDuration,easing:s.animateEasing,step:function(){var s={width:parseInt(i.element.css("width"),10),height:parseInt(i.element.css("height"),10),top:parseInt(i.element.css("top"),10),left:parseInt(i.element.css("left"),10)};n&&n.length&&e(n[0]).css({width:s.width,height:s.height}),i._updateCache(s),i._propagate("resize",t)}})}}),e.ui.plugin.add("resizable","containment",{start:function(){var t,i,s,n,a,o,r,h=e(this).resizable("instance"),l=h.options,u=h.element,d=l.containment,c=d instanceof e?d.get(0):/parent/.test(d)?u.parent().get(0):d;c&&(h.containerElement=e(c),/document/.test(d)||d===document?(h.containerOffset={left:0,top:0},h.containerPosition={left:0,top:0},h.parentData={element:e(document),left:0,top:0,width:e(document).width(),height:e(document).height()||document.body.parentNode.scrollHeight}):(t=e(c),i=[],e(["Top","Right","Left","Bottom"]).each(function(e,s){i[e]=h._num(t.css("padding"+s))}),h.containerOffset=t.offset(),h.containerPosition=t.position(),h.containerSize={height:t.innerHeight()-i[3],width:t.innerWidth()-i[1]},s=h.containerOffset,n=h.containerSize.height,a=h.containerSize.width,o=h._hasScroll(c,"left")?c.scrollWidth:a,r=h._hasScroll(c)?c.scrollHeight:n,h.parentData={element:c,left:s.left,top:s.top,width:o,height:r}))},resize:function(t){var i,s,n,a,o=e(this).resizable("instance"),r=o.options,h=o.containerOffset,l=o.position,u=o._aspectRatio||t.shiftKey,d={top:0,left:0},c=o.containerElement,p=!0;c[0]!==document&&/static/.test(c.css("position"))&&(d=h),l.left<(o._helper?h.left:0)&&(o.size.width=o.size.width+(o._helper?o.position.left-h.left:o.position.left-d.left),u&&(o.size.height=o.size.width/o.aspectRatio,p=!1),o.position.left=r.helper?h.left:0),l.top<(o._helper?h.top:0)&&(o.size.height=o.size.height+(o._helper?o.position.top-h.top:o.position.top),u&&(o.size.width=o.size.height*o.aspectRatio,p=!1),o.position.top=o._helper?h.top:0),n=o.containerElement.get(0)===o.element.parent().get(0),a=/relative|absolute/.test(o.containerElement.css("position")),n&&a?(o.offset.left=o.parentData.left+o.position.left,o.offset.top=o.parentData.top+o.position.top):(o.offset.left=o.element.offset().left,o.offset.top=o.element.offset().top),i=Math.abs(o.sizeDiff.width+(o._helper?o.offset.left-d.left:o.offset.left-h.left)),s=Math.abs(o.sizeDiff.height+(o._helper?o.offset.top-d.top:o.offset.top-h.top)),i+o.size.width>=o.parentData.width&&(o.size.width=o.parentData.width-i,u&&(o.size.height=o.size.width/o.aspectRatio,p=!1)),s+o.size.height>=o.parentData.height&&(o.size.height=o.parentData.height-s,u&&(o.size.width=o.size.height*o.aspectRatio,p=!1)),p||(o.position.left=o.prevPosition.left,o.position.top=o.prevPosition.top,o.size.width=o.prevSize.width,o.size.height=o.prevSize.height)},stop:function(){var t=e(this).resizable("instance"),i=t.options,s=t.containerOffset,n=t.containerPosition,a=t.containerElement,o=e(t.helper),r=o.offset(),h=o.outerWidth()-t.sizeDiff.width,l=o.outerHeight()-t.sizeDiff.height;t._helper&&!i.animate&&/relative/.test(a.css("position"))&&e(this).css({left:r.left-n.left-s.left,width:h,height:l}),t._helper&&!i.animate&&/static/.test(a.css("position"))&&e(this).css({left:r.left-n.left-s.left,width:h,height:l})}}),e.ui.plugin.add("resizable","alsoResize",{start:function(){var t=e(this).resizable("instance"),i=t.options,s=function(t){e(t).each(function(){var t=e(this);t.data("ui-resizable-alsoresize",{width:parseInt(t.width(),10),height:parseInt(t.height(),10),left:parseInt(t.css("left"),10),top:parseInt(t.css("top"),10)})})};"object"!=typeof i.alsoResize||i.alsoResize.parentNode?s(i.alsoResize):i.alsoResize.length?(i.alsoResize=i.alsoResize[0],s(i.alsoResize)):e.each(i.alsoResize,function(e){s(e)})},resize:function(t,i){var s=e(this).resizable("instance"),n=s.options,a=s.originalSize,o=s.originalPosition,r={height:s.size.height-a.height||0,width:s.size.width-a.width||0,top:s.position.top-o.top||0,left:s.position.left-o.left||0},h=function(t,s){e(t).each(function(){var t=e(this),n=e(this).data("ui-resizable-alsoresize"),a={},o=s&&s.length?s:t.parents(i.originalElement[0]).length?["width","height"]:["width","height","top","left"];e.each(o,function(e,t){var i=(n[t]||0)+(r[t]||0);i&&i>=0&&(a[t]=i||null)}),t.css(a)})};"object"!=typeof n.alsoResize||n.alsoResize.nodeType?h(n.alsoResize):e.each(n.alsoResize,function(e,t){h(e,t)})},stop:function(){e(this).removeData("resizable-alsoresize")}}),e.ui.plugin.add("resizable","ghost",{start:function(){var t=e(this).resizable("instance"),i=t.options,s=t.size;t.ghost=t.originalElement.clone(),t.ghost.css({opacity:.25,display:"block",position:"relative",height:s.height,width:s.width,margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass("string"==typeof i.ghost?i.ghost:""),t.ghost.appendTo(t.helper)},resize:function(){var t=e(this).resizable("instance");t.ghost&&t.ghost.css({position:"relative",height:t.size.height,width:t.size.width})},stop:function(){var t=e(this).resizable("instance");t.ghost&&t.helper&&t.helper.get(0).removeChild(t.ghost.get(0))}}),e.ui.plugin.add("resizable","grid",{resize:function(){var t,i=e(this).resizable("instance"),s=i.options,n=i.size,a=i.originalSize,o=i.originalPosition,r=i.axis,h="number"==typeof s.grid?[s.grid,s.grid]:s.grid,l=h[0]||1,u=h[1]||1,d=Math.round((n.width-a.width)/l)*l,c=Math.round((n.height-a.height)/u)*u,p=a.width+d,f=a.height+c,m=s.maxWidth&&p>s.maxWidth,g=s.maxHeight&&f>s.maxHeight,v=s.minWidth&&s.minWidth>p,y=s.minHeight&&s.minHeight>f;s.grid=h,v&&(p+=l),y&&(f+=u),m&&(p-=l),g&&(f-=u),/^(se|s|e)$/.test(r)?(i.size.width=p,i.size.height=f):/^(ne)$/.test(r)?(i.size.width=p,i.size.height=f,i.position.top=o.top-c):/^(sw)$/.test(r)?(i.size.width=p,i.size.height=f,i.position.left=o.left-d):((0>=f-u||0>=p-l)&&(t=i._getPaddingPlusBorderDimensions(this)),f-u>0?(i.size.height=f,i.position.top=o.top-c):(f=u-t.height,i.size.height=f,i.position.top=o.top+a.height-f),p-l>0?(i.size.width=p,i.position.left=o.left-d):(p=u-t.height,i.size.width=p,i.position.left=o.left+a.width-p))}}),e.ui.resizable,e.widget("ui.dialog",{version:"1.11.2",options:{appendTo:"body",autoOpen:!0,buttons:[],closeOnEscape:!0,closeText:"Close",dialogClass:"",draggable:!0,hide:null,height:"auto",maxHeight:null,maxWidth:null,minHeight:150,minWidth:150,modal:!1,position:{my:"center",at:"center",of:window,collision:"fit",using:function(t){var i=e(this).css(t).offset().top;0>i&&e(this).css("top",t.top-i)}},resizable:!0,show:null,title:null,width:300,beforeClose:null,close:null,drag:null,dragStart:null,dragStop:null,focus:null,open:null,resize:null,resizeStart:null,resizeStop:null},sizeRelatedOptions:{buttons:!0,height:!0,maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0,width:!0},resizableRelatedOptions:{maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0},_create:function(){this.originalCss={display:this.element[0].style.display,width:this.element[0].style.width,minHeight:this.element[0].style.minHeight,maxHeight:this.element[0].style.maxHeight,height:this.element[0].style.height},this.originalPosition={parent:this.element.parent(),index:this.element.parent().children().index(this.element)},this.originalTitle=this.element.attr("title"),this.options.title=this.options.title||this.originalTitle,this._createWrapper(),this.element.show().removeAttr("title").addClass("ui-dialog-content ui-widget-content").appendTo(this.uiDialog),this._createTitlebar(),this._createButtonPane(),this.options.draggable&&e.fn.draggable&&this._makeDraggable(),this.options.resizable&&e.fn.resizable&&this._makeResizable(),this._isOpen=!1,this._trackFocus()},_init:function(){this.options.autoOpen&&this.open()},_appendTo:function(){var t=this.options.appendTo;return t&&(t.jquery||t.nodeType)?e(t):this.document.find(t||"body").eq(0)},_destroy:function(){var e,t=this.originalPosition;this._destroyOverlay(),this.element.removeUniqueId().removeClass("ui-dialog-content ui-widget-content").css(this.originalCss).detach(),this.uiDialog.stop(!0,!0).remove(),this.originalTitle&&this.element.attr("title",this.originalTitle),e=t.parent.children().eq(t.index),e.length&&e[0]!==this.element[0]?e.before(this.element):t.parent.append(this.element)},widget:function(){return this.uiDialog},disable:e.noop,enable:e.noop,close:function(t){var i,s=this;if(this._isOpen&&this._trigger("beforeClose",t)!==!1){if(this._isOpen=!1,this._focusedElement=null,this._destroyOverlay(),this._untrackInstance(),!this.opener.filter(":focusable").focus().length)try{i=this.document[0].activeElement,i&&"body"!==i.nodeName.toLowerCase()&&e(i).blur()}catch(n){}this._hide(this.uiDialog,this.options.hide,function(){s._trigger("close",t)})}},isOpen:function(){return this._isOpen},moveToTop:function(){this._moveToTop()},_moveToTop:function(t,i){var s=!1,n=this.uiDialog.siblings(".ui-front:visible").map(function(){return+e(this).css("z-index")}).get(),a=Math.max.apply(null,n);return a>=+this.uiDialog.css("z-index")&&(this.uiDialog.css("z-index",a+1),s=!0),s&&!i&&this._trigger("focus",t),s},open:function(){var t=this;return this._isOpen?(this._moveToTop()&&this._focusTabbable(),void 0):(this._isOpen=!0,this.opener=e(this.document[0].activeElement),this._size(),this._position(),this._createOverlay(),this._moveToTop(null,!0),this.overlay&&this.overlay.css("z-index",this.uiDialog.css("z-index")-1),this._show(this.uiDialog,this.options.show,function(){t._focusTabbable(),t._trigger("focus")}),this._makeFocusTarget(),this._trigger("open"),void 0)},_focusTabbable:function(){var e=this._focusedElement;e||(e=this.element.find("[autofocus]")),e.length||(e=this.element.find(":tabbable")),e.length||(e=this.uiDialogButtonPane.find(":tabbable")),e.length||(e=this.uiDialogTitlebarClose.filter(":tabbable")),e.length||(e=this.uiDialog),e.eq(0).focus()},_keepFocus:function(t){function i(){var t=this.document[0].activeElement,i=this.uiDialog[0]===t||e.contains(this.uiDialog[0],t);i||this._focusTabbable()}t.preventDefault(),i.call(this),this._delay(i)},_createWrapper:function(){this.uiDialog=e("<div>").addClass("ui-dialog ui-widget ui-widget-content ui-corner-all ui-front "+this.options.dialogClass).hide().attr({tabIndex:-1,role:"dialog"}).appendTo(this._appendTo()),this._on(this.uiDialog,{keydown:function(t){if(this.options.closeOnEscape&&!t.isDefaultPrevented()&&t.keyCode&&t.keyCode===e.ui.keyCode.ESCAPE)return t.preventDefault(),this.close(t),void 0;
if(t.keyCode===e.ui.keyCode.TAB&&!t.isDefaultPrevented()){var i=this.uiDialog.find(":tabbable"),s=i.filter(":first"),n=i.filter(":last");t.target!==n[0]&&t.target!==this.uiDialog[0]||t.shiftKey?t.target!==s[0]&&t.target!==this.uiDialog[0]||!t.shiftKey||(this._delay(function(){n.focus()}),t.preventDefault()):(this._delay(function(){s.focus()}),t.preventDefault())}},mousedown:function(e){this._moveToTop(e)&&this._focusTabbable()}}),this.element.find("[aria-describedby]").length||this.uiDialog.attr({"aria-describedby":this.element.uniqueId().attr("id")})},_createTitlebar:function(){var t;this.uiDialogTitlebar=e("<div>").addClass("ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix").prependTo(this.uiDialog),this._on(this.uiDialogTitlebar,{mousedown:function(t){e(t.target).closest(".ui-dialog-titlebar-close")||this.uiDialog.focus()}}),this.uiDialogTitlebarClose=e("<button type='button'></button>").button({label:this.options.closeText,icons:{primary:"ui-icon-closethick"},text:!1}).addClass("ui-dialog-titlebar-close").appendTo(this.uiDialogTitlebar),this._on(this.uiDialogTitlebarClose,{click:function(e){e.preventDefault(),this.close(e)}}),t=e("<span>").uniqueId().addClass("ui-dialog-title").prependTo(this.uiDialogTitlebar),this._title(t),this.uiDialog.attr({"aria-labelledby":t.attr("id")})},_title:function(e){this.options.title||e.html("&#160;"),e.text(this.options.title)},_createButtonPane:function(){this.uiDialogButtonPane=e("<div>").addClass("ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"),this.uiButtonSet=e("<div>").addClass("ui-dialog-buttonset").appendTo(this.uiDialogButtonPane),this._createButtons()},_createButtons:function(){var t=this,i=this.options.buttons;return this.uiDialogButtonPane.remove(),this.uiButtonSet.empty(),e.isEmptyObject(i)||e.isArray(i)&&!i.length?(this.uiDialog.removeClass("ui-dialog-buttons"),void 0):(e.each(i,function(i,s){var n,a;s=e.isFunction(s)?{click:s,text:i}:s,s=e.extend({type:"button"},s),n=s.click,s.click=function(){n.apply(t.element[0],arguments)},a={icons:s.icons,text:s.showText},delete s.icons,delete s.showText,e("<button></button>",s).button(a).appendTo(t.uiButtonSet)}),this.uiDialog.addClass("ui-dialog-buttons"),this.uiDialogButtonPane.appendTo(this.uiDialog),void 0)},_makeDraggable:function(){function t(e){return{position:e.position,offset:e.offset}}var i=this,s=this.options;this.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",containment:"document",start:function(s,n){e(this).addClass("ui-dialog-dragging"),i._blockFrames(),i._trigger("dragStart",s,t(n))},drag:function(e,s){i._trigger("drag",e,t(s))},stop:function(n,a){var o=a.offset.left-i.document.scrollLeft(),r=a.offset.top-i.document.scrollTop();s.position={my:"left top",at:"left"+(o>=0?"+":"")+o+" "+"top"+(r>=0?"+":"")+r,of:i.window},e(this).removeClass("ui-dialog-dragging"),i._unblockFrames(),i._trigger("dragStop",n,t(a))}})},_makeResizable:function(){function t(e){return{originalPosition:e.originalPosition,originalSize:e.originalSize,position:e.position,size:e.size}}var i=this,s=this.options,n=s.resizable,a=this.uiDialog.css("position"),o="string"==typeof n?n:"n,e,s,w,se,sw,ne,nw";this.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:this.element,maxWidth:s.maxWidth,maxHeight:s.maxHeight,minWidth:s.minWidth,minHeight:this._minHeight(),handles:o,start:function(s,n){e(this).addClass("ui-dialog-resizing"),i._blockFrames(),i._trigger("resizeStart",s,t(n))},resize:function(e,s){i._trigger("resize",e,t(s))},stop:function(n,a){var o=i.uiDialog.offset(),r=o.left-i.document.scrollLeft(),h=o.top-i.document.scrollTop();s.height=i.uiDialog.height(),s.width=i.uiDialog.width(),s.position={my:"left top",at:"left"+(r>=0?"+":"")+r+" "+"top"+(h>=0?"+":"")+h,of:i.window},e(this).removeClass("ui-dialog-resizing"),i._unblockFrames(),i._trigger("resizeStop",n,t(a))}}).css("position",a)},_trackFocus:function(){this._on(this.widget(),{focusin:function(t){this._makeFocusTarget(),this._focusedElement=e(t.target)}})},_makeFocusTarget:function(){this._untrackInstance(),this._trackingInstances().unshift(this)},_untrackInstance:function(){var t=this._trackingInstances(),i=e.inArray(this,t);-1!==i&&t.splice(i,1)},_trackingInstances:function(){var e=this.document.data("ui-dialog-instances");return e||(e=[],this.document.data("ui-dialog-instances",e)),e},_minHeight:function(){var e=this.options;return"auto"===e.height?e.minHeight:Math.min(e.minHeight,e.height)},_position:function(){var e=this.uiDialog.is(":visible");e||this.uiDialog.show(),this.uiDialog.position(this.options.position),e||this.uiDialog.hide()},_setOptions:function(t){var i=this,s=!1,n={};e.each(t,function(e,t){i._setOption(e,t),e in i.sizeRelatedOptions&&(s=!0),e in i.resizableRelatedOptions&&(n[e]=t)}),s&&(this._size(),this._position()),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option",n)},_setOption:function(e,t){var i,s,n=this.uiDialog;"dialogClass"===e&&n.removeClass(this.options.dialogClass).addClass(t),"disabled"!==e&&(this._super(e,t),"appendTo"===e&&this.uiDialog.appendTo(this._appendTo()),"buttons"===e&&this._createButtons(),"closeText"===e&&this.uiDialogTitlebarClose.button({label:""+t}),"draggable"===e&&(i=n.is(":data(ui-draggable)"),i&&!t&&n.draggable("destroy"),!i&&t&&this._makeDraggable()),"position"===e&&this._position(),"resizable"===e&&(s=n.is(":data(ui-resizable)"),s&&!t&&n.resizable("destroy"),s&&"string"==typeof t&&n.resizable("option","handles",t),s||t===!1||this._makeResizable()),"title"===e&&this._title(this.uiDialogTitlebar.find(".ui-dialog-title")))},_size:function(){var e,t,i,s=this.options;this.element.show().css({width:"auto",minHeight:0,maxHeight:"none",height:0}),s.minWidth>s.width&&(s.width=s.minWidth),e=this.uiDialog.css({height:"auto",width:s.width}).outerHeight(),t=Math.max(0,s.minHeight-e),i="number"==typeof s.maxHeight?Math.max(0,s.maxHeight-e):"none","auto"===s.height?this.element.css({minHeight:t,maxHeight:i,height:"auto"}):this.element.height(Math.max(0,s.height-e)),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option","minHeight",this._minHeight())},_blockFrames:function(){this.iframeBlocks=this.document.find("iframe").map(function(){var t=e(this);return e("<div>").css({position:"absolute",width:t.outerWidth(),height:t.outerHeight()}).appendTo(t.parent()).offset(t.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_allowInteraction:function(t){return e(t.target).closest(".ui-dialog").length?!0:!!e(t.target).closest(".ui-datepicker").length},_createOverlay:function(){if(this.options.modal){var t=!0;this._delay(function(){t=!1}),this.document.data("ui-dialog-overlays")||this._on(this.document,{focusin:function(e){t||this._allowInteraction(e)||(e.preventDefault(),this._trackingInstances()[0]._focusTabbable())}}),this.overlay=e("<div>").addClass("ui-widget-overlay ui-front").appendTo(this._appendTo()),this._on(this.overlay,{mousedown:"_keepFocus"}),this.document.data("ui-dialog-overlays",(this.document.data("ui-dialog-overlays")||0)+1)}},_destroyOverlay:function(){if(this.options.modal&&this.overlay){var e=this.document.data("ui-dialog-overlays")-1;e?this.document.data("ui-dialog-overlays",e):this.document.unbind("focusin").removeData("ui-dialog-overlays"),this.overlay.remove(),this.overlay=null}}}),e.widget("ui.droppable",{version:"1.11.2",widgetEventPrefix:"drop",options:{accept:"*",activeClass:!1,addClasses:!0,greedy:!1,hoverClass:!1,scope:"default",tolerance:"intersect",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var t,i=this.options,s=i.accept;this.isover=!1,this.isout=!0,this.accept=e.isFunction(s)?s:function(e){return e.is(s)},this.proportions=function(){return arguments.length?(t=arguments[0],void 0):t?t:t={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight}},this._addToManager(i.scope),i.addClasses&&this.element.addClass("ui-droppable")},_addToManager:function(t){e.ui.ddmanager.droppables[t]=e.ui.ddmanager.droppables[t]||[],e.ui.ddmanager.droppables[t].push(this)},_splice:function(e){for(var t=0;e.length>t;t++)e[t]===this&&e.splice(t,1)},_destroy:function(){var t=e.ui.ddmanager.droppables[this.options.scope];this._splice(t),this.element.removeClass("ui-droppable ui-droppable-disabled")},_setOption:function(t,i){if("accept"===t)this.accept=e.isFunction(i)?i:function(e){return e.is(i)};else if("scope"===t){var s=e.ui.ddmanager.droppables[this.options.scope];this._splice(s),this._addToManager(i)}this._super(t,i)},_activate:function(t){var i=e.ui.ddmanager.current;this.options.activeClass&&this.element.addClass(this.options.activeClass),i&&this._trigger("activate",t,this.ui(i))},_deactivate:function(t){var i=e.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass),i&&this._trigger("deactivate",t,this.ui(i))},_over:function(t){var i=e.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this.options.hoverClass&&this.element.addClass(this.options.hoverClass),this._trigger("over",t,this.ui(i)))},_out:function(t){var i=e.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("out",t,this.ui(i)))},_drop:function(t,i){var s=i||e.ui.ddmanager.current,n=!1;return s&&(s.currentItem||s.element)[0]!==this.element[0]?(this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each(function(){var i=e(this).droppable("instance");return i.options.greedy&&!i.options.disabled&&i.options.scope===s.options.scope&&i.accept.call(i.element[0],s.currentItem||s.element)&&e.ui.intersect(s,e.extend(i,{offset:i.element.offset()}),i.options.tolerance,t)?(n=!0,!1):void 0}),n?!1:this.accept.call(this.element[0],s.currentItem||s.element)?(this.options.activeClass&&this.element.removeClass(this.options.activeClass),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("drop",t,this.ui(s)),this.element):!1):!1},ui:function(e){return{draggable:e.currentItem||e.element,helper:e.helper,position:e.position,offset:e.positionAbs}}}),e.ui.intersect=function(){function e(e,t,i){return e>=t&&t+i>e}return function(t,i,s,n){if(!i.offset)return!1;var a=(t.positionAbs||t.position.absolute).left+t.margins.left,o=(t.positionAbs||t.position.absolute).top+t.margins.top,r=a+t.helperProportions.width,h=o+t.helperProportions.height,l=i.offset.left,u=i.offset.top,d=l+i.proportions().width,c=u+i.proportions().height;switch(s){case"fit":return a>=l&&d>=r&&o>=u&&c>=h;case"intersect":return a+t.helperProportions.width/2>l&&d>r-t.helperProportions.width/2&&o+t.helperProportions.height/2>u&&c>h-t.helperProportions.height/2;case"pointer":return e(n.pageY,u,i.proportions().height)&&e(n.pageX,l,i.proportions().width);case"touch":return(o>=u&&c>=o||h>=u&&c>=h||u>o&&h>c)&&(a>=l&&d>=a||r>=l&&d>=r||l>a&&r>d);default:return!1}}}(),e.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(t,i){var s,n,a=e.ui.ddmanager.droppables[t.options.scope]||[],o=i?i.type:null,r=(t.currentItem||t.element).find(":data(ui-droppable)").addBack();e:for(s=0;a.length>s;s++)if(!(a[s].options.disabled||t&&!a[s].accept.call(a[s].element[0],t.currentItem||t.element))){for(n=0;r.length>n;n++)if(r[n]===a[s].element[0]){a[s].proportions().height=0;continue e}a[s].visible="none"!==a[s].element.css("display"),a[s].visible&&("mousedown"===o&&a[s]._activate.call(a[s],i),a[s].offset=a[s].element.offset(),a[s].proportions({width:a[s].element[0].offsetWidth,height:a[s].element[0].offsetHeight}))}},drop:function(t,i){var s=!1;return e.each((e.ui.ddmanager.droppables[t.options.scope]||[]).slice(),function(){this.options&&(!this.options.disabled&&this.visible&&e.ui.intersect(t,this,this.options.tolerance,i)&&(s=this._drop.call(this,i)||s),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],t.currentItem||t.element)&&(this.isout=!0,this.isover=!1,this._deactivate.call(this,i)))}),s},dragStart:function(t,i){t.element.parentsUntil("body").bind("scroll.droppable",function(){t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,i)})},drag:function(t,i){t.options.refreshPositions&&e.ui.ddmanager.prepareOffsets(t,i),e.each(e.ui.ddmanager.droppables[t.options.scope]||[],function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var s,n,a,o=e.ui.intersect(t,this,this.options.tolerance,i),r=!o&&this.isover?"isout":o&&!this.isover?"isover":null;r&&(this.options.greedy&&(n=this.options.scope,a=this.element.parents(":data(ui-droppable)").filter(function(){return e(this).droppable("instance").options.scope===n}),a.length&&(s=e(a[0]).droppable("instance"),s.greedyChild="isover"===r)),s&&"isover"===r&&(s.isover=!1,s.isout=!0,s._out.call(s,i)),this[r]=!0,this["isout"===r?"isover":"isout"]=!1,this["isover"===r?"_over":"_out"].call(this,i),s&&"isout"===r&&(s.isout=!1,s.isover=!0,s._over.call(s,i)))}})},dragStop:function(t,i){t.element.parentsUntil("body").unbind("scroll.droppable"),t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,i)}},e.ui.droppable;var y="ui-effects-",b=e;e.effects={effect:{}},function(e,t){function i(e,t,i){var s=d[t.type]||{};return null==e?i||!t.def?null:t.def:(e=s.floor?~~e:parseFloat(e),isNaN(e)?t.def:s.mod?(e+s.mod)%s.mod:0>e?0:e>s.max?s.max:e)}function s(i){var s=l(),n=s._rgba=[];return i=i.toLowerCase(),f(h,function(e,a){var o,r=a.re.exec(i),h=r&&a.parse(r),l=a.space||"rgba";return h?(o=s[l](h),s[u[l].cache]=o[u[l].cache],n=s._rgba=o._rgba,!1):t}),n.length?("0,0,0,0"===n.join()&&e.extend(n,a.transparent),s):a[i]}function n(e,t,i){return i=(i+1)%1,1>6*i?e+6*(t-e)*i:1>2*i?t:2>3*i?e+6*(t-e)*(2/3-i):e}var a,o="backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor",r=/^([\-+])=\s*(\d+\.?\d*)/,h=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(e){return[e[1],e[2],e[3],e[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(e){return[2.55*e[1],2.55*e[2],2.55*e[3],e[4]]}},{re:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,parse:function(e){return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]}},{re:/#([a-f0-9])([a-f0-9])([a-f0-9])/,parse:function(e){return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(e){return[e[1],e[2]/100,e[3]/100,e[4]]}}],l=e.Color=function(t,i,s,n){return new e.Color.fn.parse(t,i,s,n)},u={rgba:{props:{red:{idx:0,type:"byte"},green:{idx:1,type:"byte"},blue:{idx:2,type:"byte"}}},hsla:{props:{hue:{idx:0,type:"degrees"},saturation:{idx:1,type:"percent"},lightness:{idx:2,type:"percent"}}}},d={"byte":{floor:!0,max:255},percent:{max:1},degrees:{mod:360,floor:!0}},c=l.support={},p=e("<p>")[0],f=e.each;p.style.cssText="background-color:rgba(1,1,1,.5)",c.rgba=p.style.backgroundColor.indexOf("rgba")>-1,f(u,function(e,t){t.cache="_"+e,t.props.alpha={idx:3,type:"percent",def:1}}),l.fn=e.extend(l.prototype,{parse:function(n,o,r,h){if(n===t)return this._rgba=[null,null,null,null],this;(n.jquery||n.nodeType)&&(n=e(n).css(o),o=t);var d=this,c=e.type(n),p=this._rgba=[];return o!==t&&(n=[n,o,r,h],c="array"),"string"===c?this.parse(s(n)||a._default):"array"===c?(f(u.rgba.props,function(e,t){p[t.idx]=i(n[t.idx],t)}),this):"object"===c?(n instanceof l?f(u,function(e,t){n[t.cache]&&(d[t.cache]=n[t.cache].slice())}):f(u,function(t,s){var a=s.cache;f(s.props,function(e,t){if(!d[a]&&s.to){if("alpha"===e||null==n[e])return;d[a]=s.to(d._rgba)}d[a][t.idx]=i(n[e],t,!0)}),d[a]&&0>e.inArray(null,d[a].slice(0,3))&&(d[a][3]=1,s.from&&(d._rgba=s.from(d[a])))}),this):t},is:function(e){var i=l(e),s=!0,n=this;return f(u,function(e,a){var o,r=i[a.cache];return r&&(o=n[a.cache]||a.to&&a.to(n._rgba)||[],f(a.props,function(e,i){return null!=r[i.idx]?s=r[i.idx]===o[i.idx]:t})),s}),s},_space:function(){var e=[],t=this;return f(u,function(i,s){t[s.cache]&&e.push(i)}),e.pop()},transition:function(e,t){var s=l(e),n=s._space(),a=u[n],o=0===this.alpha()?l("transparent"):this,r=o[a.cache]||a.to(o._rgba),h=r.slice();return s=s[a.cache],f(a.props,function(e,n){var a=n.idx,o=r[a],l=s[a],u=d[n.type]||{};null!==l&&(null===o?h[a]=l:(u.mod&&(l-o>u.mod/2?o+=u.mod:o-l>u.mod/2&&(o-=u.mod)),h[a]=i((l-o)*t+o,n)))}),this[n](h)},blend:function(t){if(1===this._rgba[3])return this;var i=this._rgba.slice(),s=i.pop(),n=l(t)._rgba;return l(e.map(i,function(e,t){return(1-s)*n[t]+s*e}))},toRgbaString:function(){var t="rgba(",i=e.map(this._rgba,function(e,t){return null==e?t>2?1:0:e});return 1===i[3]&&(i.pop(),t="rgb("),t+i.join()+")"},toHslaString:function(){var t="hsla(",i=e.map(this.hsla(),function(e,t){return null==e&&(e=t>2?1:0),t&&3>t&&(e=Math.round(100*e)+"%"),e});return 1===i[3]&&(i.pop(),t="hsl("),t+i.join()+")"},toHexString:function(t){var i=this._rgba.slice(),s=i.pop();return t&&i.push(~~(255*s)),"#"+e.map(i,function(e){return e=(e||0).toString(16),1===e.length?"0"+e:e}).join("")},toString:function(){return 0===this._rgba[3]?"transparent":this.toRgbaString()}}),l.fn.parse.prototype=l.fn,u.hsla.to=function(e){if(null==e[0]||null==e[1]||null==e[2])return[null,null,null,e[3]];var t,i,s=e[0]/255,n=e[1]/255,a=e[2]/255,o=e[3],r=Math.max(s,n,a),h=Math.min(s,n,a),l=r-h,u=r+h,d=.5*u;return t=h===r?0:s===r?60*(n-a)/l+360:n===r?60*(a-s)/l+120:60*(s-n)/l+240,i=0===l?0:.5>=d?l/u:l/(2-u),[Math.round(t)%360,i,d,null==o?1:o]},u.hsla.from=function(e){if(null==e[0]||null==e[1]||null==e[2])return[null,null,null,e[3]];var t=e[0]/360,i=e[1],s=e[2],a=e[3],o=.5>=s?s*(1+i):s+i-s*i,r=2*s-o;return[Math.round(255*n(r,o,t+1/3)),Math.round(255*n(r,o,t)),Math.round(255*n(r,o,t-1/3)),a]},f(u,function(s,n){var a=n.props,o=n.cache,h=n.to,u=n.from;l.fn[s]=function(s){if(h&&!this[o]&&(this[o]=h(this._rgba)),s===t)return this[o].slice();var n,r=e.type(s),d="array"===r||"object"===r?s:arguments,c=this[o].slice();return f(a,function(e,t){var s=d["object"===r?e:t.idx];null==s&&(s=c[t.idx]),c[t.idx]=i(s,t)}),u?(n=l(u(c)),n[o]=c,n):l(c)},f(a,function(t,i){l.fn[t]||(l.fn[t]=function(n){var a,o=e.type(n),h="alpha"===t?this._hsla?"hsla":"rgba":s,l=this[h](),u=l[i.idx];return"undefined"===o?u:("function"===o&&(n=n.call(this,u),o=e.type(n)),null==n&&i.empty?this:("string"===o&&(a=r.exec(n),a&&(n=u+parseFloat(a[2])*("+"===a[1]?1:-1))),l[i.idx]=n,this[h](l)))})})}),l.hook=function(t){var i=t.split(" ");f(i,function(t,i){e.cssHooks[i]={set:function(t,n){var a,o,r="";if("transparent"!==n&&("string"!==e.type(n)||(a=s(n)))){if(n=l(a||n),!c.rgba&&1!==n._rgba[3]){for(o="backgroundColor"===i?t.parentNode:t;(""===r||"transparent"===r)&&o&&o.style;)try{r=e.css(o,"backgroundColor"),o=o.parentNode}catch(h){}n=n.blend(r&&"transparent"!==r?r:"_default")}n=n.toRgbaString()}try{t.style[i]=n}catch(h){}}},e.fx.step[i]=function(t){t.colorInit||(t.start=l(t.elem,i),t.end=l(t.end),t.colorInit=!0),e.cssHooks[i].set(t.elem,t.start.transition(t.end,t.pos))}})},l.hook(o),e.cssHooks.borderColor={expand:function(e){var t={};return f(["Top","Right","Bottom","Left"],function(i,s){t["border"+s+"Color"]=e}),t}},a=e.Color.names={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"}}(b),function(){function t(t){var i,s,n=t.ownerDocument.defaultView?t.ownerDocument.defaultView.getComputedStyle(t,null):t.currentStyle,a={};if(n&&n.length&&n[0]&&n[n[0]])for(s=n.length;s--;)i=n[s],"string"==typeof n[i]&&(a[e.camelCase(i)]=n[i]);else for(i in n)"string"==typeof n[i]&&(a[i]=n[i]);return a}function i(t,i){var s,a,o={};for(s in i)a=i[s],t[s]!==a&&(n[s]||(e.fx.step[s]||!isNaN(parseFloat(a)))&&(o[s]=a));return o}var s=["add","remove","toggle"],n={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};e.each(["borderLeftStyle","borderRightStyle","borderBottomStyle","borderTopStyle"],function(t,i){e.fx.step[i]=function(e){("none"!==e.end&&!e.setAttr||1===e.pos&&!e.setAttr)&&(b.style(e.elem,i,e.end),e.setAttr=!0)}}),e.fn.addBack||(e.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}),e.effects.animateClass=function(n,a,o,r){var h=e.speed(a,o,r);return this.queue(function(){var a,o=e(this),r=o.attr("class")||"",l=h.children?o.find("*").addBack():o;l=l.map(function(){var i=e(this);return{el:i,start:t(this)}}),a=function(){e.each(s,function(e,t){n[t]&&o[t+"Class"](n[t])})},a(),l=l.map(function(){return this.end=t(this.el[0]),this.diff=i(this.start,this.end),this}),o.attr("class",r),l=l.map(function(){var t=this,i=e.Deferred(),s=e.extend({},h,{queue:!1,complete:function(){i.resolve(t)}});return this.el.animate(this.diff,s),i.promise()}),e.when.apply(e,l.get()).done(function(){a(),e.each(arguments,function(){var t=this.el;e.each(this.diff,function(e){t.css(e,"")})}),h.complete.call(o[0])})})},e.fn.extend({addClass:function(t){return function(i,s,n,a){return s?e.effects.animateClass.call(this,{add:i},s,n,a):t.apply(this,arguments)}}(e.fn.addClass),removeClass:function(t){return function(i,s,n,a){return arguments.length>1?e.effects.animateClass.call(this,{remove:i},s,n,a):t.apply(this,arguments)}}(e.fn.removeClass),toggleClass:function(t){return function(i,s,n,a,o){return"boolean"==typeof s||void 0===s?n?e.effects.animateClass.call(this,s?{add:i}:{remove:i},n,a,o):t.apply(this,arguments):e.effects.animateClass.call(this,{toggle:i},s,n,a)}}(e.fn.toggleClass),switchClass:function(t,i,s,n,a){return e.effects.animateClass.call(this,{add:i,remove:t},s,n,a)}})}(),function(){function t(t,i,s,n){return e.isPlainObject(t)&&(i=t,t=t.effect),t={effect:t},null==i&&(i={}),e.isFunction(i)&&(n=i,s=null,i={}),("number"==typeof i||e.fx.speeds[i])&&(n=s,s=i,i={}),e.isFunction(s)&&(n=s,s=null),i&&e.extend(t,i),s=s||i.duration,t.duration=e.fx.off?0:"number"==typeof s?s:s in e.fx.speeds?e.fx.speeds[s]:e.fx.speeds._default,t.complete=n||i.complete,t}function i(t){return!t||"number"==typeof t||e.fx.speeds[t]?!0:"string"!=typeof t||e.effects.effect[t]?e.isFunction(t)?!0:"object"!=typeof t||t.effect?!1:!0:!0}e.extend(e.effects,{version:"1.11.2",save:function(e,t){for(var i=0;t.length>i;i++)null!==t[i]&&e.data(y+t[i],e[0].style[t[i]])},restore:function(e,t){var i,s;for(s=0;t.length>s;s++)null!==t[s]&&(i=e.data(y+t[s]),void 0===i&&(i=""),e.css(t[s],i))},setMode:function(e,t){return"toggle"===t&&(t=e.is(":hidden")?"show":"hide"),t},getBaseline:function(e,t){var i,s;switch(e[0]){case"top":i=0;break;case"middle":i=.5;break;case"bottom":i=1;break;default:i=e[0]/t.height}switch(e[1]){case"left":s=0;break;case"center":s=.5;break;case"right":s=1;break;default:s=e[1]/t.width}return{x:s,y:i}},createWrapper:function(t){if(t.parent().is(".ui-effects-wrapper"))return t.parent();var i={width:t.outerWidth(!0),height:t.outerHeight(!0),"float":t.css("float")},s=e("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),n={width:t.width(),height:t.height()},a=document.activeElement;try{a.id}catch(o){a=document.body}return t.wrap(s),(t[0]===a||e.contains(t[0],a))&&e(a).focus(),s=t.parent(),"static"===t.css("position")?(s.css({position:"relative"}),t.css({position:"relative"})):(e.extend(i,{position:t.css("position"),zIndex:t.css("z-index")}),e.each(["top","left","bottom","right"],function(e,s){i[s]=t.css(s),isNaN(parseInt(i[s],10))&&(i[s]="auto")}),t.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"})),t.css(n),s.css(i).show()},removeWrapper:function(t){var i=document.activeElement;return t.parent().is(".ui-effects-wrapper")&&(t.parent().replaceWith(t),(t[0]===i||e.contains(t[0],i))&&e(i).focus()),t},setTransition:function(t,i,s,n){return n=n||{},e.each(i,function(e,i){var a=t.cssUnit(i);a[0]>0&&(n[i]=a[0]*s+a[1])}),n}}),e.fn.extend({effect:function(){function i(t){function i(){e.isFunction(a)&&a.call(n[0]),e.isFunction(t)&&t()}var n=e(this),a=s.complete,r=s.mode;(n.is(":hidden")?"hide"===r:"show"===r)?(n[r](),i()):o.call(n[0],s,i)}var s=t.apply(this,arguments),n=s.mode,a=s.queue,o=e.effects.effect[s.effect];return e.fx.off||!o?n?this[n](s.duration,s.complete):this.each(function(){s.complete&&s.complete.call(this)}):a===!1?this.each(i):this.queue(a||"fx",i)},show:function(e){return function(s){if(i(s))return e.apply(this,arguments);var n=t.apply(this,arguments);return n.mode="show",this.effect.call(this,n)}}(e.fn.show),hide:function(e){return function(s){if(i(s))return e.apply(this,arguments);var n=t.apply(this,arguments);return n.mode="hide",this.effect.call(this,n)}}(e.fn.hide),toggle:function(e){return function(s){if(i(s)||"boolean"==typeof s)return e.apply(this,arguments);var n=t.apply(this,arguments);return n.mode="toggle",this.effect.call(this,n)}}(e.fn.toggle),cssUnit:function(t){var i=this.css(t),s=[];return e.each(["em","px","%","pt"],function(e,t){i.indexOf(t)>0&&(s=[parseFloat(i),t])}),s}})}(),function(){var t={};e.each(["Quad","Cubic","Quart","Quint","Expo"],function(e,i){t[i]=function(t){return Math.pow(t,e+2)}}),e.extend(t,{Sine:function(e){return 1-Math.cos(e*Math.PI/2)},Circ:function(e){return 1-Math.sqrt(1-e*e)},Elastic:function(e){return 0===e||1===e?e:-Math.pow(2,8*(e-1))*Math.sin((80*(e-1)-7.5)*Math.PI/15)},Back:function(e){return e*e*(3*e-2)},Bounce:function(e){for(var t,i=4;((t=Math.pow(2,--i))-1)/11>e;);return 1/Math.pow(4,3-i)-7.5625*Math.pow((3*t-2)/22-e,2)}}),e.each(t,function(t,i){e.easing["easeIn"+t]=i,e.easing["easeOut"+t]=function(e){return 1-i(1-e)},e.easing["easeInOut"+t]=function(e){return.5>e?i(2*e)/2:1-i(-2*e+2)/2}})}(),e.effects,e.effects.effect.blind=function(t,i){var s,n,a,o=e(this),r=/up|down|vertical/,h=/up|left|vertical|horizontal/,l=["position","top","bottom","left","right","height","width"],u=e.effects.setMode(o,t.mode||"hide"),d=t.direction||"up",c=r.test(d),p=c?"height":"width",f=c?"top":"left",m=h.test(d),g={},v="show"===u;o.parent().is(".ui-effects-wrapper")?e.effects.save(o.parent(),l):e.effects.save(o,l),o.show(),s=e.effects.createWrapper(o).css({overflow:"hidden"}),n=s[p](),a=parseFloat(s.css(f))||0,g[p]=v?n:0,m||(o.css(c?"bottom":"right",0).css(c?"top":"left","auto").css({position:"absolute"}),g[f]=v?a:n+a),v&&(s.css(p,0),m||s.css(f,a+n)),s.animate(g,{duration:t.duration,easing:t.easing,queue:!1,complete:function(){"hide"===u&&o.hide(),e.effects.restore(o,l),e.effects.removeWrapper(o),i()}})},e.effects.effect.bounce=function(t,i){var s,n,a,o=e(this),r=["position","top","bottom","left","right","height","width"],h=e.effects.setMode(o,t.mode||"effect"),l="hide"===h,u="show"===h,d=t.direction||"up",c=t.distance,p=t.times||5,f=2*p+(u||l?1:0),m=t.duration/f,g=t.easing,v="up"===d||"down"===d?"top":"left",y="up"===d||"left"===d,b=o.queue(),_=b.length;for((u||l)&&r.push("opacity"),e.effects.save(o,r),o.show(),e.effects.createWrapper(o),c||(c=o["top"===v?"outerHeight":"outerWidth"]()/3),u&&(a={opacity:1},a[v]=0,o.css("opacity",0).css(v,y?2*-c:2*c).animate(a,m,g)),l&&(c/=Math.pow(2,p-1)),a={},a[v]=0,s=0;p>s;s++)n={},n[v]=(y?"-=":"+=")+c,o.animate(n,m,g).animate(a,m,g),c=l?2*c:c/2;l&&(n={opacity:0},n[v]=(y?"-=":"+=")+c,o.animate(n,m,g)),o.queue(function(){l&&o.hide(),e.effects.restore(o,r),e.effects.removeWrapper(o),i()}),_>1&&b.splice.apply(b,[1,0].concat(b.splice(_,f+1))),o.dequeue()},e.effects.effect.clip=function(t,i){var s,n,a,o=e(this),r=["position","top","bottom","left","right","height","width"],h=e.effects.setMode(o,t.mode||"hide"),l="show"===h,u=t.direction||"vertical",d="vertical"===u,c=d?"height":"width",p=d?"top":"left",f={};e.effects.save(o,r),o.show(),s=e.effects.createWrapper(o).css({overflow:"hidden"}),n="IMG"===o[0].tagName?s:o,a=n[c](),l&&(n.css(c,0),n.css(p,a/2)),f[c]=l?a:0,f[p]=l?0:a/2,n.animate(f,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){l||o.hide(),e.effects.restore(o,r),e.effects.removeWrapper(o),i()}})},e.effects.effect.drop=function(t,i){var s,n=e(this),a=["position","top","bottom","left","right","opacity","height","width"],o=e.effects.setMode(n,t.mode||"hide"),r="show"===o,h=t.direction||"left",l="up"===h||"down"===h?"top":"left",u="up"===h||"left"===h?"pos":"neg",d={opacity:r?1:0};e.effects.save(n,a),n.show(),e.effects.createWrapper(n),s=t.distance||n["top"===l?"outerHeight":"outerWidth"](!0)/2,r&&n.css("opacity",0).css(l,"pos"===u?-s:s),d[l]=(r?"pos"===u?"+=":"-=":"pos"===u?"-=":"+=")+s,n.animate(d,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){"hide"===o&&n.hide(),e.effects.restore(n,a),e.effects.removeWrapper(n),i()}})},e.effects.effect.explode=function(t,i){function s(){b.push(this),b.length===d*c&&n()}function n(){p.css({visibility:"visible"}),e(b).remove(),m||p.hide(),i()}var a,o,r,h,l,u,d=t.pieces?Math.round(Math.sqrt(t.pieces)):3,c=d,p=e(this),f=e.effects.setMode(p,t.mode||"hide"),m="show"===f,g=p.show().css("visibility","hidden").offset(),v=Math.ceil(p.outerWidth()/c),y=Math.ceil(p.outerHeight()/d),b=[];for(a=0;d>a;a++)for(h=g.top+a*y,u=a-(d-1)/2,o=0;c>o;o++)r=g.left+o*v,l=o-(c-1)/2,p.clone().appendTo("body").wrap("<div></div>").css({position:"absolute",visibility:"visible",left:-o*v,top:-a*y}).parent().addClass("ui-effects-explode").css({position:"absolute",overflow:"hidden",width:v,height:y,left:r+(m?l*v:0),top:h+(m?u*y:0),opacity:m?0:1}).animate({left:r+(m?0:l*v),top:h+(m?0:u*y),opacity:m?1:0},t.duration||500,t.easing,s)},e.effects.effect.fade=function(t,i){var s=e(this),n=e.effects.setMode(s,t.mode||"toggle");s.animate({opacity:n},{queue:!1,duration:t.duration,easing:t.easing,complete:i})},e.effects.effect.fold=function(t,i){var s,n,a=e(this),o=["position","top","bottom","left","right","height","width"],r=e.effects.setMode(a,t.mode||"hide"),h="show"===r,l="hide"===r,u=t.size||15,d=/([0-9]+)%/.exec(u),c=!!t.horizFirst,p=h!==c,f=p?["width","height"]:["height","width"],m=t.duration/2,g={},v={};e.effects.save(a,o),a.show(),s=e.effects.createWrapper(a).css({overflow:"hidden"}),n=p?[s.width(),s.height()]:[s.height(),s.width()],d&&(u=parseInt(d[1],10)/100*n[l?0:1]),h&&s.css(c?{height:0,width:u}:{height:u,width:0}),g[f[0]]=h?n[0]:u,v[f[1]]=h?n[1]:0,s.animate(g,m,t.easing).animate(v,m,t.easing,function(){l&&a.hide(),e.effects.restore(a,o),e.effects.removeWrapper(a),i()})},e.effects.effect.highlight=function(t,i){var s=e(this),n=["backgroundImage","backgroundColor","opacity"],a=e.effects.setMode(s,t.mode||"show"),o={backgroundColor:s.css("backgroundColor")};"hide"===a&&(o.opacity=0),e.effects.save(s,n),s.show().css({backgroundImage:"none",backgroundColor:t.color||"#ffff99"}).animate(o,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){"hide"===a&&s.hide(),e.effects.restore(s,n),i()}})},e.effects.effect.size=function(t,i){var s,n,a,o=e(this),r=["position","top","bottom","left","right","width","height","overflow","opacity"],h=["position","top","bottom","left","right","overflow","opacity"],l=["width","height","overflow"],u=["fontSize"],d=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],c=["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"],p=e.effects.setMode(o,t.mode||"effect"),f=t.restore||"effect"!==p,m=t.scale||"both",g=t.origin||["middle","center"],v=o.css("position"),y=f?r:h,b={height:0,width:0,outerHeight:0,outerWidth:0};"show"===p&&o.show(),s={height:o.height(),width:o.width(),outerHeight:o.outerHeight(),outerWidth:o.outerWidth()},"toggle"===t.mode&&"show"===p?(o.from=t.to||b,o.to=t.from||s):(o.from=t.from||("show"===p?b:s),o.to=t.to||("hide"===p?b:s)),a={from:{y:o.from.height/s.height,x:o.from.width/s.width},to:{y:o.to.height/s.height,x:o.to.width/s.width}},("box"===m||"both"===m)&&(a.from.y!==a.to.y&&(y=y.concat(d),o.from=e.effects.setTransition(o,d,a.from.y,o.from),o.to=e.effects.setTransition(o,d,a.to.y,o.to)),a.from.x!==a.to.x&&(y=y.concat(c),o.from=e.effects.setTransition(o,c,a.from.x,o.from),o.to=e.effects.setTransition(o,c,a.to.x,o.to))),("content"===m||"both"===m)&&a.from.y!==a.to.y&&(y=y.concat(u).concat(l),o.from=e.effects.setTransition(o,u,a.from.y,o.from),o.to=e.effects.setTransition(o,u,a.to.y,o.to)),e.effects.save(o,y),o.show(),e.effects.createWrapper(o),o.css("overflow","hidden").css(o.from),g&&(n=e.effects.getBaseline(g,s),o.from.top=(s.outerHeight-o.outerHeight())*n.y,o.from.left=(s.outerWidth-o.outerWidth())*n.x,o.to.top=(s.outerHeight-o.to.outerHeight)*n.y,o.to.left=(s.outerWidth-o.to.outerWidth)*n.x),o.css(o.from),("content"===m||"both"===m)&&(d=d.concat(["marginTop","marginBottom"]).concat(u),c=c.concat(["marginLeft","marginRight"]),l=r.concat(d).concat(c),o.find("*[width]").each(function(){var i=e(this),s={height:i.height(),width:i.width(),outerHeight:i.outerHeight(),outerWidth:i.outerWidth()};
f&&e.effects.save(i,l),i.from={height:s.height*a.from.y,width:s.width*a.from.x,outerHeight:s.outerHeight*a.from.y,outerWidth:s.outerWidth*a.from.x},i.to={height:s.height*a.to.y,width:s.width*a.to.x,outerHeight:s.height*a.to.y,outerWidth:s.width*a.to.x},a.from.y!==a.to.y&&(i.from=e.effects.setTransition(i,d,a.from.y,i.from),i.to=e.effects.setTransition(i,d,a.to.y,i.to)),a.from.x!==a.to.x&&(i.from=e.effects.setTransition(i,c,a.from.x,i.from),i.to=e.effects.setTransition(i,c,a.to.x,i.to)),i.css(i.from),i.animate(i.to,t.duration,t.easing,function(){f&&e.effects.restore(i,l)})})),o.animate(o.to,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){0===o.to.opacity&&o.css("opacity",o.from.opacity),"hide"===p&&o.hide(),e.effects.restore(o,y),f||("static"===v?o.css({position:"relative",top:o.to.top,left:o.to.left}):e.each(["top","left"],function(e,t){o.css(t,function(t,i){var s=parseInt(i,10),n=e?o.to.left:o.to.top;return"auto"===i?n+"px":s+n+"px"})})),e.effects.removeWrapper(o),i()}})},e.effects.effect.scale=function(t,i){var s=e(this),n=e.extend(!0,{},t),a=e.effects.setMode(s,t.mode||"effect"),o=parseInt(t.percent,10)||(0===parseInt(t.percent,10)?0:"hide"===a?0:100),r=t.direction||"both",h=t.origin,l={height:s.height(),width:s.width(),outerHeight:s.outerHeight(),outerWidth:s.outerWidth()},u={y:"horizontal"!==r?o/100:1,x:"vertical"!==r?o/100:1};n.effect="size",n.queue=!1,n.complete=i,"effect"!==a&&(n.origin=h||["middle","center"],n.restore=!0),n.from=t.from||("show"===a?{height:0,width:0,outerHeight:0,outerWidth:0}:l),n.to={height:l.height*u.y,width:l.width*u.x,outerHeight:l.outerHeight*u.y,outerWidth:l.outerWidth*u.x},n.fade&&("show"===a&&(n.from.opacity=0,n.to.opacity=1),"hide"===a&&(n.from.opacity=1,n.to.opacity=0)),s.effect(n)},e.effects.effect.puff=function(t,i){var s=e(this),n=e.effects.setMode(s,t.mode||"hide"),a="hide"===n,o=parseInt(t.percent,10)||150,r=o/100,h={height:s.height(),width:s.width(),outerHeight:s.outerHeight(),outerWidth:s.outerWidth()};e.extend(t,{effect:"scale",queue:!1,fade:!0,mode:n,complete:i,percent:a?o:100,from:a?h:{height:h.height*r,width:h.width*r,outerHeight:h.outerHeight*r,outerWidth:h.outerWidth*r}}),s.effect(t)},e.effects.effect.pulsate=function(t,i){var s,n=e(this),a=e.effects.setMode(n,t.mode||"show"),o="show"===a,r="hide"===a,h=o||"hide"===a,l=2*(t.times||5)+(h?1:0),u=t.duration/l,d=0,c=n.queue(),p=c.length;for((o||!n.is(":visible"))&&(n.css("opacity",0).show(),d=1),s=1;l>s;s++)n.animate({opacity:d},u,t.easing),d=1-d;n.animate({opacity:d},u,t.easing),n.queue(function(){r&&n.hide(),i()}),p>1&&c.splice.apply(c,[1,0].concat(c.splice(p,l+1))),n.dequeue()},e.effects.effect.shake=function(t,i){var s,n=e(this),a=["position","top","bottom","left","right","height","width"],o=e.effects.setMode(n,t.mode||"effect"),r=t.direction||"left",h=t.distance||20,l=t.times||3,u=2*l+1,d=Math.round(t.duration/u),c="up"===r||"down"===r?"top":"left",p="up"===r||"left"===r,f={},m={},g={},v=n.queue(),y=v.length;for(e.effects.save(n,a),n.show(),e.effects.createWrapper(n),f[c]=(p?"-=":"+=")+h,m[c]=(p?"+=":"-=")+2*h,g[c]=(p?"-=":"+=")+2*h,n.animate(f,d,t.easing),s=1;l>s;s++)n.animate(m,d,t.easing).animate(g,d,t.easing);n.animate(m,d,t.easing).animate(f,d/2,t.easing).queue(function(){"hide"===o&&n.hide(),e.effects.restore(n,a),e.effects.removeWrapper(n),i()}),y>1&&v.splice.apply(v,[1,0].concat(v.splice(y,u+1))),n.dequeue()},e.effects.effect.slide=function(t,i){var s,n=e(this),a=["position","top","bottom","left","right","width","height"],o=e.effects.setMode(n,t.mode||"show"),r="show"===o,h=t.direction||"left",l="up"===h||"down"===h?"top":"left",u="up"===h||"left"===h,d={};e.effects.save(n,a),n.show(),s=t.distance||n["top"===l?"outerHeight":"outerWidth"](!0),e.effects.createWrapper(n).css({overflow:"hidden"}),r&&n.css(l,u?isNaN(s)?"-"+s:-s:s),d[l]=(r?u?"+=":"-=":u?"-=":"+=")+s,n.animate(d,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){"hide"===o&&n.hide(),e.effects.restore(n,a),e.effects.removeWrapper(n),i()}})},e.effects.effect.transfer=function(t,i){var s=e(this),n=e(t.to),a="fixed"===n.css("position"),o=e("body"),r=a?o.scrollTop():0,h=a?o.scrollLeft():0,l=n.offset(),u={top:l.top-r,left:l.left-h,height:n.innerHeight(),width:n.innerWidth()},d=s.offset(),c=e("<div class='ui-effects-transfer'></div>").appendTo(document.body).addClass(t.className).css({top:d.top-r,left:d.left-h,height:s.innerHeight(),width:s.innerWidth(),position:a?"fixed":"absolute"}).animate(u,t.duration,t.easing,function(){c.remove(),i()})},e.widget("ui.progressbar",{version:"1.11.2",options:{max:100,value:0,change:null,complete:null},min:0,_create:function(){this.oldValue=this.options.value=this._constrainedValue(),this.element.addClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").attr({role:"progressbar","aria-valuemin":this.min}),this.valueDiv=e("<div class='ui-progressbar-value ui-widget-header ui-corner-left'></div>").appendTo(this.element),this._refreshValue()},_destroy:function(){this.element.removeClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow"),this.valueDiv.remove()},value:function(e){return void 0===e?this.options.value:(this.options.value=this._constrainedValue(e),this._refreshValue(),void 0)},_constrainedValue:function(e){return void 0===e&&(e=this.options.value),this.indeterminate=e===!1,"number"!=typeof e&&(e=0),this.indeterminate?!1:Math.min(this.options.max,Math.max(this.min,e))},_setOptions:function(e){var t=e.value;delete e.value,this._super(e),this.options.value=this._constrainedValue(t),this._refreshValue()},_setOption:function(e,t){"max"===e&&(t=Math.max(this.min,t)),"disabled"===e&&this.element.toggleClass("ui-state-disabled",!!t).attr("aria-disabled",t),this._super(e,t)},_percentage:function(){return this.indeterminate?100:100*(this.options.value-this.min)/(this.options.max-this.min)},_refreshValue:function(){var t=this.options.value,i=this._percentage();this.valueDiv.toggle(this.indeterminate||t>this.min).toggleClass("ui-corner-right",t===this.options.max).width(i.toFixed(0)+"%"),this.element.toggleClass("ui-progressbar-indeterminate",this.indeterminate),this.indeterminate?(this.element.removeAttr("aria-valuenow"),this.overlayDiv||(this.overlayDiv=e("<div class='ui-progressbar-overlay'></div>").appendTo(this.valueDiv))):(this.element.attr({"aria-valuemax":this.options.max,"aria-valuenow":t}),this.overlayDiv&&(this.overlayDiv.remove(),this.overlayDiv=null)),this.oldValue!==t&&(this.oldValue=t,this._trigger("change")),t===this.options.max&&this._trigger("complete")}}),e.widget("ui.selectable",e.ui.mouse,{version:"1.11.2",options:{appendTo:"body",autoRefresh:!0,distance:0,filter:"*",tolerance:"touch",selected:null,selecting:null,start:null,stop:null,unselected:null,unselecting:null},_create:function(){var t,i=this;this.element.addClass("ui-selectable"),this.dragged=!1,this.refresh=function(){t=e(i.options.filter,i.element[0]),t.addClass("ui-selectee"),t.each(function(){var t=e(this),i=t.offset();e.data(this,"selectable-item",{element:this,$element:t,left:i.left,top:i.top,right:i.left+t.outerWidth(),bottom:i.top+t.outerHeight(),startselected:!1,selected:t.hasClass("ui-selected"),selecting:t.hasClass("ui-selecting"),unselecting:t.hasClass("ui-unselecting")})})},this.refresh(),this.selectees=t.addClass("ui-selectee"),this._mouseInit(),this.helper=e("<div class='ui-selectable-helper'></div>")},_destroy:function(){this.selectees.removeClass("ui-selectee").removeData("selectable-item"),this.element.removeClass("ui-selectable ui-selectable-disabled"),this._mouseDestroy()},_mouseStart:function(t){var i=this,s=this.options;this.opos=[t.pageX,t.pageY],this.options.disabled||(this.selectees=e(s.filter,this.element[0]),this._trigger("start",t),e(s.appendTo).append(this.helper),this.helper.css({left:t.pageX,top:t.pageY,width:0,height:0}),s.autoRefresh&&this.refresh(),this.selectees.filter(".ui-selected").each(function(){var s=e.data(this,"selectable-item");s.startselected=!0,t.metaKey||t.ctrlKey||(s.$element.removeClass("ui-selected"),s.selected=!1,s.$element.addClass("ui-unselecting"),s.unselecting=!0,i._trigger("unselecting",t,{unselecting:s.element}))}),e(t.target).parents().addBack().each(function(){var s,n=e.data(this,"selectable-item");return n?(s=!t.metaKey&&!t.ctrlKey||!n.$element.hasClass("ui-selected"),n.$element.removeClass(s?"ui-unselecting":"ui-selected").addClass(s?"ui-selecting":"ui-unselecting"),n.unselecting=!s,n.selecting=s,n.selected=s,s?i._trigger("selecting",t,{selecting:n.element}):i._trigger("unselecting",t,{unselecting:n.element}),!1):void 0}))},_mouseDrag:function(t){if(this.dragged=!0,!this.options.disabled){var i,s=this,n=this.options,a=this.opos[0],o=this.opos[1],r=t.pageX,h=t.pageY;return a>r&&(i=r,r=a,a=i),o>h&&(i=h,h=o,o=i),this.helper.css({left:a,top:o,width:r-a,height:h-o}),this.selectees.each(function(){var i=e.data(this,"selectable-item"),l=!1;i&&i.element!==s.element[0]&&("touch"===n.tolerance?l=!(i.left>r||a>i.right||i.top>h||o>i.bottom):"fit"===n.tolerance&&(l=i.left>a&&r>i.right&&i.top>o&&h>i.bottom),l?(i.selected&&(i.$element.removeClass("ui-selected"),i.selected=!1),i.unselecting&&(i.$element.removeClass("ui-unselecting"),i.unselecting=!1),i.selecting||(i.$element.addClass("ui-selecting"),i.selecting=!0,s._trigger("selecting",t,{selecting:i.element}))):(i.selecting&&((t.metaKey||t.ctrlKey)&&i.startselected?(i.$element.removeClass("ui-selecting"),i.selecting=!1,i.$element.addClass("ui-selected"),i.selected=!0):(i.$element.removeClass("ui-selecting"),i.selecting=!1,i.startselected&&(i.$element.addClass("ui-unselecting"),i.unselecting=!0),s._trigger("unselecting",t,{unselecting:i.element}))),i.selected&&(t.metaKey||t.ctrlKey||i.startselected||(i.$element.removeClass("ui-selected"),i.selected=!1,i.$element.addClass("ui-unselecting"),i.unselecting=!0,s._trigger("unselecting",t,{unselecting:i.element})))))}),!1}},_mouseStop:function(t){var i=this;return this.dragged=!1,e(".ui-unselecting",this.element[0]).each(function(){var s=e.data(this,"selectable-item");s.$element.removeClass("ui-unselecting"),s.unselecting=!1,s.startselected=!1,i._trigger("unselected",t,{unselected:s.element})}),e(".ui-selecting",this.element[0]).each(function(){var s=e.data(this,"selectable-item");s.$element.removeClass("ui-selecting").addClass("ui-selected"),s.selecting=!1,s.selected=!0,s.startselected=!0,i._trigger("selected",t,{selected:s.element})}),this._trigger("stop",t),this.helper.remove(),!1}}),e.widget("ui.selectmenu",{version:"1.11.2",defaultElement:"<select>",options:{appendTo:null,disabled:null,icons:{button:"ui-icon-triangle-1-s"},position:{my:"left top",at:"left bottom",collision:"none"},width:null,change:null,close:null,focus:null,open:null,select:null},_create:function(){var e=this.element.uniqueId().attr("id");this.ids={element:e,button:e+"-button",menu:e+"-menu"},this._drawButton(),this._drawMenu(),this.options.disabled&&this.disable()},_drawButton:function(){var t=this,i=this.element.attr("tabindex");this.label=e("label[for='"+this.ids.element+"']").attr("for",this.ids.button),this._on(this.label,{click:function(e){this.button.focus(),e.preventDefault()}}),this.element.hide(),this.button=e("<span>",{"class":"ui-selectmenu-button ui-widget ui-state-default ui-corner-all",tabindex:i||this.options.disabled?-1:0,id:this.ids.button,role:"combobox","aria-expanded":"false","aria-autocomplete":"list","aria-owns":this.ids.menu,"aria-haspopup":"true"}).insertAfter(this.element),e("<span>",{"class":"ui-icon "+this.options.icons.button}).prependTo(this.button),this.buttonText=e("<span>",{"class":"ui-selectmenu-text"}).appendTo(this.button),this._setText(this.buttonText,this.element.find("option:selected").text()),this._resizeButton(),this._on(this.button,this._buttonEvents),this.button.one("focusin",function(){t.menuItems||t._refreshMenu()}),this._hoverable(this.button),this._focusable(this.button)},_drawMenu:function(){var t=this;this.menu=e("<ul>",{"aria-hidden":"true","aria-labelledby":this.ids.button,id:this.ids.menu}),this.menuWrap=e("<div>",{"class":"ui-selectmenu-menu ui-front"}).append(this.menu).appendTo(this._appendTo()),this.menuInstance=this.menu.menu({role:"listbox",select:function(e,i){e.preventDefault(),t._setSelection(),t._select(i.item.data("ui-selectmenu-item"),e)},focus:function(e,i){var s=i.item.data("ui-selectmenu-item");null!=t.focusIndex&&s.index!==t.focusIndex&&(t._trigger("focus",e,{item:s}),t.isOpen||t._select(s,e)),t.focusIndex=s.index,t.button.attr("aria-activedescendant",t.menuItems.eq(s.index).attr("id"))}}).menu("instance"),this.menu.addClass("ui-corner-bottom").removeClass("ui-corner-all"),this.menuInstance._off(this.menu,"mouseleave"),this.menuInstance._closeOnDocumentClick=function(){return!1},this.menuInstance._isDivider=function(){return!1}},refresh:function(){this._refreshMenu(),this._setText(this.buttonText,this._getSelectedItem().text()),this.options.width||this._resizeButton()},_refreshMenu:function(){this.menu.empty();var e,t=this.element.find("option");t.length&&(this._parseOptions(t),this._renderMenu(this.menu,this.items),this.menuInstance.refresh(),this.menuItems=this.menu.find("li").not(".ui-selectmenu-optgroup"),e=this._getSelectedItem(),this.menuInstance.focus(null,e),this._setAria(e.data("ui-selectmenu-item")),this._setOption("disabled",this.element.prop("disabled")))},open:function(e){this.options.disabled||(this.menuItems?(this.menu.find(".ui-state-focus").removeClass("ui-state-focus"),this.menuInstance.focus(null,this._getSelectedItem())):this._refreshMenu(),this.isOpen=!0,this._toggleAttr(),this._resizeMenu(),this._position(),this._on(this.document,this._documentClick),this._trigger("open",e))},_position:function(){this.menuWrap.position(e.extend({of:this.button},this.options.position))},close:function(e){this.isOpen&&(this.isOpen=!1,this._toggleAttr(),this.range=null,this._off(this.document),this._trigger("close",e))},widget:function(){return this.button},menuWidget:function(){return this.menu},_renderMenu:function(t,i){var s=this,n="";e.each(i,function(i,a){a.optgroup!==n&&(e("<li>",{"class":"ui-selectmenu-optgroup ui-menu-divider"+(a.element.parent("optgroup").prop("disabled")?" ui-state-disabled":""),text:a.optgroup}).appendTo(t),n=a.optgroup),s._renderItemData(t,a)})},_renderItemData:function(e,t){return this._renderItem(e,t).data("ui-selectmenu-item",t)},_renderItem:function(t,i){var s=e("<li>");return i.disabled&&s.addClass("ui-state-disabled"),this._setText(s,i.label),s.appendTo(t)},_setText:function(e,t){t?e.text(t):e.html("&#160;")},_move:function(e,t){var i,s,n=".ui-menu-item";this.isOpen?i=this.menuItems.eq(this.focusIndex):(i=this.menuItems.eq(this.element[0].selectedIndex),n+=":not(.ui-state-disabled)"),s="first"===e||"last"===e?i["first"===e?"prevAll":"nextAll"](n).eq(-1):i[e+"All"](n).eq(0),s.length&&this.menuInstance.focus(t,s)},_getSelectedItem:function(){return this.menuItems.eq(this.element[0].selectedIndex)},_toggle:function(e){this[this.isOpen?"close":"open"](e)},_setSelection:function(){var e;this.range&&(window.getSelection?(e=window.getSelection(),e.removeAllRanges(),e.addRange(this.range)):this.range.select(),this.button.focus())},_documentClick:{mousedown:function(t){this.isOpen&&(e(t.target).closest(".ui-selectmenu-menu, #"+this.ids.button).length||this.close(t))}},_buttonEvents:{mousedown:function(){var e;window.getSelection?(e=window.getSelection(),e.rangeCount&&(this.range=e.getRangeAt(0))):this.range=document.selection.createRange()},click:function(e){this._setSelection(),this._toggle(e)},keydown:function(t){var i=!0;switch(t.keyCode){case e.ui.keyCode.TAB:case e.ui.keyCode.ESCAPE:this.close(t),i=!1;break;case e.ui.keyCode.ENTER:this.isOpen&&this._selectFocusedItem(t);break;case e.ui.keyCode.UP:t.altKey?this._toggle(t):this._move("prev",t);break;case e.ui.keyCode.DOWN:t.altKey?this._toggle(t):this._move("next",t);break;case e.ui.keyCode.SPACE:this.isOpen?this._selectFocusedItem(t):this._toggle(t);break;case e.ui.keyCode.LEFT:this._move("prev",t);break;case e.ui.keyCode.RIGHT:this._move("next",t);break;case e.ui.keyCode.HOME:case e.ui.keyCode.PAGE_UP:this._move("first",t);break;case e.ui.keyCode.END:case e.ui.keyCode.PAGE_DOWN:this._move("last",t);break;default:this.menu.trigger(t),i=!1}i&&t.preventDefault()}},_selectFocusedItem:function(e){var t=this.menuItems.eq(this.focusIndex);t.hasClass("ui-state-disabled")||this._select(t.data("ui-selectmenu-item"),e)},_select:function(e,t){var i=this.element[0].selectedIndex;this.element[0].selectedIndex=e.index,this._setText(this.buttonText,e.label),this._setAria(e),this._trigger("select",t,{item:e}),e.index!==i&&this._trigger("change",t,{item:e}),this.close(t)},_setAria:function(e){var t=this.menuItems.eq(e.index).attr("id");this.button.attr({"aria-labelledby":t,"aria-activedescendant":t}),this.menu.attr("aria-activedescendant",t)},_setOption:function(e,t){"icons"===e&&this.button.find("span.ui-icon").removeClass(this.options.icons.button).addClass(t.button),this._super(e,t),"appendTo"===e&&this.menuWrap.appendTo(this._appendTo()),"disabled"===e&&(this.menuInstance.option("disabled",t),this.button.toggleClass("ui-state-disabled",t).attr("aria-disabled",t),this.element.prop("disabled",t),t?(this.button.attr("tabindex",-1),this.close()):this.button.attr("tabindex",0)),"width"===e&&this._resizeButton()},_appendTo:function(){var t=this.options.appendTo;return t&&(t=t.jquery||t.nodeType?e(t):this.document.find(t).eq(0)),t&&t[0]||(t=this.element.closest(".ui-front")),t.length||(t=this.document[0].body),t},_toggleAttr:function(){this.button.toggleClass("ui-corner-top",this.isOpen).toggleClass("ui-corner-all",!this.isOpen).attr("aria-expanded",this.isOpen),this.menuWrap.toggleClass("ui-selectmenu-open",this.isOpen),this.menu.attr("aria-hidden",!this.isOpen)},_resizeButton:function(){var e=this.options.width;e||(e=this.element.show().outerWidth(),this.element.hide()),this.button.outerWidth(e)},_resizeMenu:function(){this.menu.outerWidth(Math.max(this.button.outerWidth(),this.menu.width("").outerWidth()+1))},_getCreateOptions:function(){return{disabled:this.element.prop("disabled")}},_parseOptions:function(t){var i=[];t.each(function(t,s){var n=e(s),a=n.parent("optgroup");i.push({element:n,index:t,value:n.attr("value"),label:n.text(),optgroup:a.attr("label")||"",disabled:a.prop("disabled")||n.prop("disabled")})}),this.items=i},_destroy:function(){this.menuWrap.remove(),this.button.remove(),this.element.show(),this.element.removeUniqueId(),this.label.attr("for",this.ids.element)}}),e.widget("ui.slider",e.ui.mouse,{version:"1.11.2",widgetEventPrefix:"slide",options:{animate:!1,distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null,change:null,slide:null,start:null,stop:null},numPages:5,_create:function(){this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this._calculateNewMax(),this.element.addClass("ui-slider ui-slider-"+this.orientation+" ui-widget"+" ui-widget-content"+" ui-corner-all"),this._refresh(),this._setOption("disabled",this.options.disabled),this._animateOff=!1},_refresh:function(){this._createRange(),this._createHandles(),this._setupEvents(),this._refreshValue()},_createHandles:function(){var t,i,s=this.options,n=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),a="<span class='ui-slider-handle ui-state-default ui-corner-all' tabindex='0'></span>",o=[];for(i=s.values&&s.values.length||1,n.length>i&&(n.slice(i).remove(),n=n.slice(0,i)),t=n.length;i>t;t++)o.push(a);this.handles=n.add(e(o.join("")).appendTo(this.element)),this.handle=this.handles.eq(0),this.handles.each(function(t){e(this).data("ui-slider-handle-index",t)})},_createRange:function(){var t=this.options,i="";t.range?(t.range===!0&&(t.values?t.values.length&&2!==t.values.length?t.values=[t.values[0],t.values[0]]:e.isArray(t.values)&&(t.values=t.values.slice(0)):t.values=[this._valueMin(),this._valueMin()]),this.range&&this.range.length?this.range.removeClass("ui-slider-range-min ui-slider-range-max").css({left:"",bottom:""}):(this.range=e("<div></div>").appendTo(this.element),i="ui-slider-range ui-widget-header ui-corner-all"),this.range.addClass(i+("min"===t.range||"max"===t.range?" ui-slider-range-"+t.range:""))):(this.range&&this.range.remove(),this.range=null)},_setupEvents:function(){this._off(this.handles),this._on(this.handles,this._handleEvents),this._hoverable(this.handles),this._focusable(this.handles)},_destroy:function(){this.handles.remove(),this.range&&this.range.remove(),this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-widget ui-widget-content ui-corner-all"),this._mouseDestroy()},_mouseCapture:function(t){var i,s,n,a,o,r,h,l,u=this,d=this.options;return d.disabled?!1:(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),i={x:t.pageX,y:t.pageY},s=this._normValueFromMouse(i),n=this._valueMax()-this._valueMin()+1,this.handles.each(function(t){var i=Math.abs(s-u.values(t));(n>i||n===i&&(t===u._lastChangedValue||u.values(t)===d.min))&&(n=i,a=e(this),o=t)}),r=this._start(t,o),r===!1?!1:(this._mouseSliding=!0,this._handleIndex=o,a.addClass("ui-state-active").focus(),h=a.offset(),l=!e(t.target).parents().addBack().is(".ui-slider-handle"),this._clickOffset=l?{left:0,top:0}:{left:t.pageX-h.left-a.width()/2,top:t.pageY-h.top-a.height()/2-(parseInt(a.css("borderTopWidth"),10)||0)-(parseInt(a.css("borderBottomWidth"),10)||0)+(parseInt(a.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(t,o,s),this._animateOff=!0,!0))},_mouseStart:function(){return!0},_mouseDrag:function(e){var t={x:e.pageX,y:e.pageY},i=this._normValueFromMouse(t);return this._slide(e,this._handleIndex,i),!1},_mouseStop:function(e){return this.handles.removeClass("ui-state-active"),this._mouseSliding=!1,this._stop(e,this._handleIndex),this._change(e,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1},_detectOrientation:function(){this.orientation="vertical"===this.options.orientation?"vertical":"horizontal"},_normValueFromMouse:function(e){var t,i,s,n,a;return"horizontal"===this.orientation?(t=this.elementSize.width,i=e.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(t=this.elementSize.height,i=e.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),s=i/t,s>1&&(s=1),0>s&&(s=0),"vertical"===this.orientation&&(s=1-s),n=this._valueMax()-this._valueMin(),a=this._valueMin()+s*n,this._trimAlignValue(a)},_start:function(e,t){var i={handle:this.handles[t],value:this.value()};return this.options.values&&this.options.values.length&&(i.value=this.values(t),i.values=this.values()),this._trigger("start",e,i)},_slide:function(e,t,i){var s,n,a;this.options.values&&this.options.values.length?(s=this.values(t?0:1),2===this.options.values.length&&this.options.range===!0&&(0===t&&i>s||1===t&&s>i)&&(i=s),i!==this.values(t)&&(n=this.values(),n[t]=i,a=this._trigger("slide",e,{handle:this.handles[t],value:i,values:n}),s=this.values(t?0:1),a!==!1&&this.values(t,i))):i!==this.value()&&(a=this._trigger("slide",e,{handle:this.handles[t],value:i}),a!==!1&&this.value(i))},_stop:function(e,t){var i={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(i.value=this.values(t),i.values=this.values()),this._trigger("stop",e,i)},_change:function(e,t){if(!this._keySliding&&!this._mouseSliding){var i={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(i.value=this.values(t),i.values=this.values()),this._lastChangedValue=t,this._trigger("change",e,i)}},value:function(e){return arguments.length?(this.options.value=this._trimAlignValue(e),this._refreshValue(),this._change(null,0),void 0):this._value()},values:function(t,i){var s,n,a;if(arguments.length>1)return this.options.values[t]=this._trimAlignValue(i),this._refreshValue(),this._change(null,t),void 0;if(!arguments.length)return this._values();if(!e.isArray(arguments[0]))return this.options.values&&this.options.values.length?this._values(t):this.value();for(s=this.options.values,n=arguments[0],a=0;s.length>a;a+=1)s[a]=this._trimAlignValue(n[a]),this._change(null,a);this._refreshValue()},_setOption:function(t,i){var s,n=0;switch("range"===t&&this.options.range===!0&&("min"===i?(this.options.value=this._values(0),this.options.values=null):"max"===i&&(this.options.value=this._values(this.options.values.length-1),this.options.values=null)),e.isArray(this.options.values)&&(n=this.options.values.length),"disabled"===t&&this.element.toggleClass("ui-state-disabled",!!i),this._super(t,i),t){case"orientation":this._detectOrientation(),this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation),this._refreshValue(),this.handles.css("horizontal"===i?"bottom":"left","");break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":for(this._animateOff=!0,this._refreshValue(),s=0;n>s;s+=1)this._change(null,s);this._animateOff=!1;break;case"step":case"min":case"max":this._animateOff=!0,this._calculateNewMax(),this._refreshValue(),this._animateOff=!1;break;case"range":this._animateOff=!0,this._refresh(),this._animateOff=!1}},_value:function(){var e=this.options.value;return e=this._trimAlignValue(e)},_values:function(e){var t,i,s;if(arguments.length)return t=this.options.values[e],t=this._trimAlignValue(t);if(this.options.values&&this.options.values.length){for(i=this.options.values.slice(),s=0;i.length>s;s+=1)i[s]=this._trimAlignValue(i[s]);return i}return[]},_trimAlignValue:function(e){if(this._valueMin()>=e)return this._valueMin();if(e>=this._valueMax())return this._valueMax();var t=this.options.step>0?this.options.step:1,i=(e-this._valueMin())%t,s=e-i;return 2*Math.abs(i)>=t&&(s+=i>0?t:-t),parseFloat(s.toFixed(5))},_calculateNewMax:function(){var e=(this.options.max-this._valueMin())%this.options.step;this.max=this.options.max-e},_valueMin:function(){return this.options.min},_valueMax:function(){return this.max},_refreshValue:function(){var t,i,s,n,a,o=this.options.range,r=this.options,h=this,l=this._animateOff?!1:r.animate,u={};this.options.values&&this.options.values.length?this.handles.each(function(s){i=100*((h.values(s)-h._valueMin())/(h._valueMax()-h._valueMin())),u["horizontal"===h.orientation?"left":"bottom"]=i+"%",e(this).stop(1,1)[l?"animate":"css"](u,r.animate),h.options.range===!0&&("horizontal"===h.orientation?(0===s&&h.range.stop(1,1)[l?"animate":"css"]({left:i+"%"},r.animate),1===s&&h.range[l?"animate":"css"]({width:i-t+"%"},{queue:!1,duration:r.animate})):(0===s&&h.range.stop(1,1)[l?"animate":"css"]({bottom:i+"%"},r.animate),1===s&&h.range[l?"animate":"css"]({height:i-t+"%"},{queue:!1,duration:r.animate}))),t=i}):(s=this.value(),n=this._valueMin(),a=this._valueMax(),i=a!==n?100*((s-n)/(a-n)):0,u["horizontal"===this.orientation?"left":"bottom"]=i+"%",this.handle.stop(1,1)[l?"animate":"css"](u,r.animate),"min"===o&&"horizontal"===this.orientation&&this.range.stop(1,1)[l?"animate":"css"]({width:i+"%"},r.animate),"max"===o&&"horizontal"===this.orientation&&this.range[l?"animate":"css"]({width:100-i+"%"},{queue:!1,duration:r.animate}),"min"===o&&"vertical"===this.orientation&&this.range.stop(1,1)[l?"animate":"css"]({height:i+"%"},r.animate),"max"===o&&"vertical"===this.orientation&&this.range[l?"animate":"css"]({height:100-i+"%"},{queue:!1,duration:r.animate}))},_handleEvents:{keydown:function(t){var i,s,n,a,o=e(t.target).data("ui-slider-handle-index");switch(t.keyCode){case e.ui.keyCode.HOME:case e.ui.keyCode.END:case e.ui.keyCode.PAGE_UP:case e.ui.keyCode.PAGE_DOWN:case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:if(t.preventDefault(),!this._keySliding&&(this._keySliding=!0,e(t.target).addClass("ui-state-active"),i=this._start(t,o),i===!1))return}switch(a=this.options.step,s=n=this.options.values&&this.options.values.length?this.values(o):this.value(),t.keyCode){case e.ui.keyCode.HOME:n=this._valueMin();break;case e.ui.keyCode.END:n=this._valueMax();break;case e.ui.keyCode.PAGE_UP:n=this._trimAlignValue(s+(this._valueMax()-this._valueMin())/this.numPages);break;case e.ui.keyCode.PAGE_DOWN:n=this._trimAlignValue(s-(this._valueMax()-this._valueMin())/this.numPages);break;case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:if(s===this._valueMax())return;n=this._trimAlignValue(s+a);break;case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:if(s===this._valueMin())return;n=this._trimAlignValue(s-a)}this._slide(t,o,n)},keyup:function(t){var i=e(t.target).data("ui-slider-handle-index");this._keySliding&&(this._keySliding=!1,this._stop(t,i),this._change(t,i),e(t.target).removeClass("ui-state-active"))}}}),e.widget("ui.sortable",e.ui.mouse,{version:"1.11.2",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_isOverAxis:function(e,t,i){return e>=t&&t+i>e},_isFloating:function(e){return/left|right/.test(e.css("float"))||/inline|table-cell/.test(e.css("display"))},_create:function(){var e=this.options;this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.floating=this.items.length?"x"===e.axis||this._isFloating(this.items[0].item):!1,this.offset=this.element.offset(),this._mouseInit(),this._setHandleClassName(),this.ready=!0},_setOption:function(e,t){this._super(e,t),"handle"===e&&this._setHandleClassName()},_setHandleClassName:function(){this.element.find(".ui-sortable-handle").removeClass("ui-sortable-handle"),e.each(this.items,function(){(this.instance.options.handle?this.item.find(this.instance.options.handle):this.item).addClass("ui-sortable-handle")})},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled").find(".ui-sortable-handle").removeClass("ui-sortable-handle"),this._mouseDestroy();for(var e=this.items.length-1;e>=0;e--)this.items[e].item.removeData(this.widgetName+"-item");return this},_mouseCapture:function(t,i){var s=null,n=!1,a=this;return this.reverting?!1:this.options.disabled||"static"===this.options.type?!1:(this._refreshItems(t),e(t.target).parents().each(function(){return e.data(this,a.widgetName+"-item")===a?(s=e(this),!1):void 0}),e.data(t.target,a.widgetName+"-item")===a&&(s=e(t.target)),s?!this.options.handle||i||(e(this.options.handle,s).find("*").addBack().each(function(){this===t.target&&(n=!0)}),n)?(this.currentItem=s,this._removeCurrentsFromItems(),!0):!1:!1)},_mouseStart:function(t,i,s){var n,a,o=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(t),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,o.cursorAt&&this._adjustOffsetFromHelper(o.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),o.containment&&this._setContainment(),o.cursor&&"auto"!==o.cursor&&(a=this.document.find("body"),this.storedCursor=a.css("cursor"),a.css("cursor",o.cursor),this.storedStylesheet=e("<style>*{ cursor: "+o.cursor+" !important; }</style>").appendTo(a)),o.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",o.opacity)),o.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",o.zIndex)),this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",t,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!s)for(n=this.containers.length-1;n>=0;n--)this.containers[n]._trigger("activate",t,this._uiHash(this));
return e.ui.ddmanager&&(e.ui.ddmanager.current=this),e.ui.ddmanager&&!o.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(t),!0},_mouseDrag:function(t){var i,s,n,a,o=this.options,r=!1;for(this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-t.pageY<o.scrollSensitivity?this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop+o.scrollSpeed:t.pageY-this.overflowOffset.top<o.scrollSensitivity&&(this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop-o.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-t.pageX<o.scrollSensitivity?this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft+o.scrollSpeed:t.pageX-this.overflowOffset.left<o.scrollSensitivity&&(this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft-o.scrollSpeed)):(t.pageY-e(document).scrollTop()<o.scrollSensitivity?r=e(document).scrollTop(e(document).scrollTop()-o.scrollSpeed):e(window).height()-(t.pageY-e(document).scrollTop())<o.scrollSensitivity&&(r=e(document).scrollTop(e(document).scrollTop()+o.scrollSpeed)),t.pageX-e(document).scrollLeft()<o.scrollSensitivity?r=e(document).scrollLeft(e(document).scrollLeft()-o.scrollSpeed):e(window).width()-(t.pageX-e(document).scrollLeft())<o.scrollSensitivity&&(r=e(document).scrollLeft(e(document).scrollLeft()+o.scrollSpeed))),r!==!1&&e.ui.ddmanager&&!o.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),i=this.items.length-1;i>=0;i--)if(s=this.items[i],n=s.item[0],a=this._intersectsWithPointer(s),a&&s.instance===this.currentContainer&&n!==this.currentItem[0]&&this.placeholder[1===a?"next":"prev"]()[0]!==n&&!e.contains(this.placeholder[0],n)&&("semi-dynamic"===this.options.type?!e.contains(this.element[0],n):!0)){if(this.direction=1===a?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(s))break;this._rearrange(t,s),this._trigger("change",t,this._uiHash());break}return this._contactContainers(t),e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),this._trigger("sort",t,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(t,i){if(t){if(e.ui.ddmanager&&!this.options.dropBehaviour&&e.ui.ddmanager.drop(this,t),this.options.revert){var s=this,n=this.placeholder.offset(),a=this.options.axis,o={};a&&"x"!==a||(o.left=n.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollLeft)),a&&"y"!==a||(o.top=n.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,e(this.helper).animate(o,parseInt(this.options.revert,10)||500,function(){s._clear(t)})}else this._clear(t,i);return!1}},cancel:function(){if(this.dragging){this._mouseUp({target:null}),"original"===this.options.helper?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var t=this.containers.length-1;t>=0;t--)this.containers[t]._trigger("deactivate",null,this._uiHash(this)),this.containers[t].containerCache.over&&(this.containers[t]._trigger("out",null,this._uiHash(this)),this.containers[t].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),e.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?e(this.domPosition.prev).after(this.currentItem):e(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(t){var i=this._getItemsAsjQuery(t&&t.connected),s=[];return t=t||{},e(i).each(function(){var i=(e(t.item||this).attr(t.attribute||"id")||"").match(t.expression||/(.+)[\-=_](.+)/);i&&s.push((t.key||i[1]+"[]")+"="+(t.key&&t.expression?i[1]:i[2]))}),!s.length&&t.key&&s.push(t.key+"="),s.join("&")},toArray:function(t){var i=this._getItemsAsjQuery(t&&t.connected),s=[];return t=t||{},i.each(function(){s.push(e(t.item||this).attr(t.attribute||"id")||"")}),s},_intersectsWith:function(e){var t=this.positionAbs.left,i=t+this.helperProportions.width,s=this.positionAbs.top,n=s+this.helperProportions.height,a=e.left,o=a+e.width,r=e.top,h=r+e.height,l=this.offset.click.top,u=this.offset.click.left,d="x"===this.options.axis||s+l>r&&h>s+l,c="y"===this.options.axis||t+u>a&&o>t+u,p=d&&c;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>e[this.floating?"width":"height"]?p:t+this.helperProportions.width/2>a&&o>i-this.helperProportions.width/2&&s+this.helperProportions.height/2>r&&h>n-this.helperProportions.height/2},_intersectsWithPointer:function(e){var t="x"===this.options.axis||this._isOverAxis(this.positionAbs.top+this.offset.click.top,e.top,e.height),i="y"===this.options.axis||this._isOverAxis(this.positionAbs.left+this.offset.click.left,e.left,e.width),s=t&&i,n=this._getDragVerticalDirection(),a=this._getDragHorizontalDirection();return s?this.floating?a&&"right"===a||"down"===n?2:1:n&&("down"===n?2:1):!1},_intersectsWithSides:function(e){var t=this._isOverAxis(this.positionAbs.top+this.offset.click.top,e.top+e.height/2,e.height),i=this._isOverAxis(this.positionAbs.left+this.offset.click.left,e.left+e.width/2,e.width),s=this._getDragVerticalDirection(),n=this._getDragHorizontalDirection();return this.floating&&n?"right"===n&&i||"left"===n&&!i:s&&("down"===s&&t||"up"===s&&!t)},_getDragVerticalDirection:function(){var e=this.positionAbs.top-this.lastPositionAbs.top;return 0!==e&&(e>0?"down":"up")},_getDragHorizontalDirection:function(){var e=this.positionAbs.left-this.lastPositionAbs.left;return 0!==e&&(e>0?"right":"left")},refresh:function(e){return this._refreshItems(e),this._setHandleClassName(),this.refreshPositions(),this},_connectWith:function(){var e=this.options;return e.connectWith.constructor===String?[e.connectWith]:e.connectWith},_getItemsAsjQuery:function(t){function i(){r.push(this)}var s,n,a,o,r=[],h=[],l=this._connectWith();if(l&&t)for(s=l.length-1;s>=0;s--)for(a=e(l[s]),n=a.length-1;n>=0;n--)o=e.data(a[n],this.widgetFullName),o&&o!==this&&!o.options.disabled&&h.push([e.isFunction(o.options.items)?o.options.items.call(o.element):e(o.options.items,o.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),o]);for(h.push([e.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):e(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),s=h.length-1;s>=0;s--)h[s][0].each(i);return e(r)},_removeCurrentsFromItems:function(){var t=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=e.grep(this.items,function(e){for(var i=0;t.length>i;i++)if(t[i]===e.item[0])return!1;return!0})},_refreshItems:function(t){this.items=[],this.containers=[this];var i,s,n,a,o,r,h,l,u=this.items,d=[[e.isFunction(this.options.items)?this.options.items.call(this.element[0],t,{item:this.currentItem}):e(this.options.items,this.element),this]],c=this._connectWith();if(c&&this.ready)for(i=c.length-1;i>=0;i--)for(n=e(c[i]),s=n.length-1;s>=0;s--)a=e.data(n[s],this.widgetFullName),a&&a!==this&&!a.options.disabled&&(d.push([e.isFunction(a.options.items)?a.options.items.call(a.element[0],t,{item:this.currentItem}):e(a.options.items,a.element),a]),this.containers.push(a));for(i=d.length-1;i>=0;i--)for(o=d[i][1],r=d[i][0],s=0,l=r.length;l>s;s++)h=e(r[s]),h.data(this.widgetName+"-item",o),u.push({item:h,instance:o,width:0,height:0,left:0,top:0})},refreshPositions:function(t){this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());var i,s,n,a;for(i=this.items.length-1;i>=0;i--)s=this.items[i],s.instance!==this.currentContainer&&this.currentContainer&&s.item[0]!==this.currentItem[0]||(n=this.options.toleranceElement?e(this.options.toleranceElement,s.item):s.item,t||(s.width=n.outerWidth(),s.height=n.outerHeight()),a=n.offset(),s.left=a.left,s.top=a.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(i=this.containers.length-1;i>=0;i--)a=this.containers[i].element.offset(),this.containers[i].containerCache.left=a.left,this.containers[i].containerCache.top=a.top,this.containers[i].containerCache.width=this.containers[i].element.outerWidth(),this.containers[i].containerCache.height=this.containers[i].element.outerHeight();return this},_createPlaceholder:function(t){t=t||this;var i,s=t.options;s.placeholder&&s.placeholder.constructor!==String||(i=s.placeholder,s.placeholder={element:function(){var s=t.currentItem[0].nodeName.toLowerCase(),n=e("<"+s+">",t.document[0]).addClass(i||t.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper");return"tr"===s?t.currentItem.children().each(function(){e("<td>&#160;</td>",t.document[0]).attr("colspan",e(this).attr("colspan")||1).appendTo(n)}):"img"===s&&n.attr("src",t.currentItem.attr("src")),i||n.css("visibility","hidden"),n},update:function(e,n){(!i||s.forcePlaceholderSize)&&(n.height()||n.height(t.currentItem.innerHeight()-parseInt(t.currentItem.css("paddingTop")||0,10)-parseInt(t.currentItem.css("paddingBottom")||0,10)),n.width()||n.width(t.currentItem.innerWidth()-parseInt(t.currentItem.css("paddingLeft")||0,10)-parseInt(t.currentItem.css("paddingRight")||0,10)))}}),t.placeholder=e(s.placeholder.element.call(t.element,t.currentItem)),t.currentItem.after(t.placeholder),s.placeholder.update(t,t.placeholder)},_contactContainers:function(t){var i,s,n,a,o,r,h,l,u,d,c=null,p=null;for(i=this.containers.length-1;i>=0;i--)if(!e.contains(this.currentItem[0],this.containers[i].element[0]))if(this._intersectsWith(this.containers[i].containerCache)){if(c&&e.contains(this.containers[i].element[0],c.element[0]))continue;c=this.containers[i],p=i}else this.containers[i].containerCache.over&&(this.containers[i]._trigger("out",t,this._uiHash(this)),this.containers[i].containerCache.over=0);if(c)if(1===this.containers.length)this.containers[p].containerCache.over||(this.containers[p]._trigger("over",t,this._uiHash(this)),this.containers[p].containerCache.over=1);else{for(n=1e4,a=null,u=c.floating||this._isFloating(this.currentItem),o=u?"left":"top",r=u?"width":"height",d=u?"clientX":"clientY",s=this.items.length-1;s>=0;s--)e.contains(this.containers[p].element[0],this.items[s].item[0])&&this.items[s].item[0]!==this.currentItem[0]&&(h=this.items[s].item.offset()[o],l=!1,t[d]-h>this.items[s][r]/2&&(l=!0),n>Math.abs(t[d]-h)&&(n=Math.abs(t[d]-h),a=this.items[s],this.direction=l?"up":"down"));if(!a&&!this.options.dropOnEmpty)return;if(this.currentContainer===this.containers[p])return this.currentContainer.containerCache.over||(this.containers[p]._trigger("over",t,this._uiHash()),this.currentContainer.containerCache.over=1),void 0;a?this._rearrange(t,a,null,!0):this._rearrange(t,null,this.containers[p].element,!0),this._trigger("change",t,this._uiHash()),this.containers[p]._trigger("change",t,this._uiHash(this)),this.currentContainer=this.containers[p],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[p]._trigger("over",t,this._uiHash(this)),this.containers[p].containerCache.over=1}},_createHelper:function(t){var i=this.options,s=e.isFunction(i.helper)?e(i.helper.apply(this.element[0],[t,this.currentItem])):"clone"===i.helper?this.currentItem.clone():this.currentItem;return s.parents("body").length||e("parent"!==i.appendTo?i.appendTo:this.currentItem[0].parentNode)[0].appendChild(s[0]),s[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(!s[0].style.width||i.forceHelperSize)&&s.width(this.currentItem.width()),(!s[0].style.height||i.forceHelperSize)&&s.height(this.currentItem.height()),s},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&e.ui.ie)&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var e=this.currentItem.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t,i,s,n=this.options;"parent"===n.containment&&(n.containment=this.helper[0].parentNode),("document"===n.containment||"window"===n.containment)&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,e("document"===n.containment?document:window).width()-this.helperProportions.width-this.margins.left,(e("document"===n.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(n.containment)||(t=e(n.containment)[0],i=e(n.containment).offset(),s="hidden"!==e(t).css("overflow"),this.containment=[i.left+(parseInt(e(t).css("borderLeftWidth"),10)||0)+(parseInt(e(t).css("paddingLeft"),10)||0)-this.margins.left,i.top+(parseInt(e(t).css("borderTopWidth"),10)||0)+(parseInt(e(t).css("paddingTop"),10)||0)-this.margins.top,i.left+(s?Math.max(t.scrollWidth,t.offsetWidth):t.offsetWidth)-(parseInt(e(t).css("borderLeftWidth"),10)||0)-(parseInt(e(t).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,i.top+(s?Math.max(t.scrollHeight,t.offsetHeight):t.offsetHeight)-(parseInt(e(t).css("borderTopWidth"),10)||0)-(parseInt(e(t).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(t,i){i||(i=this.position);var s="absolute"===t?1:-1,n="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,a=/(html|body)/i.test(n[0].tagName);return{top:i.top+this.offset.relative.top*s+this.offset.parent.top*s-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():a?0:n.scrollTop())*s,left:i.left+this.offset.relative.left*s+this.offset.parent.left*s-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():a?0:n.scrollLeft())*s}},_generatePosition:function(t){var i,s,n=this.options,a=t.pageX,o=t.pageY,r="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,h=/(html|body)/i.test(r[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==document&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(t.pageX-this.offset.click.left<this.containment[0]&&(a=this.containment[0]+this.offset.click.left),t.pageY-this.offset.click.top<this.containment[1]&&(o=this.containment[1]+this.offset.click.top),t.pageX-this.offset.click.left>this.containment[2]&&(a=this.containment[2]+this.offset.click.left),t.pageY-this.offset.click.top>this.containment[3]&&(o=this.containment[3]+this.offset.click.top)),n.grid&&(i=this.originalPageY+Math.round((o-this.originalPageY)/n.grid[1])*n.grid[1],o=this.containment?i-this.offset.click.top>=this.containment[1]&&i-this.offset.click.top<=this.containment[3]?i:i-this.offset.click.top>=this.containment[1]?i-n.grid[1]:i+n.grid[1]:i,s=this.originalPageX+Math.round((a-this.originalPageX)/n.grid[0])*n.grid[0],a=this.containment?s-this.offset.click.left>=this.containment[0]&&s-this.offset.click.left<=this.containment[2]?s:s-this.offset.click.left>=this.containment[0]?s-n.grid[0]:s+n.grid[0]:s)),{top:o-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():h?0:r.scrollTop()),left:a-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():h?0:r.scrollLeft())}},_rearrange:function(e,t,i,s){i?i[0].appendChild(this.placeholder[0]):t.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?t.item[0]:t.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var n=this.counter;this._delay(function(){n===this.counter&&this.refreshPositions(!s)})},_clear:function(e,t){function i(e,t,i){return function(s){i._trigger(e,s,t._uiHash(t))}}this.reverting=!1;var s,n=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(s in this._storedCSS)("auto"===this._storedCSS[s]||"static"===this._storedCSS[s])&&(this._storedCSS[s]="");this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();for(this.fromOutside&&!t&&n.push(function(e){this._trigger("receive",e,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||t||n.push(function(e){this._trigger("update",e,this._uiHash())}),this!==this.currentContainer&&(t||(n.push(function(e){this._trigger("remove",e,this._uiHash())}),n.push(function(e){return function(t){e._trigger("receive",t,this._uiHash(this))}}.call(this,this.currentContainer)),n.push(function(e){return function(t){e._trigger("update",t,this._uiHash(this))}}.call(this,this.currentContainer)))),s=this.containers.length-1;s>=0;s--)t||n.push(i("deactivate",this,this.containers[s])),this.containers[s].containerCache.over&&(n.push(i("out",this,this.containers[s])),this.containers[s].containerCache.over=0);if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,t||this._trigger("beforeStop",e,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.cancelHelperRemoval||(this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null),!t){for(s=0;n.length>s;s++)n[s].call(this,e);this._trigger("stop",e,this._uiHash())}return this.fromOutside=!1,!this.cancelHelperRemoval},_trigger:function(){e.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(t){var i=t||this;return{helper:i.helper,placeholder:i.placeholder||e([]),position:i.position,originalPosition:i.originalPosition,offset:i.positionAbs,item:i.currentItem,sender:t?t.element:null}}}),e.widget("ui.spinner",{version:"1.11.2",defaultElement:"<input>",widgetEventPrefix:"spin",options:{culture:null,icons:{down:"ui-icon-triangle-1-s",up:"ui-icon-triangle-1-n"},incremental:!0,max:null,min:null,numberFormat:null,page:10,step:1,change:null,spin:null,start:null,stop:null},_create:function(){this._setOption("max",this.options.max),this._setOption("min",this.options.min),this._setOption("step",this.options.step),""!==this.value()&&this._value(this.element.val(),!0),this._draw(),this._on(this._events),this._refresh(),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_getCreateOptions:function(){var t={},i=this.element;return e.each(["min","max","step"],function(e,s){var n=i.attr(s);void 0!==n&&n.length&&(t[s]=n)}),t},_events:{keydown:function(e){this._start(e)&&this._keydown(e)&&e.preventDefault()},keyup:"_stop",focus:function(){this.previous=this.element.val()},blur:function(e){return this.cancelBlur?(delete this.cancelBlur,void 0):(this._stop(),this._refresh(),this.previous!==this.element.val()&&this._trigger("change",e),void 0)},mousewheel:function(e,t){if(t){if(!this.spinning&&!this._start(e))return!1;this._spin((t>0?1:-1)*this.options.step,e),clearTimeout(this.mousewheelTimer),this.mousewheelTimer=this._delay(function(){this.spinning&&this._stop(e)},100),e.preventDefault()}},"mousedown .ui-spinner-button":function(t){function i(){var e=this.element[0]===this.document[0].activeElement;e||(this.element.focus(),this.previous=s,this._delay(function(){this.previous=s}))}var s;s=this.element[0]===this.document[0].activeElement?this.previous:this.element.val(),t.preventDefault(),i.call(this),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur,i.call(this)}),this._start(t)!==!1&&this._repeat(null,e(t.currentTarget).hasClass("ui-spinner-up")?1:-1,t)},"mouseup .ui-spinner-button":"_stop","mouseenter .ui-spinner-button":function(t){return e(t.currentTarget).hasClass("ui-state-active")?this._start(t)===!1?!1:(this._repeat(null,e(t.currentTarget).hasClass("ui-spinner-up")?1:-1,t),void 0):void 0},"mouseleave .ui-spinner-button":"_stop"},_draw:function(){var e=this.uiSpinner=this.element.addClass("ui-spinner-input").attr("autocomplete","off").wrap(this._uiSpinnerHtml()).parent().append(this._buttonHtml());this.element.attr("role","spinbutton"),this.buttons=e.find(".ui-spinner-button").attr("tabIndex",-1).button().removeClass("ui-corner-all"),this.buttons.height()>Math.ceil(.5*e.height())&&e.height()>0&&e.height(e.height()),this.options.disabled&&this.disable()},_keydown:function(t){var i=this.options,s=e.ui.keyCode;switch(t.keyCode){case s.UP:return this._repeat(null,1,t),!0;case s.DOWN:return this._repeat(null,-1,t),!0;case s.PAGE_UP:return this._repeat(null,i.page,t),!0;case s.PAGE_DOWN:return this._repeat(null,-i.page,t),!0}return!1},_uiSpinnerHtml:function(){return"<span class='ui-spinner ui-widget ui-widget-content ui-corner-all'></span>"},_buttonHtml:function(){return"<a class='ui-spinner-button ui-spinner-up ui-corner-tr'><span class='ui-icon "+this.options.icons.up+"'>&#9650;</span>"+"</a>"+"<a class='ui-spinner-button ui-spinner-down ui-corner-br'>"+"<span class='ui-icon "+this.options.icons.down+"'>&#9660;</span>"+"</a>"},_start:function(e){return this.spinning||this._trigger("start",e)!==!1?(this.counter||(this.counter=1),this.spinning=!0,!0):!1},_repeat:function(e,t,i){e=e||500,clearTimeout(this.timer),this.timer=this._delay(function(){this._repeat(40,t,i)},e),this._spin(t*this.options.step,i)},_spin:function(e,t){var i=this.value()||0;this.counter||(this.counter=1),i=this._adjustValue(i+e*this._increment(this.counter)),this.spinning&&this._trigger("spin",t,{value:i})===!1||(this._value(i),this.counter++)},_increment:function(t){var i=this.options.incremental;return i?e.isFunction(i)?i(t):Math.floor(t*t*t/5e4-t*t/500+17*t/200+1):1},_precision:function(){var e=this._precisionOf(this.options.step);return null!==this.options.min&&(e=Math.max(e,this._precisionOf(this.options.min))),e},_precisionOf:function(e){var t=""+e,i=t.indexOf(".");return-1===i?0:t.length-i-1},_adjustValue:function(e){var t,i,s=this.options;return t=null!==s.min?s.min:0,i=e-t,i=Math.round(i/s.step)*s.step,e=t+i,e=parseFloat(e.toFixed(this._precision())),null!==s.max&&e>s.max?s.max:null!==s.min&&s.min>e?s.min:e},_stop:function(e){this.spinning&&(clearTimeout(this.timer),clearTimeout(this.mousewheelTimer),this.counter=0,this.spinning=!1,this._trigger("stop",e))},_setOption:function(e,t){if("culture"===e||"numberFormat"===e){var i=this._parse(this.element.val());return this.options[e]=t,this.element.val(this._format(i)),void 0}("max"===e||"min"===e||"step"===e)&&"string"==typeof t&&(t=this._parse(t)),"icons"===e&&(this.buttons.first().find(".ui-icon").removeClass(this.options.icons.up).addClass(t.up),this.buttons.last().find(".ui-icon").removeClass(this.options.icons.down).addClass(t.down)),this._super(e,t),"disabled"===e&&(this.widget().toggleClass("ui-state-disabled",!!t),this.element.prop("disabled",!!t),this.buttons.button(t?"disable":"enable"))},_setOptions:h(function(e){this._super(e)}),_parse:function(e){return"string"==typeof e&&""!==e&&(e=window.Globalize&&this.options.numberFormat?Globalize.parseFloat(e,10,this.options.culture):+e),""===e||isNaN(e)?null:e},_format:function(e){return""===e?"":window.Globalize&&this.options.numberFormat?Globalize.format(e,this.options.numberFormat,this.options.culture):e},_refresh:function(){this.element.attr({"aria-valuemin":this.options.min,"aria-valuemax":this.options.max,"aria-valuenow":this._parse(this.element.val())})},isValid:function(){var e=this.value();return null===e?!1:e===this._adjustValue(e)},_value:function(e,t){var i;""!==e&&(i=this._parse(e),null!==i&&(t||(i=this._adjustValue(i)),e=this._format(i))),this.element.val(e),this._refresh()},_destroy:function(){this.element.removeClass("ui-spinner-input").prop("disabled",!1).removeAttr("autocomplete").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow"),this.uiSpinner.replaceWith(this.element)},stepUp:h(function(e){this._stepUp(e)}),_stepUp:function(e){this._start()&&(this._spin((e||1)*this.options.step),this._stop())},stepDown:h(function(e){this._stepDown(e)}),_stepDown:function(e){this._start()&&(this._spin((e||1)*-this.options.step),this._stop())},pageUp:h(function(e){this._stepUp((e||1)*this.options.page)}),pageDown:h(function(e){this._stepDown((e||1)*this.options.page)}),value:function(e){return arguments.length?(h(this._value).call(this,e),void 0):this._parse(this.element.val())},widget:function(){return this.uiSpinner}}),e.widget("ui.tabs",{version:"1.11.2",delay:300,options:{active:null,collapsible:!1,event:"click",heightStyle:"content",hide:null,show:null,activate:null,beforeActivate:null,beforeLoad:null,load:null},_isLocal:function(){var e=/#.*$/;return function(t){var i,s;t=t.cloneNode(!1),i=t.href.replace(e,""),s=location.href.replace(e,"");try{i=decodeURIComponent(i)}catch(n){}try{s=decodeURIComponent(s)}catch(n){}return t.hash.length>1&&i===s}}(),_create:function(){var t=this,i=this.options;this.running=!1,this.element.addClass("ui-tabs ui-widget ui-widget-content ui-corner-all").toggleClass("ui-tabs-collapsible",i.collapsible),this._processTabs(),i.active=this._initialActive(),e.isArray(i.disabled)&&(i.disabled=e.unique(i.disabled.concat(e.map(this.tabs.filter(".ui-state-disabled"),function(e){return t.tabs.index(e)}))).sort()),this.active=this.options.active!==!1&&this.anchors.length?this._findActive(i.active):e(),this._refresh(),this.active.length&&this.load(i.active)},_initialActive:function(){var t=this.options.active,i=this.options.collapsible,s=location.hash.substring(1);return null===t&&(s&&this.tabs.each(function(i,n){return e(n).attr("aria-controls")===s?(t=i,!1):void 0}),null===t&&(t=this.tabs.index(this.tabs.filter(".ui-tabs-active"))),(null===t||-1===t)&&(t=this.tabs.length?0:!1)),t!==!1&&(t=this.tabs.index(this.tabs.eq(t)),-1===t&&(t=i?!1:0)),!i&&t===!1&&this.anchors.length&&(t=0),t},_getCreateEventData:function(){return{tab:this.active,panel:this.active.length?this._getPanelForTab(this.active):e()}},_tabKeydown:function(t){var i=e(this.document[0].activeElement).closest("li"),s=this.tabs.index(i),n=!0;if(!this._handlePageNav(t)){switch(t.keyCode){case e.ui.keyCode.RIGHT:case e.ui.keyCode.DOWN:s++;break;case e.ui.keyCode.UP:case e.ui.keyCode.LEFT:n=!1,s--;break;case e.ui.keyCode.END:s=this.anchors.length-1;break;case e.ui.keyCode.HOME:s=0;break;case e.ui.keyCode.SPACE:return t.preventDefault(),clearTimeout(this.activating),this._activate(s),void 0;case e.ui.keyCode.ENTER:return t.preventDefault(),clearTimeout(this.activating),this._activate(s===this.options.active?!1:s),void 0;default:return}t.preventDefault(),clearTimeout(this.activating),s=this._focusNextTab(s,n),t.ctrlKey||(i.attr("aria-selected","false"),this.tabs.eq(s).attr("aria-selected","true"),this.activating=this._delay(function(){this.option("active",s)},this.delay))}},_panelKeydown:function(t){this._handlePageNav(t)||t.ctrlKey&&t.keyCode===e.ui.keyCode.UP&&(t.preventDefault(),this.active.focus())},_handlePageNav:function(t){return t.altKey&&t.keyCode===e.ui.keyCode.PAGE_UP?(this._activate(this._focusNextTab(this.options.active-1,!1)),!0):t.altKey&&t.keyCode===e.ui.keyCode.PAGE_DOWN?(this._activate(this._focusNextTab(this.options.active+1,!0)),!0):void 0},_findNextTab:function(t,i){function s(){return t>n&&(t=0),0>t&&(t=n),t}for(var n=this.tabs.length-1;-1!==e.inArray(s(),this.options.disabled);)t=i?t+1:t-1;return t},_focusNextTab:function(e,t){return e=this._findNextTab(e,t),this.tabs.eq(e).focus(),e},_setOption:function(e,t){return"active"===e?(this._activate(t),void 0):"disabled"===e?(this._setupDisabled(t),void 0):(this._super(e,t),"collapsible"===e&&(this.element.toggleClass("ui-tabs-collapsible",t),t||this.options.active!==!1||this._activate(0)),"event"===e&&this._setupEvents(t),"heightStyle"===e&&this._setupHeightStyle(t),void 0)},_sanitizeSelector:function(e){return e?e.replace(/[!"$%&'()*+,.\/:;<=>?@\[\]\^`{|}~]/g,"\\$&"):""},refresh:function(){var t=this.options,i=this.tablist.children(":has(a[href])");t.disabled=e.map(i.filter(".ui-state-disabled"),function(e){return i.index(e)}),this._processTabs(),t.active!==!1&&this.anchors.length?this.active.length&&!e.contains(this.tablist[0],this.active[0])?this.tabs.length===t.disabled.length?(t.active=!1,this.active=e()):this._activate(this._findNextTab(Math.max(0,t.active-1),!1)):t.active=this.tabs.index(this.active):(t.active=!1,this.active=e()),this._refresh()},_refresh:function(){this._setupDisabled(this.options.disabled),this._setupEvents(this.options.event),this._setupHeightStyle(this.options.heightStyle),this.tabs.not(this.active).attr({"aria-selected":"false","aria-expanded":"false",tabIndex:-1}),this.panels.not(this._getPanelForTab(this.active)).hide().attr({"aria-hidden":"true"}),this.active.length?(this.active.addClass("ui-tabs-active ui-state-active").attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0}),this._getPanelForTab(this.active).show().attr({"aria-hidden":"false"})):this.tabs.eq(0).attr("tabIndex",0)},_processTabs:function(){var t=this,i=this.tabs,s=this.anchors,n=this.panels;this.tablist=this._getList().addClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").attr("role","tablist").delegate("> li","mousedown"+this.eventNamespace,function(t){e(this).is(".ui-state-disabled")&&t.preventDefault()}).delegate(".ui-tabs-anchor","focus"+this.eventNamespace,function(){e(this).closest("li").is(".ui-state-disabled")&&this.blur()}),this.tabs=this.tablist.find("> li:has(a[href])").addClass("ui-state-default ui-corner-top").attr({role:"tab",tabIndex:-1}),this.anchors=this.tabs.map(function(){return e("a",this)[0]
}).addClass("ui-tabs-anchor").attr({role:"presentation",tabIndex:-1}),this.panels=e(),this.anchors.each(function(i,s){var n,a,o,r=e(s).uniqueId().attr("id"),h=e(s).closest("li"),l=h.attr("aria-controls");t._isLocal(s)?(n=s.hash,o=n.substring(1),a=t.element.find(t._sanitizeSelector(n))):(o=h.attr("aria-controls")||e({}).uniqueId()[0].id,n="#"+o,a=t.element.find(n),a.length||(a=t._createPanel(o),a.insertAfter(t.panels[i-1]||t.tablist)),a.attr("aria-live","polite")),a.length&&(t.panels=t.panels.add(a)),l&&h.data("ui-tabs-aria-controls",l),h.attr({"aria-controls":o,"aria-labelledby":r}),a.attr("aria-labelledby",r)}),this.panels.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").attr("role","tabpanel"),i&&(this._off(i.not(this.tabs)),this._off(s.not(this.anchors)),this._off(n.not(this.panels)))},_getList:function(){return this.tablist||this.element.find("ol,ul").eq(0)},_createPanel:function(t){return e("<div>").attr("id",t).addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").data("ui-tabs-destroy",!0)},_setupDisabled:function(t){e.isArray(t)&&(t.length?t.length===this.anchors.length&&(t=!0):t=!1);for(var i,s=0;i=this.tabs[s];s++)t===!0||-1!==e.inArray(s,t)?e(i).addClass("ui-state-disabled").attr("aria-disabled","true"):e(i).removeClass("ui-state-disabled").removeAttr("aria-disabled");this.options.disabled=t},_setupEvents:function(t){var i={};t&&e.each(t.split(" "),function(e,t){i[t]="_eventHandler"}),this._off(this.anchors.add(this.tabs).add(this.panels)),this._on(!0,this.anchors,{click:function(e){e.preventDefault()}}),this._on(this.anchors,i),this._on(this.tabs,{keydown:"_tabKeydown"}),this._on(this.panels,{keydown:"_panelKeydown"}),this._focusable(this.tabs),this._hoverable(this.tabs)},_setupHeightStyle:function(t){var i,s=this.element.parent();"fill"===t?(i=s.height(),i-=this.element.outerHeight()-this.element.height(),this.element.siblings(":visible").each(function(){var t=e(this),s=t.css("position");"absolute"!==s&&"fixed"!==s&&(i-=t.outerHeight(!0))}),this.element.children().not(this.panels).each(function(){i-=e(this).outerHeight(!0)}),this.panels.each(function(){e(this).height(Math.max(0,i-e(this).innerHeight()+e(this).height()))}).css("overflow","auto")):"auto"===t&&(i=0,this.panels.each(function(){i=Math.max(i,e(this).height("").height())}).height(i))},_eventHandler:function(t){var i=this.options,s=this.active,n=e(t.currentTarget),a=n.closest("li"),o=a[0]===s[0],r=o&&i.collapsible,h=r?e():this._getPanelForTab(a),l=s.length?this._getPanelForTab(s):e(),u={oldTab:s,oldPanel:l,newTab:r?e():a,newPanel:h};t.preventDefault(),a.hasClass("ui-state-disabled")||a.hasClass("ui-tabs-loading")||this.running||o&&!i.collapsible||this._trigger("beforeActivate",t,u)===!1||(i.active=r?!1:this.tabs.index(a),this.active=o?e():a,this.xhr&&this.xhr.abort(),l.length||h.length||e.error("jQuery UI Tabs: Mismatching fragment identifier."),h.length&&this.load(this.tabs.index(a),t),this._toggle(t,u))},_toggle:function(t,i){function s(){a.running=!1,a._trigger("activate",t,i)}function n(){i.newTab.closest("li").addClass("ui-tabs-active ui-state-active"),o.length&&a.options.show?a._show(o,a.options.show,s):(o.show(),s())}var a=this,o=i.newPanel,r=i.oldPanel;this.running=!0,r.length&&this.options.hide?this._hide(r,this.options.hide,function(){i.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"),n()}):(i.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"),r.hide(),n()),r.attr("aria-hidden","true"),i.oldTab.attr({"aria-selected":"false","aria-expanded":"false"}),o.length&&r.length?i.oldTab.attr("tabIndex",-1):o.length&&this.tabs.filter(function(){return 0===e(this).attr("tabIndex")}).attr("tabIndex",-1),o.attr("aria-hidden","false"),i.newTab.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0})},_activate:function(t){var i,s=this._findActive(t);s[0]!==this.active[0]&&(s.length||(s=this.active),i=s.find(".ui-tabs-anchor")[0],this._eventHandler({target:i,currentTarget:i,preventDefault:e.noop}))},_findActive:function(t){return t===!1?e():this.tabs.eq(t)},_getIndex:function(e){return"string"==typeof e&&(e=this.anchors.index(this.anchors.filter("[href$='"+e+"']"))),e},_destroy:function(){this.xhr&&this.xhr.abort(),this.element.removeClass("ui-tabs ui-widget ui-widget-content ui-corner-all ui-tabs-collapsible"),this.tablist.removeClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").removeAttr("role"),this.anchors.removeClass("ui-tabs-anchor").removeAttr("role").removeAttr("tabIndex").removeUniqueId(),this.tablist.unbind(this.eventNamespace),this.tabs.add(this.panels).each(function(){e.data(this,"ui-tabs-destroy")?e(this).remove():e(this).removeClass("ui-state-default ui-state-active ui-state-disabled ui-corner-top ui-corner-bottom ui-widget-content ui-tabs-active ui-tabs-panel").removeAttr("tabIndex").removeAttr("aria-live").removeAttr("aria-busy").removeAttr("aria-selected").removeAttr("aria-labelledby").removeAttr("aria-hidden").removeAttr("aria-expanded").removeAttr("role")}),this.tabs.each(function(){var t=e(this),i=t.data("ui-tabs-aria-controls");i?t.attr("aria-controls",i).removeData("ui-tabs-aria-controls"):t.removeAttr("aria-controls")}),this.panels.show(),"content"!==this.options.heightStyle&&this.panels.css("height","")},enable:function(t){var i=this.options.disabled;i!==!1&&(void 0===t?i=!1:(t=this._getIndex(t),i=e.isArray(i)?e.map(i,function(e){return e!==t?e:null}):e.map(this.tabs,function(e,i){return i!==t?i:null})),this._setupDisabled(i))},disable:function(t){var i=this.options.disabled;if(i!==!0){if(void 0===t)i=!0;else{if(t=this._getIndex(t),-1!==e.inArray(t,i))return;i=e.isArray(i)?e.merge([t],i).sort():[t]}this._setupDisabled(i)}},load:function(t,i){t=this._getIndex(t);var s=this,n=this.tabs.eq(t),a=n.find(".ui-tabs-anchor"),o=this._getPanelForTab(n),r={tab:n,panel:o};this._isLocal(a[0])||(this.xhr=e.ajax(this._ajaxSettings(a,i,r)),this.xhr&&"canceled"!==this.xhr.statusText&&(n.addClass("ui-tabs-loading"),o.attr("aria-busy","true"),this.xhr.success(function(e){setTimeout(function(){o.html(e),s._trigger("load",i,r)},1)}).complete(function(e,t){setTimeout(function(){"abort"===t&&s.panels.stop(!1,!0),n.removeClass("ui-tabs-loading"),o.removeAttr("aria-busy"),e===s.xhr&&delete s.xhr},1)})))},_ajaxSettings:function(t,i,s){var n=this;return{url:t.attr("href"),beforeSend:function(t,a){return n._trigger("beforeLoad",i,e.extend({jqXHR:t,ajaxSettings:a},s))}}},_getPanelForTab:function(t){var i=e(t).attr("aria-controls");return this.element.find(this._sanitizeSelector("#"+i))}}),e.widget("ui.tooltip",{version:"1.11.2",options:{content:function(){var t=e(this).attr("title")||"";return e("<a>").text(t).html()},hide:!0,items:"[title]:not([disabled])",position:{my:"left top+15",at:"left bottom",collision:"flipfit flip"},show:!0,tooltipClass:null,track:!1,close:null,open:null},_addDescribedBy:function(t,i){var s=(t.attr("aria-describedby")||"").split(/\s+/);s.push(i),t.data("ui-tooltip-id",i).attr("aria-describedby",e.trim(s.join(" ")))},_removeDescribedBy:function(t){var i=t.data("ui-tooltip-id"),s=(t.attr("aria-describedby")||"").split(/\s+/),n=e.inArray(i,s);-1!==n&&s.splice(n,1),t.removeData("ui-tooltip-id"),s=e.trim(s.join(" ")),s?t.attr("aria-describedby",s):t.removeAttr("aria-describedby")},_create:function(){this._on({mouseover:"open",focusin:"open"}),this.tooltips={},this.parents={},this.options.disabled&&this._disable(),this.liveRegion=e("<div>").attr({role:"log","aria-live":"assertive","aria-relevant":"additions"}).addClass("ui-helper-hidden-accessible").appendTo(this.document[0].body)},_setOption:function(t,i){var s=this;return"disabled"===t?(this[i?"_disable":"_enable"](),this.options[t]=i,void 0):(this._super(t,i),"content"===t&&e.each(this.tooltips,function(e,t){s._updateContent(t.element)}),void 0)},_disable:function(){var t=this;e.each(this.tooltips,function(i,s){var n=e.Event("blur");n.target=n.currentTarget=s.element[0],t.close(n,!0)}),this.element.find(this.options.items).addBack().each(function(){var t=e(this);t.is("[title]")&&t.data("ui-tooltip-title",t.attr("title")).removeAttr("title")})},_enable:function(){this.element.find(this.options.items).addBack().each(function(){var t=e(this);t.data("ui-tooltip-title")&&t.attr("title",t.data("ui-tooltip-title"))})},open:function(t){var i=this,s=e(t?t.target:this.element).closest(this.options.items);s.length&&!s.data("ui-tooltip-id")&&(s.attr("title")&&s.data("ui-tooltip-title",s.attr("title")),s.data("ui-tooltip-open",!0),t&&"mouseover"===t.type&&s.parents().each(function(){var t,s=e(this);s.data("ui-tooltip-open")&&(t=e.Event("blur"),t.target=t.currentTarget=this,i.close(t,!0)),s.attr("title")&&(s.uniqueId(),i.parents[this.id]={element:this,title:s.attr("title")},s.attr("title",""))}),this._updateContent(s,t))},_updateContent:function(e,t){var i,s=this.options.content,n=this,a=t?t.type:null;return"string"==typeof s?this._open(t,e,s):(i=s.call(e[0],function(i){e.data("ui-tooltip-open")&&n._delay(function(){t&&(t.type=a),this._open(t,e,i)})}),i&&this._open(t,e,i),void 0)},_open:function(t,i,s){function n(e){u.of=e,o.is(":hidden")||o.position(u)}var a,o,r,h,l,u=e.extend({},this.options.position);if(s){if(a=this._find(i))return a.tooltip.find(".ui-tooltip-content").html(s),void 0;i.is("[title]")&&(t&&"mouseover"===t.type?i.attr("title",""):i.removeAttr("title")),a=this._tooltip(i),o=a.tooltip,this._addDescribedBy(i,o.attr("id")),o.find(".ui-tooltip-content").html(s),this.liveRegion.children().hide(),s.clone?(l=s.clone(),l.removeAttr("id").find("[id]").removeAttr("id")):l=s,e("<div>").html(l).appendTo(this.liveRegion),this.options.track&&t&&/^mouse/.test(t.type)?(this._on(this.document,{mousemove:n}),n(t)):o.position(e.extend({of:i},this.options.position)),o.hide(),this._show(o,this.options.show),this.options.show&&this.options.show.delay&&(h=this.delayedShow=setInterval(function(){o.is(":visible")&&(n(u.of),clearInterval(h))},e.fx.interval)),this._trigger("open",t,{tooltip:o}),r={keyup:function(t){if(t.keyCode===e.ui.keyCode.ESCAPE){var s=e.Event(t);s.currentTarget=i[0],this.close(s,!0)}}},i[0]!==this.element[0]&&(r.remove=function(){this._removeTooltip(o)}),t&&"mouseover"!==t.type||(r.mouseleave="close"),t&&"focusin"!==t.type||(r.focusout="close"),this._on(!0,i,r)}},close:function(t){var i,s=this,n=e(t?t.currentTarget:this.element),a=this._find(n);a&&(i=a.tooltip,a.closing||(clearInterval(this.delayedShow),n.data("ui-tooltip-title")&&!n.attr("title")&&n.attr("title",n.data("ui-tooltip-title")),this._removeDescribedBy(n),a.hiding=!0,i.stop(!0),this._hide(i,this.options.hide,function(){s._removeTooltip(e(this))}),n.removeData("ui-tooltip-open"),this._off(n,"mouseleave focusout keyup"),n[0]!==this.element[0]&&this._off(n,"remove"),this._off(this.document,"mousemove"),t&&"mouseleave"===t.type&&e.each(this.parents,function(t,i){e(i.element).attr("title",i.title),delete s.parents[t]}),a.closing=!0,this._trigger("close",t,{tooltip:i}),a.hiding||(a.closing=!1)))},_tooltip:function(t){var i=e("<div>").attr("role","tooltip").addClass("ui-tooltip ui-widget ui-corner-all ui-widget-content "+(this.options.tooltipClass||"")),s=i.uniqueId().attr("id");return e("<div>").addClass("ui-tooltip-content").appendTo(i),i.appendTo(this.document[0].body),this.tooltips[s]={element:t,tooltip:i}},_find:function(e){var t=e.data("ui-tooltip-id");return t?this.tooltips[t]:null},_removeTooltip:function(e){e.remove(),delete this.tooltips[e.attr("id")]},_destroy:function(){var t=this;e.each(this.tooltips,function(i,s){var n=e.Event("blur"),a=s.element;n.target=n.currentTarget=a[0],t.close(n,!0),e("#"+i).remove(),a.data("ui-tooltip-title")&&(a.attr("title")||a.attr("title",a.data("ui-tooltip-title")),a.removeData("ui-tooltip-title"))}),this.liveRegion.remove()}})});
///#source 1 1 Plugins/jquery-te-1.4.0.min.js
/*!
 *
 * jQuery TE 1.4.0 , http://jqueryte.com/
 * Copyright (C) 2013, Fatih Koca (fattih@fattih.com), (http://jqueryte.com/about)

 * jQuery TE is provided under the MIT LICENSE.
 *
*/
(function(e){e.fn.jqte=function(t){function l(e,t,n,r,i){var s=f.length+1;return f.push({name:e,cls:s,command:t,key:n,tag:r,emphasis:i})}var n=[{title:"Text Format"},{title:"Font Size"},{title:"Color"},{title:"Bold",hotkey:"B"},{title:"Italic",hotkey:"I"},{title:"Underline",hotkey:"U"},{title:"Ordered List",hotkey:"."},{title:"Unordered List",hotkey:","},{title:"Subscript",hotkey:"down arrow"},{title:"Superscript",hotkey:"up arrow"},{title:"Outdent",hotkey:"left arrow"},{title:"Indent",hotkey:"right arrow"},{title:"Justify Left"},{title:"Justify Center"},{title:"Justify Right"},{title:"Strike Through",hotkey:"K"},{title:"Add Link",hotkey:"L"},{title:"Remove Link"},{title:"Cleaner Style",hotkey:"Delete"},{title:"Horizontal Rule",hotkey:"H"},{title:"Source"}];var r=[["p","Normal"],["h1","Header 1"],["h2","Header 2"],["h3","Header 3"],["h4","Header 4"],["h5","Header 5"],["h6","Header 6"],["pre","Preformatted"]];var i=["10","12","16","18","20","24","28"];var s=["0,0,0","68,68,68","102,102,102","153,153,153","204,204,204","238,238,238","243,243,243","255,255,255",null,"255,0,0","255,153,0","255,255,0","0,255,0","0,255,255","0,0,255","153,0,255","255,0,255",null,"244,204,204","252,229,205","255,242,204","217,234,211","208,224,227","207,226,243","217,210,233","234,209,220","234,153,153","249,203,156","255,229,153","182,215,168","162,196,201","159,197,232","180,167,214","213,166,189","224,102,102","246,178,107","255,217,102","147,196,125","118,165,175","111,168,220","142,124,195","194,123,160","204,0,0","230,145,56","241,194,50","106,168,79","69,129,142","61,133,198","103,78,167","166,77,121","153,0,0","180,95,6","191,144,0","56,118,29","19,79,92","11,83,148","53,28,117","116,27,71","102,0,0","120,63,4","127,96,0","39,78,19","12,52,61","7,55,99","32,18,77","76,17,48"];var o=["Web Address","E-mail Address","Picture URL"];var u=e.extend({status:true,css:"jqte",title:true,titletext:n,button:"OK",format:true,formats:r,fsize:true,fsizes:i,funit:"px",color:true,linktypes:o,b:true,i:true,u:true,ol:true,ul:true,sub:true,sup:true,outdent:true,indent:true,left:true,center:true,right:true,strike:true,link:true,unlink:true,remove:true,rule:true,source:true,placeholder:false,br:true,p:true,change:"",focus:"",blur:""},t);e.fn.jqteVal=function(t){e(this).closest("."+u.css).find("."+u.css+"_editor").html(t)};var a=navigator.userAgent.toLowerCase();if(/msie [1-7]./.test(a))u.title=false;var f=[];l("format","formats","","",false);l("fsize","fSize","","",false);l("color","colors","","",false);l("b","Bold","B",["b","strong"],true);l("i","Italic","I",["i","em"],true);l("u","Underline","U",["u"],true);l("ol","insertorderedlist","¾",["ol"],true);l("ul","insertunorderedlist","¼",["ul"],true);l("sub","subscript","(",["sub"],true);l("sup","superscript","&",["sup"],true);l("outdent","outdent","%",["blockquote"],false);l("indent","indent","'",["blockquote"],true);l("left","justifyLeft","","",false);l("center","justifyCenter","","",false);l("right","justifyRight","","",false);l("strike","strikeThrough","K",["strike"],true);l("link","linkcreator","L",["a"],true);l("unlink","unlink","",["a"],false);l("remove","removeformat",".","",false);l("rule","inserthorizontalrule","H",["hr"],false);l("source","displaysource","","",false);return this.each(function(){function B(){if(window.getSelection)return window.getSelection();else if(document.selection&&document.selection.createRange&&document.selection.type!="None")return document.selection.createRange()}function j(e,t){var n,r=B();if(window.getSelection){if(r.anchorNode&&r.getRangeAt)n=r.getRangeAt(0);if(n){r.removeAllRanges();r.addRange(n)}if(!a.match(/msie/))document.execCommand("StyleWithCSS",false,false);document.execCommand(e,false,t)}else if(document.selection&&document.selection.createRange&&document.selection.type!="None"){n=document.selection.createRange();n.execCommand(e,false,t)}q(false,false)}function F(t,n,r){if(v.not(":focus"))v.focus();if(window.getSelection){var i=B(),s,o,u;if(i.anchorNode&&i.getRangeAt){s=i.getRangeAt(0);o=document.createElement(t);e(o).attr(n,r);u=s.extractContents();o.appendChild(u);s.insertNode(o);i.removeAllRanges();if(n=="style")q(e(o),r);else q(e(o),false)}}else if(document.selection&&document.selection.createRange&&document.selection.type!="None"){var a=document.selection.createRange();var f=a.htmlText;var l="<"+t+" "+n+'="'+r+'">'+f+"</"+t+">";document.selection.createRange().pasteHTML(l)}}function q(e,t){var n=I();n=n?n:e;if(n&&t==false){if(n.parent().is("[style]"))n.attr("style",n.parent().attr("style"));if(n.is("[style]"))n.find("*").attr("style",n.attr("style"))}else if(e&&t&&e.is("[style]")){var r=t.split(";");r=r[0].split(":");if(e.is("[style*="+r[0]+"]"))e.find("*").css(r[0],r[1]);R(e)}}function R(t){if(t){var t=t[0];if(document.body.createTextRange){var n=document.body.createTextRange();n.moveToElementText(t);n.select()}else if(window.getSelection){var r=window.getSelection();var n=document.createRange();if(t!="undefined"&&t!=null){n.selectNodeContents(t);r.removeAllRanges();r.addRange(n);if(e(t).is(":empty")){e(t).append(" ");R(e(t))}}}}}function U(){if(!p.data("sourceOpened")){var t=I();var n="http://";W(true);if(t){var r=t.prop("tagName").toLowerCase();if(r=="a"&&t.is("[href]")){n=t.attr("href");t.attr(S,"")}else F("a",S,"")}else y.val(n).focus();g.click(function(t){if(e(t.target).hasClass(u.css+"_linktypetext")||e(t.target).hasClass(u.css+"_linktypearrow"))X(true)});w.find("a").click(function(){var t=e(this).attr(u.css+"-linktype");w.data("linktype",t);E.find("."+u.css+"_linktypetext").html(w.find("a:eq("+w.data("linktype")+")").text());V(n);X()});V(n);y.focus().val(n).bind("keypress keyup",function(e){if(e.keyCode==13){z(h.find("["+S+"]"));return false}});b.click(function(){z(h.find("["+S+"]"))})}else W(false)}function z(t){y.focus();R(t);t.removeAttr(S);if(w.data("linktype")!="2")j("createlink",y.val());else{j("insertImage",y.val());v.find("img").each(function(){var t=e(this).prev("a");var n=e(this).next("a");if(t.length>0&&t.html()=="")t.remove();else if(n.length>0&&n.html()=="")n.remove()})}W();v.trigger("change")}function W(e){Q("["+S+"]:not([href])");h.find("["+S+"][href]").removeAttr(S);if(e){p.data("linkOpened",true);d.show()}else{p.data("linkOpened",false);d.hide()}X()}function X(e){if(e)w.show();else w.hide()}function V(e){var t=w.data("linktype");if(t=="1"&&(y.val()=="http://"||y.is("[value^=http://]")||!y.is("[value^=mailto]")))y.val("mailto:");else if(t!="1"&&!y.is("[value^=http://]"))y.val("http://");else y.val(e)}function J(t){if(!p.data("sourceOpened")){if(t=="fSize")styleField=P;else if(t=="colors")styleField=H;K(styleField,true);styleField.find("a").unbind("click").click(function(){var n=e(this).attr(u.css+"-styleval");if(t=="fSize"){styleType="font-size";n=n+u.funit}else if(t=="colors"){styleType="color";n="rgb("+n+")"}var r=G(styleType);F("span","style",styleType+":"+n+";"+r);K("",false);e("."+u.css+"_title").remove();v.trigger("change")})}else K(styleField,false);W(false)}function K(e,t){var n="",r=[{d:"fsizeOpened",f:P},{d:"cpallOpened",f:H}];if(e!=""){for(var i=0;i<r.length;i++){if(e==r[i]["f"])n=r[i]}}if(t){p.data(n["d"],true);n["f"].slideDown(100);for(var i=0;i<r.length;i++){if(n["d"]!=r[i]["d"]){p.data(r[i]["d"],false);r[i]["f"].slideUp(100)}}}else{for(var i=0;i<r.length;i++){p.data(r[i]["d"],false);r[i]["f"].slideUp(100)}}}function Q(t){h.find(t).each(function(){e(this).before(e(this).html()).remove()})}function G(e){var t=I();if(t&&t.is("[style]")&&t.css(e)!=""){var n=t.css(e);t.css(e,"");var r=t.attr("style");t.css(e,n);return r}else return""}function Y(){Z(true);D.find("a").click(function(){e("*",this).click(function(e){e.preventDefault();return false});et(e(this).text());var t=e(this).attr(u.css+"-formatval");j("formatBlock","<"+t+">");Z(false)})}function Z(e){var t=e?true:false;t=e&&D.data("status")?true:false;if(t||!e)D.data("status",false).slideUp(200);else D.data("status",true).slideDown(200)}function et(e){var t=D.closest("."+u.css+"_tool").find("."+u.css+"_tool_label").find("."+u.css+"_tool_text");if(e.length>10)e=e.substr(0,7)+"...";t.html(e)}function tt(e){var t,n,r;t=e.replace(/\n/gim,"").replace(/\r/gim,"").replace(/\t/gim,"").replace(/ /gim," ");n=[/\<span(|\s+.*?)><span(|\s+.*?)>(.*?)<\/span><\/span>/gim,/<(\w*[^p])\s*[^\/>]*>\s*<\/\1>/gim,/\<div(|\s+.*?)>(.*?)\<\/div>/gim,/\<strong(|\s+.*?)>(.*?)\<\/strong>/gim,/\<em(|\s+.*?)>(.*?)\<\/em>/gim];r=["<span$2>$3</span>","","<p$1>$2</p>","<b$1>$2</b>","<i$1>$2</i>"];for(A=0;A<5;A++){for(var i=0;i<n.length;i++){t=t.replace(n[i],r[i])}}if(!u.p)t=t.replace(/\<p(|\s+.*?)>(.*?)\<\/p>/ig,"<br/>$2");if(!u.br){n=[/\<br>(.*?)/ig,/\<br\/>(.*?)/ig];r=["<p>$1</p>","<p>$1</p>"];for(var i=0;i<n.length;i++){t=t.replace(n[i],r[i])}}if(!u.p&&!u.br)t=t.replace(/\<p>(.*?)\<\/p>/ig,"<div>$1</div>");return t}function nt(){var e=v.text()==""&&v.html().length<12?"":v.html();l.val(tt(e))}function rt(){v.html(tt(l.val()))}function it(t){var n=false,r=I(),i;if(r){e.each(t,function(t,s){i=r.prop("tagName").toLowerCase();if(i==s)n=true;else{r.parents().each(function(){i=e(this).prop("tagName").toLowerCase();if(i==s)n=true})}});return n}else return false}function st(t){for(var n=0;n<f.length;n++){if(u[f[n].name]&&f[n].emphasis&&f[n].tag!="")it(f[n].tag)?p.find("."+u.css+"_tool_"+f[n].cls).addClass(m):e("."+u.css+"_tool_"+f[n].cls).removeClass(m)}if(u.format&&e.isArray(u.formats)){var r=false;for(var i=0;i<u.formats.length;i++){var s=[];s[0]=u.formats[i][0];if(u.formats[i][0].length>0&&it(s)){et(u.formats[i][1]);r=true;break}}if(!r)et(u.formats[0][1])}K("",false);Z(false)}if(!e(this).data("jqte")||e(this).data("jqte")==null||e(this).data("jqte")=="undefined")e(this).data("jqte",true);else e(this).data("jqte",false);if(!u.status||!e(this).data("jqte")){if(e(this).closest("."+u.css).length>0){var t=e(this).closest("."+u.css).find("."+u.css+"_editor").html();var n="";e(e(this)[0].attributes).each(function(){if(this.nodeName!="style")n=n+" "+this.nodeName+'="'+this.nodeValue+'"'});var r=e(this).is("[data-origin]")&&e(this).attr("data-origin")!=""?e(this).attr("data-origin"):"textarea";var i=">"+t;if(r=="input"||r=="option"){t=t.replace(/"/g,"&#34;").replace(/'/g,"&#39;").replace(/</g,"<").replace(/>/g,">");i='value="'+t+'">'}var o=e(this).clone();e(this).data("jqte",false).closest("."+u.css).before(o).remove();o.replaceWith("<"+r+n+i+"</"+r+">")}return}var l=e(this);var r=e(this).prop("tagName").toLowerCase();e(this).attr("data-origin",r);var c=e(this).is("[value]")||r=="textarea"?e(this).val():e(this).html();c=c.replace(/&#34;/g,'"').replace(/&#39;/g,"'").replace(/</g,"<").replace(/>/g,">").replace(/&/g,"&");e(this).after('<div class="'+u.css+'"></div>');var h=e(this).next("."+u.css);h.html('<div class="'+u.css+"_toolbar"+'" role="toolbar" unselectable></div><div class="'+u.css+'_linkform" style="display:none" role="dialog"></div><div class="'+u.css+"_editor"+'"></div>');var p=h.find("."+u.css+"_toolbar");var d=h.find("."+u.css+"_linkform");var v=h.find("."+u.css+"_editor");var m=u.css+"_tool_depressed";d.append('<div class="'+u.css+'_linktypeselect" unselectable></div><input class="'+u.css+'_linkinput" type="text/css" value=""><div class="'+u.css+'_linkbutton" unselectable>'+u.button+'</div> <div style="height:1px;float:none;clear:both"></div>');var g=d.find("."+u.css+"_linktypeselect");var y=d.find("."+u.css+"_linkinput");var b=d.find("."+u.css+"_linkbutton");g.append('<div class="'+u.css+'_linktypeview" unselectable></div><div class="'+u.css+'_linktypes" role="menu" unselectable></div>');var w=g.find("."+u.css+"_linktypes");var E=g.find("."+u.css+"_linktypeview");var S=u.css+"-setlink";v.after('<div class="'+u.css+"_source "+u.css+'_hiddenField"></div>');var x=h.find("."+u.css+"_source");l.appendTo(x);if(r!="textarea"){var n="";e(l[0].attributes).each(function(){if(this.nodeName!="type"&&this.nodeName!="value")n=n+" "+this.nodeName+'="'+this.nodeValue+'"'});l.replaceWith("<textarea "+n+">"+c+"</textarea>");l=x.find("textarea")}v.attr("contenteditable","true").html(c);for(var T=0;T<f.length;T++){if(u[f[T].name]){var N=f[T].key.length>0?u.titletext[T].hotkey!=null&&u.titletext[T].hotkey!="undefined"&&u.titletext[T].hotkey!=""?" (Ctrl+"+u.titletext[T].hotkey+")":"":"";var C=u.titletext[T].title!=null&&u.titletext[T].title!="undefined"&&u.titletext[T].title!=""?u.titletext[T].title+N:"";p.append('<div class="'+u.css+"_tool "+u.css+"_tool_"+f[T].cls+'" role="button" data-tool="'+T+'" unselectable><a class="'+u.css+'_tool_icon" unselectable></a></div>');p.find("."+u.css+"_tool[data-tool="+T+"]").data({tag:f[T].tag,command:f[T].command,emphasis:f[T].emphasis,title:C});if(f[T].name=="format"&&e.isArray(u.formats)){var k=u.formats[0][1].length>0&&u.formats[0][1]!="undefined"?u.formats[0][1]:"";p.find("."+u.css+"_tool_"+f[T].cls).find("."+u.css+"_tool_icon").replaceWith('<a class="'+u.css+'_tool_label" unselectable><span class="'+u.css+'_tool_text" unselectable>'+k+'</span><span class="'+u.css+'_tool_icon" unselectable></span></a>');p.find("."+u.css+"_tool_"+f[T].cls).append('<div class="'+u.css+'_formats" unselectable></div>');for(var L=0;L<u.formats.length;L++){p.find("."+u.css+"_formats").append("<a "+u.css+'-formatval="'+u.formats[L][0]+'" class="'+u.css+"_format"+" "+u.css+"_format_"+L+'" role="menuitem" unselectable>'+u.formats[L][1]+"</a>")}p.find("."+u.css+"_formats").data("status",false)}else if(f[T].name=="fsize"&&e.isArray(u.fsizes)){p.find("."+u.css+"_tool_"+f[T].cls).append('<div class="'+u.css+'_fontsizes" unselectable></div>');for(var L=0;L<u.fsizes.length;L++){p.find("."+u.css+"_fontsizes").append("<a "+u.css+'-styleval="'+u.fsizes[L]+'" class="'+u.css+"_fontsize"+'" style="font-size:'+u.fsizes[L]+u.funit+'" role="menuitem" unselectable>Abcdefgh...</a>')}}else if(f[T].name=="color"&&e.isArray(s)){p.find("."+u.css+"_tool_"+f[T].cls).append('<div class="'+u.css+'_cpalette" unselectable></div>');for(var A=0;A<s.length;A++){if(s[A]!=null)p.find("."+u.css+"_cpalette").append("<a "+u.css+'-styleval="'+s[A]+'" class="'+u.css+"_color"+'" style="background-color: rgb('+s[A]+')" role="gridcell" unselectable></a>');else p.find("."+u.css+"_cpalette").append('<div class="'+u.css+"_colorSeperator"+'"></div>')}}}}w.data("linktype","0");for(var T=0;T<3;T++){w.append("<a "+u.css+'-linktype="'+T+'" unselectable>'+u.linktypes[T]+"</a>");E.html('<div class="'+u.css+'_linktypearrow" unselectable></div><div class="'+u.css+'_linktypetext">'+w.find("a:eq("+w.data("linktype")+")").text()+"</div>")}var O="";if(/msie/.test(a))O="-ms-";else if(/chrome/.test(a)||/safari/.test(a)||/yandex/.test(a))O="-webkit-";else if(/mozilla/.test(a))O="-moz-";else if(/opera/.test(a))O="-o-";else if(/konqueror/.test(a))O="-khtml-";else O="";if(u.placeholder&&u.placeholder!=""){h.prepend('<div class="'+u.css+'_placeholder" unselectable><div class="'+u.css+'_placeholder_text">'+u.placeholder+"</div></div>");var M=h.find("."+u.css+"_placeholder");M.click(function(){v.focus()})}h.find("[unselectable]").css(O+"user-select","none").addClass("unselectable").attr("unselectable","on").on("selectstart mousedown",false);var _=p.find("."+u.css+"_tool");var D=p.find("."+u.css+"_formats");var P=p.find("."+u.css+"_fontsizes");var H=p.find("."+u.css+"_cpalette");var I=function(){var t,n;if(window.getSelection){n=getSelection();t=n.anchorNode}if(!t&&document.selection&&document.selection.createRange&&document.selection.type!="None"){n=document.selection;var r=n.getRangeAt?n.getRangeAt(0):n.createRange();t=r.commonAncestorContainer?r.commonAncestorContainer:r.parentElement?r.parentElement():r.item(0)}if(t){return t.nodeName=="#text"?e(t.parentNode):e(t)}else return false};_.unbind("click").click(function(t){if(e(this).data("command")=="displaysource"&&!p.data("sourceOpened")){p.find("."+u.css+"_tool").addClass(u.css+"_hiddenField");e(this).removeClass(u.css+"_hiddenField");p.data("sourceOpened",true);l.css("height",v.outerHeight());x.removeClass(u.css+"_hiddenField");v.addClass(u.css+"_hiddenField");l.focus();W(false);K("",false);Z();if(u.placeholder&&u.placeholder!="")M.hide()}else{if(!p.data("sourceOpened")){if(e(this).data("command")=="linkcreator"){if(!p.data("linkOpened"))U();else{W(false);Z(false)}}else if(e(this).data("command")=="formats"){if(e(this).data("command")=="formats"&&!e(t.target).hasClass(u.css+"_format"))Y();K("",false);if(v.not(":focus"))v.focus()}else if(e(this).data("command")=="fSize"||e(this).data("command")=="colors"){if(e(this).data("command")=="fSize"&&!e(t.target).hasClass(u.css+"_fontsize")||e(this).data("command")=="colors"&&!e(t.target).hasClass(u.css+"_color"))J(e(this).data("command"));Z(false);if(v.not(":focus"))v.focus()}else{if(v.not(":focus"))v.focus();j(e(this).data("command"),null);K("",false);Z(false);X();e(this).data("emphasis")==true&&!e(this).hasClass(m)?e(this).addClass(m):e(this).removeClass(m);x.addClass(u.css+"_hiddenField");v.removeClass(u.css+"_hiddenField")}}else{p.data("sourceOpened",false);p.find("."+u.css+"_tool").removeClass(u.css+"_hiddenField");x.addClass(u.css+"_hiddenField");v.removeClass(u.css+"_hiddenField")}if(u.placeholder&&u.placeholder!="")v.html()!=""?M.hide():M.show()}v.trigger("change")}).hover(function(t){if(u.title&&e(this).data("title")!=""&&(e(t.target).hasClass(u.css+"_tool")||e(t.target).hasClass(u.css+"_tool_icon"))){e("."+u.css+"_title").remove();h.append('<div class="'+u.css+'_title"><div class="'+u.css+'_titleArrow"><div class="'+u.css+'_titleArrowIcon"></div></div><div class="'+u.css+'_titleText">'+e(this).data("title")+"</div></div>");var n=e("."+u.css+"_title:first");var r=n.find("."+u.css+"_titleArrowIcon");var i=e(this).position();var s=i.left+e(this).outerWidth()-n.outerWidth()/2-e(this).outerWidth()/2;var o=i.top+e(this).outerHeight()+5;n.delay(400).css({top:o,left:s}).fadeIn(200)}},function(){e("."+u.css+"_title").remove()});var ot=null;v.bind("keypress keyup keydown drop cut copy paste DOMCharacterDataModified DOMSubtreeModified",function(){if(!p.data("sourceOpened"))e(this).trigger("change");X();if(e.isFunction(u.change))u.change();if(u.placeholder&&u.placeholder!="")e(this).text()!=""?M.hide():M.show()}).bind("change",function(){if(!p.data("sourceOpened")){clearTimeout(ot);ot=setTimeout(nt,10)}}).keydown(function(e){if(e.ctrlKey){for(var t=0;t<f.length;t++){if(u[f[t].name]&&e.keyCode==f[t].key.charCodeAt(0)){if(f[t].command!=""&&f[t].command!="linkcreator")j(f[t].command,null);else if(f[t].command=="linkcreator")U();return false}}}}).bind("mouseup keyup",st).focus(function(){if(e.isFunction(u.focus))u.focus();h.addClass(u.css+"_focused");if(/opera/.test(a)){var t=document.createRange();t.selectNodeContents(v[0]);t.collapse(false);var n=window.getSelection();n.removeAllRanges();n.addRange(t)}}).focusout(function(){_.removeClass(m);K("",false);Z(false);X();if(e.isFunction(u.blur))u.blur();h.removeClass(u.css+"_focused");if(e.isArray(u.formats))et(u.formats[0][1])});l.bind("keydown keyup",function(){setTimeout(rt,0);e(this).height(e(this)[0].scrollHeight);if(e(this).val()=="")e(this).height(0)}).focus(function(){h.addClass(u.css+"_focused")}).focusout(function(){h.removeClass(u.css+"_focused")})})}})(jQuery)
///#source 1 1 Plugins/select2.min.js
/*! Select2 4.0.0 | https://github.com/select2/select2/blob/master/LICENSE.md */!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a("object"==typeof exports?require("jquery"):jQuery)}(function(a){var b=function(){if(a&&a.fn&&a.fn.select2&&a.fn.select2.amd)var b=a.fn.select2.amd;var b;return function(){if(!b||!b.requirejs){b?c=b:b={};var a,c,d;!function(b){function e(a,b){return u.call(a,b)}function f(a,b){var c,d,e,f,g,h,i,j,k,l,m,n=b&&b.split("/"),o=s.map,p=o&&o["*"]||{};if(a&&"."===a.charAt(0))if(b){for(n=n.slice(0,n.length-1),a=a.split("/"),g=a.length-1,s.nodeIdCompat&&w.test(a[g])&&(a[g]=a[g].replace(w,"")),a=n.concat(a),k=0;k<a.length;k+=1)if(m=a[k],"."===m)a.splice(k,1),k-=1;else if(".."===m){if(1===k&&(".."===a[2]||".."===a[0]))break;k>0&&(a.splice(k-1,2),k-=2)}a=a.join("/")}else 0===a.indexOf("./")&&(a=a.substring(2));if((n||p)&&o){for(c=a.split("/"),k=c.length;k>0;k-=1){if(d=c.slice(0,k).join("/"),n)for(l=n.length;l>0;l-=1)if(e=o[n.slice(0,l).join("/")],e&&(e=e[d])){f=e,h=k;break}if(f)break;!i&&p&&p[d]&&(i=p[d],j=k)}!f&&i&&(f=i,h=j),f&&(c.splice(0,h,f),a=c.join("/"))}return a}function g(a,c){return function(){return n.apply(b,v.call(arguments,0).concat([a,c]))}}function h(a){return function(b){return f(b,a)}}function i(a){return function(b){q[a]=b}}function j(a){if(e(r,a)){var c=r[a];delete r[a],t[a]=!0,m.apply(b,c)}if(!e(q,a)&&!e(t,a))throw new Error("No "+a);return q[a]}function k(a){var b,c=a?a.indexOf("!"):-1;return c>-1&&(b=a.substring(0,c),a=a.substring(c+1,a.length)),[b,a]}function l(a){return function(){return s&&s.config&&s.config[a]||{}}}var m,n,o,p,q={},r={},s={},t={},u=Object.prototype.hasOwnProperty,v=[].slice,w=/\.js$/;o=function(a,b){var c,d=k(a),e=d[0];return a=d[1],e&&(e=f(e,b),c=j(e)),e?a=c&&c.normalize?c.normalize(a,h(b)):f(a,b):(a=f(a,b),d=k(a),e=d[0],a=d[1],e&&(c=j(e))),{f:e?e+"!"+a:a,n:a,pr:e,p:c}},p={require:function(a){return g(a)},exports:function(a){var b=q[a];return"undefined"!=typeof b?b:q[a]={}},module:function(a){return{id:a,uri:"",exports:q[a],config:l(a)}}},m=function(a,c,d,f){var h,k,l,m,n,s,u=[],v=typeof d;if(f=f||a,"undefined"===v||"function"===v){for(c=!c.length&&d.length?["require","exports","module"]:c,n=0;n<c.length;n+=1)if(m=o(c[n],f),k=m.f,"require"===k)u[n]=p.require(a);else if("exports"===k)u[n]=p.exports(a),s=!0;else if("module"===k)h=u[n]=p.module(a);else if(e(q,k)||e(r,k)||e(t,k))u[n]=j(k);else{if(!m.p)throw new Error(a+" missing "+k);m.p.load(m.n,g(f,!0),i(k),{}),u[n]=q[k]}l=d?d.apply(q[a],u):void 0,a&&(h&&h.exports!==b&&h.exports!==q[a]?q[a]=h.exports:l===b&&s||(q[a]=l))}else a&&(q[a]=d)},a=c=n=function(a,c,d,e,f){if("string"==typeof a)return p[a]?p[a](c):j(o(a,c).f);if(!a.splice){if(s=a,s.deps&&n(s.deps,s.callback),!c)return;c.splice?(a=c,c=d,d=null):a=b}return c=c||function(){},"function"==typeof d&&(d=e,e=f),e?m(b,a,c,d):setTimeout(function(){m(b,a,c,d)},4),n},n.config=function(a){return n(a)},a._defined=q,d=function(a,b,c){b.splice||(c=b,b=[]),e(q,a)||e(r,a)||(r[a]=[a,b,c])},d.amd={jQuery:!0}}(),b.requirejs=a,b.require=c,b.define=d}}(),b.define("almond",function(){}),b.define("jquery",[],function(){var b=a||$;return null==b&&console&&console.error&&console.error("Select2: An instance of jQuery or a jQuery-compatible library was not found. Make sure that you are including jQuery before Select2 on your web page."),b}),b.define("select2/utils",["jquery"],function(a){function b(a){var b=a.prototype,c=[];for(var d in b){var e=b[d];"function"==typeof e&&"constructor"!==d&&c.push(d)}return c}var c={};c.Extend=function(a,b){function c(){this.constructor=a}var d={}.hasOwnProperty;for(var e in b)d.call(b,e)&&(a[e]=b[e]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},c.Decorate=function(a,c){function d(){var b=Array.prototype.unshift,d=c.prototype.constructor.length,e=a.prototype.constructor;d>0&&(b.call(arguments,a.prototype.constructor),e=c.prototype.constructor),e.apply(this,arguments)}function e(){this.constructor=d}var f=b(c),g=b(a);c.displayName=a.displayName,d.prototype=new e;for(var h=0;h<g.length;h++){var i=g[h];d.prototype[i]=a.prototype[i]}for(var j=(function(a){var b=function(){};a in d.prototype&&(b=d.prototype[a]);var e=c.prototype[a];return function(){var a=Array.prototype.unshift;return a.call(arguments,b),e.apply(this,arguments)}}),k=0;k<f.length;k++){var l=f[k];d.prototype[l]=j(l)}return d};var d=function(){this.listeners={}};return d.prototype.on=function(a,b){this.listeners=this.listeners||{},a in this.listeners?this.listeners[a].push(b):this.listeners[a]=[b]},d.prototype.trigger=function(a){var b=Array.prototype.slice;this.listeners=this.listeners||{},a in this.listeners&&this.invoke(this.listeners[a],b.call(arguments,1)),"*"in this.listeners&&this.invoke(this.listeners["*"],arguments)},d.prototype.invoke=function(a,b){for(var c=0,d=a.length;d>c;c++)a[c].apply(this,b)},c.Observable=d,c.generateChars=function(a){for(var b="",c=0;a>c;c++){var d=Math.floor(36*Math.random());b+=d.toString(36)}return b},c.bind=function(a,b){return function(){a.apply(b,arguments)}},c._convertData=function(a){for(var b in a){var c=b.split("-"),d=a;if(1!==c.length){for(var e=0;e<c.length;e++){var f=c[e];f=f.substring(0,1).toLowerCase()+f.substring(1),f in d||(d[f]={}),e==c.length-1&&(d[f]=a[b]),d=d[f]}delete a[b]}}return a},c.hasScroll=function(b,c){var d=a(c),e=c.style.overflowX,f=c.style.overflowY;return e!==f||"hidden"!==f&&"visible"!==f?"scroll"===e||"scroll"===f?!0:d.innerHeight()<c.scrollHeight||d.innerWidth()<c.scrollWidth:!1},c.escapeMarkup=function(a){var b={"\\":"&#92;","&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#47;"};return"string"!=typeof a?a:String(a).replace(/[&<>"'\/\\]/g,function(a){return b[a]})},c.appendMany=function(b,c){if("1.7"===a.fn.jquery.substr(0,3)){var d=a();a.map(c,function(a){d=d.add(a)}),c=d}b.append(c)},c}),b.define("select2/results",["jquery","./utils"],function(a,b){function c(a,b,d){this.$element=a,this.data=d,this.options=b,c.__super__.constructor.call(this)}return b.Extend(c,b.Observable),c.prototype.render=function(){var b=a('<ul class="select2-results__options" role="tree"></ul>');return this.options.get("multiple")&&b.attr("aria-multiselectable","true"),this.$results=b,b},c.prototype.clear=function(){this.$results.empty()},c.prototype.displayMessage=function(b){var c=this.options.get("escapeMarkup");this.clear(),this.hideLoading();var d=a('<li role="treeitem" class="select2-results__option"></li>'),e=this.options.get("translations").get(b.message);d.append(c(e(b.args))),this.$results.append(d)},c.prototype.append=function(a){this.hideLoading();var b=[];if(null==a.results||0===a.results.length)return void(0===this.$results.children().length&&this.trigger("results:message",{message:"noResults"}));a.results=this.sort(a.results);for(var c=0;c<a.results.length;c++){var d=a.results[c],e=this.option(d);b.push(e)}this.$results.append(b)},c.prototype.position=function(a,b){var c=b.find(".select2-results");c.append(a)},c.prototype.sort=function(a){var b=this.options.get("sorter");return b(a)},c.prototype.setClasses=function(){var b=this;this.data.current(function(c){var d=a.map(c,function(a){return a.id.toString()}),e=b.$results.find(".select2-results__option[aria-selected]");e.each(function(){var b=a(this),c=a.data(this,"data"),e=""+c.id;null!=c.element&&c.element.selected||null==c.element&&a.inArray(e,d)>-1?b.attr("aria-selected","true"):b.attr("aria-selected","false")});var f=e.filter("[aria-selected=true]");f.length>0?f.first().trigger("mouseenter"):e.first().trigger("mouseenter")})},c.prototype.showLoading=function(a){this.hideLoading();var b=this.options.get("translations").get("searching"),c={disabled:!0,loading:!0,text:b(a)},d=this.option(c);d.className+=" loading-results",this.$results.prepend(d)},c.prototype.hideLoading=function(){this.$results.find(".loading-results").remove()},c.prototype.option=function(b){var c=document.createElement("li");c.className="select2-results__option";var d={role:"treeitem","aria-selected":"false"};b.disabled&&(delete d["aria-selected"],d["aria-disabled"]="true"),null==b.id&&delete d["aria-selected"],null!=b._resultId&&(c.id=b._resultId),b.title&&(c.title=b.title),b.children&&(d.role="group",d["aria-label"]=b.text,delete d["aria-selected"]);for(var e in d){var f=d[e];c.setAttribute(e,f)}if(b.children){var g=a(c),h=document.createElement("strong");h.className="select2-results__group";{a(h)}this.template(b,h);for(var i=[],j=0;j<b.children.length;j++){var k=b.children[j],l=this.option(k);i.push(l)}var m=a("<ul></ul>",{"class":"select2-results__options select2-results__options--nested"});m.append(i),g.append(h),g.append(m)}else this.template(b,c);return a.data(c,"data",b),c},c.prototype.bind=function(b){var c=this,d=b.id+"-results";this.$results.attr("id",d),b.on("results:all",function(a){c.clear(),c.append(a.data),b.isOpen()&&c.setClasses()}),b.on("results:append",function(a){c.append(a.data),b.isOpen()&&c.setClasses()}),b.on("query",function(a){c.showLoading(a)}),b.on("select",function(){b.isOpen()&&c.setClasses()}),b.on("unselect",function(){b.isOpen()&&c.setClasses()}),b.on("open",function(){c.$results.attr("aria-expanded","true"),c.$results.attr("aria-hidden","false"),c.setClasses(),c.ensureHighlightVisible()}),b.on("close",function(){c.$results.attr("aria-expanded","false"),c.$results.attr("aria-hidden","true"),c.$results.removeAttr("aria-activedescendant")}),b.on("results:toggle",function(){var a=c.getHighlightedResults();0!==a.length&&a.trigger("mouseup")}),b.on("results:select",function(){var a=c.getHighlightedResults();if(0!==a.length){var b=a.data("data");"true"==a.attr("aria-selected")?c.trigger("close"):c.trigger("select",{data:b})}}),b.on("results:previous",function(){var a=c.getHighlightedResults(),b=c.$results.find("[aria-selected]"),d=b.index(a);if(0!==d){var e=d-1;0===a.length&&(e=0);var f=b.eq(e);f.trigger("mouseenter");var g=c.$results.offset().top,h=f.offset().top,i=c.$results.scrollTop()+(h-g);0===e?c.$results.scrollTop(0):0>h-g&&c.$results.scrollTop(i)}}),b.on("results:next",function(){var a=c.getHighlightedResults(),b=c.$results.find("[aria-selected]"),d=b.index(a),e=d+1;if(!(e>=b.length)){var f=b.eq(e);f.trigger("mouseenter");var g=c.$results.offset().top+c.$results.outerHeight(!1),h=f.offset().top+f.outerHeight(!1),i=c.$results.scrollTop()+h-g;0===e?c.$results.scrollTop(0):h>g&&c.$results.scrollTop(i)}}),b.on("results:focus",function(a){a.element.addClass("select2-results__option--highlighted")}),b.on("results:message",function(a){c.displayMessage(a)}),a.fn.mousewheel&&this.$results.on("mousewheel",function(a){var b=c.$results.scrollTop(),d=c.$results.get(0).scrollHeight-c.$results.scrollTop()+a.deltaY,e=a.deltaY>0&&b-a.deltaY<=0,f=a.deltaY<0&&d<=c.$results.height();e?(c.$results.scrollTop(0),a.preventDefault(),a.stopPropagation()):f&&(c.$results.scrollTop(c.$results.get(0).scrollHeight-c.$results.height()),a.preventDefault(),a.stopPropagation())}),this.$results.on("mouseup",".select2-results__option[aria-selected]",function(b){var d=a(this),e=d.data("data");return"true"===d.attr("aria-selected")?void(c.options.get("multiple")?c.trigger("unselect",{originalEvent:b,data:e}):c.trigger("close")):void c.trigger("select",{originalEvent:b,data:e})}),this.$results.on("mouseenter",".select2-results__option[aria-selected]",function(){var b=a(this).data("data");c.getHighlightedResults().removeClass("select2-results__option--highlighted"),c.trigger("results:focus",{data:b,element:a(this)})})},c.prototype.getHighlightedResults=function(){var a=this.$results.find(".select2-results__option--highlighted");return a},c.prototype.destroy=function(){this.$results.remove()},c.prototype.ensureHighlightVisible=function(){var a=this.getHighlightedResults();if(0!==a.length){var b=this.$results.find("[aria-selected]"),c=b.index(a),d=this.$results.offset().top,e=a.offset().top,f=this.$results.scrollTop()+(e-d),g=e-d;f-=2*a.outerHeight(!1),2>=c?this.$results.scrollTop(0):(g>this.$results.outerHeight()||0>g)&&this.$results.scrollTop(f)}},c.prototype.template=function(b,c){var d=this.options.get("templateResult"),e=this.options.get("escapeMarkup"),f=d(b);null==f?c.style.display="none":"string"==typeof f?c.innerHTML=e(f):a(c).append(f)},c}),b.define("select2/keys",[],function(){var a={BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,DELETE:46};return a}),b.define("select2/selection/base",["jquery","../utils","../keys"],function(a,b,c){function d(a,b){this.$element=a,this.options=b,d.__super__.constructor.call(this)}return b.Extend(d,b.Observable),d.prototype.render=function(){var b=a('<span class="select2-selection" role="combobox" aria-autocomplete="list" aria-haspopup="true" aria-expanded="false"></span>');return this._tabindex=0,null!=this.$element.data("old-tabindex")?this._tabindex=this.$element.data("old-tabindex"):null!=this.$element.attr("tabindex")&&(this._tabindex=this.$element.attr("tabindex")),b.attr("title",this.$element.attr("title")),b.attr("tabindex",this._tabindex),this.$selection=b,b},d.prototype.bind=function(a){var b=this,d=(a.id+"-container",a.id+"-results");this.container=a,this.$selection.on("focus",function(a){b.trigger("focus",a)}),this.$selection.on("blur",function(a){b.trigger("blur",a)}),this.$selection.on("keydown",function(a){b.trigger("keypress",a),a.which===c.SPACE&&a.preventDefault()}),a.on("results:focus",function(a){b.$selection.attr("aria-activedescendant",a.data._resultId)}),a.on("selection:update",function(a){b.update(a.data)}),a.on("open",function(){b.$selection.attr("aria-expanded","true"),b.$selection.attr("aria-owns",d),b._attachCloseHandler(a)}),a.on("close",function(){b.$selection.attr("aria-expanded","false"),b.$selection.removeAttr("aria-activedescendant"),b.$selection.removeAttr("aria-owns"),b.$selection.focus(),b._detachCloseHandler(a)}),a.on("enable",function(){b.$selection.attr("tabindex",b._tabindex)}),a.on("disable",function(){b.$selection.attr("tabindex","-1")})},d.prototype._attachCloseHandler=function(b){a(document.body).on("mousedown.select2."+b.id,function(b){var c=a(b.target),d=c.closest(".select2"),e=a(".select2.select2-container--open");e.each(function(){var b=a(this);if(this!=d[0]){var c=b.data("element");c.select2("close")}})})},d.prototype._detachCloseHandler=function(b){a(document.body).off("mousedown.select2."+b.id)},d.prototype.position=function(a,b){var c=b.find(".selection");c.append(a)},d.prototype.destroy=function(){this._detachCloseHandler(this.container)},d.prototype.update=function(){throw new Error("The `update` method must be defined in child classes.")},d}),b.define("select2/selection/single",["jquery","./base","../utils","../keys"],function(a,b,c){function d(){d.__super__.constructor.apply(this,arguments)}return c.Extend(d,b),d.prototype.render=function(){var a=d.__super__.render.call(this);return a.addClass("select2-selection--single"),a.html('<span class="select2-selection__rendered"></span><span class="select2-selection__arrow" role="presentation"><b role="presentation"></b></span>'),a},d.prototype.bind=function(a){var b=this;d.__super__.bind.apply(this,arguments);var c=a.id+"-container";this.$selection.find(".select2-selection__rendered").attr("id",c),this.$selection.attr("aria-labelledby",c),this.$selection.on("mousedown",function(a){1===a.which&&b.trigger("toggle",{originalEvent:a})}),this.$selection.on("focus",function(){}),this.$selection.on("blur",function(){}),a.on("selection:update",function(a){b.update(a.data)})},d.prototype.clear=function(){this.$selection.find(".select2-selection__rendered").empty()},d.prototype.display=function(a){var b=this.options.get("templateSelection"),c=this.options.get("escapeMarkup");return c(b(a))},d.prototype.selectionContainer=function(){return a("<span></span>")},d.prototype.update=function(a){if(0===a.length)return void this.clear();var b=a[0],c=this.display(b),d=this.$selection.find(".select2-selection__rendered");d.empty().append(c),d.prop("title",b.title||b.text)},d}),b.define("select2/selection/multiple",["jquery","./base","../utils"],function(a,b,c){function d(){d.__super__.constructor.apply(this,arguments)}return c.Extend(d,b),d.prototype.render=function(){var a=d.__super__.render.call(this);return a.addClass("select2-selection--multiple"),a.html('<ul class="select2-selection__rendered"></ul>'),a},d.prototype.bind=function(){var b=this;d.__super__.bind.apply(this,arguments),this.$selection.on("click",function(a){b.trigger("toggle",{originalEvent:a})}),this.$selection.on("click",".select2-selection__choice__remove",function(c){var d=a(this),e=d.parent(),f=e.data("data");b.trigger("unselect",{originalEvent:c,data:f})})},d.prototype.clear=function(){this.$selection.find(".select2-selection__rendered").empty()},d.prototype.display=function(a){var b=this.options.get("templateSelection"),c=this.options.get("escapeMarkup");return c(b(a))},d.prototype.selectionContainer=function(){var b=a('<li class="select2-selection__choice"><span class="select2-selection__choice__remove" role="presentation">&times;</span></li>');return b},d.prototype.update=function(a){if(this.clear(),0!==a.length){for(var b=[],d=0;d<a.length;d++){var e=a[d],f=this.display(e),g=this.selectionContainer();g.append(f),g.prop("title",e.title||e.text),g.data("data",e),b.push(g)}var h=this.$selection.find(".select2-selection__rendered");c.appendMany(h,b)}},d}),b.define("select2/selection/placeholder",["../utils"],function(){function a(a,b,c){this.placeholder=this.normalizePlaceholder(c.get("placeholder")),a.call(this,b,c)}return a.prototype.normalizePlaceholder=function(a,b){return"string"==typeof b&&(b={id:"",text:b}),b},a.prototype.createPlaceholder=function(a,b){var c=this.selectionContainer();return c.html(this.display(b)),c.addClass("select2-selection__placeholder").removeClass("select2-selection__choice"),c},a.prototype.update=function(a,b){var c=1==b.length&&b[0].id!=this.placeholder.id,d=b.length>1;if(d||c)return a.call(this,b);this.clear();var e=this.createPlaceholder(this.placeholder);this.$selection.find(".select2-selection__rendered").append(e)},a}),b.define("select2/selection/allowClear",["jquery","../keys"],function(a,b){function c(){}return c.prototype.bind=function(a,b,c){var d=this;a.call(this,b,c),null==this.placeholder&&this.options.get("debug")&&window.console&&console.error&&console.error("Select2: The `allowClear` option should be used in combination with the `placeholder` option."),this.$selection.on("mousedown",".select2-selection__clear",function(a){d._handleClear(a)}),b.on("keypress",function(a){d._handleKeyboardClear(a,b)})},c.prototype._handleClear=function(a,b){if(!this.options.get("disabled")){var c=this.$selection.find(".select2-selection__clear");if(0!==c.length){b.stopPropagation();for(var d=c.data("data"),e=0;e<d.length;e++){var f={data:d[e]};if(this.trigger("unselect",f),f.prevented)return}this.$element.val(this.placeholder.id).trigger("change"),this.trigger("toggle")}}},c.prototype._handleKeyboardClear=function(a,c,d){d.isOpen()||(c.which==b.DELETE||c.which==b.BACKSPACE)&&this._handleClear(c)},c.prototype.update=function(b,c){if(b.call(this,c),!(this.$selection.find(".select2-selection__placeholder").length>0||0===c.length)){var d=a('<span class="select2-selection__clear">&times;</span>');d.data("data",c),this.$selection.find(".select2-selection__rendered").prepend(d)}},c}),b.define("select2/selection/search",["jquery","../utils","../keys"],function(a,b,c){function d(a,b,c){a.call(this,b,c)}return d.prototype.render=function(b){var c=a('<li class="select2-search select2-search--inline"><input class="select2-search__field" type="search" tabindex="-1" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" role="textbox" /></li>');this.$searchContainer=c,this.$search=c.find("input");var d=b.call(this);return d},d.prototype.bind=function(a,b,d){var e=this;a.call(this,b,d),b.on("open",function(){e.$search.attr("tabindex",0),e.$search.focus()}),b.on("close",function(){e.$search.attr("tabindex",-1),e.$search.val(""),e.$search.focus()}),b.on("enable",function(){e.$search.prop("disabled",!1)}),b.on("disable",function(){e.$search.prop("disabled",!0)}),this.$selection.on("focusin",".select2-search--inline",function(a){e.trigger("focus",a)}),this.$selection.on("focusout",".select2-search--inline",function(a){e.trigger("blur",a)}),this.$selection.on("keydown",".select2-search--inline",function(a){a.stopPropagation(),e.trigger("keypress",a),e._keyUpPrevented=a.isDefaultPrevented();var b=a.which;if(b===c.BACKSPACE&&""===e.$search.val()){var d=e.$searchContainer.prev(".select2-selection__choice");if(d.length>0){var f=d.data("data");e.searchRemoveChoice(f),a.preventDefault()}}}),this.$selection.on("input",".select2-search--inline",function(){e.$selection.off("keyup.search")}),this.$selection.on("keyup.search input",".select2-search--inline",function(a){e.handleSearch(a)})},d.prototype.createPlaceholder=function(a,b){this.$search.attr("placeholder",b.text)},d.prototype.update=function(a,b){this.$search.attr("placeholder",""),a.call(this,b),this.$selection.find(".select2-selection__rendered").append(this.$searchContainer),this.resizeSearch()},d.prototype.handleSearch=function(){if(this.resizeSearch(),!this._keyUpPrevented){var a=this.$search.val();this.trigger("query",{term:a})}this._keyUpPrevented=!1},d.prototype.searchRemoveChoice=function(a,b){this.trigger("unselect",{data:b}),this.trigger("open"),this.$search.val(b.text+" ")},d.prototype.resizeSearch=function(){this.$search.css("width","25px");var a="";if(""!==this.$search.attr("placeholder"))a=this.$selection.find(".select2-selection__rendered").innerWidth();else{var b=this.$search.val().length+1;a=.75*b+"em"}this.$search.css("width",a)},d}),b.define("select2/selection/eventRelay",["jquery"],function(a){function b(){}return b.prototype.bind=function(b,c,d){var e=this,f=["open","opening","close","closing","select","selecting","unselect","unselecting"],g=["opening","closing","selecting","unselecting"];b.call(this,c,d),c.on("*",function(b,c){if(-1!==a.inArray(b,f)){c=c||{};var d=a.Event("select2:"+b,{params:c});e.$element.trigger(d),-1!==a.inArray(b,g)&&(c.prevented=d.isDefaultPrevented())}})},b}),b.define("select2/translation",["jquery","require"],function(a,b){function c(a){this.dict=a||{}}return c.prototype.all=function(){return this.dict},c.prototype.get=function(a){return this.dict[a]},c.prototype.extend=function(b){this.dict=a.extend({},b.all(),this.dict)},c._cache={},c.loadPath=function(a){if(!(a in c._cache)){var d=b(a);c._cache[a]=d}return new c(c._cache[a])},c}),b.define("select2/diacritics",[],function(){var a={"Ⓐ":"A","Ａ":"A","À":"A","Á":"A","Â":"A","Ầ":"A","Ấ":"A","Ẫ":"A","Ẩ":"A","Ã":"A","Ā":"A","Ă":"A","Ằ":"A","Ắ":"A","Ẵ":"A","Ẳ":"A","Ȧ":"A","Ǡ":"A","Ä":"A","Ǟ":"A","Ả":"A","Å":"A","Ǻ":"A","Ǎ":"A","Ȁ":"A","Ȃ":"A","Ạ":"A","Ậ":"A","Ặ":"A","Ḁ":"A","Ą":"A","Ⱥ":"A","Ɐ":"A","Ꜳ":"AA","Æ":"AE","Ǽ":"AE","Ǣ":"AE","Ꜵ":"AO","Ꜷ":"AU","Ꜹ":"AV","Ꜻ":"AV","Ꜽ":"AY","Ⓑ":"B","Ｂ":"B","Ḃ":"B","Ḅ":"B","Ḇ":"B","Ƀ":"B","Ƃ":"B","Ɓ":"B","Ⓒ":"C","Ｃ":"C","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","Ç":"C","Ḉ":"C","Ƈ":"C","Ȼ":"C","Ꜿ":"C","Ⓓ":"D","Ｄ":"D","Ḋ":"D","Ď":"D","Ḍ":"D","Ḑ":"D","Ḓ":"D","Ḏ":"D","Đ":"D","Ƌ":"D","Ɗ":"D","Ɖ":"D","Ꝺ":"D","Ǳ":"DZ","Ǆ":"DZ","ǲ":"Dz","ǅ":"Dz","Ⓔ":"E","Ｅ":"E","È":"E","É":"E","Ê":"E","Ề":"E","Ế":"E","Ễ":"E","Ể":"E","Ẽ":"E","Ē":"E","Ḕ":"E","Ḗ":"E","Ĕ":"E","Ė":"E","Ë":"E","Ẻ":"E","Ě":"E","Ȅ":"E","Ȇ":"E","Ẹ":"E","Ệ":"E","Ȩ":"E","Ḝ":"E","Ę":"E","Ḙ":"E","Ḛ":"E","Ɛ":"E","Ǝ":"E","Ⓕ":"F","Ｆ":"F","Ḟ":"F","Ƒ":"F","Ꝼ":"F","Ⓖ":"G","Ｇ":"G","Ǵ":"G","Ĝ":"G","Ḡ":"G","Ğ":"G","Ġ":"G","Ǧ":"G","Ģ":"G","Ǥ":"G","Ɠ":"G","Ꞡ":"G","Ᵹ":"G","Ꝿ":"G","Ⓗ":"H","Ｈ":"H","Ĥ":"H","Ḣ":"H","Ḧ":"H","Ȟ":"H","Ḥ":"H","Ḩ":"H","Ḫ":"H","Ħ":"H","Ⱨ":"H","Ⱶ":"H","Ɥ":"H","Ⓘ":"I","Ｉ":"I","Ì":"I","Í":"I","Î":"I","Ĩ":"I","Ī":"I","Ĭ":"I","İ":"I","Ï":"I","Ḯ":"I","Ỉ":"I","Ǐ":"I","Ȉ":"I","Ȋ":"I","Ị":"I","Į":"I","Ḭ":"I","Ɨ":"I","Ⓙ":"J","Ｊ":"J","Ĵ":"J","Ɉ":"J","Ⓚ":"K","Ｋ":"K","Ḱ":"K","Ǩ":"K","Ḳ":"K","Ķ":"K","Ḵ":"K","Ƙ":"K","Ⱪ":"K","Ꝁ":"K","Ꝃ":"K","Ꝅ":"K","Ꞣ":"K","Ⓛ":"L","Ｌ":"L","Ŀ":"L","Ĺ":"L","Ľ":"L","Ḷ":"L","Ḹ":"L","Ļ":"L","Ḽ":"L","Ḻ":"L","Ł":"L","Ƚ":"L","Ɫ":"L","Ⱡ":"L","Ꝉ":"L","Ꝇ":"L","Ꞁ":"L","Ǉ":"LJ","ǈ":"Lj","Ⓜ":"M","Ｍ":"M","Ḿ":"M","Ṁ":"M","Ṃ":"M","Ɱ":"M","Ɯ":"M","Ⓝ":"N","Ｎ":"N","Ǹ":"N","Ń":"N","Ñ":"N","Ṅ":"N","Ň":"N","Ṇ":"N","Ņ":"N","Ṋ":"N","Ṉ":"N","Ƞ":"N","Ɲ":"N","Ꞑ":"N","Ꞥ":"N","Ǌ":"NJ","ǋ":"Nj","Ⓞ":"O","Ｏ":"O","Ò":"O","Ó":"O","Ô":"O","Ồ":"O","Ố":"O","Ỗ":"O","Ổ":"O","Õ":"O","Ṍ":"O","Ȭ":"O","Ṏ":"O","Ō":"O","Ṑ":"O","Ṓ":"O","Ŏ":"O","Ȯ":"O","Ȱ":"O","Ö":"O","Ȫ":"O","Ỏ":"O","Ő":"O","Ǒ":"O","Ȍ":"O","Ȏ":"O","Ơ":"O","Ờ":"O","Ớ":"O","Ỡ":"O","Ở":"O","Ợ":"O","Ọ":"O","Ộ":"O","Ǫ":"O","Ǭ":"O","Ø":"O","Ǿ":"O","Ɔ":"O","Ɵ":"O","Ꝋ":"O","Ꝍ":"O","Ƣ":"OI","Ꝏ":"OO","Ȣ":"OU","Ⓟ":"P","Ｐ":"P","Ṕ":"P","Ṗ":"P","Ƥ":"P","Ᵽ":"P","Ꝑ":"P","Ꝓ":"P","Ꝕ":"P","Ⓠ":"Q","Ｑ":"Q","Ꝗ":"Q","Ꝙ":"Q","Ɋ":"Q","Ⓡ":"R","Ｒ":"R","Ŕ":"R","Ṙ":"R","Ř":"R","Ȑ":"R","Ȓ":"R","Ṛ":"R","Ṝ":"R","Ŗ":"R","Ṟ":"R","Ɍ":"R","Ɽ":"R","Ꝛ":"R","Ꞧ":"R","Ꞃ":"R","Ⓢ":"S","Ｓ":"S","ẞ":"S","Ś":"S","Ṥ":"S","Ŝ":"S","Ṡ":"S","Š":"S","Ṧ":"S","Ṣ":"S","Ṩ":"S","Ș":"S","Ş":"S","Ȿ":"S","Ꞩ":"S","Ꞅ":"S","Ⓣ":"T","Ｔ":"T","Ṫ":"T","Ť":"T","Ṭ":"T","Ț":"T","Ţ":"T","Ṱ":"T","Ṯ":"T","Ŧ":"T","Ƭ":"T","Ʈ":"T","Ⱦ":"T","Ꞇ":"T","Ꜩ":"TZ","Ⓤ":"U","Ｕ":"U","Ù":"U","Ú":"U","Û":"U","Ũ":"U","Ṹ":"U","Ū":"U","Ṻ":"U","Ŭ":"U","Ü":"U","Ǜ":"U","Ǘ":"U","Ǖ":"U","Ǚ":"U","Ủ":"U","Ů":"U","Ű":"U","Ǔ":"U","Ȕ":"U","Ȗ":"U","Ư":"U","Ừ":"U","Ứ":"U","Ữ":"U","Ử":"U","Ự":"U","Ụ":"U","Ṳ":"U","Ų":"U","Ṷ":"U","Ṵ":"U","Ʉ":"U","Ⓥ":"V","Ｖ":"V","Ṽ":"V","Ṿ":"V","Ʋ":"V","Ꝟ":"V","Ʌ":"V","Ꝡ":"VY","Ⓦ":"W","Ｗ":"W","Ẁ":"W","Ẃ":"W","Ŵ":"W","Ẇ":"W","Ẅ":"W","Ẉ":"W","Ⱳ":"W","Ⓧ":"X","Ｘ":"X","Ẋ":"X","Ẍ":"X","Ⓨ":"Y","Ｙ":"Y","Ỳ":"Y","Ý":"Y","Ŷ":"Y","Ỹ":"Y","Ȳ":"Y","Ẏ":"Y","Ÿ":"Y","Ỷ":"Y","Ỵ":"Y","Ƴ":"Y","Ɏ":"Y","Ỿ":"Y","Ⓩ":"Z","Ｚ":"Z","Ź":"Z","Ẑ":"Z","Ż":"Z","Ž":"Z","Ẓ":"Z","Ẕ":"Z","Ƶ":"Z","Ȥ":"Z","Ɀ":"Z","Ⱬ":"Z","Ꝣ":"Z","ⓐ":"a","ａ":"a","ẚ":"a","à":"a","á":"a","â":"a","ầ":"a","ấ":"a","ẫ":"a","ẩ":"a","ã":"a","ā":"a","ă":"a","ằ":"a","ắ":"a","ẵ":"a","ẳ":"a","ȧ":"a","ǡ":"a","ä":"a","ǟ":"a","ả":"a","å":"a","ǻ":"a","ǎ":"a","ȁ":"a","ȃ":"a","ạ":"a","ậ":"a","ặ":"a","ḁ":"a","ą":"a","ⱥ":"a","ɐ":"a","ꜳ":"aa","æ":"ae","ǽ":"ae","ǣ":"ae","ꜵ":"ao","ꜷ":"au","ꜹ":"av","ꜻ":"av","ꜽ":"ay","ⓑ":"b","ｂ":"b","ḃ":"b","ḅ":"b","ḇ":"b","ƀ":"b","ƃ":"b","ɓ":"b","ⓒ":"c","ｃ":"c","ć":"c","ĉ":"c","ċ":"c","č":"c","ç":"c","ḉ":"c","ƈ":"c","ȼ":"c","ꜿ":"c","ↄ":"c","ⓓ":"d","ｄ":"d","ḋ":"d","ď":"d","ḍ":"d","ḑ":"d","ḓ":"d","ḏ":"d","đ":"d","ƌ":"d","ɖ":"d","ɗ":"d","ꝺ":"d","ǳ":"dz","ǆ":"dz","ⓔ":"e","ｅ":"e","è":"e","é":"e","ê":"e","ề":"e","ế":"e","ễ":"e","ể":"e","ẽ":"e","ē":"e","ḕ":"e","ḗ":"e","ĕ":"e","ė":"e","ë":"e","ẻ":"e","ě":"e","ȅ":"e","ȇ":"e","ẹ":"e","ệ":"e","ȩ":"e","ḝ":"e","ę":"e","ḙ":"e","ḛ":"e","ɇ":"e","ɛ":"e","ǝ":"e","ⓕ":"f","ｆ":"f","ḟ":"f","ƒ":"f","ꝼ":"f","ⓖ":"g","ｇ":"g","ǵ":"g","ĝ":"g","ḡ":"g","ğ":"g","ġ":"g","ǧ":"g","ģ":"g","ǥ":"g","ɠ":"g","ꞡ":"g","ᵹ":"g","ꝿ":"g","ⓗ":"h","ｈ":"h","ĥ":"h","ḣ":"h","ḧ":"h","ȟ":"h","ḥ":"h","ḩ":"h","ḫ":"h","ẖ":"h","ħ":"h","ⱨ":"h","ⱶ":"h","ɥ":"h","ƕ":"hv","ⓘ":"i","ｉ":"i","ì":"i","í":"i","î":"i","ĩ":"i","ī":"i","ĭ":"i","ï":"i","ḯ":"i","ỉ":"i","ǐ":"i","ȉ":"i","ȋ":"i","ị":"i","į":"i","ḭ":"i","ɨ":"i","ı":"i","ⓙ":"j","ｊ":"j","ĵ":"j","ǰ":"j","ɉ":"j","ⓚ":"k","ｋ":"k","ḱ":"k","ǩ":"k","ḳ":"k","ķ":"k","ḵ":"k","ƙ":"k","ⱪ":"k","ꝁ":"k","ꝃ":"k","ꝅ":"k","ꞣ":"k","ⓛ":"l","ｌ":"l","ŀ":"l","ĺ":"l","ľ":"l","ḷ":"l","ḹ":"l","ļ":"l","ḽ":"l","ḻ":"l","ſ":"l","ł":"l","ƚ":"l","ɫ":"l","ⱡ":"l","ꝉ":"l","ꞁ":"l","ꝇ":"l","ǉ":"lj","ⓜ":"m","ｍ":"m","ḿ":"m","ṁ":"m","ṃ":"m","ɱ":"m","ɯ":"m","ⓝ":"n","ｎ":"n","ǹ":"n","ń":"n","ñ":"n","ṅ":"n","ň":"n","ṇ":"n","ņ":"n","ṋ":"n","ṉ":"n","ƞ":"n","ɲ":"n","ŉ":"n","ꞑ":"n","ꞥ":"n","ǌ":"nj","ⓞ":"o","ｏ":"o","ò":"o","ó":"o","ô":"o","ồ":"o","ố":"o","ỗ":"o","ổ":"o","õ":"o","ṍ":"o","ȭ":"o","ṏ":"o","ō":"o","ṑ":"o","ṓ":"o","ŏ":"o","ȯ":"o","ȱ":"o","ö":"o","ȫ":"o","ỏ":"o","ő":"o","ǒ":"o","ȍ":"o","ȏ":"o","ơ":"o","ờ":"o","ớ":"o","ỡ":"o","ở":"o","ợ":"o","ọ":"o","ộ":"o","ǫ":"o","ǭ":"o","ø":"o","ǿ":"o","ɔ":"o","ꝋ":"o","ꝍ":"o","ɵ":"o","ƣ":"oi","ȣ":"ou","ꝏ":"oo","ⓟ":"p","ｐ":"p","ṕ":"p","ṗ":"p","ƥ":"p","ᵽ":"p","ꝑ":"p","ꝓ":"p","ꝕ":"p","ⓠ":"q","ｑ":"q","ɋ":"q","ꝗ":"q","ꝙ":"q","ⓡ":"r","ｒ":"r","ŕ":"r","ṙ":"r","ř":"r","ȑ":"r","ȓ":"r","ṛ":"r","ṝ":"r","ŗ":"r","ṟ":"r","ɍ":"r","ɽ":"r","ꝛ":"r","ꞧ":"r","ꞃ":"r","ⓢ":"s","ｓ":"s","ß":"s","ś":"s","ṥ":"s","ŝ":"s","ṡ":"s","š":"s","ṧ":"s","ṣ":"s","ṩ":"s","ș":"s","ş":"s","ȿ":"s","ꞩ":"s","ꞅ":"s","ẛ":"s","ⓣ":"t","ｔ":"t","ṫ":"t","ẗ":"t","ť":"t","ṭ":"t","ț":"t","ţ":"t","ṱ":"t","ṯ":"t","ŧ":"t","ƭ":"t","ʈ":"t","ⱦ":"t","ꞇ":"t","ꜩ":"tz","ⓤ":"u","ｕ":"u","ù":"u","ú":"u","û":"u","ũ":"u","ṹ":"u","ū":"u","ṻ":"u","ŭ":"u","ü":"u","ǜ":"u","ǘ":"u","ǖ":"u","ǚ":"u","ủ":"u","ů":"u","ű":"u","ǔ":"u","ȕ":"u","ȗ":"u","ư":"u","ừ":"u","ứ":"u","ữ":"u","ử":"u","ự":"u","ụ":"u","ṳ":"u","ų":"u","ṷ":"u","ṵ":"u","ʉ":"u","ⓥ":"v","ｖ":"v","ṽ":"v","ṿ":"v","ʋ":"v","ꝟ":"v","ʌ":"v","ꝡ":"vy","ⓦ":"w","ｗ":"w","ẁ":"w","ẃ":"w","ŵ":"w","ẇ":"w","ẅ":"w","ẘ":"w","ẉ":"w","ⱳ":"w","ⓧ":"x","ｘ":"x","ẋ":"x","ẍ":"x","ⓨ":"y","ｙ":"y","ỳ":"y","ý":"y","ŷ":"y","ỹ":"y","ȳ":"y","ẏ":"y","ÿ":"y","ỷ":"y","ẙ":"y","ỵ":"y","ƴ":"y","ɏ":"y","ỿ":"y","ⓩ":"z","ｚ":"z","ź":"z","ẑ":"z","ż":"z","ž":"z","ẓ":"z","ẕ":"z","ƶ":"z","ȥ":"z","ɀ":"z","ⱬ":"z","ꝣ":"z","Ά":"Α","Έ":"Ε","Ή":"Η","Ί":"Ι","Ϊ":"Ι","Ό":"Ο","Ύ":"Υ","Ϋ":"Υ","Ώ":"Ω","ά":"α","έ":"ε","ή":"η","ί":"ι","ϊ":"ι","ΐ":"ι","ό":"ο","ύ":"υ","ϋ":"υ","ΰ":"υ","ω":"ω","ς":"σ"};return a}),b.define("select2/data/base",["../utils"],function(a){function b(){b.__super__.constructor.call(this)}return a.Extend(b,a.Observable),b.prototype.current=function(){throw new Error("The `current` method must be defined in child classes.")},b.prototype.query=function(){throw new Error("The `query` method must be defined in child classes.")},b.prototype.bind=function(){},b.prototype.destroy=function(){},b.prototype.generateResultId=function(b,c){var d=b.id+"-result-";return d+=a.generateChars(4),d+=null!=c.id?"-"+c.id.toString():"-"+a.generateChars(4)},b}),b.define("select2/data/select",["./base","../utils","jquery"],function(a,b,c){function d(a,b){this.$element=a,this.options=b,d.__super__.constructor.call(this)}return b.Extend(d,a),d.prototype.current=function(a){var b=[],d=this;this.$element.find(":selected").each(function(){var a=c(this),e=d.item(a);b.push(e)}),a(b)},d.prototype.select=function(a){var b=this;if(a.selected=!0,c(a.element).is("option"))return a.element.selected=!0,void this.$element.trigger("change");if(this.$element.prop("multiple"))this.current(function(d){var e=[];a=[a],a.push.apply(a,d);for(var f=0;f<a.length;f++){var g=a[f].id;-1===c.inArray(g,e)&&e.push(g)}b.$element.val(e),b.$element.trigger("change")});else{var d=a.id;this.$element.val(d),this.$element.trigger("change")}},d.prototype.unselect=function(a){var b=this;if(this.$element.prop("multiple"))return a.selected=!1,c(a.element).is("option")?(a.element.selected=!1,void this.$element.trigger("change")):void this.current(function(d){for(var e=[],f=0;f<d.length;f++){var g=d[f].id;g!==a.id&&-1===c.inArray(g,e)&&e.push(g)}b.$element.val(e),b.$element.trigger("change")})},d.prototype.bind=function(a){var b=this;this.container=a,a.on("select",function(a){b.select(a.data)}),a.on("unselect",function(a){b.unselect(a.data)})},d.prototype.destroy=function(){this.$element.find("*").each(function(){c.removeData(this,"data")})},d.prototype.query=function(a,b){var d=[],e=this,f=this.$element.children();f.each(function(){var b=c(this);if(b.is("option")||b.is("optgroup")){var f=e.item(b),g=e.matches(a,f);null!==g&&d.push(g)}}),b({results:d})},d.prototype.addOptions=function(a){b.appendMany(this.$element,a)},d.prototype.option=function(a){var b;a.children?(b=document.createElement("optgroup"),b.label=a.text):(b=document.createElement("option"),void 0!==b.textContent?b.textContent=a.text:b.innerText=a.text),a.id&&(b.value=a.id),a.disabled&&(b.disabled=!0),a.selected&&(b.selected=!0),a.title&&(b.title=a.title);var d=c(b),e=this._normalizeItem(a);return e.element=b,c.data(b,"data",e),d},d.prototype.item=function(a){var b={};
if(b=c.data(a[0],"data"),null!=b)return b;if(a.is("option"))b={id:a.val(),text:a.text(),disabled:a.prop("disabled"),selected:a.prop("selected"),title:a.prop("title")};else if(a.is("optgroup")){b={text:a.prop("label"),children:[],title:a.prop("title")};for(var d=a.children("option"),e=[],f=0;f<d.length;f++){var g=c(d[f]),h=this.item(g);e.push(h)}b.children=e}return b=this._normalizeItem(b),b.element=a[0],c.data(a[0],"data",b),b},d.prototype._normalizeItem=function(a){c.isPlainObject(a)||(a={id:a,text:a}),a=c.extend({},{text:""},a);var b={selected:!1,disabled:!1};return null!=a.id&&(a.id=a.id.toString()),null!=a.text&&(a.text=a.text.toString()),null==a._resultId&&a.id&&null!=this.container&&(a._resultId=this.generateResultId(this.container,a)),c.extend({},b,a)},d.prototype.matches=function(a,b){var c=this.options.get("matcher");return c(a,b)},d}),b.define("select2/data/array",["./select","../utils","jquery"],function(a,b,c){function d(a,b){var c=b.get("data")||[];d.__super__.constructor.call(this,a,b),this.addOptions(this.convertToOptions(c))}return b.Extend(d,a),d.prototype.select=function(a){var b=this.$element.find("option").filter(function(b,c){return c.value==a.id.toString()});0===b.length&&(b=this.option(a),this.addOptions(b)),d.__super__.select.call(this,a)},d.prototype.convertToOptions=function(a){function d(a){return function(){return c(this).val()==a.id}}for(var e=this,f=this.$element.find("option"),g=f.map(function(){return e.item(c(this)).id}).get(),h=[],i=0;i<a.length;i++){var j=this._normalizeItem(a[i]);if(c.inArray(j.id,g)>=0){var k=f.filter(d(j)),l=this.item(k),m=(c.extend(!0,{},l,j),this.option(l));k.replaceWith(m)}else{var n=this.option(j);if(j.children){var o=this.convertToOptions(j.children);b.appendMany(n,o)}h.push(n)}}return h},d}),b.define("select2/data/ajax",["./array","../utils","jquery"],function(a,b,c){function d(b,c){this.ajaxOptions=this._applyDefaults(c.get("ajax")),null!=this.ajaxOptions.processResults&&(this.processResults=this.ajaxOptions.processResults),a.__super__.constructor.call(this,b,c)}return b.Extend(d,a),d.prototype._applyDefaults=function(a){var b={data:function(a){return{q:a.term}},transport:function(a,b,d){var e=c.ajax(a);return e.then(b),e.fail(d),e}};return c.extend({},b,a,!0)},d.prototype.processResults=function(a){return a},d.prototype.query=function(a,b){function d(){var d=f.transport(f,function(d){var f=e.processResults(d,a);e.options.get("debug")&&window.console&&console.error&&(f&&f.results&&c.isArray(f.results)||console.error("Select2: The AJAX results did not return an array in the `results` key of the response.")),b(f)},function(){});e._request=d}var e=this;null!=this._request&&(c.isFunction(this._request.abort)&&this._request.abort(),this._request=null);var f=c.extend({type:"GET"},this.ajaxOptions);"function"==typeof f.url&&(f.url=f.url(a)),"function"==typeof f.data&&(f.data=f.data(a)),this.ajaxOptions.delay&&""!==a.term?(this._queryTimeout&&window.clearTimeout(this._queryTimeout),this._queryTimeout=window.setTimeout(d,this.ajaxOptions.delay)):d()},d}),b.define("select2/data/tags",["jquery"],function(a){function b(b,c,d){var e=d.get("tags"),f=d.get("createTag");if(void 0!==f&&(this.createTag=f),b.call(this,c,d),a.isArray(e))for(var g=0;g<e.length;g++){var h=e[g],i=this._normalizeItem(h),j=this.option(i);this.$element.append(j)}}return b.prototype.query=function(a,b,c){function d(a,f){for(var g=a.results,h=0;h<g.length;h++){var i=g[h],j=null!=i.children&&!d({results:i.children},!0),k=i.text===b.term;if(k||j)return f?!1:(a.data=g,void c(a))}if(f)return!0;var l=e.createTag(b);if(null!=l){var m=e.option(l);m.attr("data-select2-tag",!0),e.addOptions([m]),e.insertTag(g,l)}a.results=g,c(a)}var e=this;return this._removeOldTags(),null==b.term||null!=b.page?void a.call(this,b,c):void a.call(this,b,d)},b.prototype.createTag=function(b,c){var d=a.trim(c.term);return""===d?null:{id:d,text:d}},b.prototype.insertTag=function(a,b,c){b.unshift(c)},b.prototype._removeOldTags=function(){var b=(this._lastTag,this.$element.find("option[data-select2-tag]"));b.each(function(){this.selected||a(this).remove()})},b}),b.define("select2/data/tokenizer",["jquery"],function(a){function b(a,b,c){var d=c.get("tokenizer");void 0!==d&&(this.tokenizer=d),a.call(this,b,c)}return b.prototype.bind=function(a,b,c){a.call(this,b,c),this.$search=b.dropdown.$search||b.selection.$search||c.find(".select2-search__field")},b.prototype.query=function(a,b,c){function d(a){e.select(a)}var e=this;b.term=b.term||"";var f=this.tokenizer(b,this.options,d);f.term!==b.term&&(this.$search.length&&(this.$search.val(f.term),this.$search.focus()),b.term=f.term),a.call(this,b,c)},b.prototype.tokenizer=function(b,c,d,e){for(var f=d.get("tokenSeparators")||[],g=c.term,h=0,i=this.createTag||function(a){return{id:a.term,text:a.term}};h<g.length;){var j=g[h];if(-1!==a.inArray(j,f)){var k=g.substr(0,h),l=a.extend({},c,{term:k}),m=i(l);e(m),g=g.substr(h+1)||"",h=0}else h++}return{term:g}},b}),b.define("select2/data/minimumInputLength",[],function(){function a(a,b,c){this.minimumInputLength=c.get("minimumInputLength"),a.call(this,b,c)}return a.prototype.query=function(a,b,c){return b.term=b.term||"",b.term.length<this.minimumInputLength?void this.trigger("results:message",{message:"inputTooShort",args:{minimum:this.minimumInputLength,input:b.term,params:b}}):void a.call(this,b,c)},a}),b.define("select2/data/maximumInputLength",[],function(){function a(a,b,c){this.maximumInputLength=c.get("maximumInputLength"),a.call(this,b,c)}return a.prototype.query=function(a,b,c){return b.term=b.term||"",this.maximumInputLength>0&&b.term.length>this.maximumInputLength?void this.trigger("results:message",{message:"inputTooLong",args:{maximum:this.maximumInputLength,input:b.term,params:b}}):void a.call(this,b,c)},a}),b.define("select2/data/maximumSelectionLength",[],function(){function a(a,b,c){this.maximumSelectionLength=c.get("maximumSelectionLength"),a.call(this,b,c)}return a.prototype.query=function(a,b,c){var d=this;this.current(function(e){var f=null!=e?e.length:0;return d.maximumSelectionLength>0&&f>=d.maximumSelectionLength?void d.trigger("results:message",{message:"maximumSelected",args:{maximum:d.maximumSelectionLength}}):void a.call(d,b,c)})},a}),b.define("select2/dropdown",["jquery","./utils"],function(a,b){function c(a,b){this.$element=a,this.options=b,c.__super__.constructor.call(this)}return b.Extend(c,b.Observable),c.prototype.render=function(){var b=a('<span class="select2-dropdown"><span class="select2-results"></span></span>');return b.attr("dir",this.options.get("dir")),this.$dropdown=b,b},c.prototype.position=function(){},c.prototype.destroy=function(){this.$dropdown.remove()},c}),b.define("select2/dropdown/search",["jquery","../utils"],function(a){function b(){}return b.prototype.render=function(b){var c=b.call(this),d=a('<span class="select2-search select2-search--dropdown"><input class="select2-search__field" type="search" tabindex="-1" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" role="textbox" /></span>');return this.$searchContainer=d,this.$search=d.find("input"),c.prepend(d),c},b.prototype.bind=function(b,c,d){var e=this;b.call(this,c,d),this.$search.on("keydown",function(a){e.trigger("keypress",a),e._keyUpPrevented=a.isDefaultPrevented()}),this.$search.on("input",function(){a(this).off("keyup")}),this.$search.on("keyup input",function(a){e.handleSearch(a)}),c.on("open",function(){e.$search.attr("tabindex",0),e.$search.focus(),window.setTimeout(function(){e.$search.focus()},0)}),c.on("close",function(){e.$search.attr("tabindex",-1),e.$search.val("")}),c.on("results:all",function(a){if(null==a.query.term||""===a.query.term){var b=e.showSearch(a);b?e.$searchContainer.removeClass("select2-search--hide"):e.$searchContainer.addClass("select2-search--hide")}})},b.prototype.handleSearch=function(){if(!this._keyUpPrevented){var a=this.$search.val();this.trigger("query",{term:a})}this._keyUpPrevented=!1},b.prototype.showSearch=function(){return!0},b}),b.define("select2/dropdown/hidePlaceholder",[],function(){function a(a,b,c,d){this.placeholder=this.normalizePlaceholder(c.get("placeholder")),a.call(this,b,c,d)}return a.prototype.append=function(a,b){b.results=this.removePlaceholder(b.results),a.call(this,b)},a.prototype.normalizePlaceholder=function(a,b){return"string"==typeof b&&(b={id:"",text:b}),b},a.prototype.removePlaceholder=function(a,b){for(var c=b.slice(0),d=b.length-1;d>=0;d--){var e=b[d];this.placeholder.id===e.id&&c.splice(d,1)}return c},a}),b.define("select2/dropdown/infiniteScroll",["jquery"],function(a){function b(a,b,c,d){this.lastParams={},a.call(this,b,c,d),this.$loadingMore=this.createLoadingMore(),this.loading=!1}return b.prototype.append=function(a,b){this.$loadingMore.remove(),this.loading=!1,a.call(this,b),this.showLoadingMore(b)&&this.$results.append(this.$loadingMore)},b.prototype.bind=function(b,c,d){var e=this;b.call(this,c,d),c.on("query",function(a){e.lastParams=a,e.loading=!0}),c.on("query:append",function(a){e.lastParams=a,e.loading=!0}),this.$results.on("scroll",function(){var b=a.contains(document.documentElement,e.$loadingMore[0]);if(!e.loading&&b){var c=e.$results.offset().top+e.$results.outerHeight(!1),d=e.$loadingMore.offset().top+e.$loadingMore.outerHeight(!1);c+50>=d&&e.loadMore()}})},b.prototype.loadMore=function(){this.loading=!0;var b=a.extend({},{page:1},this.lastParams);b.page++,this.trigger("query:append",b)},b.prototype.showLoadingMore=function(a,b){return b.pagination&&b.pagination.more},b.prototype.createLoadingMore=function(){var b=a('<li class="option load-more" role="treeitem"></li>'),c=this.options.get("translations").get("loadingMore");return b.html(c(this.lastParams)),b},b}),b.define("select2/dropdown/attachBody",["jquery","../utils"],function(a,b){function c(a,b,c){this.$dropdownParent=c.get("dropdownParent")||document.body,a.call(this,b,c)}return c.prototype.bind=function(a,b,c){var d=this,e=!1;a.call(this,b,c),b.on("open",function(){d._showDropdown(),d._attachPositioningHandler(b),e||(e=!0,b.on("results:all",function(){d._positionDropdown(),d._resizeDropdown()}),b.on("results:append",function(){d._positionDropdown(),d._resizeDropdown()}))}),b.on("close",function(){d._hideDropdown(),d._detachPositioningHandler(b)}),this.$dropdownContainer.on("mousedown",function(a){a.stopPropagation()})},c.prototype.position=function(a,b,c){b.attr("class",c.attr("class")),b.removeClass("select2"),b.addClass("select2-container--open"),b.css({position:"absolute",top:-999999}),this.$container=c},c.prototype.render=function(b){var c=a("<span></span>"),d=b.call(this);return c.append(d),this.$dropdownContainer=c,c},c.prototype._hideDropdown=function(){this.$dropdownContainer.detach()},c.prototype._attachPositioningHandler=function(c){var d=this,e="scroll.select2."+c.id,f="resize.select2."+c.id,g="orientationchange.select2."+c.id,h=this.$container.parents().filter(b.hasScroll);h.each(function(){a(this).data("select2-scroll-position",{x:a(this).scrollLeft(),y:a(this).scrollTop()})}),h.on(e,function(){var b=a(this).data("select2-scroll-position");a(this).scrollTop(b.y)}),a(window).on(e+" "+f+" "+g,function(){d._positionDropdown(),d._resizeDropdown()})},c.prototype._detachPositioningHandler=function(c){var d="scroll.select2."+c.id,e="resize.select2."+c.id,f="orientationchange.select2."+c.id,g=this.$container.parents().filter(b.hasScroll);g.off(d),a(window).off(d+" "+e+" "+f)},c.prototype._positionDropdown=function(){var b=a(window),c=this.$dropdown.hasClass("select2-dropdown--above"),d=this.$dropdown.hasClass("select2-dropdown--below"),e=null,f=(this.$container.position(),this.$container.offset());f.bottom=f.top+this.$container.outerHeight(!1);var g={height:this.$container.outerHeight(!1)};g.top=f.top,g.bottom=f.top+g.height;var h={height:this.$dropdown.outerHeight(!1)},i={top:b.scrollTop(),bottom:b.scrollTop()+b.height()},j=i.top<f.top-h.height,k=i.bottom>f.bottom+h.height,l={left:f.left,top:g.bottom};c||d||(e="below"),k||!j||c?!j&&k&&c&&(e="below"):e="above",("above"==e||c&&"below"!==e)&&(l.top=g.top-h.height),null!=e&&(this.$dropdown.removeClass("select2-dropdown--below select2-dropdown--above").addClass("select2-dropdown--"+e),this.$container.removeClass("select2-container--below select2-container--above").addClass("select2-container--"+e)),this.$dropdownContainer.css(l)},c.prototype._resizeDropdown=function(){this.$dropdownContainer.width();var a={width:this.$container.outerWidth(!1)+"px"};this.options.get("dropdownAutoWidth")&&(a.minWidth=a.width,a.width="auto"),this.$dropdown.css(a)},c.prototype._showDropdown=function(){this.$dropdownContainer.appendTo(this.$dropdownParent),this._positionDropdown(),this._resizeDropdown()},c}),b.define("select2/dropdown/minimumResultsForSearch",[],function(){function a(b){for(var c=0,d=0;d<b.length;d++){var e=b[d];e.children?c+=a(e.children):c++}return c}function b(a,b,c,d){this.minimumResultsForSearch=c.get("minimumResultsForSearch"),this.minimumResultsForSearch<0&&(this.minimumResultsForSearch=1/0),a.call(this,b,c,d)}return b.prototype.showSearch=function(b,c){return a(c.data.results)<this.minimumResultsForSearch?!1:b.call(this,c)},b}),b.define("select2/dropdown/selectOnClose",[],function(){function a(){}return a.prototype.bind=function(a,b,c){var d=this;a.call(this,b,c),b.on("close",function(){d._handleSelectOnClose()})},a.prototype._handleSelectOnClose=function(){var a=this.getHighlightedResults();a.length<1||this.trigger("select",{data:a.data("data")})},a}),b.define("select2/dropdown/closeOnSelect",[],function(){function a(){}return a.prototype.bind=function(a,b,c){var d=this;a.call(this,b,c),b.on("select",function(a){d._selectTriggered(a)}),b.on("unselect",function(a){d._selectTriggered(a)})},a.prototype._selectTriggered=function(a,b){var c=b.originalEvent;c&&c.ctrlKey||this.trigger("close")},a}),b.define("select2/i18n/en",[],function(){return{errorLoading:function(){return"The results could not be loaded."},inputTooLong:function(a){var b=a.input.length-a.maximum,c="Please delete "+b+" character";return 1!=b&&(c+="s"),c},inputTooShort:function(a){var b=a.minimum-a.input.length,c="Please enter "+b+" or more characters";return c},loadingMore:function(){return"Loading more results…"},maximumSelected:function(a){var b="You can only select "+a.maximum+" item";return 1!=a.maximum&&(b+="s"),b},noResults:function(){return"No results found"},searching:function(){return"Searching…"}}}),b.define("select2/defaults",["jquery","require","./results","./selection/single","./selection/multiple","./selection/placeholder","./selection/allowClear","./selection/search","./selection/eventRelay","./utils","./translation","./diacritics","./data/select","./data/array","./data/ajax","./data/tags","./data/tokenizer","./data/minimumInputLength","./data/maximumInputLength","./data/maximumSelectionLength","./dropdown","./dropdown/search","./dropdown/hidePlaceholder","./dropdown/infiniteScroll","./dropdown/attachBody","./dropdown/minimumResultsForSearch","./dropdown/selectOnClose","./dropdown/closeOnSelect","./i18n/en"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C){function D(){this.reset()}D.prototype.apply=function(l){if(l=a.extend({},this.defaults,l),null==l.dataAdapter){if(l.dataAdapter=null!=l.ajax?o:null!=l.data?n:m,l.minimumInputLength>0&&(l.dataAdapter=j.Decorate(l.dataAdapter,r)),l.maximumInputLength>0&&(l.dataAdapter=j.Decorate(l.dataAdapter,s)),l.maximumSelectionLength>0&&(l.dataAdapter=j.Decorate(l.dataAdapter,t)),l.tags&&(l.dataAdapter=j.Decorate(l.dataAdapter,p)),(null!=l.tokenSeparators||null!=l.tokenizer)&&(l.dataAdapter=j.Decorate(l.dataAdapter,q)),null!=l.query){var C=b(l.amdBase+"compat/query");l.dataAdapter=j.Decorate(l.dataAdapter,C)}if(null!=l.initSelection){var D=b(l.amdBase+"compat/initSelection");l.dataAdapter=j.Decorate(l.dataAdapter,D)}}if(null==l.resultsAdapter&&(l.resultsAdapter=c,null!=l.ajax&&(l.resultsAdapter=j.Decorate(l.resultsAdapter,x)),null!=l.placeholder&&(l.resultsAdapter=j.Decorate(l.resultsAdapter,w)),l.selectOnClose&&(l.resultsAdapter=j.Decorate(l.resultsAdapter,A))),null==l.dropdownAdapter){if(l.multiple)l.dropdownAdapter=u;else{var E=j.Decorate(u,v);l.dropdownAdapter=E}if(0!==l.minimumResultsForSearch&&(l.dropdownAdapter=j.Decorate(l.dropdownAdapter,z)),l.closeOnSelect&&(l.dropdownAdapter=j.Decorate(l.dropdownAdapter,B)),null!=l.dropdownCssClass||null!=l.dropdownCss||null!=l.adaptDropdownCssClass){var F=b(l.amdBase+"compat/dropdownCss");l.dropdownAdapter=j.Decorate(l.dropdownAdapter,F)}l.dropdownAdapter=j.Decorate(l.dropdownAdapter,y)}if(null==l.selectionAdapter){if(l.selectionAdapter=l.multiple?e:d,null!=l.placeholder&&(l.selectionAdapter=j.Decorate(l.selectionAdapter,f)),l.allowClear&&(l.selectionAdapter=j.Decorate(l.selectionAdapter,g)),l.multiple&&(l.selectionAdapter=j.Decorate(l.selectionAdapter,h)),null!=l.containerCssClass||null!=l.containerCss||null!=l.adaptContainerCssClass){var G=b(l.amdBase+"compat/containerCss");l.selectionAdapter=j.Decorate(l.selectionAdapter,G)}l.selectionAdapter=j.Decorate(l.selectionAdapter,i)}if("string"==typeof l.language)if(l.language.indexOf("-")>0){var H=l.language.split("-"),I=H[0];l.language=[l.language,I]}else l.language=[l.language];if(a.isArray(l.language)){var J=new k;l.language.push("en");for(var K=l.language,L=0;L<K.length;L++){var M=K[L],N={};try{N=k.loadPath(M)}catch(O){try{M=this.defaults.amdLanguageBase+M,N=k.loadPath(M)}catch(P){l.debug&&window.console&&console.warn&&console.warn('Select2: The language file for "'+M+'" could not be automatically loaded. A fallback will be used instead.');continue}}J.extend(N)}l.translations=J}else{var Q=k.loadPath(this.defaults.amdLanguageBase+"en"),R=new k(l.language);R.extend(Q),l.translations=R}return l},D.prototype.reset=function(){function b(a){function b(a){return l[a]||a}return a.replace(/[^\u0000-\u007E]/g,b)}function c(d,e){if(""===a.trim(d.term))return e;if(e.children&&e.children.length>0){for(var f=a.extend(!0,{},e),g=e.children.length-1;g>=0;g--){var h=e.children[g],i=c(d,h);null==i&&f.children.splice(g,1)}return f.children.length>0?f:c(d,f)}var j=b(e.text).toUpperCase(),k=b(d.term).toUpperCase();return j.indexOf(k)>-1?e:null}this.defaults={amdBase:"./",amdLanguageBase:"./i18n/",closeOnSelect:!0,debug:!1,dropdownAutoWidth:!1,escapeMarkup:j.escapeMarkup,language:C,matcher:c,minimumInputLength:0,maximumInputLength:0,maximumSelectionLength:0,minimumResultsForSearch:0,selectOnClose:!1,sorter:function(a){return a},templateResult:function(a){return a.text},templateSelection:function(a){return a.text},theme:"default",width:"resolve"}},D.prototype.set=function(b,c){var d=a.camelCase(b),e={};e[d]=c;var f=j._convertData(e);a.extend(this.defaults,f)};var E=new D;return E}),b.define("select2/options",["require","jquery","./defaults","./utils"],function(a,b,c,d){function e(b,e){if(this.options=b,null!=e&&this.fromElement(e),this.options=c.apply(this.options),e&&e.is("input")){var f=a(this.get("amdBase")+"compat/inputData");this.options.dataAdapter=d.Decorate(this.options.dataAdapter,f)}}return e.prototype.fromElement=function(a){var c=["select2"];null==this.options.multiple&&(this.options.multiple=a.prop("multiple")),null==this.options.disabled&&(this.options.disabled=a.prop("disabled")),null==this.options.language&&(a.prop("lang")?this.options.language=a.prop("lang").toLowerCase():a.closest("[lang]").prop("lang")&&(this.options.language=a.closest("[lang]").prop("lang"))),null==this.options.dir&&(this.options.dir=a.prop("dir")?a.prop("dir"):a.closest("[dir]").prop("dir")?a.closest("[dir]").prop("dir"):"ltr"),a.prop("disabled",this.options.disabled),a.prop("multiple",this.options.multiple),a.data("select2Tags")&&(this.options.debug&&window.console&&console.warn&&console.warn('Select2: The `data-select2-tags` attribute has been changed to use the `data-data` and `data-tags="true"` attributes and will be removed in future versions of Select2.'),a.data("data",a.data("select2Tags")),a.data("tags",!0)),a.data("ajaxUrl")&&(this.options.debug&&window.console&&console.warn&&console.warn("Select2: The `data-ajax-url` attribute has been changed to `data-ajax--url` and support for the old attribute will be removed in future versions of Select2."),a.attr("ajax--url",a.data("ajaxUrl")),a.data("ajax--url",a.data("ajaxUrl")));var e={};e=b.fn.jquery&&"1."==b.fn.jquery.substr(0,2)&&a[0].dataset?b.extend(!0,{},a[0].dataset,a.data()):a.data();var f=b.extend(!0,{},e);f=d._convertData(f);for(var g in f)b.inArray(g,c)>-1||(b.isPlainObject(this.options[g])?b.extend(this.options[g],f[g]):this.options[g]=f[g]);return this},e.prototype.get=function(a){return this.options[a]},e.prototype.set=function(a,b){this.options[a]=b},e}),b.define("select2/core",["jquery","./options","./utils","./keys"],function(a,b,c,d){var e=function(a,c){null!=a.data("select2")&&a.data("select2").destroy(),this.$element=a,this.id=this._generateId(a),c=c||{},this.options=new b(c,a),e.__super__.constructor.call(this);var d=a.attr("tabindex")||0;a.data("old-tabindex",d),a.attr("tabindex","-1");var f=this.options.get("dataAdapter");this.dataAdapter=new f(a,this.options);var g=this.render();this._placeContainer(g);var h=this.options.get("selectionAdapter");this.selection=new h(a,this.options),this.$selection=this.selection.render(),this.selection.position(this.$selection,g);var i=this.options.get("dropdownAdapter");this.dropdown=new i(a,this.options),this.$dropdown=this.dropdown.render(),this.dropdown.position(this.$dropdown,g);var j=this.options.get("resultsAdapter");this.results=new j(a,this.options,this.dataAdapter),this.$results=this.results.render(),this.results.position(this.$results,this.$dropdown);var k=this;this._bindAdapters(),this._registerDomEvents(),this._registerDataEvents(),this._registerSelectionEvents(),this._registerDropdownEvents(),this._registerResultsEvents(),this._registerEvents(),this.dataAdapter.current(function(a){k.trigger("selection:update",{data:a})}),a.addClass("select2-hidden-accessible"),a.attr("aria-hidden","true"),this._syncAttributes(),a.data("select2",this)};return c.Extend(e,c.Observable),e.prototype._generateId=function(a){var b="";return b=null!=a.attr("id")?a.attr("id"):null!=a.attr("name")?a.attr("name")+"-"+c.generateChars(2):c.generateChars(4),b="select2-"+b},e.prototype._placeContainer=function(a){a.insertAfter(this.$element);var b=this._resolveWidth(this.$element,this.options.get("width"));null!=b&&a.css("width",b)},e.prototype._resolveWidth=function(a,b){var c=/^width:(([-+]?([0-9]*\.)?[0-9]+)(px|em|ex|%|in|cm|mm|pt|pc))/i;if("resolve"==b){var d=this._resolveWidth(a,"style");return null!=d?d:this._resolveWidth(a,"element")}if("element"==b){var e=a.outerWidth(!1);return 0>=e?"auto":e+"px"}if("style"==b){var f=a.attr("style");if("string"!=typeof f)return null;for(var g=f.split(";"),h=0,i=g.length;i>h;h+=1){var j=g[h].replace(/\s/g,""),k=j.match(c);if(null!==k&&k.length>=1)return k[1]}return null}return b},e.prototype._bindAdapters=function(){this.dataAdapter.bind(this,this.$container),this.selection.bind(this,this.$container),this.dropdown.bind(this,this.$container),this.results.bind(this,this.$container)},e.prototype._registerDomEvents=function(){var b=this;this.$element.on("change.select2",function(){b.dataAdapter.current(function(a){b.trigger("selection:update",{data:a})})}),this._sync=c.bind(this._syncAttributes,this),this.$element[0].attachEvent&&this.$element[0].attachEvent("onpropertychange",this._sync);var d=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;null!=d?(this._observer=new d(function(c){a.each(c,b._sync)}),this._observer.observe(this.$element[0],{attributes:!0,subtree:!1})):this.$element[0].addEventListener&&this.$element[0].addEventListener("DOMAttrModified",b._sync,!1)},e.prototype._registerDataEvents=function(){var a=this;this.dataAdapter.on("*",function(b,c){a.trigger(b,c)})},e.prototype._registerSelectionEvents=function(){var b=this,c=["toggle"];this.selection.on("toggle",function(){b.toggleDropdown()}),this.selection.on("*",function(d,e){-1===a.inArray(d,c)&&b.trigger(d,e)})},e.prototype._registerDropdownEvents=function(){var a=this;this.dropdown.on("*",function(b,c){a.trigger(b,c)})},e.prototype._registerResultsEvents=function(){var a=this;this.results.on("*",function(b,c){a.trigger(b,c)})},e.prototype._registerEvents=function(){var a=this;this.on("open",function(){a.$container.addClass("select2-container--open")}),this.on("close",function(){a.$container.removeClass("select2-container--open")}),this.on("enable",function(){a.$container.removeClass("select2-container--disabled")}),this.on("disable",function(){a.$container.addClass("select2-container--disabled")}),this.on("focus",function(){a.$container.addClass("select2-container--focus")}),this.on("blur",function(){a.$container.removeClass("select2-container--focus")}),this.on("query",function(b){a.isOpen()||a.trigger("open"),this.dataAdapter.query(b,function(c){a.trigger("results:all",{data:c,query:b})})}),this.on("query:append",function(b){this.dataAdapter.query(b,function(c){a.trigger("results:append",{data:c,query:b})})}),this.on("keypress",function(b){var c=b.which;a.isOpen()?c===d.ENTER?(a.trigger("results:select"),b.preventDefault()):c===d.SPACE&&b.ctrlKey?(a.trigger("results:toggle"),b.preventDefault()):c===d.UP?(a.trigger("results:previous"),b.preventDefault()):c===d.DOWN?(a.trigger("results:next"),b.preventDefault()):(c===d.ESC||c===d.TAB)&&(a.close(),b.preventDefault()):(c===d.ENTER||c===d.SPACE||(c===d.DOWN||c===d.UP)&&b.altKey)&&(a.open(),b.preventDefault())})},e.prototype._syncAttributes=function(){this.options.set("disabled",this.$element.prop("disabled")),this.options.get("disabled")?(this.isOpen()&&this.close(),this.trigger("disable")):this.trigger("enable")},e.prototype.trigger=function(a,b){var c=e.__super__.trigger,d={open:"opening",close:"closing",select:"selecting",unselect:"unselecting"};if(a in d){var f=d[a],g={prevented:!1,name:a,args:b};if(c.call(this,f,g),g.prevented)return void(b.prevented=!0)}c.call(this,a,b)},e.prototype.toggleDropdown=function(){this.options.get("disabled")||(this.isOpen()?this.close():this.open())},e.prototype.open=function(){this.isOpen()||(this.trigger("query",{}),this.trigger("open"))},e.prototype.close=function(){this.isOpen()&&this.trigger("close")},e.prototype.isOpen=function(){return this.$container.hasClass("select2-container--open")},e.prototype.enable=function(a){this.options.get("debug")&&window.console&&console.warn&&console.warn('Select2: The `select2("enable")` method has been deprecated and will be removed in later Select2 versions. Use $element.prop("disabled") instead.'),(null==a||0===a.length)&&(a=[!0]);var b=!a[0];this.$element.prop("disabled",b)},e.prototype.data=function(){this.options.get("debug")&&arguments.length>0&&window.console&&console.warn&&console.warn('Select2: Data can no longer be set using `select2("data")`. You should consider setting the value instead using `$element.val()`.');var a=[];return this.dataAdapter.current(function(b){a=b}),a},e.prototype.val=function(b){if(this.options.get("debug")&&window.console&&console.warn&&console.warn('Select2: The `select2("val")` method has been deprecated and will be removed in later Select2 versions. Use $element.val() instead.'),null==b||0===b.length)return this.$element.val();var c=b[0];a.isArray(c)&&(c=a.map(c,function(a){return a.toString()})),this.$element.val(c).trigger("change")},e.prototype.destroy=function(){this.$container.remove(),this.$element[0].detachEvent&&this.$element[0].detachEvent("onpropertychange",this._sync),null!=this._observer?(this._observer.disconnect(),this._observer=null):this.$element[0].removeEventListener&&this.$element[0].removeEventListener("DOMAttrModified",this._sync,!1),this._sync=null,this.$element.off(".select2"),this.$element.attr("tabindex",this.$element.data("old-tabindex")),this.$element.removeClass("select2-hidden-accessible"),this.$element.attr("aria-hidden","false"),this.$element.removeData("select2"),this.dataAdapter.destroy(),this.selection.destroy(),this.dropdown.destroy(),this.results.destroy(),this.dataAdapter=null,this.selection=null,this.dropdown=null,this.results=null},e.prototype.render=function(){var b=a('<span class="select2 select2-container"><span class="selection"></span><span class="dropdown-wrapper" aria-hidden="true"></span></span>');return b.attr("dir",this.options.get("dir")),this.$container=b,this.$container.addClass("select2-container--"+this.options.get("theme")),b.data("element",this.$element),b},e}),b.define("jquery.select2",["jquery","require","./select2/core","./select2/defaults"],function(a,b,c,d){if(b("jquery.mousewheel"),null==a.fn.select2){var e=["open","close","destroy"];a.fn.select2=function(b){if(b=b||{},"object"==typeof b)return this.each(function(){{var d=a.extend({},b,!0);new c(a(this),d)}}),this;if("string"==typeof b){var d=this.data("select2");null==d&&window.console&&console.error&&console.error("The select2('"+b+"') method was called on an element that is not using Select2.");var f=Array.prototype.slice.call(arguments,1),g=d[b](f);return a.inArray(b,e)>-1?this:g}throw new Error("Invalid arguments for Select2: "+b)}}return null==a.fn.select2.defaults&&(a.fn.select2.defaults=d),c}),b.define("jquery.mousewheel",["jquery"],function(a){return a}),{define:b.define,require:b.require}}(),c=b.require("jquery.select2");return a.fn.select2.amd=b,c});
///#source 1 1 Widgets/widget.js
var Widget = Widget || {};

(function ($) {
	Widget = {
		options: {
			name: "",
			fetch: function () { },
			parse: function (data) { },
			bind: function (data) { },
			template: function () { },
			render: function (data) { },
			fail: function (error, event) { },
			load: null,			
			container: {}
		},

		//Enables logging for the default widget load function.
		loggingEnabled: false,

		load: function (options) {
			var self = this;
			self.options = options;

			// Widgets can define their own load function that overrides the default one.
			if (options.load) {
				options.load();
			}
			else {
				var template = options.template();
				$.when(template).done(function () {
					self.log("template complete.");
				}).fail(function () {
					self.log("template failed.");

					options.fail(e, "Template");
				});

				// Fetch
			    $.when(options.fetch()).done(function (f) {
			        self.options = options;
					self.log("fetch complete.");

					// Get Template and Parse fetched data simultaneously
			        $.when(template, options.parse(f)).done(function (t, d) {
			            self.options = options;
						self.log("parse complete.");

						// Bind
			            $.when(options.bind(t, d)).done(function (b) {
			                self.options = options;
							self.log("bind complete.");
							options.render(b);
			            }).fail(function (e) {
			                self.options = options;
							self.log("bind failed.");

							options.fail(e, "Bind");
						});
			        }).fail(function (e) {
			            self.options = options;
						self.log("parse failed.");
						options.fail(e, "Parse");
					});
			    }).fail(function (e) {
			        self.options = options;
					self.log("fetch failed.");
					options.fail(e, "Fetch");
				});
			}
		},

		loadAll: function () {
			var widgets = $('[data-widget]').each(function (i, w) {
				var container = $(w);
				var widgetName = container.data('widget');
				var widget = Widgets[widgetName];
				if (widget) {
					widget.container = w;
					Widget.load(widget);
				}
			});
		},

		log: function (s) {
			var self = this;

			if (self.loggingEnabled && typeof console !== 'undefined') {
				console.log(self.options.name + " - " + s);
			}
		}
	}
})(jQuery);
///#source 1 1 Widgets/MasterPage/advancedPeopleSearchLink.js
var Widgets = Widgets || {};
(function ($) {
	Widgets.advancedPeopleSearchLink = {
		name: "Advanced People Search Link",
		log: true,
		load: function () {
			$(".advancedButtonSearch").each(function () {
				this.href = Bah.configuration.advancedPeopleSearchFormUrl;
			});
		}
	};
})(jQuery);
///#source 1 1 Widgets/MasterPage/footer.js
var Widgets = Widgets || {};
(function ($) {
	Widgets.footer = {
		name: "Footer",
		log: true,
		load: function () {
			$(this.container).attr("href", Bah.configuration.helpUrl)
		}
	};
})(jQuery);
///#source 1 1 Widgets/MasterPage/usageGuidelines.js
var Widgets = Widgets || {};
(function ($) {
    Widgets.usageGuidelines = {
	    name: "Usage Guidelines",
		log: true,
		load: function () {
		    $(this.container).attr("href", Bah.configuration.usageGuidelinesUrl)
		}
	};
})(jQuery);
///#source 1 1 Widgets/MasterPage/mainNavigation.js
var Widgets = Widgets || {};

(function ($) {
	Widgets.mainNavigation = {
		name: "Main Navigation",
		log: true,

		template: function () {
			return $("#mainNavigationTemplate").html();
		},

		fetch: function () {
			var getTermsDeferred = function (termSetName) {
				var deferred = $.Deferred();
				var locale = 1033; //English
				var clientContext = SP.ClientContext.get_current();
				var taxonomySession = SP.Taxonomy.TaxonomySession.getTaxonomySession(clientContext);
				var termStore = taxonomySession.getDefaultSiteCollectionTermStore();
				var termSets = termStore.getTermSetsByName(termSetName, locale);
				var termSet = termSets.getByName(termSetName);
				var terms = termSet.getAllTerms();
				clientContext.load(taxonomySession);
				clientContext.load(termStore);
				clientContext.load(termSet);
				clientContext.load(terms, 'Include(IsRoot, Labels, TermsCount, CustomSortOrder, Id, IsAvailableForTagging, Name, PathOfTerm, Parent, TermSet.Name, LocalCustomProperties, CustomProperties)');
				clientContext.executeQueryAsync(Function.createDelegate(this, function () { deferred.resolve(terms); }),
                                                Function.createDelegate(this, function (sender, args) { deferred.reject(sender, args); }));
				return deferred.promise();
			};
			return getTermsDeferred("Main Navigation");
		},

		parse: function (terms) {
			var viewModel = [];
			if (terms) {
				for (var i = 0; i < terms.get_count() ; i++) {
					var spTerm = terms.getItemAtIndex(i);
					var customProperties = spTerm.get_customProperties();
					var localProperties = spTerm.get_localCustomProperties();
					var isFeedback = (customProperties['Is Feedback'] || "").toString().toLowerCase() == "true";
					viewModel.push({
						name: spTerm.get_name(),
						id: spTerm.get_id().toString(),
						parentid: spTerm.get_isRoot() ? "0" : spTerm.get_parent().get_id().toString(),
						url: isFeedback ? "javascript:void(0);" : localProperties['_Sys_Nav_SimpleLinkUrl'] || "#",
						target: (customProperties['Open in new tab'] || "").toString().toLowerCase() == "true" ? "_BLANK" : "",
						iconUrl: customProperties['Icon URL'] !== undefined ? customProperties['Icon URL'].toString() : null,
						className: isFeedback ? "footerFeedbackRevealLink" : "",
						onClick: isFeedback ? "jQuery('.exit-off-canvas').first().click();" : ""
					});
				}
			}
			var treeModel = Bah.convert2Tree(viewModel);
			return treeModel;
		},

		bind: function (template, data) {
			var template = Handlebars.compile(template);
			var html = template(data);
			return html;
		},

		render: function (html) {
			$(this.container).html(html);
			this.initCollapser();
		},

		fail: function (error, event) {
			Bah.logging.error(event, this.name);
		},

		initCollapser: function () {
			$('.nav-bar').on('click', '.collapser', function () {
				var $this = $(this);
				var $container = $this.parent();
				var $children = $container.find('.collap');

				if ($this.hasClass('active')) {
					$children.slideUp(200);
					$this.removeClass('active');
				}
				else {
					$('.nav-bar .collap').slideUp(200);
					$('.nav-bar .collapser').removeClass('active');

					$this.addClass('active');
					$children.slideDown(200);
				}
			});

			//$('.nav-bar nav ul li ul li ul li a span').on("click", function () {
			    
			//});

			$('.thirdLevelSpan').on('click', function () {
			    window.location.replace($(this).attr("data-orgurl"));
			});

			$('.nav-bar').on('click', '.collapser-child', function () {
			    var $this = $(this);
			    var $container = $this.parent();
			    var $children = $container.find('.collap-child');

			    if ($this.hasClass('active')) {
			        $children.slideUp(200);
			        $this.removeClass('active');
			    }
			    else {
			        $('.nav-bar .collap-child').slideUp(200);
			        $('.nav-bar .collapser-child').removeClass('active');

			        var childListItems = $children.find('li');
			        childListItems.css('display', 'block');
			        
			        $this.addClass('active');
			        $children.slideDown(200);
			    }
			});

			
		}
	};
})(jQuery);
///#source 1 1 Widgets/MasterPage/resourceLinks.js
var Widgets = Widgets || {};
(function ($) {
    Widgets.resourceLinks = {
        name: "Main Navigation Resource",
        log: true,
        fetch: function () {
        	return Bah.configuration.widgets.resources;
        },
        parse: function (terms) {
            var viewModel = [];
            if (terms) {
                for (var i = 0; i < terms.get_count() ; i++) {
                    var spTerm = terms.getItemAtIndex(i);
                    var customProperties = spTerm.get_customProperties();
                    var localProperties = spTerm.get_localCustomProperties();
                    viewModel.push({
                        name: spTerm.get_name(),
                        id: spTerm.get_id().toString(),
                        parentid: spTerm.get_isRoot() ? "0" : spTerm.get_parent().get_id().toString(),
                        url: localProperties['_Sys_Nav_SimpleLinkUrl'] || "#",
                        target: (customProperties['Open in new tab'] || "").toString().toLowerCase() == "true" ? "_BLANK" : ""
                    });
                }
            }
            var treeModel = Bah.convert2Tree(viewModel);
            return treeModel;
        },
        render: function (data) {
            $(this.container).html(data);            
        },

        fail: function (error, event) {
            Bah.logging.error('Error at ' + event, this.name);
        },
        bind: function (template, data) {
            Handlebars.registerPartial("child", $("#resourceLinksChildTemplate").html());
            var template = Handlebars.compile(template);
            var html = template(data);
            return html;
        },
        template: function () {
            return $("#resourceLinksTemplate").html();
        }
    };
})(jQuery);
///#source 1 1 Widgets/MasterPage/stayConnected.js
var Widgets = Widgets || {};
(function ($) {
	Widgets.stayConnected = {
		name: "Stay Connected",
		log: true,
		fetch: function () {
			return Bah.configuration.widgets.stayConnected;
		},
		parse: function (terms) {
			var viewModel = [];
			if (terms) {
				for (var i = 0; i < terms.get_count() ; i++) {
					var spTerm = terms.getItemAtIndex(i);
					var localCustomProperties = spTerm.get_localCustomProperties();
					var customProperties = spTerm.get_customProperties();
					viewModel.push({
						name: spTerm.get_name(),
						id: spTerm.get_id().toString(),
						url: localCustomProperties['_Sys_Nav_SimpleLinkUrl'] || "#",
						target: (customProperties['Open in new tab'] || "").toString().toLowerCase() == "true" ? "_BLANK" : "",
						className: customProperties['Class name'] || ""
					});
				}
			}
			return viewModel;
		},
		render: function (data) {
			$(this.container).html(data);			
		},

		fail: function (error, event) {
			Bah.logging.error('Error at ' + event, this.name);
		},
		bind: function (template, data) {
			var template = Handlebars.compile(template);
			var html = template(data);
			return html;
		},
		template: function () {
			return $("#stayConnectedTemplate").html();
		}
	};
})(jQuery);
///#source 1 1 Widgets/MasterPage/stock.js
var Widgets = Widgets || {};
(function ($) {
	Widgets.stock = {
		name: "Stock Widget",
		log: true,
		yahooApiURL: 'https://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20yahoo.finance.quotes%20where%20symbol%20in%20%28%22BAH%22%29%0A%09%09&env=http%3A%2F%2Fdatatables.org%2Falltables.env&format=json',

		fetch: function () {
			var getData = function () {
				var deferred = $.Deferred();
				var ajax = $.ajax({
					async: false,
					url: Widgets.stock.yahooApiURL,
					type: 'GET',
					async: false,
					jsonpCallback: 'jsonCallback',
					contentType: "application/json",
					dataType: 'jsonp',
					cache: false
				}).success(Function.createDelegate(this, function () {
					deferred.resolve(ajax);
				}))
                .fail(Function.createDelegate(this, function (sender, args) { deferred.reject(sender, args); }));
				return deferred.promise();
			};
			return getData();
		},
		parse: function (ajax) {
			if (ajax.readyState == 4 && ajax.status == 200) {
				var data = ajax.responseJSON;
				var quote = data.query.results.quote.LastTradePriceOnly;
				var change = data.query.results.quote.Change;
				var number = parseFloat(change.replace(/\s/g, "").replace(",", "."))
				var sign = "=";
				if (number > 0) {
					sign = "+"
				} else if (number < 0) {
					sign = "-";
				}
				return { stockValue: quote, stockVariation: change, sign: sign };
			}
			return [];
		},

		bind: function (template, data) {
			return data;
		},

		render: function (data) {
			$("#realTimeQuote").text(data.stockValue);
			if (data.sign == "+") {
				$("#realTimeQuote").attr("class", "stockUp");
				$("nav-bar nav ul li.stock a span").attr("class", "stockUp");
			} else if (data.sign == "-") {
				$("#realTimeQuote").attr("class", "stockDown");
				$("nav-bar nav ul li.stock a span").attr("class", "stockDown");
			} else {
				$("#realTimeQuote").attr("class", "stockEqual");
				$("nav-bar nav ul li.stock a span").attr("class", "stockEqual");
			}			
		},

		fail: function (error, event) {
			Bah.logging.error('Error at ' + event, this.name);
		},

		template: function () {
			return "";
		}
	};

	$(function () {
		$('.stock-info .dropbox-bg').mCustomScrollbar({
			autoHideScrollbar: true,
			mouseWheel: { preventDefault: true }
		});
	});
})(jQuery);
///#source 1 1 Widgets/MasterPage/stockEvents.js
var Widgets = Widgets || {};
(function ($) {
	Widgets.stockEvents = {
		name: "Stock Events Widget",
		log: true,
		fetch: function () {
			var deferred = $.Deferred();

			var result = [];

			var headers = {
				"Accept": "application/json;odata=verbose",
				"content-Type": "application/json;odata=verbose",
				"X-RequestDigest": jQuery("#__REQUESTDIGEST").val()
			}
			var today = new Date();
			var utcToday = $.format.date(today.toUTCString(), 'yyyy') + "-" + (today.getUTCMonth() + 1) + "-" + today.getUTCDate() + $.format.date(today.toUTCString(), 'THH:mm:ss') //yyyy-MM-ddTHH:mm:ss
			var endPointUrl = _spPageContextInfo.webAbsoluteUrl + "/_api/search/postquery";
			var searchQuery = {
				'request': {
					'__metadata': { 'type': 'Microsoft.Office.Server.Search.REST.SearchRequest' },
					'Querytext': 'ContentType:BAH+Event BAHStartDate>=' + utcToday,
					'RowLimit': 2,
					'SortList':
						{
							'results': [
							{
								'Property': 'Rank',
								'Direction': '1'
							},
							{
								'Property': 'BAHStartDate',
								'Direction': '0'
							}
							]
						},
					'ReorderingRules': { 'results': [{ 'MatchValue': 'Investor Event', 'Boost': '10', 'MatchType': '0' }] },
					'SelectProperties': { 'results': ['path', 'title', 'Description', 'BAHStartDate', 'BAHEndDate', 'BAHEventCategory', 'AllDayEvent'] }
				}
			};

			$.ajax({
				url: endPointUrl,
				type: "POST",
				data: JSON.stringify(searchQuery),
				headers: headers,
				async: false,
				dataType: 'json',
				complete: function (xData, status) {
					if (status === "success") {
						result.push(xData.responseJSON);
						deferred.resolve(result);
					}
				},
				cache: false
			});

			return deferred.promise();
		},

		parse: function (result) {
			var viewModel = [];
			var data = result[0];

			if (data.d != undefined) {
				var detailsPageUrl = Bah.configuration.eventDetailsPageUrl;

				var results = data.d.postquery.PrimaryQueryResult.RelevantResults.Table.Rows.results;

				$.each(results, function (index, result) {
					var resultsRow = result.Cells.results;
					var title = Bah.getResultValueByKey('title', resultsRow);

					var url = Bah.getResultValueByKey('path', resultsRow);
					var eventId = url.substring(url.indexOf('?ID=') + 4);
					var sourceUrl = url.substring(0, url.indexOf('/Lists/'));
					var listTitle = url.substring(url.indexOf('/Lists/') + 7, url.lastIndexOf('/'));

					var description = Bah.getResultValueByKey('Description', resultsRow);
					var category = Bah.getResultValueByKey('BAHEventCategory', resultsRow);
					var startDate = new Date(Bah.getResultValueByKey('BAHStartDate', resultsRow) + " UTC");
					var endDate = new Date(Bah.getResultValueByKey('BAHEndDate', resultsRow) + " UTC");
					var allDayEvent = Bah.getResultValueByKey('AllDayEvent', resultsRow) || "";
					var eventMonth = $.format.date(startDate, 'MMM');
					var eventDay = $.format.date(startDate, 'dd');
					var date = "";
					if (allDayEvent.toLowerCase() == "true") {
						date = $.format.date(startDate, 'ddd, dd MMM yyyy') + ", " + "ALL DAY";
					} else {
						date = $.format.date(startDate, 'ddd, dd MMM yyyy | h:mm a');
					}
					viewModel.push({
						title: title, description: description, category: category, date: date, rawDate: startDate,
						url: (detailsPageUrl === "#" ? detailsPageUrl : detailsPageUrl + "?eventId=" + eventId + "&eventDate=" + encodeURIComponent(startDate) + "&sourceUrl=" + sourceUrl + "&listTitle=" + listTitle),
					});
				});
			}

			var sortedModel = lazy(viewModel).sortBy('rawDate').toArray();
			return sortedModel;
		},
		bind: function (template, data) {
			var template = Handlebars.compile(template);
			var html = template(data);
			return html;
		},

		render: function (data) {
			$(this.container).html(data);
			BS.dotdotdoter.parseElement('.stock-info');			
		},

		fail: function (error, event) {
			Bah.logging.error('Error at ' + event, this.name);
		},

		template: function () {
			return $("#stockEventsTemplate").html();
		}
	};
})(jQuery);
///#source 1 1 Widgets/MasterPage/stockNews.js
var Widgets = Widgets || {};
(function ($) {
	Widgets.stockNews = {
		name: "Stock News Widget",
		log: true,
		fetch: function () {
			var headers = {
				"Accept": "application/json;odata=verbose",
				"content-Type": "application/json;odata=verbose",
				"X-RequestDigest": jQuery("#__REQUESTDIGEST").val()
			}

			var endPointUrl = _spPageContextInfo.webAbsoluteUrl + "/_api/search/postquery";
			var searchQuery = {
				'request': {
					'__metadata': { 'type': 'Microsoft.Office.Server.Search.REST.SearchRequest' },
					'Querytext': 'ContentType:News+Article+Page',
					'RowLimit': 2,
					'SortList':
                        {
                        	'results': [
                                {
                                	'Property': 'Rank',
                                	'Direction': '1'
                                },
								{
									'Property': 'bahnewsarticlecategory',
									'Direction': '0'
								}
                        	]
                        },
					'ReorderingRules': { 'results': [{ 'MatchValue': 'Investor News', 'Boost': '10', 'MatchType': '0' }] },
					'SelectProperties': { 'results': ['path', 'url', 'title', 'author', 'write', 'bahnewsarticlecategory', 'created', 'lastmodifiedtime', 'publisheddateowsdate', 'language', 'bahcomments'] }
				}
			};
			var ajax = $.ajax({
				url: endPointUrl,
				type: "POST",
				data: JSON.stringify(searchQuery),
				headers: headers,
				dataType: 'json'
			});

			return ajax;
		},

		parse: function (data) {
			var viewModel = [];
			if (data.d != undefined) {
				var results = data.d.postquery.PrimaryQueryResult.RelevantResults.Table.Rows.results;
				$.each(results, function (index, result) {
					var resultsRow = result.Cells.results;
					var url = Bah.getResultValueByKey('path', resultsRow);
					var title = Bah.getResultValueByKey('title', resultsRow);
					var category = Bah.getResultValueByKey('bahnewsarticlecategory', resultsRow);
					var created = $.format.date(Bah.getResultValueByKey('created', resultsRow), 'ddd, d MMM yyyy | h:mm a');
					var comments = Bah.getResultValueByKey('bahcomments', resultsRow);

					viewModel.push({ title: title, url: url, category: category, created: created, teaser: comments });
				});
			}
			return viewModel;
		},

		bind: function (template, data) {
			var template = Handlebars.compile(template);
			var html = template(data);
			return html;
		},

		render: function (data) {
			$(this.container).html(data);			
		},

		fail: function (error, event) {
			Bah.logging.error('Error at ' + event, this.name);
		},

		template: function () {
			return $("#stockNewsTemplate").html();
		}
	};
})(jQuery);
///#source 1 1 Widgets/MasterPage/userProfileDropdown.js
var Widgets = Widgets || {};
var userProfileLocationPromise = new $.Deferred();
var BAHUserProfileProperties;

(function ($) {
	Widgets.userProfileDropdown = {
		name: "User Profile Dropdown",
		log: true,
		fetch: function () {
		    var accountName;
		    var email;
		    var deferred = $.Deferred();
		    var dataModel = [];
		    var getUserData = function () {
		        var deferred = $.Deferred();
		        var clientContext = new SP.ClientContext.get_current();
		        var peopleManager = new SP.UserProfiles.PeopleManager(clientContext);
		        var userProfileProperties = peopleManager.getMyProperties()
		        clientContext.load(userProfileProperties);
		        clientContext.executeQueryAsync(
                        Function.createDelegate(this,
                            function () {
                                deferred.resolve(userProfileProperties);
                            }),
                        Function.createDelegate(this,
                            function (sender, args) { deferred.reject(sender, args); }));
		        return deferred.promise();
		    };
		    $.when(getUserData()).then(
                function (result) {
                    accountName = encodeURIComponent(result.get_accountName());
                    email = result.get_email();
                    preferredName = result.get_displayName();
                    firstName = preferredName.substring(preferredName.lastIndexOf(",") + 2, preferredName.lastIndexOf("[") - 1);
                    BAHUserProfileProperties = result.get_userProfileProperties();
                    userProfileLocationPromise.resolve();

                    var userQueryUrl = "/_api/SP.UserProfiles.PeopleManager/GetUserProfilePropertyFor(accountName=@v,propertyName='FirstName')?@v='" + accountName + "'";
                    $.when(Bah.queryUserProfileProperties(userQueryUrl)).then(function (finalResult) {
                        dataModel = { userName: accountName, firstName: firstName, email: email };
                        deferred.resolve(dataModel);
                    });
                });
		    return deferred.promise();
		},
		parse: function (result) {
		    if (result) {
		        var viewUrl = Bah.configuration.widgets.userProfileDropdown.viewProfileUrl;
				var editUrl = Bah.configuration.widgets.userProfileDropdown.editProfileUrl;
				var uploadUrl = Bah.configuration.widgets.userProfileDropdown.uploadPhotoUrl;
				var profileUrl = "/" + _spPageContextInfo.layoutsUrl + "/userphoto.aspx?size=L&accountname=" + result.userName;

				return {
				    firstName: result.firstName,
				    email: result.email,
					pictureUrl: profileUrl,
					viewUrl: viewUrl + "?user=" + result.userName,
					editUrl: editUrl + "?user=" + result.userName,
					uploadUrl: uploadUrl
				}
		
			}
			return [];
		},
		bind: function (template, data) {
			return data;
		},
		render: function (data) {
			$('#profileInfoPhoto').css('background-image', 'url('+data.pictureUrl+')');
			$('#profileInfoHello').text('Hello, ');
			$('#profileInfoFirstName').text(data.firstName);
			$('#profileInfoView').attr('href', data.viewUrl);
			$('#profileInfoEdit').attr('href', data.editUrl);
			$('#profileInfoUploadPhoto').attr('href', data.uploadUrl);
			$('#profileInfoUploadPhoto').attr('onclick', "javascript:SelectUserImage(); return false;");

			$('#mobileProfileInfoPhoto').attr('src', data.pictureUrl);
			$('#mobileProfileInfoName').text(data.firstName);
			$('#mobileProfileInfoView').attr('href', data.viewUrl);
			$('#mobileProfileInfoEdit').attr('href', data.editUrl);
			$('#mobileProfileInfoUploadPhoto').attr('href', data.uploadUrl);
			$('#mobileProfileInfoUploadPhoto').attr('onclick', "javascript:SelectUserImage(); return false;");

			$('#mobileProfileInfoEmail').text(data.email);			
		},
		fail: function (error, event) {
			Bah.logging.error('Error at ' + event, this.name);
		},
		template: function () {
			return "";
		}
	};
})(jQuery);
///#source 1 1 Widgets/MasterPage/searchBox.js
var Widgets = Widgets || {};

(function ($) {
	Widgets.searchBox = {
		name: 'Search Box',
		log: true,
		container: '',
		inputContainerId: '#searchBarInput',
		flyoutContainerId: '#searchBarFlyout',
		searchApiUrl: '/_api/search/query',
		handlebarsTemplate: null,
		viewHtml: '',
		queryTimeoutId: -1,
		queryOnHold: false,
		startNewQuery: false,
		hasFocus: false,
		searchUrls: {
			everything: '#',
			people: '#',
			files: '#',
			sites: '#',
			news: '#',
			events: '#'
		},

		//Loads the Search Box widget.
		load: function (options) {
			var self = this;
			self.options = options;
			Widgets.searchBox.container = self.container;
			Widgets.searchBox.loadSearchUrls();

			////Search input change event handler.
			$(self.inputContainerId).keyup(function (e) {
				var key = e.which;

				if (Widgets.searchBox.getSearchString() !== "*") {
					Widgets.searchBox.initQueryProcess();
				}

				//If enter key.
				if (key == 13) {
					Widgets.searchBox.redirectToSearchPage();
					return false;
				}
			});

			////Search input focus event handler.
			$(self.inputContainerId).focus(function () {
                //Display results if there is input
			    if (Widgets.searchBox.getSearchString() !== "") {
			        Widgets.searchBox.hasFocus = true;
			    }

			    //Display content if there is a search
				if (Widgets.searchBox.getSearchString() !== "*") {
					Widgets.searchBox.hasFocus = true;

					////If the flyout already has content just shows it, if not, process the query.
					if ($(Widgets.searchBox.flyoutContainerId).html() !== "") {
						Widgets.searchBox.showFlyout();
						Widgets.searchBox.refreshFlyoutHeight();
					}
					else {
						Widgets.searchBox.initQueryProcess();
					}
				}
			});

			////Document click event handler to close the search flyout when the user clicks outside of it.
			$(document).click(function (e) {
				if (!$(e.target).parents().is('.search-field') && !$(e.target).is('.search-field')) {
					Widgets.searchBox.hideFlyout();
					Widgets.searchBox.hasFocus = false;
				}
				else if ($(e.target).is('.search-field .btn-search')) {
					Widgets.searchBox.redirectToSearchPage();
					return false;
				}
			});

			////Inits the custom scrollbar plugin.
			$('.search-field .input-bg .dropbox-bg').mCustomScrollbar({
				theme: 'minimal-dark',
				mouseWheel: { preventDefault: true }
			});
		},

		//Gets the search urls from the term set.
		loadSearchUrls: function () {
			Widgets.searchBox.searchUrls.everything = Bah.configuration.searchResultsPageUrl;
			Widgets.searchBox.searchUrls.people = Bah.configuration.peopleSearchResultsPageUrl;
			Widgets.searchBox.searchUrls.files = Bah.configuration.filesSearchResultsPageUrl;
			Widgets.searchBox.searchUrls.sites = Bah.configuration.sitesSearchResultsPageUrl;
			Widgets.searchBox.searchUrls.news = Bah.configuration.newsSearchResultsPageUrl;
			Widgets.searchBox.searchUrls.events = Bah.configuration.eventsSearchResultsPageUrl;
		},

	    //Gets the current search string on the search input.
	    //Removed the Star so that it is not appended to query

		getSearchString: function () {
			return $(Widgets.searchBox.inputContainerId).val();
		},

		//Stops the query process.
		stopQueryProcessTimeout: function () {
			if (Widgets.searchBox.queryTimeoutId !== -1) {
				clearTimeout(Widgets.searchBox.queryTimeoutId);
			}
		},

		//Starts a new query if there is no other query already running.
		initQueryProcess: function () {
			Widgets.searchBox.stopQueryProcessTimeout();

			if (Widgets.searchBox.queryOnHold) {
				Widgets.searchBox.startNewQuery = true;
			}
			else {
				Widgets.searchBox.queryTimeoutId = setTimeout(Widgets.searchBox.processQuery, 1000);
			}
		},

		//Queries the search service with the current string on the search input.
		processQuery: function () {
			//Only runs the queries if there's a query string in place on the search input.
			if (Widgets.searchBox.getSearchString() !== "*") {
				////Resets the queryTimeoutId and holds the savings setting queryOnHold on true.
				Widgets.searchBox.queryTimeoutId = -1;
				Widgets.searchBox.queryOnHold = true;

				////Clears the view html.
				Widgets.searchBox.hideFlyout();
				$(Widgets.searchBox.flyoutContainerId).html('');
				Widgets.searchBox.viewHtml = '';

				////Runs all the section queries one by one and finally shows the flyout.
				$.when(Widgets.searchBox.getPeople()).always(function () {
					Widgets.searchBox.afterQuery();
					$.when(Widgets.searchBox.getFiles()).always(function () {
						Widgets.searchBox.afterQuery();
						$.when(Widgets.searchBox.getSites()).always(function () {
							Widgets.searchBox.afterQuery();
							$.when(Widgets.searchBox.getNews()).always(function () {
								Widgets.searchBox.afterQuery();
								$.when(Widgets.searchBox.getEvents()).always(function () {
									////Resets the queryOnHold variable and if there's a pending save process starts it.
									Widgets.searchBox.queryOnHold = false;

									Widgets.searchBox.afterQuery();
								});
							});
						});
					});
				});
			}
		},

		//Decides either to show the flyout or start a new query process.
		afterQuery: function () {
			if (Widgets.searchBox.startNewQuery === true) {
				Widgets.searchBox.startNewQuery = false;
				Widgets.searchBox.initQueryProcess();
			} else {
				////Inserts the view html into the flyout and shows it.
				$(Widgets.searchBox.flyoutContainerId).html(Widgets.searchBox.viewHtml);
				if (Widgets.searchBox.hasFocus) {
					Widgets.searchBox.showFlyout();
					Widgets.searchBox.refreshFlyoutHeight();
				}
			}
		},

		//Redirects the user to the search results page.
		redirectToSearchPage: function () {
			window.location.href = Widgets.searchBox.searchUrls.everything + '#k=' + Widgets.searchBox.getSearchString();
		},

		//Queries the search service to retrieve people.
		//Returns a jQuery promise.
		getPeople: function () {
		    var queryUrl = Widgets.searchBox.searchApiUrl + "?querytext='" + Widgets.searchBox.getSearchString() + "'&trimduplicates=false&sourceid='b09a7990-05ea-4af9-81ef-edfab16c4e31'";
 		                                        

			return $.ajax({
				async: true,
				url: queryUrl,
				type: 'GET',
				headers: { 'Accept': 'application/json; odata=verbose' },
				cache: false,
				success: function (data) {
					if (data.d !== undefined) {
						var results = data.d.query.PrimaryQueryResult.RelevantResults.Table.Rows.results;

						if (results.length > 0) {
						    var totalRows = data.d.query.PrimaryQueryResult.RelevantResults.TotalRowsIncludingDuplicates;
						    var seeAllLegend = results.length > 4 ? 'see all ' + totalRows + ' people' : '';

							var viewModel = {
								title: 'People',
								seeAllUrl: Widgets.searchBox.searchUrls.people + '#k=' + Widgets.searchBox.getSearchString(),
								seeAllLegend: seeAllLegend,
								'class': 'people-list',
								items: []
							};

							////Iterates through the results and creates the item view model.
							$.each(results.slice(0, 4), function (index, result) {
								var resultsRow = result.Cells.results;

								var escapedAccountName = escape(Bah.getResultValueByKey('AccountName', resultsRow));

								var item = {
									title: Bah.getResultValueByKey('PreferredName', resultsRow),
									iconUrl: '/_layouts/15/userphoto.aspx?size=M&accountname=' + escapedAccountName,
									rightLegend: Bah.getResultValueByKey('JobTitle', resultsRow),
									url: '/Pages/View-Profile.aspx?user=' + escapedAccountName
								};

								viewModel.items.push(item);
							});

							Widgets.searchBox.processModel(viewModel);
						}
					}
				}
			});
		},

		//Queries the search service to retrieve files.
		//Returns a jQuery promise.
		getFiles: function () {
			var queryUrl = Widgets.searchBox.searchApiUrl + "?querytext='" + Widgets.searchBox.getSearchString() + "+ContentType:\"Document\"+ContentType:\"Intellectual+Capital\"+ContentType:\"Internal+Resume\"'&trimduplicates=false";

			return $.ajax({
				async: true,
				url: queryUrl,
				type: 'GET',
				headers: { 'Accept': 'application/json; odata=verbose' },
				cache: false,
				success: function (data) {
					if (data.d !== undefined) {
						var results = data.d.query.PrimaryQueryResult.RelevantResults.Table.Rows.results;
						if (results.length > 0) {
						    var totalRows = data.d.query.PrimaryQueryResult.RelevantResults.TotalRowsIncludingDuplicates;
						    var seeAllLegend = results.length > 4 ? 'see all ' + totalRows + ' files' : '';

							var viewModel = {
								title: 'Files',
								seeAllUrl: Widgets.searchBox.searchUrls.files + '#k=' + Widgets.searchBox.getSearchString(),
								seeAllLegend: seeAllLegend,
								'class': 'files-list',
								items: []
							};

							////Iterates through the results and creates the item view model.
							$.each(results.slice(0, 4), function (index, result) {
								var resultsRow = result.Cells.results;

								var eventDateString = Bah.getResultValueByKey('LastModifiedTime', resultsRow)
								var date = '';
								if (eventDateString !== null) {
									var eventDate = new Date(eventDateString);
									var day = eventDate.getDate().toString().length === 1 ? '0' + eventDate.getDate().toString() : eventDate.getDate();
									var month = (eventDate.getMonth() + 1).toString().length === 1 ? '0' + (eventDate.getMonth() + 1).toString() : eventDate.getMonth() + 1;
									var year = eventDate.getFullYear().toString().slice(2, 4);

									date = month + '.' + day + '.' + year;
								}

								var item = {
									title: Bah.getResultValueByKey('Title', resultsRow),
									iconUrl: '/Style Library/BAH/img/img-icon28.png',
									rightLegend: date,
									url: Bah.getResultValueByKey('OriginalPath', resultsRow)
								};

								viewModel.items.push(item);
							});

							Widgets.searchBox.processModel(viewModel);
						}
					}
				}
			});
		},

		//Queries the search service to retrieve Functional Community and Team sites.
		//Returns a jQuery promise.
		getSites: function () {
			var queryUrl = Widgets.searchBox.searchApiUrl + "?querytext='" + Widgets.searchBox.getSearchString() + "+ContentType:\"Functional+Community+Page\"+ContentType:\"Team+Site+Page\"+ContentType:\"Help+Page\"'&trimduplicates=false&selectproperties='ContentType%2c+Title%2c+OriginalPath'";

			return $.ajax({
				async: true,
				url: queryUrl,
				type: 'GET',
				headers: { 'Accept': 'application/json; odata=verbose' },
				cache: false,
				success: function (data) {
					if (data.d !== undefined) {
						var results = data.d.query.PrimaryQueryResult.RelevantResults.Table.Rows.results;

						if (results.length > 0) {
						    var totalRows = data.d.query.PrimaryQueryResult.RelevantResults.TotalRowsIncludingDuplicates;
						    var seeAllLegend = results.length > 4 ? 'see all ' + totalRows + ' sites' : '';

							var viewModel = {
								title: 'Sites',
								seeAllUrl: Widgets.searchBox.searchUrls.sites + '#k=' + Widgets.searchBox.getSearchString(),
								seeAllLegend: seeAllLegend,
								'class': 'comm-list',
								items: []
							};

							////Iterates through the results and creates the item view model.
							$.each(results.slice(0, 4), function (index, result) {
								var resultsRow = result.Cells.results;

								var item = {
									title: Bah.getResultValueByKey('Title', resultsRow),
									iconText: Bah.getResultValueByKey('ContentType', resultsRow).indexOf('Team Site Page') > -1 ? 'TS' : 'FC',
									url: Bah.getResultValueByKey('OriginalPath', resultsRow),
									//rightLegend: Bah.getResultValueByKey('ViewsLifeTime', resultsRow) + ' views'
								};

								viewModel.items.push(item);
							});

							Widgets.searchBox.processModel(viewModel);
						}
					}
				}
			});
		},

		//Queries the search service to retrieve news.
		//Returns a jQuery promise.
		getNews: function () {
			var queryUrl = Widgets.searchBox.searchApiUrl + "?querytext='" + Widgets.searchBox.getSearchString() + "+ContentType:\"News+Article+Page\"+ContentType:\"Functional+Community+News+Article+Page\"'&trimduplicates=false&selectproperties='title%2c+BAHNewsArticleCategory%2c+ArticleByLineOWSTEXT%2c+ArticleStartDateOWSDATE%2c+OriginalPath%2c+PublishingImage%2c+BAHNewsArticleVideoUrl%2c+ViewsLifeTime'"

			return $.ajax({
				async: true,
				url: queryUrl,
				type: 'GET',
				headers: { 'Accept': 'application/json; odata=verbose' },
				cache: false,
				success: function (data) {
					if (data.d !== undefined) {
						var results = data.d.query.PrimaryQueryResult.RelevantResults.Table.Rows.results;

						if (results.length > 0) {
						    var totalRows = data.d.query.PrimaryQueryResult.RelevantResults.TotalRowsIncludingDuplicates;
						    var seeAllLegend = results.length > 4 ? 'see all ' + totalRows + ' news' : '';

							var viewModel = {
								title: 'News',
								seeAllUrl: Widgets.searchBox.searchUrls.news + '#k=' + Widgets.searchBox.getSearchString(),
								seeAllLegend: seeAllLegend,
								'class': 'news-list',
								items: []
							};

							////Iterates through the results and creates the item view model.
							$.each(results.slice(0, 4), function (index, result) {
								var resultsRow = result.Cells.results;

								var views = Bah.getResultValueByKey('ViewsLifeTime', resultsRow) === null ? '0' : Bah.getResultValueByKey('ViewsLifeTime', resultsRow);

								var videoUrl = Bah.alwaysString(Bah.getResultValueByKey('BAHNewsArticleVideoUrl', resultsRow)).trim();

								var item = {
									title: Bah.getResultValueByKey('title', resultsRow),
									iconUrl: '/Style Library/BAH/img/img-icon29.png',
									url: videoUrl || Bah.getResultValueByKey('OriginalPath', resultsRow),
									rightLegend: views + ' views'
								};

								viewModel.items.push(item);
							});

							Widgets.searchBox.processModel(viewModel);
						}
					}
				}
			});
		},

		//Queries the search service to retrieve events.
		//Returns a jQuery promise.
		getEvents: function () {
			var queryUrl = Widgets.searchBox.searchApiUrl + "?querytext='" + Widgets.searchBox.getSearchString() + "+ContentType:\"BAH Event\"+ContentType:\"BAH Functional Community Event\"'&trimduplicates=false&selectproperties='EventDateOWSDATE%2c+Title%2c+OriginalPath%2c+SPWebUrl'";

			return $.ajax({
				async: true,
				url: queryUrl,
				type: 'GET',
				headers: { 'Accept': 'application/json; odata=verbose' },
				cache: false,
				success: function (data) {
					if (data.d !== undefined) {
						var results = data.d.query.PrimaryQueryResult.RelevantResults.Table.Rows.results;

						if (results.length > 0) {
						    var totalRows = data.d.query.PrimaryQueryResult.RelevantResults.TotalRowsIncludingDuplicates;
						    var seeAllLegend = results.length > 4 ? 'see all ' + totalRows + ' events' : '';
							var detailsPageUrl = Bah.configuration.eventDetailsPageUrl;

							var viewModel = {
								title: 'Events',
								seeAllUrl: Widgets.searchBox.searchUrls.events + '#k=' + Widgets.searchBox.getSearchString(),
								seeAllLegend: seeAllLegend,
								'class': 'comm-list',
								items: []
							};

							////Iterates through the results and creates the item view model.
							$.each(results.slice(0, 4), function (index, result) {
								var resultsRow = result.Cells.results;

								var eventDateString = Bah.getResultValueByKey('EventDateOWSDATE', resultsRow)
								var date = '';
								if (eventDateString !== null) {
									var eventDate = new Date(eventDateString);
									var day = eventDate.getDate().toString().length === 1 ? '0' + eventDate.getDate().toString() : eventDate.getDate();
									var month = (eventDate.getMonth() + 1).toString().length === 1 ? '0' + (eventDate.getMonth() + 1).toString() : eventDate.getMonth() + 1;
									var year = eventDate.getFullYear().toString().slice(2, 4);

									date = month + '.' + day + '.' + year;
								}

								var originalPath = Bah.getResultValueByKey('OriginalPath', resultsRow);
								var listName = originalPath.substring(originalPath.indexOf('Lists/') + 6);
								listName = listName.substring(0, listName.indexOf('/'));
								var id = originalPath.substring(originalPath.indexOf('ID=') + 3);

								var url = detailsPageUrl === '#' ? detailsPageUrl : detailsPageUrl + "?eventId=" + id + "&sourceUrl=" + Bah.getResultValueByKey('SPWebUrl', resultsRow) + "&listTitle=" + listName;

								var item = {
									title: Bah.getResultValueByKey('Title', resultsRow),
									iconUrl: '/Style Library/BAH/img/img-icon30.png',
									rightLegend: date,
									url: url
								};

								viewModel.items.push(item);
							});

							Widgets.searchBox.processModel(viewModel);
						}
					}
				}
			});
		},

		//Processes a view model and appends it to the flyout.
		processModel: function (viewModel) {
			if (Widgets.searchBox.handlebarsTemplate === null) {
				Widgets.searchBox.handlebarsTemplate = Handlebars.compile($('#searchBoxSectionTemplate').html());
			}

			var html = Widgets.searchBox.handlebarsTemplate(viewModel);
			Widgets.searchBox.viewHtml += html;
		},

		//Shows the flyout if it's hidden.
		showFlyout: function () {
			var $flyoutParent = $(Widgets.searchBox.flyoutContainerId).closest('.dropbox-bg');
			if ($flyoutParent.is(':hidden')) {
				$flyoutParent.show();
				$(Widgets.searchBox.container).addClass('active');
			}
		},

		//Hides the flyout if it's visible.
		hideFlyout: function () {
			var $flyoutParent = $(Widgets.searchBox.flyoutContainerId).closest('.dropbox-bg');
			if ($flyoutParent.is(":visible")) {
				$flyoutParent.hide();
				$flyoutParent.css('height', 1);
				$(Widgets.searchBox.container).removeClass('active');
			}
		},

		//Calculates the new height for the flyout and animates it.
		refreshFlyoutHeight: function () {
			var $flyoutParent = $(Widgets.searchBox.flyoutContainerId).closest('.dropbox-bg');
			var newHeight = $(Widgets.searchBox.flyoutContainerId).height();
			$flyoutParent.css('height', newHeight);
		},

		fail: function (error, event) {
			Bah.logging.error(event, this.name);
		},
	};
})(jQuery);
///#source 1 1 Widgets/MasterPage/alerts.js
var Widgets = Widgets || {};

(function ($) {
	Widgets.alerts = {
		name: "Alerts",
		log: true,

		logType: {
			log: 0,
			info: 1,
			error: 2
		},

		stop: false,

		filters: [
            'basware',
            'benefits',
            'career_central',
            'certification',
            'eol',
            'fol',
            'mwa',
            'tia',
            'tol'
		],
		hasJustBeenReset: false,

		// OPTIONAL OVERRIDE
		load: function () {
			//Register Events
			var $container = $(this.container);
			var self = this;

			//Handlebars Dependency
			Handlebars.registerHelper('alertDate', function (date, options) {
				var days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
				var amPM = date.getHours() >= 12 ? 'pm' : 'am';
				var hour = date.getHours() % 12;
				if (hour === 0) {
					hour = 12;
				}

				function formatTwoDigits(n) {
					if (n < 10) {
						n = '0' + n;
					}
					return n;
				}

				hour = formatTwoDigits(hour);
				var mins = formatTwoDigits(date.getMinutes());

				return days[date.getDay()] + ' ' + date.getDate() + ', ' + hour + ':' + mins + ' ' + amPM;
			});

			//Listen to children events and fire on the ones we are interested into
			$container.on('click.alerts', '.accordionButton1', function () {
				//REMOVE THE ON CLASS FROM ALL BUTTONS
				$('.accordionButton1').removeClass('active');
				//NO MATTER WHAT WE CLOSE ALL OPEN SLIDES
				$('.accordionContent1').slideUp('normal');
				//IF THE NEXT SLIDE WASN'T OPEN THEN OPEN IT
				if ($(this).next().is(':hidden') == true) {
					//ADD THE ON CLASS TO THE BUTTON
					$(this).addClass('active');
					//OPEN THE SLIDE
					$(this).next().slideDown('normal');
				}
			});

			//Refresh Task
			$container.on('click.alerts', '.icon-refresh', function () {
				//refresh all
				self.hasJustBeenReset = true;
				$container.find('.num').html('?');
				Widget.load(self);
			});

			//Filtering Task
			$container.on('click.alerts', '.tabs li', function () {
				//Click handler of a tab click
				var $this = $(this);
				$this.siblings().filter('.active').removeClass('active');
				$this.addClass('active')

				//now apply correct class to content
				var $temp = $container.find('.content').removeClass().addClass('content active');
				var index = $this.index();
				if (index > 0) {
					$temp.addClass(self.filters[$this.index() - 1] + '-only');
				}
			});

			//call original load method and set this.load to undefined (do not use delete it is much much slower)
			this.load = undefined;
			Widget.load(this);
		},

		template: function () {
			return this.templateCache === undefined ? $("#alertsTemplate").html() : 'Please Use Template Cache';
		},

		fetch: function () {
			var self = this;

			/**
              * Get user ID function changed because no AJAX Call is actually required.
            **/
			function getUserID() {
				var loginName = Bah.alwaysString(_spPageContextInfo.userLoginName).split('@');
				if (loginName[1] && loginName[1].indexOf('onmicrosoft') > -1) {
					return;
				} else {
					return loginName[0];
				}
			}

			//// TODO: Replace this by the actual function to get the token for alerts.
			/**
              * In this function we are assuming that the Authorization Server just gave us the token back
              * now or previously in order to give this to the Resource Server.
              * This function just extracts that token or undefined otherwise
              * Note if token is expired, undefined will be returned aswell.
            **/
			function getAccessToken() {
				return Bah.configuration.apiAccessToken;
			}

			//reset stop state
			this.stop = false;

			return $.when((function () {
				//Check Alerts Rest API Url, then check for a User ID, then search for a valid access token.
				var deferred = $.Deferred();
				var alertsApiUrl = Bah.alwaysString(Bah.configuration.alertsRestApiUrl).trim();
				if (!alertsApiUrl) {
					deferred.reject({ type: self.logType.info, message: "No Alerts Rest API Url given, will do nothing." });
				} else {
                    //adding this check so that test data is always returned in test tenant
				    if (window.location.href.indexOf("bahtest.sharepoint.com") > -1) {
				        var userId = '568266';
				    } else {
				        var userId = getUserID();
				    }
				    
					if (typeof userId === 'undefined') {
						deferred.reject({ type: self.logType.info, message: "Either no user found or user is part of onmicrosoft domain. onmicrosoft don't have Access to Alerts API" });
					} else {
						var token = getAccessToken();
						if (typeof token === 'undefined') {
							deferred.reject({ type: self.logType.info, message: "No access token configured, can't retrieve the alerts." });
						} else {
							deferred.resolve(userId, token, alertsApiUrl);
						}
					}
				}
				return deferred.promise();
			})()).then(function (userId, token, alertsApiUrl) {
				//Ready to call third party service
				return $.ajax({
					headers: {
						Authorization: 'Bearer oauth_token= ' + token,
						Accept: 'application/json'
					},
					contentType: 'application/json; charset=utf-8',
					type: 'GET',
					url: alertsApiUrl + '?employeeId=' + userId
				});
			}).then(function (data) {
				//check if data is an object before proceeding
				if (typeof data === 'object') {
					return { data: data, lastUpdated: new Date() };
				} else {
					return $.Deferred().reject({ type: self.logType.error, message: 'Invalid Data Response from Alerts Rest API' }).promise();
				}
			}).then(null, function (error) {
				//custom error handling
				var deferred = $.Deferred();
				self.stop = true;
				switch (error.type) {
					case self.logType.log:
						Bah.logging.log(error.message, self.name);
						deferred.resolve();
						break;
					case self.logType.info:
						Bah.logging.info(error.message, self.name);
						deferred.resolve();
						break;
					case self.logType.error:
						Bah.logging.error(error.message, self.name);
						deferred.reject(error.message);
						break;
				}
				return deferred.promise();
			});
		},

		parse: function (result) {
			if (this.stop === true) { return; }
			var data = result.data;

			//count
			var counts = lazy(data).countBy(function (alert) {
				return Bah.alwaysString(alert.sourceSystem).toLowerCase();
			}).defaults({
			    
				    basware: 0,
				    benefits: 0,
			        career_central: 0,
				    certification: 0,
				    eol: 0,
                    fol: 0,
				    mwa: 0,
				    tia: 0,
				    tol: 0
			}).toObject();

			var icons = {
			    
                    basware: 'img-icon84.png',
                    benefits: 'img-icon84.png',
                    career_central: 'img-icon85.png',
                    certification: 'img-icon10.png',
                    eol: 'img-icon12.png',
			        fol: 'img-icon12.png',
                    mwa: 'img-icon85.png',
                    tia: 'img-icon84.png',
			        tol: 'img-icon11.png'
			};

			var viewModel = {
				numAlerts: data.length,
				lastUpdated: result.lastUpdated,
				counts: counts
			};

			//parse alerts
			viewModel.alerts = lazy(data).sortBy(function (alert) {
				return alert.statusAsOf;
			}, true).map(function (alert) {
				var sourceSystem = Bah.alwaysString(alert.sourceSystem).toLowerCase();
				return {
					url: alert.links != undefined && alert.links.length >= 2 ? alert.links[1].href : '',
					sourceSystem: sourceSystem,
					iconUrl: icons[sourceSystem],
					message: alert.message
				};
			}).toArray();

			return viewModel;
		},

		bind: function (template, data) {
			if (this.stop === true) { return; }
			if (this.templateCache === undefined) {
				this.templateCache = Handlebars.compile(template);
			}
			var html = this.templateCache(data);
			return html;
		},

		render: function (data) {
		    if (this.stop === true) {
		        var template = Handlebars.compile($('#alertsTemplateNone').html());
		        var html = template('');
		        $(this.container).html(html);
		        return;
		    }
			$(this.container).html(data);
			if (this.hasJustBeenReset) {
				this.hasJustBeenReset = false;
				//simulate click
				$(this.container).find('.accordionButton1').click();
			}
		},

		fail: function (error, event) {
			Bah.logging.error(event, this.name);
		}
	};
})(jQuery);
///#source 1 1 Widgets/MasterPage/footerFeedback.js
var Widgets = Widgets || {};

(function ($) {
	Widgets.footerFeedback = {
		name: 'Footer Feedback',
		log: true,
		load: function (options) {
			var self = this;
			self.options = options;
			Widgets.footerFeedback.container = self.container;
			$.when(Bah.getAllTermsFromTermSet(Bah.Constants.Guid.FeedbackCategoryTermSet),
                            Bah.GetUserDisplayNamePromise()).then(
                function (terms, user) {
                	var data = [];
                	if (terms) {
                		var termEnumerator = terms.getEnumerator();
                		while (termEnumerator.moveNext()) {
                			var term = termEnumerator.get_current();
                			data.push(term.get_name());
                		}
                	}
                	Widgets.footerFeedback.initModal(data, user);
                });
		},

		fail: function (error, event) {
			Bah.logging.error(event, this.name);
		},

		initModal: function (data, user) {
			var template = Handlebars.compile($('#footerFeedbackTemplate').html());
			var html = template();
			$(Widgets.footerFeedback.container).html(html);

			$.each(data, function (key, value) {
				$('#footerFeedbackSelect')
                     .append($('<option>', { value: key })
                     .text(value));
			});
			$("#footerFeedbackUser").text(user);
			$("#footerFeedbackSubmit").attr("disabled", false);
			$("#footerFeedbackSelect").wrap('<div class="select-bg">').selectbox({});
			$('.reveal-modal#footerFeedbackModal').mCustomScrollbar({
				autoHideScrollbar: true,
				mouseWheel: { preventDefault: true }
			});
			$('.footerFeedbackRevealLink').click(function () {
				$('#footerFeedbackModal').foundation('reveal', 'open');
			});

			////Close modal event handler.
			$(document).on('closed.fndtn.reveal', '#footerFeedbackModal[data-reveal]', function () {
				$("#footerFeedbackModal textarea").val("");
				$("#footerFeedbackModal select").val($("#footerFeedbackModal select option:first").val());
				$("#footerFeedbackSubmit").attr("disabled", false);
				$(".ms-formvalidation").text("");
				$("#footerFeedbackModal .sbSelector").text($("#footerFeedbackSelect option:selected").text());
				if ($("#footerFeedbackModal .sbOptions").css('display') !== 'none') {
					$("#footerFeedbackModal .sbOptions").css('display', 'none');
					$("#footerFeedbackModal .sbToggle").trigger("click");
				}
			});

			////Event handler for submitting.
			$("#footerFeedbackSubmit").click(function () {
			    var category = $("#sbSelector_" + $("#footerFeedbackSelect").attr("sb")).text();
				var comments = $("#footerFeedbackComment").val();

				if (comments !== '') {
					$("#footerFeedbackSubmit").attr("disabled", true);
					var item = $.extend({
						"__metadata": { "type": "SP.Data.FeedbackListItem" }
					}, { 'Title': category, 'BAH_FeedbackComment': comments });
					jQuery.ajax({
						url: "/_api/contextinfo",
						type: "POST",
						headers: {
							"Accept": "application/json; odata=verbose"
						},
						contentType: "application/json;odata=verbose",
						success: function (data) {
							var digest = data.d.GetContextWebInformation.FormDigestValue;

							$.ajax({
								async: true,
								url: "/_api/web/lists/GetByTitle('Feedback')/Items",
								type: "POST",
								contentType: "application/json;odata=verbose",
								data: JSON.stringify(item),
								headers: {
									"Accept": "application/json;odata=verbose",
									"X-RequestDigest": digest
								}
							}).done(function (response) {
								Widgets.footerFeedback.showSuccessMessage();
							}).fail(function (response) {
								Bah.logging.info(response, this.name);
								$("#footerFeedbackSubmit").attr("disabled", false);
							});
						}
					});
					$(".ms-formvalidation").text("");
				} else {
					$(".ms-formvalidation").text("Please enter a comment in order to submit the feedback.");
				}
			});
		},
		//Shows a save success message.
		showSuccessMessage: function () {
			$('#footerFeedbackModal .success-message').fadeIn(400, function () {
				setTimeout(function () {
					$('#footerFeedbackModal .success-message').fadeOut(400, function () {
						$('#footerFeedbackModal').foundation('reveal', 'close');
					});
				}, 1500);
			});
		}
	};
})(jQuery);
///#source 1 1 Widgets/MasterPage/footerCopyright.js
var Widgets = Widgets || {};
(function ($) {
	Widgets.footerCopyright = {
		name: "Footer Copyright",
		log: true,
		load: function () {
			this.container.innerHTML = Bah.configuration.footerCopyright;
		}
	};
})(jQuery);
///#source 1 1 Widgets/MasterPage/locationContainer.js
var Widgets = Widgets || {};
(function ($) {
    Widgets.locationContainer = {
        name: "Location Containter",
        log: true,

        getOfficeLocationTermAddress: function (termName) {
            var deferred = $.Deferred();
            var term;
            var termSetId = Bah.Constants.Guid.StreamTermSet; // for Stream term set

            var label = termName;
            var context = SP.ClientContext.get_current();
            var session = SP.Taxonomy.TaxonomySession.getTaxonomySession(context);
            var termStore = session.getDefaultSiteCollectionTermStore();

            // Set up Term Query for termStore.getTerms()
            var termQuery = new SP.Taxonomy.LabelMatchInformation(context);
            // The language code identifier (LCID) of the Term.labels to be matched
            termQuery.set_lcid(1033);
            // Determines if only terms available for tagging are returned
            termQuery.set_trimUnavailable(false);
            // The Label of the Term to get
            termQuery.set_termLabel(label);
            // Get Terms based on termQuery
            var termsStoreTerms = termStore.getTerms(termQuery);
            // Load em' and run execute query!
            context.load(session);
            context.load(termStore);
            context.load(termsStoreTerms);

            context.executeQueryAsync(function () {
                var count = termsStoreTerms.get_count();
                var i = 0
                if (count > 1)  // this for when there are 2 terms with same name, then check for term with acronym property
                {
                    var foundProperty = false;
                    for (i = 0; (i < count && (!foundProperty)) ; i++) {
                        var tempTerm = termsStoreTerms.get_item(i);
                        var termProperties = tempTerm.get_customProperties();
                        for (var p in termProperties) {
                            if (p == "Address1") {
                                foundProperty = true;
                                term = termsStoreTerms.get_item(i);
                            }
                        }//end for var p
                    }//end for i
                }//end if
                else term = termsStoreTerms.get_item(0);

                deferred.resolve(term);
            }, function (sender, args) {
                deferred.reject("JSOM Get getOfficeLocationTermAddress in locationMap Failed: " + args.get_message());
            });

            return deferred.promise();
        },

        load: function (options) {
            $.when(userProfileLocationPromise).then(function () {
                var bahPersonalLocation = BAHUserProfileProperties.BAHPersonalLocation;

                if (bahPersonalLocation.toLowerCase() == 'not specified' || bahPersonalLocation == undefined || bahPersonalLocation.length == 0) {
                    Widgets.locationContainer.getPreference();
                } else {
                    Widgets.locationContainer.getMapAddress(bahPersonalLocation);
                    Widgets.locationContainer.setPreference(bahPersonalLocation);
                }
                //console.log("Office for map: " + bahPersonalLocation);
            });
        },

        getMapAddress: function (bahPersonalLocation) {
            $.when(Widgets.locationContainer.getOfficeLocationTermAddress(bahPersonalLocation).then(
            function (term) {
                var isShowMap = 'false';
                var mapUrl = '';
                var googleMapLink = '';
                var Address1 = '';
                var Address2 = '';

                $('#LocationTitle').text(bahPersonalLocation);
                if (term != undefined) {
                    var termProperties = term.get_customProperties();
                    var isShowMap = termProperties["Show"].toLowerCase();
                    if (isShowMap == 'true') {
                        var mapAddress = termProperties["Address1"] + "," + termProperties["City"] + "," + termProperties["State"] + "," + termProperties["Zip"] + "," + termProperties["Country"];
                        var googleMapKey = Bah.configuration.googleMapKey;
                        mapUrl = 'https://www.google.com/maps/embed/v1/search?q=' + mapAddress + '&key=' + googleMapKey;
                        googleMapLink = 'https://www.google.com/maps/place/' + mapAddress;

                        //console.log("Address for map: " + mapAddress);
                    }

                    Address1 = termProperties["Address1"]+ " " +termProperties["Address2"];
                    Address2 = termProperties["City"]+ ", " +termProperties["State"]+ " " +termProperties["Zip"]+ " " + termProperties["Country"];
                }
                 // Set Address and show map
                $('#Address1').text(Address1);
                $('#Address2').text(Address2);
                Widgets.locationContainer.showMap(isShowMap, mapUrl, googleMapLink);
            })
            );
        },

        showMap: function (isShowMap, mapUrl, googleMapLink) {
            if (isShowMap == 'true') {
                $("#myGoogleMap").attr('src', mapUrl);
                $("#googleLink").attr('href', googleMapLink);
                $("#myGoogleMap").css('display', 'block');
                $("#mapNotAvailable").css('display', 'none');
            }
            else {
                $("#myGoogleMap").css('display', 'none');
                $("#mapNotAvailable").css('display', 'block');
                $("#googleLink").parent().hide();
            }
        },

        getPreference: function () {
            var appweburl;
            var hostweburl;
            var context;
            var userProfileProperties;
            var Locations = new Array();
            var LocationData = new Object();

            $("#LocationSelectionModal").show();
            $("#LocationConfirmedModal").hide();

            $(document).ready(function () {
                SP.SOD.executeOrDelayUntilScriptLoaded(GetTaxonomyInfo, 'SP.Taxonomy.js');
            });

            function GetTaxonomyInfo() {
                var context = SP.ClientContext.get_current();
                var taxSession = SP.Taxonomy.TaxonomySession.getTaxonomySession(context);
                var termStore = taxSession.getDefaultSiteCollectionTermStore();
                var termGroup = termStore.get_groups().getByName("BAH.Intranet");
                var termSet = termGroup.get_termSets().getByName("Office Location");
                var terms = termSet.getAllTerms();
                context.load(terms);
                context.executeQueryAsync(Function.createDelegate(this, GotTaxonomyYay), Function.createDelegate(this, GotTaxonomyNay));

                function GotTaxonomyYay() {
                    var termEnumerator = terms.getEnumerator();

                    var htmlOutput = [];
                    htmlOutput.push("<option></option>");
                    while (termEnumerator.moveNext()) {
                        var currentTerm = termEnumerator.get_current();
                        Locations.push(currentTerm.get_name());
                        htmlOutput.push("<option value=\"" + currentTerm.get_name() + "\">" + currentTerm.get_name() + "</option>");
                    }
                    
                    var select = $("#FindOfficeLocations");
                    $(select).html(htmlOutput.join(""));
                    $(select).select2({
                        placeholder: "Find your current location"
                    });
                }

                function GotTaxonomyNay(sender, args) {
                    $('#Message').text("Error GotTaxNay: " +args.get_message());
                }
            }
        },

        setPreference: function (BahLocation) {
            var appweburl;
            var hostweburl;
            var context;
            var userProfileProperties;
            var BahLocation;
            var Locations = new Array();
            var LocationData = new Object();

            $("#LocationSelectionModal").hide();
            $("#LocationConfirmedModal").show();

            $(document).ready(function () {
                SP.SOD.executeOrDelayUntilScriptLoaded(GetTaxInfo, 'SP.Taxonomy.js');
            });

            function GetTaxInfo() {
                var context = SP.ClientContext.get_current();
                var taxSession = SP.Taxonomy.TaxonomySession.getTaxonomySession(context);
                var termStore = taxSession.getDefaultSiteCollectionTermStore();
                var termGroup = termStore.get_groups().getByName("BAH.Intranet");
                var termSet = termGroup.get_termSets().getByName("Office Location");
                var terms = termSet.getAllTerms();
                context.load(terms);
                context.executeQueryAsync(Function.createDelegate(this, GotTaxYay), Function.createDelegate(this, GotTaxNay));

                function GotTaxYay() {
                    var termEnumerator = terms.getEnumerator();
                    
                    var htmlOutput = [];
                    htmlOutput.push("<option></option>");

                    while (termEnumerator.moveNext()) {
                        var currentTerm = termEnumerator.get_current();
                        var TermMe = new LocationAddress(currentTerm.get_customProperties()["Address1"],
                                                        currentTerm.get_customProperties()["Address2"],
                                                        currentTerm.get_customProperties()["City"],
                                                        currentTerm.get_customProperties()["State"],
                                                        currentTerm.get_customProperties()["Zip"],
                                                        currentTerm.get_customProperties()["Country"],
                                                        currentTerm.get_customProperties()["Show"]);
                        Locations.push(currentTerm.get_name());
                        LocationData[currentTerm.get_name()] = TermMe;
                        htmlOutput.push("<option value=\"" + currentTerm.get_name() + "\">" + currentTerm.get_name() + "</option>");
                    }
                    
                    var select = $("#OfficeLocations");
                    $(select).html(htmlOutput.join(""));
                    $(select).select2();
                    $(select).select2("val", BahLocation);
                }

                function GotTaxNay(sender, args) {
                    $('#Message').text("Error GotTaxNay: " + args.get_message());
                }
            }

            function LocationAddress(address1, address2, city, state, postal, country, show) {
                this.Address1 = address1;
                this.Address2 = address2;
                this.City = city;
                this.State = state;
                this.Postal = postal;
                this.Country = country;
                this.Show = show;
            }
        },

        ButtonClickLS: function() {
            var selectedLocation = $("#OfficeLocations").val();//'One Dulles, VA';
            Bah.updateUserProperty2(BAHUserProfileProperties.AccountName, "BAHPersonalLocation", selectedLocation);
            Widgets.locationContainer.getMapAddress(selectedLocation);
            Widgets.locationNews.displayNews(selectedLocation);
            Widgets.locationEvents.displayEvents(selectedLocation);
        },

        ButtonClickNewLocation: function () {
            var selectedLocation = $("#FindOfficeLocations").val();//'One Dulles, VA';

            Bah.updateUserProperty2(BAHUserProfileProperties.AccountName, "BAHPersonalLocation", selectedLocation);
            Widgets.locationContainer.getMapAddress(selectedLocation);
            Widgets.locationContainer.setPreference(selectedLocation);
            Widgets.locationNews.displayNews(selectedLocation);
            Widgets.locationEvents.displayEvents(selectedLocation);
        },

        ButtonClickCL: function () {
            var selectedLocation = 'Not Specified';
            Bah.updateUserProperty2(BAHUserProfileProperties.AccountName, "BAHPersonalLocation", selectedLocation);
            Widgets.locationContainer.getPreference();
        },
        fail: function (error, event) {
            Bah.logging.error('Error at ' + event, this.name);
        },
    };
})(jQuery);
///#source 1 1 Widgets/MasterPage/locationEvents.js
var Widgets = Widgets || {};
(function ($) {
    Widgets.locationEvents = {
        name: "Location Events",
        log: true,
        getLocalEvents: function (listTitle, bahPersonalLocation) {
            var itemCount = 2;
            var queryUrl = "/_api/search/query?querytext='Contenttypeid:\"0x0102001D7500C1E1DB482A9D852C5BECFD23AA*\"+AND+bahlocation:\"" + bahPersonalLocation + "\"+AND+BAHEndDate>%3dtoday'&selectproperties='SiteName%2cPath%2cTitle%2cDescription%2cbahlocation%2cbahstartdate%2cbaheventrecurrence%2cbahenddate'&trimduplicates=false&rowlimit=" + itemCount;

            return $.ajax({
                async: true,
                url: queryUrl,
                type: "GET",
                headers: {
                    "Accept": "application/json; odata=verbose"
                },
                cache: false
            }).then(function (data) {
                var results = data.d.query.PrimaryQueryResult.RelevantResults.Table.Rows.results;
                return results;
            });  
        },

        displayEvents: function (bahPersonalLocation) {
            var html;
            var viewModel = [];
            var template = Handlebars.compile($('#locationEventsTemplate').html());

                $.when(Widgets.locationEvents.getLocalEvents('Calendar', bahPersonalLocation)).then(function (results) {
                    var viewModel = {
                        viewAllUrl: '',
                        events: [],
                        itemsToDisplay: false
                    };
                    if (results.length >0) {
                        var detailsPageUrl = Bah.configuration.eventDetailsPageUrl;
                        var allEventsUrl = Bah.configuration.eventsListingPageUrl;

                        $.each(results, function (index, result) {
                            $this = $(this);
                            var resultsRow = result.Cells.results;
                            var path = Bah.getResultValueByKey('Path', resultsRow);

                            //get list name from path
                            var getList = path.split('/Lists/');
                            var lists = getList[getList.length - 1].split('/');
                            var listTitle = lists[0];

                            var sourceUrl = Bah.getResultValueByKey('SiteName', resultsRow);
                            var ids = path.split('?ID=')
                            var ID = ids[ids.length - 1];
                            var rec = Bah.getResultValueByKey('baheventrecurrence', resultsRow);
                             ////Formats the event date so all browsers recognize it
                            var itemDate = Bah.getResultValueByKey('bahstartdate', resultsRow);//$.format.date($this.attr("ows_EventDate"), 'MM/dd/yyyy hh:mm:ss a');
                            var eventDate = new Date(itemDate + " UTC");
                            var eventMonth = $.format.date(eventDate, 'MMM');
                            var eventDay = $.format.date(eventDate, 'dd');
                            var startTime = $.format.date(eventDate, 'h:mm a');
                            var bahendtime = new Date(Bah.getResultValueByKey('bahenddate', resultsRow) + " UTC");
                            var endTime = $.format.date(bahendtime, 'h:mm a');
                            var newUrl = detailsPageUrl;
                            var desc = Bah.getResultValueByKey('Description', resultsRow);
                            if (!rec) {
                                newUrl = newUrl === "#" ? newUrl : newUrl + "?eventId=" + ID + "&sourceUrl=" + sourceUrl + "&listTitle=" + listTitle;
                                } else {
                                newUrl = newUrl === "#" ? newUrl : newUrl + "?eventId=" + ID + "&eventDate=" + encodeURIComponent(eventDate) + "&sourceUrl=" + sourceUrl + "&listTitle=" + listTitle;
                            }

                            viewModel.events.push({
                                "EventDate": eventDate,
                                "StartTime": startTime,
                                "EndTime": endTime,
                                "Title": Bah.getResultValueByKey('Title', resultsRow),
                                "Recurrence": (rec === "1" ? true : false),
                                "Description": desc ? $this.html(desc.replace(/&lt;/g, '<').replace(/&gt;/g, '>').replace(/&quot;/g, '"')).text() : '',
                                "Month": eventMonth,
                                "Day": eventDay,
                                "DetailsPage": newUrl
                            });
                        });

                    }//end if (result)

                    if (viewModel.events.length > 0) 
                        viewModel.itemsToDisplay = true;
                    else
                        viewModel.itemsToDisplay = false;

                    html = template(viewModel);
                    $(Widgets.locationEvents.container).html(html);
                });
        },

        load: function (options) {
            var self = this;
            self.options = options;
            $.when(userProfileLocationPromise).then(function () {
                var bahPersonalLocation = BAHUserProfileProperties.BAHPersonalLocation;
                Widgets.locationEvents.displayEvents(bahPersonalLocation);
            });
   },
    };
})(jQuery);

///#source 1 1 Widgets/MasterPage/locationNews.js
var Widgets = Widgets || {};

(function ($) {
    Widgets.locationNews = {
        name: 'Location News',
        log: true,

        displayNews: function (bahPersonalLocation) {
            var html;
            var viewModel = [];
            var template = Handlebars.compile($('#locationNewsTemplate').html());

            bahPersonalLocation.replace(" ", "+");

            var queryUrl = "/_api/search/query?querytext='Contenttypeid:\"0x010100C568DB52D9D0A14D9B2FDCC96666E9F2007948130EC3DB064584E219954237AF3900242457EFB8B24247815D688C526CD44D007AA3961D9E004361B23524B1971FC9CD*\"+AND+BAHLocation:\"" + bahPersonalLocation + "\"'&rowlimit=2&selectproperties='Title%2c+ArticleByLineOWSTEXT%2c+OriginalPath%2c+BAHStream%2c+ViewsRecent%2c+BAHYammerCommentCountOWSNMBR%2c+BAHLocation'";

            $.ajax({
                async: true,
                url: queryUrl,
                type: 'GET',
                headers: { 'Accept': 'application/json; odata=verbose' },
                cache: false,
                success: function (data) {
                    if (data.d !== undefined) {
                        var results = data.d.query.PrimaryQueryResult.RelevantResults.Table.Rows.results;

                        if (results.length > 0) {

                            ////Iterates through the results and creates the item view model.
                            $.each(results, function (index, result) {
                                var resultsRow = result.Cells.results;

                                var item = {
                                    title: Bah.getResultValueByKey('Title', resultsRow),
                                    url: _spPageContextInfo.webServerRelativeUrl + "Pages/Article.aspx?path=" + Bah.getResultValueByKey('OriginalPath', resultsRow),
                                    description: Bah.getResultValueByKey('ArticleByLineOWSTEXT', resultsRow),
                                    viewsRecent: Bah.getResultValueByKey('ViewsRecent', resultsRow),
                                    yammerCommentCount: Bah.getResultValueByKey('BAHYammerCommentCountOWSNMBR', resultsRow)
                                };

                                viewModel.push(item);
                            });
                        }
                    }

                    html = template(viewModel);
                    $(Widgets.locationNews.container).html(html);
                }
            });
        },

        load: function (options) {
            $.when(userProfileLocationPromise).then(function () {
                var bahPersonalLocation = BAHUserProfileProperties.BAHPersonalLocation;
                Widgets.locationNews.displayNews(bahPersonalLocation);

            });
        },

        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);
///#source 1 1 Widgets/HomePage/featuredNews.js
var Widgets = Widgets || {};

(function ($) {
	Widgets.featuredNews = {
		name: 'Featured News',
		log: true,

		load: function (options) {
			var self = this;
			self.options = options;

			var viewModel = {
				categories: [],
				viewArchiveUrl: '',
				sliders: []
			};

			var categories = Bah.configuration.widgets.featuredNews.categories;
			viewModel.viewArchiveUrl = Bah.configuration.widgets.featuredNews.archivePageUrl;

			////If categories is not empty then save them in the view model and make one search query per category.
			if (categories !== '') {
				var promises = [];

				for (var i = 0; i < categories.length; i++) {
					var category = categories[i].trim();
                    //specifiy rowlimit in query to fetch more than 10 items for news rotator
					var queryUrl = "/_api/search/query?querytext='BAHNewsArticleFeatured:\"1\"+ContentType:\"News+Article+Page\"+BAHNewsArticleCategory:\"" + category + "\"'&rowlimit=12&trimduplicates=false&selectproperties='title%2c+BAHNewsArticleCategory%2c+ArticleByLineOWSTEXT%2c+ArticleStartDateOWSDATE%2c+OriginalPath%2c+PublishingImage%2c+BAHNewsArticleVideoUrl'";

					promises.push($.ajax({
						async: true,
						url: queryUrl,
						type: 'GET',
						headers: { 'Accept': 'application/json; odata=verbose' },
						cache: false,
						success: function (data) {
							if (data.d !== undefined) {
								var results = data.d.query.PrimaryQueryResult.RelevantResults.Table.Rows.results;

								if (results.length > 0) {
									var categoryName = Bah.getResultValueByKey('BAHNewsArticleCategory', results[0].Cells.results);

									viewModel.categories.push(
									{
										name: categoryName,
										id: categoryName.replace(/\s+/g, '_')
									});

									var slider = {
										id: categoryName.replace(/\s+/g, '_'),
										items: []
									};

									////Sort items by date.
									results = lazy(results).sortBy(function (item) { return new Date(Bah.getResultValueByKey('ArticleStartDateOWSDATE', item.Cells.results)).getTime(); }, true).toArray();

									////Iterates through the results and creates the item view model.
									$.each(results.slice(0, 12), function (index, result) {
										var resultsRow = result.Cells.results;
										var videoUrl = Bah.alwaysString(Bah.getResultValueByKey('BAHNewsArticleVideoUrl', resultsRow)).trim()/*.split(',')[0]*/;

										var item = {
											title: Bah.getResultValueByKey('title', resultsRow),
											url: videoUrl || Bah.getResultValueByKey('OriginalPath', resultsRow),
											imageUrl: $(Bah.getResultValueByKey('PublishingImage', resultsRow)).attr('src') || '/Style Library/BAH/img/img-newscarousel-placeholder.jpg',
											summary: Bah.getResultValueByKey('ArticleByLineOWSTEXT', resultsRow),
											category: categoryName,
											startDate: new Date(Bah.getResultValueByKey('ArticleStartDateOWSDATE', resultsRow))
										};
										slider.items.push(item);
									});

									////Adds the new slider to the view model.
									viewModel.sliders.push(slider);
								}
							}
						}
					}));
				}

				////When all the 3 ajax search queries finish runs handlebars and inits some plugins.
				$.when.apply($, promises).then(function (data1, data2, data3) {
					var template = Handlebars.compile($('#featuredNewsTemplate').html());

					// Reorder categories based on Termstore configuration
					var categoriesInOrder = lazy(viewModel.categories).sortBy(function (item) { return lazy(categories).indexOf(item.name); });
					var slidersInOrder = lazy(viewModel.sliders).sortBy(function (item) { return lazy(categoriesInOrder).map(function (x) { return x.id }).indexOf(item.id); });
					viewModel.categories = categoriesInOrder.toArray();
					viewModel.sliders = slidersInOrder.toArray();

					var html = template(viewModel);
					$(self.container).html(html);

					////Flexslider init
					$('.flexslider').each(function () {
						$(this).flexslider({
							animation: "move",
							slideshow: true,
							slideshowSpeed: 5000,
							animationSpeed: 600
						});
					});

					$(".slider-main .idTabs").idTabs(function (id) {
						$('.flexslider').resize();
						setTimeout(function () {
							$('.flexslider').resize();
						}, 200);
					});
				});
			}
		},

		fail: function (error, event) {
			Bah.logging.error(event, this.name);
		}
	};
})(jQuery);
///#source 1 1 Widgets/HomePage/myFunctionalCommunities.js
var Widgets = Widgets || {};

(function ($) {
	Widgets.myFunctionalCommunities = {
		name: 'My Functional Communities',
		load: function (options) {
			var self = this;
			self.options = options;

			var viewModel = {
			    viewAllUrl: '',
			    functionalCommunityUrl: Bah.configuration.functionalCommunitiesSiteCollectionUrl,
				communities: [],
				baseUrl: window.location.href,
			};

			var clientContext = SP.ClientContext.get_current();
			var peopleManager = new SP.UserProfiles.PeopleManager(clientContext);
			var personProperties = peopleManager.getMyProperties();
			clientContext.load(personProperties);

			////Calls the query async to get My Functional Communities associated to the current user profile.
			clientContext.executeQueryAsync(Function.createDelegate(this, function () {
				////Once we have the term set we get the primary and functional communities associated to the user.
				var userProfileProperties = personProperties.get_userProfileProperties();
				var primaryCommunity = '';
				var functionalCommunities = '';

				if (userProfileProperties) {
					primaryCommunity = userProfileProperties['BAHFCPrimary'] !== undefined ? userProfileProperties['BAHFCPrimary'] : '';
					functionalCommunities = userProfileProperties['BAHFC'] !== undefined ? userProfileProperties['BAHFC'].toString().replace(/\ /g, '%2b').replace(/\|/g, '+OR+') : '';
				}
				var promises = [];
				var queryUrl = '';

				////If primary community is not empty then make a search query by it.
				if (primaryCommunity != '') {
					queryUrl = "/_api/search/query?querytext='ContentType:\"Functional+Community+Page\"+BAHFunctionalCommunity:\"" + encodeURIComponent(primaryCommunity) + "\"'&trimduplicates=false&rowlimit=1&selectproperties='Title%2c+BAHFCSponsor%2c+Path%2c+BAHFCIcon%2c+BAHFunctionalCommunity%2c+BAHFCSponsorOWSUser'";
					promises.push(Bah.getMyFunctionalCommunities(queryUrl, 1, viewModel));
				}
				////If functional communities are not empty then make a search query by them.
				if (functionalCommunities != '') {
				    queryUrl = "/_api/search/query?querytext='ContentType:\"Functional+Community+Page\"+BAHFunctionalCommunity:" + functionalCommunities + "'&trimduplicates=false&rowlimit=5&selectproperties='Title%2c+BAHFCSponsor%2c+Path%2c+BAHFCIcon%2c+BAHFunctionalCommunity%2c+BAHFCSponsorOWSUser'";
					promises.push(Bah.getMyFunctionalCommunities(queryUrl, 2, viewModel));
				}

				////When all the ajax search queries finish runs handlebars.
				$.when.apply($, promises).then(function (data1, data2, data3) {
					////Sort items by order.
					viewModel.communities.sort(function (a, b) {
						return a.order < b.order ? -1 : a.order > b.order ? 1 : 0;
					});
					////Takes first two elements
					if (viewModel.communities.length > 4) {
						viewModel.communities.splice(4, 4);
					}
					var template = Handlebars.compile($('#myFunctionalCommunitiesTemplate').html());
					var html = template(viewModel);
					$(self.container).html(html);

					BS.dotdotdoter.parseElement('.myFCsWidget');

					Widgets.myCareer.accordionFix();
				});
			}), Function.createDelegate(this, function (sender, args) { Bah.logging.error('Error trying to retrieve My Functional Communities from the current user profile.', this.name); }));
		},

		fail: function (error, event) {
			Bah.logging.error(event, this.name);
		}
	};
})(jQuery);
///#source 1 1 Widgets/HomePage/myResources.js
var Widgets = Widgets || {};

(function ($) {
	Widgets.myResources = {
		name: 'My Resources',
		log: true,
		availableResourcesList: null,
		myResourcesList: null,
		container: '',
		savingTimeoutId: -1,
		savingOnHold: false,
		startNewSave: false,
		edited: false,
		firstLoad: false,
        maxDisplay: 7,

		//Loads My Resources widget.
		load: function (options) {
			var self = this;
			self.options = options;
			Widgets.myResources.container = self.container;

			var promises = [];

			promises.push(Widgets.myResources.loadAvailableResources());

			////When the async process finish, runs handlebars and inits some plugins.
			$.when.apply($, promises).then(function () {
				////Loads my Resources after the other two async processes because we need the Personalization Service URL on the loadMyResources method.
				$.when(Widgets.myResources.loadMyResources()).then(function () {
					Widgets.myResources.initSlider();
					Widgets.myResources.initModal();
				});
			});
		},

		fail: function (error, event) {
			Bah.logging.error(event, this.name);
		},

		//Inits the resources slider.
		initSlider: function () {
			var template = Handlebars.compile($('#myResourcesTemplate').html());
			var html = template(Widgets.myResources.myResourcesList);
			$(Widgets.myResources.container).html(html);

			var $owl = $("#owl-slider");
			$owl.owlCarousel({
				paginationNumbers: false,
				navigation: true,
				autoPlay: false,
				slideSpeed: 300,
				paginationSpeed: 400,
				singleItem: false,
				items: 7,
				itemsCustom: false,
				itemsDesktop: [1199, 5],
				itemsDesktopSmall: [979, 4],
				itemsTablet: [767, 4],
				itemsTabletSmall: [620, 3],
				itemsMobile: [479, 3],
				singleItem: false,
				itemsScaleUp: false
			});

			// Custom Navigation Events
			
			if ($(window).width() > 1199 && (Widgets.myResources.myResourcesList.length < this.maxDisplay)) {
			    $(".nextn").hide();
			    $(".prevp").hide();
			} else if ($(window).width() <= 1199 && (Widgets.myResources.myResourcesList.length < this.maxDisplay - 2)) {
			    $(".nextn").hide();
			    $(".prevp").hide();
			} else {
                 $(".nextn").click(function () {
				    $owl.trigger('owl.next');
			    });
			    $(".prevp").click(function () {
				    $owl.trigger('owl.prev');
			    });
			}

			$('#myResourcesRevealLink').click(function () {
				$('#myResourcesModal').foundation('reveal', 'open');
			});
		},

		//Inits the Manage Your Resources modal.
		initModal: function () {
			////Loads the available and the user resources.
			var template = Handlebars.compile($('#modalResourcesTemplate').html());
			var html = template(Widgets.myResources.availableResourcesList);
			$('#availableResourcesContainer').html(html);

			html = template(Widgets.myResources.myResourcesList);
			$('#myResourcesDrop').html(html);

			Widgets.myResources.disableSelectedResources();

			if (Widgets.myResources.firstLoad) {
				Widgets.myResources.initSavingProcess();
			}

			////Event handler to select resources checkboxes on the available resources section.
			$('#myResourcesModal').on('click', '#availableResourcesContainer aside', function (e) {
				var $this = $(this);
				if (e.target.tagName !== 'INPUT' && !$this.hasClass('disabled')) {
					var $checkbox = $this.find('input');

					$checkbox.prop('checked', !$checkbox.prop('checked'));
				}

				if ($('#availableResourcesContainer input:checked').length) {
					$('#addResources').removeAttr('disabled');
				}
				else {
					$('#addResources').attr('disabled', 'disabled');
				}
			});

			////Event handler to select resources checkboxes on the my resources section.
			$('#myResourcesModal').on('click', '#myResourcesModalContainer aside', function (e) {
				if (e.target.tagName !== 'INPUT' && e.target.tagName !== 'SPAN' && e.target.parentNode.tagName !== 'SPAN') {
					var $this = $(this);
					var $checkbox = $this.find('input');

					$checkbox.prop('checked', !$checkbox.prop('checked'));
				}

				if ($('#myResourcesModalContainer input:checked').length) {
					$('#removeResources').removeAttr('disabled');
				}
				else {
					$('#removeResources').attr('disabled', 'disabled');
				}
			});

			////Event handler for the ordering arrows.
			$('#myResourcesModal').on('click', '#myResourcesModalContainer span.left-arrow', function (e) {
				var $this = $(this);
				var $aside = $this.closest('aside');

				if ($aside.prev('aside').length) {
					$aside.prev('aside').before($aside);

					Widgets.myResources.initSavingProcess();
				}
			});
			$('#myResourcesModal').on('click', '#myResourcesModalContainer span.right-arrow', function (e) {
				var $this = $(this);
				var $aside = $this.closest('aside');

				if ($aside.next('aside').length) {
					$aside.next('aside').after($aside);

					Widgets.myResources.initSavingProcess();
				}
			});

			////Event handler for the add resources button click.
			$('#myResourcesModal').on('click', '#addResources', function () {
				var initSave = false;
				var $myResourcesModalContainer = $('#myResourcesModalContainer');

				$('#availableResourcesContainer input:checked').each(function () {
					var $this = $(this);
					var $aside = $this.closest('aside');
					var currentGuid = $this.attr('value');

					if ($myResourcesModalContainer.find('input[value="' + currentGuid + '"]').length === 0) {
						var clone = $aside.clone();
						clone.find('input').removeAttr('checked');

						$('#myResourcesDrop').append(clone);

						initSave = true;
					}
				});

				if (initSave) {
					Widgets.myResources.initSavingProcess();
				}
			});

			////Event handler for the remove resources button click.
			$('#myResourcesModal').on('click', '#removeResources', function () {
				if ($('#myResourcesModalContainer input:checked').length) {
					$('#myResourcesModalContainer input:checked').each(function () {
						$(this).closest('aside').remove();
					});
					Widgets.myResources.initSavingProcess();
				}
			});

			//Close modal event handler
			$('#myResourcesModal').bind('closed', function () {
			    if (Widgets.myResources.edited === true) {
			        Widgets.myResources.load();
			        Widgets.myResources.edited = false;
			    }
			});

			////Custom Scrollbar
			$('#myResourcesModal .mCustomScrollbar').mCustomScrollbar({
				mouseWheel: { preventDefault: true }
			});
		},

		//Disables all the user selected resources from the available resources section in the modal.
		disableSelectedResources: function () {
			$('#availableResourcesContainer aside').each(function () {
				var $aside = $(this);
				var $checkbox = $('input', $aside);

				$checkbox.removeAttr('disabled').removeAttr('checked');
				$aside.removeClass('disabled');
			});

			$('#addResources').attr('disabled', 'disabled');

			var $availableResourcesContainer = $('#availableResourcesContainer');
			$('#myResourcesModalContainer input').each(function () {
				var $this = $(this);
				var currentGuid = $this.attr('value');

				var $availableInput = $availableResourcesContainer.find('input[value="' + currentGuid + '"]');
				var $availableAside = $availableInput.closest('aside');

				$availableInput.attr('disabled', 'true');
				$availableAside.addClass('disabled');
			});
		},

		//Load all the available resources from the Resources list.
		loadAvailableResources: function () {
			if (Widgets.myResources.availableResourcesList === null) {
				var deferred = $.Deferred();

				var clientContext = new SP.ClientContext.get_current();
				var oList = clientContext.get_web().get_lists().getByTitle('Resources');

				var camlQuery = new SP.CamlQuery();
				var availableResources = oList.getItems(camlQuery);

				clientContext.load(availableResources);
				clientContext.executeQueryAsync(Function.createDelegate(this, function () {
					if (availableResources !== null) {
						var listItemEnumerator = availableResources.getEnumerator();
						var viewModel = [];

						while (listItemEnumerator.moveNext()) {
							var oListItem = listItemEnumerator.get_current();

							var title = oListItem.get_item('Title');
							var guid = oListItem.get_item('GUID').toString();
							var image = $(oListItem.get_item('BAH_ResourceImage') || "").attr('src');
							var url = oListItem.get_item('BAH_ResourceUrl').get_url();
							var tooltip = oListItem.get_item('BAH_ResourceTooltip');

							viewModel.push({
								title: title,
								iconUrl: image,
								guid: guid,
								url: url,
								tooltip: tooltip
							});
						}

						Widgets.myResources.availableResourcesList = viewModel;

						deferred.resolve();
					}
					else {
						deferred.reject();
					}
				}), Function.createDelegate(this, function () {
					Bah.logging.error('Error trying to retrieve available resources', this.name);
					deferred.reject();
				}));

				return deferred.promise();
			}
			else {
				return true;
			}
		},

		//Loads all the user saved resources from the personalize DB.
		loadMyResources: function () {
			var data = {
				userLoginName: _spPageContextInfo.userLoginName,
				tenantUrl: _spPageContextInfo.webAbsoluteUrl
			};

			var serviceUrl = Bah.configuration.personalizationServiceUrl + '/GetUserResources';

			return $.ajax({
				async: true,
				url: serviceUrl,
				type: 'GET',
				data: data,
				dataType: "jsonp",
				contentType: "application/json",
				cache: false
			}).done(function (response) {
				if (response !== null && response.Resources !== null && response.userIsFlagged) {
					if (Widgets.myResources.availableResourcesList !== null) {
						response.Resources.sort(function (a, b) {
							var aPosition = a.Position;
							var bPosition = b.Position;

							if (aPosition < bPosition) {
								return -1;
							}
							else if (aPosition === bPosition) {
								return 0;
							}
							else {
								return 1;
							}
						});

						var model = [];

						$.each(response.Resources, function (i, currentResource) {
							var availableResource = $.grep(Widgets.myResources.availableResourcesList, function (object, i) {
								return object.guid === currentResource.ResourceId;
							});

							if (availableResource !== undefined && availableResource[0] !== undefined) {
								model.push(availableResource[0]);
							}
						});

						Widgets.myResources.myResourcesList = model;
					}
				}
				else {
					//Loads the first 7 items for the user.
					if (Widgets.myResources.availableResourcesList !== null) {
						Widgets.myResources.myResourcesList = Widgets.myResources.availableResourcesList.slice(0, 7);
						Widgets.myResources.firstLoad = true;
					}
				}
			}).fail(function (response) {
				Bah.logging.error(response, this.name);
			});
		},

		//Handles the chained save timeouts.
		initSavingProcess: function () {
			if (Widgets.myResources.savingTimeoutId !== -1) {
				clearTimeout(Widgets.myResources.savingTimeoutId);
			}

			if (Widgets.myResources.savingOnHold) {
				Widgets.myResources.startNewSave = true;
			}
			else {
				Widgets.myResources.savingTimeoutId = setTimeout(Widgets.myResources.saveMyResources, 1000);
			}
		},

		//Saves the resources for the current user.
		saveMyResources: function () {
			////Resets the savingTimeoutId and holds the savings setting savingOnHold on true.
			Widgets.myResources.savingTimeoutId = -1;
			Widgets.myResources.savingOnHold = true;

			var data = {
				UserLoginName: _spPageContextInfo.userLoginName,
				TenantUrl: _spPageContextInfo.webAbsoluteUrl,
				Resources: []
			};

			$('#myResourcesModalContainer input').each(function (i) {
				var $this = $(this);
				var guid = $this.attr('value');

				data.Resources.push({
					ResourceId: guid,
					Position: i + 1,
				});
			});

			var serviceUrl = Bah.configuration.personalizationServiceUrl + '/SaveUserResources';

			$.ajax({
				async: true,
				url: serviceUrl,
				type: 'GET',
				data: { userResources: JSON.stringify(data) },
				dataType: "jsonp",
				contentType: "application/json",
				cache: false
			}).done(function (response) {
				Widgets.myResources.edited = true;
				Widgets.myResources.showSuccessMessage();
				Widgets.myResources.disableSelectedResources();
			}).fail(function (response) {
				Bah.logging.error(response, this.name);
			}).always(function (response) {
				////Resets the savingOnHold variable and if there's a pending save process starts it.
				Widgets.myResources.savingOnHold = false;

				if (Widgets.myResources.startNewSave === true) {
					Widgets.myResources.startNewSave = false;
					Widgets.myResources.initSavingProcess();
				}
			});
		},

		//Shows a save success message.
		showSuccessMessage: function () {
			$('#myResourcesModal .success-message').fadeIn(400, function () {
				setTimeout(function () {
					$('#myResourcesModal .success-message').fadeOut(400);
				}, 1500);
			});
		}
	};
})(jQuery);
///#source 1 1 Widgets/HomePage/customizeMyNewsFeed.js
var Widgets = Widgets || {};

(function ($) {
    
    Widgets.customizeMyNewsFeed = {
        name: "Customize My News Feed",
        log: true,
        groups: [], // array to hold groups and child accounts
        getAccounts: function (groupTerm) { // function returns a promise containing all accounts for a given group term
            var deferred = $.Deferred();
            var clientContext = SP.ClientContext.get_current();
            // initialize group object that will contain group name and an array of accounts that belong to group
            var group = {
                name: groupTerm.get_name(),
                accounts: []
            };
            if (groupTerm.get_termsCount() > 0) { // only get accounts if they exist
                var accountsTerms = groupTerm.get_terms();
                clientContext.load(accountsTerms);
                clientContext.executeQueryAsync(
                    Function.createDelegate(this,
                        function () {
                            var accountsTermsEnumerator = accountsTerms.getEnumerator();
                            while (accountsTermsEnumerator.moveNext()) {
                                var currentAccountTerm = accountsTermsEnumerator.get_current(); // get account term
                                // init account object and push to group.accounts[] array
                                var account = {
                                    name: currentAccountTerm.get_name()
                                };
                                group.accounts.push(account);
                            }
                            Widgets.customizeMyNewsFeed.groups.push(group); //push fully created group object into groups[] array
                            deferred.resolve();
                        }),
                    Function.createDelegate(this,
                        function (sender, args) { deferred.reject(sender, args); }));
            }
            else {
                Widgets.customizeMyNewsFeed.groups.push(group); // push group into groups[] array
                deferred.resolve();
            }
            return deferred.promise();
        },
        initView: function () {
            var self = this;
            if (Widgets.customizeMyNewsFeed.groups.length > 0) {
                var template = Handlebars.compile($('#customizeMyNewsFeedTemplate').html());
                this.groups = Widgets.customizeMyNewsFeed.groups.sort(function (a, b) {
                    if (a.name > b.name) return 1;
                    if (a.name > b.name) return -1;
                    return 0;
                });

                var model = { groups: Widgets.customizeMyNewsFeed.groups };
                var html = template(model);

                $(Widgets.customizeMyNewsFeed.container).html(html);
                $(document).foundation('reveal', 'reflow');
                $(document).foundation('tab', 'reflow');

                $("#showMyNewsFeedModal").on("click", function () {
                                        
                    $("#showMyNewsFeedModal").hide();
                    $("#loadingMyNewsFeedModal").show();
                    
                    //clear the error message if any is shown
                    $("#displayError").text("");
                    //when one of the group check boxes is selected/de-selected, toggle the children selections
                    $(".checkAll").click(function () {
                        var checkboxes = $(this).closest('fieldset').find(':checkbox');
                        if ($(this).is(':checked')) {
                            checkboxes.prop('checked', true);
                        } else {
                            checkboxes.prop('checked', false);
                        }
                    });

                    //get the users selections stored in their profile
                    self.getMyFeed().then(function (data) {
                        //split the selections into an array
                        var selections = data.split("|");
                        //loop through each checkbox
                        $("#myNewsFeedModal input[type=checkbox]").each(function () {
                            var chkVal = $(this).val();
                            //use grep to see if the checkbox value has a match in the array
                            var matches = $.grep(selections, function (value, index) {
                                return value == chkVal;
                            });
                            //if there is a match, check the checkbox
                            if (matches.length > 0) {
                                $(this).prop('checked', true);
                            }
                        });
                         
                        //only open the newsfeed modal after we have gotten the users feed and updated the checkbox values
                        $("#myNewsFeedModal").foundation("reveal", "open");
                        $("#showMyNewsFeedModal").show();
                        $("#loadingMyNewsFeedModal").hide();
                    });
                });
               
                $("#closeMyNewsFeedModal").on("click", function () {
                    $("#myNewsFeedModal").foundation("reveal", "close");
                });

                $("#updateMyNewsFeed").click(function () {
                    //clear the error message if any is shown
                    $("#displayError").text("");
                    var selections = "";
                    //grab all the user selections
                    $.each($("input[name='feedItem']:checked"), function () {
                        selections += $(this).val() + "|"
                    });
                    //save the selections in the user profile, if successful then close the modal
                    self.saveMyFeed(selections.substring(0, selections.length - 1)).then(function (data) {
                        if (data == "success") {
                            $("#myNewsFeedModal").foundation("reveal", "close");

                            // reload myNewsFeed widget in order to display user's updated subscriptions
                            Widgets.myNewsFeed.load();
                        }
                    });
                });

                $('#myNewsFeedModal').bind('open', function () {
                    
                });
            }
        },
        getGroups: function(){ // function returns a promise that contains terms under the Stream termset that meet specific criteria
            var deferred = $.Deferred();
            var clientContext = SP.ClientContext.get_current();
            // init termstore specific objects
            var session = SP.Taxonomy.TaxonomySession.getTaxonomySession(clientContext);
            var termStore = session.getDefaultSiteCollectionTermStore();
            var termSet = termStore.getTermSet(Bah.Constants.Guid.StreamTermSet);

            // cpmi object allows you to search for termsets that only contain specific properties
            // in our case we are looking for any terms under the "Stream" termset that contain the property
            // "Display" feed set to true
            var cpmi = new SP.Taxonomy.CustomPropertyMatchInformation.newObject(clientContext);
            cpmi.set_customPropertyName("DisplayFeed");
            cpmi.set_customPropertyValue("true");
            cpmi.set_stringMatchOption(SP.Taxonomy.StringMatchOption.exactMatch);
            cpmi.set_trimUnavailable(false);

            var groupsTerms = termSet.getTermsWithCustomProperty(cpmi);

            //load terms
            clientContext.load(groupsTerms);
            clientContext.executeQueryAsync(
                        Function.createDelegate(this,
                            function () {
                                deferred.resolve(groupsTerms); // return terms to listners
                            }),
                        Function.createDelegate(this,
                            function (sender, args) { deferred.reject(sender, args); }));
            return deferred.promise();
        },
        load: function (options) {
            var self = this;
            self.options = options;

            $.when(self.getGroups()).then(function (groupTerms) { // get groups under Stream termset
                var promises = []; // array to hold calls to getAccounts function that returns a promise
                var groupTermsEnumerator = groupTerms.getEnumerator();
                while (groupTermsEnumerator.moveNext()) {
                    var groupTermsCurrentItem = groupTermsEnumerator.get_current();
                    promises.push(self.getAccounts(groupTermsCurrentItem));
                }

                $.when.apply($, promises).then(function () { // when all of the promises have resolved init the view
                    self.initView();

                });
                
            });
        },
        getUserData: function() {
            var deferred = $.Deferred();
            var clientContext = new SP.ClientContext.get_current();
            var peopleManager = new SP.UserProfiles.PeopleManager(clientContext);
            var userProfileProperties = peopleManager.getMyProperties()
            clientContext.load(userProfileProperties);
            clientContext.executeQueryAsync(
                    Function.createDelegate(this,
                        function () {
                            deferred.resolve(userProfileProperties);
                        }),
                    Function.createDelegate(this,
                        function (sender, args) { deferred.reject(sender, args); }));
            return deferred.promise();
        },
        getMyFeed: function () {
            var self = this;
            var deferred = $.Deferred();
            var userPersonalFeed;
            $.when(this.getUserData()).then(
                function (userProfileProperties) {
                    var clientContext = new SP.ClientContext.get_current();
                    var peopleManager = new SP.UserProfiles.PeopleManager(clientContext);
                    //Get the account name of the current user. It will be in the following format: "i:0#.f|membership|username@yoursite.onmicrosoft.com"
                    var currentUserAccountName = userProfileProperties.get_accountName();
                    //get the value from their user profile
                    userPersonalFeed = peopleManager.getUserProfilePropertyFor(currentUserAccountName, "BAHPersonalFeed");//Get a single value property
                    clientContext.executeQueryAsync(function () {
                        deferred.resolve(userPersonalFeed.get_value());
                    },
                    function (sender, args) {
                        var errMsg = "Error setting personal feed: " + args.get_message();
                        $("#displayError").text(errMsg);
                        console.log(errMsg);
                    });
                });
        
            return deferred.promise();
        },
        saveMyFeed: function (feedSelections) {
            var self = this;
            var deferred = $.Deferred();
            var selectionCount = 0;
            var arrSelections = [];

            $.when(this.getUserData()).then(
                function (userProfileProperties) {
                    var clientContext = new SP.ClientContext.get_current();
                    var peopleManager = new SP.UserProfiles.PeopleManager(clientContext);
                    //Get the account name of the current user. It will be in the following format: "i:0#.f|membership|username@yoursite.onmicrosoft.com"
                    var currentUserAccountName = userProfileProperties.get_accountName();
                    //set the value in their user profile
                    peopleManager.setSingleValueProfileProperty(currentUserAccountName, "BAHPersonalFeed", feedSelections);//Set a single value property
                    clientContext.executeQueryAsync(function () {
                        deferred.resolve("success");
                    },
                    function (sender, args) {
                        var errMsg = "Error setting personal feed: " + args.get_message();
                        console.log(errMsg);
                    });
            });

            return deferred.promise();

        },
        convertToKQL: function (userFeed) {
            var encode = encodeURIComponent(userFeed);
            var queryText = "(BAHStream='" + encode.replace(/%7C/g, "') OR (BAHStream='") + "')";
            var selectProps = "&selectproperties='Title%2c+PublishingImage%2c+ArticleBy" +
                                "LineOWSTEXT%2c+PublishingPageContentOWSHTML%2cBAHStreamShowcaseOWSBOOL%2c+BAHShowcaseExpiryDate%2c+BAHShowcasePublishDate%2c+write" +
                                "+%2c+path+%2c+ArticleByLineOWSTEXT'&sortlist='BAHShowcasePublishDate:descending'";
            //var searchQuery = "/_api/search/query?querytext='ContentType:\"Zone+Publishing+Stream+Enhanced+News+Page\"+AND+" + queryText + "'" + selectProps;
            var searchQuery = "/_api/search/query?querytext='" + queryText + "'" + selectProps;
            return searchQuery;
        }
    };
})(jQuery);
///#source 1 1 Widgets/HomePage/myTeams.js
var Widgets = Widgets || {};

(function ($) {
	Widgets.myTeams = {
		name: "My Teams",
		log: true,

		// Shared Settings - Order is important only for building the view (in parse method)
		filteringProperties: ['BAHInfoCatTaxId', 'BAHTeamSiteSponsorOWSUSER', 'SPWebUrl', 'Title'],
		rowLimit: 5,
		template: function () {
			return $("#myTeamsTemplate").html();
		},

		getFavoriteTeamSites: function(){
		    var strFilter = '';
		    var bahFavoriteTeamSites = BAHUserProfileProperties.BAHPinnedTeamSites.split('|');
		    if (bahFavoriteTeamSites.length >0)
		    {
		        for (var i = 0; i < bahFavoriteTeamSites.length; i++) {
		            strFilter = strFilter + "Path=" + bahFavoriteTeamSites[i];
		            if (i < bahFavoriteTeamSites.length-1)
		                strFilter = strFilter + " OR ";
		        }
		    }
		    return strFilter;

		},

		fetch: function () {
		    var rowLimit = this.rowLimit;
		    var filteringProperties = this.filteringProperties;
			return $.when(userProfileLocationPromise).then(function()
			{
			    var strFavoriteFilter = Widgets.myTeams.getFavoriteTeamSites();
			    return $.when(Bah.getTeams(filteringProperties, rowLimit, "created", strFavoriteFilter),
                   Bah.getAllTermsFromTermSet(Bah.Constants.Guid.InfoCatTermSet)).then(
                   function (data, infoCatTerms) {
                       var viewAllLink = Bah.configuration.teamSitesListingPageUrl;
                       if (data.d !== undefined && data.d.query.PrimaryQueryResult.RelevantResults.RowCount > rowLimit - 1) {
                           ////if more than (rowLimit - 1, which should be 4) rows, get from term-store the View All Url
                           var viewAllLink = Bah.configuration.teamSitesListingPageUrl;

                           return { result: data, infoCatTerms: infoCatTerms, viewAllLink: viewAllLink };
                       } else {
                           ////View all not needed, return immediately
                           return { result: data, infoCatTerms: infoCatTerms, viewAllLink: viewAllLink };
                       }
                   });   
			});       
		},

		parse: function (allData) {
			// This function should parse the raw info coming from the datasource and return a View Model ready for binding.

			var data = allData.result;

			//create Term id Map
			var termsMap = {};
			var termEnumerator = allData.infoCatTerms.getEnumerator();
			while (termEnumerator.moveNext()) {
				var term = termEnumerator.get_current();
				termsMap[term.get_id().toString()] = term;
			}

			var filteringProperties = this.filteringProperties;
			//create existance map for filteringProperties
			var filteringPropertiesContains = lazy(filteringProperties).reduce(function (x, y) {
				var o = {}; o[y] = true;
				return x.merge(o);
			}, lazy({})).toObject();

			//Prepare View Model Object
			var viewModel = {
			    articles: [],
			    noArticles: true,
				viewAllLink: allData.viewAllLink
			};

			if (data.d !== undefined) {
				viewModel.articles = lazy(data.d.query.PrimaryQueryResult.RelevantResults.Table.Rows.results).map(function (row) {
					var rowReturn = {};
					lazy(row.Cells.results).filter(function (field) {
						return filteringPropertiesContains[field.Key]; //boosted
					}).first(filteringProperties.length).each(function (field) {
						rowReturn[field.Key] = field.Value;
					});
					return rowReturn;
				}).map(function (mappedFields, index) {
					var termId = Bah.getTermIdFromManagedMetadataId(mappedFields[filteringProperties[0]]);
					var term = termsMap[termId];
					//return article
					return {
						pageTitle: mappedFields[filteringProperties[3]],
						sponsor: mappedFields[filteringProperties[1]].split('|')[1].trim(),
						link: mappedFields[filteringProperties[2]],
                        //TODO:  REFACTOR because tileColor and infoCatFirstLetter are no longer used
						tileColor: term === undefined ? term : term.get_customProperties()['Color'],
						infoCatFirstLetter: term === undefined ? term : term.get_name()[0].toUpperCase()
					};
				}).first(this.rowLimit - 1).toArray();
			}

			var container = $(this.container);
            //Check for no team sites
			if (viewModel.articles.length === 0) {
			    viewModel.noArticles = true;
			    var termSet;
			    var url = Bah.configuration.teamSitesSiteCollectionUrl;
			    var ctx = new SP.ClientContext(url);
			    var web = ctx.get_web();
			    var ob = new SP.BasePermissions();
			    ob.set(SP.PermissionKind.manageSubwebs);
			    var per = web.doesUserHavePermissions(ob);
			    ctx.executeQueryAsync(
                    Function.createDelegate(this,
                        function () {
                            if (per.get_value()) {
                                container.show();
                                //Executes the new team site widget
                                var w = $("[data-widget='newTeamSite']");
                                var widgetName = w.data('widget');
                                var widget = Widgets[widgetName];
                                if (widget) {
                                    widget.container = w;
                                    Widget.load(widget);
                                }
                            }
                        }),
                    Function.createDelegate(this,
                        function (sender, args) { deferred.reject(sender, args); }));
			} else {
			    viewModel.noArticles = false;
			    container.show();
			}
			return viewModel;
		},

		bind: function (template, data) {
			var template = Handlebars.compile(template);
			var html = template(data);
			return html;
		},

		render: function (data) {
		    $(this.container).html(data);
		    Widgets.myCareer.accordionFix();
		},

		fail: function (error, event) {
			Bah.logging.error(event, this.name);
		}
	};
})(jQuery);
///#source 1 1 Widgets/HomePage/myCareer.js
var Widgets = Widgets || {};



(function ($) {
    Widgets.myCareer = {
		name: 'My Career',
		log: true,
		fetch: function () {
			return Bah.configuration.widgets.myCareer;
		},
		parse: function (myCareerProperties) {
			return {
				taleoApplicationUrl: myCareerProperties.taleoApplicationUrl,
				taleoSearchUrl: myCareerProperties.taleoSearchUrl
			};
		},
		bind: function (template, data) {
		    var template = Handlebars.compile(template);
		    var html = template(data);

		    return html;
		},
		render: function (data) {
		    $(this.container).html(data);
		    this.handlers();
		    this.accordionFix();
		},

		fail: function (error, event) {
			Bah.logging.error('Error at ' + event, this.name);
		},
		template: function () {
		    return $("#myCareerTemplate").html();
		},

		handlers: function () {
			var input = $(this.container).find("#my-career-search-term");
			var button = $(this.container).find("#my-career-button");
			var link = $(this.container).find("#my-career-search-url").val();
			input.keydown(function (e) {
				if (e.keyCode == 13) {
					window.open(link + this.value, '_blank');
					return false;
				}
			});
			button.click(function () {
				window.open(link + input.val(), '_blank');
			});
		},

        //Fixes the collapsable titles in mobile.
		accordionFix: function () {
		    $('.accord-content').each(function () {
		        var $this = $(this);
		        //$this.hide();
		    });
		    $('.accord-aside').each(function () {
		        var $this = $(this);
		        //$this.addClass('collapse');
		    });

		    $(document).foundation();
		    $('.section-2').on('toggled', function (event, accordion) {
		        console.log(accordion);
		    });

		},
	};
})(jQuery);
///#source 1 1 Widgets/HomePage/groupStickyNews.js
var Widgets = Widgets || {};

(function ($) {
    Widgets.groupStickyNews = {
        name: "Home Page Group Sticky News",
        log: true,
        createView: function (model) {
            var template = Handlebars.compile($("#groupStickyNewsTemplate").html());
            var html = template(model);
            $(Widgets.groupStickyNews.container).html(html);
        },
        createModel: function (results) {
            var model = {
                articleCount: results.length,
                articles: []
            };

            var i, length = results.length;
            for (i = 0; i < length; i++) {
                var result = results[i].Cells.results;

                // get url to video if set
                var videoUrl = Bah.alwaysString(Bah.getResultValueByKey('BAHNewsArticleVideoUrl', result)).trim() || "";

                var article = {
                    title: Bah.getResultValueByKey('Title', result), // article title 
                    url: videoUrl || "/Pages/Article.aspx?path=" + Bah.getResultValueByKey('Path', result), // article video url or generate link to article.aspx passing the url as 'path' query string parameter
                    image: Bah.getImageRendition(Bah.getResultValueByKey('PublishingImage', result),3), // link to image or set to default
                    byline: Bah.getResultValueByKey('ArticleByLineOWSTEXT', result), // article byline
                    yammerCommentCount: Bah.getResultValueByKey('BAHYammerCommentCountOWSNMBR', result) || "",
                    viewCount: Bah.getResultValueByKey('ViewsRecent', result) || ""
                };

                model.articles.push(article);
            }
            return model;
        },
        getGroupArticles: function (group) {
            var queryUrl = "/_api/search/query?querytext='Contenttypeid:\"0x010100C568DB52D9D0A14D9B2FDCC96666E9F2007948130EC3DB064584E219954237AF3900242457EFB8B24247815D688C526CD44D007AA3961D9E004361B23524B1971FC9CD03*\"+AND+BAHStreamShowcaseOWSBOOL:\"1\"+AND+BAHStreamDisplay=\"" + encodeURIComponent(group) + "\"" +
                "+AND+BAHShowcasePublishDate<%3dToday+AND+BAHShowcaseExpiryDate>%3dToday'" +
                "&trimduplicates=false&rowlimit=3&selectproperties='Title%2cPath%2cPublishingImage%2cArticleByLineOWSTEXT%2cBAHNewsArticleVideoUrl%2cBAHYammerCommentCountOWSNMBR%2cViewsRecent'&sortlist='BAHShowcasePublishDate:descending'";

            return $.ajax({
                async: true,
                url: queryUrl,
                type: "GET",
                headers: { "Accept": "application/json; odata=verbose" },
                cache: false
            });
        },
        getUserGroup: function () {
            var deferred = $.Deferred();

            var clientContext = new SP.ClientContext.get_current();
            var peopleManager = new SP.UserProfiles.PeopleManager(clientContext);
            var userProfileProperties = peopleManager.getMyProperties();

            clientContext.load(userProfileProperties);
            clientContext.executeQueryAsync(function () {
                var group = userProfileProperties.get_userProfileProperties()["BAHGroup"];
                deferred.resolve(group);
            },
            function (sender, args) {
                console.log(args.get_message());
                deferred.reject();
            });

            return deferred.promise();
        },
        load: function (options) {
            var self = this;
            self.options = options;

            $.when(self.getUserGroup()).done(function (group) {
                if (group) {
                    $.when(self.getGroupArticles(group)).done(function (data) {
                        if (data.d !== undefined) {
                            var results = data.d.query.PrimaryQueryResult.RelevantResults.Table.Rows.results;
                            if (results.length > 0) {
                                var model = self.createModel(results);
                                self.createView(model);
                            }
                        }
                    });
                }
            });
        },
        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);
///#source 1 1 Widgets/HomePage/myNewsFeed.js
var Widgets = Widgets || {};

(function ($) {
    Widgets.myNewsFeed = {
        name: "Home Page My News Feed",
        log: true,
        userFeedSettings: "",
        model: {
            currentSearchIndex: 0,
            totalSearchResults: 0,
            articles: []
        },
        loadMoreArticles: function (startPosition) {
            var self = this;
            $.when(self.getUserNewsFeed(startPosition)).done(function (data) {
                if (data.m_value !== undefined) {
                    var results = data.m_value.ResultTables[0].ResultRows;
                    if (results.length > 0) {
                        self.model.currentSearchIndex += results.length;
                        self.createModel(results);
                        var template = Handlebars.compile($("#myNewsFeedTemplate").html());
                        var html = template(self.model);
                        $(Widgets.myNewsFeed.container).html(html);
                    }
                }
            });
        },
        createModel: function (results) {
            var self = this;
            var i, length = results.length;
            for (i = 0; i < length; i++) {
                var result = results[i];
                // get url to video if set
                var videoUrl = Bah.alwaysString(result.BAHNewsArticleVideoUrl).trim() || "";
                var article = {
                    title: result.Title, // article title 
                    url: videoUrl || "/Pages/Article.aspx?path=" + result.Path, // article video url or generate link to article.aspx passing the url as 'path' query string parameter
                    image: Bah.getImageRendition(result.BAHPageImage, 3), // link to image or set to default
                    byline: result.ArticleByLineOWSTEXT, // article byline
                    yammerCommentCount: result.BAHYammerCommentCountOWSNMBR || "",
                    viewCount: result.ViewsLifetime || ""
                };
                

                self.model.articles.push(article);
            }
            return self.model;
        },
        getUserNewsFeed: function (startPosition) {
            var deferred = $.Deferred();
            var self = this;
            //there is 2048 character limit for a rest api search query, we were hitting that threshold. Need to switch to js object search model
            //using this method there is a 4096 character limit
            SP.SOD.executeFunc("SP.js", "SP.ClientContext", function () {
                SP.SOD.executeFunc("SP.Search.js", "Microsoft.SharePoint.Client.Search.Query.KeywordQuery", function () {
                    var sContext = SP.ClientContext.get_current();
                    var keywordQuery = new Microsoft.SharePoint.Client.Search.Query.KeywordQuery(sContext);
                    keywordQuery.set_trimDuplicates(false);
                    keywordQuery.set_rowLimit(5);
                    keywordQuery.set_startRow(startPosition);

                    var properties = keywordQuery.get_selectProperties();
                    properties.add("PublishingImage");
                    properties.add("BAHPageImage");
                    properties.add("BAHYammerCommentCountOWSNMBR");
                    properties.add("ViewsLifetime");
                    properties.add("ArticleByLineOWSTEXT");

                    // Sorting (Ascending = 0, Descending = 1)
                    keywordQuery.set_enableSorting(true);
                    var sortproperties = keywordQuery.get_sortList();
                    sortproperties.add("BAHArticleDate", 1);
                    var queryText = "(Contenttypeid:\"0x010100C568DB52D9D0A14D9B2FDCC96666E9F2007948130EC3DB064584E219954237AF3900242457EFB8B24247815D688C526CD44D007AA3961D9E004361B23524B1971FC9CD03*\") AND (BAHArticleDate<=Today)" + self.userFeedSettings;
                    keywordQuery.set_queryText(queryText);
                    var searchExecutor = new Microsoft.SharePoint.Client.Search.Query.SearchExecutor(sContext);
                    results = searchExecutor.executeQuery(keywordQuery);
                    sContext.executeQueryAsync(
                        function () {
                            deferred.resolve(results);
                        },
                        function (err) {
                            deferred.reject(null);
                        }
                    );
                });
            });

            return deferred.promise();
        },
        getUserFeedSettings: function () {
            var deferred = $.Deferred();

            var clientContext = new SP.ClientContext.get_current();
            var peopleManager = new SP.UserProfiles.PeopleManager(clientContext);
            var userProfileProperties = peopleManager.getMyProperties();

            clientContext.load(userProfileProperties);
            clientContext.executeQueryAsync(function () {
                var feed = userProfileProperties.get_userProfileProperties()["BAHPersonalFeed"];
                deferred.resolve(feed);
            },
            function (sender, args) {
                console.log(args.get_message());
                deferred.reject();
            });

            return deferred.promise();
        },
        convertToKQL: function (feed) {
            var self = this;
            //var encode = encodeURIComponent(feed);
            //var queryText = "(BAHStreamDisplay=\"" + encode.replace(/%7C/g, "\") OR (BAHStreamDisplay=\"") + "\")";
            //var encode = encodeURIComponent(feed);
            var queryText = "";
            if (feed.indexOf("|") > -1) {
                queryText = "AND ((BAHStreamDisplay=\"" + feed.replace(/[|]/g, "\") OR (BAHStreamDisplay=\"") + "\"))";
            } else {
                queryText = "AND (BAHStreamDisplay=\"" + feed + "\")";
            }
             
            return queryText;
        },
        load: function (options) {
            var self = this;
            self.options = options;

            // The load function of this widget will be called when a 
            // user updates his/or her subscription from the customizeMyNewsFeed widget.
            // Need to ensure any previous output before reloading the widget
            var template = Handlebars.compile($("#myNewsFeedTemplate").html());
            var html = template();
            $(self.container).html(html);

            // Reset model in event a load is triggered from the customizeMyNewsFeedWidget
            self.model.totalSearchResults = 0;
            self.model.currentSearchIndex = 0;
            self.model.articles = [];

            $.when(self.getUserFeedSettings()).done(function (feed) {
                if (feed) {
                    self.userFeedSettings = self.convertToKQL(feed);
                    //self.userFeedSettings = feed;
                    $.when(self.getUserNewsFeed(0)).done(function (data) {
                        //if (data.d !== undefined) {
                        if (data.m_value !== undefined) {
                            var results = data.m_value.ResultTables[0].ResultRows;
                            //var results = data.d.query.PrimaryQueryResult.RelevantResults.Table.Rows.results;
                            if (results.length > 0) {
                                //self.model.totalSearchResults = data.d.query.PrimaryQueryResult.RelevantResults.TotalRows;
                                self.model.totalSearchResults = data.m_value.ResultTables[0].TotalRows;
                                self.model.currentSearchIndex += results.length;
                                self.createModel(results);
                                html = template(self.model);
                                $(self.container).html(html);
                            }
                        }
                    });
                }
            });
        },
        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);
///#source 1 1 Widgets/HomePage/homePageEvents.js
var Widgets = Widgets || {};
(function ($) {
	Widgets.homePageEvents = {
		name: "Home Page Events",
		log: true,
		fetch: function () {
			var getUpcomingEvents = function (listTitle) {
				var wsURL = "/_vti_bin/Lists.asmx";
				var locale = 1033; //English
				var deferred = $.Deferred();
				var clientContext = SP.ClientContext.get_current();
				var list = clientContext.get_web().get_lists().getByTitle(listTitle);
				clientContext.load(list, 'Id', 'Title', 'ParentWeb');
				clientContext.executeQueryAsync(
                    Function.createDelegate(this,
                        function () {
                        	var result = {
                        		data: '',
                        		listTitle: '',
                        		sourceUrl: ''
                        	};
                        	var calendarGuid = list.get_id().toString();
                        	var sourceUrl = list.get_parentWeb().get_url();
                        	var xmlCall = Bah.getRecurrenceQueryForEvents(calendarGuid);
                        	var ajax = $.ajax({
                        		url: wsURL,
                        		type: "POST",
                        		dataType: "xml",
                        		async: false,
                        		data: xmlCall,
                        		complete: function (xData, status) {
                        			if (status === "success") {
                        				result.data = $(xData.responseText);
                        			}
                        		},
                        		contentType: "text/xml; charset=\"utf-8\""
                        	});

                        	result.listTitle = listTitle;
                        	result.sourceUrl = sourceUrl;
                        	deferred.resolve(result);
                        }),
                    Function.createDelegate(this,
                        function (sender, args) { deferred.reject(sender, args); }));

				return deferred.promise();
			};

			return getUpcomingEvents('Calendar');
		},

		parse: function (result) {
			var viewModel = {
				viewAllUrl: '',
				events: [],
				itemsToDisplay: false
			};
			if (result) {
				var data = result.data;
				var listTitle = result.listTitle != '' ? result.listTitle : '';
				var sourceUrl = result.sourceUrl != '' ? result.sourceUrl : '';

				if (data) {
					var detailsPageUrl = Bah.configuration.eventDetailsPageUrl;
					var allEventsUrl = Bah.configuration.eventsListingPageUrl;
					var itemCount = Bah.configuration.widgets.homePageEvents.itemCount;

					viewModel.viewAllUrl = allEventsUrl;

					data.find("listitems").children().children().each(function () {
						$this = $(this);
						var ids = $this.attr("ows_UniqueId").split(";");
						var rec = $this.attr("ows_fRecurrence");
						////Formats the event date so all browsers recognize it
						var itemDate = $.format.date($this.attr("ows_EventDate"), 'MM/dd/yyyy hh:mm:ss a');
						var eventDate = new Date(itemDate);
						var eventMonth = $.format.date(eventDate, 'MMM');
						var eventDay = $.format.date(eventDate, 'dd');
						var startTime = $.format.date(eventDate, 'h:mm a');
						var endTime = $.format.date($this.attr("ows_EndDate"), 'h:mm a');
						var location = $this.attr("ows_Bah_Location") != undefined ? $this.attr("ows_Bah_Location").split('#'): '';
						var newUrl = detailsPageUrl;
						if (!rec) {
						    newUrl = newUrl === "#" ? newUrl : newUrl + "?eventId=" + ids[0] + "&sourceUrl=" + sourceUrl + "&listTitle=" + listTitle;
						    newUrl = newUrl === "#" ? newUrl : newUrl + "?eventId=" + ids[0] + "&sourceUrl=" + sourceUrl + "&listTitle=" + listTitle;
						} else {
						    newUrl = newUrl === "#" ? newUrl : newUrl + "?eventId=" + ids[0] + "&eventDate=" + encodeURIComponent(eventDate) + "&sourceUrl=" + sourceUrl + "&listTitle=" + listTitle;
						}

						if (eventDate >= new Date($.now())) {
							viewModel.events.push({
								"EventDate": eventDate,
								"StartTime": startTime,
								"EndTime": endTime,
								"Title": $this.attr("ows_Title"),
								"Recurrence": (rec === "1" ? true : false),
								"Description": $this.attr("ows_Description") ? $this.html($this.attr("ows_Description").replace(/&lt;/g, '<').replace(/&gt;/g, '>').replace(/&quot;/g, '"')).text() : '',
								"Month": eventMonth,
								"Day": eventDay,
                                "Location": location.length >1 ? location[1] :'',
								"DetailsPage": newUrl
							});
						}
					});

					if (viewModel.events.length > 0) {
						viewModel.itemsToDisplay = true;
						viewModel.events = lazy(viewModel.events).take(itemCount).toArray();
					}
				}
			}

			return viewModel;
		},

		bind: function (template, data) {
			var template = Handlebars.compile(template);
			var html = template(data);

			return html;
		},

		render: function (data) {
		    $(this.container).html(data);
		    Widgets.myCareer.accordionFix();
		},

		fail: function (error, event) {
			Bah.logging.error('Error at ' + event, this.name);
		},

		template: function () {
			return $("#homePageEventsTemplate").html();
		}
	};
})(jQuery);
///#source 1 1 Widgets/AccountPage/accountHeader.js
var Widgets = Widgets || {};
var orgIdTermSetPromise = new $.Deferred();
var orgTermSet, parentTermSet, orgTermName, orgTermProps, parentTermName, parentTermProps;

(function ($) {
    Widgets.accountHeader = {
        name: 'Account Header',
        log: true,
        orgIdTermSetPromise: new $.Deferred(),
        load: function (options) {
            $('html').addClass('bah-account-page');
            var orgId = Bah.GetQueryStringParams("orgid");
            var html, termSetData;
            if (orgId) {
                $.when(Bah.getTerm(Bah.Constants.Guid.StreamTermSet, orgId)).then(
                    function (groupTerm) {
                        orgTermSet = groupTerm;
                        orgTermName = groupTerm.get_name();
                        orgTermProps = groupTerm.get_customProperties();
                        if (!orgTermSet.get_isRoot()) {
                            $.when(Bah.getTermParent(groupTerm)).then(
                                function (parentTerm) {
                                    parentTermSet = parentTerm;
                                    parentTermName = parentTerm.get_name();
                                    parentTermProps = parentTerm.get_customProperties();

                                    termSetData = {
                                        name: orgTermName,
                                        acronym: orgTermProps["acronym"],
                                        tagcolor: orgTermProps["tagcolor"]
                                    }
                                    orgIdTermSetPromise.resolve();
                                    Widgets.accountHeader.orgIdTermSetPromise.resolve();
                                    orgIdTermSetPromise.resolve();
                                    html = template(termSetData);
                                    $(Widgets.accountHeader.container).html(html);
                                }
                    );
                        }
                    }
                );
            }

            var template = Handlebars.compile($('#accountHeaderTemplate').html());
            $(Widgets.accountHeader.container).html(html);
        },
        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);
///#source 1 1 Widgets/AccountPage/accountAboutUs.js
var Widgets = Widgets || {};

(function ($) {
    //set Inital Variables here
    var context = { data: [], count: 0, maxCount: 0 };
    var comment, imageHtml, stream, sortOrder, location, articleUrl, title;
    var getAboutUsDataPromise = new $.Deferred();

    //Get Data from More About Us List
    //Step 1
    function getAboutUsData() {
        var getDataUrl = "/_api/search/query?querytext='ContentType:+\"More+About+Us\"+AND+BAHStreamDisplay=\"" + encodeURIComponent(parentTermName) + ":" + encodeURIComponent(orgTermName) + "\"'&trimduplicates=false&rowlimit=20&selectproperties='Path%2cUrl%2cTitle%2cBAHFeedbackComment%2cBAHResourceImageOWSIMGE%2cBAHStream%2cBAHSortOrder%2cBAHLocation%2cBAHLinkUrl'";
        $.getJSON(getDataUrl, function (data) {
            var resultData = BahUtilities.getSharePointSearchResults(data).Rows;
            if (resultData.length > 0) {
                //Cycle through each Row of the data
                $.each(resultData, function () {
                    var rowData = this.Cells;
                    //Cycle through each property, looking for the ones we need
                    $.each(rowData, function () {
                        if (this.Key === "Title") {
                            title = this;
                        }
                        else if (this.Key === "BAHFeedbackComment") {
                            comment = this;
                        }
                        else if (this.Key === "BAHResourceImageOWSIMGE") {
                            imageHtml = $(this.Value).attr('src');
                        }
                        else if (this.Key === "BAHStream") {
                            stream = this;
                        }
                        else if (this.Key === "BAHSortOrder") {
                            sortOrder = this;
                        }
                        else if (this.Key === "BAHLocation") {
                            location = this;
                        }
                        else if (this.Key === "BAHLinkUrl") {
                            articleUrl = this;
                        }
                    });
                    //push the useful stuff into the view                    
                    context.data.push({ title: title, comment: comment, imageHtml: imageHtml, stream: stream, sortOrder: sortOrder, location: location, articleUrl: articleUrl });
                    //console.log(context);
                })
                getAboutUsDataPromise.resolve();
            }
        });

    }

    //Initilize Widget for account About Us
    //Step 0
    Widgets.accountAboutUs = {
        log: true,
        load: function (options) {
            $.when(Widgets.accountHeader.orgIdTermSetPromise).done(function () {
                getAboutUsData();
                $.when(getAboutUsDataPromise).done(function () {
                    context.count = context.data.length;
                    context.maxCount = 2;

                    var template = Handlebars.compile($('#accountAboutUsTemplate').html());
                    var html = template(context);
                    $(Widgets.accountAboutUs.container).html(html);


                    var $owl = $("#owl-slider-about");
                    $owl.owlCarousel({
                        paginationNumbers: false,
                        navigation: true,
                        autoPlay: false,
                        slideSpeed: 300,
                        paginationSpeed: 400,
                        singleItem: false,
                        items: 2,
                        itemsCustom: false,
                        itemsDesktop: [1199, 4],
                        itemsDesktopSmall: [979, 4],
                        itemsTablet: [767, 4],
                        itemsTabletSmall: [620, 3],
                        itemsMobile: [479, 3],
                        singleItem: false,
                        itemsScaleUp: false
                    });

                    // Custom Navigation Events
                    $(".nextnn").click(function () {
                        $owl.trigger('owl.next');
                    });
                    $(".prevpp").click(function () {
                        $owl.trigger('owl.prev');
                    });
                });
            });
        },
        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };

})(jQuery);

///#source 1 1 Widgets/AccountPage/accountBreadcrumbs.js
var Widgets = Widgets || {};

(function ($) {
    var breadcrumbsArrayPromise = new $.Deferred()
    Widgets.accountBreadcrumbs = {
        name: 'Breadcrumbs',
        log: true,
        dataContext: [],
        termsets:[],
        load: function (options) {
            $.when(Widgets.accountHeader.orgIdTermSetPromise).then(function () {
                Widgets.accountBreadcrumbs.termsets.push(orgTermSet);
                if (parentTermSet) {
                    Widgets.accountBreadcrumbs.termsets.push(parentTermSet);
                }
                if (!parentTermSet.get_isRoot()) {
                    $.when(Bah.getTermParent(parentTermSet)).then(
                            function (parentTerm) {
                                Widgets.accountBreadcrumbs.termsets.push(parentTerm);
                                breadcrumbsArrayPromise.resolve();
                            });
                } else {
                    breadcrumbsArrayPromise.resolve();
                }
                
            });
            $.when(breadcrumbsArrayPromise).then(function () {
                Widgets.accountBreadcrumbs.termsets.reverse();
                Widgets.accountBreadcrumbs.dataContext.push({ link: _spPageContextInfo.siteAbsoluteUrl , name:'Home'});
                $.each(Widgets.accountBreadcrumbs.termsets, function (key, val) {
                    var crumb = {
                        link: '',
                        name: ''
                    }
                    if (key === 0) {
                        crumb.link = "/Pages/group.aspx?orgid=";
                        crumb.link += val.get_id();
                    }
                    else {
                        var test = Widgets.accountBreadcrumbs.termsets.length - 1;
                        if (key === test) {
                            crumb.link = "#";
                        } else {
                            crumb.link = "/Pages/account.aspx?orgid=";
                            crumb.link += val.get_id();
                        }
                    }
                    crumb.name = val.get_name();
                    Widgets.accountBreadcrumbs.dataContext.push(crumb);
                });
                var template = Handlebars.compile($('#accountBreadcrumbsTemplate').html());
                var html = template(Widgets.accountBreadcrumbs.dataContext);
                $(Widgets.accountBreadcrumbs.container).html(html);
            })
        },
        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);
///#source 1 1 Widgets/AccountPage/accountLeadershipTeam.js
var Widgets = Widgets || {};
/* TODO: refactoring this widget into Scripts/Widgets/Pages/pagesLeadershipTeam.js */
(function ($) {
    Widgets.accountLeadershipTeam = {
        log: true,
        leadershipTeam: { widgetTitle: 'Our Leadership Team', leadershipTeam: [], count:0, maxCount:0 },
        widgetPromise:'',
        buildLeadershipCarouselPromise: [],
        buildLeadershipQuery: function () {
            //Query Text: ContentType:"Our Leadership Team" AND BAHStream:"STRATEGIC INNOVATION GROUP"
            //Select Properties:BAHStreamDisplay,BAHLeader,BAHLeaderOWSUSER,BAHResourceImageOWSIMGE, BAHSortOrder, BAHLeader
            //Sort List:BAHSortOrder:ascending
            var leadershipTeamQuery = "/_api/search/query?querytext='ContentType:\"Our+Leadership+Team\"+AND+BAHStreamDisplay=\"" + encodeURIComponent(parentTermName) + ":" + encodeURIComponent(orgTermName) + "\"'&trimduplicates=false&selectproperties='BAHStream%2cBAHLeader%2cBAHLeaderOWSUSER%2cBAHResourceImageOWSIMGE%2c+LeaderSortOrder%2c+BAHLeader'&sortlist='BAHSortOrder:ascending'&rowlimit=20";
            //Update query for Group Specific Requirements to not include accounts and subgroups for leaders
            if (window.location.href.toLowerCase().indexOf("group.aspx") > -1) {
                leadershipTeamQuery = "/_api/search/query?querytext='ContentType:\"Our+Leadership+Team\"+AND+BAHStreamDisplay=\"" + encodeURIComponent(orgTermName) + "\"'&trimduplicates=false&selectproperties='BAHStream%2cBAHLeader%2cBAHLeaderOWSUSER%2cBAHResourceImageOWSIMGE%2c+LeaderSortOrder%2c+BAHLeader'&sortlist='BAHSortOrder:ascending'&rowlimit=20";
            }
            return $.getJSON(leadershipTeamQuery, function (data) {
                return data;
            })
        },
        buildLeadershipCarousel: function (data) {
            /* Jump down into the relevant section of the results */
            data = BahUtilities.getSharePointSearchResults(data);
            /* The call will return an empty array if there are no results */

            $.each(data.Rows, function () {
                var def = new $.Deferred(); //Promise for each item in returned results since we have to make a second call to get profile information
                var leader = { leaderEmail: '', leaderImage: '', leaderProfileUrl: '', leaderFirstName: '', leaderLastName: '', leaderAccountName: '', leaderRole: '' }
                var rowData = this.Cells;

                //Loop though the data returned from first call and grab the required data
                $.each(rowData, function () {
                    if (this.Key === 'BAHLeaderOWSUSER') {
                        leader.leaderEmail = this.Value;
                        var temp = leader.leaderEmail.match(/(([a-zA-Z]|[0-9])|([-]|[_]|[.]))+[@](([a-zA-Z0-9])|([-])){2,63}[.](([a-zA-Z0-9]){2,63})+/gi);
                        leader.leaderEmail = temp[temp.length - 1].replace("@"," ");
                    }
                    if (this.Key === 'BAHResourceImageOWSIMGE') {
                        leader.leaderImage = this.Value;
                        if (leader.leaderImage) {
                            var src = $(leader.leaderImage).attr('src'); //Strip out only the image file from the returned html 
                            leader.leaderImage = src;
                        }
                    }
                });
                Widgets.accountLeadershipTeam.leadershipTeam.leadershipTeam.push(leader); //Push the initial data for this user
                
                Widgets.accountLeadershipTeam.buildLeadershipCarouselPromise.push(def); //Push the promise for this user
            });
            //For Each loop below to prevent misordered list due to async profile calls
                $.each(Widgets.accountLeadershipTeam.leadershipTeam.leadershipTeam, function (key, val) {
                    Widgets.accountLeadershipTeam.getUserProfile(val.leaderEmail).then(function (results) {
                        var resultData = BahUtilities.getFirstSharePointSearchResults(results);
                        $.each(resultData, function (key, val2) {
                            if (val2.Key === "FirstName") {
                                val.leaderFirstName = val2.Value;
                            }
                            if (val2.Key === "LastName") {
                                val.leaderLastName = val2.Value;
                            }
                            if (val2.Key === "AccountName") {
                                val.leaderAccountName = encodeURIComponent(val2.Value);
                            }
                            if (val2.Key === "BAHRolePrimary") {
                                val.leaderRole = val2.Value;
                            }
                        });
                        if (!val.leaderImage) {
                            val.leaderImage = "/_layouts/15/userphoto.aspx?size=L&accountname=" + val.leaderAccountName;
                        }
                        Widgets.accountLeadershipTeam.buildLeadershipCarouselPromise[key].resolve(results); //Resolve the corresponding promise in the array for the second tier of data
                    });
                })

            return $.when.apply(undefined, Widgets.accountLeadershipTeam.buildLeadershipCarouselPromise).promise(); //Returns the promise of all the promises in this list when all resolve
        },
        getUserProfile: function (bahLeaderEmail) {
            //http://bahtest.sharepoint.com/_api/search/query?querytext='Atwell%2c+Joseph+[USA]'&selectproperties='FirstName%2c+LastName%2cAccountName%2cJobTitle%2cBAHPeopleGroup'&sourceid='b09a7990-05ea-4af9-81ef-edfab16c4e31'
            var profileFetchUrl = "/_api/search/query?querytext='AccountName:\"" + bahLeaderEmail + "\"'&selectproperties='FirstName%2c+LastName%2cAccountName%2cJobTitle%2cBAHPeopleGroup%2c+BAHRolePrimary%2cAccountName'&sourceid='b09a7990-05ea-4af9-81ef-edfab16c4e31'";
            return $.getJSON(profileFetchUrl, function (data) {
                return data;
            });
        },
        load: function (options) {
            // TODO: to componentize in owlSliderContent.js this list should be a seperate configuration file
            //If statements to allow code reuse on campaign, account and group page with one code base.
            if (window.location.href.toLowerCase().indexOf("campaign.aspx") > -1) {
                Widgets.accountLeadershipTeam.widgetPromise = Widgets.campaignHeader.orgIdTermSetPromise;
                Widgets.accountLeadershipTeam.leadershipTeam.maxCount = 2;
            }
            if (window.location.href.toLowerCase().indexOf("account.aspx") > -1) {
                Widgets.accountLeadershipTeam.widgetPromise = Widgets.accountHeader.orgIdTermSetPromise;
                Widgets.accountLeadershipTeam.leadershipTeam.maxCount = 2;
            }
            if (window.location.href.toLowerCase().indexOf("group.aspx") > -1) {
                Widgets.accountLeadershipTeam.widgetPromise = Widgets.groupHeader.orgIdTermSetPromise;
                Widgets.accountLeadershipTeam.leadershipTeam.maxCount = 4;
            }
            // #2918 - adding case for systems delivery
            if (window.location.href.toLowerCase().indexOf("platform-test-page.aspx") > -1) {
                console.log("testing regex of Platform-Test-Page");
                // Widgets.accountLeadershipTeam.widgetPromise = Widgets.platformHeader.orgIdTermSetPromise;
                // Widgets.accountLeadershipTeam.leadershipTeam.maxCount = 4;
            }
            $.when(Widgets.accountLeadershipTeam.widgetPromise).done(function () {
                if (window.location.href.toLowerCase().indexOf("campaign.aspx") > -1) {
                    Widgets.accountLeadershipTeam.leadershipTeam.widgetTitle = Widgets.campaignHeader.orgTermName + " Contacts";
                }
                $.when(Widgets.accountLeadershipTeam.buildLeadershipQuery()).done(function (data) {
                    $.when(Widgets.accountLeadershipTeam.buildLeadershipCarousel(data)).done(function (data) {
                        var template = Handlebars.compile($('#accountLeadershipTeamTemplate').html());
                        // To hide arrows when there are the correct amount showing update the count of total results
                        Widgets.accountLeadershipTeam.leadershipTeam.count = Widgets.accountLeadershipTeam.leadershipTeam.leadershipTeam.length;
                        

                        
                        var html = template(Widgets.accountLeadershipTeam.leadershipTeam);
                        $(Widgets.accountLeadershipTeam.container).html(html);
                        var $owl = $("#owl-slider-leadership");
                        // assumes leadership is only shown full width on group page
                        if (window.location.href.toLowerCase().indexOf("group.aspx") > -1) {
                            $owl.owlCarousel({
                                paginationNumbers: false,
                                navigation: true,
                                autoPlay: false,
                                slideSpeed: 300,
                                paginationSpeed: 400,
                                singleItem: false,
                                items: 4,
                                itemsCustom: false,
                                itemsDesktop: [1199, 4],
                                itemsDesktopSmall: [979, 4],
                                itemsTablet: [767, 4],
                                itemsTabletSmall: [620, 3],
                                itemsMobile: [479, 2],
                                singleItem: false,
                                itemsScaleUp: false
                            });
                        }
                        else {
                            $owl.owlCarousel({
                                paginationNumbers: false,
                                navigation: true,
                                autoPlay: false,
                                slideSpeed: 300,
                                paginationSpeed: 400,
                                singleItem: false,
                                items: 2,
                                itemsCustom: false,
                                itemsDesktop: [1023, 4],
                                itemsDesktopSmall: [979, 4],
                                itemsTablet: [767, 4],
                                itemsTabletSmall: [620, 3],
                                itemsMobile: [479, 2],
                                singleItem: false,
                                itemsScaleUp: false
                            });
                        }

                        // Custom Navigation Events
                        $(".nextn").click(function () {
                            $owl.trigger('owl.next');
                        });
                        $(".prevp").click(function () {
                            $owl.trigger('owl.prev');
                        });
                        // TODO: we can probably remove this and use the handlebars template if conditional helper
                        var hideNext = Widgets.accountLeadershipTeam.leadershipTeam.maxCount < Widgets.accountLeadershipTeam.leadershipTeam.count;
                        Widgets.accountLeadershipTeam.updateDisplay(".nextn", 1024, hideNext);
                    })
                })
            })
        },
        // added updateDisplay to account for any post display edge cases where we need to show or hide an element
        // TODO: we can probably remove this and set it in handlebars by adding an if case to the next arrow for count == maxcount
        // NOTE: DEPRECATED. new updateDisplay is being implemented in pagesLeadershipTeam.js which will replace this instance
        updateDisplay: function (element, breakpoint, hideUI) {
            if ((window.location.href.toLowerCase().indexOf("campaign.aspx") > -1) && (hideUI)) {
                hideElement();
                var rtime;
                var timeout = false;
                var delta = 250;
                // TODO: throttle the resize function if performance becomes an issue
                $(window).resize(function() {
                    rtime = new Date();
                    if (timeout === false) {
                        timeout = true;
                        setTimeout(resizeEnd, delta);
                    }
                });
                function resizeEnd() {
                    if (new Date() - rtime < delta) {
                        setTimeout(resizeEnd, delta);
                    } else {
                        timeout = false;
                        hideElement();
                    }               
                }
                function hideElement() {
                    var hide = false;
                    // TODO: this case could be more abstracted -- good for now
                    ($(window).width() < breakpoint) ? hide = true : hide = false;
                    if (hide) {
                        $(element).hide();
                    } else {
                        $(element).show();
                    }
                }
            }
        },
        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);
///#source 1 1 Widgets/AccountPage/accountLinks.js
var Widgets = Widgets || {};


(function ($) {
    Widgets.accountLinks = {
        log: true,
        viewModel: {
            links: [],
            orgName: '',
            moreLinks: false,
            expanded: false,
            render: false,
        },
        getLinks: function () {
            Query = "/_api/search/query?querytext='contenttype:\"BAH+Generic+Links\"+AND+BAHStreamDisplay=\"" + encodeURIComponent(parentTermName) + ":" + encodeURIComponent(orgTermName) + "\"'&trimduplicates=false&selectproperties=\'title%2cBAHResourceUrl\'&sortlist=\'BAHSortOrder:ascending\'&rowlimit=12";
            return $.getJSON(Query, function (data) {
                return data;
            });
        },
        showMoreLinks: function () {
            Widgets.accountLinks.viewModel.expanded = !Widgets.accountLinks.viewModel.expanded;
            Widgets.accountLinks.compileTemplate();
        },
        load: function (options) {
            $.when(orgIdTermSetPromise).done(function () {
                Widgets.accountLinks.getLinks().then(function (results) {
                    var resultData = BahUtilities.getSharePointSearchResults(results);
                    if (BahUtilities.getSharePointTotalResults(results) > 0) {
                        Widgets.accountLinks.viewModel.render = true; //Allows widget to render. If no results fails gracefully
                        if (BahUtilities.getSharePointTotalResults(results) > 12) {
                            Widgets.accountLinks.viewModel.moreLinks = true;
                        }
                        $.each(resultData.Rows, function (index, result) {
                            var item = {
                                title: Bah.getResultValueByKey('title', result.Cells),
                                url: Bah.getResultValueByKey('BAHResourceUrl', result.Cells)
                            };
                            Widgets.accountLinks.viewModel.links.push(item);

                        });
                        Widgets.accountLinks.viewModel.orgName = "Explore";
                        Widgets.accountLinks.compileTemplate();
                    }
                });
            });
        },
        compileTemplate: function () {
            var template = Handlebars.compile($('#accountLinksTemplate').html());
            var html = template(Widgets.accountLinks.viewModel);
            $(Widgets.accountLinks.container).html(html);
        },
        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);
///#source 1 1 Widgets/AccountPage/accountNews.js
var Widgets = Widgets || {};
(function ($) {

    /***********************************************/
    /******* INITILIZE WIDGET FOR GROUP STORY ******/
    /******************* STEP 0 ********************/
    Widgets.accountNews = {
        buildFeaturedArticleArrayPromise: new $.Deferred(),
        getArticlePromise: new $.Deferred(),
        getLeadershipMessagePromise: new $.Deferred(),
        preventLoadMore: false,
        name: 'Featured News',
        log: true,
        featuredNewsArray: {
            featuredCount: 3,
            featured: [],
            news: [],
            currentSearchIndex: 0,
            totalSearchResults: 0,
            loadSubAccount: false
        },
        load: function (options) {
            var template = Handlebars.compile($('#accountNewsTemplate').html());
            $.when(Widgets.accountHeader.orgIdTermSetPromise).done(function () {
                Widgets.accountNews.loadShowcaseAccountStories();
                Widgets.accountNews.loadLeadershipMessage();
                Widgets.accountNews.loadArticleNewsFeed(0);

                $.when(Widgets.accountNews.buildFeaturedArticleArrayPromise).done(function () {
                    var html = template(Widgets.accountNews.featuredNewsArray);
                    $(Widgets.accountNews.container).html(html);
                });
                $.when(Widgets.accountNews.getArticlePromise).done(function () {
                    var html = template(Widgets.accountNews.featuredNewsArray);
                    $(Widgets.accountNews.container).html(html);
                });
                $.when(Widgets.accountNews.getLeadershipMessagePromise).done(function () {
                    var html = template(Widgets.accountNews.featuredNewsArray);
                    $(Widgets.accountNews.container).html(html);
                });
            });
        },
        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        },
        loadShowcaseAccountStories: function () {
            /***********************************************/
            /*** INITIAL QUERY TO LOAD SHOWCASE ARTICLES ***/
            /******************* STEP 1 ********************/

            //SP Search Query Took
            //Query Text: (BAHStream:"Army" AND BAHStreamShowcaseOWSBOOL:1) AND (BAHShowcaseExpiryDate>=Today) AND (BAHShowcasePublishDate<=Today)
            //Select Properties: Title, PublishingImage, ArticleByLineOWSTEXT, PublishingPageContentOWSHTML,BAHStreamShowcaseOWSBOOL, BAHShowcaseExpiryDate, BAHShowcasePublishDate, write, path, ArticleByLineOWSTEXT,BAHStream,BAHStreamDisplay,BAHYammerCommentCountOWSNMBR,ViewsRecent
            //Sort List:BAHShowcasePublishDate:descending
            //Rest Call: https://zonedev.sharepoint.com/_api/search/query?querytext='(BAHStream:"Army"+AND+BAHStreamShowcaseOWSBOOL:1)+AND(BAHShowcaseExpiryDate>%3dToday)+AND+(BAHShowcasePublishDate<%3dToday)'&enablestemming=false&enablephonetic=false&enablefql=false&enablequeryrules=true&bypassresulttypes=false&generateblockranklog=false&selectproperties='Title%2c+PublishingImage%2c+ArticleByLineOWSTEXT%2c+PublishingPageContentOWSHTML%2cBAHStreamShowcaseOWSBOOL%2c+BAHShowcaseExpiryDate%2c+BAHShowcasePublishDate%2c+write'&sortlist='BAHShowcasePublishDate:descending&rowlimit=3'

            var getArticleShowcasePromise = new $.Deferred();
            var getDataUrl = "/_api/search/query?querytext='(BAHStreamDisplay=\"" + encodeURIComponent(parentTermName) + ":" + encodeURIComponent(orgTermName) + "\"+AND+BAHStreamShowcaseOWSBOOL:1)+" +
                "AND(BAHShowcaseExpiryDate>%3dToday)+AND+(BAHShowcasePublishDate<%3dToday)'&trimduplicates=false&selectproperties='Title%2c+PublishingImage%2c+ArticleBy" +
                "LineOWSTEXT%2c+PublishingPageContentOWSHTML%2cBAHStreamShowcaseOWSBOOL%2c+BAHShowcaseExpiryDate%2c+BAHShowcasePublishDate%2c+write" +
                "+%2c+path+%2c+ArticleByLineOWSTEXT+%2c+BAHStreamDisplay+%2cBAHYammerCommentCountOWSNMBR+%2cViewsRecent'&sortlist='BAHShowcasePublishDate:descending'&rowlimit=3";
            $.getJSON(getDataUrl, function (data) {
                var accountLevelResultData = BahUtilities.getSharePointSearchResults(data);
                if (accountLevelResultData.Rows) {
                    var accountLevelResultCount = accountLevelResultData.Rows.length;
                }
                if (accountLevelResultCount < 3) {
                    var additionalArticlesCount = 3 - accountLevelResultCount;
                    var getDataUrl = "/_api/search/query?querytext='(BAHStreamDisplay=\"" + encodeURIComponent(parentTermName) + "\"" +
                        "+AND+BAHStreamShowcaseOWSBOOL:1)+AND(BAHShowcaseExpiryDate>%3dToday)+AND+(BAHShowcasePublishDate<%3dToday)'&trimduplicates=false&selectproperties='Title%2c+PublishingImage%2c+Arti" +
                        "cleByLineOWSTEXT%2c+PublishingPageContentOWSHTML%2cBAHStreamShowcaseOWSBOOL%2c+BAHShowcaseExpiryDate%2c+BAHShowcasePublishDate%2c+write+%2c+path+%2c+ArticleByLineOWSTEXT+%2c+BAHStreamDisplay+%2cBAHYammerCommentCountOWSNMBR+%2cViewsRecent'&sortlist='BAHShowcaseP" +
                        "ublishDate:descending'&rowlimit=" + additionalArticlesCount;
                    $.getJSON(getDataUrl, function (data) {
                        var groupLevelResultData = BahUtilities.getSharePointSearchResults(data);
                        if (groupLevelResultData.Rows) {
                            var groupLevelResultCount = groupLevelResultData.Rows.length;
                            Widgets.accountNews.featuredNewsArray.featuredCount = (accountLevelResultCount + groupLevelResultCount);
                        } else {
                            Widgets.accountNews.featuredNewsArray.featuredCount = accountLevelResultCount;
                        }
                        //Widgets.accountNews.featuredNewsArray.featuredCount = 1;
                        $.each(groupLevelResultData.Rows, function (key, val) {
                            accountLevelResultData.Rows.push(val);
                        });
                        getArticleShowcasePromise.resolve();
                    });
                } else {
                    getArticleShowcasePromise.resolve();
                }
                $.when(getArticleShowcasePromise).done(function () {
                    $.each(accountLevelResultData.Rows, function (key, val) {
                        var article = {
                            image: Bah.getImageRendition($(Bah.getResultValueByKey('PublishingImage', val.Cells)).attr('src'), 3),
                            title: Bah.getResultValueByKey('Title', val.Cells),
                            articleUrl: '/Pages/Article.aspx?path=' + Bah.getResultValueByKey('path', val.Cells),
                            featureLevel: 'NewsArticle',
                            body: Bah.getResultValueByKey('ArticleByLineOWSTEXT', val.Cells),
                            views: Bah.getResultValueByKey('ViewsRecent', val.Cells),
                            comments: Bah.getResultValueByKey('BAHYammerCommentCountOWSNMBR', val.Cells),
                            shortName: '',
                            color: ''
                        };
                        $.each(val.Cells, function (key, val) {
                            if (val.Key === "BAHStreamDisplay") {
                                var shortName = val.Value.split(":");
                                shortName = shortName[shortName.length - 1];
                                if (shortName === parentTermName) {
                                    article.shortName = parentTermProps["acronym"];
                                    article.color = parentTermProps["tagcolor"];
                                }
                                if (shortName === orgTermName) {
                                    article.shortName = orgTermProps["acronym"];
                                    article.color = orgTermProps["tagcolor"];
                                }

                            }
                        });
                        Widgets.accountNews.featuredNewsArray.featured.push(article);
                    });
                    Widgets.accountNews.buildFeaturedArticleArrayPromise.resolve();
                });
            });
        },
        loadLeadershipMessage: function () {
            /***********************************************/
            /****** QUERY TO LOAD LEADERSHIP MESSAGE *******/
            /******************* STEP 2 ********************/
            //SP Search Query Took
            //Query: contenttype:"Leadership Messages" AND BAHStream:"Defense Intelligence Group" AND BAHNewsArticleFeatured:1
            //Select Params: write,BAHStream,Title,BAHLeader,Modified,BAHNewsArticleFeatured,BAHLeaderOWSUSER,ContentType, BodyOWSMTXT
            //Rest Call: http://zonedev.sharepoint.com/_api/search/query?querytext='BAHStream:"Army"+AND+(BAHStreamShowcaseOWSBOOL:0+OR+ContentType:"Leadership+Messages")+AND+(ContentType:"Zone+Publishing+Stream+Enhanced+News+Page"+OR+ContentType:"Leadership+Messages")'&selectproperties='BAHStream%2c+ContentType%2c+Title%2c+PublishingImage%2c+ArticleByLineOWSTEXT%2c+PublishingPageContentOWSHTML%2cBAHStreamShowcaseOWSBOOL%2c+BAHShowcaseExpiryDate%2c+BAHShowcasePublishDate%2c+write%2c+Created%2c+path%2c+BAHLeader'&sortlist='Created:descending&rowlimit=10'


            var getDataUrl = "/_api/search/query?querytext='contenttype:\"Leadership+Messages\"+AND+BAHStreamDisplay=\"" + encodeURIComponent(parentTermName) + ":" + encodeURIComponent(orgTermName) +
                    "\"+AND+BAHNewsArticleFeatured:1'&trimduplicates=false&rowlimit=1&selectproperties='write%2cBAHStreamDisplay%2cTitle%2cBAHLeader%2cModified%2cBAHNewsArticleFeatured%2cBAHLeaderOWSUSER%2cContentType%2cBodyOWSMTXT'&sortlist='write:descending'";
            $.getJSON(getDataUrl, function (data) {
                var accountLevelResultData = BahUtilities.getSharePointSearchResults(data);
                if (BahUtilities.getSharePointTotalResults(data) > 0) {
                    $.each(accountLevelResultData.Rows, function (key, val) {
                        var article = {
                            title: Bah.getResultValueByKey('Title', val.Cells),
                            featureLevel: 'LeadershipMessage',
                            message: $(Bah.getResultValueByKey('BodyOWSMTXT', val.Cells)).text(),
                            //expandedMessage: '', use if read more needs to be implemented
                            shortName: '',
                            //expandable: false, use if read more needs to be implemented
                            //expanded: false,
                            color: ''
                        };
                        $.each(val.Cells, function (key, val) {
                            if (val.Key === "BAHStreamDisplay") {
                                var shortName = val.Value.split(":");
                                shortName = shortName[shortName.length - 1];
                                if (shortName === parentTermName) {
                                    article.shortName = parentTermProps["acronym"];
                                    article.color = parentTermProps["tagcolor"];
                                }
                                if (shortName === orgTermName) {
                                    article.shortName = orgTermProps["acronym"];
                                    article.color = orgTermProps["tagcolor"];
                                }
                            }
                        });
                        article.message = article.message.replace(/\[paragraph]/g, "<br /><br />");
                        //var limit = 1070;
                        //var tmplength = article.message.length;
                        //var tmp = article.message;
                        //if (tmplength > limit) {
                        //    var count = tmp.substring(0, limit).split("[paragraph]"); //count to assist line below
                        //    limit = limit - (count.length * 150); //remove roughly 1 line to prevent widget from expanding beyond the max height of carousel
                        //    tmp = tmp.replace(/\[paragraph]/g, "<br /><br />"); //Search for forced paragraphs and replace with breaks
                        //    //Edge case to handle if a break is in the split range. Just increase characters to contain break temporarily
                        //    if (limit + 14 < tmp.length) { //check to make sure index out of bounds does not happen
                        //        if (tmp.substring(limit - 14, limit + 14).indexOf("<br /><br />") > -1) {
                        //            article.message = tmp.substring(0, limit + 14);
                        //            article.expandedMessage = tmp.substring(limit + 14, article.messagelength);
                        //        } else {
                        //            article.message = tmp.substring(0, limit);
                        //            article.expandedMessage = tmp.substring(limit, article.messagelength);
                        //        }
                        //        article.expandable = true;
                        //    } else {
                        //        article.message = tmp.substring(0, tmp.length); //There is only 14 additional characters just print them out since you would if there was a break anyways
                        //    }
                        //}
                        //else {
                        //    article.message = tmp;
                        //}
                        Widgets.accountNews.featuredNewsArray.news.unshift(article);
                    });
                    Widgets.accountNews.getLeadershipMessagePromise.resolve();
                }

            });
        },
        loadArticleNewsFeed: function (startPosition) {
            /***********************************************/
            /****** QUERY TO LOAD/MORE FEED ARTICLES *******/
            /******************* STEP 3 ********************/
            //SP Search Query Took
            //Query Text: BAHStream:"Army" AND (BAHStreamShowcaseOWSBOOL:0 OR ContentType:"Leadership Messages") AND (ContentType:"Zone Publishing Stream Enhanced News Page" OR ContentType:"Leadership Messages")
            //Select Properties: BAHStream, ContentType, Title, PublishingImage, ArticleByLineOWSTEXT, PublishingPageContentOWSHTML,BAHStreamShowcaseOWSBOOL, BAHShowcaseExpiryDate, BAHShowcasePublishDate, write, Created, path, BAHLeader, ArticleByLineOWSTEXT
            //Sort List: Created:descending

            var getDataUrl = "/_api/search/query?querytext='BAHStreamDisplay=\"" + encodeURIComponent(parentTermName) + ":" + encodeURIComponent(orgTermName) +
                    "\"+AND+BAHStreamShowcaseOWSBOOL:0+AND(BAHArticleDate<%3dToday)+'&trimduplicates=false&selectproperties='BAHStreamDisplay%2c+ContentType%2c+Title%2c+PublishingImage%2c+ArticleByLineOWSTEXT%2c+PublishingPageContentOWSHTML%2c" +
                    "BAHStreamShowcaseOWSBOOL%2c+BAHShowcaseExpiryDate%2c+BAHShowcasePublishDate%2c+write%2c+Created%2c+path%2c+BAHLeader%2c+BodyOWSMTXT+%2" +
                    "cArticleByLineOWSTEXT+%2cBAHYammerCommentCountOWSNMBR+%2cViewsRecent+%2cBAHArticleDate'&s" +
                    "ortlist='BAHArticleDate:descending'&rowlimit=5&startrow=" + startPosition;
            if (Widgets.accountNews.featuredNewsArray.loadSubAccount) {
                getDataUrl = "/_api/search/query?querytext='BAHStreamDisplay:\"" + encodeURIComponent(parentTermName) + ":" + encodeURIComponent(orgTermName) +
                    "\"+AND+BAHStreamShowcaseOWSBOOL:0'&trimduplicates=false&selectproperties='BAHStreamDisplay%2c+ContentType%2c+Title%2c+PublishingImage%2c+ArticleByLineOWSTEXT%2c+PublishingPageContentOWSHTML%2c" +
                    "BAHStreamShowcaseOWSBOOL%2c+BAHShowcaseExpiryDate%2c+BAHShowcasePublishDate%2c+write%2c+Created%2c+path%2c+BAHLeader%2c+BodyOWSMTXT+%2" +
                    "cArticleByLineOWSTEXT+%2cBAHYammerCommentCountOWSNMBR+%2cViewsRecent+%2cBAHArticleDate'&s" +
                    "ortlist='BAHArticleDate:descending'&rowlimit=5&startrow=" + startPosition;
            }
            $.getJSON(getDataUrl, function (data) {
                var accountLevelResultData = BahUtilities.getSharePointSearchResults(data);
                Widgets.accountNews.featuredNewsArray.totalSearchResults = BahUtilities.getSharePointTotalResults(data);

                //Check to see if subaccount articles need to be loaded (If 0 results in primary then it loads subaccount articles instead.
                if (Widgets.accountNews.featuredNewsArray.totalSearchResults == 0 || Widgets.accountNews.featuredNewsArray.totalSearchResults == null) {
                    //Widgets.accountNews.featuredNewsArray.loadSubAccount = true;
                    //Widgets.accountNews.loadArticleNewsFeed(startPosition);
                }
                else {
                    Widgets.accountNews.featuredNewsArray.currentSearchIndex += accountLevelResultData.Rows.length;
                    $.each(accountLevelResultData.Rows, function (key, val) {
                        var article = {
                            image: Bah.getImageRendition($(Bah.getResultValueByKey('PublishingImage', val.Cells)).attr('src'), 3),
                            title: Bah.getResultValueByKey('Title', val.Cells),
                            articleUrl: '/Pages/Article.aspx?path=' + Bah.getResultValueByKey('path', val.Cells),
                            featureLevel: 'NewsArticle',
                            body: Bah.getResultValueByKey('ArticleByLineOWSTEXT', val.Cells),
                            message: '',
                            views: Bah.getResultValueByKey('ViewsRecent', val.Cells),
                            comments: Bah.getResultValueByKey('BAHYammerCommentCountOWSNMBR', val.Cells),
                            shortName: '',
                            color: ''
                        };
                        $.each(val.Cells, function (key, val) {
                            //This will NOT FUNCTION on subaccount level
                            if (val.Key === "BAHStreamDisplay") {
                                var shortName = val.Value.split(":");
                                shortName = shortName[shortName.length - 1];
                                if (shortName === parentTermName) {
                                    article.shortName = parentTermProps["acronym"];
                                    article.color = parentTermProps["tagcolor"];
                                }
                                if (shortName === orgTermName) {
                                    article.shortName = orgTermProps["acronym"];
                                    article.color = orgTermProps["tagcolor"];
                                }
                            }
                        });
                        Widgets.accountNews.featuredNewsArray.news.push(article);
                    })
                };
                if (startPosition !== 0) {
                    var template = Handlebars.compile($('#accountNewsTemplate').html());
                    var html = template(Widgets.accountNews.featuredNewsArray);
                    $(Widgets.accountNews.container).html(html);
                } else {
                    Widgets.accountNews.getArticlePromise.resolve();
                }
            });
            Widgets.accountNews.preventLoadMore = false;
        },
        loadMoreArticles: function (startPosition) {
            document.getElementById('LoadMore').removeAttribute("onclick");
            if (!Widgets.accountNews.preventLoadMore) {
                Widgets.accountNews.preventLoadMore = true;
                if (Widgets.accountNews.featuredNewsArray.loadSubAccount == false) {
                    Widgets.accountNews.loadArticleNewsFeed(startPosition)
                } else {
                    Widgets.accountNews.loadSubAccountArticleNewsFeed(startPosition)
                }

            }
        }
    };
})(jQuery);

///#source 1 1 Widgets/AccountPage/accountSearch.js
var Widgets = Widgets || {};

(function ($) {
    Widgets.accountSearch = {
        name: 'Account Search',
        log: true,
        load: function (options) {
            var template = Handlebars.compile($('#accountSearchTemplate').html());
            var html = template();
            $(Widgets.accountSearch.container).html(html);
        },
        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);
///#source 1 1 Widgets/AccountPage/accountTrending.js
var Widgets = Widgets || {};

(function ($) {
    Widgets.accountTrending = {
        name: 'Trending',
        log: true,
        getOrgName: function () {
            return $.when(Widgets.accountHeader.orgIdTermSetPromise).then(
                 function () {
                     return orgTermName;
                 }
            );
        },
        getAcronym: function () {
            return $.when(Widgets.accountHeader.orgIdTermSetPromise).then(
                        function () {
                            return orgTermProps["acronym"];
                        }
                    );
        },
        getColor: function () {
            return $.when(Widgets.accountHeader.orgIdTermSetPromise).then(
                        function () {
                            return orgTermProps["tagcolor"];
                        }
                    );
        },
        load: function (options) {
            var html;
            var viewModel = [];
            var template = Handlebars.compile($('#accountTrendingTemplate').html());       
            var bahStream, orgColor, orgAcronym;

            $.when(Widgets.accountHeader.orgIdTermSetPromise).done(function () {
                bahStream = orgTermName.replace(" ", "+");
                orgColor = orgTermProps["tagcolor"];
                orgAcronym = orgTermProps["acronym"];
                
                var queryUrl = "/_api/search/query?querytext='BAHStreamDisplay=\"" + encodeURIComponent(parentTermName) + ":" + encodeURIComponent(orgTermName) + "\"+AND+Contenttypeid:\"0x010100C568DB52D9D0A14D9B2FDCC96666E9F2007948130EC3DB064584E219954237AF3900242457EFB8B24247815D688C526CD44D007AA3961D9E004361B23524B1971FC9CD03*\"'&trimduplicates=false&rowlimit=3&selectproperties='BAHStreamDisplay%2c+Title%2cPublishingImage%2cArticleByLineOWSTEXT%2cOriginalPath%2cBAHStream%2cViewsRecent%2cBAHYammerCommentCountOWSNMBR'&sortlist='ViewsRecent:descending'";


                $.ajax({
                    async: true,
                    url: queryUrl,
                    type: 'GET',
                    headers: { 'Accept': 'application/json; odata=verbose' },
                    cache: false,
                    success: function (data) {
                        if (data.d !== undefined) {
                            var results = data.d.query.PrimaryQueryResult.RelevantResults.Table.Rows.results;

                            if (results.length > 0) {

                                ////Iterates through the results and creates the item view model.
                                $.each(results, function (index, result) {
                                    var resultsRow = result.Cells.results;

                                    var item = {
                                        title: Bah.getResultValueByKey('Title', resultsRow),
                                        url: _spPageContextInfo.webServerRelativeUrl + "Pages/Article.aspx?path=" + Bah.getResultValueByKey('OriginalPath', resultsRow),
                                        publishingImage: Bah.getImageRendition(Bah.getResultValueByKey('PublishingImage', resultsRow),3),
                                        description: Bah.getResultValueByKey('ArticleByLineOWSTEXT', resultsRow),
                                        viewsRecent: Bah.getResultValueByKey('ViewsRecent', resultsRow),
                                        yammerCommentCount: Bah.getResultValueByKey('BAHYammerCommentCountOWSNMBR', resultsRow),
                                        bahOrg: orgAcronym,
                                        tagColor: orgColor
                                    };

                                    viewModel.push(item);
                                });
                            }
                        }

                        html = template(viewModel);
                        $(Widgets.accountTrending.container).html(html);
                    }
                });
            }
            );
        },
        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);
///#source 1 1 Widgets/AccountPage/accountSubscribe.js
var Widgets = Widgets || {};

(function ($) {
    Widgets.accountSubscribe = {
        name: 'Account Subscribe',
        log: true,
        load: function (options) {
            var self = this;
            var template = Handlebars.compile($('#accountSubscribeTemplate').html());
            var data = "";
            var html = template(data);
            $(Widgets.accountSubscribe.container).html(html);

            this.subscriptionCheck();

            $(".acctsub-button").on("click", function () {
                //get the users personal feed
                self.getMyFeed().then(function (data) {
                    var personalFeed = data;
                    //ensure we have the current org
                    $.when(Widgets.accountHeader.orgIdTermSetPromise).then(function () {
                        var subButton = $(".acctsub-button");
                        var orgValue = subButton.attr("data-orgid");
                        //var orgName = orgTermSet.get_name();
                        var updatedSelections = "";
                        var buttonText = subButton.text();
                        if (orgValue != "") {
                            if (buttonText == "Subscribe") {
                                //add the organization to the users feed
                                if (personalFeed != "") {
                                    updatedSelections = personalFeed + "|" + orgValue;
                                } else {
                                    updatedSelections = orgValue;
                                }
                                //update the users personal feed with the new feed
                                $.when(self.saveMyFeed(updatedSelections)).then(function () {
                                    subButton.text("Unsubscribe");
                                });
                            } else {
                                //remove the organization from the users feed
                                var selections = personalFeed.split("|");                               
                                var index = selections.indexOf(orgValue);
                                if (index != -1) {
                                    selections.splice(index, 1);

                                    //convert the updated array to pipe delimited string
                                    var newSelections = "";
                                    for (i = 0; i < selections.length; i++) {
                                        newSelections += selections[i] + "|"
                                    }

                                    //save the personal feed
                                    self.saveMyFeed(newSelections.substring(0, newSelections.length - 1)).then(function (data) {
                                        if (data == "success") {
                                            subButton.text("Subscribe");
                                        }
                                    });
                                }
                                //}
                            }
                        }
                    });
                });

                
            });

        },
        getUserData: function () {
            var deferred = $.Deferred();
            var clientContext = new SP.ClientContext.get_current();
            var peopleManager = new SP.UserProfiles.PeopleManager(clientContext);
            var userProfileProperties = peopleManager.getMyProperties()
            clientContext.load(userProfileProperties);
            clientContext.executeQueryAsync(
                    Function.createDelegate(this,
                        function () {
                            deferred.resolve(userProfileProperties);
                        }),
                    Function.createDelegate(this,
                        function (sender, args) { deferred.reject(sender, args); }));
            return deferred.promise();
        },
        getMyFeed: function () {
            var self = this;
            var deferred = $.Deferred();
            var userPersonalFeed;
            $.when(this.getUserData()).then(
                function (userProfileProperties) {
                    var clientContext = new SP.ClientContext.get_current();
                    var peopleManager = new SP.UserProfiles.PeopleManager(clientContext);
                    //Get the account name of the current user. It will be in the following format: "i:0#.f|membership|username@yoursite.onmicrosoft.com"
                    var currentUserAccountName = userProfileProperties.get_accountName();
                    //get the value from their user profile
                    userPersonalFeed = peopleManager.getUserProfilePropertyFor(currentUserAccountName, "BAHPersonalFeed");//Get a single value property
                    clientContext.executeQueryAsync(function () {
                        deferred.resolve(userPersonalFeed.get_value());
                    },
                    function (sender, args) {
                        var errMsg = "Error setting personal feed: " + args.get_message();
                        $("#displayError").text(errMsg);
                        console.log(errMsg);
                    });
                });

            return deferred.promise();
        },
        subscriptionCheck: function () {
            var self = this;
            var deferred = $.Deferred();
            $.when(Widgets.accountHeader.orgIdTermSetPromise).then(function () {
                var orgName = orgTermSet.get_name();
                //var orgNameTest = orgTermSet.get_parent();
                
                if (parentTermSet) {
                    orgName = parentTermSet.get_name() + ":" + orgName;
                }
                
                var subButton = $(".acctsub-button");
                subButton.attr("data-orgid", orgName);

                self.getMyFeed().then(function (data) {
                    var selections = data.split("|");
                    //use grep to see if the current org value has a match in the subscription array
                    var matches = $.grep(selections, function (value, index) {
                        return value == orgName;
                    });
                    if (matches.length > 0) {
                        //change the button context
                        var subButton = $(".acctsub-button");
                        subButton.text("Unsubscribe");
                    }
                    deferred.resolve();
                });
            });
            return deferred.promise();
        },
        saveMyFeed: function (feedSelections) {
            var self = this;
            var deferred = $.Deferred();
            var selectionCount = 0;
            var arrSelections = [];

            $.when(this.getUserData()).then(
                function (userProfileProperties) {
                    var clientContext = new SP.ClientContext.get_current();
                    var peopleManager = new SP.UserProfiles.PeopleManager(clientContext);
                    //Get the account name of the current user. It will be in the following format: "i:0#.f|membership|username@yoursite.onmicrosoft.com"
                    var currentUserAccountName = userProfileProperties.get_accountName();
                    //set the value in their user profile
                    peopleManager.setSingleValueProfileProperty(currentUserAccountName, "BAHPersonalFeed", feedSelections);//Set a single value property
                    clientContext.executeQueryAsync(function () {
                        deferred.resolve("success");
                    },
                    function (sender, args) {
                        var errMsg = "Error setting personal feed: " + args.get_message();
                        console.log(errMsg);
                    });
            });

            return deferred.promise();

        },
        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);


///#source 1 1 Widgets/ArticlePage/articleSearch.js
var Widgets = Widgets || {};

(function ($) {
    Widgets.articleSearch = {
        name: "Article Search",
        redirectUrl: "",
        sParameter: "",
        log: true,

        
        getShortName: function () {
            return $.when(articleTermPromise).then(
                function () {
                    var acronym = "";
                    sParameter = "";
                    if (articleTerm != undefined) {
                        var Name = articleTerm.get_name();
                        var termProperties = articleTerm.get_customProperties();
                        sParameter = '%20AND%20BAHStreamDisplay:%22' + Name + '%22';
                        acronym = "Search within " + termProperties["acronym"];
                    }
                    else acronym = "Search for additional articles"
                    return acronym;
                });
        },

        template: function () {
            return $("#articleSearchTemplate").html();
        },

        fetch: function () {
            redirectUrl = Bah.configuration.searchResultsPageUrl;
            return $.when(Widgets.articleSearch.getShortName()).then(function (shortName) {
                return { shortName: shortName };
            });
                
        },

        parse: function (data) {
            return data;
        },

        bind: function (template, data) {
            var template = Handlebars.compile(template);
            var html = template(data);
            return html;
        },

        render: function (html, data) {
            // render and attach event here
            var self = this;
            var $container = $(this.container);
            $container.html(html);

            //just in case it gets rendered again
            $container.off('click.groupSearch');

            if (redirectUrl) { //if no url, don't even bother registering event
                var submit = function (query) {
                    if (query) {
                        //redirect here
                        window.location.href = redirectUrl + '?k=' + encodeURIComponent(query) + sParameter;
                    }
                    return false;
                };

                $container.on('click.groupSearch', '.btn-search', function () {
                    return submit($container.find('.input').val());
                });

                $container.on('keydown', '.input', function (e) {
                    var key = e.which;
                    if (key === 13) {
                        return submit($container.find('.input').val())
                    }
                });
            }
        },

        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);
///#source 1 1 Widgets/ArticlePage/articleAuthorLink.js
var Widgets = Widgets || {};

(function ($) {
    Widgets.articleAuthorLink = {
        name: 'AuthorLink',
        log: true,
        load: function (options) {
            var template = Handlebars.compile($('#articleAuthorLinkTemplate').html());
            var html = template();
            $(Widgets.articleAuthorLink.container).html(html);
        },
        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);
///#source 1 1 Widgets/ArticlePage/articleBreadcrumbs.js
var Widgets = Widgets || {};
var articlePromise = new $.Deferred();
var articleTermPromise = new $.Deferred();
var articleProperties, articleTerm;
var articleBreadcrumbs = [];
var articleOrgId;
var articleOrgName;

(function ($) {
    Widgets.articleBreadcrumbs = {
        name: 'Article Breadcrumbs',
        l1Page: 'group.aspx',
        l2Page: 'account.aspx',
        portalPage: 'Portal-Home.aspx',
        campaignPage: 'campaign.aspx',
        log: true,

        getParentLink: function (currentTerm) {
            $.when(Bah.getTermParent(currentTerm)).then(
                function (parentTerm) {
                    Widgets.articleBreadcrumbs.addCrumb(parentTerm);

                    var isRoot = parentTerm.get_isRoot();
                    if (!isRoot)
                        Widgets.articleBreadcrumbs.getParentLink(parentTerm);
                    else
                        Widgets.articleBreadcrumbs.getViewModel();
                });

        },

        processData: function () {
            //   $.when(Widgets.articleBreadcrumbs.getTermData(streamNames[crumbCount])).then(
            $.when(Bah.getTerm(Bah.Constants.Guid.StreamTermSet, articleOrgId)).then(
                    function (term) {
                        articleTerm = term;
                        articleTermPromise.resolve();
                        Widgets.articleBreadcrumbs.addCrumb(term);
                        var currentOrgId = term.get_id();
                        var isRoot = term.get_isRoot();

                        //get first parent
                        if (!isRoot) {
                            $.when(Bah.getTerm(Bah.Constants.Guid.StreamTermSet, currentOrgId)).then(
                                function (groupTerm) {
                                    Widgets.articleBreadcrumbs.getParentLink(groupTerm);
                                });
                        }
                        else
                            Widgets.articleBreadcrumbs.getViewModel();
                    });


        },

        addCrumb: function (term) {
            var TermId = term.get_id();
            var Name = term.get_name();

            var item = {
                id: TermId,
                name: Name
            }
            articleBreadcrumbs.push(item);
        },

        getViewModel: function () {
            var html;
            var context = this;
            var rootSiteUrl = _spPageContextInfo.siteAbsoluteUrl;
            var template = Handlebars.compile($('#articleBreadcrumbsTemplate').html());
            var viewModel = [];
            var item = {
                slash: "",
                link: rootSiteUrl,
                name: "Home"
            }
            viewModel.push(item);
            var crumbTotal = articleBreadcrumbs.length - 1;
            var l1Name = articleBreadcrumbs[crumbTotal].name.toLowerCase();
            // Handle Functional Community artcles
            if (l1Name === "functional community") {
                for (var i = crumbTotal; i >= 0; i--) {
                    var name = articleBreadcrumbs[i].name;
                    var item = {
                        slash: "/",
                        link: name === "Functional Community" ? rootSiteUrl + "/sites/fc/" : rootSiteUrl + "/Pages/Functional-Community.aspx?orgid=" + articleBreadcrumbs[i].id,
                        name: articleBreadcrumbs[i].name
                    };
                    viewModel.push(item);
                }
            } else {
                var isPlatform = false;
                for (i = crumbTotal; (i >= 0) ; i--) {
                    var page = '';
                    if (i == crumbTotal)
                        page = Widgets.articleBreadcrumbs.l1Page;
                    else {
                        if (l1Name == 'campaigns')
                            page = Widgets.articleBreadcrumbs.campaignPage
                        else
                            page = Widgets.articleBreadcrumbs.l2Page;
                    }
                    if (articleBreadcrumbs[i].name.toLowerCase() == "platforms") {
                        isPlatform = true;
                    }
                    if (articleBreadcrumbs[i].name.toLowerCase() != 'campaigns' && isPlatform != true) {
                        var link = rootSiteUrl + "/Pages/" + page + "?orgid=" + articleBreadcrumbs[i].id;
                        var item = {
                            slash: "/",
                            link: link,
                            name: articleBreadcrumbs[i].name
                        }
                        viewModel.push(item);
                    }
                    if (isPlatform == true && articleBreadcrumbs[i].name.toLowerCase() != 'platforms') {
                        var link = rootSiteUrl + "/Pages/" + context.portalPage + "?orgid=" + articleBreadcrumbs[i].id;
                        var item = {
                            slash: "/",
                            link: link,
                            name: articleBreadcrumbs[i].name
                        }
                        viewModel.push(item);
                    }
                }
            }
            

            html = template(viewModel);
            $(Widgets.articleBreadcrumbs.container).html(html);
        },

        getArticleProperties: function () {
            var path = Bah.GetQueryStringParams("path");
            path = decodeURIComponent(path);
            //var queryUrl = "/_api/search/query?querytext='Path:\"" + encodeURIComponent(path) + "\"'&rowLimit=1&selectproperties='BAHKeywordTags,Title,BAHStream,Created'";
            var queryUrl = "/_api/search/query?querytext='Path:\"" + encodeURIComponent(path) + "\"'&rowLimit=1&selectproperties='BAHKeywordTags%2cTitle%2cPublishingImage%2cListItemId%2cSPWebUrl%2cCreated%2cLastModifiedTime%2cArticleByLineOWSTEXT%2cBAHStream%2c%2cBAHStreamDisplay%2cPublishingContactOWSUSER'";

            $.ajax({
                async: true,
                url: queryUrl,
                type: 'GET',
                headers: { 'Accept': 'application/json; odata=verbose' },
                cache: false,
                success: function (data) {
                    var crumbCount;
                    if (data.d !== undefined) {
                        var results = data.d.query.PrimaryQueryResult.RelevantResults.Table.Rows.results;

                        if (results.length > 0) {
                            var result = results[0].Cells.results;
                            articleProperties = result;
                            var bahstream = Bah.getResultValueByKey("BAHStream", result).trim();
                            if (bahstream.length > 0) {
                                var StreamList = bahstream.split(";");
                                var Stream = StreamList[0].split("|#");
                                articleOrgId = Stream[Stream.length - 1];
                                //get OrgName
                                var StreamNameList = StreamList[1].split("|");
                                var StreamNames = StreamNameList[StreamNameList.length - 1].split(":");
                                articleOrgName = StreamNames[StreamNames.length - 1];

                                articlePromise.resolve();
                                Widgets.articleBreadcrumbs.processData();
                            }//end if
                            else {
                                articleTermPromise.resolve();
                                Widgets.articleBreadcrumbs.getViewModel();
                            }
                        }//if results.length                      
                    }//end if data.d
                },// end success

                fail: function (error, event) {
                    console.log("Failed getArticleProperties in articleBreadcrumbs: " + args.get_message());
                    Bah.logging.error(event, this.name);
                }
            });//end $.ajax
        },

        load: function (options) {
            Widgets.articleBreadcrumbs.getArticleProperties();
        },
        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);
///#source 1 1 Widgets/ArticlePage/articleCampaign.js
var Widgets = Widgets || {};

(function ($) {
    Widgets.articleCampaign = {
        name: 'Campaign',
        log: true,
        load: function (options) {
            var template = Handlebars.compile($('#articleCampaignTemplate').html());
            var html = template();
            $(Widgets.articleCampaign.container).html(html);
        },
        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);
///#source 1 1 Widgets/ArticlePage/articleContent.js
var Widgets = Widgets || {};

(function ($) {
    Widgets.articleContent = {
        name: 'Content',
        log: true,
        load: function (options) {
            var template = Handlebars.compile($('#articleContentTemplate').html());
            var html = template();
            $(Widgets.articleContent.container).html(html);
        },
        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);
///#source 1 1 Widgets/ArticlePage/articleHeader.js
var Widgets = Widgets || {};

(function ($) {
    Widgets.articleHeader = {
        name: 'Article Header',
        log: true,
        orgIdTermSetPromise: new $.Deferred(),


        getArticleHeaderProperties: function () {
            var orgTermName, orgTermProps;
            var path = Bah.GetQueryStringParams("path");
            path = decodeURIComponent(path);
            var queryUrl = "/_api/search/query?querytext='Path:\"" + encodeURIComponent(path) + "\"'&rowLimit=1&selectproperties='BAHKeywordTags%2cTitle%2cPublishingImage%2cListItemId%2cSPWebUrl%2cCreated%2cCreatedBy%2cLastModifiedTime%2cArticleByLineOWSTEXT%2cEditorOWSUSER%2cBAHStream'";

            $.ajax({
                async: true,
                url: queryUrl,
                type: 'GET',
                headers: { 'Accept': 'application/json; odata=verbose' },
                cache: false,
                success: function (data) {
                    if (data.d !== undefined) {
                        var results = data.d.query.PrimaryQueryResult.RelevantResults.Table.Rows.results;
                        if (results.length > 0) {
                            var result = results[0].Cells.results;
                            var bahstream = Bah.getResultValueByKey("BAHStream", result).trim();
                            if (bahstream.length > 0) {
                                var StreamList = bahstream.split(";");
                                var Stream = StreamList[0].split("|#");
                                var articleOrgId = Stream[Stream.length - 1];
                                var template = Handlebars.compile($('#articleHeaderTemplate').html());
                                $.when(Bah.getTerm(Bah.Constants.Guid.StreamTermSet, articleOrgId)).then(
                                    function (groupTerm) {
                                        orgTermName = groupTerm.get_name();
                                        orgTermProps = groupTerm.get_customProperties();
                                        termSetData = {
                                            name: orgTermName,
                                            acronym: orgTermProps["acronym"],
                                            tagcolor: orgTermProps["tagcolor"]
                                        }
                                        //Widgets.articleHeader.orgIdTermSetPromise.resolve();
                                        var html = template(termSetData);
                                        $(Widgets.articleHeader.container).html(html);
                                    }
                                );
                            }//end if
                        }//if results.length                      
                    }//end if data.d
                },// end success
                fail: function (error, event) {
                    console.log("Failed getArticleProperties in articleHeader: " + args.get_message());
                    Bah.logging.error(event, this.name);
                }
            });//end $.ajax
        },


        load: function (options) {
            $('html').addClass('bah-group-page');
            Widgets.articleHeader.getArticleHeaderProperties();
        },


        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);
///#source 1 1 Widgets/ArticlePage/articleKeywords.js
var Widgets = Widgets || {};

(function ($) {
    Widgets.articleKeywords = {
        name: 'Article Keywords',
        log: true,
        Tags: "",
        load: function (options) {
            var html;
            var viewModel = {
                isDisplay: false,
                tags: []
            };
            
            var template = Handlebars.compile($('#articleKeywordsTemplate').html());

            $.when(articlePromise).then(
                function () {
                    if (articleProperties.length > 0) {

                        Tags = Bah.getResultValueByKey("BAHKeywordTags", articleProperties);

                        if (Tags.trim().length > 0) {
                            viewModel.isDisplay = true;
                            var tagList = Tags.split(';');

                            ////Iterates through the Tag list and creates the item view model.
                            for (var i = 0; i < tagList.length; i++) {
                                var item = {
                                    tag: tagList[i]
                                };
                                viewModel.tags.push(item);
                            }
                            html = template(viewModel);
                            $(Widgets.articleKeywords.container).html(html);
                        }
                    }//end if
                }//end func
            );
        },


        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);
///#source 1 1 Widgets/ArticlePage/articleRelated.js
var Widgets = Widgets || {};
var articleRelatedTags = [];

(function ($) {
    function getRendition(itemPublishingImage) {
        var returnImg = "";
        var imgArray = ["png", "jpg", "gif", "jpeg"];
        $.each(imgArray, function (index, value) {
            if (itemPublishingImage != null) {
                if (itemPublishingImage.indexOf(value) > 0) {
                    returnImg = itemPublishingImage.replace(eval("/(" + value + ")([?]RenditionID=[0-9])?/gi"), value + "?RenditionID=3");
                }
            }
        });
        return returnImg;
    }

    Widgets.articleRelated = {
        name: 'Related',
        log: true,
        
        load: function (options) {
            var html;
            var viewModel = [];
            var template = Handlebars.compile($('#articleRelatedTemplate').html());

            //var orgColor = this.getColor;
            //var orgAcronym = this.getAcronym;

            var path = Bah.GetQueryStringParams("path"); // get full path to article from query string
            path = decodeURIComponent(path);

            $.when(articlePromise).then(function () {

                var bahTagsString = "";

                Tags = Bah.getResultValueByKey("BAHKeywordTags", articleProperties);

                if (Tags != "") {
                    if (Tags.trim().length > 0) {
                        var tagList = Tags.split(';');
                    }

                    bahTagsString = "BAHKeywordTags:\"" + tagList.join("\" OR BAHKeywordTags:\"") + "\"";
                    bahTagsString.replace(" ", "+");

                    var queryUrl = "/_api/search/query?querytext='Contenttypeid:\"0x010100C568DB52D9D0A14D9B2FDCC96666E9F2007948130EC3DB064584E219954237AF3900242457EFB8B24247815D688C526CD44D007AA3961D9E004361B23524B1971FC9CD03*\"+AND+(" + bahTagsString + ")'&rowlimit=3&selectproperties='Title%2cPublishingImage%2cArticleByLineOWSTEXT%2cOriginalPath%2cBAHStream%2cViewsRecent%2cBAHYammerCommentCountOWSNMBR'&sortlist='ViewsRecent:descending'";

                    $.ajax({
                        async: true,
                        url: queryUrl,
                        type: 'GET',
                        headers: { 'Accept': 'application/json; odata=verbose' },
                        cache: false,
                        success: function (data) {
                            if (data.d !== undefined) {
                                var results = data.d.query.PrimaryQueryResult.RelevantResults.Table.Rows.results;

                                if (results.length > 0) {
                                    results.slice
                                    ////Iterates through the results and creates the item view model.
                                    $.each(results, function (index, result) {
                                        var resultsRow = result.Cells.results;

                                        var item = {
                                            title: Bah.getResultValueByKey('Title', resultsRow),
                                            url: _spPageContextInfo.webServerRelativeUrl + "Pages/Article.aspx?path=" + Bah.getResultValueByKey('OriginalPath', resultsRow),
                                            publishingImage: getRendition(Bah.getResultValueByKey('PublishingImage', resultsRow)),
                                            description: Bah.getResultValueByKey('ArticleByLineOWSTEXT', resultsRow),
                                            viewsRecent: Bah.getResultValueByKey('ViewsRecent', resultsRow),
                                            yammerCommentCount: Bah.getResultValueByKey('BAHYammerCommentCountOWSNMBR', resultsRow)
                                            //bahOrg: orgAcronym,
                                            //tagColor: orgColor
                                        };

                                        viewModel.push(item);
                                    });
                                }
                            }

                            html = template(viewModel);
                            $(Widgets.articleRelated.container).html(html);
                        }
                    });
                }
            }
            );
        },
        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);
///#source 1 1 Widgets/ArticlePage/articleTitle.js
var Widgets = Widgets || {};

(function ($) {
    Widgets.articleTitle = {
        name: 'Title',
        log: true,
        updateView: function (model) {
            var template = Handlebars.compile($('#articleTitleTemplate').html());
            var html = template(model);
            $(Widgets.articleTitle.container).html(html);
        },
        load: function (options) {
            var self = this;
            self.options = options;

            $.when(articlePromise).then(function () { //get article metadata from promise defined in articleBreadcrumbs.js
                if (articleProperties.length > 0) {
                    var model = {
                        title: Bah.getResultValueByKey('Title', articleProperties), // article title ,
                        image: $(Bah.getResultValueByKey('PublishingImage', articleProperties)).attr('src') || "/Style Library/BAH/img/img-newscarousel-placeholder.jpg" // link to image or set to default
                    };
                    self.updateView(model);
                }
            });
        },
        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);
///#source 1 1 Widgets/ArticlePage/articleTrending.js
var Widgets = Widgets || {};
var articleTrendingOrg = [];

(function ($) {
    Widgets.articleTrending = {
        name: 'Trending',
        log: true,
        load: function (options) {
            $.when(articlePromise).then(function () {
                var streamDisplay = Bah.getResultValueByKey("BAHStreamDisplay", articleProperties) || "";
                if (streamDisplay) {
                    var html;
                    var viewModel = [];
                    var template = Handlebars.compile($('#articleTrendingTemplate').html());

                    var streamQuery;
                    if (streamDisplay.indexOf(";") > -1) {
                        streamQuery = "((BAHStreamDisplay=\"" + streamDisplay.replace(";", "\") OR (BAHStreamDisplay=\"") + "\"))";
                    }
                    else {
                        streamQuery = "(BAHStreamDisplay=\"" + streamDisplay + "\")";
                    }

                    var queryUrl = "/_api/search/query?querytext='Contenttypeid:\"0x010100C568DB52D9D0A14D9B2FDCC96666E9F2007948130EC3DB064584E219954237AF3900242457EFB8B24247815D688C526CD44D007AA3961D9E004361B23524B1971FC9CD03*\"+AND+" + encodeURIComponent(streamQuery) + "'&rowlimit=3&selectproperties='Title%2cPublishingImage%2cArticleByLineOWSTEXT%2cOriginalPath%2cBAHStreamDisplay%2cViewsRecent%2cBAHYammerCommentCountOWSNMBR'&sortlist='ViewsRecent:descending'";

                    $.ajax({
                        async: true,
                        url: queryUrl,
                        type: 'GET',
                        headers: { 'Accept': 'application/json; odata=verbose' },
                        cache: false,
                        success: function (data) {
                            if (data.d !== undefined) {
                                var results = data.d.query.PrimaryQueryResult.RelevantResults.Table.Rows.results;

                                if (results.length > 0) {

                                    ////Iterates through the results and creates the item view model.
                                    $.each(results, function (index, result) {
                                        var resultsRow = result.Cells.results;
                                        var item = {
                                            title: Bah.getResultValueByKey('Title', resultsRow),
                                            url: _spPageContextInfo.webServerRelativeUrl + "Pages/Article.aspx?path=" + Bah.getResultValueByKey('OriginalPath', resultsRow),
                                            publishingImage: Bah.getImageRendition(Bah.getResultValueByKey('PublishingImage', resultsRow), 3),
                                            description: Bah.getResultValueByKey('ArticleByLineOWSTEXT', resultsRow),
                                            viewsRecent: Bah.getResultValueByKey('ViewsRecent', resultsRow),
                                            yammerCommentCount: Bah.getResultValueByKey('BAHYammerCommentCountOWSNMBR', resultsRow)
                                        };

                                        viewModel.push(item);
                                    });
                                }
                            }

                            html = template(viewModel);
                            $(Widgets.articleTrending.container).html(html);
                        }
                    });
                }
            }
            );
        },
        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);
///#source 1 1 Widgets/ArticlePage/articleUserLink.js
var Widgets = Widgets || {};
var LastModifiedTimeTS // holds updated date/time after adding Time zone and daylight savings factor
(function ($) {
    Widgets.articleUserLink = {
        name: 'UserLink',
        log: true,
        // Given and article's SPWebUrl and ListItemId method will return an article's page content
        getArticleContent: function (spwebUrl, listItemId) {
            var def = $.Deferred();
            var context = new SP.ClientContext(spwebUrl);
            var list = context.get_web().get_lists().getByTitle("Pages");
            var listItem = list.getItemById(listItemId);
            context.load(listItem, "PublishingPageContent");
            context.executeQueryAsync(
                Function.createDelegate(this, function () {
                    var PageModDate = new Date(Bah.getResultValueByKey("LastModifiedTime", articleProperties));
                    LastModifiedTimeTS = PageModDate.toString();
                    var pageContent = listItem.get_item("PublishingPageContent"); // article page content
                    def.resolve(pageContent); // resolve promise
                }),
                Function.createDelegate(this, function (sender, args) {
                    def.reject(sender, args);
                })
            );
            return def.promise();
        },
        updateView: function (model) {
            var template = Handlebars.compile($('#articleUserLinkTemplate').html());
            var html = template(model);
            $(Widgets.articleUserLink.container).html(html);
        },
        load: function (options) {
            var self = this;
            self.options = options;

            $.when(articlePromise).then(function () { // get article metadata
                if (articleProperties.length > 0) {
                    var model = {};

                    // get article list item id and SPWeb url
                    var itemId = Bah.getResultValueByKey("ListItemId", articleProperties);
                    var spWebUrl = Bah.getResultValueByKey("SPWebUrl", articleProperties);

                    // get article page content
                    // due to possible limitation with search results truncating page content we will 
                    // have to use the client object model to retrive an article's page content
                    $.when(self.getArticleContent(spWebUrl, itemId)).then(function (pageContent) {
                        var authorDetails = Bah.getResultValueByKey("PublishingContactOWSUSER", articleProperties) || "";
                        var authorName, authorUrl;
                        if (authorDetails) {
                            var authorArray = authorDetails.split(" | ");
                            authorName = authorArray[1];

                            var accountArray = authorArray[2].split(" ");
                            authorUrl = "/Pages/View-Profile.aspx?user=" + encodeURIComponent(accountArray[1]);
                        }
                        
                        var created = Bah.getResultValueByKey("Created", articleProperties); // article created date
                        //var LastModifiedTimeTS = Bah.getResultValueByKey("LastModifiedTime", articleProperties); // article created date

                        model = {
                            authorProfileUrl: authorUrl || "", // hyperlink to user's user profile
                            author: authorName || "", // user who created article
                            createdDate: $.format.date(created, "ddd MMMM d, yyyy"), // article created date
                            lastUpdatedDate: $.format.date(LastModifiedTimeTS, "ddd MMMM d, yyyy h:mm a"), //article last modified date
                            articleByline: Bah.getResultValueByKey("ArticleByLineOWSTEXT", articleProperties) || "", // article byline
                            articleContent: pageContent || "" // article page content
                        };

                        self.updateView(model);
                    });
                }
            });
        },
        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);
///#source 1 1 Widgets/ArticlePage/articleYammer.js
var Widgets = Widgets || {};

(function ($) {
    Widgets.articleYammer = {
        name: 'Yammer',
        getArticle: function (articlePath) {
            var queryUrl = "/_api/search/query?querytext='Path:\"" + encodeURIComponent(articlePath) + "\"'&rowLimit=1&selectproperties='BAHYammerObjectURLOWSURLH'";
            return $.ajax({
                async: true,
                url: queryUrl,
                type: 'GET',
                headers: { 'Accept': 'application/json; odata=verbose' },
                cache: false
            });
        },
        updateView: function (model) {
            var template = Handlebars.compile($('#articleYammerTemplate').html());
            var html = template(model);
            $(Widgets.articleYammer.container).html(html);
        },
        load: function (options) {
            var self = this;
            self.options = options;

            var path = Bah.GetQueryStringParams("path");
            path = decodeURIComponent(path);// get full path to article from query string
            var yamtest = Bah.GetQueryStringParams("yamtest");
            var model = "";
            var yamHtml = "";
            var beginYamHtml = "yam.connect.embedFeed({ " +
                                "container: '#embedded-feed' " +
                                ", network: 'bah.com' " +
                                ", feedType: 'open-graph' " +
                                ", feedId: '' " +
                                ", 'config': { " +
                                    "    'use_sso': true, " +
                                    "    'header': false, " +
                                    "    'footer': false " +
                                    "} " +
                                ", objectProperties: { " +
                                    "    url: '";
            var endYamHtml =                        "' " +
                                    ", type: 'page' " +
                                "} " +
                            "}); ";
            
            if (yamtest == "true") {
                //for testing
                yamurl = "https://boozallen.sharepoint.com/News/Pages/Financial-Performance-FY15.aspx";
                yamHtml = beginYamHtml + yamurl + endYamHtml;
                model = {
                    yamFeed: yamHtml
                };
            } else {
                if (path) {
                    //$.when(self.getArticle(path)).then(function (data) {
                    //    if (data.d !== undefined) {
                    //        var results = data.d.query.PrimaryQueryResult.RelevantResults.Table.Rows.results;
                    //        if (results.length > 0) {
                    //            var result = results[0].Cells.results;
                    //            var item = Bah.getResultValueByKey('BAHYammerObjectURLOWSURLH', result);
                    //            if (item) {
                    //                var array = item.split(',');
                    //                if (array.length > 0) {
                                        yamHtml = beginYamHtml + path + endYamHtml;
                                        model = {
                                            yamFeed: yamHtml
                                        };
                    //                }
                    //            }
                                
                    //        }
                    //    }
                    //});
                }
            }
            
            self.updateView(model);
        },
        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);
///#source 1 1 Widgets/CampaignPage/campaignContacts.js
    /****************************************************/
    /****** USING ACCOUNT LEADERSHIP TEAM WIDGET ********/
    /****************************************************/

    /* need to override for small desktop display #3076 */
///#source 1 1 Widgets/CampaignPage/campaignContent.js
var Widgets = Widgets || {};
var campaignContentPromise = $.Deferred();

(function ($) {
    Widgets.campaignContent = {
        name: 'Content',
        log: true,
        getCampaignContent: function (spWebUrl, listItemId) {
            var context = new SP.ClientContext(spWebUrl);
            var list = context.get_web().get_lists().getByTitle("Custom Page Content");
            var listItem = list.getItemById(listItemId);
            context.load(listItem, "BAH_IntroTitle", "BAH_IntroDescription", "BAH_DetailsTitle", "BAH_DetailsDescription", "BAH_SpotlightTitle", "BAH_SpotlightDescription");
            context.executeQueryAsync(
                Function.createDelegate(this, function () {
                    var campaignPageContent = {
                        introTitle: listItem.get_item("BAH_IntroTitle") || "",
                        introContent: listItem.get_item("BAH_IntroDescription") || "",
                        detailsTitle: listItem.get_item("BAH_DetailsTitle") || "",
                        detailsContent: listItem.get_item("BAH_DetailsDescription") || "",
                        spotlightTitle: listItem.get_item("BAH_SpotlightTitle") || "",
                        spotlightContent: listItem.get_item("BAH_SpotlightDescription") || ""
                    };
                    campaignContentPromise.resolve(campaignPageContent); // resolve promise
                }),
                Function.createDelegate(this, function (sender, args) {
                    campaignContentPromise.reject(sender, args);
                })
            );
        },
        searchCampaign: function () {
            var queryUrl = "/_api/search/query?querytext='ContentType:\"BAH+Generic+Content\"+AND+BAHStreamDisplay=\"" + encodeURIComponent(Widgets.campaignHeader.parentTermName) + ":" + encodeURIComponent(Widgets.campaignHeader.orgTermName) +
                            "\"'&trimduplicates=false&rowlimit=1&selectproperties='ListItemId%2cSPWebUrl'&sortlist='LastModifiedTime:descending'";
            return $.ajax({
                async: true,
                url: queryUrl,
                type: "GET",
                headers: { "Accept": "application/json; odata=verbose" },
                cache: false
            });
        },
        load: function (options) {
            var self = this;
            $.when(Widgets.campaignHeader.orgIdTermSetPromise).then(function () {
                $.when(self.searchCampaign()).then(function (searchResult) {
                    if (searchResult.d !== undefined) {
                        var results = searchResult.d.query.PrimaryQueryResult.RelevantResults.Table.Rows.results;
                        if (results.length > 0) {
                            var result = results[0].Cells.results;
                            spWebUrl = Bah.getResultValueByKey("SPWebUrl", result);
                            listItemId = Bah.getResultValueByKey("ListItemId", result);
                            self.getCampaignContent(spWebUrl, listItemId);
                            $.when(campaignContentPromise).then(function (content) {
                                var template = Handlebars.compile($('#campaignContentTemplate').html());
                                var html = template(content);
                                $(Widgets.campaignContent.container).html(html);
                            });
                        }
                    }
                });
                
            });
        },
        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);
///#source 1 1 Widgets/CampaignPage/campaignFeedback.js
var Widgets = Widgets || {};

(function ($) {
    Widgets.campaignFeedback = {
        name: 'Feedback',
        log: true,
        load: function (options) {

            $.when(campaignContentPromise).then(function (content) {
                var template = Handlebars.compile($('#campaignFeedbackTemplate').html());
                var html = template(content);
                $(Widgets.campaignFeedback.container).html(html);
            });
        },
        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);
///#source 1 1 Widgets/CampaignPage/campaignHeader.js
var Widgets = Widgets || {};
var orgIdTermSetPromise = new $.Deferred();
var orgTermName, orgTermProps, parentTermName;

(function ($) {
    Widgets.campaignHeader = {
        name: 'Header',
        log: true,
        orgIdTermSetPromise: new $.Deferred(),
        orgTermName: '',
        orgTermProps: '',
        parentTermName: '',
        parentTermProps: '',
        load: function (options) {
            $('html').addClass('bah-campaign-page');
            var orgId = Bah.GetQueryStringParams("orgid");
            var html, termSetData;
            if (orgId) {
                $.when(Bah.getTerm(Bah.Constants.Guid.StreamTermSet, orgId)).then(
                    function (groupTerm) {
                        orgTermName = groupTerm.get_name();
                        orgTermProps = groupTerm.get_customProperties();

                        Widgets.campaignHeader.orgTermName = groupTerm.get_name();
                        Widgets.campaignHeader.orgTermProps = groupTerm.get_customProperties();
                        if (!groupTerm.get_isRoot()) {
                            $.when(Bah.getTermParent(groupTerm)).then(
                                function (parentTerm) {
                                    parentTermName = parentTerm.get_name();
                                    Widgets.campaignHeader.parentTermName = parentTerm.get_name();
                                    Widgets.campaignHeader.parentTermProps = parentTerm.get_customProperties();

                                    termSetData = {
                                        name: orgTermName,
                                        acronym: orgTermProps["acronym"],
                                        tagcolor: orgTermProps["tagcolor"]
                                    }
                                    orgIdTermSetPromise.resolve();
                                    Widgets.campaignHeader.orgIdTermSetPromise.resolve();
                                    orgIdTermSetPromise.resolve();
                                    var template = Handlebars.compile($('#campaignHeaderTemplate').html());
                                    html = template(termSetData);
                                    $(Widgets.campaignHeader.container).html(html);
                                }
                            );
                        } else {
                            termSetData = {
                                name: orgTermName,
                                acronym: orgTermProps["acronym"],
                                tagcolor: orgTermProps["tagcolor"]
                            }
                            orgIdTermSetPromise.resolve();
                            Widgets.campaignHeader.orgIdTermSetPromise.resolve();

                            var template = Handlebars.compile($('#campaignHeaderTemplate').html());
                            html = template(termSetData);
                            $(Widgets.campaignHeader.container).html(html);
                        }
                    }
                );
            }
        },
        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);
///#source 1 1 Widgets/CampaignPage/campaignKeyElements.js
var Widgets = Widgets || {};


(function ($) {
    Widgets.campaignKeyElements = {
        log: true,
        viewModel: {
            links: [],
            orgName: '',
            moreLinks: false,
            expanded: false,
            render: false,
        },
        getLinks: function () {
            Query = "/_api/search/query?querytext='contenttype:\"BAH+Generic+Links\"+AND+BAHStreamDisplay=\"" + encodeURIComponent(Widgets.campaignHeader.parentTermName) + ":" + encodeURIComponent(Widgets.campaignHeader.orgTermName) + "\"'&trimduplicates=false&selectproperties=\'title%2cBAHResourceUrl\'&sortlist=\'BAHSortOrder:ascending\'&rowlimit=12";
            return $.getJSON(Query, function (data) {
                return data;
            });
        },
        showMoreLinks: function () {
            Widgets.campaignKeyElements.viewModel.expanded = !Widgets.campaignKeyElements.viewModel.expanded;
            Widgets.campaignKeyElements.compileTemplate();
        },
        load: function (options) {
            $.when(orgIdTermSetPromise).done(function () {
                Widgets.campaignKeyElements.getLinks().then(function (results) {
                    var resultData = BahUtilities.getSharePointSearchResults(results);
                    if (BahUtilities.getSharePointTotalResults(results) > 0) {
                        Widgets.campaignKeyElements.viewModel.render = true; //Allows widget to render. If no results fails gracefully
                        if (BahUtilities.getSharePointTotalResults(results) > 4) {
                            Widgets.campaignKeyElements.viewModel.moreLinks = true;
                        }
                        $.each(resultData.Rows, function (index, result) {
                            var item = {
                                title: Bah.getResultValueByKey('title', result.Cells),
                                url: Bah.getResultValueByKey('BAHResourceUrl', result.Cells)
                            };
                            Widgets.campaignKeyElements.viewModel.links.push(item);

                        });
                        Widgets.campaignKeyElements.viewModel.orgName = Widgets.campaignHeader.orgTermName + " Key Elements";
                        Widgets.campaignKeyElements.compileTemplate();
                    }
                });
            });
        },
        compileTemplate: function () {
            var template = Handlebars.compile($('#campaignKeyElementsTemplate').html());
            var html = template(Widgets.campaignKeyElements.viewModel);
            $(Widgets.campaignKeyElements.container).html(html);
        },
        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);
///#source 1 1 Widgets/CampaignPage/campaignMedia.js
var Widgets = Widgets || {};

(function ($) {
    Widgets.campaignMedia = {
        name: 'Media',
        log: true,
        getCampaignArticles: function () {
            var queryUrl = "/_api/search/query?querytext='Contenttypeid:\"0x010100C568DB52D9D0A14D9B2FDCC96666E9F2007948130EC3DB064584E219954237AF3900242457EFB8B24247815D688C526CD44D007AA3961D9E004361B23524B1971FC9CD03*\"+AND+BAHStreamShowcaseOWSBOOL:\"1\"+AND+BAHStreamDisplay=\"" + encodeURIComponent(Widgets.campaignHeader.parentTermName) + ":" +
                encodeURIComponent(Widgets.campaignHeader.orgTermName) + "\"+AND+BAHShowcasePublishDate<%3dToday+AND+BAHShowcaseExpiryDate>%3dToday'" +
                "&trimduplicates=false&rowlimit=12&selectproperties='Title%2cPath%2cPublishingImage%2cArticleByLineOWSTEXT%2cBAHNewsArticleVideoUrl'&sortlist='BAHShowcasePublishDate:descending'";

            return $.ajax({
                async: true,
                url: queryUrl,
                type: "GET",
                headers: { "Accept": "application/json; odata=verbose" },
                cache: false
            });

        },
        createModel: function (results) {
            var model = { items: [] };
            var i, length = results.length;
            for (i = 0; i < length; i++) {
                var result = results[i].Cells.results;

                // get url to video if set
                var videoUrl = Bah.alwaysString(Bah.getResultValueByKey('BAHNewsArticleVideoUrl', result)).trim() || "";

                var item = {
                    title: Bah.getResultValueByKey('Title', result), // article title 
                    url: videoUrl || "/Pages/Article.aspx?path=" + Bah.getResultValueByKey('Path', result), // article video url or generate link to article.aspx passing the url as 'path' query string parameter
                    image: $(Bah.getResultValueByKey('PublishingImage', result)).attr('src') || "/Style Library/BAH/img/img-newscarousel-placeholder.jpg", // link to image or set to default
                    byline: Bah.getResultValueByKey('ArticleByLineOWSTEXT', result) // article byline
                };

                model.items.push(item);
            }
            return model;
        },
        updateView: function (model) {
            // bind model to handlebars template
            var template = Handlebars.compile($('#campaignMediaTemplate').html());
            var html = template(model);
            $(Widgets.campaignMedia.container).html(html);

            // init slider
            $(".flexslider").flexslider({
                animation: "move",
                slideshow: true,
                slideshowSpeed: 5000,
                animationSpeed: 600,
                maxItems: 3,
                start: function () {
                    var color = Widgets.campaignHeader.orgTermProps["tagcolor"] || "";
                    // inject styles overriding pager control color into head portion of document
                    if (color) { 
                        $("head").append("<style type=\"text/css\">.flex-control-paging li a.flex-active {background:" + color + ";border: 1px solid " + color + ";}</style>");
                    }
                     
                }
            });
        },
        load: function (options) {
            self = this;
            $.when(Widgets.campaignHeader.orgIdTermSetPromise).done(function () {
                $.when(self.getCampaignArticles()).done(function (searchResult) {
                    if (searchResult.d !== undefined) {
                        var results = searchResult.d.query.PrimaryQueryResult.RelevantResults.Table.Rows.results;
                        if (results.length > 0) {
                            var model = self.createModel(results);
                            self.updateView(model);
                        }
                    }
                });
            });
        },
        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);
///#source 1 1 Widgets/CampaignPage/campaignResources.js
var Widgets = Widgets || {};

(function ($) {
    //set Inital Variables here
    var context = {name: "", data: [], count: 0, maxCount: 0};
    //var context = [];
    var comment, imageHtml, stream, sortOrder, location, articleUrl, title;
    var getAboutUsDataPromise = new $.Deferred();

    //Get Data from More About Us List
    //Step 1
    function getAboutUsData() {
        var getDataUrl = "/_api/search/query?querytext='ContentType:+\"More+About+Us\"+AND+BAHStreamDisplay=\"" + encodeURIComponent(Widgets.campaignHeader.parentTermName) + ":" + encodeURIComponent(Widgets.campaignHeader.orgTermName) + "\"'&trimduplicates=false&selectproperties='Path%2cUrl%2cTitle%2cBAHFeedbackComment%2cBAHResourceImageOWSIMGE%2cBAHStream%2cBAHSortOrder%2cBAHLocation%2cBAHLinkUrl'";
        //console.log(orgTermName);
        $.getJSON(getDataUrl, function (data) {
            var resultData = BahUtilities.getSharePointSearchResults(data).Rows;
            if (resultData.length > 0) {
                //Cycle through each Row of the data
                $.each(resultData, function () {
                    var rowData = this.Cells;
                    //Cycle through each property, looking for the ones we need
                    $.each(rowData, function () {
                        if (this.Key === "Title") {
                            title = this;
                        }
                        else if (this.Key === "BAHFeedbackComment") {
                            comment = this;
                        }
                        else if (this.Key === "BAHResourceImageOWSIMGE") {
                            imageHtml = $(this.Value).attr('src');
                        }
                        else if (this.Key === "BAHStream") {
                            stream = this;
                        }
                        else if (this.Key === "BAHSortOrder") {
                            sortOrder = this;
                        }
                        else if (this.Key === "BAHLocation") {
                            location = this;
                        }
                        else if (this.Key === "BAHLinkUrl") {
                            articleUrl = this;
                        }
                    });
                    //push the useful stuff into the view                    
                    context.data.push({ title: title, comment: comment, imageHtml: imageHtml, stream: stream, sortOrder: sortOrder, location: location, articleUrl: articleUrl });                    
                })
                getAboutUsDataPromise.resolve();
            }
        });

    }

    //Initilize Widget for campaign About Us
    //Step 0
    Widgets.campaignResources = {
        log: true,
        load: function (options) {
            $.when(orgIdTermSetPromise).done(function () {                
                context.name = orgTermName;
                getAboutUsData();
                $.when(getAboutUsDataPromise).done(function () {
                    context.count = context.data.length;
                    context.maxCount = 2;

                    var template = Handlebars.compile($('#campaignResourcesTemplate').html());
                    var html = template(context);
                    $(Widgets.campaignResources.container).html(html);


                    var $owl = $("#owl-slider-about");
                    $owl.owlCarousel({
                        paginationNumbers: false,
                        navigation: true,
                        autoPlay: false,
                        slideSpeed: 300,
                        paginationSpeed: 400,
                        singleItem: false,
                        items: 2,
                        itemsCustom: false,
                        itemsDesktop: [1199, 4],
                        itemsDesktopSmall: [979, 4],
                        itemsTablet: [767, 4],
                        itemsTabletSmall: [620, 3],
                        itemsMobile: [479, 3],
                        singleItem: false,
                        itemsScaleUp: false
                    });

                    // Custom Navigation Events
                    $(".nextnn").click(function () {
                        $owl.trigger('owl.next');
                    });
                    $(".prevpp").click(function () {
                        $owl.trigger('owl.prev');
                    });
                });
            });
        },
        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };

})(jQuery);

///#source 1 1 Widgets/CampaignPage/campaignSearch.js
var Widgets = Widgets || {};

(function ($) {
    Widgets.campaignSearch = {
        name: "Campaign Search",
        redirectUrl: "",
        sParameter: "",
        log: true,

        getShortName: function () {
            return $.when(orgIdTermSetPromise).then(
                    function () {
                        sParameter = '%20AND%20BAHStreamDisplay:%22' + orgTermName + '%22';
                        return orgTermProps["acronym"];
                    }
                );
        },

        template: function () {
            return $("#campaignSearchTemplate").html();
        },

        fetch: function () {
            redirectUrl = Bah.configuration.searchResultsPageUrl;
            return $.when(Widgets.groupSearch.getShortName()).then(function (shortName) {
                return { shortName: shortName };
            });
        },

        parse: function (data) {
            return data;
        },

        bind: function (template, data) {
            var template = Handlebars.compile(template);
            var html = template(data);
            return html;
        },

        render: function (html, data) {
            // render and attach event here
            var self = this;
            var $container = $(this.container);
            $container.html(html);

            //just in case it gets rendered again
            $container.off('click.groupSearch');

            if (redirectUrl) { //if no url, don't even bother registering event
                var submit = function (query) {
                    if (query) {
                        //redirect here
                        window.location.href = redirectUrl + '?k=' + encodeURIComponent(query) + sParameter;
                    }
                    return false;
                };

                $container.on('click.groupSearch', '.btn-search', function () {
                    return submit($container.find('.input').val());
                });

                $container.on('keydown', '.input', function (e) {
                    var key = e.which;
                    if (key === 13) {
                        return submit($container.find('.input').val())
                    }
                });
            }
        },

        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);
///#source 1 1 Widgets/Shared/breadcrumbs.js
var Widgets = Widgets || {};
(function ($) {
    Widgets.breadcrumbs = {
        name: 'Breadcrumbs',
        log: true,
        load: function(options) {
            var featuredContent = {};
            var contentArray = [];
            var context = this;
            var header = Widgets.genericHeader;
            //var template = Handlebars.compile($('#peopleFeaturedContentTemplate').html());
            $.when(header.promise, header.termPromise).done(function() {
                
                var terms = header.data.termStore;
                var currentPage = header.data.configuration;
                
                for (var i = 0; i < terms.get_count(); i++) {
                    var spTerm = terms.getItemAtIndex(i);
                    if (spTerm.get_name() === currentPage) {
                        context.vm.push(spTerm.get_customProperties());
                        context.getParents(spTerm);
                    }
                    
                }
                context.vm.reverse();
                // remove empty objects // TODO: figure out why we are even getting empty objects here in termstore or code
                var data = $.grep(context.vm, function(c, i){
                    return (c.title || c.url);
                })
                var template = Handlebars.compile($('#breadcrumbsTemplate').html());
                var html = template(data); //context.vm
                $(context.container).html(html);
            });
        },
        vm: [],
        getParents: function (term) {
            var context = this;
            var header = Widgets.genericHeader;
            if (!term.get_isRoot()) {
                var terms = header.data.termStore;
                var tmpTerm = term.get_parent();
                var currentPage = tmpTerm.get_name();
                if (currentPage !== "Pages") {
                    for (var i = 0; i < terms.get_count(); i++) {
                        var spTerm = terms.getItemAtIndex(i);
                        if (spTerm.get_name() === currentPage) {
                            context.vm.push(spTerm.get_customProperties());
                            context.getParents(spTerm);
                        }
                    }
                }
            }
        },
        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);
///#source 1 1 Widgets/Shared/search.js
var Widgets = Widgets || {};

(function ($) {
    Widgets.search = {
        name: "Search",
        redirectUrl: "/Pages/Search-Results.aspx", /*Bah.configuration.searchResultsPageUrl,*/
        sParameter: "",
        log: true,

        getShortName: function () {
            var header = Widgets.genericHeader;
            return $.when(header.termPromise).then(
                    function () {
                        sParameter = '%20AND%20path:%22' + Bah.configuration.rootSiteCollectionUrl + header.data.customProperties.header.cmslocation + '%22';
                        return header.data.customProperties.header.DomainName;
                    }
                );
        },
        template: function () {
            return $("#searchTemplate").html();
        },

        fetch: function () {
            redirectUrl = Bah.configuration.searchResultsPageUrl;
            return $.when(Widgets.search.getShortName()).then(function (shortName) {
                return { shortName: shortName };
            });
        },

        parse: function (data) {
            return data;
        },

        bind: function (template, data) {
            var template = Handlebars.compile(template);
            var html = template(data);
            return html;
        },

        render: function (html, data) {
            // render and attach event here
            var self = this;
            var $container = $(this.container);
            $container.html(html);

            //just in case it gets rendered again
            $container.off('click.search');

            if (redirectUrl) { //if no url, don't even bother registering event
                var submit = function (query) {
                    if (query) {
                        //redirect here
                        window.location.href = redirectUrl + '?k=' + encodeURIComponent(query) + sParameter;
                    }
                    return false;
                };

                $container.on('click.search', '.btn-search', function () {
                    return submit($container.find('.input').val());
                });

                $container.on('keydown', '.input', function (e) {
                    var key = e.which;
                    if (key === 13) {
                        return submit($container.find('.input').val())
                    }
                });
            }
        },

        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);
///#source 1 1 Widgets/Shared/tools.js
var Widgets = Widgets || {};
(function ($) {
	Widgets.tools = {
		name: "Tools Widget",
		log: true,
		shouldHide: false,
		fetch: function () {
			var ajax = $.ajax({
				async: true,
				url: _spPageContextInfo.webAbsoluteUrl + "/_api/web/lists/GetByTitle('Tools')/Items?$top=9&$select=Title,BAH_Position,BAH_Description,BAH_ToolUrl,BAH_Thumbnail,BAH_OpenInNewWindow&$orderby=BAH_Position,Title",
				type: "GET",
				headers: { "Accept": "application/json; odata=verbose" },
				cache: false
			});

			return ajax;
		},

		parse: function (data) {
			var $container = $(this.container);
			var dataTitle = $container.data('title');
			var dataHighlightTopThree = $container.data('highlight-top-three');
			if (typeof dataHighlightTopThree !== 'boolean') {
				dataHighlightTopThree = true;
			}

			var viewModel = {
				title: dataTitle !== undefined ? dataTitle : "START YOUR DAY HERE",
				tools: []
			};

			if (data.d != undefined) {
				$(data.d.results).each(function (index, item) {
					var url = item.BAH_ToolUrl != undefined ? item.BAH_ToolUrl.Url : "";
					var thumbnail = item.BAH_Thumbnail != undefined ? item.BAH_Thumbnail.Url : "";
					viewModel.tools.push({
						title: item.Title,
						url: url,
						position: item.BAH_Position,
						description: item.BAH_Description,
						openInNewTab: item.BAH_OpenInNewWindow,
						thumbnail: thumbnail,
						inTopThree: dataHighlightTopThree && (index < 3)
					});
				});
			}

			this.shouldHide = viewModel.tools.length === 0;

			return viewModel;
		},

		bind: function (template, data) {
			var template = Handlebars.compile(template);
			var html = template(data);
			return html;
		},

		render: function (data) {
			$(this.container).html(data);
			BS.dotdotdoter.parseElement(this.container);
			if (this.shouldHide) {
				$(this.container).hide();
			}
		},

		fail: function (error, event) {
			Bah.logging.error('Error at ' + event, this.name);
		},

		template: function () {
			return $("#toolsTemplate").html();
		}
	};
})(jQuery);
///#source 1 1 Widgets/Shared/quickLinks.js
var Widgets = Widgets || {};
(function ($) {

    Widgets.quickLinks = {
        log: true,

        configuration: {
            selectProperties: [
            "BAHFunctionalDescriptionOWSHTML",
            "BAHLongURLTitleOWSTEXT",
            "BAHResourceUrl",
            "BAHIconUrlOWSURLH",
            "BAHSortOrder",
            "BAHFunctionalFilter",
            "BAHWidget",
            "BAHFunctionalPageTitle",
            "Title"
            ],
            query: '',
            contentTypes: ['Platform List'],
        },

        load: function (options) {
            var context = this;
            var container = context.container;
            var data = {};
            data.widgetID = $(container).attr('data-section');
            data.items = null;
            var config = $(container).attr('data-configuration');
            var template = Handlebars.compile($('#quickLinksTemplate').html());

            $.when(Widgets.genericHeader.promise, Widgets.genericHeader.termPromise).done(function () {
                data.items = context.buildWidget(config);
                html = template(data);
                $(container).html(html);
            });

        },

        buildWidget: function (config) {
            var items = [];

            items = Widgets.quickLinks.buildTiles(config);

            return items;
        },

        buildTiles: function (widgetName) {
            var items = [];
           
            $.each(Widgets.genericHeader.data.results, function (index, value)
            {
                var filter = (value["BAHFunctionalFilter"]) ? value["BAHFunctionalFilter"] : null;

                // if this data belongs in the widget on this page 
                if ( value["BAHWidget"].indexOf(widgetName) > -1 && filter && filter.indexOf(widgetName) > -1 ) {

                    var tile = {
                        item: {
                            title: Bah.setEllipsis(value["Title"], 30),     //TODO:  should character max length be dynamic?
                            hoverTitle: value["Title"],
                            link: value["BAHResourceUrl"],
                            description:  value["BAHFunctionalDescriptionOWSHTML"],
                            filter: filter,
                        }
                    };
                    items.push(tile);
                }
            });
           
            return items;
        },

        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };

})(jQuery);



///#source 1 1 Widgets/Shared/hero.js
var Widgets = Widgets || {};
(function ($) {
    Widgets.hero = {
        name: 'Hero',
        log: true,
        vm: {
            slider: []
        },
        configuration: {
            selectProperties: [
            "BAHStream",
            "BAHSortOrder",
            "BAHFunctionalFilter",
            "BAHWidget",
            "BAHHeroPublishingImageOWSIMGE",
            "BAHHeroVideoEmbedOWSMTXT",
            "BAHSubTitleOWSTEXT",
            "BAHWidget",
            "Title",
            ],
            query: '',
            contentTypes: ['Hero Carousel', 'Hero Carousel Stream', 'Hero Carousel Page'] //Added Additional Content Types to get ready for name change on content type
        },

        load: function (options) {
            var html;
            var template = Handlebars.compile($('#heroTemplate').html());
            var header = Widgets.genericHeader;
            var context = this;
            $.when(header.promise).done(function () {
                $.each(header.data.results, function (key, val) {
                    if (val.BAHWidget.indexOf("Hero") > -1) {
                        var vm = {
                            bylineText: '',
                            heroImg: '',
                            heroVideo: '',
                            showVideo: false,
                            heroLink: '',
                            title: ''
                        };
                        val.Title ? vm.title = Bah.setEllipsis(val.Title, 128) : vm.title;
                        val.BAHSubTitleOWSTEXT ? vm.bylineText = Bah.setEllipsis(val.BAHSubTitleOWSTEXT, 300) : vm.bylineText;
                        //Null reference check for hero image
                        if (val.BAHHeroPublishingImageOWSIMGE) {
                            vm.heroImg = $(val.BAHHeroPublishingImageOWSIMGE).find('img').attr('src') || $(val.BAHHeroPublishingImageOWSIMGE).attr('src');;
                            vm.heroLink = $(val.BAHHeroPublishingImageOWSIMGE).attr('href');
                        }
                        //Null reference check for Hero Video
                        if (val.BAHHeroVideoEmbedOWSMTXT) {
                            vm.heroVideo = $(val.BAHHeroVideoEmbedOWSMTXT).attr('src');
                            vm.showVideo = true;
                            vm.heroVideo = vm.heroVideo.replace('autoPlay=false', 'autoPlay=true');
                            vm.heroVideo.indexOf("www.youtube.com") > -1 ? vm.heroVideo += "?autoplay=1&html5=1" : "";
                        }
                        context.vm.slider.push(vm);
                    }
                });
                $.each(context.vm.slider, function (index, val) {
                    val.id = index;
                });
                if (context.vm.slider.length > 5) {
                    context.vm.slider = context.vm.slider.slice(0, 5);
                }
                html = template(context.vm);
                $(context.container).html(html);
                $('.flexslider').each(function () {
                    $(this).flexslider({
                        animation: "move",
                        slideshow: true,
                        slideshowSpeed: 5000,
                        animationSpeed: 600,
                        after: function () { context.stopAllVideos(); }
                    });
                });
            });
        },
        stopAllVideos: function () {
            var context = this;
            $.each(context.vm.slider, function (index, val) {
                $("#heroVideo-" + val.id).attr('src', "")
                $("#heroHeroVideo-" + val.id).css({
                    display: 'none',
                });
                $("#heroVideoAside-" + val.id).css({
                    display: 'inline',
                });
            })
            $('.flexslider').each(function () {
                $(this).flexslider("pause");
                $(this).flexslider("play");
            });
        },
        videoPlay: function (id) {
            var context = this;
            $('.flexslider').each(function () {
                $(this).flexslider("pause");
            });
            $.each(context.vm.slider, function (index, val) {
                if (val.id === id) {
                    $("#heroVideo-" + id).attr('src', val.heroVideo)
                    $("#heroVideo-" + id).css({
                        display: 'inline',
                    });
                    $("#heroVideoAside-" + id).css({
                        display: 'none',
                    });
                }
            })
        },
        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);
///#source 1 1 Widgets/Shared/explore.js
var Widgets = Widgets || {};
(function ($) {
    Widgets.explore = {
        name: 'Explore',
        log: true,
        configuration: {
            selectProperties: [
            "BAHFunctionalDescriptionOWSHTML",
            "BAHLongURLTitleOWSTEXT",
            "BAHResourceUrl",
            "BAHIconUrlOWSURLH",
            "BAHSortOrder",
            "BAHFunctionalFilter",
            "BAHWidget",
            "Url",
            "Title",
            "ContentType",
            ],
            query: '',
            contentTypes: ['Functional List', 'Functional Document', 'Functional Page', 'Functional Sub Page'],
        },
        data: {max: 10},
        load: function (options) {
            var context = this;
            var template = Handlebars.compile($('#exploreTemplate').html());
            var content = Widgets.genericHeader;
            var id = $(context.container).attr('data-section');
            var title = "BAHSectionTitle" + id;
            var desc = "BAHSectionDescription" + id + "OWSHTML";

            var explorecontent = [];

            $.when(content.promise).done(function () {
                //your widget code starts executing  here to verify all data is available  
                var myContext = [];

                $.each(content.data.results, function (key, val) {
                    $.each(val, function (key2, val2) {
                        if (key2 === "BAHWidget") {
                            if (val2.indexOf("Explore") > -1) {
                                var filter = val["BAHFunctionalFilter"];
                                var category = '';
                                var url = '';

                                if (filter != null) {
                                    var titles = val["BAHFunctionalFilter"].split(':');
                                    category = titles[titles.length - 1];
                                }

                                if (val["BAHResourceUrl"] == "" || val["BAHResourceUrl"] == null) {
                                    url = val["Url"];
                                } else {
                                    url = val["BAHResourceUrl"];
                                }

                                exploreArray = {
                                    url: url,
                                    title: val["Title"],
                                    category: category
                                }
                                myContext.push(exploreArray);
                            }
                        }
                    });
                });

                var categorySort = lazy(myContext.slice(0, $(context.container).data("max"))).sortBy('category').groupBy('category').toArray();

                $.each(categorySort, function (index, value) {
                    var item =
                        {
                            category: value[0],
                            links: []
                        };
                    $.each(value[1], function (i, links) {
                        var linkInfo =
                        {
                            url: links["url"],
                            title: links["title"]
                        };

                        item.links.push(linkInfo);

                    });

                    explorecontent.push(item);
                });

                var data = {
                    name: "Explore",
                    content: explorecontent
                };

                html = template(data);
                $(context.container).html(html);
            });

        },
        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);
///#source 1 1 Widgets/Shared/iwantto.js
var Widgets = Widgets || {};
(function ($) {
    Widgets.iwantto = {
        name: 'I Want To',
        log: true,
        configuration: {
            selectProperties: [
            "BAHFunctionalDescriptionOWSHTML",
            "BAHLongURLTitleOWSTEXT",
            "BAHResourceUrl",
            "BAHIconUrlOWSURLH",
            "BAHSortOrder",
            "BAHFunctionalFilter",

            "BAHWidget",
            "BAHFunctionalPageTitle",
            "BAHHeroPublishingImageOWSIMGE",
            "BAHHeroVideoEmbedOWSMTXT",
            "Url",
            "Title",
            "ContentType",
            "BAHSubTitleOWSTEXT",
            "BAHHeroDescriptionOWSHTML",
            "BAHHeroImageOWSHTML",
            "BAHHeroBylineOWSTEXT",
            "BAHSectionDescription5OWSHTML",
            "BAHSectionDescription6OWSHTML",
            "BAHSectionDescription7OWSHTML",
            "BAHSectionDescription8OWSHTML",
            "BAHSectionDescription9OWSHTML",
            "BAHSectionDescription10OWSHTML",
            "BAHSectionTitle1",
            "BAHSectionTitle2",
            "BAHSectionTitle3",
            "BAHSectionTitle4",
            "BAHSectionTitle5",
            "BAHSectionTitle6",
            "BAHSectionTitle7",
            "BAHSectionTitle8",
            "BAHSectionTitle9",
            "BAHSectionTitle10"
            ],
            query: '',
            contentTypes: ['Functional List', 'Functional Document', 'Functional Page'],
        },
        data: { separator: 1, maxcount: 0 },
        load: function (options) {
            var context = this;
            var template = Handlebars.compile($('#iWantToTemplate').html());
            var content = Widgets.genericHeader;
            var id = $(context.container).attr('data-section');
            var title = "BAHSectionTitle" + id;
            var desc = "BAHSectionDescription" + id + "OWSHTML";

            var iwanttocontent = [];

            $.when(content.promise).done(function () {
                //your widget code starts executing  here to verify all data is available  
                var myContext = [];

                $.each(content.data.results, function (key, val) {
                    $.each(val, function (key2, val2) {
                        if (key2 === "BAHWidget") {
                            if (val2.indexOf("I Want To") > -1) {

                                var filter = val["BAHFunctionalFilter"];
                                var category = '';
                                var url = '';

                                if (filter != null) {
                                    var titles = val["BAHFunctionalFilter"].split(':');
                                    category = titles[titles.length - 1];
                                }

                                if (val["BAHResourceUrl"] == "" || val["BAHResourceUrl"] == null) {
                                    url = val["Url"];
                                } else {
                                    url = val["BAHResourceUrl"];
                                }

                                iWantToArray = {
                                    url: url,
                                    title: val["Title"],
                                    category: category
                                }

                                myContext.push(iWantToArray);
                            }
                        }
                    });
                });
                var categorySort = lazy(myContext.slice(0, $(context.container).data("max"))).sortBy('category').groupBy('category').toArray();

                $.each(categorySort, function (index, value) {
                    var item =
                        {
                            category: value[0],
                            links: []
                        };
                    $.each(value[1], function (i, links) {
                        var linkInfo =
                        {
                            url: links["url"],
                            title: links["title"],
                            separator: $(context.container).data("separator")
                        };

                        item.links.push(linkInfo);

                    });

                    iwanttocontent.push(item);
                });

                var data = {
                    name: "I Want To",
                    content: iwanttocontent
                };

                html = template(data);
                $(context.container).html(html);
            });

        },
        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);
///#source 1 1 Widgets/Shared/newsandupdates.js
var Widgets = Widgets || {};
(function ($) {
    Widgets.newsandupdates = {
        name: 'News and Updates',
        log: true,
        configuration: {
            selectProperties: [
            "BAHFunctionalDescriptionOWSHTML",
            "BAHLongURLTitleOWSTEXT",
            "BAHResourceUrl",
            "BAHIconUrlOWSURLH",
            "BAHSortOrder",
            "BAHFunctionalFilter",
            "BAHWidget",
            "BAHFunctionalPageTitle",
            "BAHHeroPublishingImageOWSIMGE",
            "BAHHeroVideoEmbedOWSMTXT",
            "Url",
            "Title",
            "ContentType",
            "BAHSubTitleOWSTEXT",
            "BAHHeroDescriptionOWSHTML",
            "BAHHeroImageOWSHTML",
            "BAHHeroBylineOWSTEXT",
            "BAHSectionDescription5OWSHTML",
            "BAHSectionDescription6OWSHTML",
            "BAHSectionDescription7OWSHTML",
            "BAHSectionDescription8OWSHTML",
            "BAHSectionDescription9OWSHTML",
            "BAHSectionDescription10OWSHTML",
            "BAHSectionTitle1",
            "BAHSectionTitle2",
            "BAHSectionTitle3",
            "BAHSectionTitle4",
            "BAHSectionTitle5",
            "BAHSectionTitle6",
            "BAHSectionTitle7",
            "BAHSectionTitle8",
            "BAHSectionTitle9",
            "BAHSectionTitle10"
            ],
            query: '',
            contentTypes: ['Functional List', 'Functional Document', 'Functional Page'],
        },
        load: function (options) {
            var context = this;
            //Reusing People Model template as the functionality is same
            var template = Handlebars.compile($('#newsTemplate').html());
            var content = Widgets.genericHeader;
            var id = $(context.container).attr('data-section');
            var title = "BAHSectionTitle" + id;
            var desc = "BAHSectionDescription" + id + "OWSHTML";

            $.when(content.promise, content.termPromise).done(function () {
                //your widget code starts executing  here to verify all data is available  
                var myContext = [];

                $.each(content.data.results, function (key, val) {
                    $.each(val, function (key2, val2) {
                        if (key2 === "BAHWidget") {
                            if (val2.indexOf("News and Updates") > -1) {
                                myContext.push(val);
                            }
                        }
                    });
                });

                var data = {
                    name: "News and Updates",
                    context: myContext.slice(0, 5)
                };

                html = template(data);
                $(context.container).html(html);

                //required for modals
                $(context.container).foundation();

                //for mobile view, so news and updates is collapsed on load
                $('.newsUpdates div.heading-main').click();
            });
        },
        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);
///#source 1 1 Widgets/Shared/connect.js
var Widgets = Widgets || {};
(function ($) {
    Widgets.connect = {
        name: 'People Connect',
        log: true,
        configuration: {
            selectProperties: [
            "BAHFunctionalDescriptionOWSHTML",
            "BAHLongURLTitleOWSTEXT",
            "BAHResourceUrl",
            "BAHIconUrlOWSURLH",
            "BAHSortOrder",
            "BAHFunctionalFilter",
            "BAHWidget",
            "BAHFunctionalPageTitle",
            "BAHHeroPublishingImageOWSIMGE",
            "BAHHeroVideoEmbedOWSMTXT",
            "Url",
            "Title",
            "ContentType",
            "BAHSubTitleOWSTEXT",
            "BAHHeroDescriptionOWSHTML",
            "BAHHeroImageOWSHTML",
            "BAHHeroBylineOWSTEXT",
            "BAHSectionDescription5OWSHTML",
            "BAHSectionDescription6OWSHTML",
            "BAHSectionDescription7OWSHTML",
            "BAHSectionDescription8OWSHTML",
            "BAHSectionDescription9OWSHTML",
            "BAHSectionDescription10OWSHTML",
            "BAHSectionTitle1",
            "BAHSectionTitle2",
            "BAHSectionTitle3",
            "BAHSectionTitle4",
            "BAHSectionTitle5",
            "BAHSectionTitle6",
            "BAHSectionTitle7",
            "BAHSectionTitle8",
            "BAHSectionTitle9",
            "BAHSectionTitle10"
            ],
            query: '',
            contentTypes: ['Functional List', 'Functional Document', 'Functional Page'],
        },
        load: function (options) {
            var context = this;
            var template = Handlebars.compile($('#connectTemplate').html());
            var content = Widgets.genericHeader;
            var id = $(context.container).attr('data-section');
            var title = "BAHSectionTitle" + id;
            var desc = "BAHSectionDescription" + id + "OWSHTML";

            $.when(content.promise, content.termPromise).done(function () {
                //your widget code starts executing  here to verify all data is available  
                var resultData = content.data.customProperties.connect;

                var data = {
                    name: "Connect",
                    email: resultData.email.address,
                    phone: resultData.phone.number,
                    yammer: resultData.yammerLink['yammer url'],
                    groupTitle: $.isPlainObject(resultData.groupHeader) ? null : resultData.groupHeader,
                    groupEmail: $.isPlainObject(resultData.groupEmail) ? null : resultData.groupEmail,
                    groupYammer: $.isPlainObject(resultData.groupYammer) ? null : resultData.groupYammer,
                    isMobile: Bah.isMobile.any(),
                };

                html = template(data);
                $(context.container).html(html);
            });
        },
        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);
///#source 1 1 Widgets/Shared/videoPlayer.js
var Widgets = Widgets || {};
(function ($) {
    Widgets.videoPlayer = {
        log: true,
        configuration: {
            selectProperties: [
            "Title",
            "BAHWidget",
            "BAHHeroVideoEmbedOWSMTXT",
            "BAHIconUrlOWSURLH",
            "BAHFunctionalDescriptionOWSHTML",
            ],
            query: '',
            contentTypes: ['Functional List'],
        },
        myContext: { vm: [], widgetTitle: '', isMobile: false, totalResults: 0, currentIndex: 0 },
        load: function (options) {
            var context = this;
            var header = Widgets.genericHeader;
            $.when(header.promise).done(function () {
                $.each(header.data.results, function (key, val) {
                    if (val.BAHWidget === 'Videos') {
                        var vm = {
                            id: 0,
                            videoTitle: Bah.setEllipsis(val.Title, 30),
                            videoEmbed: $(val.BAHHeroVideoEmbedOWSMTXT).attr('src'),
                            videoIcon: val.BAHIconUrlOWSURLH.split(',')[0],
                            videoDescription: Bah.setEllipsis($(val.BAHFunctionalDescriptionOWSHTML).text(), 75),
                            activeVideo: false
                        };
                        context.myContext.vm.push(vm);
                    }
                });
                //context.testvm();
                for (i = 0; i < context.myContext.vm.length; i++) {
                    context.myContext.vm[i].id = i;
                    i === 0 ? context.myContext.vm[i].activeVideo = true : context.myContext.vm[i].activeVideo = false;
                }
                var ID = $(context.container).attr('data-section');
                var sectionTitle = "BAHSectionTitle" + ID;
                header.data.page[0] ? context.myContext.widgetTitle = header.data.page[0][sectionTitle] : context.myContext.widgetTitle = "";
                context.myContext.vm.length ? context.myContext.totalResults = context.myContext.vm.length : context.myContext.totalResults = 0;
                context.setThumbnails();
            }); //End Promise
        },
        setThumbnails: function () {
            var context = this;
            var override = parseInt($(context.container).attr('data-thumbnails'));
            if (Bah.isMobile.any() || override <= context.myContext.vm.length) {
                context.myContext.isMobile = true;
                if (Bah.isMobile.any()) {
                    context.myContext.isMobile ? context.myContext.currentIndex = 3 : context.myContext.currentIndex = context.myContext.vm.length;
                } else {
                    context.myContext.isMobile ? context.myContext.currentIndex = override : context.myContext.currentIndex = context.myContext.vm.length;
                }

            } else {
                context.myContext.currentIndex = context.myContext.vm.length;
            }
            context.compileHtml();
        },
        mobileLoadMore: function () {
            var context = this;
            context.myContext.currentIndex = context.myContext.currentIndex + 3;
            context.compileHtml();
        },
        selectVideo: function (index) {
            var context = this;
            for (i = 0; i < context.myContext.vm.length; i++) {
                context.myContext.vm[i].id === index ? context.myContext.vm[i].activeVideo = true : context.myContext.vm[i].activeVideo = false;
            }
            context.compileHtml();
        },
        compileHtml: function (input) {
            var context = this;
            var template = Handlebars.compile($('#videoPlayerTemplate').html());
            var html = template(context.myContext);
            $(context.container).html(html);
        },
        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        },
        testvm: function () {
            var context = this;
            if (context.myContext.vm.length < 6) {
                for (var i = 2; i < 8; i++) {
                    var vm = {
                        id: 0,
                        videoTitle: '',
                        videoEmbed: '',
                        videoIcon: '',
                        videoDescription: '',
                        activeVideo: false
                    };
                    vm.id = i;
                    vm.videoTitle = Bah.setEllipsis("Video Title " + i + " making this title really long to see if it cuts off properly", 30);
                    i === 0 ? vm.videoEmbed = "https://www.youtube.com/embed/3eVF9uBbuqc" : vm.videoEmbed = "https://www.youtube.com/embed/76y3QDeMm3o"
                    vm.videoIcon = "https://thethemefoundry.com/wp-content/themes/ttf-reloaded/images/single-theme/video-thumbnail.png";
                    vm.videoDescription = Bah.setEllipsis("This is video description " + i + " Let make this supper super long so it has to be ellipsis function processed blah blah blah lets make this even longer cause its not 150 characters!!!!", 75);
                    i === 0 ? vm.activeVideo = true : vm.activeVideo = false;
                    context.myContext.vm.push(vm)
                }
                context.myContext.widgetTitle = "Video Widget";
                context.myContext.vm.length ? context.myContext.totalResults = context.myContext.vm.length : context.myContext.totalResults = 0;
            }
        }
    };
})(jQuery);
///#source 1 1 Widgets/Shared/whatsnew.js
var Widgets = Widgets || {};
(function ($) {
    Widgets.whatsnew = {
        name: 'Explore',
        log: true,
        configuration: {
            selectProperties: [
            "BAHFunctionalDescriptionOWSHTML",
            "BAHLongURLTitleOWSTEXT",
            "BAHResourceUrl",
            "BAHIconUrlOWSURLH",
            "BAHSortOrder",
            "BAHFunctionalFilter",
            "BAHWidget",
            "BAHFunctionalPageTitle",
            "BAHHeroPublishingImageOWSIMGE",
            "BAHHeroVideoEmbedOWSMTXT",
            "Url",
            "Title",
            "ContentType",
            "BAHSubTitleOWSTEXT",
            "BAHHeroDescriptionOWSHTML",
            "BAHHeroImageOWSHTML",
            "BAHHeroBylineOWSTEXT",
            "BAHSectionDescription5OWSHTML",
            "BAHSectionDescription6OWSHTML",
            "BAHSectionDescription7OWSHTML",
            "BAHSectionDescription8OWSHTML",
            "BAHSectionDescription9OWSHTML",
            "BAHSectionDescription10OWSHTML",
            "BAHSectionTitle1",
            "BAHSectionTitle2",
            "BAHSectionTitle3",
            "BAHSectionTitle4",
            "BAHSectionTitle5",
            "BAHSectionTitle6",
            "BAHSectionTitle7",
            "BAHSectionTitle8",
            "BAHSectionTitle9",
            "BAHSectionTitle10"
            ],
            query: '',
            contentTypes: ['Functional List', 'Functional Document', 'Functional Page'],
        },
        load: function (options) {
            var context = this;
            var template = Handlebars.compile($('#whatsnewTemplate').html());
            var content = Widgets.genericHeader;
            var id = $(context.container).attr('data-section');
            var title = "BAHSectionTitle" + id;
            var desc = "BAHSectionDescription" + id + "OWSHTML";

            $.when(content.promise).done(function () {
                //your widget code starts executing  here to verify all data is available  
                var myContext = [];

                $.each(content.data.results, function (key, val) {
                    $.each(val, function (key2, val2) {
                        if (key2 === "BAHWidget") {
                            if (val2.indexOf("What's New") > -1) {
                                myContext.push(val);
                            }
                        }
                    });
                });

                var data = {
                    name: "What's New?",
                    context: myContext
                };

                if (myContext.length != 0) {
                    html = template(data);
                    $(context.container).html(html);
                };
            });

        },
        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);
///#source 1 1 Widgets/Shared/dynamicDropDown-1.js
var Widgets = Widgets || {};

(function ($) {
    var context;
    var pageEnd = 0;
    var descGuide;
    var titleGuide;
    var PickedFilter;
    Widgets.dynamicDropDown1 = {
        name: 'Dynamic Drop Down 1',
        log: true,
        configuration: {
            selectProperties: [
            "BAHStream",
           "BAHFunctionalDescriptionOWSHTML",
           "BAHLongURLTitleOWSTEXT",
           "BAHResourceUrl",
           "BAHIconUrlOWSURLH",
           "BAHSortOrder",
           "BAHFunctionalFilter",
           "BAHWidget",
           "BAHFunctionalPageTitle",           
           "Url",
           "Title",
           "ContentType"           
            ],
            query: '',
            contentTypes: ['Functional List', 'Functional Document', 'Functional Page'],
        },
        data: { },
        load: function (options) {
            var context = this;
            var container = context.container;
            var temp = $(context.container).attr('data-container');
            context.data[$(context.container).attr('data-container')] = {};
            var data = context.data[temp]; //temp is our container context
            data.context = temp;
            data.errorMessage = '';
            data.categoryResults = null;
            data.selectOptions = [];
            data.categoryDescription = null;
            data.widgetTitle = null;
            data.widgetDescription = null;
            data.configuration = $(context.container).attr('data-configuration');
            data.id = $(context.container).attr('data-section');
            var template = Handlebars.compile($('#dynamicDropDown1Template').html());
            var header = Widgets.genericHeader;
            
            var title = "BAHSectionTitle" + data.id;
            var desc = "BAHSectionDescription" + data.id + "OWSHTML";
            
            $.when(header.promise, header.termPromise).done(function () {
                var categoryFilter = '';
                var categoryDesc = '';
                var filters = context.getFilters(header.data.termStore, data.configuration);
                var usedFilters = [];
                var itemResults = [];

                $.each(header.data.page, function (key, item) {
                    data.widgetTitle = item[title];
                    data.widgetDescription = item[desc];
                });

                itemResults = context.buildItemArray(data.configuration);
                if(itemResults.length > 0){

                    //get only select options which have document/list item associated with it
                    //also, get the default filter to be displayed according to term store custom prop
                    var selectOptionsInfo = context.getSelectOptions(itemResults, filters);
                    if(selectOptionsInfo.length > 0){
                        categoryFilter = selectOptionsInfo[0].categoryFilter;
                        categoryDesc = selectOptionsInfo[0].categoryDesc;
                        usedFilters = selectOptionsInfo[0].usedFilters;
                        data.selectOptions = jQuery.unique(usedFilters);
                    }
                    
                    //add blank option at index 0
                    var blankOption = {
                        filterTitle: '',
                        filterDesc: '',
                        isDefault: false
                    }
                    data.selectOptions.unshift(blankOption);

                    data.categoryDescription = categoryDesc;

                    var filteredItems = itemResults.filter(function (item) {
                        return (item.category === categoryFilter);
                    });

                    data.categoryResults = context.buildSections(filteredItems);
                } else
                {
                    data.errorMessage = "It appears no documents or list items have been tagged for this query.";
                }

                html = template(data);
                $('[data-container="' + temp + '"]').html(html); //populate only the container we are dealing with at the moment

                $('#ddlDynDrop1Category-'+data.id).val(); //clear selected
                if(categoryFilter != ''){
                    if ($('#ddlDynDrop1Category-' + data.id + ' option[value="' + categoryFilter + '"]').length > 0) {
                        $('#ddlDynDrop1Category-' + data.id + ' option[value="' + categoryFilter + '"]').prop('selected', true); //set selected to designated default
                    }             
                }
                
            });
        },        
        getSelectOptions: function (itemResults, filters) { //get our select options
            //select options should only appear which have documents/list items associated
            var selectOptionsInfo = [];
            var usedFilters = [];
            var categoryFilter = '';
            var categoryDesc = '';
            for (var i = 0; i < itemResults.length; i++) {
                for (var j = 0; j < filters.length; j++) {
                    if (filters[j].filterTitle == itemResults[i].category) {
                        if (filters[j].isDefault) {
                            categoryFilter = filters[j].filterTitle;
                            categoryDesc = filters[j].filterDesc;
                        }
                       
                        usedFilters.push(filters[j]);                        
                    }
                }
            }
            var selectOption = {
                categoryFilter: categoryFilter,
                categoryDesc: categoryDesc,
                usedFilters: usedFilters
            };

            selectOptionsInfo.push(selectOption);

            return selectOptionsInfo;
        },       
        getFilters: function (terms, configuration) { //get the term store filters (categories) for this configuration of the widget
            var filterOptions = [];
            if (terms !== null) {
                for (var i = 0; i < terms.get_count() ; i++) {
                    var filterTitle = '';
                    var filterDesc = '';
                    var isDefault = false;
                    var spTerm = terms.getItemAtIndex(i);
                    if (!spTerm.get_isRoot() && spTerm.get_parent().get_name() == configuration) {

                        filterTitle = spTerm.get_name();

                        var customProperties = spTerm.get_customProperties();
                        filterDesc = customProperties["description"];
                        var defaultProp = (customProperties['default'] || '').toString();
                        if (defaultProp.toLowerCase() == 'yes') {
                            isDefault = true;
                        }
                        var filterOption = {
                            filterTitle: filterTitle,
                            filterDesc: filterDesc,
                            isDefault: isDefault
                        };
                        filterOptions.push(filterOption);
                    }
                }
            }
            return filterOptions;
        },
        getTermProperties: function (terms, configuration, termName) {
            var property;
            if(terms !== null){
                for (var i = 0; i < terms.get_count() ; i++) {
                    var filterTitle = '';
                    var filterDesc = '';
                    var isDefault = false;
                    var spTerm = terms.getItemAtIndex(i);
                    if (!spTerm.get_isRoot() && spTerm.get_parent().get_name() == configuration) {
                        if (spTerm.get_name() == termName) {
                            var customProperties = spTerm.get_customProperties();
                            filterDesc = customProperties["description"];
                            var defaultProp = (customProperties['default'] || '').toString();
                            if (defaultProp.toLowerCase() == 'yes') {
                                isDefault = true;
                            }
                            property = {
                                filterTitle: termName,
                                filterDesc: filterDesc,
                                isDefault: isDefault
                            };
                            break;
                        }
                    }
                }
            }
            return property;        
        },
        buildSections: function (itemArr) { //bulld out sections grouped by subheading or lack thereof            
            var context = this;
            var sections = [];
            
            //this creates the groupings of documents/list items by subheading
            var sectionResult = context.groupBy(itemArr, function (item) {
                return [item.subheading];
            });
            
            for (var i = 0; i < sectionResult.length; i++) {
                var items = [];
                var subheading = '';
                var currentSection = sectionResult[i];
                for (var j = 0; j < currentSection.length; j++) {
                    if (currentSection[j].subheading.toString() != '') {
                        subheading = currentSection[j].subheading;
                    }
                    var item = {
                        title: currentSection[j].title,
                        url: currentSection[j].url,
                        fileSize: currentSection[j].fileSize,
                        docType: currentSection[j].docType,
                        term: currentSection[j].term,
                        category: currentSection[j].category,
                        subheading: currentSection[j].subheading
                    };
                    items.push(item);
                }
                var section = {
                    subheading: subheading,
                    items: items
                };
                sections.push(section);
            }

            //this orders the groupings by subheading
            //blank subheading should be first, if it exists
            sections.sort(function (a, b) {
                if (a.subheading > b.subheading) { return 1; }
                if (a.subheading < b.subheading) { return -1; }
                return 0;
            });
            return sections;
        },
        buildItemArray: function (configuration) { //grab all of the items for this widget
            var header = Widgets.genericHeader;
            var itemResults = [];
            $.each(header.data.results, function (index, value) {
                var itemUrl = '';
                var itemTerm = '';
                var itemCategory = '';
                var itemDocType = '';
                var itemFileSize = '';
                var itemTitle = value.Title;
                var itemSubheading = '';
                
                if ((value.BAHWidget.indexOf(configuration) != -1) && (value.FileExtension != 'aspx' || value.BAHResourceUrl != "")) {
                    if (value.BAHFunctionalFilter != null) {
                        
                        itemTerm = value.BAHFunctionalFilter.split(':').pop(); //used to filter results by drop down
                        if (value.BAHFunctionalFilter.split(':').length == 3) {
                            //itemCategory is just beneath Filter:[[data-configuration (ex. DDD-1)]]
                            //therefore, this item has no subheading
                            itemSubheading = '';
                            itemCategory = itemTerm;
                        }
                        else
                        {
                            //so itemCategory
                            itemSubheading = itemTerm;
                            itemCategory = value.BAHFunctionalFilter.split(':')[2];
                        }
                        if (value.BAHResourceUrl == "") {
                                itemUrl = value.Url;
                        }
                        else {
                            itemUrl = value.BAHResourceUrl;                            
                            
                        }

                        if (itemUrl.indexOf(';') > -1) {
                            itemUrl = itemUrl.split(';').pop();
                        }

                        if (value.FileExtension != 'aspx') {
                            itemDocType = value.FileExtension; 
                            itemFileSize = " | " + parseInt(((value.Size) / 1000)).toString().replace(/\B(?=(?:\d{3})+(?!\d))/g, ',') + " KB";  //only show file size, if it's library item, not list
                        }
                    
                        var item = {
                            url: itemUrl,
                            title: itemTitle,
                            fileSize: itemFileSize,
                            docType: itemDocType,
                            term: itemTerm,
                            category: itemCategory,
                            subheading: itemSubheading
                        };
                        itemResults.push(item);
                    }
                }
                
            });
            return itemResults;
        },
        changeCategory: function (id, temp) {   //called by onchange event on select box
            var context = this;
            var container = context.container;           
            var categoryFilter = $('#ddlDynDrop1Category-' + id).val();
            var data = context.data[temp];
            data.name = name;
            data.errorMessage = '';
            data.categoryResults = null;
            data.categoryDescription = null;
            data.id = id;            
            var template = Handlebars.compile($('#dynamicDropDown1Template').html());
            var header = Widgets.genericHeader;
            $.when(header.promise).done(function () {
                var categoryDesc = '';
                
                var itemResults = context.buildItemArray(data.configuration);
                if (itemResults.length > 0) {                  

                    if (categoryFilter != '') {
                        var filteredItems = itemResults.filter(function (item) {
                            return (item.category === categoryFilter);
                        });

                        data.categoryResults = context.buildSections(filteredItems);

                        var termProperties = context.getTermProperties(header.data.termStore, data.configuration, categoryFilter);
                        if (termProperties != null) {
                            categoryDesc = termProperties.filterDesc;
                        }

                        data.categoryDescription = categoryDesc;

                    } else {
                        data.errorMessage = "There are no items which match this category.";
                    }                   
                    
                }
                else {
                    data.errorMessage = "Please select a category.";
                }

                html = template(data);
                $('[data-container="' + temp + '"]').html(html);

                $('#ddlDynDrop1Category-' + id).val(); //clear selected
                if ($('#ddlDynDrop1Category-' + id + ' option[value="' + categoryFilter + '"]').length > 0) {
                    $('#ddlDynDrop1Category-' + id + ' option[value="' + categoryFilter + '"]').prop('selected', true);
                }
            });
        },
        groupBy: function (array, fn) {
            var groups = {};
            array.forEach(function (value) {
                var group = JSON.stringify(fn(value));          // get the filter group  from the object
                groups[group] = groups[group] || [];            // if array does not exist for group, create new
                groups[group].push(value);                      // push the item onto groups array
            });
            return Object.keys(groups).map(function (group) {
                return groups[group];
            })
        },
        dynamicSort: function (property) {
            var sortOrder = 1;
            if (property[0] === "-") {
                sortOrder = -1;
                property = property.substr(1);
            }
            return function (a, b) {
                var result = (a[property] < b[property]) ? -1 : (a < [property] > b[property]) ? 1 : 0;
                return result * sortOrder;
            }
        },
        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);
///#source 1 1 Widgets/Shared/dynamicDropDown-2.js
var Widgets = Widgets || {};

(function ($) {
    var context;
    var pageEnd = 0;
    var descGuide;
    var titleGuide;
    var PickedFilter;
    Widgets.dynamicDropDown2 = {
        name: 'Dynamic Drop Down 2',
        log: true,
        configuration: {
            selectProperties: [
           "BAHFunctionalDescriptionOWSHTML",
           "BAHSortOrder",
           "BAHFunctionalFilter",
           "BAHWidget",
           "ContentType",
            ],
            query: '',
            contentTypes: ['Functional List'],
        },
        configuration: '',
        vm: { dropdown: [], items: [], selectedItems: [], selectedItem: "", description: '', descriptions: [] },
        load: function (options) {
            var context = this;
            var header = Widgets.genericHeader;
            context.configuration = $(context.container).attr('data-configuration');
            $.when(header.promise, header.termPromise).done(function () {
                for (i = 0; i < header.data.results.length; i++) {
                    if (header.data.results[i].BAHWidget.indexOf(context.configuration) > -1 && header.data.results[i].ContentType.indexOf("Functional List") > -1) {
                        var filters = header.data.results[i].BAHFunctionalFilter.split("Filters:" + context.configuration + ":")
                        var tempFilter = "";
                        for (j = 0; j < filters.length; j++) {
                            tempFilter += filters[j] !== "" ? filters[j].trim() + ";" : "";
                            filters[j] !== "" ? context.vm.dropdown.push(filters[j].trim()) : null;
                        }
                        header.data.results[i].BAHFunctionalFilter = tempFilter;
                        if (header.data.results[i].BAHFunctionalDescriptionOWSHTML !== null || header.data.results[i].BAHFunctionalDescriptionOWSHTML !== undefined) {
                            header.data.results[i].BAHFunctionalDescriptionOWSHTML = context.replaceBadHTML(header.data.results[i].BAHFunctionalDescriptionOWSHTML.trim(), "<p>", "");
                            header.data.results[i].BAHFunctionalDescriptionOWSHTML = context.replaceBadHTML(header.data.results[i].BAHFunctionalDescriptionOWSHTML.trim(), "</p>", "");
                            header.data.results[i].BAHFunctionalDescriptionOWSHTML = context.replaceBadHTML(header.data.results[i].BAHFunctionalDescriptionOWSHTML.trim(), "<br>", "");
                            header.data.results[i].BAHFunctionalDescriptionOWSHTML = context.replaceBadHTML(header.data.results[i].BAHFunctionalDescriptionOWSHTML.trim(), "<br />", "");
                            header.data.results[i].BAHFunctionalDescriptionOWSHTML = header.data.results[i].BAHFunctionalDescriptionOWSHTML.replace(/[\u200B]/g, '');
                        }
                        
                        context.vm.items.push(header.data.results[i]);
                    }
                }
                context.vm.dropdown = context.removeDuplicates(context.vm.dropdown);
                context.getFilters(header.data.termStore);
                context.renderHTML();
            })
        },
        getFilters: function (terms) { //get the term store filters (categories) for this configuration of the widget
            var context = this;
            configuration = context.configuration;
            var filterOptions = [];
            for (var h = 0; h < context.vm.dropdown.length; h++) {
                for (var i = 0; i < terms.get_count() ; i++) {
                    var spTerm = terms.getItemAtIndex(i);
                    if (!spTerm.get_isRoot() && spTerm.get_parent().get_name() == configuration) {
                        filterTitle = spTerm.get_name();
                        if (filterTitle === context.vm.dropdown[h]) {
                            var customProperties = spTerm.get_customProperties();
                            filterDesc = customProperties["description"];
                            context.vm.descriptions.push(filterDesc);
                        }
                    }
                }
            }
            return filterOptions;
        },
        replaceBadHTML: function replaceAll(str, find, replace) {
            return str.replace(new RegExp(find, 'g'), replace);
        },
        renderHTML: function () {
            var context = this;
            var template = Handlebars.compile($('#dynamicDropDown2Template').html());
            var html = template(context.vm);
            $(context.container).html(html);

            var targetElement = "#dynamicDropDown-OwlSliderItems";
            var $owl = $(targetElement);
            $owl.owlCarousel(owlSliderConfig.getDropDown2(1));
            // move the controls so we can style them the way we want
            $("#dynamicDropDown-OwlSliderItems").parents('article')
            .css('width', (parseInt($(($("#dynamicDropDown-OwlSliderItems")))
                .parents(".accordion-navigation").css("width")) + "px"));

            var ctrls = $owl.find('.owl-controls').detach();
            ctrls.prependTo($owl.closest('article').parent());
        },
        removeDuplicates: function (arr) {
            var i, len = arr.length, out = [], obj = {};

            for (i = 0; i < len; i++) {
                obj[arr[i]] = 0;
            }
            for (i in obj) {
                out.push(i);
            }
            return out;
        },
        select: function () {
            var context = this;
            context.vm.selectedItem = $('#dynamicDropdown2Select').val();
            context.vm.description = context.vm.descriptions[$('#dynamicDropdown2Select').children(":selected").attr("id")];
            while (context.vm.selectedItems.length > 0) {
                context.vm.selectedItems.pop();
            }
            for (i = 0; i < context.vm.items.length; i++) {
                if (context.vm.items[i].BAHFunctionalFilter.indexOf(context.vm.selectedItem) > -1) {
                    context.vm.selectedItems.push(context.vm.items[i]);
                }
            }
            context.renderHTML();
        },
        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);
///#source 1 1 Widgets/Shared/leadershipteam.js
var Widgets = Widgets || {};
(function ($) {
    Widgets.leadershipteam = {
        name: 'Leadership Team Slider',
        configuration: {
            selectProperties: [
            "BAHStream",
            "BAHLeader",
            "BAHLeaderOWSUSER",
            "BAHRolePrimary",
            "JobTitle",
            "BAHResourceImageOWSIMGE",
            "BAHSortOrder",
            "BAHWidget",
            "Title",
            "BAHLocation",
            "LeaderSortOrder"
            ],
            query: '',
            contentTypes: ['Our Leadership Team Page'],
        },
        log: true,
        data: { widgetTitle: "", totalCount: 0, minTiles: 0, maxTiles: 0, items: [], uid: ""},
        configure: function(context) {
            var config = {};
            config.widgetTitle = $(this.container).data("title");
            config.minTiles = $(context.container).data("mintiles");
            config.maxTiles = $(context.container).data("maxtiles");
            config.template = "#" + $(context.container).data("template");
            // NOTE: uid used to apply owl slider UI - leverage a section designation or TODO: parent level designation that is unique
            config.uid = "Section" + $(context.container).data("section") + "-" +  config.widgetTitle.split(" ").join("");
            return config;
        },
        load: function(options) {
            var context = this;
            var content = Widgets.genericHeader;
            var config = this.configure(context);
            this.getData(context, content, config).done(function(data) {
                context.updateData(context, data, config);
            });
        },
        getData : function (context, content, config) {
            var deferred = new $.Deferred();
            var data = [];
            $.when(content.promise).done(function () {
                var dataResults = content.data.results;
                var dataContext = $.grep(dataResults, function(c, i) {
                  return (c.ContentType).match(/Our Leadership Team Page/g);
                });
                // start populating data
                data = Widgets.leadershipteam.data;
                data.widgetTitle = config.widgetTitle;
                data.minTiles = config.minTiles;
                data.maxTiles = config.maxTiles;

                $.each(dataContext, function (index, item) {
                    // get searchable email param from userInfo
                    data.items[index] = {};

                    // In Bahtest since we use onmircosoft accounts you can use the first email (friendly) but it does not work in production.
                    // For this reason use the second email address which is the one that is usable in both production and bahtest.
                    
                    // NOTE: should work for both production and staging (employee ID email)
                    data.items[index].email = BahUtilities.remapStringToDataArray(item.BAHLeaderOWSUSER, ["bahtestEmail","name","id","membership","email"], "|")[4]["email"];
                    
                    // NOTE: works for staging only (friendly email)
                    // data.items[index].email = BahUtilities.remapStringToDataArray(item.BAHLeaderOWSUSER, ["bahtestEmail","name","id","membership","email"], "|")[0]["bahtestEmail"];
                    
                    // name // BAHLeader
                    data.items[index].name = item.BAHLeader;
                    // imageUrl // BAHResourceImageOWSIMGE
                    // default to upload image, replace with account info if not available
                    if (item.BAHResourceImageOWSIMGE) {
                        data.items[index].imageUrl = $(item.BAHResourceImageOWSIMGE).attr("src");
                    }
                   (data.items[index].email && data.items[index].email != " ") ? 
                                            data.items[index].profileUrl = "/Pages/View-Profile.aspx?user=i%3A0%23.f%7Cmembership%7C" + data.items[index].email 
                                            : data.items[index].profileUrl = "#";
                    
                    // title // can be replaced with BahPrimaryRole or JobTitle from user AccountInfo
                    // NOTE: if using a consultant (non-bah employee) profile, 
                    // make sure to enter the "Title" of the consultant in the item entry list for accurate title display
                    // if no title set after querying for account profile in updateData method
                    data.items[index].title = (item.Title !=="DispForm.aspx") ? item.Title : ""; 
                    data.totalCount++;
                });
                deferred.resolve(data);
            });
            return deferred.promise();
        },
        updateData : function (context, data, config) {
            var updated = 0;
            // writes secondary info from the email address
            // account related info only now
            $.each(data.items, function (i, item) {
                // async call each ensures update item matches intended user
                BahUtilities.getUserAccountProfile(item.email).then( function (results) {
                    // this widget is only able to access column values from the initial form
                    var resultsData = BahUtilities.getFirstSharePointSearchResults(results);

                    if (resultsData) { // if a profile exists
                        $.each(resultsData, function (index, item) { 

                            // name // FirstName + LastName
                            if (item.Key === "FirstName") {
                                data.items[i].name = item.Value;
                            }
                            if (item.Key === "LastName") {
                               data.items[i].name += " " + item.Value;
                            }
                            // 11.12.2015 kandil.dalya [833277] update to image url code now that uploaded image is not required
                            if (item.Key === "BAHResourceImageOWSIMGE") {
                                if (!data.items[i].imageUrl) {
                                    if (item.Value) {
                                        var src = $(item.Value).attr('src');
                                        data.items[i].imageUrl = src;
                                    } else {
                                        var email = BahUtilities.getSearchableEmailFormat(data.items[i].email, "@", "%40"); // encoded for url
                                        var userPhotoPath = "_layouts/15/userphoto.aspx?size=L&accountname=i%3A0%23.f%7Cmembership%7C";
                                        data.items[i].imageUrl = "/" + userPhotoPath + email;
                                    }
                                }
                            }
                            if (item.Key === "AccountName") {
                                data.items[i].profileUrl = "/Pages/View-Profile.aspx?user=" + encodeURIComponent(item.Value);
                            }
                            // title // BAHRolePrimary
                            if (item.Key === "BAHRolePrimary" && item.Value) {
                                data.items[i].title = item.Value;
                            } else if (item.Key === "JobTitle" && item.Value) {
                                data.items[i].title = item.Value;
                            }
                        });
                    } else { 
                        // if no account leave current data and disable
                        data.items[i].classes = "disabled";
                    }
                    updated++;
                    // all items have been updated so render
                    if(parseInt(updated) == parseInt(data.items.length)) {
                        context.renderTemplate(context, data, config);
                    }
                });
            });      
        },
        renderTemplate: function (context, data, config) {
            data.uid = config.uid; // for unique scoping of the owl widget
            var template = Handlebars.compile($(config.template).html());
            var html = template(data);
            $(context.container).html(html);
            // NOTE: webpart containers are breaking parent and rendering 100% 
            // which is misleading the owl widget render
            // bind parent container to accordion width for accurate rendering
            // NOTE: this is not a responsive solution and will not hold up on resize
             var targetElement = "#" + config.uid + "-OwlSliderItems";
            // verify the parent is a right column to update the tile display count accordingly
            var colDisplay = $(targetElement).parents(".right").hasClass("right");
            var contentWrapper = (colDisplay) ? ".right" : ".main";
            $(targetElement).parents('article').css('width', $(targetElement).parents(contentWrapper).css("width"));
            this.updateDisplay(context, data, config, targetElement, colDisplay);
        },
        updateDisplay: function (context, data, config, targetElement, colDisplay) {
            // var targetElement = "#" + config.uid + "-OwlSliderItems";
            var $owl = $(targetElement);
            $owl.owlCarousel(owlSliderConfig.getFunctionalLayoutConfig(config.minTiles, config.maxTiles, colDisplay));
            // move the controls so we can style them the way we want
            var ctrls = $owl.find('.owl-controls').detach(); // .addClass('show-for-medium-up')
            ctrls.appendTo($owl.closest('article').parent()); 
        },
        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);
///#source 1 1 Widgets/Shared/leadershipteamStream.js
var Widgets = Widgets || {};
(function ($) {
    Widgets.leadershipteamStream = {
        name: 'Leadership Team Stream Slider',
        configuration: {
            selectProperties: [
            "BAHStream",
            "BAHLeader",
            "BAHLeaderOWSUSER",
            "BAHResourceImageOWSIMGE",
            "BAHSortOrder",
            "BAHWidget",
            "Title",
            "BAHLocation",
            "LeaderSortOrder"
            ],
            query: '',
            contentTypes: ['Our Leadership Team'],
        },
        log: true,
        data: { widgetTitle: "", totalCount: 0, minTiles: 0, maxTiles: 0, items: [], uid: ""},
        configure: function(context) {
            var config = {};
            config.widgetTitle = $(this.container).data("title");
            // NOTE: 10-28-2015 dalya.kandil -  owl config should already be using the correct display config as specified using media queries
            // not sure this is needed
            /* 10-22-2015 ryan.williams [832868] BUG: Even when maxTiles = 4 & minTiles = 2, it only shows 2 tiles on the left column */
            // if ((Bah.isMobile.any() || $(window).width() < 460 ) && $(context.container).data("mintiles") >= 4) {
            //     config.minTiles = 2;
            // } else {
            config.minTiles = $(context.container).data("mintiles");
            // }
            config.maxTiles = $(context.container).data("maxtiles");
            config.template = "#" + $(context.container).data("template");
            // NOTE: uid used to apply owl slider UI - leverage a section designation or TODO: parent level designation that is unique
            config.uid = "Section" + $(context.container).data("section") + "-" +  config.widgetTitle.split(" ").join("");
            return config;
        },
        load: function(options) {
            var context = this;
            var content = Widgets.genericHeader;
            var config = this.configure(context);
            var streamname = content.data.configuration;
            this.getData(context, content, config).done(function(data) {
                context.updateData(context, data, config);
            });
        },
        getData : function (context, content, config) {
            var deferred = new $.Deferred();
            var data = [];
            $.when(content.promise).done(function () {
                var dataResults = content.data.results;
                var dataContext = $.grep(dataResults, function(c, i) {
                  return (c.ContentType).match(/Our Leadership Team/g);
                });
                // start populating data
                data = Widgets.leadershipteam.data;
                data.widgetTitle = config.widgetTitle;
                data.minTiles = config.minTiles;
                data.maxTiles = config.maxTiles;

                $.each(dataContext, function (index, item) {
                    // get searchable email param from userInfo
                    data.items[index] = {};

                    // In Bahtest since we use onmircosoft accounts you can use the first email (friendly) but it does not work in production.
                    // For this reason use the second email address which is the one that is usable in both production and bahtest.
                    data.items[index].email = BahUtilities.remapStringToDataArray(item.BAHLeaderOWSUSER, ["bahtestEmail","name","id","membership","email"], "|")[4]["email"];

                    // name // BAHLeader
                    data.items[index].name = item.BAHLeader;
                    // imageUrl // BAHResourceImageOWSIMGE
                    // default to upload image, replace with account info if not available
                    if (item.BAHResourceImageOWSIMGE) {
                        data.items[index].imageUrl = $(item.BAHResourceImageOWSIMGE).attr("src");
                    }
                   (data.items[index].email && data.items[index].email != " ") ? 
                                            data.items[index].profileUrl = "/Pages/View-Profile.aspx?user=i%3A0%23.f%7Cmembership%7C" + data.items[index].email 
                                            : data.items[index].profileUrl = "#";
                    
                    // title // can be replaced with BahPrimaryRole or JobTitle from user AccountInfo
                    // NOTE: if using a consultant (non-bah employee) profile, 
                    // make sure to enter the "Title" of the consultant in the item entry list for accurate title display
                    data.items[index].title = item.Title;
                    data.totalCount++;
                });
                deferred.resolve(data);
            });
            return deferred.promise();
        },
        updateData : function (context, data, config) {
            var updated = 0;
            // writes secondary info from the email address
            // account related info only now
            $.each(data.items, function (i, item) {
                // async call each ensures update item matches intended user
                BahUtilities.getUserAccountProfile(item.email).then( function (results) {
                    var resultsData = BahUtilities.getFirstSharePointSearchResults(results);
                    if (resultsData) { // if a profile exists
                        $.each(resultsData, function (index, item) { 
                            // name // FirstName + LastName
                            if (item.Key === "FirstName") {
                                data.items[i].name = item.Value;
                            }
                            if (item.Key === "LastName") {
                               data.items[i].name += " " + item.Value;
                            }
                            // image // BAHResourceImageOWSIMGE
                            if (item.Key === "BAHResourceImageOWSIMGE" && item.value) {
                                var src = $(leader.leaderImage).attr('src');
                                data.items[i].imageUrl = src;
                            } else {
                                var email = BahUtilities.getSearchableEmailFormat(data.items[i].email, "@", "%40");
                                var userPhotoPath = "_layouts/15/userphoto.aspx?size=L&accountname=i%3A0%23.f%7Cmembership%7C";
                                data.items[i].imageUrl = "/" + userPhotoPath + email;

                            }
                            if (item.Key === "AccountName") {
                                data.items[i].profileUrl = "/Pages/View-Profile.aspx?user=" + encodeURIComponent(item.Value);
                            }

                            // title // BAHRolePrimary
                            if (item.Key === "BAHRolePrimary" && item.Value) {
                                data.items[i].title = item.Value;
                            } else if (item.Key === "JobTitle" && item.Value) {
                                data.items[i].title = item.Value;
                            }
                        });
                    } else { 
                        // if no account leave current data and disable
                        data.items[i].classes = "disabled";
                    }
                    updated++;
                    // all items have been updated so render
                    if(parseInt(updated) == parseInt(data.items.length)) {
                        context.renderTemplate(context, data, config);
                    }
                });
            });      
        },
        renderTemplate: function (context, data, config) {
            data.uid = config.uid; // for unique scoping of the owl widget
            var template = Handlebars.compile($(config.template).html());
            var html = template(data);
            $(context.container).html(html);
            // NOTE: webpart containers are breaking parent and rendering 100% 
            // which is misleading the owl widget render
            // bind parent container to accordion width for accurate rendering
            // NOTE: this is not a responsive solution and will not hold up on resize
             var targetElement = "#" + config.uid + "-OwlSliderItems";
            // verify the parent is a right column to update the tile display count accordingly
            var colDisplay = $(targetElement).parents(".right").hasClass("right");
            var contentWrapper = (colDisplay) ? ".right" : ".main";
            $(targetElement).parents('article')
            .css('width', $(targetElement).parents(contentWrapper).css("width"));
            this.updateDisplay(context, data, config, targetElement, colDisplay);
        },
        updateDisplay: function (context, data, config, targetElement, colDisplay) {
            // var targetElement = "#" + config.uid + "-OwlSliderItems";
            var $owl = $(targetElement);
            $owl.owlCarousel(owlSliderConfig.getFunctionalLayoutConfig(config.minTiles, config.maxTiles, colDisplay));
            // move the controls so we can style them the way we want
            var ctrls = $owl.find('.owl-controls').addClass('show-for-large-up').detach();
            ctrls.appendTo($owl.closest('article').parent()); 
        },
        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);
///#source 1 1 Widgets/Shared/leadershipMessage.js
var Widgets = Widgets || {};

(function ($) {
    Widgets.leadershipMessage = {
        name: 'Leadership Message',
        log: true,
        configuration: {
            selectProperties: [
            "BAHStream",
            "BAHFunctionalFilter",
            "BAHWidget",
            "ContentType",
            "BodyOWSMTXT",
            "LastModifiedTime"
            ],
            query: '',
            contentTypes: ['Leadership Messages'],
        },
        load: function (options) {
            var html;
            var template = Handlebars.compile($('#leadershipMessageTemplate').html());
            var content = Widgets.genericHeader;
            var maxChars = 500;
            var viewModel = {
                viewmore: '',
                message: '',
                fullMessage: ''
            };
            var LastModified = null;

            $.when(content.promise).done(function () {
                $.each(content.data.results, function (key, val) {
                    var body = "";
                    var bodyLimit = "";
                    if (val["ContentType"].indexOf("Leadership Messages") > -1) {
                        //get the latest message based on LastModifiedTime
                        if (LastModified == null || val["LastModifiedTime"] > LastModified) {
                            body = val["BodyOWSMTXT"];
                            if (body.length > maxChars) {
                                bodyLimit = Bah.setEllipsis(body, maxChars);
                                viewModel.viewmore = "view more";
                            }
                            viewModel.message = bodyLimit;
                            viewModel.fullMessage = body;
                            LastModified = val["LastModifiedTime"];
                        }
                    }

                    html = template(viewModel);
                    $(Widgets.leadershipMessage.container).html(html);

                    
                });
            });

        },

        removeHTMLTags: function (htmlString) {
            if (htmlString) {
                var mydiv = document.createElement("div");
                mydiv.innerHTML = htmlString;
                if (document.all) // IE Stuff
                {
                    return mydiv.innerText;
                }
                else // Mozilla does not work with innerText
                {
                    return mydiv.textContent;
                }

            }
        },

        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);
///#source 1 1 Widgets/Shared/resources.js
var Widgets = Widgets || {};
(function ($) {

    Widgets.resources = {         
        log: true,
        configuration: {
            selectProperties: [
            "BAHFunctionalDescriptionOWSHTML",
            "BAHLongURLTitleOWSTEXT",
            "BAHResourceUrl",
            "BAHIconUrlOWSURLH",
            "BAHIconUrl",
            "BAHSortOrder",
            "BAHFunctionalFilter",
            "BAHWidget",
            "BAHFunctionalPageTitle",
            "BAHHeroPublishingImageOWSIMGE",
            "BAHHeroVideoEmbedOWSMTXT",
            "BAHDocumentType",
            "FileType",
            "FileExtension",
            "Url",
            "Title",
            "ContentType",
            "BAHStream"
            ],
            query: '',
            contentTypes: ['Functional List', 'Functional Document', 'Platform List', 'Platform Document'],
        },
        configure: function(container) {
            var config = {};
            config.configuration = $(container).data("configuration");
            // NOTE: case there is no functional filter eg, org pages, we assign empty string to container 
            // this allows reg ex with an empty functional filter
            config.container = $(container).data("container") || ""; 
            config.maxTiles = $(container).data('maxtiles');
            config.minTiles = $(container).data('mintiles');
            config.widgetTitle = $(container).data('title');
            config.uid = "Section" + $(container).data("section") + "-Resources" +  config.container.split(" ").join("");
            // gives users the option to sub out a new template if they dont want the default one
            config.template = (!$(container).data("template")) ? '#resourcesTemplate' : '#' + $(container).data("template");
            return config;
        },
        load: function (options) {
            var context = this;
            var content = Widgets.genericHeader;
            var container = context.container;
            // NOTE: scoping data context (functional filter) to container display (data-container attribute)
            // check if container is empty assign Resources as a generic data scope 
            // this is for single instance use of this widget on a page
            // if multiple uses then we allow this based on the container name matching the functional filter designation
            var temp = ($(container).data('container') === "") ? "Resources" : $(container).data('container').split(" ").join("");
            context.data = {};
            context.data[temp] = {};
            var data = context.data[temp]; //temp is our container context
            data.context = temp;
            data.categoryResults = null;
            var config = context.configure(container);
             this.getData(context, content, config).done(function(data) {
                context.updateData(context, data, config);
            });
        },
        getData: function (context, content, config) {
            var deferred = new $.Deferred();
            var data = { widgetTitle: "", totalCount: 0, minTiles: 0, maxTiles: 0, items: [], uid: ""};
            $.when(content.promise).done(function () {

                // get filters under BAHWidget parent termstore Filters
                var filters = context.getFilters(content.data.termStore, config.configuration);
                var usedFilters = [];

                // actual data results
                var dataResults = content.data.results;
                var dataContext = $.grep(dataResults, function(c, i) {
                    var regEx = new RegExp(config.container, 'g');
                    // HINT: match if there is no functional filter assigned to data by adding data-container="Resources" to your widget tag
                    // if functional filter column is empty we will assign it to "Resources" here to match to container designation
                    var filter = (c.BAHFunctionalFilter) ? c.BAHFunctionalFilter : "Resources";
                    // HINT: add your widget name here if needed, see example for FC page below
                    // return ( ((c.BAHWidget).match(/Resources/g) || (c.BAHWidget).match(/FcSiteWidgetName/g))  && (filter).match(regEx) );
                    // Your other option is to tag your data widget column with "Resources" and leave the code as is
                    return ( (c.BAHWidget).match(/Resources/g)  && (filter).match(regEx) );
                });
                 $.each(dataContext, function (index, item) {
                    data.items[index] = item;
                    data.totalCount++;
                });
                deferred.resolve(data);
            });
            return deferred.promise();
        },
        getFilters: function (terms, configuration) { //get the term store filters (categories) for this configuration of the widget
            var filterOptions = [];
            if (terms.length != 0) {

                for (var i = 0; i < terms.get_count() ; i++) {
                    var filterTitle = '';
                    var filterDesc = '';
                    var isDefault = false;
                    var spTerm = terms.getItemAtIndex(i);
                    if (!spTerm.get_isRoot() && spTerm.get_parent().get_name() == configuration) {

                        filterTitle = spTerm.get_name();

                        var customProperties = spTerm.get_customProperties();
                        filterDesc = customProperties["description"];
                        var defaultProp = (customProperties['default'] || '').toString();
                        if (defaultProp.toLowerCase() == 'yes') {
                            isDefault = true;
                        }
                        var filterOption = {
                            filterTitle: filterTitle,
                            filterDesc: filterDesc,
                            isDefault: isDefault
                        };
                        filterOptions.push(filterOption);
                    }
                }
            }
            return filterOptions;
        }, 
        updateData : function (context, data, config) {
            // assign to data template context
            data.widgetTitle = config.widgetTitle;
            data.minTiles = config.minTiles;
            data.maxTiles = config.maxTiles;
            (data.items).sort(function (a, b){
                return a.BAHSortOrder - b.BAHSortOrder;
            });
            var sortedItems = data.items;
            data.items = [];
            // parse from here to generic tokens for title, href, icon, template based on content type
            $.each(sortedItems, function (index, item) {
                data.items[index] = {};
                data.items[index].Title = item.Title;
                data.items[index].ContentType = item.ContentType;
                //assign appropriate icon based on type and filter (downloadable)
                if ((item.ContentType).match(/Functional List/g) || (item.ContentType).match(/Platform List/g)) {
                        data.items[index].Url = item.BAHResourceUrl;
                        data.items[index].Icon = "fa-external-link-square";
                } else if ((item.ContentType).match(/Functional Document/g) || (item.ContentType).match(/Platform Document/g)) {
                        data.items[index].Url = item.Url;
                        data.items[index].Downloadable = true;
                        if ((!item.BAHIconUrlOWSURLH) || (item.BAHIconUrlOWSURLH ==="")) {
                            // check for doc type
                            switch (item.FileType) {
                                case "pdf": data.items[index].Icon = "fa-file-pdf-o";
                                break;
                                case "doc": data.items[index].Icon = "fa-file-word-o";
                                break;
                                case "docx": data.items[index].Icon = "fa-file-word-o";
                                break;
                                case "txt": data.items[index].Icon = "fa-file-text";
                                break;
                                case "ppt": data.items[index].Icon = "fa-file-powerpoint-o";
                                break;
                                case "pptx": data.items[index].Icon = "fa-file-powerpoint-o";
                                break;
                                default: data.items[index].Icon = "fa-file";
                            }
                        } else {
                            data.items[index].IconUrl = item.BAHIconUrlOWSURLH.split(",")[0];
                        }
                }
            });
            context.renderTemplate(context, data, config);
        },
        renderTemplate: function (context, data, config) {
            data.uid = config.uid; // for unique scoping of the owl widget ui
            var template = Handlebars.compile($(config.template).html());
            var html = template(data);
            var container;
            container = '[data-container="' + config.container + '"]';
            $(container).html(html);
            // NOTE: webpart containers are breaking parent and rendering 100% 
            // which is misleading the owl widget render
            // bind parent container to accordion width for accurate rendering
            // NOTE: this is not a responsive solution and will not hold up on resize
            var targetElement = "#" + config.uid + "-OwlSliderItems";
            // verify the parent is a right column to update the tile display count accordingly
            var colDisplay = $(targetElement).parents(".right").hasClass("right");
            var contentWrapper = (colDisplay) ? ".right" : ".main";
            $(targetElement).parents('article').css('width', $(targetElement).parents(contentWrapper).css("width"));
            this.updateDisplay(context, data, config, targetElement, colDisplay);
        },
        updateDisplay: function (context, data, config, targetElement, colDisplay) {
            var $owl = $(targetElement);
            $owl.owlCarousel(owlSliderConfig.getFunctionalLayoutConfig(config.minTiles, config.maxTiles, colDisplay));
            // move the controls so we can style them the way we want
            var ctrls = $owl.find('.owl-controls').detach(); // addClass('show-for-medium-up')
            ctrls.appendTo($owl.closest('article').parent()); 
        },
        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };

})(jQuery);



///#source 1 1 Widgets/Shared/eventsPage.js
var Widgets = Widgets || {};
(function ($) {
    Widgets.eventsPage = {
        name: 'Events Page',
        log: true,
        configuration: {
            selectProperties: [
            "BAHStream",
            "listitemid",
            "Description",
            "AllDayEvent",
            "BAHStartDate",
            "BAHEndDate",
            "Url",
            "Title"
            ],
            query: '(contenttype:"Firmwide Events Page" AND BAHFunctionalPageTitle="BAHFUNCTIONALPAGETITLE" AND bahstartdate>=today AND bahstartdate<TODAYPLUS6MONTHS)',
            contentTypes: [],
        },
        load: function (options) {

            var context = this;
            var eventsArray = { data: [], widgetTitle: '', loadMoreURL: '', itemsToDisplay: false };
            var template = Handlebars.compile($('#eventsTemplate').html());
            var header = Widgets.genericHeader;
            $.when(header.promise).done(function () {
                var eventCount = 0;
                eventsArray.widgetTitle = 'Events';
                var searchEventsURL = '/Pages/Search-Events.aspx?k=BAHFunctionalPageTitle%3D%22';
                //get the page name????
                //var pageName = header.data.headerData.title;
                var pageName = $(context.container).attr('data-configuration');
                eventsArray.loadMoreURL = searchEventsURL + encodeURIComponent(pageName) + '%22';
                $.each(header.data.results, function (index, value) {
                    if (value["ContentType"].indexOf("Firmwide Events Page") > -1 && eventCount < 3) {

                        var eventData = { title: '', url: '', startDate: '', enddate: '', eventID: '', description: '', allDayEvent: '' };
                        eventData.title = value.Title;
                        eventData.eventID = value.listitemid;
                        eventData.description = value.Description;
                        eventData.allDayEvent = value.AllDayEvent;
                        //Get Event URL
                        var eventBaseURL = '/Pages/Event-Details.aspx?eventId=';
                        //https://boozallen.sharepoint.com/Pages/Event-Details.aspx?eventId=322&sourceUrl=https://boozallen.sharepoint.com/sites/fc/&listTitle=Calendar                        
                        eventData.url = eventBaseURL + value.listitemid + '&sourceUrl=' + value.Url.split("/Lists/")[0] + '/&listTitle=' + (value.Url.split("/Lists/")[1]).split("/DispForm")[0];
                        //Get Event Date and times
                        var eventSPStartDate = new Date(value.BAHStartDate + " UTC");
                        eventData.eventStartMonth = $.format.date(eventSPStartDate, 'MMM');
                        eventData.eventStartDay = $.format.date(eventSPStartDate, 'dd');
                        eventData.eventStartTime = $.format.date(eventSPStartDate, 'h:mm a');

                        var eventSPEndDate = new Date(value.BAHEndDate + " UTC");
                        eventData.eventEndMonth = $.format.date(eventSPEndDate, 'MMM');
                        eventData.eventEndDay = $.format.date(eventSPEndDate, 'dd');
                        eventData.eventEndTime = $.format.date(eventSPEndDate, 'h:mm a');
                        eventsArray.data.push(eventData);
                        eventCount++;
                    };
                });

                if (eventsArray.data.length > 0) {
                    eventsArray.itemsToDisplay = true;
                }

                if (eventsArray) {
                    html = template(eventsArray);
                    $(context.container).html(html);
                }
            });

        },
        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);

///#source 1 1 Widgets/Shared/eventsStream.js
var Widgets = Widgets || {};
(function ($) {
    Widgets.eventsStream = {
        name: 'Events Stream',
        log: true,
        configuration: {
            selectProperties: [
            "BAHStream",
            "listitemid",
            "Description",
            "AllDayEvent",
            "BAHStartDate",
            "BAHEndDate",
            "Url",
            "Title"
            ],
            query: '(contenttype:"Firmwide Events" AND BAHStreamdisplay="BAHSTREAM" AND bahstartdate>=today AND bahstartdate<TODAYPLUS6MONTHS)',
            contentTypes: [],
        },
        load: function (options) {

            var context = this;
            var eventsArray = { data: [], widgetTitle: '', loadMoreURL: '', itemsToDisplay: false };
            var template = Handlebars.compile($('#eventsTemplate').html());
            var header = Widgets.genericHeader;
            $.when(header.promise).done(function () {
                var eventCount = 0;
                eventsArray.widgetTitle = 'Events';
                var searchEventsURL = '/Pages/Search-Events.aspx?k=bahstreamdisplay%3D%22';

                //get the Stream name????
                var streamName = header.data.configuration;
                eventsArray.loadMoreURL = searchEventsURL + encodeURIComponent(streamName) + '%22';
                $.each(header.data.results, function (index, value) {
                    if (value["ContentType"].indexOf("Firmwide Events") > -1 && eventCount < 3) {

                        var eventData = { title: '', url: '', startDate: '', enddate: '', eventID: '', description: '', allDayEvent: '' };
                        eventData.title = value.Title;
                        eventData.eventID = value.listitemid;
                        eventData.description = value.Description;
                        eventData.allDayEvent = value.AllDayEvent;
                        //Get Event URL
                        var eventBaseURL = '/Pages/Event-Details.aspx?eventId=';
                        //https://boozallen.sharepoint.com/Pages/Event-Details.aspx?eventId=322&sourceUrl=https://boozallen.sharepoint.com/sites/fc/&listTitle=Calendar                        
                        eventData.url = eventBaseURL + value.listitemid + '&sourceUrl=' + value.Url.split("/Lists/")[0] + '/&listTitle=' + (value.Url.split("/Lists/")[1]).split("/DispForm")[0];
                        //Get Event Date and times
                        var eventSPStartDate = new Date(value.BAHStartDate + " UTC");
                        eventData.eventStartMonth = $.format.date(eventSPStartDate, 'MMM');
                        eventData.eventStartDay = $.format.date(eventSPStartDate, 'dd');
                        eventData.eventStartTime = $.format.date(eventSPStartDate, 'h:mm a');

                        var eventSPEndDate = new Date(value.BAHEndDate + " UTC");
                        eventData.eventEndMonth = $.format.date(eventSPEndDate, 'MMM');
                        eventData.eventEndDay = $.format.date(eventSPEndDate, 'dd');
                        eventData.eventEndTime = $.format.date(eventSPEndDate, 'h:mm a');
                        eventsArray.data.push(eventData);
                        eventCount++;
                    };
                });

                if (eventsArray.data.length > 0) {
                    eventsArray.itemsToDisplay = true;
                }

                if (eventsArray) {
                    html = template(eventsArray);
                    $(context.container).html(html);
                }
            });

        },
        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);

///#source 1 1 Widgets/Shared/faqs.js
var Widgets = Widgets || {};
(function ($)
{
    Widgets.faqs = {
        name: 'FAQs',
        log: true,
        configuration: {
            selectProperties: [
            "BAHFunctionalDescriptionOWSHTML",
            "BAHLongURLTitleOWSTEXT",
            "BAHResourceUrl",
            "BAHIconUrlOWSURLH",
            "BAHSortOrder",
            "BAHFunctionalFilter",
            "BAHWidget",
            "BAHFunctionalPageTitle",
            "BAHHeroPublishingImageOWSIMGE",
            "BAHHeroVideoEmbedOWSMTXT",
            "Url",
            "Title",
            "ContentType",
            "BAHSubTitleOWSTEXT",
            "BAHHeroDescriptionOWSHTML",
            "BAHHeroImageOWSHTML",
            "BAHHeroBylineOWSTEXT",
            "BAHSectionDescription5OWSHTML",
            "BAHSectionDescription6OWSHTML",
            "BAHSectionDescription7OWSHTML",
            "BAHSectionDescription8OWSHTML",
            "BAHSectionDescription9OWSHTML",
            "BAHSectionDescription10OWSHTML",
            "BAHSectionTitle1",
            "BAHSectionTitle2",
            "BAHSectionTitle3",
            "BAHSectionTitle4",
            "BAHSectionTitle5",
            "BAHSectionTitle6",
            "BAHSectionTitle7",
            "BAHSectionTitle8",
            "BAHSectionTitle9",
            "BAHSectionTitle10"
            ],
            query: '',
            contentTypes: ['Functional List'],
        },
        load: function (options)
        {
            var context = this;
            var displayCount = 5;
            var faqContent = {};
            var faqArray = { data: [], FaqTitle: '', FaqLink: '', FaqCount: '' };
            var faqCount = 0;

            var ID = $(context.container).attr('data-section');
            var sectionDesc = "BAHSectionDescription" + ID + "OWSHTML";
            var sectionTitle = "BAHSectionTitle" + ID;

            var template = Handlebars.compile($('#faqsTemplate').html());
            var header = Widgets.genericHeader;
            $.when(header.promise, header.termPromise).done(function ()
            {
                var title = header.data.page[0] ? header.data.page[0][sectionTitle] : '';
                var download = header.data.customProperties.header['faqdownload'];

                faqArray.FaqTitle = title != null && title != undefined ? title : '';
                faqArray.FaqLink = download != null && download != undefined ? download : '';

                $.each(header.data.results, function (index, value)
                {
                    var contentFaq = {};
                    if (value.BAHWidget.indexOf("FAQs") > -1)
                    {
                        //if (++faqCount > 3) return; // exit function when maximum elements reached

                        var characterLimit = 255; // the maximum number of characters allowed for the trimmed faqTitle
                        var faqTitle = value.Title;
                        var faqTitleTrimmed = Bah.setEllipsis(faqTitle, characterLimit);
                        var faqDesc = value.BAHFunctionalDescriptionOWSHTML;

                        contentFaq.Id = ++faqCount;

                        if (faqCount <= displayCount)
                        {
                            contentFaq.Class = "accordion-navigation faq-show"; // expands accordion
                        }
                        else contentFaq.Class = "accordion-navigation faq-hide"; // contracts accordion
                        contentFaq.Title = faqTitle;
                        contentFaq.TitleTrimmed = faqTitleTrimmed;
                        contentFaq.Desc = faqDesc != null && faqDesc != undefined ? faqDesc : '';
                        faqArray.data.push(contentFaq); // add items to object array
                    }
                });

                if (faqCount <= displayCount)
                {
                    faqArray.FaqCount = faqCount;
                }
                else
                {
                    faqArray.FaqCount = displayCount;
                }

                faqContent.faqArray = faqArray;
                html = template(faqContent);
                $(context.container).html(html);

                if (faqCount <= displayCount)
                {
                    $('#faqsLoadMore').css('display', 'none');
                }

                $(document).foundation(); // NECESSARY FOR ACCORDION
                //$('#arrow1').switchClass('fa-angle-down', 'fa-angle-up'); // Expands the first faq by default when page is loaded
            });
        },
        faqLoadMore: function ()
        {
            var displayCount = 5;
            var accordion = document.getElementById('faqAccordion');
            var faqs = accordion.getElementsByTagName('dd');
            var visibleCount = Number($('#faqList').attr('count')); // The current number of visible FAQs
            var faqLength = faqs.length; // The total number of FAQs
            var hiddenCount = faqLength - visibleCount; // the number of hidden FAQs
            var includeCount = hiddenCount < displayCount ? hiddenCount : displayCount;
            var addCount = visibleCount + includeCount;
            for (var i = visibleCount; i < addCount; i++)
            {
                $(faqs[i]).removeClass('faq-hide');
            }
            $('#faqList').attr('count', addCount);
            if (hiddenCount - includeCount == 0) $('#faqsLoadMore').css('display', 'none');
        },
        changeAccordionArrow: function (id)
        {
            var arrow = $('#arrow' + id);
            var title = $('#faqTitle' + id);
            var trimmed = $('#faqTitleTrimmed' + id);
            var desc = $('#faqDesc' + id);
            var href = $('#faqHrefTitle' + id);

            if (arrow.hasClass('fa-angle-down'))
            {
                // This item is being expanded
                href.css('background-color', 'white');
                arrow.switchClass('fa-angle-down', 'fa-angle-up');
                title.css('display', 'block');
                trimmed.css('display', 'none');
                desc.switchClass('faq-desc-hide', 'faq-desc-show');
            }
            else
            {
                // This item is being collapsed
                href.css('background-color', '');
                arrow.switchClass('fa-angle-up', 'fa-angle-down');
                title.css('display', 'none');
                trimmed.css('display', 'block');
                desc.switchClass('faq-desc-show', 'faq-desc-hide');
            }

            var arrowCount = document.getElementById('faqAccordion').getElementsByTagName('i').length;

            // Now collapse all items except for the one selected
            for (var i = 1; i < arrowCount + 1; i++)
            {
                if (i != id)
                {
                    $('#faqHrefTitle' + i).css('background-color', '');
                    $('#arrow' + i).switchClass('fa-angle-up', 'fa-angle-down');
                    $('#faqTitle' + i).css('display', 'none');
                    $('#faqTitleTrimmed' + i).css('display', 'block');
                    desc.switchClass('faq-desc-show', 'faq-desc-hide');
                }
            }
        },
        fail: function (error, event)
        {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);

///#source 1 1 Widgets/Shared/subscribe.js
var Widgets = Widgets || {};

(function ($) {
    Widgets.subscribe = {
        name: 'Sub Account Subscribe',
        log: true,
        configuration: {
            selectProperties: [
            "BAHFunctionalDescriptionOWSHTML",
            "BAHLongURLTitleOWSTEXT",
            "BAHResourceUrl",
            "BAHIconUrlOWSURLH",
            "BAHSortOrder",
            "BAHFunctionalFilter",
            "BAHWidget",
            "BAHFunctionalPageTitle",
            "BAHHeroPublishingImageOWSIMGE",
            "BAHHeroVideoEmbedOWSMTXT",
            "Url",
            "Title",
            "ContentType",
            "BAHSubTitleOWSTEXT",
            "BAHHeroDescriptionOWSHTML",
            "BAHHeroImageOWSHTML",
            "BAHHeroBylineOWSTEXT",
            "BAHSectionDescription5OWSHTML",
            "BAHSectionDescription6OWSHTML",
            "BAHSectionDescription7OWSHTML",
            "BAHSectionDescription8OWSHTML",
            "BAHSectionDescription9OWSHTML",
            "BAHSectionDescription10OWSHTML",
            "BAHSectionTitle1",
            "BAHSectionTitle2",
            "BAHSectionTitle3",
            "BAHSectionTitle4",
            "BAHSectionTitle5",
            "BAHSectionTitle6",
            "BAHSectionTitle7",
            "BAHSectionTitle8",
            "BAHSectionTitle9",
            "BAHSectionTitle10",
            "BAHStream"
            ],
            query: '',
            contentTypes: ['Functional List', 'Functional Document', 'Functional Page'],
        },
        load: function (options) {
            var self = this;
            var template = Handlebars.compile($('#subscribeTemplate').html());
            var data = "";
            var html = template(data);
            $(Widgets.subscribe.container).html(html);
            self.subscriptionCheck();

            $(".acctsub-button").on("click", function () {
                //get the users personal feed
                $.when(self.getMyFeed()).then(function (data) {
                    var personalFeed = data;


                    //ensure we have the current org
                    $.when(Widgets.genericHeader.promise).done(function () {
                        var subButton = $(".acctsub-button");
                        var orgValue = subButton.attr("data-orgid");
                        //var orgName = orgTermSet.get_name();
                        var updatedSelections = "";
                        var buttonText = subButton.text();
                        if (orgValue != "") {
                            if (buttonText == "Subscribe") {
                                //add the organization to the users feed
                                if (personalFeed != "") {
                                    updatedSelections = personalFeed + "|" + orgValue;
                                } else {
                                    updatedSelections = orgValue;
                                }
                                //update the users personal feed with the new feed
                                $.when(self.saveMyFeed(updatedSelections)).then(function () {
                                    subButton.text("Unsubscribe");
                                });
                            } else {
                                //remove the organization from the users feed
                                var selections = personalFeed.split("|");
                                var index = selections.indexOf(orgValue);
                                if (index != -1) {
                                    selections.splice(index, 1);

                                    //convert the updated array to pipe delimited string
                                    var newSelections = "";
                                    for (i = 0; i < selections.length; i++) {
                                        newSelections += selections[i] + "|"
                                    }

                                    //save the personal feed
                                    self.saveMyFeed(newSelections.substring(0, newSelections.length - 1)).then(function (data) {
                                        if (data == "success") {
                                            subButton.text("Subscribe");
                                        }
                                    });
                                }
                                //}
                            }
                        }
                    });
                });


            });

        },
        getUserData: function () {
            var deferred = $.Deferred();
            var clientContext = new SP.ClientContext.get_current();
            var peopleManager = new SP.UserProfiles.PeopleManager(clientContext);
            var userProfileProperties = peopleManager.getMyProperties()
            clientContext.load(userProfileProperties);
            clientContext.executeQueryAsync(
                    Function.createDelegate(this,
                        function () {
                            deferred.resolve(userProfileProperties);
                        }),
                    Function.createDelegate(this,
                        function (sender, args) { deferred.reject(sender, args); }));
            return deferred.promise();
        },
        getMyFeed: function () {
            var self = this;
            var deferred = $.Deferred();
            var userPersonalFeed;
            $.when(self.getUserData()).then(
                function (userProfileProperties) {
                    var clientContext = new SP.ClientContext.get_current();
                    var peopleManager = new SP.UserProfiles.PeopleManager(clientContext);
                    //Get the account name of the current user. It will be in the following format: "i:0#.f|membership|username@yoursite.onmicrosoft.com"
                    var currentUserAccountName = userProfileProperties.get_accountName();
                    //get the value from their user profile
                    userPersonalFeed = peopleManager.getUserProfilePropertyFor(currentUserAccountName, "BAHPersonalFeed");//Get a single value property
                    clientContext.executeQueryAsync(function () {
                        deferred.resolve(userPersonalFeed.get_value());
                    },
                    function (sender, args) {
                        var errMsg = "Error setting personal feed: " + args.get_message();
                        $("#displayError").text(errMsg);
                        console.log(errMsg);
                    });
                });

            return deferred.promise();
        },
        subscriptionCheck: function () {
            var self = this;
            var deferred = $.Deferred();
            
            $.when(Widgets.genericHeader.promise).then(function () {

                var orgName = Widgets.genericHeader.bahStream;                
                var subButton = $(".acctsub-button");
                subButton.attr("data-orgid", orgName);

                $.when(self.getMyFeed()).then(function (data) {
                    var selections = data.split("|");
                    //use grep to see if the current org value has a match in the subscription array
                    var matches = $.grep(selections, function (value, index) {
                        return value == orgName;
                    });
                    if (matches.length > 0) {
                        //change the button context
                        var subButton = $(".acctsub-button");
                        subButton.text("Unsubscribe");
                    }
                    deferred.resolve();
                });
            });
            //return deferred.promise();
        },
        saveMyFeed: function (feedSelections) {
            var self = this;
            var deferred = $.Deferred();
            var selectionCount = 0;
            var arrSelections = [];

            $.when(this.getUserData()).then(
                function (userProfileProperties) {
                    var clientContext = new SP.ClientContext.get_current();
                    var peopleManager = new SP.UserProfiles.PeopleManager(clientContext);
                    //Get the account name of the current user. It will be in the following format: "i:0#.f|membership|username@yoursite.onmicrosoft.com"
                    var currentUserAccountName = userProfileProperties.get_accountName();
                    //set the value in their user profile
                    peopleManager.setSingleValueProfileProperty(currentUserAccountName, "BAHPersonalFeed", feedSelections);//Set a single value property
                    clientContext.executeQueryAsync(function () {
                        deferred.resolve("success");
                    },
                    function (sender, args) {
                        var errMsg = "Error setting personal feed: " + args.get_message();
                        console.log(errMsg);
                    });
                });

            return deferred.promise();

        },
        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);



///#source 1 1 Widgets/Shared/streamNewsFeed.js
var Widgets = Widgets || {};
(function ($) {
    //TODO: Implement Loadmore on initial and parent load more.
    Widgets.streamNewsFeed = {
        configuration: {
            selectProperties: [
            "BAHStreamDisplay",
            "BAHStreamShowcaseOWSBOOL",
            "BAHShowcaseExpiryDate",
            "BAHShowcasePublishDate",
            "ArticleByLineOWSTEXT",
            "BAHYammerCommentCountOWSNMBR",
            "ViewsRecent",
            "Modified",
            "Title",
            "write",
            "BAHLeader",
            "BAHNewsArticleFeatured",
            "BAHLeaderOWSUSER",
            "BodyOWSMTXT",
            "ContentType",
            "path",
            "PublishingImage"
            ],
            query: '((BAHStreamDisplay="BAHSTREAM" AND BAHStreamShowcaseOWSBOOL:1) AND (BAHShowcaseExpiryDate>Today) AND (BAHShowcasePublishDate<Today) AND ContentType:"Zone Publishing Stream Enhanced News Page") OR ((BAHStreamDisplay="BAHSTREAM" AND BAHStreamShowcaseOWSBOOL:0) AND (BAHArticleDate<Today) AND ContentType:"Zone Publishing Stream Enhanced News Page") OR (ContentType:"Leadership Messages" AND BAHStreamDisplay="BAHSTREAM" AND BAHNewsArticleFeatured:1)',
            contentTypes: ['Leadership Messages', 'Zone Publishing Stream Enhanced News Page'],
        },
        buildFeaturedArticleArrayPromise: new $.Deferred(),
        preventLoadMore: false,
        name: 'Featured News',
        log: true,
        data: [],
        featuredNewsArray: {
            featuredCount: 0,
            featured: [],
            news: [],
            leadershipMessage: [],
            currentSearchIndex: 0,
            totalSearchResults: 0,
            loadSubAccount: false
        },
        currentRecursion: 0,
        currentRecursionStream: function () {
            var self = this;
            var bahStream = "";
            for (var i = 0; i < self.currentRecursion - 1; i++) {
                bahStream += self.header.bahStreamProps[i];
                if (i < self.currentRecursion - 2) {
                    bahStream += ":";
                }
            }
            return bahStream;
        },
        header: '',
        load: function () {
            var self = this;
            $.when(Widgets.genericHeader.promise).done(function () {
                self.header = Widgets.genericHeader;
                self.currentRecursion = self.header.bahStreamProps.length;
                self.data = $.grep(self.header.data.results, function (item, index) {
                    return ((item.ContentType).match(/Zone Publishing Stream Enhanced News Page/g) || (item.ContentType).match(/Leadership Messages/g));
                });
                for (var i = 0; i < self.data.length; i++) {
                    if (self.data[i].BAHStreamShowcaseOWSBOOL === "1") {
                        self.featuredNewsArray.featuredCount++;
                        self.featuredNewsArray.featured.push(self.articleBuilder(self.data[i]));
                    }
                    if (self.data[i].BAHStreamShowcaseOWSBOOL === "0") {
                        self.featuredNewsArray.news.push(self.articleBuilder(self.data[i]));
                    }
                    if (self.data[i].ContentType === "Leadership Messages" && self.data[i].BAHNewsArticleFeatured === "1") {
                        self.featuredNewsArray.leadershipMessage.push(self.articleBuilder(self.data[i]));
                    }
                }
                self.featuredNewsArray.featured.length < 3 ? self.featuredParentCheck() : self.renderHTML();
                self.featuredNewsArray.news.length < 1 ? self.newsParentCheck(0) : self.renderHTML();
                self.featuredNewsArray.leadershipMessage.length > 0 ? self.renderHTML() : null;
            });
        },
        articleBuilder: function (data) {
            var article = {};
            if (data.ContentType === "Leadership Messages") {
                article = {
                    title: data.Title || "",
                    featureLevel: 'LeadershipMessage',
                    message: $(data.BodyOWSMTXT).text(),
                    shortName: '',
                    color: ''
                };
            }
            else {
                article = {
                    image: Bah.getImageRendition($(data.PublishingImage).attr('src'), 3),
                    title: data.Title,
                    articleUrl: '/Pages/Article.aspx?path=' + data.path,
                    featureLevel: 'NewsArticle',
                    body: data.ArticleByLineOWSTEXT,
                    views: data.ViewsRecent,
                    comments: data.BAHYammerCommentCountOWSNMBR,
                    shortName: '',
                    color: ''
                };
            }
            return article;
        },
        featuredParentCheck: function () {
            var self = this;
            var stream = self.currentRecursionStream();
            var query = '(BAHStreamDisplay="' + stream + '" AND BAHStreamShowcaseOWSBOOL:1) AND (BAHShowcaseExpiryDate>Today) AND (BAHShowcasePublishDate<Today) AND (ContentType:"Zone Publishing Stream Enhanced News Page")';
            $.when(self.header.constructQuery(query, 0)).done(function (data) {
                if (data.m_value !== undefined && data.m_value.ResultTables[0].TotalRows !== 0) {
                    var results = data.m_value.ResultTables[0].ResultRows;
                    var currentResults = results.length;
                    for (var i = 0; i < currentResults ; i++) {
                        if (self.featuredNewsArray.featured.length < 3) {
                            self.featuredNewsArray.featuredCount++;
                            self.featuredNewsArray.featured.push(self.articleBuilder(results[i]));
                        }
                    }
                    if (self.featuredNewsArray.featured.length < 3 && self.currentRecursion > 2) {
                        self.currentRecursion--;
                        self.featuredParentCheck();
                    } else {
                        self.currentRecursion = self.header.bahStreamProps.length; //Reset recusion to proper length so we can load news articles if enough did not already exist
                        self.buildFeaturedArticleArrayPromise.resolve()
                        self.renderHTML();
                    }
                } else {
                    if (self.featuredNewsArray.featured.length < 3 && self.currentRecursion > 2) {
                        self.currentRecursion--;
                        self.featuredParentCheck();
                        self.header.logger("No Featured News data for configuration: '" + stream + "' exists. Crawling to parent " + self.currentRecursionStream());
                    } else {
                        self.currentRecursion = self.header.bahStreamProps.length; //Reset recusion to proper length so we can load news articles if enough did not already exist
                        self.buildFeaturedArticleArrayPromise.resolve()
                        self.renderHTML();
                    }
                }
            });
        },
        newsParentCheck: function (start) {
            var self = this;
            $.when(self.buildFeaturedArticleArrayPromise).done(function () {
                if (self.currentRecursion >= 3) { //Only crawl to parent if subaccount level or lower. This prevents loading of group news into the news feed
                    self.header.initialResultsAmount = 5;
                    var stream = self.currentRecursionStream();
                    var query = '(BAHStreamDisplay="' + stream + '" AND BAHStreamShowcaseOWSBOOL:0) AND (BAHArticleDate<Today) AND (ContentType:"Zone Publishing Stream Enhanced News Page")';
                    $.when(self.header.constructQuery(query, start)).done(function (data) {
                        if (data.m_value !== undefined && data.m_value.ResultTables[0].TotalRows !== 0) {
                            self.featuredNewsArray.totalSearchResults = data.m_value.ResultTables[0].TotalRows;
                            var results = data.m_value.ResultTables[0].ResultRows;
                            var currentResults = results.length;
                            self.featuredNewsArray.currentSearchIndex = results.length + start;
                            for (var i = 0; i < currentResults ; i++) {
                                self.featuredNewsArray.news.push(self.articleBuilder(results[i]));
                            }
                            self.renderHTML();
                        } else {
                            if (self.featuredNewsArray.news.length < 1 && self.currentRecursion > 3 && start === 0) {
                                self.currentRecursion--;
                                self.newsParentCheck(start);
                                self.header.logger("No News data for configuration: '" + stream + "' exists. Crawling to parent " + self.currentRecursionStream());
                            } else {
                                self.renderHTML();
                            }
                        }
                    });
                }
            });
        },
        renderHTML: function () {
            self = this;
            var template = Handlebars.compile($('#streamNewsFeedTemplate').html());
            var html = template(self.featuredNewsArray);
            $(self.container).html(html);
        },
        loadold: function (options) {
            var template = Handlebars.compile($('#accountNewsTemplate').html());
            $.when(Widgets.accountHeader.orgIdTermSetPromise).done(function () {
                Widgets.streamNewsFeed.loadShowcaseAccountStories();
                Widgets.streamNewsFeed.loadLeadershipMessage();
                Widgets.streamNewsFeed.loadArticleNewsFeed(0);

                $.when(Widgets.streamNewsFeed.buildFeaturedArticleArrayPromise).done(function () {
                    var html = template(Widgets.streamNewsFeed.featuredNewsArray);
                    $(Widgets.streamNewsFeed.container).html(html);
                });
                $.when(Widgets.streamNewsFeed.getArticlePromise).done(function () {
                    var html = template(Widgets.streamNewsFeed.featuredNewsArray);
                    $(Widgets.streamNewsFeed.container).html(html);
                });
                $.when(Widgets.streamNewsFeed.getLeadershipMessagePromise).done(function () {
                    var html = template(Widgets.streamNewsFeed.featuredNewsArray);
                    $(Widgets.streamNewsFeed.container).html(html);
                });
            });
        },
        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        },
        loadShowcaseAccountStories: function () {
            /***********************************************/
            /*** INITIAL QUERY TO LOAD SHOWCASE ARTICLES ***/
            /******************* STEP 1 ********************/

            //SP Search Query Took
            //Query Text: (BAHStream:"Army" AND BAHStreamShowcaseOWSBOOL:1) AND (BAHShowcaseExpiryDate>=Today) AND (BAHShowcasePublishDate<=Today)
            //Select Properties: Title, PublishingImage, ArticleByLineOWSTEXT, PublishingPageContentOWSHTML,BAHStreamShowcaseOWSBOOL, BAHShowcaseExpiryDate, BAHShowcasePublishDate, write, path, ArticleByLineOWSTEXT,BAHStream,BAHStreamDisplay,BAHYammerCommentCountOWSNMBR,ViewsRecent
            //Sort List:BAHShowcasePublishDate:descending
            //Rest Call: https://zonedev.sharepoint.com/_api/search/query?querytext='(BAHStream:"Army"+AND+BAHStreamShowcaseOWSBOOL:1)+AND(BAHShowcaseExpiryDate>%3dToday)+AND+(BAHShowcasePublishDate<%3dToday)'&enablestemming=false&enablephonetic=false&enablefql=false&enablequeryrules=true&bypassresulttypes=false&generateblockranklog=false&selectproperties='Title%2c+PublishingImage%2c+ArticleByLineOWSTEXT%2c+PublishingPageContentOWSHTML%2cBAHStreamShowcaseOWSBOOL%2c+BAHShowcaseExpiryDate%2c+BAHShowcasePublishDate%2c+write'&sortlist='BAHShowcasePublishDate:descending&rowlimit=3'

            var getArticleShowcasePromise = new $.Deferred();
            var getDataUrl = "/_api/search/query?querytext='(BAHStreamDisplay=\"" + encodeURIComponent(parentTermName) + ":" + encodeURIComponent(orgTermName) + "\"+AND+BAHStreamShowcaseOWSBOOL:1)+" +
                "AND(BAHShowcaseExpiryDate>%3dToday)+AND+(BAHShowcasePublishDate<%3dToday)'&trimduplicates=false&selectproperties='Title%2c+PublishingImage%2c+ArticleBy" +
                "LineOWSTEXT%2c+PublishingPageContentOWSHTML%2cBAHStreamShowcaseOWSBOOL%2c+BAHShowcaseExpiryDate%2c+BAHShowcasePublishDate%2c+write" +
                "+%2c+path+%2c+ArticleByLineOWSTEXT+%2c+BAHStreamDisplay+%2cBAHYammerCommentCountOWSNMBR+%2cViewsRecent'&sortlist='BAHShowcasePublishDate:descending'&rowlimit=3";
            $.getJSON(getDataUrl, function (data) {
                var accountLevelResultData = BahUtilities.getSharePointSearchResults(data);
                if (accountLevelResultData.Rows) {
                    var accountLevelResultCount = accountLevelResultData.Rows.length;
                }
                if (accountLevelResultCount < 3) {
                    var additionalArticlesCount = 3 - accountLevelResultCount;
                    var getDataUrl = "/_api/search/query?querytext='(BAHStreamDisplay=\"" + encodeURIComponent(parentTermName) + "\"" +
                        "+AND+BAHStreamShowcaseOWSBOOL:1)+AND(BAHShowcaseExpiryDate>%3dToday)+AND+(BAHShowcasePublishDate<%3dToday)'&trimduplicates=false&selectproperties='Title%2c+PublishingImage%2c+Arti" +
                        "cleByLineOWSTEXT%2c+PublishingPageContentOWSHTML%2cBAHStreamShowcaseOWSBOOL%2c+BAHShowcaseExpiryDate%2c+BAHShowcasePublishDate%2c+write+%2c+path+%2c+ArticleByLineOWSTEXT+%2c+BAHStreamDisplay+%2cBAHYammerCommentCountOWSNMBR+%2cViewsRecent'&sortlist='BAHShowcaseP" +
                        "ublishDate:descending'&rowlimit=" + additionalArticlesCount;
                    $.getJSON(getDataUrl, function (data) {
                        var groupLevelResultData = BahUtilities.getSharePointSearchResults(data);
                        if (groupLevelResultData.Rows) {
                            var groupLevelResultCount = groupLevelResultData.Rows.length;
                            Widgets.streamNewsFeed.featuredNewsArray.featuredCount = (accountLevelResultCount + groupLevelResultCount);
                        } else {
                            Widgets.streamNewsFeed.featuredNewsArray.featuredCount = accountLevelResultCount;
                        }
                        //Widgets.streamNewsFeed.featuredNewsArray.featuredCount = 1;
                        $.each(groupLevelResultData.Rows, function (key, val) {
                            accountLevelResultData.Rows.push(val);
                        });
                        getArticleShowcasePromise.resolve();
                    });
                } else {
                    getArticleShowcasePromise.resolve();
                }
                $.when(getArticleShowcasePromise).done(function () {
                    $.each(accountLevelResultData.Rows, function (key, val) {
                        var article = {
                            image: Bah.getImageRendition($(Bah.getResultValueByKey('PublishingImage', val.Cells)).attr('src'), 3),
                            title: Bah.getResultValueByKey('Title', val.Cells),
                            articleUrl: '/Pages/Article.aspx?path=' + Bah.getResultValueByKey('path', val.Cells),
                            featureLevel: 'NewsArticle',
                            body: Bah.getResultValueByKey('ArticleByLineOWSTEXT', val.Cells),
                            views: Bah.getResultValueByKey('ViewsRecent', val.Cells),
                            comments: Bah.getResultValueByKey('BAHYammerCommentCountOWSNMBR', val.Cells),
                            shortName: '',
                            color: ''
                        };
                        $.each(val.Cells, function (key, val) {
                            if (val.Key === "BAHStreamDisplay") {
                                var shortName = val.Value.split(":");
                                shortName = shortName[shortName.length - 1];
                                if (shortName === parentTermName) {
                                    article.shortName = parentTermProps["acronym"];
                                    article.color = parentTermProps["tagcolor"];
                                }
                                if (shortName === orgTermName) {
                                    article.shortName = orgTermProps["acronym"];
                                    article.color = orgTermProps["tagcolor"];
                                }

                            }
                        });
                        Widgets.streamNewsFeed.featuredNewsArray.featured.push(article);
                    });
                    Widgets.streamNewsFeed.buildFeaturedArticleArrayPromise.resolve();
                });
            });
        },
        loadLeadershipMessage: function () {
            /***********************************************/
            /****** QUERY TO LOAD LEADERSHIP MESSAGE *******/
            /******************* STEP 2 ********************/
            //SP Search Query Took
            //Query: contenttype:"Leadership Messages" AND BAHStream:"Defense Intelligence Group" AND BAHNewsArticleFeatured:1
            //Select Params: write,BAHStream,Title,BAHLeader,Modified,BAHNewsArticleFeatured,BAHLeaderOWSUSER,ContentType, BodyOWSMTXT
            //Rest Call: http://zonedev.sharepoint.com/_api/search/query?querytext='BAHStream:"Army"+AND+(BAHStreamShowcaseOWSBOOL:0+OR+ContentType:"Leadership+Messages")+AND+(ContentType:"Zone+Publishing+Stream+Enhanced+News+Page"+OR+ContentType:"Leadership+Messages")'&selectproperties='BAHStream%2c+ContentType%2c+Title%2c+PublishingImage%2c+ArticleByLineOWSTEXT%2c+PublishingPageContentOWSHTML%2cBAHStreamShowcaseOWSBOOL%2c+BAHShowcaseExpiryDate%2c+BAHShowcasePublishDate%2c+write%2c+Created%2c+path%2c+BAHLeader'&sortlist='Created:descending&rowlimit=10'


            var getDataUrl = "/_api/search/query?querytext='contenttype:\"Leadership+Messages\"+AND+BAHStreamDisplay=\"" + encodeURIComponent(parentTermName) + ":" + encodeURIComponent(orgTermName) +
                    "\"+AND+BAHNewsArticleFeatured:1'&trimduplicates=false&rowlimit=1&selectproperties='write%2cBAHStreamDisplay%2cTitle%2cBAHLeader%2cModified%2cBAHNewsArticleFeatured%2cBAHLeaderOWSUSER%2cContentType%2cBodyOWSMTXT'&sortlist='write:descending'";
            $.getJSON(getDataUrl, function (data) {
                var accountLevelResultData = BahUtilities.getSharePointSearchResults(data);
                if (BahUtilities.getSharePointTotalResults(data) > 0) {
                    $.each(accountLevelResultData.Rows, function (key, val) {
                        var article = {
                            title: Bah.getResultValueByKey('Title', val.Cells),
                            featureLevel: 'LeadershipMessage',
                            message: $(Bah.getResultValueByKey('BodyOWSMTXT', val.Cells)).text(),
                            //expandedMessage: '', use if read more needs to be implemented
                            shortName: '',
                            //expandable: false, use if read more needs to be implemented
                            //expanded: false,
                            color: ''
                        };
                        $.each(val.Cells, function (key, val) {
                            if (val.Key === "BAHStreamDisplay") {
                                var shortName = val.Value.split(":");
                                shortName = shortName[shortName.length - 1];
                                if (shortName === parentTermName) {
                                    article.shortName = parentTermProps["acronym"];
                                    article.color = parentTermProps["tagcolor"];
                                }
                                if (shortName === orgTermName) {
                                    article.shortName = orgTermProps["acronym"];
                                    article.color = orgTermProps["tagcolor"];
                                }
                            }
                        });
                        article.message = article.message.replace(/\[paragraph]/g, "<br /><br />");
                        //var limit = 1070;
                        //var tmplength = article.message.length;
                        //var tmp = article.message;
                        //if (tmplength > limit) {
                        //    var count = tmp.substring(0, limit).split("[paragraph]"); //count to assist line below
                        //    limit = limit - (count.length * 150); //remove roughly 1 line to prevent widget from expanding beyond the max height of carousel
                        //    tmp = tmp.replace(/\[paragraph]/g, "<br /><br />"); //Search for forced paragraphs and replace with breaks
                        //    //Edge case to handle if a break is in the split range. Just increase characters to contain break temporarily
                        //    if (limit + 14 < tmp.length) { //check to make sure index out of bounds does not happen
                        //        if (tmp.substring(limit - 14, limit + 14).indexOf("<br /><br />") > -1) {
                        //            article.message = tmp.substring(0, limit + 14);
                        //            article.expandedMessage = tmp.substring(limit + 14, article.messagelength);
                        //        } else {
                        //            article.message = tmp.substring(0, limit);
                        //            article.expandedMessage = tmp.substring(limit, article.messagelength);
                        //        }
                        //        article.expandable = true;
                        //    } else {
                        //        article.message = tmp.substring(0, tmp.length); //There is only 14 additional characters just print them out since you would if there was a break anyways
                        //    }
                        //}
                        //else {
                        //    article.message = tmp;
                        //}
                        Widgets.streamNewsFeed.featuredNewsArray.news.unshift(article);
                    });
                    Widgets.streamNewsFeed.getLeadershipMessagePromise.resolve();
                }

            });
        },
        loadArticleNewsFeed: function (startPosition) {
            /***********************************************/
            /****** QUERY TO LOAD/MORE FEED ARTICLES *******/
            /******************* STEP 3 ********************/
            //SP Search Query Took
            //Query Text: BAHStream:"Army" AND (BAHStreamShowcaseOWSBOOL:0 OR ContentType:"Leadership Messages") AND (ContentType:"Zone Publishing Stream Enhanced News Page" OR ContentType:"Leadership Messages")
            //Select Properties: BAHStream, ContentType, Title, PublishingImage, ArticleByLineOWSTEXT, PublishingPageContentOWSHTML,BAHStreamShowcaseOWSBOOL, BAHShowcaseExpiryDate, BAHShowcasePublishDate, write, Created, path, BAHLeader, ArticleByLineOWSTEXT
            //Sort List: Created:descending

            var getDataUrl = "/_api/search/query?querytext='BAHStreamDisplay=\"" + encodeURIComponent(parentTermName) + ":" + encodeURIComponent(orgTermName) +
                    "\"+AND+BAHStreamShowcaseOWSBOOL:0+AND(BAHArticleDate<%3dToday)+'&trimduplicates=false&selectproperties='BAHStreamDisplay%2c+ContentType%2c+Title%2c+PublishingImage%2c+ArticleByLineOWSTEXT%2c+PublishingPageContentOWSHTML%2c" +
                    "BAHStreamShowcaseOWSBOOL%2c+BAHShowcaseExpiryDate%2c+BAHShowcasePublishDate%2c+write%2c+Created%2c+path%2c+BAHLeader%2c+BodyOWSMTXT+%2" +
                    "cArticleByLineOWSTEXT+%2cBAHYammerCommentCountOWSNMBR+%2cViewsRecent+%2cBAHArticleDate'&s" +
                    "ortlist='BAHArticleDate:descending'&rowlimit=5&startrow=" + startPosition;
            if (Widgets.streamNewsFeed.featuredNewsArray.loadSubAccount) {
                getDataUrl = "/_api/search/query?querytext='BAHStreamDisplay:\"" + encodeURIComponent(parentTermName) + ":" + encodeURIComponent(orgTermName) +
                    "\"+AND+BAHStreamShowcaseOWSBOOL:0'&trimduplicates=false&selectproperties='BAHStreamDisplay%2c+ContentType%2c+Title%2c+PublishingImage%2c+ArticleByLineOWSTEXT%2c+PublishingPageContentOWSHTML%2c" +
                    "BAHStreamShowcaseOWSBOOL%2c+BAHShowcaseExpiryDate%2c+BAHShowcasePublishDate%2c+write%2c+Created%2c+path%2c+BAHLeader%2c+BodyOWSMTXT+%2" +
                    "cArticleByLineOWSTEXT+%2cBAHYammerCommentCountOWSNMBR+%2cViewsRecent+%2cBAHArticleDate'&s" +
                    "ortlist='BAHArticleDate:descending'&rowlimit=5&startrow=" + startPosition;
            }
            $.getJSON(getDataUrl, function (data) {
                var accountLevelResultData = BahUtilities.getSharePointSearchResults(data);
                Widgets.streamNewsFeed.featuredNewsArray.totalSearchResults = BahUtilities.getSharePointTotalResults(data);

                //Check to see if subaccount articles need to be loaded (If 0 results in primary then it loads subaccount articles instead.
                if (Widgets.streamNewsFeed.featuredNewsArray.totalSearchResults == 0 || Widgets.streamNewsFeed.featuredNewsArray.totalSearchResults == null) {
                    //Widgets.streamNewsFeed.featuredNewsArray.loadSubAccount = true;
                    //Widgets.streamNewsFeed.loadArticleNewsFeed(startPosition);
                }
                else {
                    Widgets.streamNewsFeed.featuredNewsArray.currentSearchIndex += accountLevelResultData.Rows.length;
                    $.each(accountLevelResultData.Rows, function (key, val) {
                        var article = {
                            image: Bah.getImageRendition($(Bah.getResultValueByKey('PublishingImage', val.Cells)).attr('src'), 3),
                            title: Bah.getResultValueByKey('Title', val.Cells),
                            articleUrl: '/Pages/Article.aspx?path=' + Bah.getResultValueByKey('path', val.Cells),
                            featureLevel: 'NewsArticle',
                            body: Bah.getResultValueByKey('ArticleByLineOWSTEXT', val.Cells),
                            message: '',
                            views: Bah.getResultValueByKey('ViewsRecent', val.Cells),
                            comments: Bah.getResultValueByKey('BAHYammerCommentCountOWSNMBR', val.Cells),
                            shortName: '',
                            color: ''
                        };
                        $.each(val.Cells, function (key, val) {
                            //This will NOT FUNCTION on subaccount level
                            if (val.Key === "BAHStreamDisplay") {
                                var shortName = val.Value.split(":");
                                shortName = shortName[shortName.length - 1];
                                if (shortName === parentTermName) {
                                    article.shortName = parentTermProps["acronym"];
                                    article.color = parentTermProps["tagcolor"];
                                }
                                if (shortName === orgTermName) {
                                    article.shortName = orgTermProps["acronym"];
                                    article.color = orgTermProps["tagcolor"];
                                }
                            }
                        });
                        Widgets.streamNewsFeed.featuredNewsArray.news.push(article);
                    })
                };
                if (startPosition !== 0) {
                    var template = Handlebars.compile($('#accountNewsTemplate').html());
                    var html = template(Widgets.streamNewsFeed.featuredNewsArray);
                    $(Widgets.streamNewsFeed.container).html(html);
                } else {
                    Widgets.streamNewsFeed.getArticlePromise.resolve();
                }
            });
            Widgets.streamNewsFeed.preventLoadMore = false;
        },
        loadMoreArticles: function (startPosition) {
            document.getElementById('LoadMore').removeAttribute("onclick");
            if (!Widgets.streamNewsFeed.preventLoadMore) {
                Widgets.streamNewsFeed.preventLoadMore = true;
                if (Widgets.streamNewsFeed.featuredNewsArray.loadSubAccount == false) {
                    Widgets.streamNewsFeed.loadArticleNewsFeed(startPosition)
                } else {
                    Widgets.streamNewsFeed.loadSubAccountArticleNewsFeed(startPosition)
                }

            }
        }
    };
})(jQuery);

///#source 1 1 Widgets/Shared/searchStream.js
var Widgets = Widgets || {};

(function ($) {
    Widgets.searchStream = {
        name: "Search",
        redirectUrl: "/Pages/Search-Results.aspx", /*Bah.configuration.searchResultsPageUrl,*/
        sParameter: "",
        log: true,
        

        getShortName: function () {
            var header = Widgets.genericHeader;
            return $.when(header.promise).then(
                    function () {
                        sParameter = '%20 AND%20bahstreamdisplay:%22' + Widgets.genericHeader.bahStream + '%22';
                        return Widgets.genericHeader.data.headerData.name;
                    }
                );
        },
        template: function () {
            return $("#searchTemplate").html();
        },

        fetch: function () {
            var self = this;
            redirectUrl = Bah.configuration.searchResultsPageUrl;
            return $.when(self.getShortName()).then(function (shortName) {
                return { shortName: shortName };
            });
        },

        parse: function (data) {
            return data;
        },

        bind: function (template, data) {
            var template = Handlebars.compile(template);
            var html = template(data);
            return html;
        },

        render: function (html, data) {
            // render and attach event here
            var self = this;
            var $container = $(this.container);
            $container.html(html);

            //just in case it gets rendered again
            $container.off('click.search');

            if (redirectUrl) { //if no url, don't even bother registering event
                var submit = function (query) {
                    if (query) {
                        //redirect here
                        window.location.href = redirectUrl + '?k=' + encodeURIComponent(query) + sParameter;
                    }
                    return false;
                };

                $container.on('click.search', '.btn-search', function () {
                    return submit($container.find('.input').val());
                });

                $container.on('keydown', '.input', function (e) {
                    var key = e.which;
                    if (key === 13) {
                        return submit($container.find('.input').val())
                    }
                });
            }
        },

        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);
///#source 1 1 Widgets/Shared/resourceBucket.js
var Widgets = Widgets || {};
(function ($) {

    Widgets.resourceBucket = {
        log: true,

        configuration: {
            selectProperties: [
            "BAHFunctionalDescriptionOWSHTML",
            "BAHLongURLTitleOWSTEXT",
            "BAHResourceUrl",
            "BAHIconUrlOWSURLH",
            "BAHSortOrder",
            "BAHFunctionalFilter",
            "BAHWidget",
            "BAHFunctionalPageTitle",
            "Title"
            ],
            query: '',
            contentTypes: ['Functional List', 'Functional Documents', 'Functional Pages'],
        },
        load: function (options) {
            var context = this;
            var html;
            var content = Widgets.genericHeader;
            var template = Handlebars.compile($('#resourceBucketTemplate').html());
            var id = $(context.container).attr('data-section');
            var title = "BAHSectionTitle" + id;
            var desc = "BAHSectionDescription" + id + "OWSHTML";

            var buckets = [];
            var titleLimit = 20;
            var maxLink = 8;

            var bucketArray = [];
            $.when(content.promise, content.termPromise).done(function () {
                $.each(content.data.results, function (key, val) {
                    $.each(val, function (key2, val2) {
                        if (key2 === "BAHWidget") {
                            if (val2.indexOf("Resource Bucket") > -1) {
                                var url = null;
                                if (val["ContentType"].indexOf("Functional List") > -1) {
                                    url = val["BAHResourceUrl"];
                                }
                                if (val["ContentType"].indexOf("Functional Document") > -1) {
                                    url = val["Url"];
                                }
                                //Assume the valut is Ex:"Filters:Resource Bucket:Work-Life and Wellness Benefits"
                                var filter = val["BAHFunctionalFilter"];
                                var bucketTitle = '';
                                if (filter != null) {
                                    var titles = val["BAHFunctionalFilter"].split(':');
                                    bucketTitle = titles[titles.length - 1];
                                }
                                var arrayItem = {
                                    bucketTitle: bucketTitle,
                                    url: url,
                                    urlText: Bah.setEllipsis(val["Title"], titleLimit)
                                }
                                bucketArray.push(arrayItem);

                            }
                        }
                    });
                });

                var bucketArraySort = lazy(bucketArray).sortBy('bucketTitle').toArray();
                var result = context.groupBy(bucketArraySort, function (value) {
                    return [value.bucketTitle];
                });

                $.each(result, function (index, value) {
                    var item =
                        {
                            bucketTitle: value[0].bucketTitle,
                            links: []
                        };

                    $.each(value.slice(0, maxLink), function (i, links) {
                        var linkInfo =
                        {
                            link: links.url,
                            linkText: links.urlText
                        };
                        item.links.push(linkInfo);
                    });
                    buckets.push(item);
                });

                html = template(buckets);
                $(context.container).html(html);
                //$('.accordion .accordionResourceBucket:first-child .accordion-section-title').addClass('active');

                function close_accordion_section() {
                    $('.accordion .accordion-section-title').removeClass('active');
                    $('.accordion .accordion-section-content').slideUp(300).removeClass('open');
                }

                $('.accordion-section-title').click(function (e) {
                    // Grab current anchor value
                    var currentAttrValue = $(this).attr('href');

                    if ($(e.target).is('.active')) {
                        close_accordion_section();
                    } else {
                        close_accordion_section();

                        // Add active class to section title
                        $(this).addClass('active');
                        // Open up the hidden content panel
                        $('.accordion ' + currentAttrValue).slideDown(300).addClass('open');
                    }

                    e.preventDefault();
                });

                $('.fa-minus').click(function (e) {
                    // Grab current anchor value
                    var currentAttrValue = $(this).attr('href');
                    if ($(e.target).is('.active')) {
                        close_accordion_section();
                    } else {
                        close_accordion_section();

                        // Add active class to section title
                        $(this).addClass('active');
                        // Open up the hidden content panel
                        $('.accordion ' + currentAttrValue).slideDown(300).addClass('open');
                    }

                    e.preventDefault();
                });

                Widgets.totalBlocks.showAccordion();
                $('.accordion .accordionResourceBucket:first-child .accordion-section-title').addClass('active');
                $('.accordion #accordion-0').slideDown(300).addClass('open');

                $(window).resize(function () {
                    Widgets.totalBlocks.showAccordion();

                });


            });
        },

        showAccordion: function () {
            var windowWidth = $(window).width();
            if (windowWidth > 680) {
                $('.accordion-section-content').css({ display: "block" });
                $('.accordion .accordion-section-title').addClass('active');
            }
            //else
            //{
            //    //close all accordion sections
            //    $('.accordion .accordion-section-title').removeClass('active');
            //    $('.accordion .accordion-section-content').slideUp(300).removeClass('open');
            //    // open only the first one
            //    $('.accordion .accordionResourceBucket:first-child .accordion-section-title').addClass('active');
            //    $('.accordion #accordion-0').slideDown(300).addClass('open');

            //}

        },

        groupBy: function (array, fn) {
            var groups = {};
            array.forEach(function (value) {
                var group = JSON.stringify(fn(value));
                groups[group] = groups[group] || [];
                groups[group].push(value);
            });
            return Object.keys(groups).map(function (group) {
                return groups[group];
            })
        },

        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };

})(jQuery);
///#source 1 1 Widgets/FunctionalCommunity/fcJoin.js
var Widgets = Widgets || {};
(function ($) {
    Widgets.fcJoin = {
        name: "FC Join",
        fetch: function () {
            var getUserCommunities = function () {
                var locale = 1033; //English
                var deferred = $.Deferred();
                var clientContext = SP.ClientContext.get_current();
                var web = clientContext.get_web();
                var currentList = web.get_lists().getById(_spPageContextInfo.pageListId);
                var currentListItem = currentList.getItemById(_spPageContextInfo.pageItemId);
                var peopleManager = new SP.UserProfiles.PeopleManager(clientContext);
                personProperties = peopleManager.getMyProperties();
                clientContext.load(personProperties);
                clientContext.load(currentListItem);
                ////Calls the query async to get the current user profile properties and the current page properties.
                clientContext.executeQueryAsync(
                    Function.createDelegate(this,
                        function () {
                            var result = [];

                            result.currentPage = currentListItem;
                            result.userProperties = personProperties;
                            deferred.resolve(result);
                        }),
                    Function.createDelegate(this,
                        function (sender, args) { deferred.reject(sender, args); }));

                return deferred.promise();
            };
            return getUserCommunities();
        },

        parse: function (result) {
            var fcData = {
                isUserPrimaryFC: false,
                isUserJoined: false,
                pageCommunity: '',
                accountName: ''
            };

            if (result.userProperties) {
                var data = result.userProperties;
                var page = result.currentPage;
                ////If user data and current page are defined.
                if (data && page) {
                    ////Gets the account name, the primary and functional communities, then it gets the page community.
                    var userProperties = data.get_userProfileProperties();
                    var pageFunctionalCommunity = page.get_item('BAH_FunctionalCommunity');

                    var primaryCommunity = userProperties['BAHFCPrimary'] != undefined ? userProperties['BAHFCPrimary'] : '';
                    var functionalCommunities = userProperties['BAHFC'] != undefined ? userProperties['BAHFC'].toString().split('|') : '';
                    fcData.accountName = userProperties['AccountName'] != undefined ? userProperties['AccountName'] : '';
                    fcData.pageCommunity = pageFunctionalCommunity != undefined ? pageFunctionalCommunity.get_label().trim() : '';

                    ////Sets the FC Data to change the User Profile properties later.
                    ////Checks wethert the page community is the users primary community.
                    if (primaryCommunity === fcData.pageCommunity) {
                        fcData.isUserPrimaryFC = true;
                    }
                    ////Checks whether the user is joined or not to the page community.
                    if ($.inArray(fcData.pageCommunity, functionalCommunities) != -1) {
                        fcData.isUserJoined = true;
                    }                     

                    return { fcData: fcData };
                }
            }

            return { fcData: fcData };
        },

        bind: function (template, data) {
            var template = Handlebars.compile(template);
            var html = template(data);
            return { html: html, fcData: data.fcData };
        },

        render: function (data) {
            $(this.container).html(data.html);
            var joinButton = $(".fcjoin-button");

            joinButton.attr("data-pagecommunity", data.fcData.pageCommunity);
            joinButton.attr("data-userjoined", data.fcData.isUserJoined);
            joinButton.attr("data-accountname", data.fcData.accountName);
            
            if (data.fcData.isUserPrimaryFC) {
                joinButton.attr("disabled", "disabled");
                joinButton.text("Joined");
                joinButton.css('cursor', 'default');
                joinButton.css('text-decoration', 'none');
            }

            if (data.fcData.isUserJoined) {
                joinButton.text("Joined");
            }
            
            this.handlers();
        },

        fail: function (error, event) {
            Bah.logging.error('Error at ' + event, this.name);
        },

        template: function () {
            return $("#fcJoinTemplate").html();
        }, 

        handlers: function () {
            var button = $(this.container).find(".fcjoin-button");

            button.hover(function () {
                if (!$(this).is('[disabled=disabled]')) {
                    var userJoined = $(this).attr("data-userjoined") === "true" ? true : false;
                    if (userJoined) {
                        $(".fcjoin-button").text("Unjoin");
                    }
                }
            }, function () {
                if (!$(this).is('[disabled=disabled]')) {
                    var userJoined = $(this).attr("data-userjoined") === "true" ? true : false;
                    if (userJoined) {
                        $(".fcjoin-button").text("Joined");
                    }
                }
            });
            
            button.click(function (e) {
                var ctrl = $(this);
                if (ctrl.is('[disabled=disabled]')) {
                    e.preventDefault();
                }
                else {
                    var pageCommunity = ctrl.attr("data-pagecommunity");
                    var userLogin = ctrl.attr("data-accountname");
                    var isUserJoined = ctrl.attr("data-userjoined") === "true" ? true : false;

                    var userQueryUrl = "/_api/SP.UserProfiles.PeopleManager/GetUserProfilePropertyFor(accountName=@v,propertyName='BAHFC')?@v='" + encodeURIComponent(userLogin) + "'";

                    ////Updates the functional communities property in the user profile, but first it gets the current value in order to avoid conflict changes with parallel calls.
                    $.when(Bah.queryUserProfileProperties(userQueryUrl)).then(function (xData, status) {
                        if (status === "success") {
                            var userData = xData;
                            if (userData && userData.d) {
                                ////Gets the current functional communities property.
                                var newUserValue = userData.d.GetUserProfilePropertyFor;
                                newUserValue = newUserValue.split('|');
                                ////Removes the page community from the functional communities array if the iser is joined, otherwise adds the page community to the array.
                                newUserValue = Bah.getNewUserPropertyValues(pageCommunity, newUserValue, isUserJoined);
                                ////Updates the user profile property
                                Bah.joinFc(userLogin, "BAHFC", newUserValue, isUserJoined, ctrl);
                            }
                        }
                    });
                }
            });
        }
    };
})(jQuery);

///#source 1 1 Widgets/FunctionalCommunity/fcTiles.js
var Widgets = Widgets || {};

(function ($) {
	Widgets.fcTiles = {
		name: 'FC Tiles',

		load: function (options) {
			var self = this;
			self.options = options;

			var viewModel = {
				viewAllUrl: '',
				items: [],
				events: [],
				news: [],
				files: [],
				labelEvents: 'Events',
				labelNews: 'News',
				labelFiles: 'Intellectual Capital'
			};

			var clientContext = SP.ClientContext.get_current();
			var web = clientContext.get_web();
			var currentList = web.get_lists().getById(_spPageContextInfo.pageListId);
			var currentListItem = currentList.getItemById(_spPageContextInfo.pageItemId);
			clientContext.load(currentListItem);
			////Calls the query async to get the page community.
			clientContext.executeQueryAsync(Function.createDelegate(this, function () {
				var pageFunctionalCommunity = currentListItem.get_item('BAH_FunctionalCommunity');
				var pageCommunity = pageFunctionalCommunity !== undefined ? pageFunctionalCommunity.get_label().trim() : '';

				var promises = [];
				var queryUrl = '';
				var rowLimit = 2;

				////If page community is not empty then make the 3 queries (News, Events and Documents).
				if (pageCommunity != '') {
					////News query
				    queryUrl = _spPageContextInfo.siteAbsoluteUrl + "/_api/search/query?querytext='ContentType:\"Functional+Community+News+Article+Page\"+BAHFunctionalCommunities:\"" + pageCommunity + "\"'&trimduplicates=false&rowlimit=" + rowLimit + "'&selectproperties='Path%2cUrl%2cTitle%2cAuthor%2cPublishingPageImageOWSIMGE%2cBAHArticleDate'&sortlist='BAHArticleDate:descending'";
					promises.push(this.getFCTilesData(queryUrl, viewModel.labelNews, 4, viewModel, rowLimit));

					////Query for Events but first it gets the Event Details Page term
					var eventDetailsPageUrl = Bah.configuration.eventDetailsPageUrl;

					var today = new Date();
					var utcToday = $.format.date(today.toUTCString(), 'yyyy') + "-" + (today.getUTCMonth() + 1) + "-" + today.getUTCDate() + $.format.date(today.toUTCString(), 'THH:mm:ss'); //yyyy-MM-ddTHH:mm:ss
					queryUrl = _spPageContextInfo.siteAbsoluteUrl + "/_api/search/query?querytext='ContentType:\"BAH+Functional+Community+Event\"+BAHStartDate>=\"" + utcToday + "\"+BAHFunctionalCommunities:\"" + pageCommunity + "\"'&trimduplicates=false&rowlimit=" + rowLimit + "'&selectproperties='Path%2cUrl%2cTitle%2cAuthor%2cUniqueId%2cBAHStartDate'&sortlist='BAHStartDate:ascending'";
					promises.push(this.getFCTilesData(queryUrl, viewModel.labelEvents, 1, viewModel, rowLimit, eventDetailsPageUrl));

					////Files query
					rowLimit = 1;
					queryUrl = _spPageContextInfo.siteAbsoluteUrl + "/_api/search/query?querytext='ContentType:\"Intellectual+Capital\"+BAHFunctionalCommunities:\"" + pageCommunity + "\"'&trimduplicates=false&rowlimit=" + rowLimit + "'&selectproperties='Path%2cUrl%2cTitle%2cAuthor%2cBAHModifiedDate'&sortlist='BAHModifiedDate:descending'";
					promises.push(this.getFCTilesData(queryUrl, viewModel.labelFiles, 2, viewModel, rowLimit));
				}

				////When all the ajax search queries finish, run handlebars.
				$.when.apply($, promises).then(function (data1, data2, data3) {
					////Groups the results by category and then renders the mobile template
					viewModel.events = Widgets.fcTiles.filterByCategory(viewModel, viewModel.labelEvents);
					viewModel.news = Widgets.fcTiles.filterByCategory(viewModel, viewModel.labelNews);
					viewModel.files = Widgets.fcTiles.filterByCategory(viewModel, viewModel.labelFiles);

					var templateMobile = Handlebars.compile($('#fcTilesTemplateMobile').html());
					var htmlMobile = templateMobile(viewModel);

					////Sort items by specific order to display in desktop mode.
					viewModel.items.sort(function (a, b) {
						return a.order < b.order ? -1 : a.order > b.order ? 1 : 0;
					});
					var template = Handlebars.compile($('#fcTilesTemplate').html());
					var html = template(viewModel);
					$(self.container).html(html);
					$(self.container).append(htmlMobile);
					BS.dotdotdoter.parseElement(".stories-list article h2");
				});
			}), Function.createDelegate(this, function (sender, args) { Bah.logging.error('Error trying to retrieve My Functional Communities from the current user profile.', this.name); }));
		},

		fail: function (error, event) {
			Bah.logging.error(event, this.name);
		},

		filterByCategory: function (viewModel, label) {
			return lazy(viewModel.items).filter(function (x) {
				if (x.category === label)
					return x;
			}).sortBy('order').toArray();
		},

		getFCTilesData: function (queryUrl, category, order, viewModel, rowLimit, tileUrl) {
			return $.ajax({
				async: true,
				url: queryUrl,
				type: 'GET',
				headers: { 'Accept': 'application/json; odata=verbose' },
				cache: false,
				success: function (data) {
					if (data.d) {
						var results = data.d.query.PrimaryQueryResult.RelevantResults.Table.Rows.results;

						////Iterates through the results and creates the item view model.
						$.each(results, function (index, result) {
							var resultsRow = result.Cells.results;
							var item;
							switch (category) {
								case "News":
									item = {
										title: Bah.getResultValueByKey('Title', resultsRow),
										date: Bah.getResultValueByKey('BAHArticleDate', resultsRow) != '' ? $.format.date(new Date(Bah.getResultValueByKey('BAHArticleDate', resultsRow)), 'MMM D, yyyy') : '',
										image: $(Bah.getResultValueByKey('PublishingPageImageOWSIMGE', resultsRow)).attr('src'),
										order: index * order,
										url: Bah.getResultValueByKey('Path', resultsRow),
										category: category
									};
									break;
								case "Events":
									var url = Bah.getResultValueByKey('Path', resultsRow);
									var eventId = url.substring(url.indexOf('?ID=') + 4);
									var date = new Date(Bah.getResultValueByKey('BAHStartDate', resultsRow));
									var sourceUrl = url.substring(0, url.indexOf('/Lists/'));
									var detailUrl = tileUrl === "#" ? tileUrl : tileUrl + "?eventId=" + eventId + "&sourceUrl=" + sourceUrl;
									var calcOrder = (2 * index) + order;
									item = {
										title: Bah.getResultValueByKey('Title', resultsRow),
										date: $.format.date(date, 'MMM D, yyyy'),
										image: '',
										order: calcOrder,
										url: detailUrl,
										category: category,
										isMedium: calcOrder === order ? true : false
									};
									break;
								case "Intellectual Capital":
									item = {
										title: Bah.getResultValueByKey('Title', resultsRow),
										date: $.format.date(new Date(Bah.getResultValueByKey('BAHModifiedDate', resultsRow)), 'MMM D, yyyy'),
										image: '',
										order: index + order,
										url: Bah.getResultValueByKey('Path', resultsRow),
										category: category
									};
									break;
							}

							viewModel.items.push(item);
						});

						////If results are missing, then it fills the viewModel array with a No Content item.
						if (results.length < rowLimit) {
							for (var i = results.length; i < rowLimit; i++) {
								var itemOrder = 0;
								var isMedium = false;
								switch (category) {
									case "News":
										itemOrder = i * order;
										break;
									case "Events":
										itemOrder = (2 * i) + order;
										isMedium = itemOrder === order ? true : false;
										break;
									case "Intellectual Capital":
										itemOrder = i + order;
										break;
								}

								viewModel.items.push({ title: 'No content available for this tile', date: '', image: '', order: itemOrder, url: '', category: category, isMedium: isMedium });
							}
						}
					}
				},
				error: function (requestObject, error, errorThrown) {
					Bah.logging.error(errorThrown, 'fcTiles');
				}
			});
		}
	};
})(jQuery);
///#source 1 1 Widgets/FunctionalCommunity/fcList.js
var Widgets = Widgets || {};

(function ($) {
	Widgets.fcList = {
		name: 'FC List',
		load: function (options) {
			var self = this;
			self.options = options;

			var viewModel = {
				viewAllUrl: '',
				communities: [],
				topCommunities: [],
				allCommunitiesLeft: [],
				accountName: '',
				isUserJoined: false,
				primaryCommunity: []
			};

			var userTermSetName = Bah.Constants.Name.UserProfileTermSet;
			var locale = 1033; //English
			var clientContext = SP.ClientContext.get_current();
			var peopleManager = new SP.UserProfiles.PeopleManager(clientContext);
			userProperties = peopleManager.getMyProperties();
			var taxonomySession = SP.Taxonomy.TaxonomySession.getTaxonomySession(clientContext);
			var termStore = taxonomySession.getDefaultSiteCollectionTermStore();
			var userTermSets = termStore.getTermSetsByName(userTermSetName, locale);
			var userTermSet = userTermSets.getByName(userTermSetName);

			clientContext.load(userProperties);
			clientContext.load(userTermSet);

			////Calls the query async to get My Functional Communities associated to the current user profile.
			clientContext.executeQueryAsync(Function.createDelegate(this, function () {
				////Gets the primary and functional communities associated to the user.
				var userProfileProperties = userProperties.get_userProfileProperties();
				var primaryCommunity = userProfileProperties['BAHFCPrimary'] != undefined ? userProfileProperties['BAHFCPrimary'] : '';
				var functionalCommunities = userProfileProperties['BAHFC'] != undefined ? userProfileProperties['BAHFC'].toString().split('|') : '';
				viewModel.accountName = userProfileProperties['AccountName'] != undefined ? userProfileProperties['AccountName'] : '';

				var promises = [];
				var queryUrl = '';

				////Queries all FC pages. A row limit must be established, otherwise it will always restrict the results number to 10.
				queryUrl = "/_api/search/query?querytext='ContentType:\"Functional+Community+Page\"'&trimduplicates=false&rowlimit=100&selectproperties='Title%2c+BAHFCSponsor%2c+Path%2c+BAHFCIcon%2c+BAHFunctionalCommunity%2c+BAHFCSponsorOWSUser'";
				promises.push(Bah.getMyFunctionalCommunities(queryUrl, 1, viewModel, null, userTermSet));

				////When all the ajax search queries finish runs handlebars.
				$.when.apply($, promises).then(function (data1, data2, data3) {
					////Add new properties to the result set in order to identify which one is the primary FC and which ones are joined communities.
					Widgets.fcList.setPrimaryAndJoinedCommunities(viewModel, primaryCommunity, functionalCommunities);

					//We get all the communities and filter the first six later, that way the filter works ok for both tabs.
					viewModel.topCommunities = lazy(viewModel.communities).sortBy('title').toArray();

					var template = Handlebars.compile($('#fcListTemplate').html());
					var html = template(viewModel);

					$(self.container).html(html);

					$(".fclist-button").hover(function () {
						var userJoined = $(this).attr("data-userjoined") === "true" ? true : false;
						if (userJoined) {
							$(this).text("Unjoin");
						}
					}, function () {
						var userJoined = $(this).attr("data-userjoined") === "true" ? true : false;
						if (userJoined) {
							$(this).text("Joined");
						}
					});

					$(".fclist-button").click(function () {
						var button = $(this);
						var article = button.closest('article');
						var pageCommunity = button.attr("data-community");
						var userLogin = $('input:hidden[name=fclist-username]').val();
						var isUserJoined = button.attr("data-userjoined") === "true" ? true : false;
						var newUserValue = '';
						var finalRequest = '';
						$('#my-communities-view').removeClass('disabled');

						var userQueryUrl = "/_api/SP.UserProfiles.PeopleManager/GetUserProfilePropertyFor(accountName=@v,propertyName='BAHFC')?@v='" + encodeURIComponent(userLogin) + "'";

						////Updates the functional communities property in the user profile, but first it gets the current value in order to avoid conflict changes with parallel calls.
						$.when(Bah.queryUserProfileProperties(userQueryUrl)).then(function (xData, status) {
							if (status === "success") {
								var userData = xData;
								if (userData && userData.d) {
									////Gets the current functional communities property.
									newUserValue = userData.d.GetUserProfilePropertyFor;
									newUserValue = newUserValue.split('|');
									////Removes the page community from the functional communities array if the iser is joined, otherwise adds the page community to the array.
									newUserValue = Bah.getNewUserPropertyValues(pageCommunity, newUserValue, isUserJoined);
									////Updates the user profile property
									Bah.joinFc(userLogin, "BAHFC", newUserValue, isUserJoined, button, article);
								}
							}
						});
					});

					$(".fclist-view").click(function () {
						if (!$(this).hasClass('disabled')) {
							var $listboxes = $('.list-boxes');
							$listboxes.toggleClass('show-my-communities', $(this).text() != 'All');

							if (!$(this).hasClass('active')) {
								$(this).addClass('active');
							}

							if ($(this).text() != 'All') {
								$('#all-communities-view').removeClass('active');

								if ($('.list-boxes').hasClass('show-only-6')) {
									Widgets.fcList.filterSixCommunities('joined');
								}
							} else {
								$('#my-communities-view').removeClass('active');

								if ($('.list-boxes').hasClass('show-only-6')) {
									Widgets.fcList.filterSixCommunities();
								}
							}
						}
					});

					if (!viewModel.isUserJoined) {
						var tiles = $(self.container).find(".list-boxes");
						tiles.removeClass('show-my-communities');
						$('#my-communities-view').addClass('disabled');

						$('#all-communities-view').click();
					}
					else {
						$('#my-communities-view').click();
					}

					$(".view-more").click(function () {
						$('.list-boxes').removeClass('show-only-6');
						$(this).hide();
					});
				});
			}), Function.createDelegate(this, function (sender, args) { Bah.logging.error('Error trying to retrieve FC List from the current user profile.', this.name); }));
		},

		//Filters the first six communities
		//[className]: Optional parameter. Filters the first six communities with the given class.
		filterSixCommunities: function (className) {
			var $listboxes = $('.list-boxes');
			var $communities;

			//Removes the show-only class from all the communities that has it.
			$('article.show-only', $listboxes).removeClass('show-only');

			//Selects the communities, filtering by a class if the parameter is present.
			if (typeof className != 'undefined') {
				$communities = $('article.' + className, $listboxes);
			}
			else {
				$communities = $('article', $listboxes);
			}

			//Filters the first 6 communities and adds the class so that only those are visible.
			$communities.slice(0, 6).addClass('show-only');
		},

		fail: function (error, event) {
			Bah.logging.error(event, this.name);
		},

		setPrimaryAndJoinedCommunities: function (viewModel, primaryCommunity, functionalCommunities) {
			var userJoinedToCommunities = false;

			for (var i = 0; i < viewModel.communities.length; i++) {
				var communityTitle = viewModel.communities[i]["functionalCommunity"];

				if (primaryCommunity !== '' && primaryCommunity !== undefined && communityTitle === primaryCommunity) {
					viewModel.communities[i]["isPrimary"] = true;
					viewModel.primaryCommunity = viewModel.communities[i];
					viewModel.communities[i]["order"] = 1;
					userJoinedToCommunities = true;
				} else {
					viewModel.communities[i]["isPrimary"] = false;
					viewModel.communities[i]["order"] = 2;
				}

				if ($.inArray(communityTitle, functionalCommunities) != -1) {
					viewModel.communities[i]["isJoined"] = true;
					userJoinedToCommunities = true;
				} else {
					viewModel.communities[i]["isJoined"] = false;
				}
			}

			viewModel.isUserJoined = userJoinedToCommunities;
		}
	};
})(jQuery);
///#source 1 1 Widgets/FunctionalCommunity/fcLeaderInfo.js
var Widgets = Widgets || {};

(function ($) {
    Widgets.fcLeaderInfo = {
        name: 'Leader Info',

        load: function (options) {
            var self = this;
            self.options = options;

            var promises = [];
            var viewModel = {
                fullName: '',
                careerTitle: '',
                pictureUrl: '',
                profileUrl: ''
            };

            var termSetName = Bah.Constants.Name.UserProfileTermSet;
            var locale = 1033; //English
            var clientContext = SP.ClientContext.get_current();

            var web = clientContext.get_web();
            var currentList = web.get_lists().getById(_spPageContextInfo.pageListId);
            var currentListItem = currentList.getItemById(_spPageContextInfo.pageItemId);
            var users = web.get_siteUsers();

            var taxonomySession = SP.Taxonomy.TaxonomySession.getTaxonomySession(clientContext);
            var termStore = taxonomySession.getDefaultSiteCollectionTermStore();
            var termSets = termStore.getTermSetsByName(termSetName, locale);
            var termSet = termSets.getByName(termSetName);
            var terms = termSet.getAllTerms();
            clientContext.load(taxonomySession);
            clientContext.load(termStore);
            clientContext.load(termSet);
            clientContext.load(users);
            clientContext.load(currentListItem);

            clientContext.executeQueryAsync(Function.createDelegate(this, function () {
                ////Gets the view profile url from the term set custom property
                var viewUrl = Bah.getViewProfileUrlProperty(termSet);
                var publishingContact = currentListItem.get_item('PublishingContact');
                var userContactId = publishingContact !== undefined ? publishingContact.get_lookupId() : '';
                var userContactName = publishingContact !== undefined ? publishingContact.get_lookupValue() : '';
                var userLogin = '';
                var careerTitle = '';
                var pictureUrl = '/Style Library/BAH/img/photo01.png';

                if (userContactId !== '') {
                    for (var i = 0; i < users.get_count() ; i++) {
                        var user = users.getItemAtIndex(i);
                        if (user.get_id() === userContactId) {
                            userLogin = user.get_loginName();
                            break;
                        }
                    }
                }

                if (userLogin !== '') {
                    var userName = userLogin.substring(userLogin.indexOf('i:0#.f'));
                    var userQueryUrl = "/_api/SP.UserProfiles.PeopleManager/GetUserProfilePropertyFor(accountName=@v,propertyName='SPS-JobTitle')?@v='" + encodeURIComponent(userName) + "'";

                    promises.push($.ajax({
                        async: false,
                        url: userQueryUrl,
                        type: "GET",
                        headers: { "Accept": "application/json; odata=verbose" },
                        cache: false,
                        success: function (xData) {
                            if (xData) {
                                var userData = xData;
                                if (userData.d) {
                                    ////Gets the title and account name user profile properties
                                    careerTitle = userData.d.GetUserProfilePropertyFor;
                                    userName = encodeURIComponent(userName);
                                    pictureUrl = "/" + _spPageContextInfo.layoutsUrl + "/userphoto.aspx?size=L&accountname=" + userName;
                                } else {
                                    Bah.logging.error('User ' + userName + ' cannot be found in the User Profile Service Application', 'fcLeaderInfo');
                                }

                                ////Adds the leader info to the view model.
                                viewModel.fullName = userContactName;
                                viewModel.careerTitle = careerTitle;
                                viewModel.pictureUrl = pictureUrl;
                                viewModel.profileUrl = viewUrl + "?user=" + userName;
                            }
                        },
                        error: function (requestObject, error, errorThrown) {
                            viewModel.pictureUrl = pictureUrl;
                            Bah.logging.error(errorThrown, 'fcLeaderInfo');
                        }
                    }));
                } else {
                    ////Adds the leader info to the view model.
                    viewModel.fullName = 'No contact was found';
                    viewModel.pictureUrl = pictureUrl;
                }

                ////When all the 3 ajax search queries finish runs handlebars and inits some plugins.
                $.when.apply($, promises).then(function (data1, data2, data3) {
                    $('#fcLeaderInfoPhoto').attr('src', viewModel.pictureUrl);
                    $('#fcLeaderCareerTitle').text(viewModel.careerTitle);
                    $('#fcLeaderProfileUrl').attr('href', viewModel.profileUrl);
                    $('#fcLeaderProfileUrl').text(viewModel.fullName);                    
                });
                
            }), Function.createDelegate(this, function (sender, args) { Bah.logging.error('Error trying to retrieve the contact page information.', this.name); }));
        },

        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);
///#source 1 1 Widgets/FunctionalCommunity/fcLeadership.js
var Widgets = Widgets || {};

(function ($) {
    Widgets.fcLeadership = {
        name: 'Leadership',

        load: function (options) {
            var self = this;
            self.options = options;

            var promises = [];
            var viewModel = {
                leaders: []
            };

            var listTitle = "Leadership";
            var clientContext = SP.ClientContext.get_current();
            
            var web = clientContext.get_web();
            var leadershipList = web.get_lists().getByTitle(listTitle);
            var query = new SP.CamlQuery();
            var items = leadershipList.getItems(query);
            var users = web.get_siteUsers();

            //Gets the ViewProfileUrl custom property from the User Profile term set
            var userTermSetName = Bah.Constants.Name.UserProfileTermSet;
            var locale = 1033; //English
            var taxonomySession = SP.Taxonomy.TaxonomySession.getTaxonomySession(clientContext);
            var termStore = taxonomySession.getDefaultSiteCollectionTermStore();
            var userTermSets = termStore.getTermSetsByName(userTermSetName, locale);
            var userTermSet = userTermSets.getByName(userTermSetName);

            clientContext.load(items);
            clientContext.load(users);
            clientContext.load(userTermSet);

            clientContext.executeQueryAsync(Function.createDelegate(this, function () {
                ////Gets the view profile url from the term set custom property
                var viewUrl = Bah.getViewProfileUrlProperty(userTermSet);
                var itemsCount = items.get_count();
                for (i = 0; i < itemsCount; i++) {
                    var item = items.itemAt(i);
                    var leaderLevel = item.get_item('BAH_FCLeaderLevel');
                    var leaderInfo = item.get_item('BAH_Leader');
                    var level = leaderLevel != undefined ? leaderLevel.get_label() : "";
                    var leader = leaderInfo != undefined ? leaderInfo.get_lookupValue() : "";
                    var userId = leaderInfo != undefined ? leaderInfo.get_lookupId() : "";
                    var group = '';
                    var title = '';
                    var profileUrl = '';
                    var userLogin = '';

                    for (var j = 0; j < users.get_count() ; j++) {
                        var user = users.getItemAtIndex(j);
                        if (user.get_id() === userId) {
                            userLogin = user.get_loginName();
                            break;
                        }
                    }

                    if (userLogin != '') {
                        userLogin = userLogin.substring(userLogin.indexOf('i:0#.f'));
                        var userQueryUrl = "/_api/SP.UserProfiles.PeopleManager/getpropertiesfor(@v)?@v='" + encodeURIComponent(userLogin) + "'";

                        ////Queries the sponsor user profile
                        promises.push($.ajax({
                            async: false,
                            url: userQueryUrl,
                            type: "GET",
                            headers: { "Accept": "application/json; odata=verbose" },
                            cache: false,
                            success: function (xData) {
                                if (xData) {
                                    var userData = xData;
                                    if (userData && userData.d.UserProfileProperties) {
                                        var properties = lazy(userData.d.UserProfileProperties.results);
                                        ////Gets the group user profile property
                                        group = properties.find(function (x) { return x.Key == "BAHGroup" }).Value;
                                        title = properties.find(function (x) { return x.Key == "SPS-JobTitle" }).Value;
                                        profileUrl = viewUrl + "?user=" + encodeURIComponent(userLogin);

                                        ////Adds the leader to the view model with group info.
                                        viewModel.leaders.push({ level: level, leader: leader, group: group, title: title, profileUrl: profileUrl });
                                    }
                                }
                            }
                        }));
                    } else {
                        ////Adds the leader to the view model without group info.
                        viewModel.leaders.push({ level: level, leader: leader, group: group, title: title });
                    }

                }

                ////When all the 3 ajax search queries finish runs handlebars and inits some plugins.
                $.when.apply($, promises).then(function (data1, data2, data3) {
                    var template = Handlebars.compile($('#fcLeadershipTemplate').html());
                    var html = template(viewModel);
                    $(self.container).html(html);
                });

            }), Function.createDelegate(this, function (sender, args) { Bah.logging.error('Error trying to retrieve Leadership information.', this.name); }));
        },

        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);
///#source 1 1 Widgets/FunctionalCommunity/fcLandingLinks.js
var Widgets = Widgets || {};
(function ($) {
	Widgets.fcLandingLinks = {
		name: "FC Landing Links",
		fetch: function () {
		},

		parse: function (result) {
		    var isInnerPage = $(this.container).data('inner-page').toString().toLowerCase() === "true" ? true : false;
		    var fcValue = $('#functionalCommunityValue span').text();
		    var viewModel = {
		        links: [],
		        innerPage: isInnerPage
		    };

		    var leadershipPageUrl = _spPageContextInfo.webAbsoluteUrl + "/Pages/Leadership.aspx";
		    ////Gets the current page Functional Community so it can be added to the search results page query string parameter.
		    var pageCommunity = fcValue !== undefined ? fcValue : '';
		    if (pageCommunity !== '') {
		        pageCommunity = "?k=BAHFunctionalCommunities:'" + encodeURIComponent(pageCommunity) + "'";
		    }

		    var newsSearchPageUrl = Bah.configuration.newsSearchResultsPageUrl + pageCommunity;
		    var eventsSearchPageUrl = Bah.configuration.eventsSearchResultsPageUrl + pageCommunity;
		    var filesSearchPageUrl = Bah.configuration.filesSearchResultsPageUrl + pageCommunity;

		    viewModel.links.push({ title: "News", url: newsSearchPageUrl, isForInnerPageOnly: false });
		    viewModel.links.push({ title: "Events", url: eventsSearchPageUrl, isForInnerPageOnly: false });
		    viewModel.links.push({ title: "Intellectual Capital", url: filesSearchPageUrl, isForInnerPageOnly: false });
		    viewModel.links.push({ title: "Leadership", url: leadershipPageUrl, isForInnerPageOnly: true });

		    return viewModel;
		},

		bind: function (template, data) {
			var template = Handlebars.compile(template);
			var html = template(data);

			return html;
		},

		render: function (data) {
			$(this.container).html(data);			
		},

		fail: function (error, event) {
			Bah.logging.error('Error at ' + event, this.name);
		},

		template: function () {
			return $("#fcLandingLinksTemplate").html();
		}
	};
})(jQuery);
///#source 1 1 Widgets/FunctionalCommunity/fcICPillars.js
var Widgets = Widgets || {};

(function ($) {
	Widgets.fcICPillars = {
		name: 'FC IC Pillars',
		load: function (options) {
			var self = this;
			self.options = options;

			var groupedTypes = [];
			var viewModel = {
				types: [],
				customerICTypes: [],
				businessICTypes: [],
				agreementICTypes: [],
				links: [],
				customerLinks: [],
				businessLinks: [],
				agreementLinks: [],
				resultsPageUrl: ''
			};

			var termSetName = 'Voices';
			var listTitle = "FC Pillars Links";
			var locale = 1033; //English
			var clientContext = SP.ClientContext.get_current();
			var web = clientContext.get_web();
			////Gets the Pillars links list.
			var pillarsLinksList = web.get_lists().getByTitle(listTitle);
			var query = new SP.CamlQuery();
			var items = pillarsLinksList.getItems(query);
			////Gets the current page list item.
			var currentList = web.get_lists().getById(_spPageContextInfo.pageListId);
			var currentListItem = currentList.getItemById(_spPageContextInfo.pageItemId);
			var taxonomySession = SP.Taxonomy.TaxonomySession.getTaxonomySession(clientContext);
			var termStore = taxonomySession.getDefaultSiteCollectionTermStore();
			var termSets = termStore.getTermSetsByName(termSetName, locale);
			var termSet = termSets.getByName(termSetName);
			var terms = termSet.getAllTerms();
			clientContext.load(taxonomySession);
			clientContext.load(termStore);
			clientContext.load(termSet);
			clientContext.load(terms);
			clientContext.load(items);
			clientContext.load(currentListItem);
			////Calls the query async to get the Vocies term set and the configuration term set in order to extract the Search File Results page url.
			////It also queries the FC Pillars Links list. An API REST call could not be made to query the FCPillars Links list because of a know issue when querying Single Value Managed Metadata fields - Labels are returned as integers.
			clientContext.executeQueryAsync(Function.createDelegate(this, function () {
				var promises = [];
				var queryUrl = '';
				var labelCustomer = '';
				var labelBusiness = '';
				var labelProfessional = '';
				var position = { value: 1 };

				if (terms) {
					////Gets the current page Functional Community so it can be added to the search query filter.
					var pageFunctionalCommunity = currentListItem.get_item('BAH_FunctionalCommunity');
					var pageCommunity = pageFunctionalCommunity !== null ? pageFunctionalCommunity.get_label().trim() : '';
					////Iterates through the Voice terms and then makes a search filtering by content type and voice label.
					for (var i = 0; i < terms.get_count() ; i++) {
						var spTerm = terms.getItemAtIndex(i);
						var voice = spTerm.get_name();
						var id = spTerm.get_id().toString();
						////Sets the Voice label in order to filter and group the search results with the corresponding Voice name.
						if (voice.indexOf('Business') !== -1) {
							labelBusiness = voice;
						}
						if (voice.indexOf('Customer') !== -1) {
							labelCustomer = voice;
						}
						if (voice.indexOf('Professional ') !== -1) {
							labelProfessional = voice;
						}
						////Searches the Intellectual Documents and filters by the current Voice.
						queryUrl = "/_api/search/query?querytext='ContentType:\"Intellectual+Capital\"+BAHVoice:\"" + voice + "\"+BAHFunctionalCommunities:\"" + pageCommunity + "\"'&trimduplicates=false&selectproperties='Path%2cUrl%2cTitle%2cAuthor%2cBAHModifiedDate%2cBAHVoice%2cBAHICType'";
						promises.push(this.getIntellectualContent(queryUrl, voice, viewModel));
					}
				}
				////Iterates throught the FC Pillars Links list items and adds them to the view model.
				Widgets.fcICPillars.getPillarsLinks(items, viewModel);

				////Gets the search results page url for files from the Term Store
				var filesSearchPageUrl = "#";
				if (pageCommunity !== '') {
					pageCommunity = '?k=BAHFunctionalCommunities:' + encodeURIComponent(pageCommunity);
				}

				viewModel.resultsPageUrl = Bah.configuration.filesSearchResultsPageUrl;

				////When all the ajax search queries finish runs handlebars.
				$.when.apply($, promises).then(function (data1, data2, data3) {
					////Filters the documents search results by Voice, then groups by the IC Type and finally reorders the array so it can be properly displayed on the template.
					groupedTypes = Widgets.fcICPillars.filterByVoice(viewModel, labelCustomer, true);
					groupedTypes = lazy(groupedTypes).groupBy('typeName').toArray();
					viewModel.customerICTypes = Widgets.fcICPillars.setArrayForDisplay(groupedTypes, position);

					groupedTypes = Widgets.fcICPillars.filterByVoice(viewModel, labelBusiness, true);
					groupedTypes = lazy(groupedTypes).groupBy('typeName').toArray();
					viewModel.businessICTypes = Widgets.fcICPillars.setArrayForDisplay(groupedTypes, position);

					groupedTypes = Widgets.fcICPillars.filterByVoice(viewModel, labelProfessional, true);
					groupedTypes = lazy(groupedTypes).groupBy('typeName').toArray();
					viewModel.agreementICTypes = Widgets.fcICPillars.setArrayForDisplay(groupedTypes, position);

					////Filters the links by Voice.
					viewModel.customerLinks = Widgets.fcICPillars.filterByVoice(viewModel, labelCustomer, false);
					viewModel.businessLinks = Widgets.fcICPillars.filterByVoice(viewModel, labelBusiness, false);
					viewModel.agreementLinks = Widgets.fcICPillars.filterByVoice(viewModel, labelProfessional, false);

					var template = Handlebars.compile($('#fcICPillarsTemplate').html());
					var html = template(viewModel);
					$(self.container).html(html);

					$(document).foundation();

					$(document).on('click.collapse.data-api', '[data-toggle=collapse]', function (e) {
						var $this = $(this), href
                          , target = $this.attr('data-target')
                            || e.preventDefault()
                            || (href = $this.attr('href')) && href.replace(/.*(?=#[^\s]+$)/, '') //strip for ie7
                          , option = $(target).data('collapse') ? 'toggle' : $this.data()
						$this[$(target).hasClass('in') ? 'addClass' : 'removeClass']('collapsed')
						$(target).collapse(option)
					})

					$('[data-toggle]').on('click', function () {
						$(this).toggleClass('active');
					});
				});
			}), Function.createDelegate(this, function (sender, args) { Bah.logging.error('Error trying to retrieve the Voice term set.', this.name); }));
		},

		fail: function (error, event) {
			Bah.logging.error(event, this.name);
		},

		filterByVoice: function (viewModel, label, isResource) {
			if (isResource) {
				return lazy(viewModel.types).filter(function (x) {
					if (x.category === label)
						return x;
				}).toArray();
			} else {
				return lazy(viewModel.links).filter(function (x) {
					if (x.category === label)
						return x;
				}).toArray();
			}
		},

		setArrayForDisplay: function (arrayObj, position) {
			var resources = [];

			for (var i = 0; i < arrayObj.length; i++) {
				var icTypeName = arrayObj[i][0];
				var icTypeDocs = arrayObj[i][1];
				position.value++;

				var resource = {
					typeName: icTypeName,
					index: position.value,
					items: []
				};

				for (var j = 0; j < icTypeDocs.length; j++) {
					var icTypeDoc = icTypeDocs[j];
					var item = {
						title: icTypeDoc.resources.title,
						date: icTypeDoc.resources.date,
						url: icTypeDoc.resources.url
					};

					resource.items.push(item);
				}

				resource.items = lazy(resource.items).sortBy('title').toArray();
				resources.push(resource);
				resources = lazy(resources).sortBy('typeName').toArray();
			}

			return resources;
		},

		getIntellectualContent: function (queryUrl, category, viewModel) {
			return $.ajax({
				async: true,
				url: queryUrl,
				type: 'GET',
				headers: { 'Accept': 'application/json; odata=verbose' },
				cache: false,
				success: function (data) {
					if (data.d) {
						var results = data.d.query.PrimaryQueryResult.RelevantResults.Table.Rows.results;

						////Iterates through the results and creates the item view model.
						$.each(results, function (index, result) {
							var resultsRow = result.Cells.results;
							var typeName = Bah.getResultValueByKey('BAHICType', resultsRow) !== '' ? Bah.getResultValueByKey('BAHICType', resultsRow) : 'No IC Type';
							var indexOfParenthood = typeName.indexOf(':');

							if (indexOfParenthood !== -1) {
								typeName = typeName.substring(0, indexOfParenthood);
							}

							var item = {
								title: Bah.getResultValueByKey('Title', resultsRow),
								date: $.format.date(new Date(Bah.getResultValueByKey('BAHModifiedDate', resultsRow)), 'MM/dd/yy'),
								url: Bah.getResultValueByKey('Path', resultsRow),
								resourceType: typeName
							}

							viewModel.types.push({ typeName: typeName, category: category, resources: item });
						});
					}
				},
				error: function (requestObject, error, errorThrown) {
					Bah.logging.error(errorThrown, 'fclCPillars');
				}
			});
		},

		getPillarsLinks: function (items, viewModel) {
			var itemsCount = items.get_count();
			for (i = 0; i < itemsCount; i++) {
				var item = items.itemAt(i);
				var itemUrl = item.get_item('URL');

				var title = itemUrl != undefined ? itemUrl.get_description() : "";
				var url = itemUrl != undefined ? itemUrl.get_url() : "";
				var voice = item.get_item('BAH_Voice') != undefined ? item.get_item('BAH_Voice').get_label() : "";

				viewModel.links.push({ title: title, url: url, category: voice });
			}
		}
	};
})(jQuery);
///#source 1 1 Widgets/FunctionalCommunity/fcContentPageIcon.js
var Widgets = Widgets || {};
(function ($) {
    Widgets.fcContentPageIcon = {
        name: "FC Content Page Icon",
        load: function () {
            var clientContext = SP.ClientContext.get_current();
            var web = clientContext.get_web();
            var rootFolder = web.get_rootFolder();
            clientContext.load(web);
            clientContext.load(rootFolder, 'WelcomePage');
            clientContext.executeQueryAsync(Function.createDelegate(this,
                 function () {
                     var url = "";
                     var homePage = rootFolder.get_welcomePage();
                     var file = web.getFileByServerRelativeUrl(_spPageContextInfo.webServerRelativeUrl + "/" + homePage);
                     
                     clientContext.load(file, 'ListItemAllFields');
                     clientContext.executeQueryAsync(Function.createDelegate(this,
                         function () {
                             var currentListItem = file.get_listItemAllFields();

                             if (currentListItem !== undefined) {
                                 url = currentListItem.get_item('BAH_FCIcon') !== null ? $(currentListItem.get_item('BAH_FCIcon')).attr('src') : '';
                             }

                             if (url !== '') {
                                 $(this.container).attr("src", url)
                             }
                             Bah.logging.log(url, this.name);
                         }
                        ), Function.createDelegate(this, function (sender, args) {
                            Bah.logging.error("Could not load FC Icon from FC Home Page", this.name);
                        }
                    ));

                     
                 }
                ), Function.createDelegate(this, function (sender, args) {
                    Bah.logging.error("Could not load Welcome Page from functional community site", this.name);
                }
            ));
        }
    };
})(jQuery);
///#source 1 1 Custom/bah.js
var Bah = Bah || {};
var nameCtrl = null;

(function ($)
{
    //Document Ready Event Handler
    $(function ()
    {
        $("#handlebarsTemplates").load(_spPageContextInfo.siteAbsoluteUrl + "/../../Style%20Library/BAH/Templates/bah-bundle.html", function ()
        {
            $.when(Bah.configuration.loadProperties()).done(function ()
            {
                Widget.loadAll();
            });
        });

        ////Foundation init.
        $(document).foundation({
            offcanvas: {
                open_method: 'overlap'
            }
        });

        ////Handlebars custom helpers.
        Handlebars.registerHelper('ifNotEqual', function (v1, v2, options)
        {
            if (v1 != v2)
            {
                return options.fn(this);
            }
            return options.inverse(this);
        });
        Handlebars.registerHelper('ifEqual', function (v1, v2, options)
        {
            if (v1 == v2)
            {
                return options.fn(this);
            }
            return options.inverse(this);
        });
        Handlebars.registerHelper('everyNth', function (context, every, options)
        {
            var fn = options.fn, inverse = options.inverse;
            var ret = "";
            if (context && context.length > 0)
            {
                for (var i = 0, j = context.length; i < j; i++)
                {
                    var modZero = i % every === 0;
                    ret = ret + fn($.extend({}, context[i], {
                        isModZero: modZero,
                        isModZeroNotFirst: modZero && i > 0,
                        isLast: i === context.length - 1
                    }));
                }
            } else
            {
                ret = inverse(this);
            }
            return ret;
        });
        Handlebars.registerHelper('more5', function (context, options)
        {
            if (context.length > 5)
            {
                return options.fn(this);
            }
        });
        Handlebars.registerHelper("checkedIf", function (condition)
        {
            return (condition) ? "checked" : "";
        });
        Handlebars.registerHelper("selectedIf", function (condition)
        {
            return (condition) ? "selected" : "";
        });
        Handlebars.registerHelper("formatDate", function (date)
        {
            var date2 = new Date(date);
            if (typeof (date2) == "undefined" || date2 == "Invalid Date")
            {
                return "";
            }

            return (date2.getMonth() + 1) + "/" + date2.getDate() + "/" + date2.getFullYear();
        });
        Handlebars.registerHelper('ifCond', function (v1, operator, v2, options)
        {
            switch (operator)
            {
                case '==':
                    return (v1 == v2) ? options.fn(this) : options.inverse(this);
                case '===':
                    return (v1 === v2) ? options.fn(this) : options.inverse(this);
                case '!=':
                    return (v1 != v2) ? options.fn(this) : options.inverse(this);
                case '!==':
                    return (v1 !== v2) ? options.fn(this) : options.inverse(this);
                case '<':
                    return (v1 < v2) ? options.fn(this) : options.inverse(this);
                case '<=':
                    return (v1 <= v2) ? options.fn(this) : options.inverse(this);
                case '>':
                    return (v1 > v2) ? options.fn(this) : options.inverse(this);
                case '>=':
                    return (v1 >= v2) ? options.fn(this) : options.inverse(this);
                case '&&':
                    return (v1 && v2) ? options.fn(this) : options.inverse(this);
                case '||':
                    return (v1 || v2) ? options.fn(this) : options.inverse(this);
                default:
                    return options.inverse(this);
            }
        });

        //Field-Value - Hide Field having Label when it has not value
        // The Replace call below removes zero-width white space '&#8203;'
        $('*[data-fh-parent]').each(function ()
        {
            var $parent = $(this);
            var isEmpty = $.makeArray($parent.find('*[data-fh-content]')).reduce(function (previousValue, currentValue)
            {
                return previousValue && ($(currentValue).text().replace(/[\u200B-\u200D\uFEFF]/g, '').trim().length === 0);
            }, true);
            if (isEmpty)
            {
                $parent.attr("style", "display: none !important");
            }
        });

        //Date-Time handling
        $('*[data-date]').each(function ()
        {
            var $this = $(this);
            var strDate = Bah.alwaysString($this.data('date'));
            var prefix = Bah.alwaysString($this.data('prefix')) + ' ';

            var date = new Date(strDate);
            if (isNaN(date.getTime()))
            {
                //invalid date string, set original string
                $this.text(prefix + strDate);
            } else
            {
                //correct date, parse it
                $this.html(prefix + ' ' + $.format.date(date, "hh:mm a '&nbsp;&nbsp;&nbsp;&nbsp;' E MMMM dd, yyyy"));
            }

            $this.show();
        });



        //Collapse no-desktop case
        $(document).on('click.collapse-nd', '*[data-no-desktop="true"]', function ()
        {
            var $accordBtn = $(this);
            var $accordTarget = $accordBtn.parent().find($accordBtn.data('target'));

            if ($(window).width() >= 1024)
            {
                //We are in desktop mode, reset plugin before destroying it
                $accordTarget.collapse('reset');
                $accordTarget.data('collapse', null);
                //Restore classes to their original state
                $accordBtn.removeClass('active').removeClass('collapsed');
                $accordTarget.removeClass('in').attr('style', '');
            }
        });

        /* $(".accord-btn").each(function () {
            var $accordBtn = $(this);
            var $accordTarget = $accordBtn.parent().find($accordBtn.data('target'));

            if ($(window).width() >= 1024) {
                //We are in desktop mode, reset plugin before destroying it
                //$accordTarget.collapse('reset');
                //$accordTarget.data('collapse', null);
                //Restore classes to their original state
                //$accordBtn.removeClass('active').removeClass('collapsed');
                //$accordTarget.removeClass('in').attr('style', '');

            }
        });
        */

        // Close search dropdown when clicking outside
        $(document).click(function (e)
        {
            if (!$(e.target).parents().is('.accordionButton1') && !$(e.target).is('.accordionButton1') && !$(e.target).parents().is('.accordionContent1') && !$(e.target).is('.accordionContent1'))
            {
                if ($('.accordionContent1').is(":visible"))
                {
                    $('.accordionButton1').removeClass('active');
                    $('.accordionContent1').hide()
                }
            }
        });

        ////Selects the anchor in News Article Page and sets the href attribute to the View Profile Url
        ////data-view-profile was removed from selector because it was not pointing to the right anchor
        var $viewProfiles = $('a.ms-subtleLink');
        if ($viewProfiles.length > 0)
        {
            $viewProfiles.hide();
            Bah.getViewProfileLink().done(function (link)
            {
                $viewProfiles.attr('href', link).removeAttr('onclick');
            }).always(function ()
            {
                $viewProfiles.show();
            });
        }

        try
        {
            if (window.ActiveXObject !== undefined)
            {
                nameCtrl = new ActiveXObject("Name.NameCtrl.1");
            } else
            {
                nameCtrl = CreateNPApiOnWindowsPlugin("application/x-sharepoint-uc");
            }
        } catch (ex)
        {
            Bah.logging.error('There was an error trying to load the NameCtrl Active X Object.');
        }
    });

    ////iPad iPhone back navigation fix.
    window.onpageshow = function (event)
    {
        if (event.persisted)
        {
            window.location.reload();
        }
    };

    //Useful Constants
    Bah.Constants = {
        Guid: {
            InfoCatTermSet: '794300FE-9A7A-4542-A660-7510D9F05450',
            ConfigurationTermSet: 'CF74DF95-49C3-49C1-B54D-115ADBB9D70D',
            HelpPageCategoryTermSet: 'E76CCAA5-6445-484F-AA03-F7335910694A',
            FeedbackCategoryTermSet: 'F953F18B-A4E8-48E9-A90F-641C400F5E30',
            UserProfileDropdownTermSet: 'CDF8AC14-916F-48C5-A971-1487EE9C2B1C',
            BahIntranetTermGroup: 'CD0AA545-5E84-4656-B7B4-B80A0F041077',
            StreamTermSet: '36b1a08e-7333-4d72-a26c-c22b8179e445',
            PeopleModelTermSet: 'd90c40e3-1128-4bb8-9fbe-93dd4d317bf3'
        },
        ContentType: {
            TeamSitePage: '0x010100C568DB52D9D0A14D9B2FDCC96666E9F2007948130EC3DB064584E219954237AF390064DEA0F50FC8C147B0B6EA0636C4A7D400E9BADA3A1B2F4196AE8C3A2BABB3DE5F*',
            HelpPage: '0x010100C568DB52D9D0A14D9B2FDCC96666E9F2007948130EC3DB064584E219954237AF3900242457EFB8B24247815D688C526CD44D004D1F04517BBE43CABB63C35354E962B7*'
        },
        Name: {
            UserProfileTermSet: 'User Profile Dropdown'
        }
    };

    Bah.convert2Tree = function (array, parent, tree)
    {
        tree = typeof tree !== 'undefined' ? tree : [];
        parent = typeof parent !== 'undefined' ? parent : { id: 0 };
        var children = lazy(array).filter(function (x) { return x.parentid == parent.id });
        if (!children.isEmpty())
        {
            if (parent.id == 0)
            {
                tree = children.toArray();
            } else
            {
                parent['children'] = children.toArray();
                parent['hasChildren'] = true;
            }
            children.each(function (x) { Bah.convert2Tree(array, x) });
        }
        return tree;
    };

    Bah.getRecurrenceQueryForEvents = function (listGuid)
    {
        var dataCall =
            "<soap:Envelope xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xmlns:xsd='http://www.w3.org/2001/XMLSchema' xmlns:soap='http://schemas.xmlsoap.org/soap/envelope/'> <soap:Body>" +
            "<GetListItems xmlns='http://schemas.microsoft.com/sharepoint/soap/'>" +
            "<listName>" + listGuid + "</listName>" +
            "<query>" +
            "<Query>" +
            "<Where>" +
                "<DateRangesOverlap>" +
                "<FieldRef Name=\"EventDate\" />" +
                "<FieldRef Name=\"EndDate\" />" +
                "<FieldRef Name=\"RecurrenceID\" />" +
                "<Value Type=\"DateTime\" IncludeTimeValue=\"TRUE\"><Now/></Value>" +
                "</DateRangesOverlap>" +
            "</Where>" +
            "</Query>" +
            "</query>" +
            "<viewFields><ViewFields xmlns=\"\">" +
                        "<FieldRef Name=\"UniqueId\" />" +
                        "<FieldRef Name=\"Title\" />" +
                        "<FieldRef Name=\"Description\" />" +
                        "<FieldRef Name=\"BAH_Location\" />" +
                        "<FieldRef Name=\"EventDate\" />" +
                        "<FieldRef Name=\"fRecurrence\" />" +
                        "<FieldRef Name=\"EndDate\" />" +
                        "</ViewFields>" +
                    " </viewFields>" +
            "<queryOptions>" +
            "<QueryOptions>" +
                "<ExpandRecurrence>TRUE</ExpandRecurrence>" +
            "</QueryOptions>" +
            "</queryOptions>" +
            "</GetListItems>" +
            "</soap:Body></soap:Envelope>";

        return dataCall;
    };

    Bah.getRecurrenceQueryForLocalEvents = function (listGuid, location)
    {
        var dataCall =
            "<soap:Envelope xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xmlns:xsd='http://www.w3.org/2001/XMLSchema' xmlns:soap='http://schemas.xmlsoap.org/soap/envelope/'> <soap:Body>" +
            "<GetListItems xmlns='http://schemas.microsoft.com/sharepoint/soap/'>" +
            "<listName>" + listGuid + "</listName>" +
            "<query>" +
            "<Query>" +
            "<Where>" +
                "<Eq><FieldRef Name=\"BAH_Location\" />" +
                "<Value Type=\"TaxonomyFieldType\">" + location + "</Value>" +
                "</Eq>" +
            "</Where>" +
            "<RowLimit>2</RowLimit>" +
            "<OrderBy>" +
            "<FieldRef Name=\"EventDate\" Ascending=\"True\" />" +
            "</OrderBy>" +
            "</Query>" +
            "</query>" +
            "<queryOptions>" +
            "<QueryOptions>" +
                "<ExpandRecurrence>TRUE</ExpandRecurrence>" +
                "<RowLimit>2</RowLimit>" +
            "</QueryOptions>" +
            "</queryOptions>" +
            "</GetListItems>" +
            "</soap:Body></soap:Envelope>";

        return dataCall;
    };
    Bah.isMobile = {
        Android: function ()
        {
            return navigator.userAgent.match(/Android/i);
        },
        BlackBerry: function ()
        {
            return navigator.userAgent.match(/BlackBerry/i);
        },
        iOS: function ()
        {
            return navigator.userAgent.match(/iPhone|iPad|iPod/i);
        },
        Opera: function ()
        {
            return navigator.userAgent.match(/Opera Mini/i);
        },
        Windows: function ()
        {
            return navigator.userAgent.match(/IEMobile/i);
        },
        any: function ()
        {
            return (Bah.isMobile.Android() || Bah.isMobile.BlackBerry() || Bah.isMobile.iOS() || Bah.isMobile.Opera() || Bah.isMobile.Windows());
        }
    };

    // Returns a truncated string with an ellipsis at the end if the string length exceeds the characterLimit. Otherwise, returns the original string.
    Bah.setEllipsis = function (text, characterLimit)
    {
        try
        {
            if (text.length > characterLimit)
            {
                text = text.substring(0, characterLimit);
                // start at end of text, find space, truncate text at that point and add ellipsis
                for (var i = characterLimit - 1; i > -1; i--)
                {
                    if (text.charAt(i) === ' ' || text.charAt(i) === '-')
                    {
                        text = text.substring(0, i) + '...';
                        break; // found the last word, exit loop
                    }
                }
            }
        }
        catch (exception) { };
        return text;
    };

    // Returns true if the fullString contains the comparisonString, otherwise returns false.
    // The matchCase boolean is optional and will return true if the fullString contains the comparisonString and matches case.
    Bah.czStringContains = function (fullString, comparisonString, matchCase)
    {
        try
        {
            var fstr = String(fullString);
            var cstr = String(comparisonString);

            if (matchCase) return fstr.indexOf(cstr) > -1 ? true : false;
            else return fstr.toLowerCase().indexOf(cstr.toLowerCase()) > -1 ? true : false;
        }
        catch (exception) { return false; }
    }

    // Returns true if the fullString ends with the comparisonString, otherwise returns false.
    // The matchCase boolean is optional and will return true if the fullString ends with the comparisonString and matches case.
    Bah.czStringEndsWith = function (fullString, comparisonString, matchCase)
    {
        try
        {
            var fstr = String(fullString);
            var cstr = String(comparisonString);
            var len = cstr.length;

            if (matchCase) return fstr.substr(fstr.length - len, len) === cstr ? true : false;
            else return fstr.substr(fstr.length - len).toLowerCase() === cstr.toLowerCase() ? true : false;
        }
        catch (exception) { return false; }
    }

    // Returns true if the fullString starts with the comparisonString, otherwise returns false.
    // The matchCase boolean is optional and will return true if the fullString starts with the comparisonString and matches case.
    Bah.czStringStartsWith = function (fullString, comparisonString, matchCase)
    {
        try
        {
            var fstr = String(fullString);
            var cstr = String(comparisonString);
            var len = cstr.length;

            if (matchCase) return fstr.substring(0, len) === cstr ? true : false;
            else return fstr.substring(0, len).toLowerCase() === cstr.toLowerCase() ? true : false;
        }
        catch (exception) { return false; }
    }

    // Function for getting the display name for a widget section title - needed due to the possibility of multiple pages in the Widget.peopleHeader.data.page array
    Bah.getSectionTitle = function (WidgetPeopleHeaderData, BAHSectionTitle)
    {
        var pageTitle = WidgetPeopleHeaderData.headerData['name'];
        var pages = WidgetPeopleHeaderData.page;
        var x;
        var title = '';

        for (x in pages)
        {
            if (pages[x]['Title'] == pageTitle)
            {
                title = WidgetPeopleHeaderData.page[x][BAHSectionTitle];
                break;
            }
        }

        return title;
    }

    Bah.getResultValueByKey = function (fieldName, arr)
    {
        var v = '';
        $.each(arr, function (index, item)
        {
            if (item.Key == fieldName)
            {
                v = item.Value;
                return (false);
            }
        });
        return v;
    };

    Bah.isNullOrEmpty = function (value)
    {
        if (value && value.toString().length > 0)
            return false;
        return true;
    };

    Bah.getCommunitiesData = function (resultsRow, order, careerTitle, profileUrl)
    {
        return item = {
            title: Bah.getResultValueByKey('Title', resultsRow),
            path: Bah.getResultValueByKey('Path', resultsRow),
            iconUrl: $(Bah.getResultValueByKey('BAHFCIcon', resultsRow)).attr('src'),
            sponsorName: Bah.getResultValueByKey('BAHFCSponsor', resultsRow),
            careerTitle: careerTitle,
            order: order,
            functionalCommunity: Bah.getResultValueByKey('BAHFunctionalCommunity', resultsRow),
            profileUrl: profileUrl
        };
    };


    Bah.getUsersWithProfileProperties = function (results, properties)
    {
        var deferred = $.Deferred();
        ////Gets account names
        var users = lazy(results).map(function (x)
        {
            var resultsRow = x.Cells.results;
            var sponsorData = Bah.getResultValueByKey('BAHFCSponsorOWSUser', resultsRow).toString();
            if (sponsorData != '')
            {
                return sponsorData.substring(sponsorData.indexOf('i:0#.f'));
            }
        }).without(undefined).uniq().map(function (y) { return { accountName: y, userProfileProperties: [] }; }).toArray();

        // Ensure that the SP.UserProfiles.js file is loaded before the custom code runs.
        SP.SOD.executeOrDelayUntilScriptLoaded(function ()
        {
            // Get the current client context.
            var clientContext = new SP.ClientContext.get_current();
            //Get PeopleManager Instance
            var peopleManager = new SP.UserProfiles.PeopleManager(clientContext);
            $.each(users, function (index, user)
            {
                var userProfilePropertiesForUser = new SP.UserProfiles.UserProfilePropertiesForUser(clientContext, user.accountName, properties);
                user.userProfileProperties = peopleManager.getUserProfilePropertiesFor(userProfilePropertiesForUser);
                clientContext.load(userProfilePropertiesForUser)
            });
            clientContext.executeQueryAsync(
                    Function.createDelegate(this,
                        function ()
                        {
                            deferred.resolve(users);
                        }),
                    Function.createDelegate(this,
                        function (sender, args) { deferred.reject(sender, args); }));
        }, 'SP.UserProfiles.js');
        return deferred.promise();
    };






    Bah.getMyFunctionalCommunities = function (queryUrl, order, viewModel)
    {
        var deferred = $.Deferred();
        $.ajax({
            async: true,
            url: queryUrl,
            type: 'GET',
            headers: { 'Accept': 'application/json; odata=verbose' },
            cache: false,
            success: function (data)
            {
                if (data.d != undefined)
                {
                    var results = data.d.query.PrimaryQueryResult.RelevantResults.Table.Rows.results;
                    ////Gets the view profile url from the user profile term set custom property
                    var viewUrl = Bah.getViewProfileUrlProperty();

                    $.when(Bah.getUsersWithProfileProperties(results, ["SPS-JobTitle"])).then(function (data)
                    {
                        ////Iterates through the results and creates the item view model.
                        $.each(results, function (index, result)
                        {
                            var resultsRow = result.Cells.results;
                            ////Gets the sponsor information to query the user profile
                            var sponsorData = Bah.getResultValueByKey('BAHFCSponsorOWSUser', resultsRow).toString();
                            var sponsorTitle = '';
                            var profileUrl = '';

                            if (sponsorData != '')
                            {
                                var userName = sponsorData.substring(sponsorData.indexOf('i:0#.f'));
                                profileUrl = viewUrl + "?user=" + encodeURIComponent(userName);
                                var careerTitle = lazy(data).find(function (x) { return x.accountName == userName; }).userProfileProperties[0];
                                ////Adds the community to the view model with sponsor career title.
                                viewModel.communities.push(Bah.getCommunitiesData(resultsRow, order, careerTitle, profileUrl));
                            }
                            else
                            {
                                ////Adds the community to the view model without sponsor career title.
                                viewModel.communities.push(Bah.getCommunitiesData(resultsRow, order, ''));
                            }
                        });
                        ////If there are more than four functional communities, show View All link
                        if (results.length > 4)
                        {
                            viewModel.viewAllUrl = Bah.configuration.functionalCommunitiesSiteCollectionUrl;
                        }
                        deferred.resolve(viewModel);
                    });
                }
            }
        });
        return deferred.promise();
    };

    Bah.showInfoCatInSearchResult = function (id, path)
    {
        var filteringProperties = ['BAHInfoCatTaxId', 'BAHTeamSiteSponsorOWSUSER', 'SPWebUrl', 'Title'];
        $.when(Bah.getSite(filteringProperties, path), Bah.getAllTermsFromTermSet(Bah.Constants.Guid.InfoCatTermSet)).then(
            function (data, infoCatTerms)
            {
                //create Term id Map
                var termsMap = {};
                var termEnumerator = infoCatTerms.getEnumerator();
                while (termEnumerator.moveNext())
                {
                    var term = termEnumerator.get_current();
                    termsMap[term.get_id().toString()] = term;
                }
                //create existance map for filteringProperties
                var filteringPropertiesContains = lazy(filteringProperties).reduce(function (x, y)
                {
                    var o = {}; o[y] = true;
                    return x.merge(o);
                }, lazy({})).toObject();
                var rowReturn = {};
                lazy(data.Cells.results).filter(function (field)
                {
                    return filteringPropertiesContains[field.Key]; //boosted
                }).first(filteringProperties.length).each(function (field)
                {
                    rowReturn[field.Key] = field.Value;
                });
                var termId = Bah.getTermIdFromManagedMetadataId(rowReturn[filteringProperties[0]]);
                var term = termsMap[termId];
                var tileColor = term === undefined ? term : term.get_customProperties()['Color'];
                var infoCatTitle = term === undefined ? term : term.get_name();
                if (infoCatTitle)
                {
                    var div = $('#' + id + "_item").find('.infoCatDiv');
                    div.find('.txt').attr('title', infoCatTitle);
                    div.find('.txt').css('background', tileColor)
                    div.find('.txt').text(infoCatTitle[0].toUpperCase());
                    div.show();
                }
            });
    };

    Bah.getTeams = function (filteringProperties, rowLimit, sortProperty, favoriteTeamSites)
    {
        var secondarySortOrder = "";
        var sortOrder = "ascending";
        if (sortProperty == "created")
            sortOrder = "descending";
        if (sortProperty != "bahsitename")
            secondarySortOrder = ",bahsitename:ascending";
        if (favoriteTeamSites != "")
            favoriteTeamSites = '+' + favoriteTeamSites;
        return $.ajax({
            async: true,
            url: "/_api/search/query?querytext='ContentTypeId:" + Bah.Constants.ContentType.TeamSitePage + favoriteTeamSites +
                "'&rowlimit=" + rowLimit +
                "&selectproperties='" + filteringProperties.join(',') +
                "'&sortlist='" + sortProperty + ":" + sortOrder + secondarySortOrder + "'&trimduplicates=false",
            type: "GET",
            headers: {
                "Accept": "application/json; odata=verbose"
            },
            cache: false
        }).then(function (data)
        {
            return data;
        });
    };

    Bah.getSite = function (filteringProperties, path)
    {
        return $.ajax({
            async: true,
            url: "/_api/search/query?querytext='Path=\"" + path + "\"'&selectproperties='" + filteringProperties.join(',') +
                    "'&sortlist='Created:descending'&trimduplicates=false",
            type: "GET",
            headers: { "Accept": "application/json; odata=verbose" },
            cache: false
        }).then(function (data)
        {
            if (data.d !== undefined)
            {
                return data.d.query.PrimaryQueryResult.RelevantResults.Table.Rows.results[0];
            }
            return [];
        });
    };

    Bah.getAllTermsFromTermSet = function (termSetGuid)
    {
        var deferred = $.Deferred();

        //get Taxonomy Value
        var clientContext = SP.ClientContext.get_current();
        var session = SP.Taxonomy.TaxonomySession.getTaxonomySession(clientContext);
        var termStore = session.getDefaultSiteCollectionTermStore();
        var termSet = termStore.getTermSet(termSetGuid);
        var terms = termSet.getAllTerms();

        //load all terms in this termset
        clientContext.load(terms);

        clientContext.executeQueryAsync(function (sender, args)
        {
            deferred.resolve(terms);
        }, function (sender, args)
        {
            deferred.reject("JSOM Get All Terms from Term Set Failed: " + args.get_message());
        });

        return deferred.promise();
    };

    Bah.getTermSet = function (termSetGuid)
    {
        var deferred = $.Deferred();

        //get Taxonomy Value
        var clientContext = SP.ClientContext.get_current();
        var session = SP.Taxonomy.TaxonomySession.getTaxonomySession(clientContext);
        var termStore = session.getDefaultSiteCollectionTermStore();
        var termSet = termStore.getTermSet(termSetGuid);

        //load all terms in this termset
        clientContext.load(termSet);

        clientContext.executeQueryAsync(function (sender, args)
        {
            deferred.resolve(termSet);
        }, function (sender, args)
        {
            deferred.reject("JSOM Get TermSet Failed: " + args.get_message());
        });

        return deferred.promise();
    };

    //pass in the parent term set guid and the child term guid, the term object will be returned
    Bah.getTerm = function (termSetGuid, termGuid)
    {
        var deferred = $.Deferred();
        var clientContext = SP.ClientContext.get_current();
        var taxonomySession = SP.Taxonomy.TaxonomySession.getTaxonomySession(clientContext);
        var termStore = taxonomySession.getDefaultSiteCollectionTermStore();

        $.when(Bah.getTermSet(termSetGuid)).then(function (termSet)
        {
            clientContext.load(termSet);
            var groupTerm = termSet.getTerm(termGuid);
            clientContext.load(groupTerm);
            clientContext.executeQueryAsync(function ()
            {
                deferred.resolve(groupTerm);
            }, function (sender, args)
            {
                deferred.reject("JSOM Get TermSetByName Failed: " + args.get_message());
            });
        });

        return deferred.promise();
    };

    //For use in conjuction with Bah.getTerm to get parent of term returned from
    Bah.getTermParent = function (currentTerm)
    {
        var deferred = $.Deferred();
        var clientContext = SP.ClientContext.get_current();
        var taxonomySession = SP.Taxonomy.TaxonomySession.getTaxonomySession(clientContext);
        var termStore = taxonomySession.getDefaultSiteCollectionTermStore();
        var parentTerm = currentTerm.get_parent();
        clientContext.load(parentTerm);
        clientContext.executeQueryAsync(function ()
        {
            deferred.resolve(parentTerm);
        }, function (sender, args)
        {
            deferred.reject("JSOM Get TermSetByName Failed: " + args.get_message());
        });
        return deferred.promise();
    };

    Bah.getTermSetCustomProperty = function (tsGuid, customPropertyName)
    {
        return Bah.getTermSet(tsGuid).then(function (termSet)
        {
            return termSet.get_customProperties()[customPropertyName];
        });
    };

    Bah.getTermSetCustomProperties = function (tsGuid)
    {
        return Bah.getTermSet(tsGuid).then(function (termSet)
        {
            return termSet.get_customProperties();
        });
    };

    Bah.getConfigurationProperty = function (configurationPropertyName)
    {
        return Bah.getTermSetCustomProperty(Bah.Constants.Guid.ConfigurationTermSet, configurationPropertyName);
    };

    //Get the Term Id from a Managed Property String having the term ID info
    Bah.getTermIdFromManagedMetadataId = function (termString)
    {
        if (typeof termString == 'string' || termString instanceof String)
        {
            termString = termString.replace(/\s/g, ",");
            var termPattern = 'GP0|#';
            var startIndex = termString.indexOf(termPattern) + termPattern.length;
            return termString.slice(startIndex, termString.indexOf(',', startIndex));
        } else
        {
            return null;
        }
    };

    Bah.getViewProfileLink = function ()
    {
        function getPublishingContactAccountNameFromCurrentPage()
        {
            var clientContext = SP.ClientContext.get_current();
            var web = clientContext.get_web();

            return $.when((function ()
            {
                //get PublishingContact (SP.FieldUserValue) user from current page
                var deferred = $.Deferred();
                var fieldName = 'PublishingContact';
                //Form Query
                var list = web.get_lists().getById(_spPageContextInfo.pageListId);
                var item = list.getItemById(_spPageContextInfo.pageItemId);
                clientContext.load(item, fieldName);
                clientContext.executeQueryAsync(function (sender, args)
                {
                    deferred.resolve(item.get_item(fieldName));
                }, function (sender, args)
                {
                    deferred.reject("JSOM Get Publishing Contact Field User Value Failed: " + args.get_message());
                });

                return deferred.promise();
            })()).then(function (publshingContact)
            {
                var deferred = $.Deferred();
                var user = web.getUserById(publshingContact.get_lookupId());
                clientContext.load(user);
                clientContext.executeQueryAsync(function (sender, args)
                {
                    deferred.resolve(user.get_loginName());
                }, function (sender, args)
                {
                    deferred.reject("JSOM Get User Login Name from Publishing Contact Field User Value Failed: " + args.get_message());
                });
                return deferred.promise();
            });
        }

        return $.when(Bah.getTermSetCustomProperty(Bah.Constants.Guid.UserProfileDropdownTermSet, 'View Profile URL'),
                getPublishingContactAccountNameFromCurrentPage()).then(function (viewUrl, userLoginName)
                {
                    return (viewUrl || '#') + '?user=' + encodeURIComponent(userLoginName);
                });
    };

    //Returns the given value if it is a string, otherwise returns an empty string
    //Hence will always return a string.
    Bah.alwaysString = function (s)
    {
        return typeof s === 'string' || s instanceof String ? s : '';
    };

    Bah.htmlEscape = function (str)
    {
        return String(str)
                .replace(/&/g, '&amp;')
                .replace(/"/g, '&quot;')
                .replace(/'/g, '&#39;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;');
    };

    Bah.updateUserProperty2 = function (accountName, propertyName, propertyValue)
    {
        var xmlValue = '';
        if (propertyValue instanceof Array)
        {
            for (var i = 0; i < propertyValue.length; i++)
            {
                xmlValue += '<ValueData><Value xsi:type="xsd:string">' + propertyValue[i] + '</Value></ValueData>';
            }
        }
        else
        {
            xmlValue = '<ValueData><Value xsi:type="xsd:string">' + propertyValue + '</Value></ValueData>';
        }

        var newData = '<?xml version="1.0" encoding="utf-8"?>'
        + '<soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">'
        + '<soap:Body>'
        + ' <ModifyUserPropertyByAccountName xmlns="http://microsoft.com/webservices/SharePointPortalServer/UserProfileService">'
         + '  <accountName>' + accountName + '</accountName>'
            + '  <newData>'
             + '  <PropertyData>'
             + '  <IsPrivacyChanged>false</IsPrivacyChanged>'
             + '  <IsValueChanged>true</IsValueChanged>'
             + '  <Name>' + propertyName + '</Name>'
             + '  <Privacy>Public</Privacy>'
             + '  <Values>' + xmlValue + '</Values>'
             + '  </PropertyData>'
         + '  </newData>'
         + ' </ModifyUserPropertyByAccountName>'
         + ' </soap:Body>'
         + '</soap:Envelope>'

        return jQuery.ajax({
            //Added site collection url back in as it can cause permissions issues if the user doesn't have admin access at the site collection level
            url: _spPageContextInfo.webAbsoluteUrl + '/_vti_bin/UserProfileService.asmx',
            beforeSend: function (xhr)
            {
                xhr.setRequestHeader("SOAPAction", "http://microsoft.com/webservices/SharePointPortalServer/UserProfileService/ModifyUserPropertyByAccountName");
            },
            type: "POST",
            dataType: "xml",
            data: newData,
            success: function ()
            {
                Bah.logging.log("property '" + propertyName + "' with value '" + propertyValue + "' saved successfully", 'Bah.updateUserProperty2');
            },
            error: function (jqXHR)
            {
                var faultString = jQuery(jqXHR.responseXML).find('faultstring').text();
                Bah.logging.error(faultString, 'Bah.updateUserProperty2');
            },
            contentType: "text/xml; charset=\"utf-8\""
        });
    };

    Bah.joinFc = function (accountName, propertyName, propertyValue, isUserJoined, control, controlWrapper)
    {
        var xmlValue = '';
        if (propertyValue instanceof Array)
        {
            for (var i = 0; i < propertyValue.length; i++)
            {
                xmlValue += '<ValueData><Value xsi:type="xsd:string">' + propertyValue[i] + '</Value></ValueData>';
            }
        }
        else
        {
            xmlValue = '<ValueData><Value xsi:type="xsd:string">' + propertyValue + '</Value></ValueData>';
        }

        var newData = '<?xml version="1.0" encoding="utf-8"?>'
        + '<soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">'
        + '<soap:Body>'
        + ' <ModifyUserPropertyByAccountName xmlns="http://microsoft.com/webservices/SharePointPortalServer/UserProfileService">'
         + '  <accountName>' + accountName + '</accountName>'
            + '  <newData>'
             + '  <PropertyData>'
             + '  <IsPrivacyChanged>false</IsPrivacyChanged>'
             + '  <IsValueChanged>true</IsValueChanged>'
             + '  <Name>' + propertyName + '</Name>'
             + '  <Privacy>Public</Privacy>'
             + '  <Values>' + xmlValue + '</Values>'
             + '  </PropertyData>'
         + '  </newData>'
         + ' </ModifyUserPropertyByAccountName>'
         + ' </soap:Body>'
         + '</soap:Envelope>'

        return jQuery.ajax({
            //Added site collection url back in as it can cause permissions issues if the user doesn't have admin access at the site collection level
            url: _spPageContextInfo.webAbsoluteUrl + '/_vti_bin/UserProfileService.asmx',
            beforeSend: function (xhr)
            {
                xhr.setRequestHeader("SOAPAction", "http://microsoft.com/webservices/SharePointPortalServer/UserProfileService/ModifyUserPropertyByAccountName");
            },
            type: "POST",
            dataType: "xml",
            data: newData,
            success: function ()
            {
                Bah.joinFcUpdated(isUserJoined, control, controlWrapper);
            },
            error: function (jqXHR)
            {
                var faultString = jQuery(jqXHR.responseXML).find('faultstring').text();
                Bah.logging.error(faultString, 'Bah.joinFc');
            },
            contentType: "text/xml; charset=\"utf-8\""
        });
    };

    Bah.joinFcUpdated = function (isUserJoined, control, controlWrapper)
    {
        if (isUserJoined !== undefined)
        {
            if (!isUserJoined)
            {
                control.text("Joined");
                control.attr("data-userjoined", "true");
            }
            else
            {
                ////If there is not a control wrapper is because it comes from the FC Join widget; the Join label in this widget must be different than the one from the FC List widget.
                ////Additionally, the label in the FC Join widget must be inside a span because it has a different styling.
                if (controlWrapper === undefined)
                {
                    control.text("");
                    control.append($('<span></span>').text("Join"));
                } else
                {
                    control.text("Join");
                }

                control.attr("data-userjoined", "false");
            }
        }

        if (controlWrapper !== undefined)
        {
            controlWrapper.toggleClass("joined not-joined");
        }
    };

    Bah.getNewUserPropertyValues = function (pageCommunity, functionalCommunities, isUserJoined)
    {
        var newUserValues = [];
        ////If user is already joined, then removes the page community from the functional communities array so it can be removed from the User Profile later.
        if (isUserJoined)
        {
            newUserValues = $.grep(functionalCommunities, function (value)
            {
                return value != pageCommunity;
            });
        }
        else
        {
            ////If user is not joined, then adds the page community to the functional communities array so it can be added to the User Profile later.
            newUserValues = functionalCommunities;
            if ($.inArray(pageCommunity, newUserValues) === -1)
            {
                newUserValues.push(pageCommunity);
            }
        }
        return newUserValues;
    };

    Bah.queryUserProfileProperties = function (userQueryUrl)
    {
        return $.ajax({
            async: false,
            url: userQueryUrl,
            type: "GET",
            headers: { "Accept": "application/json; odata=verbose" },
            cache: false,
        });
    };

    Bah.GetQueryStringParams = function (sParam)
    {
        var sPageURL = window.location.search.substring(1);
        var sURLVariables = sPageURL.split('&');
        for (var i = 0; i < sURLVariables.length; i++)
        {
            var sParameterName = sURLVariables[i].split('=');
            if (sParameterName[0] == sParam)
            {
                return sParameterName[1];
            }
        }
    };

    //Gets current user display name. Returns a jQuery promise.
    Bah.GetUserDisplayNamePromise = function (sParam)
    {
        var deferred = $.Deferred();
        var data;
        var ajax = $.ajax({
            async: false,
            url: "/_api/SP.UserProfiles.PeopleManager/GetMyProperties?$select=DisplayName",
            type: "GET",
            headers: { "Accept": "application/json; odata=verbose" },
            complete: function (xData, status)
            {
                if (status === "success")
                {
                    data = xData.responseJSON.d.DisplayName;
                }
            },
        });
        deferred.resolve(data);
        return deferred.promise();
    };

    Bah.GetUserWithoutDomain = function (username)
    {
        return username.substr(0, username.indexOf("@"));
    }

    Bah.UploadFileCrossSite = function (file, webUrl, documentLibrary, fileName, ext, complete)
    {
        var deferred = $.Deferred();
        var dataResult = false;

        url = webUrl + "/_api/contextinfo";
        jQuery.ajax({
            url: url,
            type: "POST",
            headers: {
                "Accept": "application/json; odata=verbose"
            },
            contentType: "application/json;odata=verbose",
            success: function (data)
            {
                var digest = data.d.GetContextWebInformation.FormDigestValue;
                var libraryName = documentLibrary;

                var reader = new FileReader();
                var arrayBuffer;

                reader.onload = function (e)
                {
                    arrayBuffer = reader.result;

                    url = webUrl + "/_api/web/lists/getByTitle(@TargetLibrary)/RootFolder/files/add(url=@TargetFileName,overwrite='true')?" +
                       "@TargetLibrary='" + libraryName + "'" +
                       "&@TargetFileName='" + Bah.GetUserWithoutDomain(fileName) + "." + ext + "'";

                    jQuery.ajax({
                        url: url,
                        type: "POST",
                        data: arrayBuffer,
                        headers: {
                            "Accept": "application/json; odata=verbose",
                            "X-RequestDigest": digest
                        },
                        contentType: "application/json;odata=verbose",
                        processData: false,
                        success: function ()
                        {
                            dataResult = true;
                            complete();
                            Bah.logging.log("Successfully uploaded file to different site.", 'Bah.UploadFileCrossSite');
                        },
                        error: function ()
                        {
                            Bah.logging.error("Error uploading file to different site.", 'Bah.UploadFileCrossSite');
                        }
                    });
                };

                reader.readAsArrayBuffer(file);
            },
            error: function ()
            {
                Bah.logging.error("Error accessing other site.", 'Bah.UploadFileCrossSite');
            }
        });
        deferred.resolve(dataResult);
        return deferred.promise();
    };

    Bah.DeleteFileCrossSite = function (webUrl, serverRelativeUrl, documentLibrary, fileName, ext, confirm)
    {
        var deferred = $.Deferred();
        var dataResult = false;

        url = webUrl + "/_api/contextinfo";
        jQuery.ajax({
            url: url,
            type: "POST",
            headers: {
                "Accept": "application/json; odata=verbose"
            },
            contentType: "application/json;odata=verbose",

            success: function (data)
            {
                var digest = data.d.GetContextWebInformation.FormDigestValue;
                var libraryName = documentLibrary;

                url = webUrl + "/_api/web/GetFileByServerRelativeUrl(@TargetFile)?" +
                   "@TargetFile='" + serverRelativeUrl + "/" + encodeURIComponent(libraryName) + "/" + encodeURIComponent(Bah.GetUserWithoutDomain(fileName)) + "." + encodeURIComponent(ext) + "'";

                jQuery.ajax({
                    url: url,
                    type: "POST",
                    headers: {
                        "Accept": "application/json; odata=verbose",
                        "X-RequestDigest": digest,
                        "X-HTTP-Method": "DELETE",
                        "IF-MATCH": "*"
                    },
                    contentType: "application/json;odata=verbose",
                    processData: false,
                    success: function ()
                    {
                        dataResult = true;
                        Bah.logging.log("Successfully deleted file from different site.", 'Bah.DeleteFileCrossSite');
                    },
                    error: function ()
                    {
                        Bah.logging.log("File doesn't exist.", 'Bah.DeleteFileCrossSite');
                    }
                });
            },
            error: function ()
            {
                Bah.logging.error("Error accessing other site.", 'Bah.DeleteFileCrossSite');
            }
        });
        deferred.resolve(dataResult);
        return deferred.promise();
    };

    Bah.CheckFileExists = function (webUrl, serverRelativeUrl, documentLibrary, fileName, ext, complete, failed)
    {
        var deferred = $.Deferred();
        var dataResult;

        url = webUrl + "/_api/contextinfo";
        jQuery.ajax({
            url: url,
            type: "POST",
            headers: {
                "Accept": "application/json; odata=verbose"
            },
            contentType: "application/json;odata=verbose",

            success: function (data)
            {
                var digest = data.d.GetContextWebInformation.FormDigestValue;
                var libraryName = documentLibrary;
                var filename = Bah.GetUserWithoutDomain(fileName);

                url = webUrl + "/_api/web/GetFileByServerRelativeUrl(@TargetFile)/ListItemAllFields?" +
                   "@TargetFile='" + serverRelativeUrl + "/" + encodeURIComponent(libraryName) + "/" + encodeURIComponent(filename) + "." + encodeURIComponent(ext) + "'";

                jQuery.ajax({
                    url: url,
                    type: "POST",
                    headers: {
                        "Accept": "application/json; odata=verbose",
                        "X-RequestDigest": digest
                    },
                    contentType: "application/json;odata=verbose",
                    processData: false,
                    success: function (data)
                    {
                        complete({ modified: data.d.Modified, filename: filename + "." + ext, url: webUrl + "/" + documentLibrary + "/" + filename + "." + ext, metadata: data.d.__metadata });
                    },
                    error: function ()
                    {
                        failed();
                        // Bah.logging.error('Error accessing the file ' + filename, 'Bah.CheckFileExists');
                    }
                });
            },
            error: function ()
            {
                Bah.logging.error("Error accessing other site.", 'Bah.CheckFileExists');
            }
        });
        deferred.resolve(dataResult);
        return deferred.promise();
    };

    Bah.updateListItem = function (webUrl, itemMetadata, title)
    {
        var deferred = $.Deferred();
        var dataResult = false;
        var metadata = itemMetadata;

        url = webUrl + "/_api/contextinfo";
        jQuery.ajax({
            url: url,
            type: "POST",
            headers: {
                "Accept": "application/json; odata=verbose"
            },
            contentType: "application/json;odata=verbose",
            success: function (data)
            {
                var digest = data.d.GetContextWebInformation.FormDigestValue;

                var sendItem = { "__metadata": { "type": metadata.type } };
                sendItem['Title'] = title;
                sendItem['BAH_EmployeeID'] = Bah.GetUserWithoutDomain(_spPageContextInfo.userLoginName);

                $.ajax({
                    url: metadata.uri,
                    type: "POST",
                    contentType: "application/json;odata=verbose",
                    data: JSON.stringify(sendItem),
                    headers: {
                        "Accept": "application/json;odata=verbose",
                        "X-RequestDigest": digest,
                        "X-HTTP-Method": "MERGE",
                        "If-Match": "*"
                    },
                    success: function (data)
                    {
                        Bah.logging.info("Update Successful", 'Bah.updateListItem');
                    },
                    error: function (msg)
                    {
                        Bah.logging.error(msg, 'Bah.updateListItem');
                    }
                });
            },
            error: function ()
            {
                Bah.logging.error("Error accessing other site.", 'Bah.updateListItem');
            }
        });
        deferred.resolve(dataResult);
        return deferred.promise();
    };

    Bah.showLyncPresencePopup = function (userName, target)
    {
        if (!nameCtrl)
        {
            return;
        }

        var eLeft = $(target).offset().left;
        var x = eLeft - $(window).scrollLeft();

        var eTop = $(target).offset().top;
        var y = eTop - $(window).scrollTop();

        nameCtrl.ShowOOUI(userName, 0, x, y);
    }

    Bah.hideLyncPresencePopup = function ()
    {
        if (!nameCtrl)
        {
            return;
        }
        nameCtrl.HideOOUI();
    }

    Bah.getUpcomingEvents = function (listTitle)
    {
        var wsURL = "/_vti_bin/Lists.asmx";

        var deferred = $.Deferred();
        var clientContext = SP.ClientContext.get_current();
        var list = clientContext.get_web().get_lists().getByTitle(listTitle);

        clientContext.load(list, 'Id', 'Title', 'ParentWeb');
        ////Calls the query async to get the configuration termset and then query the calendar list.
        clientContext.executeQueryAsync(
            Function.createDelegate(this,
                function ()
                {
                    var result = {
                        data: '',
                        listTitle: '',
                        sourceUrl: ''
                    };
                    var calendarGuid = list.get_id().toString();
                    var sourceUrl = list.get_parentWeb().get_url();
                    var xmlCall = Bah.getRecurrenceQueryForEvents(calendarGuid);
                    var ajax = $.ajax({
                        url: wsURL,
                        type: "POST",
                        dataType: "xml",
                        async: false,
                        data: xmlCall,
                        complete: function (xData, status)
                        {
                            if (status === "success")
                            {
                                result.data = $(xData.responseText);
                            }
                        },
                        contentType: "text/xml; charset=\"utf-8\""
                    });

                    result.listTitle = listTitle;
                    result.sourceUrl = sourceUrl;
                    deferred.resolve(result);
                }),
            Function.createDelegate(this,
                function (sender, args) { deferred.reject(sender, args); }));

        return deferred.promise();
    };

    Bah.setModelForUpcomingEvents = function (viewModel, result, itemCount, firstToTake)
    {
        var data = result.data;
        var listTitle = result.listTitle != '' ? result.listTitle : '';
        var sourceUrl = result.sourceUrl != '' ? result.sourceUrl : '';
        var detailsPageUrl = Bah.configuration.eventDetailsPageUrl;
        if (data)
        {
            data.find("listitems").children().children().each(function ()
            {
                $this = $(this);
                var ids = $this.attr("ows_UniqueId").split(";");
                ////Formats the event date so all browsers recognize it
                var itemDate = $.format.date($this.attr("ows_EventDate"), 'MM/dd/yyyy hh:mm:ss a');
                var eventDate = new Date(itemDate);
                var eventMonth = $.format.date(eventDate, 'MMM');
                var eventDay = $.format.date(eventDate, 'dd');
                var recurrentEvent = $this.attr("ows_fRecurrence");
                var allDayEvent = $this.attr("ows_fAllDayEvent") === "1" ? true : false;
                var description = $this.attr("ows_Description") ? $this.html($this.attr("ows_Description").replace(/&lt;/g, '<').replace(/&gt;/g, '>').replace(/&quot;/g, '"')).text() : '';
                var time = allDayEvent ? "ALL DAY" : $.format.date(eventDate, 'h:mm a') + " - " + $.format.date($this.attr("ows_EndDate"), 'h:mm a');
                var newUrl = detailsPageUrl;
                if (!recurrentEvent)
                {
                    newUrl = newUrl === "#" ? newUrl : newUrl + "?eventId=" + ids[0] + "&sourceUrl=" + sourceUrl + "&listTitle=" + listTitle;
                } else
                {
                    newUrl = newUrl === "#" ? newUrl : newUrl + "?eventId=" + ids[0] + "&eventDate=" + encodeURIComponent(eventDate) + "&sourceUrl=" + sourceUrl + "&listTitle=" + listTitle;
                }

                if (eventDate >= new Date($.now()))
                {
                    viewModel.events.push({
                        "Time": time,
                        "Title": $this.attr("ows_Title"),
                        "Description": description,
                        "Month": eventMonth,
                        "Day": eventDay,
                        "DetailsPage": newUrl,
                    });
                }
            });

            if (viewModel.events.length > 0)
            {
                viewModel.events = lazy(viewModel.events).take(itemCount).toArray();

                viewModel.topEvents = lazy(viewModel.events).take(firstToTake).toArray();
                viewModel.allEventsLeft = lazy(viewModel.events).rest(firstToTake).toArray();
            }
        }
    };

    Bah.getViewProfileUrlProperty = function ()
    {
        return Bah.configuration.widgets.userProfileDropdown.viewProfileUrl;
    };

    Bah.waitForFinalEvent = (function ()
    {
        var timers = {};
        return function (callback, ms, uniqueId)
        {
            if (!uniqueId)
            {
                uniqueId = "Don't call this twice without a uniqueId";
            }
            if (timers[uniqueId])
            {
                clearTimeout(timers[uniqueId]);
            }
            timers[uniqueId] = setTimeout(callback, ms);
        };
    })();

    Bah.detectUserAgent = function ()
    {
        window.onload = function () { };
        var b = document.documentElement; b.setAttribute('data-useragent', navigator.userAgent); b.setAttribute('data-platform', navigator.platform); b.className += ((!!('ontouchstart' in window) || !!('onmsgesturechange' in window)) ? ' touch' : '');
    };

    var UPQueryDeffered;

    Bah.getImageRendition = function (image, rendition)
    {
        if (!image) return "";

        var returnImg = "";
        var imgArray = ["png", "jpg", "gif", "jpeg", "PNG", "JPG", "GIF", "JPEG"];
        $.each(imgArray, function (index, value)
        {
            if (image.indexOf(value) > 0)
            {
                returnImg = image.replace(eval("/(" + value + ")([?]RenditionID=[0-9])?/gi"), value + "?RenditionID=" + rendition);
            }
        });
        if (returnImg == "" && image)
        {
            returnImg = image;
        }
        return returnImg;
    };

    Bah.UPQuery = function ()
    {
        if (UPQueryDeffered)
            return UPQueryDeffered;

        var deferred = $.Deferred();

        var locale = 1033; //English
        var clientContext = SP.ClientContext.get_current();
        var taxonomySession = SP.Taxonomy.TaxonomySession.getTaxonomySession(clientContext);
        var termStore = taxonomySession.getDefaultSiteCollectionTermStore();
        clientContext.load(taxonomySession);
        clientContext.load(termStore);

        var proposalExperienceTermSetName = 'Proposal Experience';
        var proposalExperienceTermSets = termStore.getTermSetsByName(proposalExperienceTermSetName, locale);
        var proposalExperienceTermSet = proposalExperienceTermSets.getByName(proposalExperienceTermSetName);
        var proposalExperienceTerms = proposalExperienceTermSet.getAllTerms();
        clientContext.load(proposalExperienceTermSet);
        clientContext.load(proposalExperienceTerms, 'Include(IsRoot, Labels, TermsCount, CustomSortOrder, Id, IsAvailableForTagging, Name, PathOfTerm, Parent, TermSet.Name, LocalCustomProperties, CustomProperties)');

        var regionTermSetName = 'Region';
        var regionTermSets = termStore.getTermSetsByName(regionTermSetName, locale);
        var regionTermSet = regionTermSets.getByName(regionTermSetName);
        var regionTerms = regionTermSet.getAllTerms();
        clientContext.load(regionTermSet);
        clientContext.load(regionTerms, 'Include(IsRoot, Labels, TermsCount, CustomSortOrder, Id, IsAvailableForTagging, Name, PathOfTerm, Parent, TermSet.Name, LocalCustomProperties, CustomProperties)');

        var willingToTravelTermSetName = 'Willingness to Travel';
        var willingToTravelTermSets = termStore.getTermSetsByName(willingToTravelTermSetName, locale);
        var willingToTravelTermSet = willingToTravelTermSets.getByName(willingToTravelTermSetName);
        var willingToTravelTerms = willingToTravelTermSet.getAllTerms();
        clientContext.load(willingToTravelTermSet);
        clientContext.load(willingToTravelTerms, 'Include(IsRoot, Labels, TermsCount, CustomSortOrder, Id, IsAvailableForTagging, Name, PathOfTerm, Parent, TermSet.Name, LocalCustomProperties, CustomProperties)');

        var positionOfTrusttermSetName = 'Position of Trust';
        var positionOfTrusttermSets = termStore.getTermSetsByName(positionOfTrusttermSetName, locale);
        var positionOfTrusttermSet = positionOfTrusttermSets.getByName(positionOfTrusttermSetName);
        var positionOfTrustTerms = positionOfTrusttermSet.getAllTerms();
        clientContext.load(positionOfTrusttermSet);
        clientContext.load(positionOfTrustTerms, 'Include(IsRoot, Labels, TermsCount, CustomSortOrder, Id, IsAvailableForTagging, Name, PathOfTerm, Parent, TermSet.Name, LocalCustomProperties, CustomProperties)');

        var percentTermSetName = 'Percent';
        var percentTermSets = termStore.getTermSetsByName(percentTermSetName, locale);
        var percentTermSet = percentTermSets.getByName(percentTermSetName);
        var percentTerms = percentTermSet.getAllTerms();
        clientContext.load(percentTermSet);
        clientContext.load(percentTerms, 'Include(IsRoot, Labels, TermsCount, CustomSortOrder, Id, IsAvailableForTagging, Name, PathOfTerm, Parent, TermSet.Name, LocalCustomProperties, CustomProperties)');

        var deeplinksTermSetName = 'User Profile Fields Deep Links';
        var deeplinksTermSets = termStore.getTermSetsByName(deeplinksTermSetName, locale);
        var deeplinksTermSet = deeplinksTermSets.getByName(deeplinksTermSetName);
        var deeplinksTerms = deeplinksTermSet.getAllTerms();
        clientContext.load(deeplinksTermSet);
        clientContext.load(deeplinksTerms, 'Include(IsRoot, Labels, TermsCount, CustomSortOrder, Id, IsAvailableForTagging, Name, PathOfTerm, Parent, TermSet.Name, LocalCustomProperties, CustomProperties)');

        var securityResponseTermSetName = 'Security Response';
        var securityResponseTermSets = termStore.getTermSetsByName(securityResponseTermSetName, locale);
        var securityResponseTermSet = securityResponseTermSets.getByName(securityResponseTermSetName);
        var securityResponseTerms = securityResponseTermSet.getAllTerms();
        clientContext.load(securityResponseTermSet);
        clientContext.load(securityResponseTerms, 'Include(IsRoot, Labels, TermsCount, CustomSortOrder, Id, IsAvailableForTagging, Name, PathOfTerm, Parent, TermSet.Name, LocalCustomProperties, CustomProperties)');

        var securityClearanceTermSetName = 'Security Clearance';
        var securityClearanceTermSets = termStore.getTermSetsByName(securityClearanceTermSetName, locale);
        var securityClearanceTermSet = securityClearanceTermSets.getByName(securityClearanceTermSetName);
        var securityClearanceTerms = securityClearanceTermSet.getAllTerms();
        clientContext.load(securityClearanceTermSet);
        clientContext.load(securityClearanceTerms, 'Include(IsRoot, Labels, TermsCount, CustomSortOrder, Id, IsAvailableForTagging, Name, PathOfTerm, Parent, TermSet.Name, LocalCustomProperties, CustomProperties)');

        var folDatesTermSetName = 'FOL Dates';
        var folDatesTermSets = termStore.getTermSetsByName(folDatesTermSetName, locale);
        var folDatesTermSet = folDatesTermSets.getByName(folDatesTermSetName);
        var folDatesTerms = folDatesTermSet.getAllTerms();
        clientContext.load(folDatesTermSet);
        clientContext.load(folDatesTerms, 'Include(IsRoot, Labels, TermsCount, CustomSortOrder, Id, IsAvailableForTagging, Name, PathOfTerm, Parent, TermSet.Name, LocalCustomProperties, CustomProperties)');

        var user = Bah.GetQueryStringParams('user') != undefined ? Bah.GetQueryStringParams('user') : '';

        clientContext.executeQueryAsync(Function.createDelegate(this, function ()
        {
            var result = [];
            if (Bah.isNullOrEmpty(user))
            {
                var ajax = $.ajax({
                    async: false,
                    url: "/_api/SP.UserProfiles.PeopleManager/GetMyProperties?$select=UserProfileProperties",
                    type: "GET",
                    headers: { "Accept": "application/json; odata=verbose" },
                    cache: false,
                    complete: function (xData, status)
                    {
                        if (status === "success")
                        {
                            result.data = xData.responseJSON;
                        }
                    },
                });
            }
            else
            {
                var ajax = $.ajax({
                    async: false,
                    url: "/_api/SP.UserProfiles.PeopleManager/GetPropertiesFor(accountName=@v)?@v='" + user + "'",
                    type: "GET",
                    headers: { "Accept": "application/json; odata=verbose" },
                    cache: false,
                    complete: function (xData, status)
                    {
                        if (status === "success")
                        {
                            result.data = xData.responseJSON;
                        }
                    },
                });
            }

            if (proposalExperienceTerms)
            {
                result["Proposal Experience"] = proposalExperienceTerms;
            }
            if (regionTerms)
            {
                result["Region"] = regionTerms;
            }
            if (willingToTravelTerms)
            {
                result["Willingness to Travel"] = willingToTravelTerms;
            }
            if (positionOfTrustTerms)
            {
                result["Position of Trust"] = positionOfTrustTerms;
            }
            if (percentTerms)
            {
                result["Percent"] = percentTerms;
            }
            if (deeplinksTerms)
            {
                result["Deep Links"] = deeplinksTerms;
            }
            if (securityResponseTerms)
            {
                result["Security Response"] = securityResponseTerms;
            }
            if (securityClearanceTerms)
            {
                result["Security Clearance"] = securityClearanceTerms;
            }

            if (folDatesTerms)
            {
                result["FOL Dates"] = folDatesTerms;
            }

            deferred.resolve(result);
        }), Function.createDelegate(this, function ()
        {
            Bah.logging.error('There was a problem trying to get the Configuration term set properties.', 'Bah.UserProfiles');
            deferred.reject();
        }));

        UPQueryDeffered = deferred.promise();
        return deferred.promise();
    }

    Bah.followSite = function (siteUrl)
    {
        var actorType = 2;  // 1-document,2-site,3-tag
        return jQuery.ajax({
            url: "/_api/social.following/follow",
            type: "POST",
            data: JSON.stringify({
                "actor": {
                    "__metadata": {
                        "type": "SP.Social.SocialActorInfo"
                    },
                    "ActorType": actorType,
                    "ContentUri": siteUrl,
                    "Id": null
                }
            }),
            headers: {
                "accept": "application/json;odata=verbose",
                "content-type": "application/json;odata=verbose",
                "X-RequestDigest": $("#__REQUESTDIGEST").val()
            },
            success: function (responseData)
            {
                stringData = JSON.stringify(responseData);
                jsonObject = JSON.parse(stringData);
                var statusMessage = {
                    0: 'The user has started following the site. ',
                    1: 'The user is already following the site. ',
                    2: 'An internal limit was reached. ',
                    3: 'An internal error occurred. '
                }
                if (jsonObject.d.Follow > 1)
                    alert(statusMessage[jsonObject.d.Follow] + 'Status code = ' + jsonObject.d.Follow);
            },
            error: function (jqXHR)
            {
                var faultString = jQuery(jqXHR.responseXML).find('faultstring').text();
                Bah.logging.error(faultString, 'Bah.followSite');
            },
        });

    };

    Bah.stopFollowSite = function (siteUrl)
    {
        var actorType = 2;  // 1-document,2-site,3-tag
        return jQuery.ajax({
            url: "/_api/social.following/stopfollowing",
            type: "POST",
            data: JSON.stringify({
                "actor": {
                    "__metadata": {
                        "type": "SP.Social.SocialActorInfo"
                    },
                    "ActorType": actorType,
                    "ContentUri": siteUrl,
                    "Id": null
                }
            }),
            headers: {
                "accept": "application/json;odata=verbose",
                "content-type": "application/json;odata=verbose",
                "X-RequestDigest": $("#__REQUESTDIGEST").val()
            },
            success: function ()
            {
                // alert('The user has stopped following the site.');
            },
            error: function (jqXHR)
            {
                var faultString = jQuery(jqXHR.responseXML).find('faultstring').text();
                Bah.logging.error(faultString, 'Bah.stopFollowSite');
            },
        });

    };
    Bah.getMyFollowedTeams = function ()
    {
        return $.ajax({
            async: true,
            url: "/_api/social.following/my/followed(types=14)",
            type: "GET",
            headers: {
                "Accept": "application/json; odata=verbose"
            },
            cache: false
        }).then(function (data)
        {
            return data;
        });
    }
    Bah.getSPSIcon = function (fileext)
    {
        var hostroot = "https://" + window.location.hostname + "/_layouts/images/"
        var retimg = hostroot + "blank.gif";
        var imgtry = hostroot + "ic" + fileext + ".png";
        if (fileext != 'aspx')
        {
            var http = new XMLHttpRequest();
            http.open('HEAD', imgtry, false);
            http.send();
            if (http.status != 404)
            {
                retimg = imgtry;
            }
        }
        return retimg;
    }

    Bah.getIcon = function (fileType) {
        var icon = null;
        fileType = fileType.substring(0, 3);

        switch (fileType) {
            case 'doc':
            case 'ppt':
            case 'xls':
            case 'pdf':
                icon = "/Style Library/BAH/img/icon-sps-" + fileType + ".png";
                break;
        }        
        return icon;
    }

    ////
})(jQuery);
///#source 1 1 Custom/bah.logging.js
var Bah = Bah || {};

(function ($) {
	Bah.logging = (function () {
		//Enables or disables Bah.logging across the site.
		var loggingEnabled = false;

		//Types of log
		var types = {
			log: 0,
			info: 1,
			error: 2
		};

		//Centralized logging.
		var logMessage = function (message, type) {
			if (loggingEnabled && typeof message !== 'undefined' && typeof console !== 'undefined') {
				switch (type) {
					case 1:
						console.info(message);
						break;
					case 2:
						console.error(message);
						break;
					default:
						console.log(message);
						break;
				}
			}
		};

		//Parses the text message and source before logging.
		var parseLog = function (text, source, type) {
			if (typeof text !== 'undefined') {
				var message = text;

				if (typeof source !== 'undefined') {
					message = source + ' - ' + text;
				}

				logMessage(message, type);
			}
		}

		return {
			log: function (text, source) {
				parseLog(text, source, types.log);
			},

			info: function (text, source) {
				parseLog(text, source, types.info);
			},

			error: function (text, source) {
				parseLog(text, source, types.error);
			},
		}
	})();
})(jQuery);
///#source 1 1 Custom/bah.configuration.js
var Bah = Bah || {};

(function ($) {
	//Gives global access to the application configuration term sets values across the js code.
	Bah.configuration = (function () {
		//Default property values.
		var rootSiteCollectionUrl = '/';
		var helpUrl = '/Help';
		var usageGuidelinesUrl = '/';
		var advancedPeopleSearchFormUrl = '/Pages/Advanced-People-Search.aspx';
		var teamSitesSiteCollectionUrl = '/sites/teams';
		var functionalCommunitiesSiteCollectionUrl = '/sites/fcs';
		var alertsRestApiUrl = '';
		var ssoUrl = '';
		var resumeCenterUrl = '/sites/resumecenter';
		var resumeLibraryname = 'Resume Library';
		var eventDetailsPageUrl = '/Pages/Event-Details.aspx';
		var eventsListingPageUrl = '/Pages/Event-Listing.aspx';
		var personalizationServiceUrl = '';
		var teamSitesListingPageUrl = '/Pages/Team-Sites.aspx';
		var searchResultsPageUrl = '/Pages/Search-Results.aspx';
		var newsSearchResultsPageUrl = '/Pages/Search-News.aspx';
		var eventsSearchResultsPageUrl = '/Pages/Search-Events.aspx';
		var filesSearchResultsPageUrl = '/Pages/Search-Files.aspx';
		var sitesSearchResultsPageUrl = '/Pages/Search-Sites.aspx';
		var peopleSearchResultsPageUrl = '/Pages/Search-People.aspx';
		var peopleSearchAdvancedResultsPageUrl = '/Pages/Search-People-Advanced.aspx';
		var helpSearchResultsPageUrl = '/Pages/Search-Help.aspx';
		var footerCopyright = '&copy; 2014 Booz Allen Hamilton Inc.';
		var apiAccessToken = '';
		var googleMapKey = '';
		var scProvisionList = '';
		var scProvisionSiteURL = '';
		var widgets = {
			resources: {},
			stayConnected: {},
			featuredNews: {
				categories: {},
				archivePageUrl: '#'
			},
			homePageEvents: {
				itemCount: 6
			},
			userProfileDropdown: {
				viewProfileUrl: '/Pages/View-Profile.aspx',
				editProfileUrl: '/Pages/Edit-Profile.aspx',
				uploadPhotoUrl: '#'
			},
			myCareer: {
				taleoSearchUrl: 'https://bah.taleo.net/careersection/1/jobsearch.ftl?lang=en&amp;job_title=developer&amp;keyword=',
				taleoApplicationUrl: 'https://bah.taleo.net/careersection/1/jobsearch.ftl?lang=en'
			}
		};

		//Initiates the asyncronous call to get the term set properties. Returns a jQuery promise.
		var loadProperties = function () {
			var deferred = $.Deferred();

			var locale = 1033; //English
			var clientContext = SP.ClientContext.get_current();
			var taxonomySession = SP.Taxonomy.TaxonomySession.getTaxonomySession(clientContext);
			var termStore = taxonomySession.getDefaultSiteCollectionTermStore();
			clientContext.load(taxonomySession);
			clientContext.load(termStore);

			var configurationTermSetName = 'Configuration';
			var configurationTermSets = termStore.getTermSetsByName(configurationTermSetName, locale);
			var configurationTermSet = configurationTermSets.getByName(configurationTermSetName);
			clientContext.load(configurationTermSet);

			var resourcesTermSetName = 'Resources';
			var resourcesTermSets = termStore.getTermSetsByName(resourcesTermSetName, locale);
			var resourcesTermSet = resourcesTermSets.getByName(resourcesTermSetName);
			var resourcesTerms = resourcesTermSet.getAllTerms();
			clientContext.load(resourcesTermSet);
			clientContext.load(resourcesTerms, 'Include(IsRoot, Labels, TermsCount, CustomSortOrder, Id, IsAvailableForTagging, Name, PathOfTerm, Parent, TermSet.Name, LocalCustomProperties, CustomProperties)');

			var stayConnectedTermSetName = 'Stay Connected';
			var stayConnectedTermSets = termStore.getTermSetsByName(stayConnectedTermSetName, locale);
			var stayConnectedTermSet = stayConnectedTermSets.getByName(stayConnectedTermSetName);
			var stayConnectedTerms = stayConnectedTermSet.getAllTerms();
			clientContext.load(stayConnectedTermSet);
			clientContext.load(stayConnectedTerms, 'Include(IsRoot, Labels, TermsCount, CustomSortOrder, Id, IsAvailableForTagging, Name, PathOfTerm, Parent, TermSet.Name, LocalCustomProperties, CustomProperties)');

			var featuredNewsTermSetName = 'Featured News';
			var featuredNewsTermSets = termStore.getTermSetsByName(featuredNewsTermSetName, locale);
			var featuredNewsTermSet = featuredNewsTermSets.getByName(featuredNewsTermSetName);
			clientContext.load(featuredNewsTermSet);

			var eventTermSetName = 'Home Page Events';
			var eventTermSets = termStore.getTermSetsByName(eventTermSetName, locale);
			var eventTermSet = eventTermSets.getByName(eventTermSetName);
			clientContext.load(eventTermSet);

			var userProfileTermSetName = 'User Profile Dropdown';
			var userProfileTermSets = termStore.getTermSetsByName(userProfileTermSetName, locale);
			var userProfileTermSet = userProfileTermSets.getByName(userProfileTermSetName);
			clientContext.load(userProfileTermSet);

			var myCareerTermSetName = 'My Career';
			var myCareerTermSets = termStore.getTermSetsByName(myCareerTermSetName, locale);
			var myCareerTermSet = myCareerTermSets.getByName(myCareerTermSetName);
			clientContext.load(myCareerTermSet);

			clientContext.executeQueryAsync(Function.createDelegate(this, function () {
				if (configurationTermSet) {
					assignConfigurationPropertiesValues(configurationTermSet);
				}
				if (resourcesTerms) {
					assignResourcesPropertiesValues(resourcesTerms);
				}
				if (stayConnectedTerms) {
					assignStayConnectedPropertiesValues(stayConnectedTerms);
				}
				if (featuredNewsTermSet) {
					assignFeaturedNewsPropertiesValues(featuredNewsTermSet);
				}
				if (eventTermSet) {
					assignEventPropertiesValues(eventTermSet);
				}
				if (userProfileTermSet) {
					assignUserProfilePropertiesValues(userProfileTermSet);
				}
				if (myCareerTermSet) {
					assignMyCareerPropertiesValues(myCareerTermSet);
				}

				deferred.resolve();
			}), Function.createDelegate(this, function () {
				Bah.logging.error('There was a problem trying to get the Configuration term set properties.', 'Bah.configuration');
				deferred.reject();
			}));

			return deferred.promise();
		};

		var assignMyCareerPropertiesValues = function (myCareerTermSet) {
			var customProperties = myCareerTermSet.get_objectData().get_properties()["CustomProperties"];
			if (typeof customProperties !== 'undefined') {
				Bah.configuration.widgets.myCareer.taleoApplicationUrl = customProperties["Taleo Application URL"] || widgets.myCareer.taleoApplicationUrl;
				Bah.configuration.widgets.myCareer.taleoSearchUrl = customProperties["Taleo Search URL"] || widgets.myCareer.taleoSearchUrl;
			}
		};

		//Assigns the User Profile Dropdown Term Set values or default values to the public properties.
		var assignUserProfilePropertiesValues = function (userProfileTermSet) {
			var customProperties = userProfileTermSet.get_objectData().get_properties()["CustomProperties"];
			if (typeof customProperties !== 'undefined') {
				Bah.configuration.widgets.userProfileDropdown.viewProfileUrl = customProperties["View Profile URL"] || widgets.userProfileDropdown.viewProfileUrl;
				Bah.configuration.widgets.userProfileDropdown.editProfileUrl = customProperties["Edit Profile URL"] || widgets.userProfileDropdown.editProfileUrl;
				Bah.configuration.widgets.userProfileDropdown.uploadPhotoUrl = customProperties["Upload Photo URL"] || widgets.userProfileDropdown.uploadPhotoUrl;
			}
		};

		//Assigns the Home Page Events Term Set values or default values to the public properties.
		var assignEventPropertiesValues = function (eventTermSet) {
			var customProperties = eventTermSet.get_objectData().get_properties()["CustomProperties"];
			if (typeof customProperties !== 'undefined') {
				Bah.configuration.widgets.homePageEvents.itemCount = customProperties["Item Count"] || widgets.homePageEvents.itemCount;
			}
		};

		//Assigns the Featured News Term Set values or default values to the public properties.
		var assignFeaturedNewsPropertiesValues = function (featuredNewsTermSet) {
			var customProperties = featuredNewsTermSet.get_objectData().get_properties()["CustomProperties"];
			if (typeof customProperties !== 'undefined') {
				////Once we have the term set we get the configured categories and the view archive url.
				Bah.configuration.widgets.featuredNews.categories = customProperties['Categories'] !== undefined ? customProperties['Categories'].toString().split(';', 6) : '';
				Bah.configuration.widgets.featuredNews.archivePageUrl = customProperties['Archive Page Url'] !== undefined ? customProperties['Archive Page Url'].toString() : '';
			}
		};

		//Assigns the Configuration Term Set values or default values to the public properties.
		var assignConfigurationPropertiesValues = function (configurationTermSet) {
			var customProperties = configurationTermSet.get_objectData().get_properties()["CustomProperties"];
			if (typeof customProperties !== 'undefined') {
				Bah.configuration.rootSiteCollectionUrl = customProperties["Root Site Collection URL"] || rootSiteCollectionUrl;
				Bah.configuration.helpUrl = customProperties["Help URL"] || helpUrl;
				Bah.configuration.usageGuidelinesUrl = customProperties["Usage Guidelines URL"] || usageGuidelinesUrl;
				Bah.configuration.advancedPeopleSearchFormUrl = customProperties["Advanced People Search Form URL"] || advancedPeopleSearchFormUrl;
				Bah.configuration.teamSitesSiteCollectionUrl = customProperties["Team Sites Site Collection URL"] || teamSitesSiteCollectionUrl;
				Bah.configuration.functionalCommunitiesSiteCollectionUrl = customProperties["Functional Communities Site Collection URL"] || functionalCommunitiesSiteCollectionUrl;
				Bah.configuration.alertsRestApiUrl = customProperties["Alerts Rest API URL"] || alertsRestApiUrl;
				Bah.configuration.ssoUrl = customProperties["SSO URL"] || ssoUrl;
				Bah.configuration.resumeCenterUrl = customProperties["Resume Center URL"] || resumeCenterUrl;
				Bah.configuration.resumeLibraryname = customProperties["Resume Library Name"] || resumeLibraryname;
				Bah.configuration.eventDetailsPageUrl = customProperties["Event Details Page URL"] || eventDetailsPageUrl;
				Bah.configuration.eventsListingPageUrl = customProperties["Events Listing Page URL"] || eventsListingPageUrl;
				Bah.configuration.personalizationServiceUrl = customProperties["Personalization Service URL"] || personalizationServiceUrl;
				Bah.configuration.teamSitesListingPageUrl = customProperties["Team Sites Listing Page URL"] || teamSitesListingPageUrl;
				Bah.configuration.searchResultsPageUrl = customProperties["Search Results Page URL"] || searchResultsPageUrl;
				Bah.configuration.newsSearchResultsPageUrl = customProperties["News Search Results Page URL"] || newsSearchResultsPageUrl;
				Bah.configuration.eventsSearchResultsPageUrl = customProperties["Events Search Results Page URL"] || eventsSearchResultsPageUrl;
				Bah.configuration.filesSearchResultsPageUrl = customProperties["Files Search Results Page URL"] || filesSearchResultsPageUrl;
				Bah.configuration.sitesSearchResultsPageUrl = customProperties["Sites Search Results Page URL"] || sitesSearchResultsPageUrl;
				Bah.configuration.peopleSearchResultsPageUrl = customProperties["People Search Results Page URL"] || peopleSearchResultsPageUrl;
				Bah.configuration.peopleSearchAdvancedResultsPageUrl = customProperties["Advanced People Search Results Page URL"] || peopleSearchAdvancedResultsPageUrl;
				Bah.configuration.helpSearchResultsPageUrl = customProperties["Help Search Results Page URL"] || helpSearchResultsPageUrl;
				Bah.configuration.footerCopyright = customProperties["Footer Copyright"] || footerCopyright;
				Bah.configuration.apiAccessToken = customProperties["AccessToken"] || apiAccessToken;
				Bah.configuration.googleMapKey = customProperties["Google Map Key"] || googleMapKey;
				Bah.configuration.scProvisionList = customProperties["SC Provision List"] || scProvisionList;
				Bah.configuration.scProvisionSiteURL = customProperties["SC Provision Site URL"] || scProvisionSiteURL;


			}
		};

		//Assigns the Resources raw term collection object to the Resources property.
		var assignResourcesPropertiesValues = function (resourcesTerms) {
			Bah.configuration.widgets.resources = resourcesTerms;
		};

		//Assigns the Stay Connected raw term collection object to the Stay Connected property.
		var assignStayConnectedPropertiesValues = function (stayConnectedTerms) {
			Bah.configuration.widgets.stayConnected = stayConnectedTerms;
		};

		return {
			//The value of Root Site Collection URL.
			rootSiteCollectionUrl: '',
			//The value of Help URL.
			helpUrl: '',
		    //The value of Usage Guideline URL.
			usageGuidelinesUrl: '',
			//The value of Advanced People Search Form URL.
			advancedPeopleSearchFormUrl: '',
			//The value of Team Sites Site Collection URL.
			teamSitesSiteCollectionUrl: '',
			//The value of Functional Communities Site Collection URL.
			functionalCommunitiesSiteCollectionUrl: '',
			//The value of Alerts Rest API URL.
			alertsRestApiUrl: '',
			//The value of SSO URL.
			ssoUrl: '',
			//The value of Resume Center URL.
			resumeCenterUrl: '',
			//The value of Resume Library Name.
			resumeLibraryname: '',
			//The value of Event Details Page URL.
			eventDetailsPageUrl: '',
			//The value of Events Listing Page URL.
			eventsListingPageUrl: '',
			//The value of Personalization Service URL.
			personalizationServiceUrl: '',
			//The value of Team Sites Listing Page URL.
			teamSitesListingPageUrl: '',
			//The value of Search Results Page URL.
			searchResultsPageUrl: '',
			//The value of News Search Results Page URL.
			newsSearchResultsPageUrl: '',
			//The value of Events Search Results Page URL.
			eventsSearchResultsPageUrl: '',
			//The value of Files Search Results Page URL.
			filesSearchResultsPageUrl: '',
			//The value of Sites Search Results Page URL.
			sitesSearchResultsPageUrl: '',
			//The value of People Search Results Page URL.
			peopleSearchResultsPageUrl: '',
		    //The value of People Search Advanced Results Page URL.
			peopleSearchAdvancedResultsPageUrl: '',
			//The value of Help Search Results Page URL.
			helpSearchResultsPageUrl: '',
			//The value of Footer Copyright.
			footerCopyright: '',

			//The Bah.Widgets term set.
			widgets: {
				//The Resources raw term collection object.
				resources: {},
				stayConnected: {},
				featuredNews: {
					categories: {},
					archivePageUrl: ''
				},
				homePageEvents: {
					itemCount: ''
				},
				userProfileDropdown: {
					viewProfileUrl: '',
					editProfileUrl: '',
					uploadPhotoUrl: ''
				},
				myCareer: {
					taleoSearchUrl: '',
					taleoApplicationUrl: ''
				}
			},

			//Initiates the asynchronous call to get the term set properties. Returns a jQuery promise.
			loadProperties: function () {
				return loadProperties();
			}
		}
	})();
})(jQuery);
///#source 1 1 Custom/bs.dotdotdoter.js
var BS = BS || {};
//This script runs dotdotdot automatically for all elements with the data-dot-max-height attribute, and has a public method to reload dotdotdot as well.
(function ($) {
	BS.dotdotdoter = (function () {
		//Page load event.
		$(window).load(function () {
			init();
		});

		//Runs dotdotdot for all elements on the page.
		var init = function () {
			var $elements = $('[data-dot-max-height]');
			runDotDotDot($elements);
		}

		var initElement = function (elementSelector) {
			var $element = $(elementSelector);

			runDotDotDot($element);
		}

		//Runs dotdotdot for the given elements.
		var runDotDotDot = function ($elements) {
			$elements.each(function () {
				var $this = $(this);
				var autoHeight = $this.data('dot-max-height') === 'auto';
				var maxHeight = autoHeight ? null : $this.data('dot-max-height');
				var moreSelector = '';
				var callback = null;

				if ($this.data().hasOwnProperty('dotMore')) {
					moreSelector = $this.data('dot-more');
				}

				if (autoHeight) {
					callback = function (isTruncated, orgContent) {
						if ($this.data('dot-initialized') === 'true') {
							$this.removeData('dot-initialized').trigger("destroy").text(orgContent.text());
							initElement($this);
						}

						if (isTruncated) {
							$this.data('dot-initialized', 'true');
						}
					};
				}

				$this.dotdotdot({
					after: moreSelector,
					height: maxHeight,
					watch: 'window',
					callback: callback
				});
			});
		};

		return {
			//Reloads dotdotdot for the whole page.
			reload: function () {
				init();
			},

			//Parses a given element looking for dotdotdot elements and re-runs the plugin only for them.
			parseElement: function (elementSelector) {
				var $elementToParse = $(elementSelector);
				var $elements = $elementToParse.find('[data-dot-max-height]');

				runDotDotDot($elements);
			},

			//Re inits dotdotdot for a given element.
			reInitElement: function (elementSelector) {
				initElement(elementSelector);
			}
		}
	})();
})(jQuery);
///#source 1 1 Custom/extensions.js
(function ($) {
    SP.SOD.executeOrDelayUntilScriptLoaded(function () {
        SP.ListItem.prototype.tryGetFieldValue = function (fieldInternalName) {
            var result = '';
            try {
                result = this.get_item(fieldInternalName);
            } catch (e) {
            }

            return result;
        };

        SP.ListItem.prototype.tryGetUrlFieldValue = function (fieldInternalName) {
            var result = '';
            try {
                var str = this.get_item(fieldInternalName);
                result = str.get_url();
            } catch (e) {
            }

            return result;
        };


        SP.ListItem.prototype.tryGetImageFieldValue = function (fieldInternalName) {
            var result = '';
            try {
                str = this.get_item(fieldInternalName);

                var regex = /<img.*?src="(.*?)"/;

                if (str.indexOf("src") >= 0) {
                    result = regex.exec(str)[1];
                }
            } catch (e) {
            }

            return result;
        };

        String.prototype.customFormat = function () {
            var s = this,
                i = arguments.length;

            while (i--) {
                s = s.replace(new RegExp('\\{' + i + '\\}', 'gm'), arguments[i]);
            }
            return s;
        };

        String.prototype.insertAtPosition = function (index, string) {
            if (index > 0)
                return this.substring(0, index) + string + this.substring(index, this.length);
            else
                return string + this;
        };
    }, "SP.js");
})(jQuery);
///#source 1 1 Widgets/UserProfile/userProfileView.js
var Widgets = Widgets || {};
var nameCtrl = null;

try {
	if (window.ActiveXObject !== undefined) {
		nameCtrl = new ActiveXObject("Name.NameCtrl.1");
	} else {
		nameCtrl = CreateNPApiOnWindowsPlugin("application/x-sharepoint-uc");
	}

	$('.groupMembersContainer aside').each(function () {
		var userLogin = $(this).data('id')

		$('figure', this).hover(function () {
			showLyncPresencePopup(userLogin, this);
		}, function () {
			hideLyncPresencePopup();
		});
	});
} catch (ex) {
}

function ResetUserPhoto(username) {
    if (confirm("Do you want to remove your photo?")) {
        Bah.updateUserProperty2(decodeURIComponent(username), "PictureURL", "");
    }
}

function UPSetProfilePicture() {
    
    // First get the file buffer and then send the request.
    var file = $('#profilePic')[0].files[0];

    if (file)
    {
		var sizeInMb = file.size / 1024;
		var sizeLimit = 1024 * 7;

        if (sizeInMb > sizeLimit) {
			alert("Image file size is bigger than 7MB. Please, select a smaller image.");
			$('#profilePic')[0].val("");
		}
    }

    var call = getFileBuffer();
    call.done(function (arrayBuffer) {
        setMyProfilePicture(arrayBuffer);
    });
    call.fail(function (error) {
        alert(error);
    });

    // Get the ArrayBuffer for the picture file.
    function getFileBuffer() {

        // Get the file from the file input control on the page.
        // Pictures can be BMP, JPG, or PNG format and up to 5 million bytes.
        var file = $('#profilePic')[0].files[0];
        if (file) {
            $("#topStatus").html("<div class='ms-status-yellow' style='display: block;padding:5px'><span tabindex='0' role='alert' class='ms-status-status'><span class='ms-accessible'>Very Important Status</span><span class='ms-status-iconSpan'><img class='ms-status-iconImg' src='/_layouts/15/images/spcommon.png'></span><span class='ms-status-body'>Uploading...</span><br></span></div>")
            
            var deferred = $.Deferred();
            var reader = new FileReader();
            reader.onloadend = function (e) {
                deferred.resolve(e.target.result);
            }
            reader.onerror = function (e) {
                deferred.reject(e.target.error);
            }
            reader.readAsArrayBuffer(file);
            return deferred.promise();
        }
        else {                     
            $("#topStatus").html("<div class='ms-status-red' style='display: block;padding:5px'><span tabindex='0' role='alert' class='ms-status-status'><span class='ms-accessible'>Very Important Status</span><span class='ms-status-iconSpan'><img class='ms-status-iconImg' src='/_layouts/15/images/spcommon.png'></span><span class='ms-status-body'>No file was uploaded. Try again.</span><br></span></div>")
        }
    }

    // Send the POST request.
    function setMyProfilePicture(arrayBuffer) {

        // Get the site URL and construct the endpoint URI for the rest post.
        var absoluteUrl = _spPageContextInfo.webAbsoluteUrl;
        var setPictureEndpoint = absoluteUrl +
            "/_api/sp.userprofiles.peoplemanager/setmyprofilepicture";

        $.ajax({
            url: setPictureEndpoint,
            type: "POST",
            data: arrayBuffer,
            processData: false,
            headers: {
                "accept": "application/json;odata=verbose",
                "X-RequestDigest": $("#__REQUESTDIGEST").val(),
                "content-length": arrayBuffer.byteLength
            },
            success: function (data) {
                $("#topStatus").html("<div class='ms-status-green' style='display: block;padding:5px'><span tabindex='0' role='alert' class='ms-status-status'><span class='ms-accessible'>Very Important Status</span><span class='ms-status-iconSpan'><img class='ms-status-iconImg' src='/_layouts/15/images/spcommon.png'></span><span class='ms-status-body'>Succesfully uploaded.</span><br></span></div>")

                setTimeout(function () {
                    CloseDialog();
                }, 2000);
                
            },
            error: function (error) {
                alert(error.responseText);
            }
        });
    }
}

function CloseDialog() {
    try { 
        window.frameElement.cancelPopUp(); 
    }
    catch(e) {
        if (Boolean(top) && Boolean(top.postMessage)) 
        top.postMessage('CloseDialog', '*');
    }
}

function SelectUserImage() {
    var options = SP.UI.$create_DialogOptions();

    options.title = "Select a photo";
    options.height = 180;
    options.width = 600;
    options.showClose = false;

    var element = document.createElement('div');
    element.innerHTML = "<div id='myResourcesModal' style='min-width:600px'><br /><h2 style='float:left'>Upload a photo</h2></div><div style='float:right'><a href='#' onclick='CloseDialog(); return false;' style='font-size:2rem; line-height:1; color:#aaaaaa; font-weight: bold; text-decoration:none; font-family: robotoregural, Arial, Helvetica, sans-serif; position: absolute; top: 0.5rem; right: 0.6875rem'>x</a></div><div id='topStatus' style='float:left;width:100%;margin-top:25px;margin-bottom:5px'></div><br /><div style='float:left;width:100%'><input type='file' id='profilePic' dir='ltr' accept='image/*' size='42' /></div><div style='float: right'><input value='Upload' onclick='javascript:UPSetProfilePicture(); return false;' class='ms-ButtonHeightWidth' type='button' id='uploadPhoto'><input class='ms-ButtonHeightWidth' value='Cancel' onclick='CloseDialog(); return false;' type='button' id='cancelPhoto'></div><div style='float:left;width:100%'><br/>Please be patient, changes to profile picture are not immediately reflected.</div>";

    options.html = element;

    SP.UI.ModalDialog.showModalDialog(options);

    $(".ms-dlgTitle").hide();
}

(function ($) {
	Widgets.userProfileView = {
		name: "user profile view",
		log: true,
		fetch: Bah.UPQuery,

		parse: function (result) {
			var foldates = [];
			if (result.data) {
			    var data = result.data;
			    var internalEditLink = "#";
				var terms2 = result["FOL Dates"];
				var editUrl = Bah.configuration.widgets.userProfileDropdown.editProfileUrl;
				var viewUrl = Bah.configuration.widgets.userProfileDropdown.viewProfileUrl;
				var uploadUrl = Bah.configuration.widgets.userProfileDropdown.uploadPhotoUrl;

				if (result["Deep Links"]) {
				    var terms = result["Deep Links"];

				    var termEnumerator = terms.getEnumerator();
				    while (termEnumerator.moveNext()) {
				        var currentTerm = termEnumerator.get_current();

				        if (currentTerm.get_name() == $(this.container).data('termname')) {
				            var customProperties = currentTerm.get_objectData().get_properties()["CustomProperties"];
				            internalEditLink = customProperties["Internal Deep Link URL"] || "#";
				        }
				    }
				}

				if (data && data.d.UserProfileProperties) {
					var properties = lazy(data.d.UserProfileProperties.results);
					var username = encodeURIComponent(properties.find(function (x) { return x.Key == "AccountName" }).Value);
					var profileUrl = "/" + _spPageContextInfo.layoutsUrl + "/userphoto.aspx?size=L&accountname=" + username;
					var preferredName = properties.find(function (x) { return x.Key == "PreferredName" }).Value;
					var email = properties.find(function (x) { return x.Key == "WorkEmail" }).Value || properties.find(function (x) { return x.Key == "UserName" }).Value;
					var lastName = properties.find(function (x) { return x.Key == "LastName" }).Value;
					var firstName = properties.find(function (x) { return x.Key == "FirstName" }).Value;
					var sipAddress = properties.find(function (x) { return x.Key == "SPS-SipAddress" }).Value;
					var alignment = properties.find(function (x) { return x.Key == "SPS-JobTitle" }).Value;

				    firstName = preferredName.substring(preferredName.lastIndexOf(",") + 2, preferredName.lastIndexOf("[") - 1)

					if (Bah.isNullOrEmpty(alignment))
					{ alignment = ""; }
					var workPhone = properties.find(function (x) { return x.Key == "WorkPhone" }).Value;
					var mobilePhone = properties.find(function (x) { return x.Key == "CellPhone" }).Value;

					var hireDate = properties.find(function (x) { return x.Key == "SPS-HireDate" }).Value;

					var location = "";
					try {
						location = properties.find(function (x) { return x.Key == "BAHOffice" }).Value;
					} catch (e) { }
					var careertrack = "";
					try {
						careertrack = properties.find(function (x) { return x.Key == "BAHCareerTrack" }).Value;
					} catch (e) { }
					var usersgroup = "";
					try {
						usersgroup = properties.find(function (x) { return x.Key == "BAHGroup" }).Value;
					} catch (e) { }

					var role = "";
					try {
						role = properties.find(function (x) { return x.Key == "BAHRolePrimary" }).Value;
					} catch (e) { }

					var roleYears = "";
                    try {
                        roleYears = properties.find(function (x) { return x.Key == "BAHRolePrimaryYears" }).Value;
                    } catch (e) { }

					var fols = 1;
					if (terms2) {
						var termEnumerator = terms2.getEnumerator();

						while (termEnumerator.moveNext()) {
							var currentTerm = termEnumerator.get_current();
							var customProperties = currentTerm.get_objectData().get_properties()["CustomProperties"];
							var className = "green";

							var folp = "";
							try {
								folp = properties.find(function (x) { return x.Key == "BAHFOLP" + fols }).Value;
							} catch (e) { }
							if (!Bah.isNullOrEmpty(folp)) {
								if (folp > 75)
								    className = 'gray';
								else if (folp > 50)
								    className = 'blue';
								else if (folp > 25)
								    className = 'yellow';
								else if (folp > 0)
									className = '';
							}

							foldates.push({ period: customProperties["UP Date"] || "", value: folp, classname: className });
							fols++;
						}
					}

					var bahAccountGroup = "";
					var bahRC = "";
					var bahIMT = "";
					var bahCluster = "N/A";
					var bahCapability = "";

				    try {
				        bahCapability = properties.find(function (x) { return x.Key == "BAHCapability" }).Value;// personProperties.get_userProfileProperties()["BAHCluster"] != undefined ? personProperties.get_userProfileProperties()["BAHCluster"] : '';
				    } catch (e) { }

					try {
						bahCluster = properties.find(function (x) { return x.Key == "BAHCluster" }).Value;// personProperties.get_userProfileProperties()["BAHCluster"] != undefined ? personProperties.get_userProfileProperties()["BAHCluster"] : '';
					} catch (e) { }

					try {
						bahIMT = properties.find(function (x) { return x.Key == "BAHIMT" }).Value;// personProperties.get_userProfileProperties()["BAHIMT"] != undefined ? personProperties.get_userProfileProperties()["BAHIMT"] : '';
					} catch (e) { }

					try {
						bahRC = properties.find(function (x) { return x.Key == "BAHRC" }).Value;// personProperties.get_userProfileProperties()["BAHRC"] != undefined ? personProperties.get_userProfileProperties()["BAHRC"] : '';
					} catch (e) { }

					try {
						bahAccountGroup = properties.find(function (x) { return x.Key == "BAHAccountGroup" }).Value; //personProperties.get_userProfileProperties()["BAHAccountGroup"] != undefined ? personProperties.get_userProfileProperties()["BAHAccountGroup"] : '';
					} catch (e) { }

					//Assigns the Bah Configuration Term set values to the Resume Hyperlink.
					var siteUrl = Bah.configuration.resumeCenterUrl;
					var libraryName = Bah.configuration.resumeLibraryname;
					var usrName = decodeURIComponent(username);
					var accName = usrName.substring(usrName.lastIndexOf("|")+1, usrName.length);

					Bah.CheckFileExists(siteUrl, siteUrl.substring(_spPageContextInfo.siteAbsoluteUrl.length), libraryName, accName, "pdf", function (data) {
						var date2 = new Date(data.modified);

						$("#resumeLinkColumn").html("<div class='txt-head'><i class='fa fa-file-text-o'></i>resume</div><a target='_blank' href='" + data.url + "'>" + (date2.getMonth() + 1) + "/" + date2.getDate() + "/" + date2.getFullYear() + "</a>");
					}, function () {
					    Bah.CheckFileExists(siteUrl, siteUrl.substring(_spPageContextInfo.siteAbsoluteUrl.length), libraryName, accName, "doc", function (data) {
							var date2 = new Date(data.modified);

							$("#resumeLinkColumn").html("<div class='txt-head'><i class='fa fa-file-text-o'></i>resume</div><a target='_blank' href='" + data.url + "'>" + (date2.getMonth() + 1) + "/" + date2.getDate() + "/" + date2.getFullYear() + "</a>");
					    }, function () {
					        Bah.CheckFileExists(siteUrl, siteUrl.substring(_spPageContextInfo.siteAbsoluteUrl.length), libraryName, accName, "docx", function (data) {
					            var date2 = new Date(data.modified);

					            $("#resumeLinkColumn").html("<div class='txt-head'><i class='fa fa-file-text-o'></i>resume</div><a target='_blank' href='" + data.url + "'>" + (date2.getMonth() + 1) + "/" + date2.getDate() + "/" + date2.getFullYear() + "</a>");
					        }, function () { });
					    });
					});

					var mode = $(this.container).data('mode');

					return {
					    editprofile: editUrl + "?user=" + username,
					    viewprofile: viewUrl + "?user=" + username,
						username: username,
						email: email,
						pictureurl: profileUrl,
						firstname: firstName,
						lastname: lastName,
						alignment: alignment,
						workphone: workPhone,
						mobilephone: mobilePhone,
						location: location,
						accountgroup: bahAccountGroup,
						rc: bahRC,
						imt: bahIMT,
						cluster: bahCluster,
						capability: bahCapability,
						hiredate: hireDate,
						usersgroup: usersgroup,
						careertrack: careertrack,
						role: role,
						roleyears: roleYears,
						foldates: foldates,
						displaycog: decodeURIComponent(username).indexOf(_spPageContextInfo.userLoginName) >= 0 ? true : false,
						sipaddress: sipAddress,
						editlink: internalEditLink,
                        mode: mode,
                        uploadphotolink: _spPageContextInfo.siteAbsoluteUrl + "/_layouts/15/SelectPicture2.aspx?Type=User&accountname=" + username + "&IsDlg=1"
					}
				}
			}
			return [];
		},

		bind: function (template, data) {
			var template = Handlebars.compile(template);
			var html = template(data);
			return html;
		},

		render: function (data) {
			$(this.container).html(data);

			var figureElement = $(this.container).find('figure');
			if (figureElement) {
				$(this.container).find('figure').hover(function () {
					Bah.showLyncPresencePopup(figureElement.data("id"), this);
				}, function () {
					Bah.hideLyncPresencePopup();
				});
			};

			//ACCORDION BUTTON ACTION (ON CLICK DO THE FOLLOWING)
			$('.accordionButton2').click(function () {
				//REMOVE THE ON CLASS FROM ALL BUTTONS
				$('.accordionButton2').removeClass('active');

				//NO MATTER WHAT WE CLOSE ALL OPEN SLIDES
				$('.accordionContent2').slideUp('normal');

				//IF THE NEXT SLIDE WASN'T OPEN THEN OPEN IT
				if ($(this).next().is(':hidden') == true) {
					//ADD THE ON CLASS TO THE BUTTON
					$(this).addClass('active');

					//OPEN THE SLIDE
					$(this).next().slideDown('normal');
				}
			});

			/*** REMOVE IF MOUSEOVER IS NOT REQUIRED ***/

			//ADDS THE .OVER CLASS FROM THE STYLESHEET ON MOUSEOVER
			$('.accordionButton2').mouseover(function () {
				$(this).addClass('over');

				//ON MOUSEOUT REMOVE THE OVER CLASS
			}).mouseout(function () {
				$(this).removeClass('over');
			});

		    //Change Organization Chart link in HTML View
			$(".ms-profileBrowserContent").find("a:last").attr("href", $(this.container).find("#viewUserProfileUrl").val());
		},
		template: function () {
			return $("#userProfileViewTemplate").html();
		},
		fail: function (error, event) {
			Bah.logging.error(event, this.name);
		}
	};
})(jQuery);
///#source 1 1 Widgets/UserProfile/userProfileTags.js
var Widgets = Widgets || {};

(function ($) {
	var widgetUserTags = {
		name: "user profile tags",
		log: true,
		fetch: Bah.UPQuery,
		parse: function (result) {
			var viewModel = [];
			var internalEditLink = "#"; 
			if (result.data) {
				var data = result.data;
				if (result["Deep Links"]) {
				    var terms = result["Deep Links"];

				    var termEnumerator = terms.getEnumerator();
				    while (termEnumerator.moveNext()) {
				        var currentTerm = termEnumerator.get_current();

				        if (currentTerm.get_name() == $(this.container).data('termname')) {
				            var customProperties = currentTerm.get_objectData().get_properties()["CustomProperties"];
				            internalEditLink = customProperties["Internal Deep Link URL"] || "#";
				        }
				    }
				}

				if (data && data.d.UserProfileProperties) {
					// var personProperties = result.personProperties;
					var properties = lazy(data.d.UserProfileProperties.results);

					var tagsTerm = "";//personProperties.get_userProfileProperties()[$(this.container).data('property')] != undefined ? personProperties.get_userProfileProperties()[$(this.container).data('property')] : '';
					var propertyName = $(this.container).data('property');
					try {
						tagsTerm = properties.find(function (x) { return x.Key == propertyName }).Value;
					}
					catch (err) { }

					var tags = tagsTerm.split($(this.container).data('separator'));

					var propertyNamePrimaryFC = $(this.container).data('propertyprimaryfc');
					if (propertyNamePrimaryFC) {
						var tagPFC = "";
						try {
							tagPFC = properties.find(function (x) { return x.Key == propertyNamePrimaryFC }).Value;
						}
						catch (err) { }

						if (!Bah.isNullOrEmpty(tagPFC)) {
							tags.unshift(tagPFC);
						}
					}

					var mode = $(this.container).data('mode');
					var title = $(this.container).data('title');

					var tagsArray5 = [];
					var tagsArray = [];

					tags.sort();

					for (var i = 0; i < tags.length; i++) {
						if (tags[i] != null && tags[i] != "") {
							var item = tags[i];
							if (i < 5) {
								tagsArray5.push({ tag: item });
							}
							else {
								tagsArray.push({ tag: item });
							}
						}
					}
				}
			}

			var display = false;

			if ((tagsArray5.length > 0) || (mode == "edit")) { display = true; }

			return {
				tags5: tagsArray5,
				tags: tagsArray,
				mode: mode,
				title: title,
				editlink: internalEditLink,
				controlId: propertyName + "hiddensection",
				droptarget: propertyName,
				display: display
			}
		},
		bind: function (template, data) {
			var template = Handlebars.compile(template);
			var html = template(data);
			return html;
		},

		render: function (data) {
			$(this.container).html(data);
		},
		template: function () {
			return $("#userProfileTagsTemplate").html();
		},

		fail: function (error, event) {
			Bah.logging.error(event, this.name);
		}
	};

	Widgets.userProfileTagsSkills = jQuery.extend({}, widgetUserTags);
	Widgets.userProfileTagsCertifications = jQuery.extend({}, widgetUserTags);
	Widgets.userProfileTagsPastProjects = jQuery.extend({}, widgetUserTags);
	Widgets.userProfileTags = jQuery.extend({}, widgetUserTags);

	Widgets.userProfileTagsProposalExperience = jQuery.extend({}, widgetUserTags);
	Widgets.userProfileTagsHFC = jQuery.extend({}, widgetUserTags);
	Widgets.userProfileTagsSchool = jQuery.extend({}, widgetUserTags);
	Widgets.userProfileTagsInterests = jQuery.extend({}, widgetUserTags);
	Widgets.userProfileTagsLanguages = jQuery.extend({}, widgetUserTags);
	Widgets.userProfileTagsRoles = jQuery.extend({}, widgetUserTags);
	Widgets.userProfileTagsResponsibility = jQuery.extend({}, widgetUserTags);
	Widgets.userProfileTagsRelocationPreference = jQuery.extend({}, widgetUserTags);
})(jQuery);
///#source 1 1 Widgets/UserProfile/userProfileProperty.js
var Widgets = Widgets || {};

(function ($) {
	var widgetuserProperty = {
		name: "user profile property",
		log: true,
		fetch: Bah.UPQuery,
		parse: function (result) {
			var viewModel = [];
			var internalEditLink = "#";
			if (result.data) {
				var data = result.data;

				if (data && data.d.UserProfileProperties) {
					var properties = lazy(data.d.UserProfileProperties.results);

					var propertyName = $(this.container).data('property');
					var title = $(this.container).data('title');
					var mode = $(this.container).data('mode');
					var property = "";
					if (propertyName) {
						try {
							property = properties.find(function (x) { return x.Key == propertyName }).Value;
						}
						catch (err) {
						}

						return {
							property: property,
							mode: mode,
							droptarget: propertyName,
							title: title
						}
					}
				}
			}
			return [];
		},
		bind: function (template, data) {
			var template = Handlebars.compile(template);
			var html = template(data);

			return html;
		},

		render: function (data) {
		    var characters = 3600;
		    var id_result = "limitcounter";
		    var alertClass = "limitalert";

		    var container = $(this.container);
		    container.html(data);
		    $(container).find("textarea").jqte({
		        change: function (data) {
		            var editor = $(container).find(".jqte_editor");
		            if (editor) {
		                var text = $(container).find("textarea").val();
		                var cuttedText = text;

		                if (text.length > characters) {
		                    cuttedText = text.substr(0, characters);
		                    $(container).find("textarea").val(cuttedText);
		                    editor.html(cuttedText);
		                }

		                if (id_result != false) {
		                    var remaining = characters - editor.html().length;
		                    $("#" + id_result).html("You have <strong>" + remaining + "</strong> characters remaining");
		                    if (remaining <= 10) {
		                        $("#" + id_result).addClass(alertClass);
		                    }
		                    else {
		                        $("#" + id_result).removeClass(alertClass);
		                    }
		                }
		            }
		        }
		    });

		    var jqteEditor = $(container).find(".jqte_editor");

		    if (jqteEditor) {

		        jqteEditor.keypress(function (e) {
		            if (e.which != 8 && $(this).html().length >= characters) {
		                e.preventDefault();
		            }
		    });

		       
		        var remaining = characters - (jqteEditor.html() ? jqteEditor.html().length : 0);

		        if (remaining <= 10) {
		            $("#" + id_result).addClass(alertClass);
		        }
		        else {
		            $("#" + id_result).removeClass(alertClass);
		        }

		        $(container).find("#" + id_result).html("You have <strong>" + remaining + "</strong> characters remaining");

		    }
		},
		    template: function () {
                return $("#userProfilePropertyTemplate").html();
                },

                    fail: function (error, event) {
                        Bah.logging.error(event, this.name);
                        },
                            save: function () {
                                var container = $(this.container);
                                Bah.updateUserProperty2(decodeURIComponent(Bah.GetQueryStringParams("user")), container.data("property"), Bah.htmlEscape(container.find("textarea").val()))
		}
	};

	Widgets.userProfilePropertyAboutMe = jQuery.extend({}, widgetuserProperty);
	Widgets.userProfilePropertyBAHRelocationPreference = jQuery.extend({}, widgetuserProperty);
	Widgets.userProfilePropertyBAHTravelPercent = jQuery.extend({}, widgetuserProperty);
	Widgets.userProfilePropertyBAHTravelLocations = jQuery.extend({}, widgetuserProperty);
})(jQuery);
///#source 1 1 Widgets/UserProfile/editManagedMetadata.js



(function ($) {
	
   

	var UPeditManagedMetadataParse = function (result) {
		var viewModel = [];
		var firstCol = [];
		var secondCol = [];

		if (result.data) {
			var data = result.data;
			if (data && data.d.UserProfileProperties) {
				var properties = lazy(data.d.UserProfileProperties.results);

				var propertyName = $(this.container).data('property');
				var title = $(this.container).data('title');
				var description = $(this.container).data('description');
				var display = $(this.container).data('display');
				var termsetName = $(this.container).data('termname');

				var checked = false;

				if (propertyName) {
					try {
						var property = properties.find(function (x) { return x.Key == propertyName }).Value;
					}
					catch (err) { }

					var tags = property.split($(this.container).data('separator'));

					if (result[termsetName]) {
					    var terms = result[termsetName];

						if (terms) {
							var termEnumerator = terms.getEnumerator();
							var i = 0;
							while (termEnumerator.moveNext()) {
								var currentTerm = termEnumerator.get_current();
								var name = currentTerm.get_name();

								if ($.inArray(name, tags) >= 0) { checked = true; } else { checked = false; }
								if (i % 2) {
									firstCol.push({ tag: name, checkboxid: propertyName + i, ischecked: checked });
								}
								else {
									secondCol.push({ tag: name, checkboxid: propertyName + i, ischecked: checked });
								}
								i++;
							}
						}
					}

					return {
						property: property,
						title: title,
						name: propertyName,
						description: description,
						display: display,
						firstcol: firstCol,
						secondcol: secondCol,
						droptarget: propertyName
					}
				}
			}
		}
		return [];
	};

	var UPeditManagedMetadataParse2 = function (result) {
		var viewModel = [];

		if (result.data) {
			var data = result.data;
			if (data && data.d.UserProfileProperties) {
				var properties = lazy(data.d.UserProfileProperties.results);

				var propertyName = $(this.container).data('property');
				var title = $(this.container).data('title');
				var description = $(this.container).data('description');
				var display = $(this.container).data('display');

				if (propertyName) {
					try {
						var property = properties.find(function (x) { return x.Key == propertyName }).Value;
					}
					catch (err) {
					}

					return {
						property: property != undefined ? property.split('|').join('; ') : "",
						title: title,
						name: propertyName,
						description: description,
						display: display,
						droptarget: propertyName
					}
				}
			}
		}
		return [];
	};

	var UPeditManagedMetadataParse3 = function (result) {
		var viewModel = [];
		var firstCol = [];

		if (result.data) {
			var data = result.data;

			var property = "";
			var dropdownProperty = "";

			if (data && data.d.UserProfileProperties) {
				var properties = lazy(data.d.UserProfileProperties.results);

				var propertyName = $(this.container).data('property');
				var title = $(this.container).data('title');
				var description = $(this.container).data('description');
				var display = $(this.container).data('display');
				var dropdownPropertyName = $(this.container).data('dropdownproperty');
				var termsetName = $(this.container).data('termname');

				var checked = false;

				if (dropdownPropertyName) {
					try {
						var value = properties.find(function (x) { return x.Key == dropdownPropertyName }).Value;
						dropdownProperty = Bah.isNullOrEmpty(value) ? "0" : value;
					}
					catch (err) { }
				}

				if (propertyName) {
					try {
						property = properties.find(function (x) { return x.Key == propertyName }).Value;
					}
					catch (err) { }

					var tags = property.split($(this.container).data('separator'));
					var i = 0;
					if (result[termsetName]) {
					    var terms = result[termsetName];

					    var termEnumerator = terms.getEnumerator();

					    while (termEnumerator.moveNext()) {
					        var currentTerm = termEnumerator.get_current();
					        var name = currentTerm.get_name() == undefined ? "" : currentTerm.get_name();
					        if ($.inArray(name, tags) >= 0) { checked = true; } else { checked = false; }

					        firstCol.push({ tag: name, checkboxid: propertyName + i, ischecked: checked, name: propertyName });
					        i++;
					    }

					}

					return {
						property: property,
						title: title,
						name: propertyName,
						description: description,
						display: display,
						firstcol: firstCol,
						dropdownproperty: dropdownProperty,
						droptarget: propertyName
					}
				}
			}
		}
		return [];
	};

	var UPeditManagedMetadataBind = function (template, data) {
		var template = Handlebars.compile(template);
		var html = template(data);

		return html;
	};

	var UPeditManagedMetadataSave = function ()
	{
	    var container = $(this.container);

	    var terms = [];

	    if (container.data('display') == "checkbox") {
	        container.find("input[type = checkbox]:checked").each(function (key, value) {
	            terms.push(value.value);
	        });
	    }
	    else if (container.data('display') == "option") {
	        container.find("input:checked").each(function (key, value) {
	            terms.push(value.value);
	        });
	        if (!Bah.isNullOrEmpty(container.data("dropdownproperty"))) {
	            Bah.updateUserProperty2(decodeURIComponent(Bah.GetQueryStringParams("user")), container.data("dropdownproperty"), container.find("select").val());
	        }
	    }
	    else {
	        var trms = container.find("textarea").val().split(";");
	        for (var i = 0; i < trms.length; i++) {
	            var trm = trms[i].trim();
                if (!Bah.isNullOrEmpty(trm))
                {
                    terms.push(trm);
                }
            }
        }

	    Bah.updateUserProperty2(decodeURIComponent(Bah.GetQueryStringParams("user")), container.data("property"), terms);
	}

	var widgetmanagedMetadataProposalExperience = {
		name: "Edit managed metadata Proposal Experience",
		log: true,
		fetch: Bah.UPQuery,
		parse: UPeditManagedMetadataParse,
		bind: UPeditManagedMetadataBind,
		render: function (data) {
			$(this.container).html(data);
		},
		template: function () {
			return $("#editManagedMetadataTemplate").html();
		},
		fail: function (error, event) {
			Bah.logging.error(event, this.name);
		},
		save: UPeditManagedMetadataSave
	};

	var widgetmanagedMetadataRelocation = {
		name: "Edit managed metadata Region",
		log: true,
		fetch: Bah.UPQuery,
		parse: UPeditManagedMetadataParse,
		bind: UPeditManagedMetadataBind,
		render: function (data) {
			$(this.container).html(data);
		},
		template: function () {
			return $("#editManagedMetadataTemplate").html();
		},
		fail: function (error, event) {
			Bah.logging.error(event, this.name);
		},
		save: UPeditManagedMetadataSave
	};

	var widgetmanagedMetadataPastProjects = {
		name: "Edit managed metadata Past Projects",
		log: true,
		fetch: Bah.UPQuery,
		parse: UPeditManagedMetadataParse2,
		bind: UPeditManagedMetadataBind,
		render: function (data) {
			$(this.container).html(data);
		},
		template: function () {
			return $("#editManagedMetadataTemplate").html();
		},
		fail: function (error, event) {
			Bah.logging.error(event, this.name);
		},
		save: UPeditManagedMetadataSave
	};

	var widgetmanagedMetadataInterests = {
		name: "Edit managed metadata Interests",
		log: true,
		fetch: Bah.UPQuery,
		parse: UPeditManagedMetadataParse2,
		bind: UPeditManagedMetadataBind,
		render: function (data) {
			$(this.container).html(data);
		},
		template: function () {
			return $("#editManagedMetadataTemplate").html();
		},
		fail: function (error, event) {
			Bah.logging.error(event, this.name);
		},
		save: UPeditManagedMetadataSave
	};

	var widgetmanagedMetadataResponsibility = {
		name: "Edit managed metadata Responsibility",
		log: true,
		fetch: Bah.UPQuery,
		parse: UPeditManagedMetadataParse2,
		bind: UPeditManagedMetadataBind,
		render: function (data) {
			$(this.container).html(data);
		},
		template: function () {
			return $("#editManagedMetadataTemplate").html();
		},
		fail: function (error, event) {
			Bah.logging.error(event, this.name);
		},
		save: UPeditManagedMetadataSave
	};

	var widgetmanageWillingToTravel = {
		name: "Edit managed metadata Willingness to Travel",
		log: true,
		fetch: Bah.UPQuery,
		parse: UPeditManagedMetadataParse3,
		bind: UPeditManagedMetadataBind,
		render: function (data) {
			$(this.container).html(data);
		},
		template: function () {
			return $("#editManagedMetadataOptionTemplate").html();
		},
		fail: function (error, event) {
			Bah.logging.error(event, this.name);
		},
		save: UPeditManagedMetadataSave
	};

	var widgetmanagePositionOfTrush = {
		name: "Edit managed metadata Position of Trust",
		log: true,
		fetch: Bah.UPQuery,
		parse: UPeditManagedMetadataParse,
		bind: UPeditManagedMetadataBind,
		render: function (data) {
			$(this.container).html(data);
		},
		template: function () {
		    return $("#userProfilePositionOfTrustTemplate").html();
		},
		fail: function (error, event) {
			Bah.logging.error(event, this.name);
		},
		save: UPeditManagedMetadataSave
	};

	Widgets.editManagedMetadataProposalExperience = jQuery.extend({}, widgetmanagedMetadataProposalExperience);
	Widgets.editManagedMetadataRelocationPreference = jQuery.extend({}, widgetmanagedMetadataRelocation);
	Widgets.editManagedMetadataPastProjects = jQuery.extend({}, widgetmanagedMetadataPastProjects);
	Widgets.editManagedMetadataInterests = jQuery.extend({}, widgetmanagedMetadataInterests);
	Widgets.editManagedMetadataResponsibility = jQuery.extend({}, widgetmanagedMetadataResponsibility);
	Widgets.editManagedMetadataWillingToTravel = jQuery.extend({}, widgetmanageWillingToTravel);
	Widgets.editManagedMetadataPositionOfTrush = jQuery.extend({}, widgetmanagePositionOfTrush);
})(jQuery);
///#source 1 1 Widgets/UserProfile/editManagedMetadataDropdown.js
var travelPercentageValue;

(function ($) {
    
	var widgetManageTravelPercentage = {
		name: "Edit travel percentage",
		log: true,
		fetch: Bah.UPQuery,
		parse: function (result) {
			var viewModel = [];
			var firstCol = [];

			if (result.data) {
				var data = result.data;

				var property = "";

				if (data && data.d.UserProfileProperties) {
					var properties = lazy(data.d.UserProfileProperties.results);

					var propertyName = $(this.container).data('property');
					var title = $(this.container).data('title');
					var description = $(this.container).data('description');
					var locations = $(this.container).data('propertylocations');

					var checked = false;

					if (propertyName) {
					    try {
					        property = properties.find(function (x) { return x.Key == propertyName }).Value;
					    }
					    catch (err) {
					    }

					        if (locations)
					        {
					            try {
					                var propertyLocactions = properties.find(function (x) { return x.Key == locations }).Value;
					                if (propertyLocactions=="None") {
					                    property = "0%";
					                }
					            }
					            catch (err) { 
					            }
					        }

						var tags = property.split($(this.container).data('separator'));
						var i = 0;
						if (result["Percent"]) {
						    var terms = result["Percent"];

						    var termEnumerator = terms.getEnumerator();

						    while (termEnumerator.moveNext()) {
						        var currentTerm = termEnumerator.get_current();
						        var name = currentTerm.get_name() == undefined ? "" : currentTerm.get_name();
						        if ($.inArray(name, tags) >= 0) { checked = true; } else { checked = false; }

						        firstCol.push({ tag: name, ischecked: checked });
						        i++;
						    }

						}

						return {
							property: property,
							title: title,
							name: propertyName,
							description: description,
							firstcol: firstCol,
							droptarget: propertyName
						}
					}
				}
			}
			return [];
		},
		bind: function (template, data) {
			var template = Handlebars.compile(template);
			var html = template(data);

			return html;
		},

		render: function (data) {
		    var container = $(this.container);
		    container.html(data);
		    var selectBox = container.find('.select');
		    selectBox.selectbox({
		        onChange: function (val, inst) {
		            travelPercentageValue = val;
			    }
			});
		},
		template: function () {
			return $("#editManagedMetadataDropdownTemplate").html();
		},

		fail: function (error, event) {
			Bah.logging.error(event, this.name);
		},
		save: function () {
		    var container = $(this.container);
             
		    var value =container.find(".select").val();
		    if (travelPercentageValue){
		        value=travelPercentageValue;
		    }
		    
		    Bah.updateUserProperty2(decodeURIComponent(Bah.GetQueryStringParams("user")), container.data("property"), value);
		}
	};
	Widgets.editManagedMetadataTravelPercentage = jQuery.extend({}, widgetManageTravelPercentage);
})(jQuery);
///#source 1 1 Widgets/UserProfile/userProfileSecurityClearance.js
var disclosureSelectBox;
var eligibilitySelectBox;
var utilizationSelectBox;
var securitylevelSelectBox;

(function ($) {
	var widgetSecurityClearance = {
		name: "Edit security clearance",
		log: true,
		fetch: Bah.UPQuery,
		parse: function (result) {
			var viewModel = [];
			var firstCol = [];
			var secondCol = [];
			var thirdCol = [];
			var fourthCol = [];

			if (result.data) {
				var data = result.data;

				var diclosureProperty = "";
				var eligibilityProperty = "";
				var utilizationProperty = "";
				var securityLevelProperty = "";
				var securityDateProperty = "";

				if (data && data.d.UserProfileProperties) {
					var properties = lazy(data.d.UserProfileProperties.results);

					var diclosurePropertyName = $(this.container).data('disclosureproperty');
					var eligibilityPropertyName = $(this.container).data('eligibilityproperty');
					var utilizationPropertyName = $(this.container).data('utilizationproperty');
					var securityLevelPropertyName = $(this.container).data('securitylevelproperty');
					var securityDatePropertyName = $(this.container).data('securitydateproperty');

					var title = $(this.container).data('title');
					var description = $(this.container).data('description');

					var checkedDisclosure = false;
					var checkedEligibility = false;
					var checkedUtilization = false;
					var checkedSecurityLevel = false;

					if (diclosurePropertyName && eligibilityPropertyName && utilizationPropertyName && securityLevelPropertyName) {
						try {
							diclosureProperty = properties.find(function (x) { return x.Key == diclosurePropertyName }).Value;
						}
						catch (err) { }
						try {
							eligibilityProperty = properties.find(function (x) { return x.Key == eligibilityPropertyName }).Value;
						}
						catch (err) { }
						try {
							utilizationProperty = properties.find(function (x) { return x.Key == utilizationPropertyName }).Value;
						}
						catch (err) { }
						try {
							securityLevelProperty = properties.find(function (x) { return x.Key == securityLevelPropertyName }).Value;
						}
						catch (err) { }
						try {
							securityDateProperty = properties.find(function (x) { return x.Key == securityDatePropertyName }).Value;
						}
						catch (err) { }

						if (diclosureProperty == "") diclosureProperty = "No Response";
						if (utilizationProperty == "") utilizationProperty = "No Response";
						if (eligibilityProperty == "") eligibilityProperty = "No Response";

						var diclosureTags = diclosureProperty.split($(this.container).data('separator'));
						var eligibilityTags = eligibilityProperty.split($(this.container).data('separator'));
						var utilizationTags = utilizationProperty.split($(this.container).data('separator'));
						var securityLevelTags = securityLevelProperty.split($(this.container).data('separator'));

						var i = 0;
						if (result["Security Response"]) {
						    var terms = result["Security Response"];

						    var termEnumerator = terms.getEnumerator();

						    while (termEnumerator.moveNext()) {
						        var currentTerm = termEnumerator.get_current();
						        var name = currentTerm.get_name() == undefined ? "" : currentTerm.get_name();
						        if ($.inArray(name, diclosureTags) >= 0) { checkedDisclosure = true; } else { checkedDisclosure = false; }
						        if ($.inArray(name, eligibilityTags) >= 0) { checkedEligibility = true; } else { checkedEligibility = false; }
						        if ($.inArray(name, utilizationTags) >= 0) { checkedUtilization = true; } else { checkedUtilization = false; }

						        firstCol.push({ tag: name, ischecked: checkedDisclosure });
						        secondCol.push({ tag: name, ischecked: checkedEligibility });
						        thirdCol.push({ tag: name, ischecked: checkedUtilization });
						        i++;
						    }

						}

						if (result["Security Clearance"]) {
						    var terms2 = result["Security Clearance"];


						    var termEnumerator = terms2.getEnumerator();

						    while (termEnumerator.moveNext()) {
						        var currentTerm = termEnumerator.get_current();
						        var name = currentTerm.get_name() == undefined ? "" : currentTerm.get_name();
						        if ($.inArray(name, securityLevelTags) >= 0) { checkedSecurityLevel = true; } else { checkedSecurityLevel = false; }

						        fourthCol.push({ tag: name, ischecked: checkedSecurityLevel });

						    }
						}

						return {
							diclosureproperty: diclosureProperty,
							eligibilityproperty: eligibilityProperty,
							utilizationproperty: utilizationProperty,
							date: securityDateProperty,
							firstcol: firstCol,
							secondcol: secondCol,
							thirdcol: thirdCol,
							fourthcol: fourthCol
						}
					}
				}
			}
			return [];
		},
		bind: function (template, data) {
			var template = Handlebars.compile(template);
			var html = template(data);

			return html;
		},

		render: function (data) {
		    var container = $(this.container);

			container.html(data);
			container.find("#datepicker").datepicker();
			$('.select').selectbox({
			    onChange: function (val, inst) {	       
			        if (this.name == "disclosure") {
			            if (val != "Yes") {
			                container.parent().find(".hiddensection").each(function () {
			                    $(this).hide();
			                });
			            }
			            else {
			                container.parent().find(".hiddensection").each(function () {
			                    $(this).show();
			                });
			            }

			            disclosureSelectBox = val;
			        }

			        if (this.name == "eligibility") {
			            eligibilitySelectBox = val;
			        }
			        if (this.name == "utilization") {
			            utilizationSelectBox = val;
			        }
			        if (this.name == "securitylevel") {
			            securitylevelSelectBox = val;
			        }
			    }
			});

			var disclosurecontrol = container.find("[name='disclosure']");
			if (disclosurecontrol) {

			    var disclosurevalue = disclosurecontrol.val();

			    if (disclosurevalue != "Yes") {
			        container.parent().find(".hiddensection").each(function () {
			            $(this).hide();
			        });
			    }
			}
		},
		template: function () {
			return $("#userProfileSecurityClearanceTemplate").html();
		},

		fail: function (error, event) {
			Bah.logging.error(event, this.name);
		},
		save: function () {
		    var container = $(this.container);

		    if (!disclosureSelectBox) {
		        disclosureSelectBox = container.find("[name='disclosure']").val();
		    }
		    if (!eligibilitySelectBox) {
		        eligibilitySelectBox = container.find("[name='eligibility']").val();
		    }
		    if (!utilizationSelectBox) {
		        utilizationSelectBox = container.find("[name='utilization']").val();
		    }
		    if (!securitylevelSelectBox) {
		        securitylevelSelectBox = container.find("[name='securitylevel']").val()
		    }

		    Bah.updateUserProperty2(decodeURIComponent(Bah.GetQueryStringParams("user")), container.data("disclosureproperty"), disclosureSelectBox);
		    Bah.updateUserProperty2(decodeURIComponent(Bah.GetQueryStringParams("user")), container.data("eligibilityproperty"), eligibilitySelectBox);
		    Bah.updateUserProperty2(decodeURIComponent(Bah.GetQueryStringParams("user")), container.data("utilizationproperty"), utilizationSelectBox);
		    Bah.updateUserProperty2(decodeURIComponent(Bah.GetQueryStringParams("user")), container.data("securitylevelproperty"), securitylevelSelectBox);
			Bah.updateUserProperty2(decodeURIComponent(Bah.GetQueryStringParams("user")), container.data("securitydateproperty"), $(this.container).find("#datepicker").val());
		}
	};
	Widgets.userProfileSecurityClearance = jQuery.extend({}, widgetSecurityClearance);
})(jQuery);
///#source 1 1 Widgets/UserProfile/userProfileUploadResume.js
var Widgets = Widgets || {};
var firstNameLastName = "";

(function ($) {
	Widgets.userProfileUploadResume = {
		name: "user profile resume upload",
		log: true,
		fetch: Bah.UPQuery,
		parse: function (result) {
			var viewModel = [];

			if (result.data) {
				var data = result.data;

				if (data && data.d.UserProfileProperties) {
					var properties = lazy(data.d.UserProfileProperties.results);

					firstNameLastName = properties.find(function (x) { return x.Key == "FirstName" }).Value + " " + properties.find(function (x) { return x.Key == "LastName" }).Value;

					var siteUrl = Bah.configuration.resumeCenterUrl;
					var libraryName = Bah.configuration.resumeLibraryname;

					Bah.CheckFileExists(siteUrl, siteUrl.substring(_spPageContextInfo.siteAbsoluteUrl.length), libraryName, _spPageContextInfo.userLoginName, "pdf", function (data) {
						$("#removeResumeForUpload").show();
					}, function () {
					    Bah.CheckFileExists(siteUrl, siteUrl.substring(_spPageContextInfo.siteAbsoluteUrl.length), libraryName, _spPageContextInfo.userLoginName, "doc", function (data) {
					        $("#removeResumeForUpload").show();
					    }, function () {
					        Bah.CheckFileExists(siteUrl, siteUrl.substring(_spPageContextInfo.siteAbsoluteUrl.length), libraryName, _spPageContextInfo.userLoginName, "docx", function (data) {
					            $("#removeResumeForUpload").show();
					        }, function () { });
					    });
					});
					

					return { siteurl: siteUrl, libraryname: libraryName };
				}
			}
			return [];
		},
		bind: function (template, data) {
			var template = Handlebars.compile(template);
			var html = template(data);

			return html;
		},

		render: function (data) {
			$(this.container).html(data);

			var fileInput = $(this.container).find("#fileResumeForUpload");
			var filenameInput = $(this.container).find("#filenameResumeForUpload");
			var fileExt = "";

			fileInput.change(function () {
				var file = this.files[0];
				var ext = file.name.substring(file.name.lastIndexOf(".") + 1);
				var sizeInMb = file.size / 1024;
				var sizeLimit = 1024 * 5;
				if (ext != "doc" && ext != "docx" && ext != "pdf") {
					alert("Resume file is not in correct format doc(x)/pdf.");
					filenameInput.val("");
					fileInput.val("");
				}
				else if (sizeInMb > sizeLimit) {
					alert("Resume file size is more then 5MB.");
					filenameInput.val("");
					fileInput.val("");
				}
				else {
					filenameInput.val($(this).val());
				}
			});

			$(this.container).find("#selectResumeForUpload").click(function () {
				fileInput.click()
			});

			var siteUrl = filenameInput.data("siteurl");
			var libraryName = filenameInput.data("libraryname");

			$(this.container).find("#submitResumeForUpload").click(function () {
				var loginName = _spPageContextInfo.userLoginName;
				if (fileInput[0].files[0]) {
					var file = fileInput[0].files[0];
					var ext = file.name.substring(file.name.lastIndexOf(".") + 1);

					Bah.DeleteFileCrossSite(siteUrl, siteUrl.substring(_spPageContextInfo.siteAbsoluteUrl.length), libraryName, loginName, "pdf", false);
					Bah.DeleteFileCrossSite(siteUrl, siteUrl.substring(_spPageContextInfo.siteAbsoluteUrl.length), libraryName, loginName, "doc", false);
					Bah.DeleteFileCrossSite(siteUrl, siteUrl.substring(_spPageContextInfo.siteAbsoluteUrl.length), libraryName, loginName, "docx", false);
					$("#statusForUpload").html("Uploading....");

					Bah.UploadFileCrossSite(file, siteUrl, libraryName, loginName, ext, function () {
					    
					Bah.CheckFileExists(siteUrl, siteUrl.substring(_spPageContextInfo.siteAbsoluteUrl.length), libraryName, _spPageContextInfo.userLoginName, "pdf", function (data) {
					    Bah.updateListItem(siteUrl, data.metadata, firstNameLastName + " " + Bah.GetUserWithoutDomain(loginName) + " Resume");
					}, function () {
					    Bah.CheckFileExists(siteUrl, siteUrl.substring(_spPageContextInfo.siteAbsoluteUrl.length), libraryName, _spPageContextInfo.userLoginName, "doc", function (data) {
					        Bah.updateListItem(siteUrl, data.metadata, firstNameLastName + " " + Bah.GetUserWithoutDomain(loginName) + " Resume");
					    }, function () {
					        Bah.CheckFileExists(siteUrl, siteUrl.substring(_spPageContextInfo.siteAbsoluteUrl.length), libraryName, _spPageContextInfo.userLoginName, "docx", function (data) {
					            Bah.updateListItem(siteUrl, data.metadata, firstNameLastName + " " + Bah.GetUserWithoutDomain(loginName) + " Resume");
					        }, function () { });
					    });
					});  

					var date2 = new Date();

					$("#resumeLinkColumn").html("<div class='txt-head'><i class='fa fa-file-text-o'></i>resume</div><a target='_blank' href='" + siteUrl + "/" + libraryName + "/" + Bah.GetUserWithoutDomain(loginName) + "." + ext + "'><i class='fa fa-file-text-o'></i>&nbsp;" + (date2.getMonth() + 1) + "/" + date2.getDate() + "/" + date2.getFullYear() + "</a>");
					$("#filenameResumeForUpload").val("");
					$("#removeResumeForUpload").show();
					$("#statusForUpload").html("Resume has been successfully uploaded.");
					} );
                    
				}
			});

			$(this.container).find("#removeResumeForUpload").click(function () {
				var loginName = _spPageContextInfo.userLoginName;
				$("#statusForUpload").html("Removing....");
				$.when(Bah.DeleteFileCrossSite(siteUrl, siteUrl.substring(_spPageContextInfo.siteAbsoluteUrl.length), libraryName, loginName, "pdf", true),
				Bah.DeleteFileCrossSite(siteUrl, siteUrl.substring(_spPageContextInfo.siteAbsoluteUrl.length), libraryName, loginName, "doc", true),Bah.DeleteFileCrossSite(siteUrl, siteUrl.substring(_spPageContextInfo.siteAbsoluteUrl.length), libraryName, loginName, "docx", true)).then(function (data, data2, data3) {
					$("#statusForUpload").html("Resume has been successfully removed.");

					$("#resumeLinkColumn").html("<div class='txt-head'><i target='_blank' class='fa fa-file-text-o'></i>resume</div>No resume uploaded");
					$("#filenameResumeForUpload").val("");
					$("#removeResumeForUpload").hide();
				})
			});
		},
		template: function () {
			return $("#userProfileUploadResumeTemplate").html();
		},

		fail: function (error, event) {
			Bah.logging.error(event, this.name);
		}
	};
})(jQuery);
///#source 1 1 Widgets/UserProfile/userProfileWillingToTravel.js
var Widgets = Widgets || {};

(function ($) {
	Widgets.userProfileWillingToTravel = {
		name: "willing to travel",
		log: true,
		fetch: Bah.UPQuery,
		parse: function (result) {
			var viewModel = [];

			if (result.data) {
				var data = result.data;

				if (data && data.d.UserProfileProperties) {
					var properties = lazy(data.d.UserProfileProperties.results);
					var username = encodeURIComponent(properties.find(function (x) { return x.Key == "AccountName" }).Value);
					var tagsTerm = "";
					var propertyName = $(this.container).data('propertyrelocationpreference');
					try {
						tagsTerm = properties.find(function (x) { return x.Key == propertyName }).Value;
					}
					catch (err) { }

					var tags = tagsTerm.split($(this.container).data('separator'));
					var travelpercent;
					var travellocations;

					var propertyNameTravelPercent = $(this.container).data('propertytravelpercent');
					if (propertyNameTravelPercent) {
						try {
							travelpercent = properties.find(function (x) { return x.Key == propertyNameTravelPercent }).Value;
						}
						catch (err) { }
					}

					var propertyNameTravelLocations = $(this.container).data('propertytravellocations');
					if (propertyNameTravelLocations) {
						try {
						    travellocations = properties.find(function (x) { return x.Key == propertyNameTravelLocations }).Value;
						    if (travellocations == "None") travelpercent = "";
						}
						catch (err) { }
					}

					var tagsArray5 = [];
					var tagsArray = [];

					for (var i = 0; i < tags.length; i++) {
						if (tags[i] != null && tags[i] != "") {
							var item = tags[i];
							if (i < 5) {
								tagsArray5.push({ tag: item });
							}
							else {
								tagsArray.push({ tag: item });
							}
						}
					}
				}
			}
			return {
				tags5: tagsArray5,
				tags: tagsArray,
				travelpercent: travelpercent,
				travellocations: travellocations,
				controlId: propertyName + "hiddensection",
				display: decodeURIComponent(username).indexOf(_spPageContextInfo.userLoginName) >= 0 ? true : false,
				droptarget: propertyName
			}
		},
		bind: function (template, data) {
			var template = Handlebars.compile(template);
			var html = template(data);
			return html;
		},

		render: function (data) {
			$(this.container).html(data);
		},
		template: function () {
			return $("#userProfileWillingToTravelTemplate").html();
		},

		fail: function (error, event) {
			Bah.logging.error(event, this.name);
		}
	};
})(jQuery);
///#source 1 1 Widgets/TeamSite/taxonomypickercontrol.js
var CAMControl;
(function (CAMControl) {
    var spContext; //global sharepoint context used throughout the taxonomy picker control (set in the taxpicker constructor)
    var taxIndex = 0; //keeps index of the taxonomy pickers in use
    
    //********************** START Term Class **********************
    //constructor for Term
    function Term(rawTerm) {
        if (rawTerm != null) {
            this.Id = rawTerm.get_id().toString(); //Id of the Term from SharePoint
            this.Name = rawTerm.get_name(); //Default label for the term in SharePoint
            this.PathOfTerm = rawTerm.get_pathOfTerm(); //label path of term delimited by semi-colons (ex: World;Europe;Finland)
            this.Children = new Array(); //child terms of the term
            this.Level = rawTerm.get_pathOfTerm().split(';').length - 1; //integer indicating the level of the term
            this.RawTerm = rawTerm;
        }
    }
    $.extend(Term.prototype, {
        //creates a cloned copy of a term to avoid reference issues
        clone: function () {
            return new Term(this.RawTerm);
        },
        //converts a term to an html tree node
        toHtmlLabel: function () {
            var addlClass = (this.Children.length > 0) ? 'collapsed' : '';
            return $('<li class="cam-taxpicker-treenode-li"><div class="cam-taxpicker-treenode"><div class="cam-taxpicker-expander ' + addlClass + '"></div><img src="/_layouts/15/Images/EMMTerm.png" alt=""/><span class="cam-taxpicker-treenode-title"  data-item="' + this.Name + '|' + this.Id + '">' + this.Name + '</span></div></li>');
        }
    });
    //********************** END Term Class **********************

    //********************** START TermSet Class **********************
    //constructor for TermSet
    function TermSet(options) {
        this.Id = options.termSetId; //Id of the TermSet in SharePoint
        this.UseHashtags = options.useHashtags; //bool indicating if the Hashtags termset is used during initalization
        this.UseKeywords = options.useKeywords; //bool indicating if the Keywords termset is used during initalization
        this.Terms = new Array(); //Terms of the termset listed in a heirarchy (if applicable)
        this.FlatTerms = new Array(); //Flat representation of terms in the Termset
        this.RawTerms = null; //Raw terms returned from CSOM
        this.TermsLoaded = false; //boolean indicating if the terms have been returned and loaded from CSOM
        this.OnTermsLoaded = null; //optional callback when terms are loaded
        this.Name; //name of the termset
        this.RawTermSet = null; //Raw termset returned from CSOM
        this.TermSetLoaded = false; //boolean indicating if the termset details are loaded
        this.IsOpenForTermCreation = false; //bool indicating if the termset is open for new term creation
        this.NewTerm = null; //the new term being added
    }
    $.extend(TermSet.prototype, {
        //initializes the Termset, including loading all terms using CSOM
        initialize: function () {
            //Get the taxonomy session using CSOM
            var taxSession = SP.Taxonomy.TaxonomySession.getTaxonomySession(spContext);
            //Use the default term store...this could be extended here to support additional term stores
            var termStore = taxSession.getDefaultSiteCollectionTermStore();

            //get the termset based on the properties of the termset
            if (this.Id != null)
                this.RawTermSet = termStore.getTermSet(this.Id); //get termset by id
            else if (this.UseHashtags)
                this.RawTermSet = termStore.get_hashTagsTermSet(); //get the hashtags termset
            else if (this.UseKeywords)
                this.RawTermSet = termStore.get_keywordsTermSet(); //get the keywords termset

            //get ALL terms for the termset and we will organize them in the async callback
            this.RawTerms = this.RawTermSet.getAllTerms();
            spContext.load(this.RawTermSet);
            spContext.load(this.RawTerms);
            spContext.executeQueryAsync(Function.createDelegate(this, this.termsLoadedSuccess), Function.createDelegate(this, this.termsLoadedFailed));
        },
        //internal callback when terms are returned from CSOM
        termsLoadedSuccess: function () {
            //set termset properties
            this.Name = this.RawTermSet.get_name();
            this.IsOpenForTermCreation = this.RawTermSet.get_isOpenForTermCreation();

            //get the enumerator for terms list
            var termEnumerator = this.RawTerms.getEnumerator();

            //get flat list of terms
            this.FlatTerms = new Array();
            while (termEnumerator.moveNext()) {
                var currentTerm = termEnumerator.get_current();
                var term = new Term(currentTerm);
                this.FlatTerms.push(term);
            }

            //sort by level so we can convert to a heirarchy
            this.FlatTerms.sort(function (a, b) {
                return a.Level - b.Level;
            });

            //build hierarchical representation of Terms
            for (var i = 0; i < this.FlatTerms.length; i++) {
                var term = this.FlatTerms[i];
                var path = term.PathOfTerm.split(';');
                if (path.length == 1)
                    this.Terms.push(term.clone());
                else
                    this.getTermParentCollectionByPath(term.PathOfTerm).push(term);
            }

            //mark as terms loaded
            this.TermsLoaded = true;

            //call OnTermsLoaded event if not null
            if (this.OnTermsLoaded != null)
                this.OnTermsLoaded();
        },
        //internal callback when failed CSOM query occurs getting terms
        termsLoadedFailed: function (event, args) {
            //display error message to user
            alert(TaxonomyPickerConsts.TERMSET_LOAD_FAILED);
        },
        //gets a term parent collection based on the path passed in (ex: World;Europe;Finland would return the Europe term)
        getTermParentCollectionByPath: function (path) {
            var term = null;
            var parts = path.split(';');
            var termList = this.Terms;
            for (var i = 0; i < parts.length - 1; i++) {
                for (var j = 0; j < termList.length; j++) {
                    if (parts[i] == termList[j].Name) {
                        term = termList[j];
                        termList = term.Children;
                        break;
                    }
                }
            }
            return termList;
        },
        //get suggestions based on the values typed by user
        getSuggestions: function (text) {
            var matches = new Array();
            $(this.FlatTerms).each(function (i, e) {
                if (e.Name.toLowerCase().indexOf(text.toLowerCase()) == 0)
                    matches.push(e);
            });
            return matches;
        },
        //get a term by id
        getTermById: function (id) {
            for (var i = 0; i < this.FlatTerms.length; i++) {
                if (this.FlatTerms[i].Id == id)
                    return this.FlatTerms[i];
            }

            return null;
        },
        //get a term by label match
        getTermsByLabel: function (label) {
            var matches = new Array();
            for (var i = 0; i < this.FlatTerms.length; i++) {
                if (this.FlatTerms[i].Name.toLowerCase() == label.toLowerCase())
                    matches.push(this.FlatTerms[i]);
            }

            return matches;
        },
        //adds a new term to the the root of a termset or as a child of another term
        addTerm: function (label, taxpicker, parentTermId) {
            var parent = null;
            if (parentTermId == undefined) {
                //add Term to termset
                parent = this.RawTermSet;
            }
            else {
                //find the parent term in the RawTerms
                for (var i = 0; i < this.FlatTerms.length; i++) {
                    var pt = this.FlatTerms[i];
                    if (pt.Id == parentTermId) {
                        parent = pt;
                    }
                }
            }

            //make sure the term label doesn't already exist at this level
            if (this.termExists((parentTermId == undefined) ? label : parent.Name + ';' + label))
                taxpicker.termAddFailed(null, null);
            else {
                //create the term
                var id = newGuid();

                //handle root terms
                if (parentTermId == undefined) {
                    //initialize the parent as the termset collection
                    parent = {};
                    parent.RawTerm = this.RawTermSet;
                }
                this.NewTerm = parent.RawTerm.createTerm(label, taxpicker.LCID, id);
                spContext.load(this.NewTerm);
                spContext.executeQueryAsync(Function.createDelegate(taxpicker, taxpicker.termAddSuccess),
                    Function.createDelegate(taxpicker, taxpicker.termAddFailed));
            }
        },
        //checks if a term exists with the the path passed in
        termExists: function (pathOfTerm) {
            var termFound = false;
            for (var i = 0; i < this.FlatTerms.length; i++) {
                if (this.FlatTerms[i].PathOfTerm.toLowerCase() == pathOfTerm.toLowerCase()) {
                    termFound = true;
                    break;
                }
            }

            return termFound;
        }
    });
    //********************** End TermSet Class **********************

    //********************** START TaxonomyPicker Class **********************
    //constructor for TaxonomyPicker
    function TaxonomyPicker(control, options, changeCallback) {
        this.TermSet = new TermSet(options); //the termset the taxonomy picker is bound to...loaded in the inialize function

        this._changeCallback = changeCallback; //event callback for when the control value changes
        this.LCID = (options.lcid) ? options.lcid : 1033; //the locale id for term creation (default is 1033)
        this.Language = (options.language) ? options.language : 'en-us'; //the language code for the control (default is en-us)
        this.MarkerMarkup = '<span id="caretmarker"></span>'; //the marketup const
        this._isMulti = options.isMulti; //specifies if the user can select multiple terms
        this._allowFillIn = options.allowFillIn; //specifies if the user can add new terms (only applies to Open Termsets)
        this._termSetId = options.termSetId; //the termset id to bind the control to
        this._useHashtags = options.useHashtags; //indicates that the hashtags termset should be used tp bind the control
        this._useKeywords = options.useKeywords; //indicates that the keywords termset should be used to bind the control
        this._initialValue = control.val(); //the initial value of the control
        this._maxSuggestions = (options.maxSuggestions) ? options.maxSuggestions : 10; //maximum number of suggestions to load...default is 10

        this._control = control; //the wrapper container all the taxonomy pickers controls are contained in
        this._dlgButton = null; //the button used to launch the taxonomy picker dialog
        this._editor = null; //the editor control for the taxonomy picker
        this._suggestionContainer = null; //the suggestions container for the taxonomy picker
        this._hiddenValidated = control; //the hidden control that contains all validated term selections
        this._waitingDlg = null; //the waiting dialog
        this._selectedTerms = new Array(); //Array of selected terms
        this._tempSelectedTerms = new Array(); //Snapshot of selected terms for use in the picker dialog (kept to support cancel in the dialog)
        
        this._dialog = null; //the dialog control
        this._dlgCurrTerm = null; //the current term highlighted in the taxonomy picker dialog
        this._dlgCurrTermNode = null; //the current tree node selected
        this._dlgCloseButton = null; //the Close button in the taxonomy picker dialog
        this._dlgOkButton = null; //the Ok button in the taxonomy picker dialog
        this._dlgCancelButton = null; //the Cancel button in the taxonomy picker dialog
        this._dlgSelectButton = null; //the Select >> button in the taxonomy picker dialog
        this._dlgEditor = null; //the editor control in the taxonomy picker dialog
        this._dlgAddNewTermButton = null; //the "Add New Item" link display in the dialog for Open TermSets
        this._dlgNewNode; //container for a new node added to an Open Termset in the taxonomy picker dialog
        this._dlgNewNodeEditor; //the editor field for add new node in the taxonomy picker dialog

        //initialize the taxonomy picker
        this.initialize();
    }

    $.extend(TaxonomyPicker.prototype, {
        //initializes the taxonomy picker
        initialize: function () {
            this.TermSet.initialize(); //initialize the termset to populate available terms

            //get script path so we can load translation files
            var scriptUrl = '';
            var scriptRevision = '';
            $('script').each(function (i, el) {
                if (el.src.toLowerCase().indexOf('taxonomypickercontrol.js') > -1) {
                    scriptUrl = el.src;
                    scriptRevision = scriptUrl.substring(scriptUrl.indexOf('.js') + 3);
                    scriptUrl = scriptUrl.substring(0, scriptUrl.indexOf('.js'));
                }
            });

            //load translation files
            var resourcesFile = scriptUrl + '_resources.' + this.Language.substring(0, 2).toLowerCase() + '.js';
            $.getScript(resourcesFile);

            //create a new wrapper for the control using a div
            this._control = $('<div class="cam-taxpicker"></div>');

            //detach the hidden field from the parent and append to the wrapper
            var parent = this._hiddenValidated.parent();
            this._hiddenValidated = this._hiddenValidated.detach();
            parent.append(this._control);

            //add additional controls such as the editor area, suggestions container, dialog button
            this._editor = $('<div class="cam-taxpicker-editor" contenteditable="true"></div>');
            this._suggestionContainer = $('<div class="cam-taxpicker-suggestion-container"></div>');
            this._dlgButton = $('<div class="cam-taxpicker-button"></div>');
            this._control.empty().append(this._editor).append(this._dlgButton).append(this._hiddenValidated);
            this._control.after(this._suggestionContainer);

            //initialize value if it exists
            if (this._initialValue != undefined && this._initialValue.length > 0) {
                var terms = JSON.parse(this._initialValue);
                for (var i = 0; i < terms.length; i++) {
                    //add the term to selected terms array
                    var t = new Term(null);
                    t.Id = terms[i].Id;
                    t.Name = terms[i].Name;
                    this._selectedTerms.push(t);
                }

                //refresh the html in the editor control
                this._editor.html(this.selectedTermsToHtml());
            }

            //wire up control events
            this._dlgButton.click(Function.createDelegate(this, this.showPickerDialog)); //dialog button is clicked
            this._editor.keydown(Function.createDelegate(this, this.keydown)); //key is pressed in the editor control
            $(document).mousedown(Function.createDelegate(this, this.checkExternalClick)); //mousedown somewhere in the document
        },
        //handle reset
        reset: function () {
            this._selectedTerms = new Array();
            this._editor.html('');
        },
        //handle keydown event in editor control
        keydown: function (event, args) {
            //get the keynum
            var keynum = event.which;

            //get all parameters to deal with the key event
            var caret = this.getCaret(this._editor[0]); //the cursor position
            var rawText = this._editor.text(); //the raw text in the editor (html stripped out)
            var selection = '';
            if (window.getSelection) //get selection (highlighted text)
                selection = window.getSelection().toString(); //modern browser
            else
                selection = document.selection.createRange().text; //IE<9

            //handle specific keys
            if (keynum == 46) { //delete key pressed
                //delete anything that was selected
                if (selection.length > 0) {
                    var newText = rawText.substring(0, caret - selection.length) + this.MarkerMarkup + rawText.substring(caret, rawText.length);
                    var textValidation = this.validateText(newText);
                    this._editor.html(textValidation.html);
                    
                    //set the cursor position at the marker
                    this.setCaret();

                    //show suggestions
                    this.showSuggestions(textValidation, caret);
                }

                //cancel the keypress
                return false;
            }
            else if (keynum == 8) { //backspace key pressed
                //delete anything that was selected OR the last character if nothing selected
                var newText = '';
                if (selection.length > 0) {
                    newText = rawText.substring(0, caret - selection.length) + this.MarkerMarkup + rawText.substring(caret, rawText.length);
                    var textValidation = this.validateText(newText);
                    this._editor.html(textValidation.html);
                    
                    //set the cursor position at the marker
                    this.setCaret();
                    
                    //show suggestions
                    this.showSuggestions(textValidation, caret - selection.length - 1);
                }
                else {
                    var firstPart = rawText.substring(0, caret - 1);
                    if (firstPart.charAt(firstPart.length - 1) == ';')
                        firstPart = firstPart.substring(0, firstPart.length - 1);
                    newText = firstPart + this.MarkerMarkup + rawText.substring(caret, rawText.length);
                    var textValidation = this.validateText(newText);
                    this._editor.html(textValidation.html);
                    
                    //set the cursor position at the marker
                    this.setCaret();

                    //show suggestions
                    this.showSuggestions(textValidation, caret - 2);
                }
                
                //cancel the keypress
                return false;
            }
            else if (keynum >= 48 && keynum <= 90 || keynum == 32) { // An ascii character or a space has been pressed
                // keynum is not taking in account shift key and always results in the uppercase value
                if (event.shiftKey == false && keynum >= 65 && keynum <= 90) {
                    keynum += 32;
                }

                //get new text, taking in account selections
                var newText = ''
                var char = String.fromCharCode(keynum);
                if (keynum == 32) //convert space to &nbsp;
                    char = '&nbsp;';

                //calculate new text and then convert to html
                if (caret < rawText.length)
                    newText = rawText.substring(0, caret - selection.length) + String.fromCharCode(keynum) + this.MarkerMarkup + rawText.substring(caret, rawText.length);
                else
                    newText = rawText.substring(0, caret - selection.length) + rawText.substring(caret, rawText.length) + String.fromCharCode(keynum) + this.MarkerMarkup;

                //get text validation and set html in editor
                var textValidation = this.validateText(newText);
                this._editor.html(textValidation.html);
                
                //set the cursor position at the marker
                this.setCaret();

                //show suggestions
                this.showSuggestions(textValidation, caret);
                return false;
            }
            else if (keynum == 9) { //Tab key pressed
                //validate raw text OR mark invalid
                var textValidation = this.validateText(rawText);
                var html = this.markInvalidTerms(textValidation);
                this._editor.html(html);

                //close the suggestion panel
                this._suggestionContainer.hide();
            }
        },
        //get the cursor position in a content editable div
        getCaret: function (target) {
            var isContentEditable = target.contentEditable === 'true';
            
            //HTML5
            if (window.getSelection) {
                //contenteditable
                if (isContentEditable) {
                    target.focus();
                    var range1 = window.getSelection().getRangeAt(0),
                        range2 = range1.cloneRange();
                    range2.selectNodeContents(target);
                    range2.setEnd(range1.endContainer, range1.endOffset);
                    return range2.toString().length;
                }
                //textarea
                return target.selectionStart;
            }
            //IE<9
            if (document.selection) {
                target.focus();
                //contenteditable
                if (isContentEditable) {
                    var range1 = document.selection.createRange(),
                        range2 = document.body.createTextRange();
                    range2.moveToElementText(target);
                    range2.setEndPoint('EndToEnd', range1);
                    return range2.text.length;
                }
                //textarea
                var pos = 0,
                    range = target.createTextRange(),
                    range2 = document.selection.createRange().duplicate(),
                    bookmark = range2.getBookmark();
                range.moveToBookmark(bookmark);
                while (range.moveStart('character', -1) !== 0) pos++;
                return pos;
            }
            //not supported
            return 0;
        },
        //sets the cursor caret (position in the editor control)
        setCaret: function () {
            //find the marker
            var marker = null;
            for (var i = 0; i < this._editor[0].childNodes.length; i++) {
                if (this._editor[0].childNodes[i].tagName == 'SPAN' && this._editor[0].childNodes[i].id == 'caretmarker') {
                    marker = this._editor[0].childNodes[i];
                    break;
                }
            }

            if (marker != null) {
                //HTML5
                if (window.getSelection) {
                    //set cursor at the marker
                    var range = document.createRange();
                    range['setStartAfter'](marker);
                    var selection = window.getSelection();
                    selection.removeAllRanges();
                    selection.addRange(range);
                }
                //IE<9
                if (document.selection) {
                    //TODO: this isn't currently working without a selection (BUG)
                    /*
                    range = document.selection.createRange();
                    var range1 = range.duplicate();
                    range1.moveToElementText(marker);
                    range.setEndPoint('StartToEnd', range1);
                    range.setEndPoint('EndToStart', range1);
                    */
                }

                //remove the marker
                marker.parentNode.removeChild(marker);
            }
        },
        //validates the text input into ranges and html output
        validateText: function (txt) {
            var textValidation = { html: '', ranges: [] };
            var terms = txt.split(';');
            var newTerms = new Array();
            var ptr = 0;
            var rPtr = 0;

            //loop through parts and look for existing validations
            for (var i = 0; i < terms.length; i++) {
                var t = terms[i].replace(/^\s+/, ""); //trim left
                var t_compare = t.replace(this.MarkerMarkup, '');
                var r = { text: t, bottom: rPtr, top: (rPtr + t.length - 1), valid: false };
                rPtr = r.top;
                for (var j = ptr; j < this._selectedTerms.length; j++) {
                    if (this._selectedTerms[j].Name.toLowerCase() == t_compare.toLowerCase()) {
                        newTerms.push(this._selectedTerms[j]);
                        r.valid = true;
                        ptr = j + 1;
                        break;
                    }
                }

                //add to the range selection
                textValidation.ranges.push(r);

                //build the html for this
                if (r.valid)
                    textValidation.html += '<span class="cam-taxpicker-term-selected">' + t + '</span>';
                else
                    textValidation.html += t;

                //add separator
                if (i < terms.length - 1) {
                    textValidation.html += '<span>;&nbsp;</span>';
                    rPtr += 3;
                }
            }
            //reset this._selectedTerms
            this._selectedTerms = newTerms;

            return textValidation;
        },
        //marks text input with valid and invalid markup
        markInvalidTerms: function (textValidation) {
            var html = '';
            for (var i = 0; i < textValidation.ranges.length; i++) {
                if (textValidation.ranges[i].valid)
                    html += '<span class="cam-taxpicker-term-selected">' + textValidation.ranges[i].text + '</span>';
                else {
                    //check for a single match we can validate against
                    var matches = this.TermSet.getTermsByLabel(textValidation.ranges[i].text);
                    if (matches.length == 1 && (this._selectedTerms.length == 0 || this._isMulti)) {
                        this.pushSelectedTerm(matches[0]);
                        html += '<span class="cam-taxpicker-term-selected">' + textValidation.ranges[i].text + '</span>';
                    }
                    else
                        html += '<span class="cam-taxpicker-term-invalid">' + textValidation.ranges[i].text + '</span>';

                    //check for ambiguous matches
                    if (matches.length > 1) {
                        //TODO: popup anbiguous terms dialog (Enhancement)
                    }
                }

                if (i < textValidation.ranges.length - 1)
                    html += '<span>;&nbsp;</span>';
            }
            return html;
        },
        //shows suggestions based on the unvalidated text being entered
        showSuggestions: function (textValidation, caret) {
            //find the unvalidated text the cursor is in
            var range = null;
            for (var i = 0; i < textValidation.ranges.length; i++) {
                if (caret >= textValidation.ranges[i].bottom && caret <= textValidation.ranges[i].top) {
                    if (!textValidation.ranges[i].valid) {
                        range = textValidation.ranges[i];
                    }
                    break;
                }
            }
            if (range != null && this.TermSet.TermsLoaded) {
                var txt = range.text;

                //clear the marker from the txt
                txt = txt.replace(this.MarkerMarkup, '');

                if (txt.length > 0) {
                    //look for all matching suggestions
                    var suggestions = this.TermSet.getSuggestions(txt);

                    //trim suggestions based on what is already in this._selectedTerms
                    suggestions = this.trimSuggestions(suggestions);

                    this._suggestionContainer.empty().append($('<div class="cam-taxpicker-suggestion-title">' + TaxonomyPickerConsts.SUGGESTIONS_HEADER + '</div>'));
                    if (suggestions.length > 0) {
                        $(suggestions).each(Function.createDelegate(this, function (i, e) {
                            if (i < this._maxSuggestions) {
                                var match = e.Name.substring(0, txt.length); //get the matched text so we can highlight it
                                var itemHtml = $('<div class="cam-taxpicker-suggestion-item" data-item="' + e.Id + '">' + e.Name.replace(match, '<span style="background-color: yellow;">' + match + '</span>') + ' [' + this.TermSet.Name + ':' + e.PathOfTerm.replace(/;/g, ':') + ']</div>');
                                this._suggestionContainer.append(itemHtml);
                                itemHtml.click(Function.createDelegate(this, this.suggestionClicked));
                            }
                        }));
                    }
                    this._suggestionContainer.show();
                }
            }
            else
                this._suggestionContainer.hide();
        },
        //term node add is canceled
        termNodeAddCancel: function (event) {
            //remove the expand/collapse image if needed
            if (this._dlgCurrTermNode != null && this._dlgCurrTermNode.parent().next().children().length <= 1) {
                this._dlgCurrTermNode.prev().prev().removeClass('collapsed');
                this._dlgCurrTermNode.prev().prev().removeClass('expanded');
            }

            //cancel the add by removing the new term
            if (this._dlgNewNode != null)
                this._dlgNewNode.remove();
        },
        //term node is clicked in the treeview
        termNodeClicked: function (event) {
            //clear any term that was in the middle of an add
            this.termNodeAddCancel(event);

            //set the _dlgCurrTermNode
            this._dlgCurrTermNode = $(event.target);

            //change the style of the node to selected
            $('.cam-taxpicker-treenode-title').removeClass('selected');
            $(event.target).addClass('selected');

            //ignore events from root
            if (!$(event.target).hasClass('root')) {
                //get the term clicked and set currNode
                var itemdata = $(event.target).attr('data-item').split('|');
                this._dlgCurrTerm = this.TermSet.getTermById(itemdata[1]);
            }
            else
                this._dlgCurrTerm = null;
        },
        //term node is double clicked in the treeview
        termNodeDoubleClicked: function (event) {
            //clear any term that was in the middle of an add
            this.termNodeAddCancel(event);

            //set the _dlgCurrTermNode
            this._dlgCurrTermNode = $(event.target);

            //ignore events from root
            if (!$(event.target).hasClass('root')) {
                //get the term clicked
                var itemdata = $(event.target).attr('data-item').split('|');
                term = this.TermSet.getTermById(itemdata[1]);

                //add the term to selected terms array
                this.pushSelectedTerm(term);

                //refresh the html in the editor control
                this._dlgEditor.html(this.selectedTermsToHtml());
            }
        },
        //dialog select button is clicked...use this to add any selected node as a selected term
        dialogSelectButtonClicked: function (event) {
            if (this._dlgCurrTerm != null) {
                //add the term to selected terms array
                this.pushSelectedTerm(this._dlgCurrTerm);

                //refresh the html in the editor control
                this._dlgEditor.html(this.selectedTermsToHtml());
            }
        },
        //dialog OK button clicked
        dialogOkClicked: function (event) {
            //update the control value
            this._editor.html(this.selectedTermsToHtml());

            //close the dialog
            this.closePickerDialog(event);

            if (this._changeCallback != null)
                this._changeCallback();
        },
        //dialog Cancel button clicked
        dialogCancelClicked: function (event) {
            //reset the selected terms
            this._selectedTerms = this._tempSelectedTerms;

            //close the dialog
            this.closePickerDialog(event);
        },
        //dialog new term button is clicked
        dialogNewTermClicked: function (event) {
            this._dlgNewNodeEditor = $('<div class="cam-taxpicker-treenode-newnode" style="min-width: 100px;" contenteditable="true"></div>');
            this._dlgNewNode = $('<li class="cam-taxpicker-treenode-li newNode"></li>').append($('<div class="cam-taxpicker-treenode"></div>').append('<div class="cam-taxpicker-expander"></div><img src="/_layouts/15/Images/EMMTerm.png" alt=""/>').append(this._dlgNewNodeEditor));

            //get the container for the new node
            var ul = this._dlgCurrTermNode.parent().next();
            ul.prepend(this._dlgNewNode);

            //toggle the expand on the parent node
            ul.show();
            this._dlgCurrTermNode.prev().prev().removeClass('collapsed');
            this._dlgCurrTermNode.prev().prev().addClass('expanded');

            //set focus on the newNode editor and wire events
            this._dlgNewNodeEditor.focus();
            this._dlgNewNodeEditor.keydown(Function.createDelegate(this, this.dialogNewTermKeydown));
        },
        //fires for each keydown in the new term editor
        dialogNewTermKeydown: function (event) {
            //check for Tab, Esc, or Enter keys
            var keynum = event.keyCode;

            if (keynum == 27) { //Esc pressed
                this.termNodeAddCancel(event);
            }
            else if (keynum == 13 || keynum == 9) { //Enter or Tab pressed
                //add the new term and cancel the keypress
                var txt = this._dlgNewNodeEditor.text();

                //ensure hashtags start with #
                if (this._useHashtags && txt.indexOf('#') != 0)
                    txt = '#' + txt;

                if (this._dlgCurrTerm != null)
                    this.TermSet.addTerm(txt, this, this._dlgCurrTerm.Id);
                else
                    this.TermSet.addTerm(txt, this);

                //cancel the keypress for Enter
                if (keynum == 13)
                    return false;
            }
        },
        //successful callback from creating a new term
        termAddSuccess: function (event, args) {
            //add the new term to all applicable collections
            var newTerm = new Term(this.TermSet.NewTerm);
            this.TermSet.FlatTerms.push(newTerm); //add to the flat terms list
            var parentTerm = this.TermSet.getTermParentCollectionByPath(newTerm.PathOfTerm);
            parentTerm.push(newTerm.clone());//add to the hierarchy terms list

            //get the container and replace the new node with a non-editable node
            var ul = this._dlgNewNode.parent();
            this._dlgNewNode.remove();
            var newNode = newTerm.toHtmlLabel();
            ul.prepend(newNode);

            //change the style to selected and wire events
            $('.cam-taxpicker-treenode-title').removeClass('selected');
            var title = newNode.find('.cam-taxpicker-treenode-title');
            title.addClass('selected');
            title.click(Function.createDelegate(this, this.termNodeClicked));
            title.dblclick(Function.createDelegate(this, this.termNodeDoubleClicked));

            //set the _dlgCurrTermNode and _dlgCurrTerm
            this._dlgCurrTermNode = $(event.target);
            this._dlgCurrTerm = newTerm;
        },
        //failed callback from trying to create a new term
        termAddFailed: function (event, args) {
            //remove the expand/collapse image if needed
            if (this._dlgCurrTermNode.parent().next().children().length <= 1) {
                this._dlgCurrTermNode.prev().prev().removeClass('collapsed');
                this._dlgCurrTermNode.prev().prev().removeClass('expanded');
            }

            //cancel the add by removing the new term
            this._dlgNewNode.remove();
        },
        //fires when a user selected a suggested term in the suggestions list
        suggestionClicked: function (event) {
            var obj = $(event.target);
            //check sender type...move up to parent if this is a span
            if (obj[0].tagName == 'SPAN')
                obj = obj.parent();

            //get the termId from the data-item attribute of the target
            var termId = obj.attr('data-item');
            //get the term from the termset in memory
            var term = this.TermSet.getTermById(termId); 
            //add the term to selected terms array
            this.pushSelectedTerm(term);

            //refresh the html in the editor control
            this._editor.html(this.selectedTermsToHtml());
            this._suggestionContainer.hide();
            this._editor.focus();

            if (this._changeCallback != null)
                this._changeCallback();
        },
        //used to check if focus is lost from the control (invalidate and hide suggestions)
        checkExternalClick: function (event) {
            //check if the target is outside the picker
            if (!$.contains(this._control[0], event.target) && !$.contains(this._suggestionContainer[0], event.target) && this._dialog != null && !$.contains(this._dialog[0], event.target)) {
                var rawText = this._editor.text(); //the raw text in the editor (html stripped out)
                var textValidation = this.validateText(rawText); //get the text validation
                var html = this.markInvalidTerms(textValidation); //mark invalid terms
                this._editor.html(html); //set the editor
                this._suggestionContainer.hide(); //hide suggestions
            }
        },
        //show the dialog picker
        showPickerDialog: function (event) {
            //check to make sure the termset has loaded
            if (!this.TermSet.TermsLoaded) {
                this.TermSet.OnTermsLoaded = Function.createDelegate(this, this.showPickerDialog);

                //add the waiting indicator to the body
                this._waitingDlg = $('<div class="cam-taxpicker-waiting"><div class="cam-taxpicker-waiting-overlay"></div><div class="cam-taxpicker-waiting-dlg"><div class="cam-taxpicker-waiting-dlg-inner"><img alt="" src="data:image/gif;base64,R0lGODlhEAAQAIAAAFLOQv///yH/C05FVFNDQVBFMi4wAwEAAAAh+QQFCgABACwJAAIAAgACAAACAoRRACH5BAUKAAEALAwABQACAAIAAAIChFEAIfkEBQoAAQAsDAAJAAIAAgAAAgKEUQAh+QQFCgABACwJAAwAAgACAAACAoRRACH5BAUKAAEALAUADAACAAIAAAIChFEAIfkEBQoAAQAsAgAJAAIAAgAAAgKEUQAh+QQFCgABACwCAAUAAgACAAACAoRRACH5BAkKAAEALAIAAgAMAAwAAAINjAFne8kPo5y02ouzLQAh+QQJCgABACwCAAIADAAMAAACF4wBphvID1uCyNEZM7Ov4v1p0hGOZlAAACH5BAkKAAEALAIAAgAMAAwAAAIUjAGmG8gPW4qS2rscRPp1rH3H1BUAIfkECQoAAQAsAgACAAkADAAAAhGMAaaX64peiLJa6rCVFHdQAAAh+QQJCgABACwCAAIABQAMAAACDYwBFqiX3mJjUM63QAEAIfkECQoAAQAsAgACAAUACQAAAgqMARaol95iY9AUACH5BAkKAAEALAIAAgAFAAUAAAIHjAEWqJeuCgAh+QQJCgABACwFAAIAAgACAAACAoRRADs=" style="width: 32px; height: 32px;" /><span class="ms-accentText" style="font-size: 36px;">' + TaxonomyPickerConsts.WORKING_ON_IT + '</span></div></div></div>');
                $('body').append(this._waitingDlg);
            }
            else {
                //remove the waiting indicator (if exists)
                $('body').children('.cam-taxpicker-waiting').remove();

                //capture what terms are current selected (so we can support cancel)
                this._tempSelectedTerms = this._selectedTerms.slice(0);

                //initialize the dialog if null
                if (this._dialog == null) {
                    this._dialog = $('<div class="cam-taxpicker-dialog"></div>');
                    var dlg = $('<div class="cam-taxpicker-dialog-content"></div>');

                    //build dialog header with button
                    var dlgHeader = $('<div class="cam-taxpicker-dialog-content-header"><h1 class="cam-taxpicker-dialog-content-header-title">' + TaxonomyPickerConsts.DIALOG_HEADER + this.TermSet.Name +'</h1></div>');
                    this._dlgCloseButton = $('<div class="cam-taxpicker-dialog-content-close"></div>');
                    dlgHeader.append(this._dlgCloseButton);
                    dlg.append(dlgHeader);

                    //build dialog body
                    var dlgSubheader = $('<div class="cam-taxpicker-dialog-content-subheader"><img class="cam-taxpicker-dialog-content-subheader-img" src="/_layouts/15/Images/EMMDoubleTag.png" alt="" /></div>');
                    this._dlgAddNewTermButton = $('<a style="cursor: pointer;">' + TaxonomyPickerConsts.DIALOG_ADD_LINK + '</a>');
                    if (this.TermSet.IsOpenForTermCreation) {
                        dlgSubheader.append($('<div class="cam-taxpicker-dialog-content-subheader-title">' + TaxonomyPickerConsts.DIALOG_ADD_TITLE + '&nbsp;</div>'));
                        dlgSubheader.append($('<div class="cam-taxpicker-dialog-content-subheader-addnew"></div>').append(this._dlgAddNewTermButton));
                    }
                    var dlgBody = $('<div class="cam-taxpicker-dialog-content-body"></div>');
                    dlgBody.append(dlgSubheader);
                    var dlgBodyContainer = $('<div class="cam-taxpicker-dialog-tree-container"></div>');

                    //build the termset hierarchy
                    this._dlgCurrTermNode = $('<span class="cam-taxpicker-treenode-title root selected">' + this.TermSet.Name + '</span>');
                    var root = $('<li class="cam-taxpicker-treenode-li"></li>').append($('<div class="cam-taxpicker-treenode"></div>').append('<div class="cam-taxpicker-expander expanded"></div>').append('<img src="/_layouts/15/Images/EMMTermSet.png" alt=""/>').append(this._dlgCurrTermNode));
                    root.append(buildTermSetTreeLevel(this.TermSet.Terms, true));
                    dlgBodyContainer.append($('<ul class="cam-taxpicker-treenode-ul root" style="height: 100%;"></ul>').append(root));

                    //build the dialog editor area
                    //TODO: convert the dlgEditor with contenteditable="true" just like the main editor (Enhancement)
                    this._dlgEditor = $('<div class="cam-taxpicker-dialog-selection-editor" RestrictPasteToText="true" AllowMultiLines="false"></div>');
                    this._dlgSelectButton = $('<button>Select >></button>');
                    dlgBody.append(dlgBodyContainer).append($('<div class="cam-taxpicker-dialog-selection-container"></div>').append(this._dlgSelectButton).append(this._dlgEditor));
                    dlg.append(dlgBody);
                    this._dialog.empty().append($('<div class="cam-taxpicker-dialog-overlay"></div>')).append(dlg);

                    //add button area
                    var dlgButtonArea = $('<div class="cam-taxpicker-dialog-button-container"></div>')
                    this._dlgOkButton = $('<button style="float: right;">Ok</button>');
                    this._dlgCancelButton = $('<button style="float: right;">Cancel</button>');
                    dlgBody.append(dlgButtonArea.append(this._dlgCancelButton).append(this._dlgOkButton));
                }

                //set the value in the dialogs editor field
                this._dlgEditor.html(this.selectedTermsToHtml());

                //add the dialog to the body
                $('body').append(this._dialog);

                //wire events all the dialog events
                $('.cam-taxpicker-expander').click(function () {
                    //toggle tree node
                    if ($(this).hasClass('expanded')) {
                        $(this).removeClass('expanded');
                        $(this).addClass('collapsed');
                        $(this).parent().next().hide();
                    }
                    else if ($(this).hasClass('collapsed')) {
                        $(this).removeClass('collapsed');
                        $(this).addClass('expanded');
                        $(this).parent().next().show();
                    }
                });

                $('.cam-taxpicker-treenode-title').click(Function.createDelegate(this, this.termNodeClicked));
                $('.cam-taxpicker-treenode-title').dblclick(Function.createDelegate(this, this.termNodeDoubleClicked));
                this._dlgSelectButton.click(Function.createDelegate(this, this.dialogSelectButtonClicked));
                this._dlgCloseButton.click(Function.createDelegate(this, this.dialogCancelClicked));
                this._dlgOkButton.click(Function.createDelegate(this, this.dialogOkClicked));
                this._dlgCancelButton.click(Function.createDelegate(this, this.dialogCancelClicked));
                this._dlgAddNewTermButton.click(Function.createDelegate(this, this.dialogNewTermClicked));
            }
        },
        //closes the picker dialog
        closePickerDialog: function (event) {
            //remove the picker dialog from the body
            $('body').children('.cam-taxpicker-dialog').remove();
        },
        //adds a new term to the end of this._selectedTerms
        pushSelectedTerm: function (term) {
            //clone the term so we don't messup the original
            var clonedTerm = term.clone();

            //clear the RawTerm so it can be serialized
            clonedTerm.RawTerm = null;

            //pop the existing term if this isn't a multi-select
            if (!this._isMulti)
                this.popSelectedTerm();

            //add the term to the selected terms array
            this._selectedTerms.push(clonedTerm);
            this._hiddenValidated.val(JSON.stringify(this._selectedTerms));
        },
        //removes the last term from this._selectedTerms
        popSelectedTerm: function () {
            //remove the last selected term
            this._selectedTerms.pop();
            this._hiddenValidated.val(JSON.stringify(this._selectedTerms));
        },
        //converts this._selectedTerms to html for an editor field
        selectedTermsToHtml: function () {
            var termsHtml = '';
            for (var i = 0; i < this._selectedTerms.length; i++) {
                var e = this._selectedTerms[i];
                termsHtml += '<span class="cam-taxpicker-term-selected">' + e.Name + '</span><span>;&nbsp;</span>';
            }
            return termsHtml;
        },
        //trim suggestions based on existing selections
        trimSuggestions: function (suggestions) {
            var trimmedSuggestions = new Array();
            for (var i = 0; i < suggestions.length; i++) {
                var suggestion = suggestions[i];
                var found = false;
                for (var j = 0; j < this._selectedTerms.length; j++) {
                    if (this._selectedTerms[j].Id == suggestion.Id) {
                        found = true;
                        break;
                    }
                }

                //add the suggestion if it was not found
                if (!found)
                    trimmedSuggestions.push(suggestion);
            }

            return trimmedSuggestions;
        }
    });
    //********************** END TaxonomyPicker Class **********************

    //called recursively to build a treeview of terms for a termset
    function buildTermSetTreeLevel(termList, show) {
        var addlStyle = (show) ? 'style="display: block;"' : '';
        var html = $('<ul class="cam-taxpicker-treenode-ul" ' + addlStyle + '></ul>');
        for (var i = 0; i < termList.length; i++) {
            var term = termList[i];

            //convert the term to an html tree node
            var tHtml = term.toHtmlLabel();

            //add children if they exist
            if (term.Children.length > 0) {
                tHtml.append(buildTermSetTreeLevel(term.Children, false));
            }
            else {
                //add empty UL for future elements
                tHtml.append($('<ul class="cam-taxpicker-treenode-ul"></ul>'));
            }

            //append the term html to the parent ul
            html.append(tHtml);
        }

        return html;
    }

    //called recursively to build hierarchical representation of terms in a termset
    function getTerms(term, termEnumerator) {
        for (i = 0; i < term.termsCount; i++) {
            termEnumerator.moveNext();
            var currentTerm = termEnumerator.get_current();
            var cTerm = {
                name: currentTerm.get_name(),
                id: currentTerm.get_id(),
                pathOfTerm: currentTerm.get_pathOfTerm(),
                termsCount: currentTerm.get_termsCount(),
                childTerms: []
            };

            //get the child terms for this term
            getTerms(cTerm, termEnumerator);
            term.childTerms[i] = cTerm;
        }
    }

    //creates a new guid
    function newGuid() {
        var result, i, j;
        result = '';
        for (j = 0; j < 32; j++) {
            if (j == 8 || j == 12 || j == 16 || j == 20)
                result = result + '-';
            i = Math.floor(Math.random() * 16).toString(16).toUpperCase();
            result = result + i;
        }
        return result
    }

    //extends jquery to support taxpicker function
    $.fn.taxpicker = function (options, ctx, changeCallback) {
        //TODO: display error message when the control isn't bound correctly????

        //verify context
        if (!ctx)
            return this;

        //verify an empty collection wasn't passed
        if (!this.length)
            return this;

        //make sure this is a hidden element
        if (this[0].tagName.toLowerCase() != 'input' || this[0].type.toLowerCase() != 'hidden')
            return this;

        //set spcontext
        spContext = ctx;
        if ($.taxpicker == undefined)
            $.taxpicker = [];

        //create new TaxonomyPicker instance and increment index (in case we need to re-reference)
        $.taxpicker[taxIndex] = new TaxonomyPicker(this, options, changeCallback);
    };
})(CAMControl || (CAMControl = {}));
///#source 1 1 Widgets/TeamSite/taxonomypickercontrol_resources.en.js
function TaxonomyPickerConsts() { };
TaxonomyPickerConsts.SUGGESTIONS_HEADER = 'Suggestions';
TaxonomyPickerConsts.DIALOG_HEADER = 'Select: ';
TaxonomyPickerConsts.AMBIGUOUS_ENTRY = 'Ambiguous Entry';
TaxonomyPickerConsts.DIALOG_ADD_TITLE = 'New items are added under the currently selected item.';
TaxonomyPickerConsts.DIALOG_ADD_LINK = 'Add New Item';
TaxonomyPickerConsts.TERMSET_LOAD_FAILED = 'Loading TermSet failed.  Please refresh your browser and try again.';
TaxonomyPickerConsts.WORKING_ON_IT = '&nbsp;Working on it...';
///#source 1 1 Widgets/TeamSite/teamSiteContacts.js
//Namespace
var Widgets = Widgets || {};

//Definition of the team site contacts Widget
(function ($) {
    Widgets.teamSiteContacts = {
        name: "Team Site Contacts Widget",
        log: true,

        template: function () {
            // Logic to get the template. It can access the container to get the handlebars if needed, or reference the script by ID
            return $("#teamSiteContactsTemplate").html();
        },

        fetch: function () {
            // Logic to retrieve values from data sources.
            // This can return one or multiple Ajax calls (promises). 
            // If using the default Load function the results will be passed through to the parse function.
            var clientContext = SP.ClientContext.get_current();
            var web = clientContext.get_web();
            var titles;// = ['Site Sponsor', 'Primary Administrator', 'Secondary Administrator'];
            var viewUrl;

            return $.when((function () {
                //get FieldUserValue
                var deferred = $.Deferred();

                //Form Query
                var list = web.get_lists().getById(_spPageContextInfo.pageListId);
                var fields = list.get_fields();
                var item = list.getItemById(_spPageContextInfo.pageItemId);

                //Gets the ViewProfileUrl custom property from the User Profile term set
                var userTermSetName = Bah.Constants.Name.UserProfileTermSet;
                var locale = 1033; //English
                var taxonomySession = SP.Taxonomy.TaxonomySession.getTaxonomySession(clientContext);
                var termStore = taxonomySession.getDefaultSiteCollectionTermStore();
                var userTermSets = termStore.getTermSetsByName(userTermSetName, locale);
                var userTermSet = userTermSets.getByName(userTermSetName);

                //Get the following fields from the item we are querying
                var fieldNames = ['BAH_TeamSiteSponsor', 'BAH_TeamSitePrimaryAdmin', 'BAH_TeamSiteSecondaryAdmin'];

                //Load fields getting Title and Internal name only and get the selected Item retreiveing only those 3 fields
                clientContext.load(fields, 'Include(Title,InternalName)');
                clientContext.load(item, fieldNames[0], fieldNames[1], fieldNames[2]);
                clientContext.load(userTermSet);

                //Execute Query
                clientContext.executeQueryAsync(function (sender, args) {
                    //create a map of the fields using internal name i.e. internalName -> SP.Field[xyz] in O(N) time
                    var fieldMap = {};
                    $.each(fields.get_data(), function (i, field) {
                        fieldMap[field.get_internalName()] = field;
                    });
                    //get the required fields using the hash map in O(n) time with respect to fieldNames only. (3 steps in this case)
                    titles = $.map(fieldNames, function (fieldName) {
                        return fieldMap[fieldName].get_title();
                    });
                    ////Gets the view profile url from the term set custom property
                    viewUrl = Bah.getViewProfileUrlProperty(userTermSet);

                    deferred.resolve($.map(fieldNames, function (fieldName) { return item.get_item(fieldName); }));
                }, function (sender, args) {
                    deferred.reject("JSOM Get Field User Value Failed: " + args.get_message());
                });

                return deferred.promise();
            })()).then(function (fieldUserValues) {
                //get Users Object
                var deferred = $.Deferred();

                var teamSiteUsers = $.map(fieldUserValues, function (fieldUserValue) {
                    var teamUser = web.getUserById(fieldUserValue.get_lookupId())
                    clientContext.load(teamUser);
                    return teamUser;
                });

                clientContext.executeQueryAsync(function (sender, args) {
                    deferred.resolve(teamSiteUsers);
                }, function (sender, args) {
                    deferred.reject("JSOM Get Users Failed: " + args.get_message());
                });

                return deferred.promise();
            }).then(function (teamSiteUsers) {
                //Get User Profile Properties
                var deferred = $.Deferred();

                var peopleManager = new SP.UserProfiles.PeopleManager(clientContext);
                var usersProfileProperties = $.map(teamSiteUsers, function (teamSiteUser) {
                    var userProfileProperties = peopleManager.getPropertiesFor(teamSiteUser.get_loginName())
                    clientContext.load(userProfileProperties);
                    return userProfileProperties;
                });

                clientContext.executeQueryAsync(function (sender, args) {
                    deferred.resolve([usersProfileProperties, titles, viewUrl]);
                }, function (sender, args) {
                    deferred.reject("JSOM Get User Profiles Failed: " + args.get_message());
                });

                return deferred.promise();
            });
        },

        parse: function (data) {
            // This function should parse the raw info coming from the datasource and return a View Model ready for binding.
            var usersProfileProperties = data[0];
            var titles = data[1];
            var viewUrl = data[2];

            //size can be S, M, L *, accountName is the full login name
            function getPictureUrl(accountName, size) {
                return "/" + _spPageContextInfo.layoutsUrl +
                    "/userphoto.aspx?size=" + size +
                    "&accountname=" + encodeURIComponent(accountName);
            }

            function getProfileViewUrl(userLoginName, viewUrl) {
                return (viewUrl || '#') + '?user=' + encodeURIComponent(userLoginName);
            }

            return {
                    contacts: $.map(usersProfileProperties, function (userProfileProperties, index) {
                        var userExtendedProfileProperties = userProfileProperties.get_userProfileProperties();

                        return {
                            title: titles[index],
                            link: getProfileViewUrl(userExtendedProfileProperties["AccountName"], viewUrl),
                            imgSrc: getPictureUrl(userExtendedProfileProperties.AccountName, "M"), /*userExtendedProfileProperties.PictureURL*/
                            imgAlt: "User Profile Image",
                            fullName: userExtendedProfileProperties.FirstName + " " + userExtendedProfileProperties.LastName,
                            career: userExtendedProfileProperties["SPS-JobTitle"],
                            group: userExtendedProfileProperties["BAHGroup"]
                        };
                    })
            };
        },

        bind: function (template, data) {
            //not caching
            var template = Handlebars.compile(template);
            var html = template(data);
            return html;
        },

        render: function (data) {
            $(this.container).html(data);
        },

        fail: function (error, event) {
			Bah.logging.error(event, this.name);
        }
    };
})(jQuery);
///#source 1 1 Widgets/TeamSite/teamSitesList.js
var Widgets = Widgets || {};
var prevSortTeamSite = "";

(function ($) {
	Widgets.teamSitesList = {
		name: "Team Sites List",
		log: true,
        // Shared Settings
		filteringProperties: ['BAHInfoCatTaxId', 'SPWebUrl', 'Title'],
		rowLimit: 500,
        template: function () {
			return $("#teamSitesListTemplate").html();
		},
        isUserJoined: '',
	    isFavSite: '',
		sortDropdown: function (sort) {
		    var termSetName = 'Sort TeamSite';

		    var $select = $('#sortTeamSiteDropdown');

		    var locale = 1033; //English
		    var clientContext = SP.ClientContext.get_current();
		    var taxonomySession = SP.Taxonomy.TaxonomySession.getTaxonomySession(clientContext);
		    var termStore = taxonomySession.getDefaultSiteCollectionTermStore();
		    var termSets = termStore.getTermSetsByName(termSetName, locale);
		    var termSet = termSets.getByName(termSetName);
		    var terms = termSet.getAllTerms();
		    clientContext.load(taxonomySession);
		    clientContext.load(termStore);
		    clientContext.load(termSet);
		    clientContext.load(terms, 'Include(IsRoot, Labels, TermsCount, CustomSortOrder, Id, IsAvailableForTagging, Name, PathOfTerm, Parent, TermSet.Name, LocalCustomProperties, CustomProperties)');
		    clientContext.executeQueryAsync(Function.createDelegate(this, function () {
		        if (terms) {
		            for (var i = 0; i < terms.get_count() ; i++) {
		                var term = terms.getItemAtIndex(i);
		                var customProperties = term.get_customProperties();
		                var sortPar = (customProperties['sortParameter'] || '').toString();

		                $select.append($('<option>', {
		                    value: sortPar,
		                    text: term.get_name()
		                }));
		            }
		        }
		            $('#sortTeamSiteDropdown').val(sort);
		        $select.selectbox();
		    }),

            function (sender, args) {
                deferred.reject("JSOM Get Sort TeamSite from Term Set Failed: " + args.get_message());
            });
		},
		fetch: function() {
		    var defaultSort = 'created';
		    var sort = $('#sortTeamSiteDropdown').val();
		    sort = sort != undefined ? sort : defaultSort;
		    prevSortTeamSite = sort;
		    Widgets.teamSitesList.sortDropdown(sort);

		    return $.when(Bah.getTeams(this.filteringProperties, this.rowLimit, sort,""),
                Bah.getAllTermsFromTermSet(Bah.Constants.Guid.InfoCatTermSet),
                Bah.getMyFollowedTeams(),
                userProfileLocationPromise).then(
                function (data, infoCatTerms, myFollowedTeamData) {
                    //get the array of fav team sites
                    var bahFavoriteTeamSites = BAHUserProfileProperties.BAHPinnedTeamSites.split('|');
                    return { result: data, infoCatTerms: infoCatTerms, myFollowedTeamData: myFollowedTeamData, bahFavoriteTeamSites: bahFavoriteTeamSites };
                });
		},
		parse: function (allData) {
			var data = allData.result;
            
			var myFollowedTeams = allData.myFollowedTeamData.d.Followed.results;
			var myFavoriteTeams = allData.bahFavoriteTeamSites;

			//create Term id Map
			var termsMap = {};
			var termEnumerator = allData.infoCatTerms.getEnumerator();
			while (termEnumerator.moveNext()) {
				var term = termEnumerator.get_current();
				termsMap[term.get_id().toString()] = term;
			}

			var filteringProperties = this.filteringProperties;
			//create existance map for filteringProperties
			var filteringPropertiesContains = lazy(filteringProperties).reduce(function (x, y) {
				var o = {}; o[y] = true;
				return x.merge(o);
			}, lazy({})).toObject();

			//Prepare View Model Object
			var viewModel = {
			    isUserJoined: false,
			    isFavSite: false,
				teams: []
			};

			if (data.d !== undefined) {
			    viewModel.teams = lazy(data.d.query.PrimaryQueryResult.RelevantResults.Table.Rows.results).map(function (row) {
			        var rowReturn = {};
			        lazy(row.Cells.results).filter(function (field) {
			            return filteringPropertiesContains[field.Key];
			        }).first(filteringProperties.length).each(function (field) {
			            rowReturn[field.Key] = field.Value;
			        });
			        return rowReturn;
			    }).map(function (mappedFields) {
			        var termId = Bah.getTermIdFromManagedMetadataId(mappedFields[filteringProperties[0]]);
			        var term = termsMap[termId];
			        var isJoined = false;
			        var isFav = false;
			        var link = mappedFields[filteringProperties[1]];
			        if (myFollowedTeams.length > 0)
			        {
			            for (var i = 0; i < myFollowedTeams.length; i++) {
			                var teamUrls = decodeURIComponent(myFollowedTeams[i].ContentUri);
			                var teamUrl = teamUrls.replace(/:[0-9]+/,''); //take out:portnumber in followed Uri
			                if (teamUrl == link) {
			                    isJoined = true;
			                    if (Widgets.teamSitesList.isUserJoined === '') {
			                        Widgets.teamSitesList.isUserJoined = true;
			                        viewModel.isUserJoined = true;
			                    }
			                    else viewModel.isUserJoined = Widgets.teamSitesList.isUserJoined;
			                }

			            }
			        }

			        if (myFavoriteTeams.length > 0) {
			            for (var i = 0; i < myFavoriteTeams.length; i++) {
			                if (link === myFavoriteTeams[i]) {
			                    isFav = true;
			                    if (Widgets.teamSitesList.isFavSite === '') {
			                        Widgets.teamSitesList.isFavSite = true;
			                        viewModel.isFavSite = true;
			                    }
			                    else viewModel.isFavSite = Widgets.teamSitesList.isFavSite;
			                }

			            }
			        }
			        //return article
			        return {
			            pageTitle: mappedFields[filteringProperties[2]],
			            link: mappedFields[filteringProperties[1]],
			            tileColor: term === undefined ? term : term.get_customProperties()['Color'],
			            infoCatFirstLetter: term === undefined ? term : term.get_name()[0].toUpperCase(),
			            infoCatName: term === undefined ? term : term.get_name(),
			            isJoined: isJoined,
			            isFav: isFav
			        };
			    }).first(this.rowLimit).toArray();
			}
			else $('#sortTeamSiteDropdown').hidden;
			Widgets.teamSitesList.viewModel = viewModel;
			return viewModel;
		},
		//retaining default
		bind: function (template, data) {
			template = Handlebars.compile(template);
			var html = template(data);
			return html;
		},
		getUserData: function () {
		    var deferred = $.Deferred();
		    var clientContext = new SP.ClientContext.get_current();
		    var peopleManager = new SP.UserProfiles.PeopleManager(clientContext);
		    var userProfileProperties = peopleManager.getMyProperties()
		    clientContext.load(userProfileProperties);
		    clientContext.executeQueryAsync(
                    Function.createDelegate(this,
                        function () {
                            deferred.resolve(userProfileProperties);
                        }),
                    Function.createDelegate(this,
                        function (sender, args) { deferred.reject(sender, args); }));
		    return deferred.promise();
		},
		saveMyFav: function (newFavs) {
		    var self = this;
		    var deferred = $.Deferred();
		    var selectionCount = 0;
		    var arrSelections = [];

		    $.when(this.getUserData()).then(
                function (userProfileProperties) {
                    var clientContext = new SP.ClientContext.get_current();
                    var peopleManager = new SP.UserProfiles.PeopleManager(clientContext);
                    //Get the account name of the current user. It will be in the following format: "i:0#.f|membership|username@yoursite.onmicrosoft.com"
                    var currentUserAccountName = userProfileProperties.get_accountName();
                    //set the value in their user profile
                    peopleManager.setSingleValueProfileProperty(currentUserAccountName, "BAHPinnedTeamSites", newFavs);//Set a single value property
                    clientContext.executeQueryAsync(function () {
                        deferred.resolve("success");
                    },
                    function (sender, args) {
                        var errMsg = "Error setting personal feed: " + args.get_message();
                        console.log(errMsg);
                    });
                });

		    return deferred.promise();

		},
		render: function (data) {
		    var self = this;
		    var $container = $(this.container);
		    $container.html(data);

            //descriptive text on the page for this widget
		    //$(".descText").html("<p class='panel radius'>This page displays collaboration sites to which you have access. Follow a site to personalize the way site tiles appear on this page. " +
        	//	                "Pin up to four sites to personalize the list of sites displayed for you on the Zone homepage under the My Teams heading.</p><br/>"
            //);
		    

		    ////Sort selection changes event handler.
		    $('#sortTeamSiteDropdown').change(function () {
		        var sort = $('#sortTeamSiteDropdown').val();
	
		        if (sort != prevSortTeamSite) {
		            prevSortTeamSite = sort;
		            var widgets = $("[data-widget='teamSitesList']").each(function (i, w) {
		                var widget = Widgets['teamSitesList'];
		                if (widget) {
		                    widget.container = w;
		                    Widget.load(widget);
		                }
		            });
		        }
		    });

		    $(document).on('click', ".favbutton", function () {
		        var button = $(this);
		        var isUserFav = button.attr("data-userfav") === "true" ? true : false;
		        var siteUrl = button.attr("data-url");
		        var controlWrapper = button.closest('article');
		        var selections = "";
		        var favCount = 0;

		        //count how many favs they have, becuase they can only have 4
		        $.each($("div[data-userfav='true'"), function () {
		            favCount += 1;
		        });

		        if (!isUserFav) {
		            if (favCount < 4) {
		                //update the button 
		                button.attr("data-userfav", "true");

		                //grab all the user favs, we want to overwrite all of them each time
		                //this will prevent orphaned fav sites
		                $.each($("div[data-userfav='true'"), function () {
		                    selections += $(this).attr("data-url") + "|";
		                });

		                //save selections to user property
		                self.saveMyFav(selections.substring(0, selections.length - 1)).then(function (data) {
		                    if (data == "success") {
		                        //change the current button
		                        button.attr("class", "favbutton-pinned");
		                    }
		                });
		            }
		        }
		    });

		    $(document).on('click', ".favbutton-pinned", function () {
		        var button = $(this);
		        var isUserFav = button.attr("data-userfav") === "true" ? true : false;
		        var siteUrl = button.attr("data-url");
		        var controlWrapper = button.closest('article');
		        var selections = "";
		        var favCount = 0;

		        //change the current button
		        button.attr("data-userfav", "false");

		        //grab all the user favs, we want to overwrite all of them each time
		        //this will prevent orphaned fav sites
		        $.each($("div[data-userfav='true'"), function () {
		            selections += $(this).attr("data-url") + "|";
		        });

		        //save selections to user property
		        self.saveMyFav(selections.substring(0, selections.length - 1)).then(function (data) {
		            if (data == "success") {
		                //change the current button
		                button.attr("class", "favbutton");
		            }
		        });
		    });

		    $(".followbutton").click(function () {
		        var button = $(this);
		        var isUserJoined = button.attr("data-userjoined") === "true" ? true : false;
		        $('#my-followedteams-view').removeClass('disabled');
		        var siteUrl = button.attr("data-url");
		        var controlWrapper = button.closest('article');

		        if (!isUserJoined) {
		            Bah.followSite(siteUrl);
		            button.text("Unfollow");
		            button.attr("data-userjoined", "true");
		        }
		        else {
		            Bah.stopFollowSite(siteUrl);
		            if (controlWrapper === undefined) {
		                button.text("");
		                button.append($('<span></span>').text("Join this site"));
		            } else {
		                button.text("Follow");
		            }
		            button.attr("data-userjoined", "false");
		        }
		        if (controlWrapper !== undefined) {
		            controlWrapper.toggleClass("joined not-joined");
		        }
		    });

		    $(".teamlist-view").click(function () {
		        if (!$(this).hasClass('disabled')) {
		            var $listboxes = $('.list-boxes');
		            $listboxes.toggleClass('show-my-followedteams', $(this).text() != 'All');

		            if (!$(this).hasClass('active')) {
		                $(this).addClass('active');
		            }

		            if ($(this).text() != 'All') {
		                $('#all-teams-view').removeClass('active');
		                Widgets.teamSitesList.isUserJoined = true;
		            } else {
		                $('#my-followedteams-view').removeClass('active');
		                Widgets.teamSitesList.isUserJoined = false;
                    }           
		        }
		    });

		    if (!Widgets.teamSitesList.isUserJoined) {
		        var tiles = $(self.container).find(".list-boxes");
		        tiles.removeClass('show-my-followedteams');
		      //  $('#my-followedteams-view').addClass('disabled');

		        $('#all-teams-view').click();
		    }
		    else {
		        $('#my-followedteams-view').click();
		    }

		    ////Register Event and use Once only if View More can be displayed in mobile
		    var $viewMore = $container.find('.view-more:not([style])');
		    $viewMore.one('click', function () {
		        $container.find('article a.hide_mobile1').removeClass('hide_mobile1');
		        $viewMore.hide();
		    });
		},

		fail: function (error, event) {
			Bah.logging.error(event, this.name);
		}
	};
})(jQuery);
///#source 1 1 Widgets/TeamSite/newTeamSite.js
var Widgets = Widgets || {};
//this is the old one
(function ($) {
	Widgets.newTeamSite = {
		name: "New Team Site",
		log: true,
		load: function () {
			Widgets.newTeamSite.authenticate();
			Widgets.newTeamSite.setAllowed();
			$(this.container).on('click', function () {
				Widgets.newTeamSite.getAppRedirectUrlFromCatalog("BAH.Intranet", function (url) {
					var redirectUrl = url;
					var splitInQueryString = redirectUrl.split('?');
					redirectUrl = redirectUrl.insertAtPosition(splitInQueryString[0].length, "team");
					redirectUrl = redirectUrl.replace(/(SPHostUrl=)[^\&]+/, '$1' + _spPageContextInfo.webAbsoluteUrl) + "&siteTemplate=Team Site"
                        + '&prevUrl=' + encodeURIComponent(window.location.href);
					window.location.href = redirectUrl;
				});
			});
		},

		setAllowed: function () {
			var termSet;
			var container = $(this.container);
			var url = Bah.configuration.teamSitesSiteCollectionUrl;
			var ctx = new SP.ClientContext(url);
			var web = ctx.get_web();
			var ob = new SP.BasePermissions();
			ob.set(SP.PermissionKind.manageSubwebs);
			var per = web.doesUserHavePermissions(ob);
			ctx.executeQueryAsync(
				Function.createDelegate(this,
					function () {
						if (per.get_value()) {
							container.show();
						}
					}),
				Function.createDelegate(this,
					function (sender, args) { deferred.reject(sender, args); }));
		},

		getAppRedirectUrlFromCatalog: function (appTitle, callback) {
			var ongetAppRedirectUrlFailed = function (sender, args) {
				Bah.logging.error('Request failed. ' + args.get_message() + '\n' + args.get_stackTrace(), this.name);
			};

			var ongetAppRedirectUrlSucceeded = function (appCollection, appTitle, web, callback) {
				var appsEnumerator = appCollection.getEnumerator();
				while (appsEnumerator.moveNext()) {
					var result = '';
					var current = appsEnumerator.get_current();
					if (current.get_title() == appTitle) {
						var webUrl = web.get_url();
						result = getAppRedirectQueryString(current, webUrl);
						callback(result);
						break;
					}
				}
				Bah.logging.info('App found, Redirection success', this.name);
			};

			var onGetAppCatalogSuccess = function (context, web, appTitle, callback) {
				var appCollection = SP.AppCatalog.getAppInstances(context, web);
				context.load(web, "Url");
				context.load(appCollection, "Include(Title, StartPage, AppWebFullUrl)");
				context.executeQueryAsync(
                    Function.createDelegate(this, function () { ongetAppRedirectUrlSucceeded(appCollection, appTitle, web, callback); }),
                    Function.createDelegate(this, ongetAppRedirectUrlFailed)
                );
			};

			var onGetAppCatalogError = function (context, web) {
				Bah.logging.error('Request failed.', this.name);
			};

			var getAppCatalogUrlCallback = function (url, appTitle, callback) {
				if (url == null) {
					return;
				}

				var crossSiteContext = new SP.ClientContext(url);
				var appCatalogWeb = crossSiteContext.get_web();
				crossSiteContext.load(appCatalogWeb);
				crossSiteContext.executeQueryAsync(
                    function (sender, args) { onGetAppCatalogSuccess(crossSiteContext, appCatalogWeb, appTitle, callback); },
                    function (sender, args) { onGetAppCatalogError(crossSiteContext, appCatalogWeb); }
                );
			};

			var getAppRedirectQueryString = function (app, currentContextUrl) {
				var startPage = app.get_startPage().replace("{StandardTokens}", "");
				var appWebFullUrl = app.get_appWebFullUrl();
				var url = "{0}SPHostUrl={1}&SPLanguage=en-US&SPClientTag=0&SPProductNumber=16%2E0%2E3514%2E1228&SPAppWebUrl={2}".customFormat(startPage, currentContextUrl, appWebFullUrl);
				return url;
			};

			var url = Bah.configuration.rootSiteCollectionUrl;
			getAppCatalogUrlCallback(url, appTitle, callback);
		},

		authenticate: function () {
			var authenticationPromises = [];
			var appCatalogUrl = '';

			var appUrlKey = function () {
				return 'bahAppUrl_' + appCatalogUrl;
			};

			var setAppUrl = function (appUrl) {
				localStorage[appUrlKey()] = appUrl;
			};

			var getAppInstanceId = function () {
				var result = $.Deferred();
				$.ajax({
					method: 'GET',
					url: appCatalogUrl + "/_api/web/getAppInstancesByProductId('8d1d5405-97eb-48e1-8ed4-358902c06b8a')",
					success: function (response) {
						result.resolve(response.d.results[0].Id);
					},
					headers: {
						Accept: 'application/json;odata=verbose'
					},
					xhrFields: {
						withCredentials: true
					}
				});
				return result;
			};

			var getQuerystringParamValue = function (url, paramName) {
				paramName = paramName.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
				var regex = new RegExp("[\\?&]" + paramName + "=([^&#]*)"),
                    results = regex.exec(url);
				return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
			};

			var getRootUrl = function (url) {
				var l = document.createElement("a"),
                    result;
				l.href = url;
				result = l.protocol + '//' + l.hostname;
				if (l.port && l.port > 0) {
					result += ':' + l.port;
				}
				return result;
			};

			var getAppUrlByAction = function (url) {
				return url.split('?')[0];
			};

			var getAppInstanceIdDone = function (appInstanceId) {
				var iframeAppRedirectId = 'appRedirectFrame',
                    iframeAppRedirectSrc = appCatalogUrl + "/_layouts/15/appredirect.aspx?instance_id=" + appInstanceId;

				$('body').append('<iframe id="' + iframeAppRedirectId + '" name="' + iframeAppRedirectId + '" style="display: none"></iframe>');
				$("#" + iframeAppRedirectId).load(iframeAppRedirectSrc + " #frmRedirect", function () {
					var inputSpAppToken = $('#frmRedirect').find('input[name="SPAppToken"]')[0],
                        formAction = inputSpAppToken.form.action,
                        info = {};

					info.spAppToken = inputSpAppToken.value;
					info.spLanguage = getQuerystringParamValue(formAction, "SPLanguage");
					info.spHostUrl = _spPageContextInfo.webAbsoluteUrl;
					info.spClientTag = getQuerystringParamValue(formAction, "SPClientTag");
					info.spProductNumber = getQuerystringParamValue(formAction, "SPProductNumber");
					info.appUrl = getAppUrlByAction(formAction);

					setAppUrl(info.appUrl);

					// POST the SPAppToken to ensure cookie is set
					var reqUrl = info.appUrl + '/authentication' + '?SPHostUrl=' + encodeURIComponent(info.spHostUrl)
                        + '&SPAppWebUrl=' + encodeURIComponent(info.appUrl)
                        + '&SPLanguage=' + encodeURIComponent(info.spLanguage)
                        + '&SPClientTag=' + encodeURIComponent(info.spClientTag)
                        + '&SPProductNumber=' + encodeURIComponent(info.spProductNumber);

					$('body').append('<form action="' + reqUrl + '" method="post" target="' + iframeAppRedirectId + '" id="cookieform">\
                    <input type="hidden" name="SPAppToken" value="' + info.spAppToken + '" />\
                    </form>');

					$('#cookieform').submit();

					$('#' + iframeAppRedirectId).load(function () {
						// Clean up the iframe and form

						self.authenticating = false; // reset flag

						// resolve all promises that are waiting on authentication
						while (authenticationPromises.length > 0) {
							authenticationPromises.pop().resolve();
						}
					});
				});
			};

			var result = $.Deferred();

			// All promises in the authenticationPromises array will be resolved when authentication completes
			authenticationPromises.push(result);

			if (self.authenticating) {
				// Don't start the process more than once
				return result;
			} else {
				self.authenticating = true;
			}

			appCatalogUrl = Bah.configuration.rootSiteCollectionUrl;
			getAppInstanceId().done(getAppInstanceIdDone);

			return result;
		}
	};
})(jQuery);
///#source 1 1 Widgets/TeamSite/newTeamSiteCollection.js
var Widgets = Widgets || {};
(function ($) {
    Widgets.newTeamSiteCollection = {
        name: "New Team Site",
        log: true,
        load: function (options) {
            var self = this;
            self.options = options;
            self.initView();
        },
        initView: function () {
            var self = this;
            var template = Handlebars.compile($('#newTeamSiteCollectionTemplate').html());
            var siteurl = Bah.configuration.rootSiteCollectionUrl + "/scprovisioning";
            //var spHostUrl = decodeURIComponent(getQueryStringParameter(Bah.configuration.rootSiteCollectionUrl));
            


            //alert(siteurl);
            var html = template();
            $(Widgets.newTeamSiteCollection.container).html(html);
            self.buildUserModal();
        },
        buildUserModal: function () {
            var self = this;
            $(document).foundation('reveal', 'reflow');
            $(document).foundation('tab', 'reflow');

            $("#showMyTeamsModal").on("click", function () {
                //only open the newsfeed modal after we have gotten the users feed and updated the checkbox values. what is this???
                //Get the user's work phone and email
                //is this available in header??
                //This is being loaded on the initial page. where to add this so that it gets loaded when user clickc on create new link??
                var userInfoArray = { userWorkEmail: '', UserWorkPhone: '' };

                $.when(self.getUserData()).then(
                    function (userProfileProperties) {
                        var clientContext = new SP.ClientContext.get_current();
                        var peopleManager = new SP.UserProfiles.PeopleManager(clientContext);
                        //Get the account name of the current user.
                        var currentUserAccountName = userProfileProperties.get_accountName();

                        var userEmail = peopleManager.getUserProfilePropertyFor(currentUserAccountName, "WorkEmail");
                        var userPhone = peopleManager.getUserProfilePropertyFor(currentUserAccountName, "WorkPhone");

                        clientContext.executeQueryAsync(
                                Function.createDelegate(this,
                                function () {
                                    userInfoArray.userWorkEmail = userEmail.get_value();
                                    userInfoArray.UserWorkPhone = userPhone.get_value();
                                    var template = Handlebars.compile($('#newTeamSiteCollectionTemplate').html());
                                    html = template(userInfoArray);
                                    $(self.container).html(html);
                                    self.modalHelper();
                                    $("#teamsModal").foundation("reveal", "open");
                                    
                                    
                                    self.buildUserModal();
                                }),
                            Function.createDelegate(this, function (sender, args) {
                                Bah.logging.error('Error trying to retrieve properties from this user profile.', this.name);
                            })
                        );
                    });
            });
        },
        getUserData: function () {
            var deferred = $.Deferred();
            var clientContext = new SP.ClientContext.get_current();
            var peopleManager = new SP.UserProfiles.PeopleManager(clientContext);
            var userProfileProperties = peopleManager.getMyProperties()
            clientContext.load(userProfileProperties);
            clientContext.executeQueryAsync(
                    Function.createDelegate(this,
                        function () {
                            deferred.resolve(userProfileProperties);
                        }),
                    Function.createDelegate(this,
                        function (sender, args) { deferred.reject(sender, args); }));
            return deferred.promise();
        },
        urlValidator: function (url) {
            var self = this;
            console.log("checking " + url + "...");
            var context = new SP.ClientContext(url);
            var parWeb = context.get_web();
            var message = '';
            context.load(parWeb);
            context.executeQueryAsync(
              function () {
                  message = "Site Exists";
                  console.log("success: " + parWeb.get_title());
                  self.urlValid = false;
                  $("#vSiteUrl").text("This site already exists");
                  //$("#panel2-3").removeClass("active");
              },
              function (sender, args) {
                  var webReq = args.get_webRequestExecutor();
                  var httpResp = webReq._xmlHttpRequest;
                  var statusText = httpResp.statusText;
                  if (statusText == "Forbidden") {
                      self.urlValid = false;
                      $("#vSiteUrl").text("This site already exists");
                      //don't let the user proceed to next tab.
                      //$("#panel2-3").removeClass("active");
                     
                  }
                  else {
                      self.urlValid = true;
                      $("#vSiteUrl").text("");
                  }
                  console.log("fail: " + args.get_message() + "----" + args.get_stackTrace());
              }
            );
        },
        urlValid: false,
        modalHelper: function () {
            var self = this;
            $("#btnTab1Next").click(function () {
                $("#vPhone").text("");
                $("#vEmail").text("");
                $("#vStream").text("");

                var check = true;
                //validate phone
                var phone = $('#ReqPhone').val();
                var phoneno = /^\(?([0-9]{3})\)?[-. ]?([0-9]{3})[-. ]?([0-9]{4})$/;

                if (phone == null || phone == "") {
                    $("#vPhone").text("Please enter a phone number");
                    check = false;
                }

                //if (!phone.match(phoneno)) {
                //    $("#vPhone").text("Phone Format should be XXX-XXX-XXXX");
                //    check = false;
                //}


                //validate email
                var email = $('#ReqEmail').val();
                var filter = /^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;

                if (email == null || email == "") {
                    $("#vEmail").text("Please enter an email Id.");
                    check = false;
                }

                if (!filter.test(email)) {
                    $("#vEmail").text("Please provide a valid email address.");
                    check = false;

                }
                //validate stream
                var stream = $('#ReqStream').val();
                if (stream == null || stream == "") {
                    $("#vStream").text("Please select an organization.");
                    check = false;
                }

                if (check) {
                    $("#panel2-2").addClass("active");
                    $("#panel2-1").removeClass("active");
                    /* JDK added */
                    /* this fixes the non-scroll issue on smaller browsers */
                    var docHeight = $(document).height();
                    var modalHeight = $('#teamsModal').height();

                    if (docHeight < (modalHeight + 200)) {
                        
                        $('.tabs-content').css('height',  docHeight - 400 + 'px').css('overflow-y','scroll');
                    }

                    $("#rootCollectionURL").text(Bah.configuration.rootSiteCollectionUrl + "/teams/");
                }
            });
            var delay = (function () {
                var timer = 0;
                return function (callback, ms) {
                    clearTimeout(timer);
                    timer = setTimeout(callback, ms);
                };
            })();

            $('#ReqURL').keyup(function () {
                delay(function () {
                    var value = $('#ReqURL').val();
                    var url = Bah.configuration.rootSiteCollectionUrl + "/teams/" + value;
                    self.urlValidator(url);
                }, 1500);
            });
            //$('#ReqURL').keyup(function() {
            //    var value = $('#ReqURL').val();
            //    var url = Bah.configuration.rootSiteCollectionUrl + "/sites/teams/" + value;
            //    self.urlValidator(url);
            //});
            //show tabs on next button click
            $("#btnTab2Next").on("click", function () {

                $("#vSiteName").text("");
                $("#vSiteUrl").text("");
                $("#vTemplate").text("");
                $("#vInfoCat").text("");
                $("#vSiteSponsor").text("");
                $("#vPrimaryAdmin").text("");
                $("#vSecondaryAdmin").text("");
                $("#vSiteUrl").text("");


                var check = true;
                //validate Site Name
                var siteName = $('#ReqName').val();
                if (siteName == null || siteName == "") {
                    $("#vSiteName").text("Please enter a site name");
                    check = false;
                }
                //validate Site Url
                var siteUrl = $('#ReqURL').val();
                if (siteUrl == null || siteUrl == "") {
                    $("#vSiteUrl").text("Please enter a site url");
                    check = false;
                }
                //validate siteURL for special chars
                var splChars = "*|,\":<>[]{}`\';()@&$#%";
                for (var i = 0; i < siteUrl.length; i++) {
                        if (splChars.indexOf(siteUrl.charAt(i)) != -1) {
                            check = false;
                            $("#vSiteUrl").text("Please enter a URL without special characters.");
                        }
                    }

                //if (!self.urlValid) {
                //    $("#vSiteUrl").text("Please enter a valid site url");
                //    check = false;
                //}

                //validate Site Template
                var siteTemplate = $('#ReqTemplate').val();
                if (siteTemplate == null || siteTemplate == "") {
                    $("#vTemplate").text("Please select a site Template");
                    check = false;
                }
                //validate Info category
                var infoCat = $('#ReqCat').val();
                if (infoCat == null || infoCat == "") {
                    $("#vInfoCat").text("Please select a Information Category");
                    check = false;
                }

                //validate Site Sponsor
                var siteSponsor = $('#ReqSiteSponsor').find('input').val();
                if (siteSponsor == null || siteSponsor == "" || siteSponsor == "[]") {
                    $("#vSiteSponsor").text("Please enter a site Sponsor");
                    check = false;
                }
                //validate Primary admin
                var primaryAdmin = $('#ReqPrimaryAdmin').find('input').val();
                if (primaryAdmin == null || primaryAdmin == "" || primaryAdmin == "[]") {
                    $("#vPrimaryAdmin").text("Please select a Primary administrator");
                    check = false;
                }
                //validate Site Template
                var secondaryAdmin = $('#ReqSecondaryAdmin').find('input').val();
                if (secondaryAdmin == null || secondaryAdmin == "" || secondaryAdmin == "[]") {
                    $("#vSecondaryAdmin").text("Please select a Secondary administrator");
                    check = false;
                }
                //validate if Primary adminand Secondary admin are different
                var primaryAdmin = JSON.parse($('#ReqPrimaryAdmin').find('input').val())[0].DisplayText;
                var secondaryAdmin = JSON.parse($('#ReqSecondaryAdmin').find('input').val())[0].DisplayText;
                if (secondaryAdmin == primaryAdmin) {
                    $("#vSecondaryAdmin").text("Primary and Secondary administrator cannot be same. Please select a different Secondary administrator");
                    check = false;
                }
                //validate if url exists on btn next click
                if (self.urlValid == false) {
                    $("#vSiteUrl").text("This site already exists");
                    check = false;
                }

                
                if (check) {
                   
                    $("#panel2-3").addClass("active");
                    $("#panel2-2").removeClass("active");
                    $("#panel2-1").removeClass("active");
                    //Reqconfirmation fields
                    $('#cPhone').text($('#ReqPhone').val());
                    $('#cOrganization').text(JSON.parse($('#ReqStream').val())[0].Name);
                    $('#cEmail').text($('#ReqEmail').val());
                    //Site and sponsor Confirmation fields
                    $('#cSiteName').text($('#ReqName').val());
                    $('#cSiteURL').text(Bah.configuration.rootSiteCollectionUrl + "/teams/" + $('#ReqURL').val());
                    $('#cTemplate').text(JSON.parse($('#ReqTemplate').val())[0].Name);
                    $('#cInfoCat').text(JSON.parse($('#ReqCat').val())[0].Name);
                    $('#cSiteDescription').text($('#ReqDescription').val());

                    $('#cSiteSponsor').text(JSON.parse($('#ReqSiteSponsor').find('input').val())[0].DisplayText);
                    $('#cPrimaryAdmin').text(JSON.parse($('#ReqPrimaryAdmin').find('input').val())[0].DisplayText);
                    $('#cSecondaryAdmin').text(JSON.parse($('#ReqSecondaryAdmin').find('input').val())[0].DisplayText);
                    $('#vSubmitterEmail').text($('#ReqEmail').val());
                }
            });

            //show tabs on back button click
            $("#btnTab2Back").on("click", function () {
                $("#panel2-2").removeClass("active");
                $("#panel2-1").addClass("active");
            });

            //show tabs on back button click
            $("#btnTab3Back").on("click", function () {
                $("#panel2-3").removeClass("active");
                $("#panel2-2").addClass("active");
            });

            $("#submitTeamSite").click(function () {

                var siteProvisiningSiteURL = Bah.configuration.scProvisionSiteURL;
                var scProvisionList = Bah.configuration.scProvisionList;
                //alert("Hello memi");
                var clientContext = new SP.ClientContext(siteProvisiningSiteURL);
                var oList = clientContext.get_web().get_lists().getByTitle(scProvisionList);

                var itemCreateInfo = new SP.ListItemCreationInformation();
                var oListItem = oList.addItem(itemCreateInfo);
                //what should be the title?
                oListItem.set_item('Title', 'New SC Request');
                var url = Bah.configuration.rootSiteCollectionUrl +"/teams/" + $("#ReqURL").val();
                oListItem.set_item('BAH_SiteCollectionURLName',url);
                oListItem.set_item('BAH_SiteCollectionTitle', $("#ReqName").val());

                var userID = JSON.parse($('#ReqSiteSponsor').find('input').val())[0].Key;
                var userField = SP.FieldUserValue.fromUser(userID);
                oListItem.set_item('BAH_TeamSiteSponsor', userField);

                var userID = JSON.parse($('#ReqPrimaryAdmin').find('input').val())[0].Key;
                var userField = SP.FieldUserValue.fromUser(userID);
                oListItem.set_item('BAH_TeamSitePrimaryAdmin', userField);

                var userID = JSON.parse($('#ReqSecondaryAdmin').find('input').val())[0].Key;
                var userField = SP.FieldUserValue.fromUser(userID);
                oListItem.set_item('BAH_TeamSiteSecondaryAdmin', userField);


                var field = oList.get_fields().getByInternalNameOrTitle("BAH_InfoCat");
                var taxField = clientContext.castTo(field, SP.Taxonomy.TaxonomyField);
                var taxonomySingle = new SP.Taxonomy.TaxonomyFieldValue();
                taxonomySingle.set_label(JSON.parse($('#ReqCat').val())[0].Name);
                taxonomySingle.set_termGuid(JSON.parse($('#ReqCat').val())[0].Id);
                taxonomySingle.set_wssId(-1);
                taxField.setFieldValueByValue(oListItem, taxonomySingle);

                var field = oList.get_fields().getByInternalNameOrTitle("BAH_Stream");
                var taxField= clientContext.castTo(field, SP.Taxonomy.TaxonomyField);
                var taxonomySingle = new SP.Taxonomy.TaxonomyFieldValue();
                taxonomySingle.set_label(JSON.parse($('#ReqStream').val())[0].Name);
                taxonomySingle.set_termGuid(JSON.parse($('#ReqStream').val())[0].Id);
                taxonomySingle.set_wssId(-1);
                taxField.setFieldValueByValue(oListItem, taxonomySingle);


                var field = oList.get_fields().getByInternalNameOrTitle("BAH_TeamSiteType");
                var taxField = clientContext.castTo(field, SP.Taxonomy.TaxonomyField);
                var taxonomySingle = new SP.Taxonomy.TaxonomyFieldValue();
                taxonomySingle.set_label(JSON.parse($('#ReqTemplate').val())[0].Name);
                taxonomySingle.set_termGuid(JSON.parse($('#ReqTemplate').val())[0].Id);
                taxonomySingle.set_wssId(-1);
                taxField.setFieldValueByValue(oListItem, taxonomySingle);



                oListItem.set_item('BAH_Description', $('#ReqDescription').val());

                //oListItem.set_item('BAH_RCCode', $("#ReqEmail").val());

                oListItem.set_item('BAH_TeamSitePhone', $("#ReqPhone").val());
                oListItem.set_item('BAH_TeamSiteEmail', $("#ReqEmail").val());



                oListItem.update();
                clientContext.load(oListItem);
                clientContext.executeQueryAsync(Function.createDelegate(this, function () {

                    //alert("success");
                    $("#panel2-4").addClass("active");
                    $("#panel2-1").removeClass("active");
                    $("#panel2-2").removeClass("active");
                    $("#panel2-3").removeClass("active");

                }),
                    Function.createDelegate(this, function (sender, args) {
                        //alert("failed");
                        console.log('Request failed. ' + args.get_message() + '\n' + args.get_stackTrace());

                    })
                );
                //}//end of if
                //else
                //{
                //    $(".ms-formvalidation").text("Please enter email in order to submit the request.");
                //}

            });

            // Specify the unique ID of the DOM element where the
            // picker will render.
            initializePeoplePicker('ReqSiteSponsor');
            initializePeoplePicker('ReqPrimaryAdmin');
            initializePeoplePicker('ReqSecondaryAdmin');
            //initialize stream,Info Cat and Template
            self.initializetaxonomyPicker();
            //iniialize Info Cat
            


        },
        initializetaxonomyPicker: function () {
            var layoutsRoot = Bah.configuration.rootSiteCollectionUrl + "/_layouts/15/";
            //https://github.com/OfficeDev/PnP/tree/master/Components/Core.TaxonomyPicker
            var context = new SP.ClientContext.get_current();
            // variable to hold index of intialized taxPicker controls
            var taxPickerIndex = {};


            $.getScript(layoutsRoot + 'SP.Runtime.js',
                function () {
                $.getScript(layoutsRoot + 'SP.js',
                    function () {                   
                   //load scripts for calling taxonomy APIs
                   $.getScript(layoutsRoot + 'init.js',
                       function () {
                           $.getScript(layoutsRoot + 'sp.taxonomy.js',
                               function () {
                                   //bind the taxonomy picker to stream termset
                                   $('#ReqStream').taxpicker({
                                       isMulti: false,
                                       allowFillIn: false,
                                       termSetId: '36b1a08e-7333-4d72-a26c-c22b8179e445'
                                   }, context);
                                   //bind the taxonomy picker to InfoCat termset
                                   $('#ReqCat').taxpicker({
                                       isMulti: false,
                                       allowFillIn: false,
                                       termSetId: '794300fe-9a7a-4542-a660-7510d9f05450'
                                   }, context);
                                   //taxPickerIndex["#ReqInfoCat"] = 4;
                                   $('#ReqTemplate').taxpicker({
                                       isMulti: false,
                                       allowFillIn: false,
                                       termSetId: '0f5fdde4-51fa-4979-bd98-ca6413bafc89'
                                   }, context);

                               });
                       });
               });
       });


        }

    }

       

    
        // Render and initialize the client-side People Picker.
        function initializePeoplePicker(peoplePickerElementId) {

        // Create a schema to store picker properties, and set the properties.
        var schema = {};
        schema['PrincipalAccountType'] = 'User,DL,SecGroup,SPGroup';
        schema['SearchPrincipalSource'] = 15;
        schema['ResolvePrincipalSource'] = 15;
        schema['AllowMultipleValues'] = false;
        schema['MaximumEntitySuggestions'] = 50;
        schema['Width'] = '280px';
        schema['MaxUsers'] = 1;

        // Render and initialize the picker. 
        // Pass the ID of the DOM element that contains the picker, an array of initial
        // PickerEntity objects to set the picker value, and a schema that defines
        // picker properties.
        this.SPClientPeoplePicker_InitStandaloneControlWrapper(peoplePickerElementId, null, schema);
        }
     
    
    //function to get a parameter value by a specific key
        function getQueryStringParameter(urlParameterKey) {
            var params = document.URL.split('?')[1].split('&');
            var strParams = '';
            for (var i = 0; i < params.length; i = i + 1) {
                var singleParam = params[i].split('=');
                if (singleParam[0] == urlParameterKey)
                    return singleParam[1];
            }
        }





})(jQuery);
///#source 1 1 Widgets/Events/eventDetails.js
var Widgets = Widgets || {};
(function ($) {
    Widgets.eventDetails = {
        name: "Event Details",
        fetch: function () {
            var getDetailsForCurrentEvent = function () {
                var listTitle = Bah.GetQueryStringParams('listTitle') != undefined ? decodeURIComponent(Bah.GetQueryStringParams('listTitle')) : 'Calendar';
                var sourceUrl = Bah.GetQueryStringParams('sourceUrl') != undefined ? Bah.GetQueryStringParams('sourceUrl') : '';
                var eventId = Bah.GetQueryStringParams('eventId') != undefined ? Bah.GetQueryStringParams('eventId') : '';
                // Get date from querystring to handle recurrence
                var recurrentDate = Bah.GetQueryStringParams('eventDate') && Date.parse(decodeURIComponent(Bah.GetQueryStringParams('eventDate'))); 
                var deferred = $.Deferred();
                var clientContext = new SP.ClientContext(sourceUrl);
                var web = clientContext.get_web();
                var eventsList = web.get_lists().getByTitle(listTitle);
                var targetListItem = eventsList.getItemById(eventId);

                clientContext.load(targetListItem, 'Title', 'Description', 'Location', 'EventDate', 'EndDate', 'fAllDayEvent');
                clientContext.executeQueryAsync(
                        Function.createDelegate(this,
                            function () {
                                var result = {
                                    data: '',
                                    eventDate: '',
                                    endDate: '',
                                    allDayEvent: false,
                                    eventMonth: '',
                                    eventDay: ''
                                };

                                var allDayEvent = targetListItem.get_item('fAllDayEvent');
                                var eventDate = targetListItem.get_item('EventDate');
                                var endDate = targetListItem.get_item('EndDate');
                                if (recurrentDate) {
                                    eventDate = new Date(recurrentDate);
                                }

                                // All day events are treated differently
                                if (allDayEvent) {
                                    result.data = targetListItem;
                                    result.eventDate = recurrentDate ? eventDate : new Date(eventDate).setDate(eventDate.getDate()+1); 
                                    result.endDate = endDate;
                                    result.allDayEvent = allDayEvent;
                                    deferred.resolve(result);
                                } else {
                                    var regSettings = web.get_regionalSettings();
                                    var timeZone = regSettings.get_timeZone();
                                    var isoDate = timeZone.utcToLocalTime(eventDate.toISOString());
                                    var isoEndDate = timeZone.utcToLocalTime(endDate.toISOString());

                                    ////A second async query must be made so the utlToLocalTime method can work, otherwise it will always return null
                                    clientContext.executeQueryAsync(
                                        Function.createDelegate(this,
                                            function () {
                                                result.data = targetListItem;
                                                result.eventDate = recurrentDate || isoDate.get_value();
                                                result.endDate = isoEndDate.get_value();
                                                result.allDayEvent = allDayEvent;
                                                deferred.resolve(result);
                                            }),
                                        Function.createDelegate(this,
                                            function (sender, args) { deferred.reject(sender, args); }));
                                }
                            }),
                        Function.createDelegate(this,
                            function (sender, args) { deferred.reject(sender, args); }));

                return deferred.promise();
            };
            return getDetailsForCurrentEvent();
        },

        parse: function (result) {
            var dataTitle = $(this.container).data('title');
            var viewModel = {
                title: '',
                location: '',
                description: '',
                startTime: '',
                endTime: '',
                month: result.eventMonth,
                day: result.eventDay,
                allDayEvent: false
            };

            var data = result.data;
            var eventDate = result.eventDate;
            var endDate = result.endDate;

            if (data != undefined) {
                var startTime = $.format.date(eventDate, 'h:mm a');
                var endTime = $.format.date(endDate, 'h:mm a');
                var description = data.get_item('Description') ? $('<div></div>').html(data.get_item('Description').replace(/&lt;/g, '<').replace(/&gt;/g, '>').replace(/&quot;/g, '"')).html() : '';

                viewModel.title = data.get_item('Title');
                viewModel.location = data.get_item('Location');
                viewModel.description = description;
                viewModel.startTime = startTime;
                viewModel.endTime = endTime;
                viewModel.month = viewModel.month || $.format.date(eventDate, 'MMM');
                viewModel.day = viewModel.day || $.format.date(eventDate, 'dd');
                viewModel.allDayEvent = data.get_item('fAllDayEvent');
            }
            return viewModel;
        },

        bind: function (template, data) {
            var template = Handlebars.compile(template);
            var html = template(data);
            return html;
        },

        render: function (data) {
        	$(this.container).html(data);

        	Widgets.eventDetails.copyRsvpLink();
        },

        fail: function (error, event) {
        	Bah.logging.error("Error at " + event, this.name);
        },

        template: function () {
            return $("#eventDetailsTemplate").html();
        },

		//If a rsvp link is present on the event description copies it to another location outside the description container so that it's shown on mobile.
        copyRsvpLink: function () {
        	var $eventDetails = $(this.container);
        	var $rsvpLink = $('article div .event-rsvp', $eventDetails);

        	if ($rsvpLink.length) {
        		$('<div class="mobile-event-rsvp">').html($rsvpLink.clone()).appendTo($eventDetails);
        	}
        },
    };
})(jQuery);
///#source 1 1 Widgets/Events/upcomingEventsSidebar.js
var Widgets = Widgets || {};
(function ($) {
	Widgets.upcomingEventsSidebar = {
		name: "Upcomig Events",
		fetch: function () {
			return Bah.getUpcomingEvents('Calendar');
		},

		parse: function (result) {
			var itemCount = $(this.container).data('item-count') !== undefined ? parseInt($(this.container).data('item-count')) : 10;
			var firstToTake = 5;
			var viewModel = {
				events: [],
				topEvents: [],
				allEventsLeft: []
			};
			if (result) {
				Bah.setModelForUpcomingEvents(viewModel, result, itemCount, firstToTake);
			}

			return viewModel;
		},

		bind: function (template, data) {
			var template = Handlebars.compile(template);
			var html = template(data);

			return html;
		},

		render: function (data) {
			$(this.container).html(data);
			
			this.handlers();
			BS.dotdotdoter.parseElement(this.container);
		},

		fail: function (error, event) {
			Bah.logging.error('Error at ' + event, this.name);
		},

		template: function () {
			return $("#upcomingEventsSidebarTemplate").html();
		},

		handlers: function () {
			$(".view-more").click(function () {
				var evensAllLeft = $('.events-all-left');
				if (evensAllLeft.css('display') == 'none') {
					evensAllLeft.css("display", "block");
					$(this).css("display", "none");
				} else {
					evensAllLeft.css("display", "none");
				}
			});
		}
	};
})(jQuery);
///#source 1 1 Widgets/Events/upcomingEventsListing.js
var Widgets = Widgets || {};
(function ($) {
	Widgets.upcomingEventsListing = {
		name: "Upcomig Events Listing",
		fetch: function () {
			return Bah.getUpcomingEvents('Calendar');
		},

		parse: function (result) {
			var itemCount = $(this.container).data('item-count') !== undefined ? parseInt($(this.container).data('item-count')) : 20;
			var firstToTake = 5;
			var viewModel = {
				events: [],
				topEvents: [],
				allEventsLeft: []
			};
			if (result) {
				Bah.setModelForUpcomingEvents(viewModel, result, itemCount, firstToTake);
			}

			return viewModel;
		},

		bind: function (template, data) {
			var template = Handlebars.compile(template);
			var html = template(data);

			return html;
		},

		render: function (data) {
			$(this.container).html(data);
			
			this.handlers();
		},

		fail: function (error, event) {
			Bah.logging.error('Error at ' + event, this.name);
		},

		template: function () {
			return $("#upcomingEventsListingTemplate").html();
		},

		handlers: function () {
			$(".view-more").click(function () {
				var eventsAllLeft = $('.events-all-left');
				if (eventsAllLeft.css('display') == 'none') {
					eventsAllLeft.css("display", "block");
					$(this).css("display", "none");
				} else {
					eventsAllLeft.css("display", "none");
				}
			});
		}
	};
})(jQuery);
///#source 1 1 Widgets/Help/helpSearch.js
var Widgets = Widgets || {};

(function ($) {
	Widgets.helpSearch = {
		name: "Help Search",
		log: true,

		template: function () {
			return $("#helpSearchTemplate").html();
		},

		fetch: function () {
			return Bah.configuration.helpSearchResultsPageUrl;
		},

		parse: function (data) {
			return data;
		},

		bind: function (template, redirectUrl) {
			var template = Handlebars.compile(template);
			var html = template(this.redirectUrl = redirectUrl);
			return html;
		},

		render: function (html) {
			// render and attach event here
			var self = this;
			var $container = $(this.container);
			$container.html(html);

			//just in case it gets rendered again
			//The below code can also be put in a load method since it does not depend on the contents
			//of this widget's container - Check alert which has been implemented similarly
			$container.off('click.helpSearch');

			if (this.redirectUrl) { //if no url, don't even bother registering event
				var submit = function (query) {
					if (query) {
						//redirect here
						window.location.href = self.redirectUrl + '?k=' + encodeURIComponent(query);
					}
					return false;
				};

				$container.on('click.helpSearch', '.btn-search', function () {
					return submit($container.find('.input').val());
				});

				$container.on('keydown', '.input', function (e) {
					var key = e.which;
					if (key === 13) {
						return submit($container.find('.input').val())
					}
				});
			}
		},

		fail: function (error, event) {
			Bah.logging.error(event, this.name);
		}
	};
})(jQuery);
///#source 1 1 Widgets/Help/feedback.js
var Widgets = Widgets || {};

(function ($) {
    Widgets.feedback = {
		name: 'Feedback',
		log: true,
		load: function (options) {
			var self = this;
			self.options = options;
			Widgets.feedback.container = self.container;

		    $.when(Bah.getAllTermsFromTermSet(Bah.Constants.Guid.HelpPageCategoryTermSet),
                Bah.GetUserDisplayNamePromise()).then(
                function (terms, user) {
                    var data = [];
                    if (terms) {
                        var termEnumerator = terms.getEnumerator();
                        while (termEnumerator.moveNext()) {
                            var term = termEnumerator.get_current();
                            data.push(term.get_name());
                        }
                    }
                    Widgets.feedback.initModal(data, user);
                });
		},

		fail: function (error, event) {
			Bah.logging.error(event, this.name);
		},

		initModal: function (data, user) {
		    var template = Handlebars.compile($('#feedbackTemplate').html());
		    var html = template();
		    $(Widgets.feedback.container).html(html);

		    $.each(data, function (key, value) {
		        $('#feedbackSelect')
                     .append($('<option>', { value: key })
                     .text(value));
		    });
		    $("#feedbackUser").text(user);
		    $("#feedbackSubmit").attr("disabled", false);
		    $("#feedbackSelect").wrap('<div class="select-bg">').selectbox({});
		    $('.reveal-modal#feedbackModal').mCustomScrollbar({
		    	autoHideScrollbar: true,
		    	mouseWheel: { preventDefault: true }
		    });
		    $('.feedbackRevealLink').click(function () {
		        $('#feedbackModal').foundation('reveal', 'open');
		    });

		    ////do events

		    ////Close modal event handler.
		    $(document).on('closed.fndtn.reveal', '#feedbackModal[data-reveal]', function () {
		        $("#feedbackModal textarea").val("");
		        $("#feedbackModal select").val($("#feedbackModal select option:first").val());
		        $("#feedbackSubmit").attr("disabled", false);
		        $(".ms-formvalidation").text("");
		        $("#feedbackModal .sbSelector").text($("#feedbackSelect option:selected").text());
		        if ($("#feedbackModal .sbOptions").css('display') !== 'none') {
                    $("#feedbackModal .sbOptions").css('display', 'none');
                    $("#feedbackModal .sbToggle").trigger("click");
		        }
		    });

		    ////Event handler for submitting.
		    $("#feedbackSubmit").click(function () {
		        var category = $("#sbSelector_" + $("#feedbackSelect").attr("sb")).text();
		        var comments = $("#feedbackComment").val();

		        if (comments !== '') {
		            $("#feedbackSubmit").attr("disabled", true);
		            var item = $.extend({
		                "__metadata": { "type": "SP.Data.FeedbackListItem" }
		            }, { 'Title': category, 'BAH_FeedbackComment': comments });
		            UpdateFormDigest(_spPageContextInfo.webServerRelativeUrl, _spFormDigestRefreshInterval)
		            $.ajax({
		                async: true,
		                url: _spPageContextInfo.webAbsoluteUrl + "/_api/web/lists/GetByTitle('Feedback')/Items",
		                type: "POST",
		                contentType: "application/json;odata=verbose",
		                data: JSON.stringify(item),
		                headers: {
		                    "Accept": "application/json;odata=verbose",
		                    "X-RequestDigest": $("#__REQUESTDIGEST").val()
		                }
		            }).done(function (response) {
		                Widgets.feedback.showSuccessMessage();
		            }).fail(function (response) {
		                Bah.logging.error(response, this.name);
		                $("#feedbackSubmit").attr("disabled", false);
		            });
		            $(".ms-formvalidation").text("");
		        } else {
		            $(".ms-formvalidation").text("Please enter a comment in order to submit the feedback.");
		        }
		        
		    });


		},
		//Shows a save success message.
		showSuccessMessage: function () {
		    $('#feedbackModal .success-message').fadeIn(400, function () {
				setTimeout(function () {
				    $('#feedbackModal .success-message').fadeOut(400, function () {
				        $('#feedbackModal').foundation('reveal', 'close');
				    });
				}, 1500);
			});
		}
	};
})(jQuery);
///#source 1 1 Widgets/Help/helpPageList.js
var Widgets = Widgets || {};

(function ($) {
	Widgets.helpPageList = {
		name: "Help Page List",
		log: true,

		template: function () {
			return $("#helpPageListTemplate").html();
		},

		filteringProperties: ['Path', 'Title'],

		fetch: function () {
			var filteringProperties = this.filteringProperties;
			var rowLimit = 8;
			var bahManagedProperty = 'BAHHelpPageCategoryTax';

			return Bah.getAllTermsFromTermSet(Bah.Constants.Guid.HelpPageCategoryTermSet).then(function (terms) {
				//Asyncrhonously perform n queries depending on the number of terms
				var deferreds = $.map(terms.get_data(), function (term) {
					return $.ajax({
						url: "/_api/search/query?querytext='ContentTypeId:" + Bah.Constants.ContentType.HelpPage + " AND " + bahManagedProperty + ':"' + term.get_name() + '"' +
                                "'&rowlimit=" + rowLimit +
                                "&selectproperties='" + filteringProperties.join(',') +
                                "'&sortlist='Created:descending'&trimduplicates=false",
						type: "GET",
						headers: { "Accept": "application/json; odata=verbose" },
						cache: false
					}).then(function (data) {
						return { termName: term.get_name(), search: data };
					});
				});

				return $.when.apply($, deferreds).then(function () {
					return Array.prototype.slice.call(arguments);
				});
			});
		},

		parse: function (tabs) {
			var filteringProperties = this.filteringProperties;
			//create existance map for filteringProperties
			var filteringPropertiesContains = lazy(filteringProperties).reduce(function (x, y) {
				var o = {}; o[y] = true;
				return x.merge(o);
			}, lazy({})).toObject();

			return {
				terms: lazy(tabs).map(function (tab, index) {
					return {
						isFirst: index === 0,
						htmlId: tab.termName.replace(/\s+/g, ''),
						termName: tab.termName,
						items: lazy(tab.search.d.query.PrimaryQueryResult.RelevantResults.Table.Rows.results).map(function (row) {
							var rowReturn = {};
							lazy(row.Cells.results).filter(function (field) {
								return filteringPropertiesContains[field.Key];
							}).first(filteringProperties.length).each(function (field) {
								rowReturn[field.Key] = field.Value;
							});
							return rowReturn;
						}).map(function (mappedFields) {
							return {
								url: mappedFields[filteringProperties[0]],
								title: mappedFields[filteringProperties[1]]
							};
						}).toArray()
					};
				}).toArray()
			};
		},

		bind: function (template, data) {
			var template = Handlebars.compile(template);
			var html = template(data);
			return html;
		},

		render: function (html) {
			var $container = $(this.container);
			var $html = $(html);

			var $tabs = $container.parent().find('.tabs');
			var $tabContent = $container.parent().find('.tab-content');

			//clear existing tabs
			$tabs.html('');
			$tabContent.html('');

			//append new content
			$tabs.append($html.filter('.tabs').children());
			$tabContent.append($html.filter('.tab-content').children());

			//remove us
			//$container.remove();
			BS.dotdotdoter.parseElement('.section-about');
		},

		fail: function (error, event) {
			Bah.logging.error(event, this.name);
		}
	};
})(jQuery);
///#source 1 1 Widgets/AdvancedPeopleSearch/advancedPeopleSearchForm.js
var Widgets = Widgets || {};
(function ($) {
	Widgets.advancedSearchPeopleForm = {
		name: "Advanced People Search Form",

		load: function () {
			Widgets.advancedSearchPeopleForm.mobileCollapsablesFix();
			Widgets.advancedSearchPeopleForm.loadDropDowns();
			Widgets.advancedSearchPeopleForm.loadFolDropDowns();

			////Submit button event handler.
			$('#advancedPeopleSearchButton').click(function () {
				Widgets.advancedSearchPeopleForm.submitForm();
			});

			$('.advanced-people-search-container').keyup(function (e) {
				var key = e.which;

				//If enter key.
				if (key == 13) {
					Widgets.advancedSearchPeopleForm.submitForm();
					return false;
				}
			});

			$(window).resize(function () {
				Bah.waitForFinalEvent(Widgets.advancedSearchPeopleForm.mobileCollapsablesFix, 200, 'advancedPeopleSearchFormFix');
			});
		},

		//Fixes the collapsable titles in mobile.
		mobileCollapsablesFix: function () {
			$('.accord-content').each(function () {
				var $this = $(this);

				if ($this.is(':hidden')) {
					$this.prev().removeClass('active');
				}
				else {
					$this.prev().addClass('active');
				}
			});
		},

		getAvField: function (element) {
		    var sb = $(element).attr("sb");
		    var anchorText = $("#sbSelector_" + sb).text();
		    var value = $("#sbHolder_" + sb).find('a:contains("' + anchorText + '"):last').attr("rel")
		    return value;
		},

		//Parses the form and returns a json with its values.
		getFormValues: function () {
			var $form = $('.advanced-people-search-container');
			return {   
				firstName: $('#firstNameTextbox', $form).val(),
				lastName: $('#lastNameTextbox', $form).val(),                  
				locationCity: $('#locationCityTextbox', $form).val(),
				locationOffice: $('#locationOfficeTextbox', $form).val(),
				level: $("#sbSelector_" + $("#levelDropdown").attr("sb")).text().indexOf("All ") == 0 ? '' : $("#sbSelector_" + $("#levelDropdown").attr("sb")).text(),
				group: $("#sbSelector_" + $("#groupDropdown").attr("sb")).text().indexOf("All ") == 0 ? '' : $("#sbSelector_" + $("#groupDropdown").attr("sb")).text(),
				accountGroup: $("#sbSelector_" + $("#accountGroupDropdown").attr("sb")).text().indexOf("All ") == 0 ? '' : $("#sbSelector_" + $("#accountGroupDropdown").attr("sb")).text(),
				cluster: $('#clusterTextbox', $form).val(),
				capability: $("#sbSelector_" + $("#capabilityDropdown").attr("sb")).text().indexOf("All ") == 0 ? '' : $("#sbSelector_" + $("#capabilityDropdown").attr("sb")).text(),
				imt: $('#imtTextbox', $form).val(),
				fc: $("#sbSelector_" + $("#fcDropdown").attr("sb")).text().indexOf("All ") == 0 ? '' : $("#sbSelector_" + $("#fcDropdown").attr("sb")).text(),
				skill: $('#skillsTextbox', $form).val(),
				role: $('#roleTextbox', $form).val(),
				certification: $('#certificationsTextbox', $form).val(),
				language: $('#languageTextbox', $form).val(),
				pastProject: $('#pastProjectsTextbox', $form).val(),
				school: $('#schoolsTextbox', $form).val(),
				careerTrack: $("#sbSelector_" + $("#careerDropdown").attr("sb")).text().indexOf("All ") == 0 ? '' : $("#sbSelector_" + $("#careerDropdown").attr("sb")).text(),
				proposalExperience: $("#sbSelector_" + $("#proposalExperienceDropdown").attr("sb")).text().indexOf("All ") == 0 ? '' : $("#sbSelector_" + $("#proposalExperienceDropdown").attr("sb")).text(),
				askMeAbout: $('#askMeAboutTextbox', $form).val(),
				interests: $('#interestsTextbox', $form).val(),
				aboutMe: $('#aboutMeTextbox', $form).val(),
				avPercentage: Widgets.advancedSearchPeopleForm.getAvField("#avPercentage"),
				avStart: Widgets.advancedSearchPeopleForm.getAvField("#folStart"),
				avEnd: Widgets.advancedSearchPeopleForm.getAvField("#folEnd")
			};
		},

		//Parses a textbox spliting it's text by ; and generating a query using a given managed property name.
		getMultiTextQueryValue: function (textboxText, managedProperty) {
			var values = textboxText.split(';');
			var query = '';

			if (values.length > 0) {
				query += "(";

				for (var i = 0; i < values.length; i++) {
					var value = values[i].trim();
					if (value !== '') {
						if (i > 0) {
							query += 'OR ';
						}
						query += managedProperty + ':"' + value + '*" ';
					}
				}

				query += ') ';
			}

			return query;
		},

		//Parse the values json and generates a KQL string.
		generateQuery: function (values) {
			var query = '';

			if (typeof values !== 'undefined') {
				if (values.firstName !== '') {
					query += 'FirstName:"' + values.firstName + '*" ';
				}
				if (values.lastName !== '') {
					query += 'LastName:"' + values.lastName + '*" ';
				}
				if (values.locationCity !== '') {
				    query += Widgets.advancedSearchPeopleForm.getMultiTextQueryValue(values.locationCity, 'BAHOfficeCity');
				}
				if (values.locationOffice !== '') {
				    query += Widgets.advancedSearchPeopleForm.getMultiTextQueryValue(values.locationOffice, 'BAHOffice');
				}
				if (values.level !== '') {
					query += 'JobTitle="' + values.level + '" ';
				}
				if (values.group !== '') {
					query += 'BAHPeopleGroup="' + values.group + '" ';
				}
				if (values.accountGroup !== '') {
					query += 'BAHAccountGroup="' + values.accountGroup + '" ';
				}
				if (values.cluster !== '') {
				    query += Widgets.advancedSearchPeopleForm.getMultiTextQueryValue(values.cluster, 'BAHCluster');
				}
				if (values.capability !== '') {
				    query += 'BAHCapability="' + values.capability + '" ';
				}
				if (values.imt !== '') {
				    query += Widgets.advancedSearchPeopleForm.getMultiTextQueryValue(values.imt, 'BAHIMT');
				}
				if (values.fc !== '') {
				    query += 'BAHFCPrimary="' + values.fc + '" ';
				}
				if (values.skill !== '') {
					//query += 'BAHSkills:"' + values.skill + '*" ';
					query += Widgets.advancedSearchPeopleForm.getMultiTextQueryValue(values.skill, 'BAHSkills');
				}
				if (values.role !== '') {
				    query += Widgets.advancedSearchPeopleForm.getMultiTextQueryValue(values.role, 'BAHRolePrimary');
				}
				if (values.certification !== '') {
					//query += 'BAHCertifications:"' + values.certification + '*" ';
					query += Widgets.advancedSearchPeopleForm.getMultiTextQueryValue(values.certification, 'BAHCertifications');
				}
				if (values.language !== '') {
				    query += Widgets.advancedSearchPeopleForm.getMultiTextQueryValue(values.language, 'BAHLanguages');
				}

				if (values.pastProject !== '') {
					//query += 'PastProjects:"' + values.pastProject + '*" ';
					query += Widgets.advancedSearchPeopleForm.getMultiTextQueryValue(values.pastProject, 'PastProjects');
				}
				if (values.school !== '') {
					//query += 'Schools:"' + values.school + '*" ';
					query += Widgets.advancedSearchPeopleForm.getMultiTextQueryValue(values.school, 'Schools');
				}
				if (values.careerTrack !== '') {
					query += 'BAHCareerTrack="' + values.careerTrack + '" ';
				}
				if (values.proposalExperience !== '') {
				    query += 'BAHProposalExperience="' + values.proposalExperience + '" ';
				}
				if (values.askMeAbout !== '') {
					query += Widgets.advancedSearchPeopleForm.getMultiTextQueryValue(values.askMeAbout, 'Responsibilities');
				}
				if (values.interests !== '') {
					query += Widgets.advancedSearchPeopleForm.getMultiTextQueryValue(values.interests, 'Interests');
				}
				if (values.aboutMe !== '') {
					query += Widgets.advancedSearchPeopleForm.getMultiTextQueryValue(values.aboutMe, 'AboutMe');
				}

				////Availability
				if (values.avPercentage > 0) {
					var replaceString = '';
					switch (values.avPercentage) {
						case "1":
							replaceString = 'BAHFOLP{{i}}=0 ';
							break;
						case "2":
							replaceString = 'BAHFOLP{{i}}<=25 ';
							break;
						case "3":
							replaceString = '(BAHFOLP{{i}}>=26 AND BAHFOLP{{i}}<=50) ';
							break;
						case "4":
							replaceString = '(BAHFOLP{{i}}>=51 AND BAHFOLP{{i}}<=75) ';
							break;
						case "5":
							replaceString = 'BAHFOLP{{i}}>=76 ';
							break;
						default:
							break;
					}

					query += '(';
					for (var i = values.avStart; i <= values.avEnd; i++) {
						if (i > values.avStart) {
							query += 'OR ';
						}
						query += replaceString.replace(/{{i}}/g, i);
					}
					query += ')';
				}
			}

			return query;
		},

		//Redirects the user to the People Search Page with the desired query.
		submitForm: function () {
			$('.article-top .error-message').hide();

			var values = Widgets.advancedSearchPeopleForm.getFormValues();
			if (values.avStart <= values.avEnd) {
				var query = Widgets.advancedSearchPeopleForm.generateQuery(values);

				var redirectUrl = Bah.configuration.peopleSearchAdvancedResultsPageUrl + '#k=' + encodeURIComponent(query);

				window.location.href = redirectUrl;
			}
			else {
				$('.article-top .error-message').show();
				$('#s4-workspace').animate({
					scrollTop: $('.article-top .error-message').offset().top
				}, 800);
			}
		},

		//Loads all the dropdowns in the form that have a data-term-set-name attribute with data from the term set.
		loadDropDowns: function () {
			var $dropdowns = $('.advanced-people-search-container select[data-term-set-name]');

			$.each($dropdowns, function () {
				var $select = $(this);
				var termSetName = $select.data('term-set-name');

				var locale = 1033; //English
				var clientContext = SP.ClientContext.get_current();
				var taxonomySession = SP.Taxonomy.TaxonomySession.getTaxonomySession(clientContext);
				var termStore = taxonomySession.getDefaultSiteCollectionTermStore();
				var termSets = termStore.getTermSetsByName(termSetName, locale);
				var termSet = termSets.getByName(termSetName);
				var terms = termSet.getAllTerms();
				clientContext.load(taxonomySession);
				clientContext.load(termStore);
				clientContext.load(termSet);
				clientContext.load(terms, 'Include(IsRoot, Labels, TermsCount, CustomSortOrder, Id, IsAvailableForTagging, Name, PathOfTerm)');
				clientContext.executeQueryAsync(Function.createDelegate(this, function () {
					if (terms) {
						for (var i = 0; i < terms.get_count() ; i++) {
							var term = terms.getItemAtIndex(i);

							$select.append($('<option>', {
								value: term.get_id().toString(),
								text: term.get_name()
							}));
						}
					}

					$select.selectbox();
				}),
				Function.createDelegate(this, function (sender, args) { Bah.logging.error('There was a problem trying to read the term set: ' + termSetName, 'Advanced People Search Form - loadDropDowns'); }));
			});
		},

		//Loads the two FOL Dates dropdowns.
		loadFolDropDowns: function () {
			var termSetName = 'FOL Dates';

			var $select = $('.fol-delayed-select');

			var locale = 1033; //English
			var clientContext = SP.ClientContext.get_current();
			var taxonomySession = SP.Taxonomy.TaxonomySession.getTaxonomySession(clientContext);
			var termStore = taxonomySession.getDefaultSiteCollectionTermStore();
			var termSets = termStore.getTermSetsByName(termSetName, locale);
			var termSet = termSets.getByName(termSetName);
			var terms = termSet.getAllTerms();
			clientContext.load(taxonomySession);
			clientContext.load(termStore);
			clientContext.load(termSet);
			clientContext.load(terms, 'Include(IsRoot, Labels, TermsCount, CustomSortOrder, Id, IsAvailableForTagging, Name, PathOfTerm, Parent, TermSet.Name, LocalCustomProperties, CustomProperties)');
			clientContext.executeQueryAsync(Function.createDelegate(this, function () {
				if (terms) {
					for (var i = 0; i < terms.get_count() ; i++) {
						var term = terms.getItemAtIndex(i);
						var customProperties = term.get_customProperties();
						var date = (customProperties['Date'] || '').toString();

						$select.append($('<option>', {
							value: i + 1,
							text: date
						}));
					}
				}

				$('#folStart').val(1);
				$('#folEnd').val(6);
				$select.selectbox();
			}),
			Function.createDelegate(this, function (sender, args) { Bah.logging.error('There was a problem trying to read the term set: ' + termSetName, 'Advanced People Search Form - loadFolDropDowns'); }));
		}
	};
})(jQuery);
///#source 1 1 Widgets/SearchResultsPage/searchResultsParser.js
var Widgets = Widgets || {};
(function ($) {
	Widgets.searchResultsParser = {
		name: "Search Results Parser",

		load: function () {
			var detailsPageUrl = Bah.configuration.eventDetailsPageUrl;

			$("#s4-workspace").on("click", "aside[data-search-event]", function () {
				var originalPath = $(this).data('search-event');
				var sourceUrl = originalPath.substring(0, originalPath.indexOf('Lists/'));
				var listName = originalPath.substring(originalPath.indexOf('Lists/') + 6);
				listName = listName.substring(0, listName.indexOf('/'));
				var id = originalPath.substring(originalPath.indexOf('ID=') + 3);

				var url = detailsPageUrl === '#' ? detailsPageUrl : detailsPageUrl + "?eventId=" + id + "&sourceUrl=" + sourceUrl + "&listTitle=" + listName;

				$('a', this).attr('href', url);
			});
		}
	};
})(jQuery);
///#source 1 1 Custom/bahUtilities.js
var BahUtilities = BahUtilities || {};

(function ($) {
    BahUtilities = {
        getQueryStringValue: function (key) {
            return unescape(window.location.search.replace(new RegExp("^(?:.*[&\\?]" + escape(key).replace(/[\.\+\*]/g, "\\$&") + "(?:\\=([^&]*))?)?.*$", "i"), "$1"));
        },
        getTermSet: function () {
            var deferred = $.Deferred();
            var scriptbase = _spPageContextInfo.webServerRelativeUrl + "_layouts/15/";
            var termStoreId = "Taxonomy_UHkgwP49Imd/TpI+SFV5dQ==";
            var termSetId = "85f8e07d-7aa9-49ab-a7c8-a2850a0510b9";
            var termId = this.getQueryStringValue("groupId");
            var termSetData;

            $.getScript(scriptbase + "SP.Runtime.js",
                function () {
                    $.getScript(scriptbase + "SP.js", function () {
                        //$.getScript(scriptbase + "SP.Taxonomy.js", execOperation);
                        $.getScript(scriptbase + "SP.Taxonomy.js", function () {
                            //Current Context
                            var context = SP.ClientContext.get_current();
                            //Current Taxonomy Session
                            var taxSession = SP.Taxonomy.TaxonomySession.getTaxonomySession(context);
                            //Term Stores
                            var termStores = taxSession.get_termStores();
                            //Name of the Term Store from which to get the Terms.
                            var termStore = termStores.getByName(termStoreId);
                            //GUID of Term Set from which to get the Terms.
                            var termSet = termStore.getTermSet(termSetId);
                            var groupTerm = termSet.getTerm(termId);
                            context.load(groupTerm);

                            context.executeQueryAsync(function () {
                                var termName = groupTerm.get_name();
                                var termProps = groupTerm.get_customProperties();
                                termSetData = {
                                    name: termName,
                                    acronym: termProps["acronym"],
                                }

                                deferred.resolve(termSetData);

                            }, function (sender, args) {
                                console.log(args.get_message());
                            });
                        });
                    });
                }
            );

            return deferred.promise();
        },
        getSharePointSearchResults: function (queryResponse) {
            return queryResponse.PrimaryQueryResult.RelevantResults.Table;
        },
        getFirstSharePointSearchResults: function (queryResponse) {
            if (queryResponse.PrimaryQueryResult.RelevantResults.Table.Rows[0] !== undefined) {
                return queryResponse.PrimaryQueryResult.RelevantResults.Table.Rows[0].Cells;
            }
        },
        getSharePointTotalResults: function (queryResponse) {
            return queryResponse.PrimaryQueryResult.RelevantResults.TotalRows;
        },
        getSearchableEmailFormat: function (email, token, replaceToken) {
            // 2015-11-11: JDK changed this, added the check for undefined because it was throwing error
            // 2015-11-12- [kandil.dalya] !typeof will still throw back the undefined, !== is correct syntax, we can check for null to be safe
            if( (typeof email !== 'undefined') && (email !== null) ) {
                var temp = (email).match(/(([a-zA-Z]|[0-9])|([-]|[_]|[.]))+[@](([a-zA-Z0-9])|([-])){2,63}[.](([a-zA-Z0-9]){2,63})+/gi);
                return temp[temp.length - 1].replace(token, replaceToken);
            }
        },
        getUserAccountProfile: function (email) {
            // returns: AccountName,FirstName,LastName,BAHRolePrimary,BAHResourceImageOWSIMGE
            // also a source id (from query tool) - pattern: b09a7990-05ea-4af9-81ef-edfab16c4e31
            var email = this.getSearchableEmailFormat(email, "@", " ");
            var profileFetchUrl = "/_api/search/query?querytext='AccountName:\"" + email + "\"'&selectproperties='FirstName%2c+LastName%2cAccountName%2cJobTitle%2cBAHPeopleGroup%2c+BAHRolePrimary%2cAccountName%2cBAHResourceImageOWSIMGE'&sourceid='b09a7990-05ea-4af9-81ef-edfab16c4e31'";
            return $.getJSON(profileFetchUrl, function (data) {
                return data;
            });
        },
        remapStringToDataArray: function (stringData, remapKeys, delineator) {
            var dataArray = stringData.split(delineator);
            var remappedData = [];
            $.each(remapKeys, function (index, key) {
                remappedData[index] = {};
                remappedData[index][key] = dataArray[index];
            });
            return remappedData;
        }
    };
})(jQuery);
//Handlebars.registerHelper('ifCond', function (v1, operator, v2, options) {

//    switch (operator) {
//        case '==':
//            return (v1 == v2) ? options.fn(this) : options.inverse(this);
//        case '===':
//            return (v1 === v2) ? options.fn(this) : options.inverse(this);
//        case '<':
//            return (v1 < v2) ? options.fn(this) : options.inverse(this);
//        case '<=':
//            return (v1 <= v2) ? options.fn(this) : options.inverse(this);
//        case '>':
//            return (v1 > v2) ? options.fn(this) : options.inverse(this);
//        case '>=':
//            return (v1 >= v2) ? options.fn(this) : options.inverse(this);
//        case '&&':
//            return (v1 && v2) ? options.fn(this) : options.inverse(this);
//        case '||':
//            return (v1 || v2) ? options.fn(this) : options.inverse(this);
//        default:
//            return options.inverse(this);
//    }
//});


///#source 1 1 Widgets/GroupPage/groupAboutUs.js
var Widgets = Widgets || {};

(function ($) {
    //set Inital Variables here
    var context = {data: [], count: 0, maxCount: 0};
    var comment, imageHtml, stream, sortOrder, location, articleUrl, title;
    var getAboutUsDataPromise = new $.Deferred();

    //Get Data from More About Us List
    //Step 1
    function getAboutUsData() {
        var getDataUrl = "/_api/search/query?querytext='ContentType:+\"More+About+Us\"+AND+BAHStreamDisplay=\"" + encodeURIComponent(orgTermName) + "\"'&trimduplicates=false&rowlimit=20&selectproperties='Path%2cUrl%2cTitle%2cBAHFeedbackComment%2cBAHResourceImageOWSIMGE%2cBAHStream%2cBAHSortOrder%2cBAHLocation%2cBAHLinkUrl'";
        $.getJSON(getDataUrl, function (data) {
            var resultData = BahUtilities.getSharePointSearchResults(data).Rows;
            if (resultData.length > 0) {
                //Cycle through each Row of the data
                $.each(resultData, function () {
                    var rowData = this.Cells;
                    //Cycle through each property, looking for the ones we need
                    $.each(rowData, function () {
                        if (this.Key === "Title") {
                            title = this;
                        }
                        else if (this.Key === "BAHFeedbackComment") {
                            comment = this;
                        }
                        else if (this.Key === "BAHResourceImageOWSIMGE") {
                            imageHtml = $(this.Value).attr('src');
                        }
                        else if (this.Key === "BAHStream") {
                            stream = this;
                        }
                        else if (this.Key === "BAHSortOrder") {
                            sortOrder = this;
                        }
                        else if (this.Key === "BAHLocation") {
                            location = this;
                        }
                        else if (this.Key === "BAHLinkUrl") {
                            articleUrl = this;
                        }
                    });
                    //push the useful stuff into the view                    
                    context.data.push({ title: title, comment: comment, imageHtml: imageHtml, stream: stream, sortOrder: sortOrder, location: location, articleUrl: articleUrl });                    
                })
                getAboutUsDataPromise.resolve();
            }
        });

    }

    //Initilize Widget for Group About Us
    //Step 0
    Widgets.groupAboutUs = {
        log: true,
        load: function (options) {
            $.when(Widgets.groupHeader.orgIdTermSetPromise).done(function () {
                getAboutUsData();
                $.when(getAboutUsDataPromise).done(function () {
                    context.count = context.data.length;
                    context.maxCount = 4;
                    
                    var template = Handlebars.compile($('#groupAboutUsTemplate').html());
                    var html = template(context);
                    $(Widgets.groupAboutUs.container).html(html);


                    var $owl = $("#owl-slider-about");
                    $owl.owlCarousel({
                        paginationNumbers: false,
                        navigation: true,
                        autoPlay: false,
                        slideSpeed: 300,
                        paginationSpeed: 400,
                        singleItem: false,
                        items: 4,
                        itemsCustom: false,
                        itemsDesktop: [1199, 4],
                        itemsDesktopSmall: [979, 4],
                        itemsTablet: [767, 4],
                        itemsTabletSmall: [620, 3],
                        itemsMobile: [479, 2],
                        singleItem: false,
                        itemsScaleUp: false
                    });

                    // Custom Navigation Events
                    $(".nextnn").click(function () {
                        $owl.trigger('owl.next');
                    });
                    $(".prevpp").click(function () {
                        $owl.trigger('owl.prev');
                    });
                });
            });
        },
        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };

})(jQuery);

///#source 1 1 Widgets/GroupPage/groupBreadcrumbs.js
var Widgets = Widgets || {};

(function ($) {
    Widgets.groupBreadcrumbs = {
        name: 'Breadcrumbs',
        log: true,

        getGroupName: function () {
            return $.when(orgIdTermSetPromise).then(
                 function () {
                     return orgTermName;
                     }
            );
        },

        load: function (options) {
            var template = Handlebars.compile($('#groupBreadcrumbsTemplate').html());

            $.when(Widgets.groupBreadcrumbs.getGroupName()).then(
                    function (groupName) {
                        var item ={
                            link: _spPageContextInfo.siteAbsoluteUrl ,
                            name: "Home",
                            group: groupName
                        }
                        var html = template(item);
                        $(Widgets.groupBreadcrumbs.container).html(html);
                    }
                );
        },
        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);
///#source 1 1 Widgets/GroupPage/groupHeader.js
var Widgets = Widgets || {};
var orgIdTermSetPromise = new $.Deferred();
var orgTermName, orgTermProps;
   
(function ($) {
    Widgets.groupHeader = {
        name: 'Group Header',
        log: true,
        orgIdTermSetPromise: new $.Deferred(),
        load: function (options) {
            $('html').addClass('bah-group-page');
            var orgId = Bah.GetQueryStringParams("orgid");
            var html,termSetData;
            if (orgId)
            {
                $.when(Bah.getTerm(Bah.Constants.Guid.StreamTermSet, orgId)).then(
                    function (groupTerm) {
                        orgTermName = groupTerm.get_name();
                        orgTermProps = groupTerm.get_customProperties();
                        termSetData = {
                            name: orgTermName,
                            acronym: orgTermProps["acronym"],
                            tagcolor: orgTermProps["tagcolor"]
                        }
                        Widgets.groupHeader.orgIdTermSetPromise.resolve();
                        orgIdTermSetPromise.resolve();
                        html = template(termSetData);
                        $(Widgets.groupHeader.container).html(html);
                    }
                );
            }

            var template = Handlebars.compile($('#groupHeaderTemplate').html());
            $(Widgets.groupHeader.container).html(html);
        },
        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);
///#source 1 1 Widgets/GroupPage/groupLeadershipTeam.js
/****************************************************/
/****** USING ACCOUNT LEADERSHIP TEAM WIDGET ********/
/****************************************************/
///#source 1 1 Widgets/GroupPage/groupLinks.js
var Widgets = Widgets || {};


(function ($) {
    Widgets.groupLinks = {
        log: true,
        viewModel: {
            links: [],
            orgName: '',
            moreLinks: false,
            expanded: false,
            render: false, 
        },
        getLinks: function () {
            Query = "/_api/search/query?querytext='contenttype:\"BAH+Generic+Links\"+AND+BAHStreamDisplay=\"" + encodeURIComponent(orgTermName) + "\"'&trimduplicates=false&selectproperties=\'title%2cBAHResourceUrl\'&sortlist=\'BAHSortOrder:ascending\'&rowlimit=12";
            return $.getJSON(Query, function (data) {
                return data;
            });
        },
        showMoreLinks: function(){
            Widgets.groupLinks.viewModel.expanded = !Widgets.groupLinks.viewModel.expanded;
            Widgets.groupLinks.compileTemplate();
        },
        load: function (options) {
            $.when(orgIdTermSetPromise).done(function () {
                Widgets.groupLinks.getLinks().then(function (results) {
                    var resultData = BahUtilities.getSharePointSearchResults(results);
                    if (BahUtilities.getSharePointTotalResults(results) > 0) {
                        Widgets.groupLinks.viewModel.render = true; //Allows widget to render. If no results fails gracefully
                        if (BahUtilities.getSharePointTotalResults(results) > 4) {
                            Widgets.groupLinks.viewModel.moreLinks = true;
                        }
                        $.each(resultData.Rows, function (index, result) {
                            var item = {
                                title: Bah.getResultValueByKey('title', result.Cells),
                                url: Bah.getResultValueByKey('BAHResourceUrl', result.Cells)
                            };
                            Widgets.groupLinks.viewModel.links.push(item);

                        });
                        Widgets.groupLinks.viewModel.orgName = orgTermName;
                        Widgets.groupLinks.compileTemplate();
                    }
                }); 
            });
        },
        compileTemplate: function(){
            var template = Handlebars.compile($('#groupLinksTemplate').html());
            var html = template(Widgets.groupLinks.viewModel);
            $(Widgets.groupLinks.container).html(html);
        },
        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);
///#source 1 1 Widgets/GroupPage/groupNews.js
var Widgets = Widgets || {};
(function ($) {
    Widgets.groupNews = {
        name: 'Group Featured News',
        log: true,
        getGroupArticles: function (orgTermName) {
            // Given the orgTermName and current date the query will return at most 12 articles for an org (eg. DIG, CCG, etc..) whose Showcase Published Date is earlier than the current date and Showcase Expiry Date is later than the current date.
            // The result set is sorted in descending order by the Showcase Publish Date 
            var queryUrl = "/_api/search/query?querytext='Contenttypeid:\"0x010100C568DB52D9D0A14D9B2FDCC96666E9F2007948130EC3DB064584E219954237AF3900242457EFB8B24247815D688C526CD44D007AA3961D9E004361B23524B1971FC9CD03*\"+AND+BAHStreamShowcaseOWSBOOL:\"1\"+AND+BAHStreamDisplay=\"" + encodeURIComponent(orgTermName) + "\"" +
                "+AND+BAHShowcasePublishDate<%3dToday+AND+BAHShowcaseExpiryDate>%3dToday'" +
                "&trimduplicates=false&rowlimit=12&selectproperties='Title%2cPath%2cPublishingImage%2cArticleByLineOWSTEXT%2cBAHNewsArticleVideoUrl'&sortlist='BAHShowcasePublishDate:descending'";

            return $.ajax({
                async: true,
                url: queryUrl,
                type: "GET",
                headers: { "Accept": "application/json; odata=verbose" },
                cache: false
            });
        },
        getAccountArticles: function (orgTermName) {
            var queryUrl = "/_api/search/query?querytext='Contenttypeid:\"0x010100C568DB52D9D0A14D9B2FDCC96666E9F2007948130EC3DB064584E219954237AF3900242457EFB8B24247815D688C526CD44D007AA3961D9E004361B23524B1971FC9CD03*\"+AND+BAHStreamDisplay:\"" + encodeURIComponent(orgTermName) + "\"" +
             "+AND+BAHShowcasePublishDate<%3dToday+AND+BAHShowcaseExpiryDate>%3dToday'" +
             "&trimduplicates=false&rowlimit=12&selectproperties='Title%2cPath%2cPublishingImage%2cArticleByLineOWSTEXT%2cBAHNewsArticleVideoUrl'&sortlist='BAHShowcasePublishDate:descending'";

            return $.ajax({
                async: true,
                url: queryUrl,
                type: "GET",
                headers: { "Accept": "application/json; odata=verbose" },
                cache: false
            });
        },
        createModel: function (results) {
            var model = { items: [] };
            var i, length = results.length;
            for (i = 0; i < length; i++) {
                var result = results[i].Cells.results;

                // get url to video if set
                var videoUrl= Bah.alwaysString(Bah.getResultValueByKey('BAHNewsArticleVideoUrl', result)).trim() || "";
               
                var item = {
                    title: Bah.getResultValueByKey('Title', result), // article title 
                    url: videoUrl || "/Pages/Article.aspx?path=" + Bah.getResultValueByKey('Path', result), // article video url or generate link to article.aspx passing the url as 'path' query string parameter
                    image: $(Bah.getResultValueByKey('PublishingImage', result)).attr('src') || "/Style Library/BAH/img/img-newscarousel-placeholder.jpg", // link to image or set to default
                    byline: Bah.getResultValueByKey('ArticleByLineOWSTEXT', result) // article byline
                };

                model.items.push(item);
            }
            return model;
        },
        updateView: function (model, tagColor) {
            // bind model to handlebars template
            var template = Handlebars.compile($('#groupNewsTemplate').html());
            var html = template(model);
            $(Widgets.groupNews.container).html(html);

            // init slider
            $(".flexslider").flexslider({
                animation: "move",
                slideshow: true,
                slideshowSpeed: 5000,
                animationSpeed: 600,
                maxItems: 3,
                start: function () {
                    if (tagColor) {
                        // inject styles overriding pager control color into head portion of document
                        $("head").append("<style type=\"text/css\">.flex-control-paging li a.flex-active {background:" + tagColor + ";border: 1px solid " + tagColor + ";}</style>");
                    }
                }
            });
        },
        load: function (options) {
            var self = this;
            self.options = options;

            // wait for promise that retrieves Stream termset name based on orgId passed into page to resolve. Promise is defined in groupHeader.js
            $.when(orgIdTermSetPromise).done(function () {
                var termName = orgTermName; // set local variable to organization term set name global variable assigned in groupHeader.js
                if (termName) {
                    var model; var tagColor;
                    $.when(self.getGroupArticles(termName)).done(function (data) { // retrieve group articles 
                        if (data.d !== undefined) {
                            var results = data.d.query.PrimaryQueryResult.RelevantResults.Table.Rows.results;
                            if (results.length > 0) {
                                model = self.createModel(results);
                                tagColor = orgTermProps["tagcolor"] || "";
                                self.updateView(model, tagColor);
                            }
                            else {
                                $.when(self.getAccountArticles(termName)).done(function (data) { // retrieve account/sub-account articles
                                    if (data.d !== undefined) {
                                        results = data.d.query.PrimaryQueryResult.RelevantResults.Table.Rows.results;
                                        if (results.length > 0) {
                                            model = self.createModel(results);
                                            tagColor = orgTermProps["tagcolor"] || "";
                                            self.updateView(model);
                                        }
                                    }
                                });
                            }
                        }
                    });
                }
            });
        },
        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);
///#source 1 1 Widgets/GroupPage/groupSearch.js
var Widgets = Widgets || {};

(function ($) {
    Widgets.groupSearch = {
        name: "Group Search",
        redirectUrl: "",
        sParameter: "",
        log: true,

        getShortName: function () {
            return   $.when(orgIdTermSetPromise).then(
                    function () {
                        sParameter = '%20AND%20BAHStreamDisplay:%22' + orgTermName + '%22';
                        return orgTermProps["acronym"];
                    }
                );
        },

        template: function () {
            return $("#groupSearchTemplate").html();
        },

        fetch: function () {
            redirectUrl = Bah.configuration.searchResultsPageUrl;
            return $.when(Widgets.groupSearch.getShortName()).then(function (shortName) {
                return { shortName: shortName };
            });
        },

        parse: function (data) {
            return data;
        },

        bind: function (template, data) {
            var template = Handlebars.compile(template);
            var html = template(data);
            return html;
        },

        render: function (html, data) {
            // render and attach event here
            var self = this;
            var $container = $(this.container);
            $container.html(html);

            //just in case it gets rendered again
            $container.off('click.groupSearch');

            if (redirectUrl) { //if no url, don't even bother registering event
                var submit = function (query) {
                    if (query) {
                        //redirect here
                        window.location.href = redirectUrl + '?k=' + encodeURIComponent(query) + sParameter;
                    }
                    return false;
                };

                $container.on('click.groupSearch', '.btn-search', function () {
                    return submit($container.find('.input').val());
                });

                $container.on('keydown', '.input', function (e) {
                    var key = e.which;
                    if (key === 13) {
                        return submit($container.find('.input').val())
                    }
                });
            }
        },

        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);
///#source 1 1 Widgets/GroupPage/groupStory.js
var Widgets = Widgets || {};

(function ($) {
    //var quote, ownerName, ownerTitle, ownerGroup, bahLeaderLookup, acronym, siteCollectionUrl, ownerFirstName, ownerLastName, expandable, expandedQuote;
    //var userProfileUrl = "/Pages/View-Profile.aspx?user=";
    //var userProfileImageUrl = "/_layouts/15/userphoto.aspx?size=L&accountname=";
    //var getUserDataPromise = new $.Deferred();

    ///***********************************************/
    ///************ SET USER PROFILE FIELDS **********/
    ///******************* STEP 2 ********************/
    //function getUserCustomProperties() {
    //    //http://bahtest.sharepoint.com/_api/search/query?querytext='Atwell%2c+Joseph+[USA]'&selectproperties='FirstName%2c+LastName%2cAccountName%2cJobTitle%2cBAHPeopleGroup'&sourceid='b09a7990-05ea-4af9-81ef-edfab16c4e31'
    //    var profileFetchUrl = "/_api/search/query?querytext='AccountName:\"" + bahLeaderLookup + "\"'&selectproperties='FirstName%2c+LastName%2cAccountName%2cJobTitle%2cBAHPeopleGroup'&sourceid='b09a7990-05ea-4af9-81ef-edfab16c4e31'";
    //    $.getJSON(profileFetchUrl, function (data) {
    //        var resultData = BahUtilities.getFirstSharePointSearchResults(data);
    //        if (resultData !== undefined) {
    //            $.each(resultData, function (key, val) {
    //                if (val.Key === "JobTitle") {
    //                    ownerTitle = val.Value;
    //                }
    //                if (val.Key === "BAHPeopleGroup") {
    //                    ownerGroup = val.Value;
    //                }
    //                if (val.Key === "FirstName") {
    //                    ownerFirstName = val.Value;
    //                }
    //                if (val.Key === "LastName") {
    //                    ownerLastName = val.Value;
    //                }
    //                if (val.Key === "AccountName") {
    //                    userProfileUrl += encodeURIComponent(val.Value);
    //                    userProfileImageUrl += encodeURIComponent(val.Value);
    //                }
    //            });
    //        }
    //        ownerName = ownerFirstName + " " + ownerLastName;
    //        getUserDataPromise.resolve();
    //    });
    //}
    ///***********************************************/
    ///******* GET QUOTE DATA FROM SP SEARCH *********/
    ///******************* STEP 1 ********************/
    //function getUserData() {
    //    //Sharepoint 2013 Search Query Tool Usage
    //    //Query: contenttype:"Leadership Messages" AND BAHStream:"Defense Intelligence Group" AND BAHNewsArticleFeatured:1
    //    //Select Params: write,BAHStream,Title,BAHLeader,Modified,BAHNewsArticleFeatured,BAHLeaderOWSUSER,ContentType, BodyOWSMTXT
    //    //Rest Call: http://bahtest.sharepoint.com/_api/search/query?querytext='contenttype:"Leadership+Messages"+AND+BAHStream:"Defense+Intelligence+Group"+AND+BAHNewsArticleFeatured:1'&rowlimit=10&selectproperties='write%2cBAHStream%2cTitle%2cBAHLeader%2cModified%2cBAHNewsArticleFeatured%2cBAHLeaderOWSUSER%2cContentType'&sortlist='modifiedby:descending'
    //    var getDataUrl = "/_api/search/query?querytext='contenttype:\"Leadership+Messages\"+AND+BAHStreamDisplay=\""+encodeURIComponent(orgTermName)+
    //    "\"+AND+BAHNewsArticleFeatured:1'&trimduplicates=false&rowlimit=1&selectproperties='write%2cBAHStream%2cTitle%2cBAHLeader%2cModified%2cBAHNewsArticleFeatured%2cBAHLeaderOWSUSER%2cContentType%2cBodyOWSMTXT'&sortlist='modifiedby:descending'";
    //    $.getJSON(getDataUrl, function (data) {
    //        var resultData = BahUtilities.getFirstSharePointSearchResults(data);
    //        //console.log(data);
    //        if (resultData !== undefined) {
    //            $.each(resultData, function (key, val) {
    //                if (val.Key === "BodyOWSMTXT") {
    //                    var limit = 1100;
    //                    var tmp = $(val.Value).text();
    //                    if (tmp.length > limit) {
    //                        quote = tmp.substring(0, limit);
    //                        expandedQuote = tmp.substring(limit, tmp.length);
    //                        expandable = true;
    //                    }
    //                    else {
    //                        quote = tmp;
    //                    }
    //                }
    //                if (this.Key === 'BAHLeaderOWSUSER') {
    //                    var leaderEmail = this.Value;
    //                    var temp = leaderEmail.match(/(([a-zA-Z]|[0-9])|([-]|[_]|[.]))+[@](([a-zA-Z0-9])|([-])){2,63}[.](([a-zA-Z0-9]){2,63})+/gi);
    //                    bahLeaderLookup = temp[temp.length - 1].replace("@", " ");
    //                }
    //            });
    //        }
    //        getUserCustomProperties();
    //    });
    //}

    /***********************************************/
    /******* INITILIZE WIDGET FOR GROUP STORY ******/
    /******************* STEP 0 ********************/
    Widgets.groupStory = {
        log: true,
        getUserDataPromise: new $.Deferred(),
        context: {
            name: "Our Story",
            quote: '',
            expandedQuote: '',
            userProfileUrl: '/Pages/View-Profile.aspx?user=',
            userProfileUrlImage: '/_layouts/15/userphoto.aspx?size=L&accountname=',
            ownerName: '',
            ownerTitle: '',
            ownerGroup: '',
            expandable: false,
            expanded: false,
        },
        compileWidget: function () {
            if (Widgets.groupStory.context.quote.length !== 0) {
                var template = Handlebars.compile($("#groupStoryTemplate").html());
                var html = template(Widgets.groupStory.context);
                $(Widgets.groupStory.container).html(html);
            }
        },
        load: function (options) {
            $.when(orgIdTermSetPromise).done(function () {
                acronym = orgTermProps["acronym"];
                siteCollectionUrl = orgTermProps["siteCollectionUrl"];
                Widgets.groupStory.getUserData();
                $.when(this.getUserDataPromise).done(function () {
                    Widgets.groupStory.compileWidget();
                });
            });
        },
        getUserData: function () {
            var getDataUrl = "/_api/search/query?querytext='contenttype:\"Leadership+Messages\"+AND+BAHStreamDisplay=\"" + encodeURIComponent(orgTermName) +
                    "\"+AND+BAHNewsArticleFeatured:1'&trimduplicates=false&rowlimit=1&selectproperties='write%2cBAHStream%2cTitle%2cBAHLeader%2cModified%2cBAHNewsArticleFeatured%2cBAHLeaderOWSUSER%2cContentType%2cBodyOWSMTXT'&sortlist='write:descending'";
            $.getJSON(getDataUrl, function (data) {
                var resultData = BahUtilities.getFirstSharePointSearchResults(data);
                //console.log(data);
                if (resultData !== undefined) {
                    $.each(resultData, function (key, val) {
                        if (val.Key === "BodyOWSMTXT") {
                            var limit = 1100; //max characters to show
                            var tmp = $(val.Value).text();
                            var tmplength = tmp.length;

                            if (tmplength > limit) {
                                var count = tmp.substring(0, limit).split("[paragraph]"); //count to assist line below
                                limit = limit - (count.length * 75); //remove roughly 1 line to prevent widget from expanding beyond the max height of carousel
                                tmp = tmp.replace(/\[paragraph]/g, "<br /><br />"); //Search for forced paragraphs and replace with breaks
                                //Edge case to handle if a break is in the split range. Just increase characters to contain break temporarily
                                if (limit + 14 < tmp.length) { //check to make sure index out of bounds does not happen
                                    if (tmp.substring(limit - 14, limit + 14).indexOf("<br /><br />") > -1) {
                                        Widgets.groupStory.context.quote = tmp.substring(0, limit + 14);
                                        Widgets.groupStory.context.expandedQuote = tmp.substring(limit + 14, tmp.length);
                                    } else {
                                        Widgets.groupStory.context.quote = tmp.substring(0, limit);
                                        Widgets.groupStory.context.expandedQuote = tmp.substring(limit, tmp.length);
                                    }
                                    Widgets.groupStory.context.expandable = true;
                                } else {
                                    Widgets.groupStory.context.quote = tmp.substring(0, tmp.length); //There is only 14 additional characters just print them out since you would if there was a break anyways
                                }
                            }
                            else {
                                Widgets.groupStory.context.quote = tmp;
                            }
                        }
                        if (this.Key === 'BAHLeaderOWSUSER') {
                            var leaderEmail = this.Value;
                            var temp = leaderEmail.match(/(([a-zA-Z]|[0-9])|([-]|[_]|[.]))+[@](([a-zA-Z0-9])|([-])){2,63}[.](([a-zA-Z0-9]){2,63})+/gi);
                            var getUser = temp[temp.length - 1].replace("@", " ");
                            Widgets.groupStory.getUserCustomProperties(getUser);
                        }
                    });
                }
            });
        },
        getUserCustomProperties: function (lookupValue) {
            //http://bahtest.sharepoint.com/_api/search/query?querytext='Atwell%2c+Joseph+[USA]'&selectproperties='FirstName%2c+LastName%2cAccountName%2cJobTitle%2cBAHPeopleGroup'&sourceid='b09a7990-05ea-4af9-81ef-edfab16c4e31'
            var profileFetchUrl = "/_api/search/query?querytext='AccountName:\"" + lookupValue + "\"'&selectproperties='FirstName%2c+LastName%2cAccountName%2cJobTitle%2cBAHPeopleGroup'&sourceid='b09a7990-05ea-4af9-81ef-edfab16c4e31'";
            $.getJSON(profileFetchUrl, function (data) {
                var resultData = BahUtilities.getFirstSharePointSearchResults(data);
                var ownerFirstName, ownerLastName;
                if (resultData !== undefined) {
                    $.each(resultData, function (key, val) {
                        if (val.Key === "JobTitle") {
                            Widgets.groupStory.context.ownerTitle = val.Value;
                        }
                        if (val.Key === "BAHPeopleGroup") {
                            Widgets.groupStory.context.ownerGroup = val.Value;
                        }
                        if (val.Key === "FirstName") {
                            ownerFirstName = val.Value;
                        }
                        if (val.Key === "LastName") {
                            ownerLastName = val.Value;
                        }
                        if (val.Key === "AccountName") {
                            Widgets.groupStory.context.userProfileUrl += encodeURIComponent(val.Value);
                            Widgets.groupStory.context.userProfileUrlImage += encodeURIComponent(val.Value);
                        }
                    });
                }
                Widgets.groupStory.context.ownerName = ownerFirstName + " " + ownerLastName;
                Widgets.groupStory.getUserDataPromise.resolve();
                Widgets.groupStory.compileWidget();
            });
        },
        readMore: function () {
            //Widgets.groupStory.content.expandedHeight = $('#ourStoryQuote').height();
            Widgets.groupStory.context.expanded = !Widgets.groupStory.context.expanded;
            Widgets.groupStory.compileWidget();
        },
        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);
///#source 1 1 Widgets/GroupPage/groupTrending.js
var Widgets = Widgets || {};

(function ($) {
    Widgets.groupTrending = {
        name: 'Trending',
        log: true,
        getOrgName: function () {
            return $.when(orgIdTermSetPromise).then(
                 function () {
                     return orgTermName;
                 }
            );
        },
        getAcronym: function () {
            return $.when(orgIdTermSetPromise).then(
                        function () {
                            return orgTermProps["acronym"];
                        }
                    );
        },
        getColor: function () {
            return $.when(orgIdTermSetPromise).then(
                        function () {
                            return orgTermProps["tagcolor"];
                        }
                    );
        },

        load: function (options) {
            var html;
            var viewModel = [];
            var template = Handlebars.compile($('#groupTrendingTemplate').html());
            var bahStream, orgColor, orgAcronym;

            $.when(Widgets.groupHeader.orgIdTermSetPromise).done(function () {
                bahStream = orgTermName.replace(" ", "+");
                orgColor = orgTermProps["tagcolor"];
                orgAcronym = orgTermProps["acronym"];

                var queryUrl = "/_api/search/query?querytext='BAHStreamDisplay=\"" + encodeURIComponent(orgTermName) + "\"+AND+Contenttypeid:\"0x010100C568DB52D9D0A14D9B2FDCC96666E9F2007948130EC3DB064584E219954237AF3900242457EFB8B24247815D688C526CD44D007AA3961D9E004361B23524B1971FC9CD03*\"'&trimduplicates=false&rowlimit=3&selectproperties='Title%2cPublishingImage%2cArticleByLineOWSTEXT%2cOriginalPath%2cBAHStream%2cViewsRecent%2cBAHYammerCommentCountOWSNMBR'&sortlist='ViewsRecent:descending'";

                $.ajax({
                    async: true,
                    url: queryUrl,
                    type: 'GET',
                    headers: { 'Accept': 'application/json; odata=verbose' },
                    cache: false,
                    success: function (data) {
                        if (data.d !== undefined) {
                            var results = data.d.query.PrimaryQueryResult.RelevantResults.Table.Rows.results;

                            if (results.length > 0) {

                                ////Iterates through the results and creates the item view model.
                                $.each(results, function (index, result) {
                                    var resultsRow = result.Cells.results;

                                    var item = {
                                        title: Bah.getResultValueByKey('Title', resultsRow),
                                        url: _spPageContextInfo.webServerRelativeUrl + "Pages/Article.aspx?path=" + Bah.getResultValueByKey('OriginalPath', resultsRow),
                                        publishingImage: Bah.getImageRendition(Bah.getResultValueByKey('PublishingImage', resultsRow), 3),
                                        description: Bah.getResultValueByKey('ArticleByLineOWSTEXT', resultsRow),
                                        viewsRecent: Bah.getResultValueByKey('ViewsRecent', resultsRow),
                                        yammerCommentCount: Bah.getResultValueByKey('BAHYammerCommentCountOWSNMBR', resultsRow),
                                        bahOrg: orgAcronym,
                                        tagColor: orgColor
                                    };

                                    viewModel.push(item);
                                });
                            }
                        }

                        html = template(viewModel);
                        $(Widgets.groupTrending.container).html(html);
                    }
                });
            }
            );
        },
        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);
///#source 1 1 Widgets/Shared/genericHeader.js
var Widgets = Widgets || {};
(function ($) {
    Widgets.genericHeader = {
        name: 'Generic Header',
        log: false,
        logger: function (log) {
            var context = this;
            context.console.push(log);
            if (context.log) console.log(log);
        },
        productionDebug: function () {
            var context = this;
            $.each(context.console, function (key, val) {
                console.log(val);
            })
        },
        console:[],
        promise: new $.Deferred(),
        pageContentTypes: ['Functional Page'],
        termPromise: new $.Deferred(),
        selectProperties: ['ContentType'],
        contentTypes: [],
        queries: [],
        data: {
            configuration: '',
            customProperties: {
                connect: { email: [], groupEmail: [], groupHeader: [], groupYammer: [], phone: [], yammerLink: [], website: [] },
                header: [],
            },
            results: [],
            page: [],
            termStore: [],
            // title is the page title from the termstore custom properties
            headerData: { name: '', title: '', tagColor: '', subTitle: '' }
        },
        bahStream: '',
        bahStreamProps: [],
        currentIndex: 0,
        totalResults: 0,
        initialResultsAmount: 50,
        extractPageDataBool: true,
        fetchTermStore: function (termParameter) {
            var getTermsDeferred = function (termSetName) {
                var deferred = $.Deferred();
                var locale = 1033; //English
                var clientContext = SP.ClientContext.get_current();
                var taxonomySession = SP.Taxonomy.TaxonomySession.getTaxonomySession(clientContext);
                var termStore = taxonomySession.getDefaultSiteCollectionTermStore();
                var termSets = termStore.getTermSetsByName(termSetName, locale);
                var termSet = termSets.getByName(termSetName);
                var terms = termSet.getAllTerms();
                clientContext.load(taxonomySession);
                clientContext.load(termStore);
                clientContext.load(termSet);
                clientContext.load(terms, 'Include(IsRoot, Labels, TermsCount, Id, IsAvailableForTagging, Name, PathOfTerm, Parent, TermSet.Name, LocalCustomProperties, CustomProperties, Parent.Name, CustomSortOrder)');
                clientContext.executeQueryAsync(Function.createDelegate(this, function () { deferred.resolve(terms); }),
                    Function.createDelegate(this, function (sender, args) { deferred.reject(sender, args); }));
                return deferred.promise();
            };
            return getTermsDeferred(termParameter);
        },
        setTermset: function (termParameter) {
            var context = this;
            $.when(context.fetchTermStore(termParameter)).done(function (terms) {
                context.data.termStore = terms;
                for (var i = 0; i < terms.get_count(); i++) {
                    var spTerm = terms.getItemAtIndex(i);
                    if (spTerm.get_name() === "email") context.data.customProperties.connect.email = spTerm.get_customProperties();
                    if (spTerm.get_name() === "phone") context.data.customProperties.connect.phone = spTerm.get_customProperties();
                    if (spTerm.get_name() === "yammerlink") context.data.customProperties.connect.yammerLink = spTerm.get_customProperties();
                    if (spTerm.get_name() === "website") context.data.customProperties.connect.website = spTerm.get_customProperties();
                    /* 10-20-2015 ryan.williams [832868] NOTE: This exists for cases such as people model */
                    if (spTerm.get_name() === "groupemail") context.data.customProperties.connect.groupEmail = spTerm.get_customProperties();
                    if (spTerm.get_name() === "groupheader") context.data.customProperties.connect.groupHeader = spTerm.get_customProperties();
                    if (spTerm.get_name() === "groupyammer") context.data.customProperties.connect.groupYammer = spTerm.get_customProperties();
                    
                    /* end NOTE */
                    var widgetConfiguration = $(context.container).attr('data-configuration') || "";

                    /* 10-20-2015 ryan williams[832868] NOTE: This will override the properties above if they exist */
                    if (spTerm.get_name() === widgetConfiguration) {
                        var groupProperties = spTerm.get_customProperties();
                        if (groupProperties["title"]) context.data.headerData.title = groupProperties["title"]; // title aligns to breadcrumbs // TODO: update value in page properties
                        if (groupProperties["groupEmail"]) context.data.customProperties.connect.groupEmail = groupProperties["groupEmail"];
                        if (groupProperties["groupHeader"]) context.data.customProperties.connect.groupHeader = groupProperties["groupHeader"];
                        if (groupProperties["groupYammer"]) context.data.customProperties.connect.groupYammer = groupProperties["groupYammer"];
                    }

                    // This is being added because this is an edge case for totalRewards which was not equally matched in people page.
                    // This could cause a possible issue with same field getting overwritten
                    //if (spTerm.get_name() === "groupemail") context.data.customProperties.connect.groupEmail = spTerm.get_customProperties();
                    //if (spTerm.get_name() === "groupheader") context.data.customProperties.connect.groupHeader = spTerm.get_customProperties();
                    //if (spTerm.get_name() === "groupyammer") context.data.customProperties.connect.groupYammer = spTerm.get_customProperties();

                    if (spTerm.get_name() === "Configuration") context.data.customProperties.header = spTerm.get_customProperties();
                }
                context.data.headerData.tagColor = context.data.customProperties.header['bannercolor'];
                context.termPromise.resolve();
            });
        },
        load: function (options) {
            var context = this;
            context.log = window.location.href.toLowerCase().indexOf("bahtest.sharepoint.com") > -1 ? true : false;
            //if (context.log) document.title = "Dhruv's Generic Header in progress";
            var pageClass = $(context.container).attr('data-pageClass') || "";
            $('html').addClass(pageClass);
            var context = this;
            var pageContext = $(context.container).attr('data-pageContext') || "";
            pageContext !== "" ? context.pageContentTypes.push(pageContext) : null;
            var orgId = Bah.GetQueryStringParams("orgid");
            var widgetConfiguration = $(context.container).attr('data-configuration') || "";
            orgId !== null && orgId !== undefined && orgId !== "" ? context.streamParser(orgId) : context.queryParser(widgetConfiguration, widgetConfiguration);
            var termStore = $(context.container).attr('data-termStore') || "";
            termStore !== "" ? context.setTermset(termStore) : context.termPromise.resolve();
            //var widgetConfiguration = $(context.container).attr('data-configuration') || "";
            //var queryParams = "(BAHFunctionalPageTitle=\"" + widgetConfiguration + "\" AND ContentType:\"Functional List\") OR (BAHFunctionalPageTitle=\"" + widgetConfiguration + "\" AND ContentType:\"Functional Document\") OR (BAHFunctionalPageTitle=\"" + widgetConfiguration + "\" AND ContentType:\"Functional Page\")";
            //widgetConfiguration !== "" ? context.setResults(widgetConfiguration, queryParams, context.currentIndex) : context.logger("People Header is missing data-configuration parameter");
        },
        getParentTerm: function (currentTerm) {
            var self = this;
            if (!currentTerm.get_isRoot()) {
                $.when(Bah.getTermParent(currentTerm)).then(
                function (parentTerm) {
                    self.bahStreamProps.push(parentTerm.get_name())
                    var isRoot = parentTerm.get_isRoot();
                    if (!isRoot) {
                        self.getParentTerm(parentTerm);
                    }
                    else {
                        self.bahStreamProps.reverse();
                        self.streamBuilder.resolve();
                    }
                });
            } else {
                self.bahStreamProps.reverse();
                self.streamBuilder.resolve();
            }
        },
        streamBuilder: new $.Deferred(),
        streamParser: function (orgId) {
            var context = this;

            context.extractPageDataBool = false;
            $.when(Bah.getTerm(Bah.Constants.Guid.StreamTermSet, orgId)).then(
                function (groupTerm) {
                    //context.getParentTerm(groupTerm);
                    orgTermSet = groupTerm;
                    orgTermName = groupTerm.get_name();
                    orgTermProps = groupTerm.get_customProperties();
                    context.data.customProperties.header = orgTermProps;
                    context.data.headerData.subTitle = orgTermProps['subTitle'];
                    context.data.headerData.tagColor = orgTermProps['tagcolor'];
                    context.bahStreamProps.push(orgTermName);
                    context.getParentTerm(groupTerm);
                    //var widgetConfiguration = orgTermName;

                    document.title = orgTermName;
                    //var queryParams = "(contenttype:\"Hero Carousel\" AND BAHStream:" + orgTermName + " ) OR (contenttype:\"Platform List\" AND BAHStream:" + orgTermName + " ) OR (contenttype:\"Platform Document\" AND BAHStream:" + orgTermName + ") OR   (contenttype:\"Leadership Messages\" AND bahstream:" + orgTermName + " )  OR   (contenttype:\"Our Leadership Team\" AND BAHStream:" + orgTermName + " ) OR (contenttype:\"More About Us\" AND BAHStream:" + orgTermName + " ) OR  (contenttype:\"Firmwide Events\" AND BAHStream:" + orgTermName + " AND bahstartdate>=today AND bahstartdate<" + todayPlus + ")  OR (contenttype:\"Zone Publishing Stream Enhanced News Page\" AND BAHStream:\"" + orgTermName + "\" AND write>" + todayMinus + " AND BAHArticleDate<Today)";
                    //var queryParams = "(BAHFunctionalPageTitle=\"" + widgetConfiguration + "\" AND ContentType:\"Functional List\") OR (BAHFunctionalPageTitle=\"" + widgetConfiguration + "\" AND ContentType:\"Functional Document\") OR (BAHFunctionalPageTitle=\"" + widgetConfiguration + "\" AND ContentType:\"Functional Page\")";
                    //widgetConfiguration !== "" ? context.setResults(widgetConfiguration, queryParams, context.currentIndex) : context.logger("People Header is missing data-configuration parameter");
                    
                    $.when(context.streamBuilder).done(function () {
                        $.each(context.bahStreamProps, function (key, val) {
                            context.bahStream += val;
                            if (key < context.bahStreamProps.length -1) {
                                context.bahStream += ":";
                            }
                        })
                        context.queryParser(context.bahStream, orgTermName);
                    });
                }
            );

        },
        queryParser: function (widgetConfiguration, widgetTitle) {
            var context = this;
            if (widgetConfiguration !== "") {
                var propertiesBuilder = function (i, w) {
                    var container = $(w);
                    var widgetName = container.data('widget');
                    var widget = Widgets[widgetName];
                    if (widget && widget.configuration) {
                        var allProperties = widget.configuration;
                        var select = allProperties.selectProperties;
                        var contentTypes = allProperties.contentTypes;
                        var query = allProperties.query;

                        $(select).each(function (key, val) {
                            context.selectProperties.push(val);
                        });

                        if (query !== "") {
                            context.queries.push(query);
                            context.logger("Widget: " + widgetName + " has custom query set. Ignoring select properties");
                        } else {
                            $(contentTypes).each(function (key, val) {
                                context.pageContentTypes.push(val);
                            });
                            context.logger("Widget: " + widgetName + " does not have custom query set. Using select properties.");
                        }
                    } else {
                        if (widgetName === undefined) {
                            context.logger("Element with following class: '" + w.className + "' is incorrectly tagged as a widget but is not a widget");
                        } else {
                            context.logger("Widget: " + widgetName + " is missing configuration properties.");
                        }
                    }
                }
                $('.widgetHandler').each(function (i, w) {
                    propertiesBuilder(i, w);
                });
                $('[data-handler="genericWidget"]').each(function (i, w) {
                    propertiesBuilder(i, w);
                });
                context.selectProperties = context.removeDuplicates(context.selectProperties);
                context.pageContentTypes = context.removeDuplicates(context.pageContentTypes);
                if (context.selectProperties.length === 0 && context.pageContentTypes.length === 0 && context.queries.length === 0) {
                    context.logger("No widgets are tagged with 'widgetHandler' class");
                } else {
                    var queryParams = "";
                    //var widgetConfiguration = $(context.container).attr('data-configuration') || "";
                    var uniqueIdentifier = $(context.container).attr('data-queryIdentifier') || "";
                    if (uniqueIdentifier !== "" && uniqueIdentifier.toUpperCase() !== "BAHSTREAM") {
                        $(context.pageContentTypes).each(function (key, val) {
                            queryParams += "(" + uniqueIdentifier + "=\"" + widgetConfiguration + "\" AND ContentType:\"" + val + "\")";
                            if (key < context.pageContentTypes.length - 1) queryParams += " OR ";
                        });
                    }
                    if (uniqueIdentifier.toUpperCase() === "BAHSTREAM") {
                        $(context.pageContentTypes).each(function (key, val) {
                            queryParams += "(BAHStreamDisplay=\"" + widgetConfiguration + "\" AND ContentType:\"" + val + "\")";
                            if (key < context.pageContentTypes.length - 1) queryParams += " OR ";
                        });
                    }
                    if (context.queries.length > 0) {
                        $(context.queries).each(function (key, val) {
                            if (queryParams !== "") queryParams += " OR ";
                            queryParams += context.replaceCustomQueries(val);
                            if (key < context.queries.length - 1) queryParams += " OR ";
                        });
                    }
                    queryParams !== "" ? context.setResults(widgetTitle, queryParams, context.currentIndex) : context.logger("Generic Header missing data-uniqueIdentifer tag on header div");
                    context.logger(queryParams);
                }
            }
            else {
                context.logger("Generic Header does not contain a valid data-configuration or stream property. If stream page check to see that orgId is present in URL");
            }

            //
            // END DHRUV'S POC
            //
        },
        replaceCustomQueries: function (query) {
            var context = this;
            var tempQuery = query;
            var replace = {
                BAHSTREAM: context.bahStream,
                TODAYPLUS6MONTHS: context.todaysDate(6),
                TODAYMINUS6MONTHS: context.todaysDate(-6),
                BAHFUNCTIONALPAGETITLE: $(context.container).attr('data-configuration') || "",
            };
            $.each(replace, function (key, val) {
                tempQuery = tempQuery.replace(new RegExp(key, 'g'), val);
            });
            return tempQuery;
        },
        removeDuplicates: function (arr) {
            var i, len = arr.length, out = [], obj = {};

            for (i = 0; i < len; i++) {
                obj[arr[i]] = 0;
            }
            for (i in obj) {
                out.push(i);
            }
            return out;
        },
        todaysDate: function (variation) {
            //variation is plus or minus months
            var today = new Date();
            today = new Date(today);
            today.setMonth(today.getMonth() + variation);
            var dd = today.getDate();
            var mm = today.getMonth() + 1; //January is 0!
            var yyyy = today.getFullYear();
            if (dd < 10) {
                dd = '0' + dd
            }
            if (mm < 10) {
                mm = '0' + mm
            }
            today = mm + '-' + dd + '-' + yyyy;
            return today;
        },
        constructQuery: function (parameter, startPosition) {
            var context = this;
            var deferred = $.Deferred();
            SP.SOD.executeFunc("SP.js", "SP.ClientContext", function () {
                SP.SOD.executeFunc("SP.Search.js", "Microsoft.SharePoint.Client.Search.Query.KeywordQuery", function () {
                    var sContext = SP.ClientContext.get_current();
                    var keywordQuery = new Microsoft.SharePoint.Client.Search.Query.KeywordQuery(sContext);
                    keywordQuery.set_trimDuplicates(false);
                    keywordQuery.set_rowLimit(context.initialResultsAmount);
                    keywordQuery.set_startRow(startPosition);
                    var properties = keywordQuery.get_selectProperties();
                    $.each(context.selectProperties, function (key, widgetConfiguration) {
                        properties.add(widgetConfiguration);
                    });
                    // Sorting (Ascending = 0, Descending = 1)
                    keywordQuery.set_enableSorting(true);
                    var sortproperties = keywordQuery.get_sortList();
                    sortproperties.add("BAHWidget", 0);
                    sortproperties.add("BAHSortOrder", 0);
                    sortproperties.add("BAHArticleDate", 1);
                    sortproperties.add("BAHShowcasePublishDate", 1);
                    sortproperties.add("BAHStartDate", 0);
                    var queryText = parameter;
                    keywordQuery.set_queryText(queryText);
                    var searchExecutor = new Microsoft.SharePoint.Client.Search.Query.SearchExecutor(sContext);
                    results = searchExecutor.executeQuery(keywordQuery);
                    sContext.executeQueryAsync(
                        function () {
                            deferred.resolve(results);
                        },
                        function (err) {
                            deferred.reject(null);
                        }
                    );
                });
            });
            return deferred.promise();
        },
        setResults: function (configuration, parameter, startPosition) {
            var context = this;
            context.data.headerData.name = configuration;
            context.data.configuration = configuration;
            context.compileHtml(context.data.headerData);
            $.when(context.constructQuery(parameter, startPosition)).done(function (data) {
                if (data.m_value !== undefined && data.m_value.ResultTables[0].TotalRows !== 0) {
                    context.totalResults = data.m_value.ResultTables[0].TotalRows;
                    var results = data.m_value.ResultTables[0].ResultRows;
                    context.data.results = results.length > 0 ? results : null;
                    if (context.totalResults > context.initialResultsAmount) {
                        context.currentIndex = context.currentIndex + context.initialResultsAmount;
                        context.loadMore(parameter, context.currentIndex);
                    } else {
                        context.extractPageData();
                        context.promise.resolve();
                    }
                } else {
                    context.logger("Verify data for configuration: '" + configuration + "' has data.");
                }
            });
        },
        extractPageData: function () {
            var context = this;
            if (context.extractPageDataBool) {
                var pageContext = context.data.page = $.grep(context.data.results, function (item, index) {
                    return ((item.ContentType).match(/Functional Sub Page/g) || (item.ContentType).match(/Functional Page/g));
                });
                pageContext[0] && pageContext[0].Title !== "" ? context.data.headerData.name = pageContext[0].Title : null; // assuming all titles are the same or 1 return object to assign value
                pageContext[0] && pageContext[0].BAHSubTitleOWSTEXT !== "" ? context.data.headerData.subTitle = pageContext[0].BAHSubTitleOWSTEXT : null;
            }
            if (context.data.page.length === 0) context.logger("No page data has been indexed by search for this page");

        },
        compileHtml: function (model) {
            var context = this;
            $.when(context.promise, context.termPromise).done(function () {
                var headerTemplate = $(context.container).attr('data-template') || "";
                if (headerTemplate !== "") {
                    var template = Handlebars.compile($('#' + headerTemplate).html());
                    var html = template(model);
                    $(context.container).html(html);
                }
            });
        },
        loadMore: function (parameter, startPosition) {
            var context = this;
            $.when(context.constructQuery(parameter, startPosition)).done(function (data) {
                if (data.m_value !== undefined) {
                    var results = data.m_value.ResultTables[0].ResultRows;
                    if (results.length > 0) {
                        $.each(results, function (key, val) {
                            context.data.results.push(val);
                        });
                    }
                    context.currentIndex = context.currentIndex + results.length;
                    if (context.currentIndex < context.totalResults) {
                        context.loadMore(parameter, context.currentIndex);
                    }
                    else {
                        context.extractPageData();
                        context.promise.resolve();
                    }
                }
            });
        },
        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);
///#source 1 1 Widgets/PeoplePage/peopleHeader.js
//var Widgets = Widgets || {};
//(function ($) {
//    Widgets.peopleHeader = {
//        name: 'People Header',
//        log: true,
//        promise: new $.Deferred(),
//        termPromise: new $.Deferred(),
//        selectProperties: [
//            "BAHFunctionalDescriptionOWSHTML",
//            "BAHLongURLTitleOWSTEXT",
//            "BAHResourceUrl",
//            "BAHIconUrlOWSURLH",
//            "BAHSortOrder",
//            "BAHFunctionalFilter",
//            "BAHWidget",
//            "BAHFunctionalPageTitle",
//            "BAHHeroPublishingImageOWSIMGE",
//            "BAHHeroVideoEmbedOWSMTXT",
//            "Url",
//            "Title",
//            "ContentType",
//            "BAHSubTitleOWSTEXT",
//            "BAHHeroDescriptionOWSHTML",
//            "BAHHeroImageOWSHTML",
//            "BAHHeroBylineOWSTEXT",
//            "BAHSectionDescription5OWSHTML",
//            "BAHSectionDescription6OWSHTML",
//            "BAHSectionDescription7OWSHTML",
//            "BAHSectionDescription8OWSHTML",
//            "BAHSectionDescription9OWSHTML",
//            "BAHSectionDescription10OWSHTML",
//            "BAHSectionTitle1",
//            "BAHSectionTitle2",
//            "BAHSectionTitle3",
//            "BAHSectionTitle4",
//            "BAHSectionTitle5",
//            "BAHSectionTitle6",
//            "BAHSectionTitle7",
//            "BAHSectionTitle8",
//            "BAHSectionTitle9",
//            "BAHSectionTitle10"
//        ],
//        data: {
//            configuration: '',
//            customProperties: {
//                connect: { email: [], groupEmail: [], groupHeader: [], groupYammer: [], phone: [], yammerLink: [] },
//                header: [],
//            },
//            results: [],
//            page:[],
//            termStore: [],
//            headerData: { name: '', tagColor: '' }
//        },
//        currentIndex: 0,
//        totalResults: 0,
//        initialResultsAmount: 50,
//        fetchTermStore: function () {
//            var getTermsDeferred = function (termSetName) {
//                var deferred = $.Deferred();
//                var locale = 1033; //English
//                var clientContext = SP.ClientContext.get_current();
//                var taxonomySession = SP.Taxonomy.TaxonomySession.getTaxonomySession(clientContext);
//                var termStore = taxonomySession.getDefaultSiteCollectionTermStore();
//                var termSets = termStore.getTermSetsByName(termSetName, locale);
//                var termSet = termSets.getByName(termSetName);
//                var terms = termSet.getAllTerms();
//                clientContext.load(taxonomySession);
//                clientContext.load(termStore);
//                clientContext.load(termSet);
//                clientContext.load(terms, 'Include(IsRoot, Labels, TermsCount, Id, IsAvailableForTagging, Name, PathOfTerm, Parent, TermSet.Name, LocalCustomProperties, CustomProperties, Parent.Name, CustomSortOrder)');
//                clientContext.executeQueryAsync(Function.createDelegate(this, function () { deferred.resolve(terms); }),
//                    Function.createDelegate(this, function (sender, args) { deferred.reject(sender, args); }));
//                return deferred.promise();
//            };
//            return getTermsDeferred("People Model");
//        },
//        setTermset: function () {
//            var context = this;
//                $.when(context.fetchTermStore()).done(function (terms) {
//                    context.data.termStore = terms;
//                    for (var i = 0; i < terms.get_count() ; i++) {
//                        var spTerm = terms.getItemAtIndex(i);
//                        if (spTerm.get_name() === "email") context.data.customProperties.connect.email = spTerm.get_customProperties();
//                        if (spTerm.get_name() === "phone") context.data.customProperties.connect.phone = spTerm.get_customProperties();
//                        if (spTerm.get_name() === "yammerlink") context.data.customProperties.connect.yammerLink = spTerm.get_customProperties();
//                        var widgetConfiguration = $(context.container).attr('data-configuration') || "";

//                        if (spTerm.get_name() === widgetConfiguration) {
//                            var groupProperties = spTerm.get_customProperties();

//                            if (groupProperties["groupEmail"]) context.data.customProperties.connect.groupEmail = groupProperties["groupEmail"];
//                            if (groupProperties["groupHeader"]) context.data.customProperties.connect.groupHeader = groupProperties["groupHeader"];
//                            if (groupProperties["groupYammer"]) context.data.customProperties.connect.groupYammer = groupProperties["groupYammer"];

//                        }
//                        if (spTerm.get_name() === "Configuration") context.data.customProperties.header = spTerm.get_customProperties();
//                    }
//                    context.data.headerData.tagColor = context.data.customProperties.header['bannercolor'];
//                    context.termPromise.resolve();
//                });
//        },
//        load: function (options) {
//            $('html').addClass('bah-people-page');
//            var context = this;
//            context.setTermset();
//            var widgetConfiguration = $(context.container).attr('data-configuration') || "";
//            var queryParams = "(BAHFunctionalPageTitle=\"" + widgetConfiguration + "\" AND ContentType:\"Functional List\") OR (BAHFunctionalPageTitle=\"" + widgetConfiguration + "\" AND ContentType:\"Functional Document\") OR (BAHFunctionalPageTitle=\"" + widgetConfiguration + "\" AND ContentType:\"Functional Page\")";
//            widgetConfiguration !== "" ? context.setResults(widgetConfiguration, queryParams, context.currentIndex) : console.log("People Header is missing data-configuration parameter");
//        },
//        constructQuery: function (parameter, startPosition) {
//            var context = this;
//            var deferred = $.Deferred();
//            SP.SOD.executeFunc("SP.js", "SP.ClientContext", function () {
//                SP.SOD.executeFunc("SP.Search.js", "Microsoft.SharePoint.Client.Search.Query.KeywordQuery", function () {
//                    var sContext = SP.ClientContext.get_current();
//                    var keywordQuery = new Microsoft.SharePoint.Client.Search.Query.KeywordQuery(sContext);
//                    keywordQuery.set_trimDuplicates(false);
//                    keywordQuery.set_rowLimit(context.initialResultsAmount);
//                    keywordQuery.set_startRow(startPosition);
//                    var properties = keywordQuery.get_selectProperties();
//                    $.each(context.selectProperties, function (key, widgetConfiguration) {
//                        properties.add(widgetConfiguration);
//                    });
//                    // Sorting (Ascending = 0, Descending = 1)
//                    keywordQuery.set_enableSorting(true);
//                    var sortproperties = keywordQuery.get_sortList();
//                    sortproperties.add("BAHWidget", 0);
//                    sortproperties.add("BAHSortOrder", 0);
//                    var queryText = parameter;
//                    keywordQuery.set_queryText(queryText);
//                    var searchExecutor = new Microsoft.SharePoint.Client.Search.Query.SearchExecutor(sContext);
//                    results = searchExecutor.executeQuery(keywordQuery);
//                    sContext.executeQueryAsync(
//                        function () {
//                            deferred.resolve(results);
//                        },
//                        function (err) {
//                            deferred.reject(null);
//                        }
//                    );
//                });
//            });
//            return deferred.promise();
//        },
//        setResults: function (configuration, parameter, startPosition) {
//            var context = this;
//            context.data.headerData.name = configuration;
//            context.data.configuration = configuration;
//            context.compileHtml(context.data.headerData);
//            $.when(context.constructQuery(parameter, startPosition)).done(function (data) {
//                if (data.m_value !== undefined && data.m_value.ResultTables[0].TotalRows !== 0) {
//                    context.totalResults = data.m_value.ResultTables[0].TotalRows;
//                    var results = data.m_value.ResultTables[0].ResultRows;
//                    context.data.results = results.length > 0 ? results : null;
//                    if (context.totalResults > context.initialResultsAmount) {
//                        context.currentIndex = context.currentIndex + context.initialResultsAmount;
//                        context.loadMore(parameter, context.currentIndex);
//                    } else {
//                        context.extractPageData();
//                        context.promise.resolve();
//                    }
//                } else {
//                    console.log("Verify data for configuration: '" + configuration + "' has data.");
//                }
//            });
//        },
//        extractPageData: function () {
//            var context = this;
//            $.each(context.data.results, function (key, val) {
//                $.each(val, function (key2, val2) {
//                    if (key2 === "ContentType") {
//                        if (val2.indexOf("Functional Page") > -1) {
//                            context.data.page.push(val);
//                            context.data.headerData.name = val.Title;
//                        }
//                    }
//                });
//            });
//            if (context.data.page.length === 0) console.log("No page data has been indexed by search for this page");
//        },
//        compileHtml: function (model) {
//            var context = this;
//            $.when(context.promise, context.termPromise).done(function () {
//                var template = Handlebars.compile($('#peopleHeaderTemplate').html());
//                var html = template(model);
//                $(context.container).html(html);
//            });
//        },
//        loadMore: function (parameter, startPosition) {
//            var context = this;
//            $.when(context.constructQuery(parameter, startPosition)).done(function (data) {
//                if (data.m_value !== undefined) {
//                    var results = data.m_value.ResultTables[0].ResultRows;
//                    if (results.length > 0) {
//                        $.each(results, function (key, val) {
//                            context.data.results.push(val);
//                        });
//                    }
//                    context.currentIndex = context.currentIndex + results.length;
//                    if (context.currentIndex < context.totalResults) {
//                        context.loadMore(parameter, context.currentIndex);
//                    }
//                    else {
//                        context.extractPageData();
//                        context.promise.resolve();
//                    }
//                }
//            });
//        },
//        fail: function (error, event) {
//            Bah.logging.error(event, this.name);
//        }
//    };
//})(jQuery);
///#source 1 1 Widgets/PeoplePage/peopleFeaturedContent.js
var Widgets = Widgets || {};
(function ($) {
    Widgets.peopleFeaturedContent = {
        name: 'Featured Content',
        log: true,
        configuration: {
            selectProperties: [
            "BAHFunctionalDescriptionOWSHTML",
            "BAHLongURLTitleOWSTEXT",
            "BAHResourceUrl",
            "BAHIconUrlOWSURLH",
            "BAHSortOrder",
            "BAHFunctionalFilter",
            "BAHWidget",
            "BAHFunctionalPageTitle",
            "BAHHeroPublishingImageOWSIMGE",
            "BAHHeroVideoEmbedOWSMTXT",
            "Url",
            "Title",
            "ContentType",
            "BAHSubTitleOWSTEXT",
            "BAHHeroDescriptionOWSHTML",
            "BAHHeroImageOWSHTML",
            "BAHHeroBylineOWSTEXT",
            "BAHSectionDescription5OWSHTML",
            "BAHSectionDescription6OWSHTML",
            "BAHSectionDescription7OWSHTML",
            "BAHSectionDescription8OWSHTML",
            "BAHSectionDescription9OWSHTML",
            "BAHSectionDescription10OWSHTML",
            "BAHSectionTitle1",
            "BAHSectionTitle2",
            "BAHSectionTitle3",
            "BAHSectionTitle4",
            "BAHSectionTitle5",
            "BAHSectionTitle6",
            "BAHSectionTitle7",
            "BAHSectionTitle8",
            "BAHSectionTitle9",
            "BAHSectionTitle10"
            ],
            query: '',
            contentTypes: ['Functional List', 'Functional Document', 'Functional Page'],
        },
        load: function (options) {
            var featuredContent = {};
            var contentArray = [];
            var context = this;
            var template = Handlebars.compile($('#peopleFeaturedContentTemplate').html());
            var header = Widgets.genericHeader;
            $.when(header.promise).done(function () {
                // TO DO: Section title is returning null even though it's listed in the page's properties.
                //console.log(Widgets.genericHeader.data.page[0]);
                //console.log(Widgets.genericHeader.data.page[0].BAHSectionTitle5);
                $.each(header.data.results, function (index, value) {
                    var contentBox = {};
                    if (value.BAHWidget.indexOf('Featured Content and Top Shortcut Links') > -1) {
                        if (value.BAHResourceUrl != null){
                        //var link = value.BAHResourceUrlOWSURLH.split(',');
                        contentBox.linkText = value.BAHLongURLTitleOWSTEXT;
                        contentBox.linkUrl = value.BAHResourceUrl;
                        }
                        contentBox.blurb = value.HitHighlightedSummary.replace(/<ddd\/>/g, '');
                        if (contentBox.blurb.length > 40) {
                            contentBox.blurb = contentBox.blurb.substring(0, 40) + '...';
                        }
                        contentBox.title = Bah.setEllipsis(value.Title, "35");
                        contentArray.push(contentBox);
                    }
                });

                featuredContent.contentArray = contentArray.slice(0,6);   // Only allow six tiles max
                header.data.page[0] ? featuredContent.widgetTitle = header.data.page[0]['BAHSectionTitle' + $(context.container).attr('data-section')] : featuredContent.widgetTitle = "";
                html = template(featuredContent);
                $(context.container).html(html);
            })
        },
        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);
///#source 1 1 Widgets/PeoplePage/peopleExplore.js
var Widgets = Widgets || {};
(function ($) {
    Widgets.peopleExplore = {
        name: 'People Explore',
        log: true,
        configuration: {
            selectProperties: [
            "BAHFunctionalDescriptionOWSHTML",
            "BAHLongURLTitleOWSTEXT",
            "BAHResourceUrl",
            "BAHIconUrlOWSURLH",
            "BAHSortOrder",
            "BAHFunctionalFilter",
            "BAHWidget",
            "BAHFunctionalPageTitle",
            "BAHHeroPublishingImageOWSIMGE",
            "BAHHeroVideoEmbedOWSMTXT",
            "Url",
            "Title",
            "ContentType",
            "BAHSubTitleOWSTEXT",
            "BAHHeroDescriptionOWSHTML",
            "BAHHeroImageOWSHTML",
            "BAHHeroBylineOWSTEXT",
            "BAHSectionDescription5OWSHTML",
            "BAHSectionDescription6OWSHTML",
            "BAHSectionDescription7OWSHTML",
            "BAHSectionDescription8OWSHTML",
            "BAHSectionDescription9OWSHTML",
            "BAHSectionDescription10OWSHTML",
            "BAHSectionTitle1",
            "BAHSectionTitle2",
            "BAHSectionTitle3",
            "BAHSectionTitle4",
            "BAHSectionTitle5",
            "BAHSectionTitle6",
            "BAHSectionTitle7",
            "BAHSectionTitle8",
            "BAHSectionTitle9",
            "BAHSectionTitle10"
            ],
            query: '',
            contentTypes: ['Functional List', 'Functional Document', 'Functional Page'],
        },
        load: function (options) {
            var context = this;
            var template = Handlebars.compile($('#peopleExploreTemplate').html());
            var content = Widgets.genericHeader;
            var id = $(context.container).attr('data-section');
            var title = "BAHSectionTitle" + id;
            var desc = "BAHSectionDescription" + id + "OWSHTML";

            $.when(content.promise, content.termPromise).done(function () {
                //your widget code starts executing  here to verify all data is available  
                var myContext = [];

                $.each(content.data.results, function (key, val) {
                    $.each(val, function (key2, val2) {
                        if (key2 === "BAHWidget") {
                            if (val2.indexOf("Explore") > -1) {
                                myContext.push(val);
                            }
                        }
                    });
                });
                
                var data = {
                    context: myContext
                };

                //writes title and description
                $.each(content.data.page, function (key, item) {
                    data.name = item[title];
                    data.description = item[desc];
                });

                html = template(data);
                $(context.container).html(html);
            });
            
        },
        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);
///#source 1 1 Widgets/PeoplePage/peopleLinks.js
var Widgets = Widgets || {};
(function ($) {
    Widgets.peopleLinks = {
        name: 'People Links',
        log: true,
        configuration: {
            selectProperties: [
            "BAHFunctionalDescriptionOWSHTML",
            "BAHLongURLTitleOWSTEXT",
            "BAHResourceUrl",
            "BAHIconUrlOWSURLH",
            "BAHSortOrder",
            "BAHFunctionalFilter",
            "BAHWidget",
            "BAHFunctionalPageTitle",
            "BAHHeroPublishingImageOWSIMGE",
            "BAHHeroVideoEmbedOWSMTXT",
            "Url",
            "Title",
            "ContentType",
            "BAHSubTitleOWSTEXT",
            "BAHHeroDescriptionOWSHTML",
            "BAHHeroImageOWSHTML",
            "BAHHeroBylineOWSTEXT",
            "BAHSectionDescription5OWSHTML",
            "BAHSectionDescription6OWSHTML",
            "BAHSectionDescription7OWSHTML",
            "BAHSectionDescription8OWSHTML",
            "BAHSectionDescription9OWSHTML",
            "BAHSectionDescription10OWSHTML",
            "BAHSectionTitle1",
            "BAHSectionTitle2",
            "BAHSectionTitle3",
            "BAHSectionTitle4",
            "BAHSectionTitle5",
            "BAHSectionTitle6",
            "BAHSectionTitle7",
            "BAHSectionTitle8",
            "BAHSectionTitle9",
            "BAHSectionTitle10"
            ],
            query: '',
            contentTypes: ['Functional List', 'Functional Document', 'Functional Page'],
        },
        load: function (options) {
            var context = this;
            var template = Handlebars.compile($('#peopleLinksTemplate').html());
            var content = Widgets.genericHeader;
            var id = $(context.container).attr('data-section');
            var title = "BAHSectionTitle" + id;
            var desc = "BAHSectionDescription" + id + "OWSHTML";

            $.when(content.promise, content.termPromise).done(function () {
                //your widget code starts executing  here to verify all data is available  
                var myContext = [];

                $.each(content.data.results, function (key, val) {
                    $.each(val, function (key2, val2) {
                        if (key2 === "BAHWidget") {
                            if (val2.indexOf("Related Links") > -1) {
                                myContext.push(val);
                            }
                        }
                    });
                });

                var data = {
                    //return a maximum of three links
                    context: myContext.slice(0,3)
                };

                //writes title and description
                $.each(content.data.page, function (key, item) {
                    data.name = item[title];
                    data.description = item[desc];
                });

                html = template(data);
                $(context.container).html(html);
            });

        },
        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);
///#source 1 1 Widgets/PeoplePage/peopleConnect.js
var Widgets = Widgets || {};
(function ($) {
    Widgets.peopleConnect = {
        name: 'People Connect',
        log: true,
        configuration: {
            selectProperties: [
            "BAHFunctionalDescriptionOWSHTML",
            "BAHLongURLTitleOWSTEXT",
            "BAHResourceUrl",
            "BAHIconUrlOWSURLH",
            "BAHSortOrder",
            "BAHFunctionalFilter",
            "BAHWidget",
            "BAHFunctionalPageTitle",
            "BAHHeroPublishingImageOWSIMGE",
            "BAHHeroVideoEmbedOWSMTXT",
            "Url",
            "Title",
            "ContentType",
            "BAHSubTitleOWSTEXT",
            "BAHHeroDescriptionOWSHTML",
            "BAHHeroImageOWSHTML",
            "BAHHeroBylineOWSTEXT",
            "BAHSectionDescription5OWSHTML",
            "BAHSectionDescription6OWSHTML",
            "BAHSectionDescription7OWSHTML",
            "BAHSectionDescription8OWSHTML",
            "BAHSectionDescription9OWSHTML",
            "BAHSectionDescription10OWSHTML",
            "BAHSectionTitle1",
            "BAHSectionTitle2",
            "BAHSectionTitle3",
            "BAHSectionTitle4",
            "BAHSectionTitle5",
            "BAHSectionTitle6",
            "BAHSectionTitle7",
            "BAHSectionTitle8",
            "BAHSectionTitle9",
            "BAHSectionTitle10"
            ],
            query: '',
            contentTypes: ['Functional List', 'Functional Document', 'Functional Page'],
        },
        load: function (options) {
            var context = this;
            var template = Handlebars.compile($('#peopleConnectTemplate').html());
            var content = Widgets.genericHeader;
            var id = $(context.container).attr('data-section');
            var title = "BAHSectionTitle" + id;
            var desc = "BAHSectionDescription" + id + "OWSHTML";

            $.when(content.promise, content.termPromise).done(function () {
                //your widget code starts executing  here to verify all data is available  
                var resultData = content.data.customProperties.connect;

                var data = {
                    email: resultData.email.address,
                    phone: resultData.phone.number,
                    yammer: resultData.yammerLink['yammer url'],
                    groupTitle: $.isPlainObject(resultData.groupHeader) ? null : resultData.groupHeader,
                    groupEmail: $.isPlainObject(resultData.groupEmail) ? null : resultData.groupEmail,
                    groupYammer: $.isPlainObject(resultData.groupYammer) ? null : resultData.groupYammer,
                    isMobile: Bah.isMobile.any(),
                };

                //writes title and description
                $.each(content.data.page, function (key, item) {
                    data.name = item[title];
                    data.description = item[desc];
                });

                html = template(data);
                $(context.container).html(html);
            });
        },
        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);
///#source 1 1 Widgets/PeoplePage/peopleSearch.js
var Widgets = Widgets || {};

(function ($) {
    Widgets.peopleSearch = {
        name: "People Search",
        redirectUrl: Bah.configuration.searchResultsPageUrl,
        sParameter: "",
        log: true,
        
        getShortName: function () {
            var header = Widgets.genericHeader;
            return $.when(header.termPromise).then(
                    function () {
                        sParameter = '%20AND%20path:%22' + Bah.configuration.rootSiteCollectionUrl + header.data.customProperties.header.cmslocation + '%22';
                        return header.data.customProperties.header.DomainName;
                    }
                );
        },
        template: function () {
            return $("#peopleSearchTemplate").html();
        },

        fetch: function () {
            redirectUrl = Bah.configuration.searchResultsPageUrl;
            return $.when(Widgets.peopleSearch.getShortName()).then(function (shortName) {
                return { shortName: shortName };
            });            
        },

        parse: function (data) {
            return data;
        },

        bind: function (template, data) {
            var template = Handlebars.compile(template);
            var html = template(data);
            return html;
        },

        render: function (html, data) {
            // render and attach event here
            var self = this;
            var $container = $(this.container);
            $container.html(html);

            //just in case it gets rendered again
            $container.off('click.peopleSearch');

            if (redirectUrl) { //if no url, don't even bother registering event
                var submit = function (query) {
                    if (query) {
                        //redirect here
                        window.location.href = redirectUrl + '?k=' + encodeURIComponent(query) + sParameter;
                    }
                    return false;
                };

                $container.on('click.peopleSearch', '.btn-search', function () {
                    return submit($container.find('.input').val());
                });

                $container.on('keydown', '.input', function (e) {
                    var key = e.which;
                    if (key === 13) {
                        return submit($container.find('.input').val())
                    }
                });
            }
        },

        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);
///#source 1 1 Widgets/PeoplePage/peopleHero.js
var Widgets = Widgets || {};
(function ($) {
    Widgets.peopleHero = {
        log: true,
        myContext: [],
        vm: {
            bylineText: '',
            heroImg: '',
            heroVideo: '',
            heroDescription: '',
            showVideo: false,
            heroLink:''
        },
        configuration: {
            selectProperties: [
            "BAHFunctionalDescriptionOWSHTML",
            "BAHLongURLTitleOWSTEXT",
            "BAHResourceUrl",
            "BAHIconUrlOWSURLH",
            "BAHSortOrder",
            "BAHFunctionalFilter",
            "BAHWidget",
            "BAHFunctionalPageTitle",
            "BAHHeroPublishingImageOWSIMGE",
            "BAHHeroVideoEmbedOWSMTXT",
            "Url",
            "Title",
            "ContentType",
            "BAHSubTitleOWSTEXT",
            "BAHHeroDescriptionOWSHTML",
            "BAHHeroImageOWSHTML",
            "BAHHeroBylineOWSTEXT",
            "BAHSectionDescription5OWSHTML",
            "BAHSectionDescription6OWSHTML",
            "BAHSectionDescription7OWSHTML",
            "BAHSectionDescription8OWSHTML",
            "BAHSectionDescription9OWSHTML",
            "BAHSectionDescription10OWSHTML",
            "BAHSectionTitle1",
            "BAHSectionTitle2",
            "BAHSectionTitle3",
            "BAHSectionTitle4",
            "BAHSectionTitle5",
            "BAHSectionTitle6",
            "BAHSectionTitle7",
            "BAHSectionTitle8",
            "BAHSectionTitle9",
            "BAHSectionTitle10"
            ],
            query: '',
            contentTypes: ['Functional List', 'Functional Document', 'Functional Page'],
        },
        load: function (options) {
            var context = this;
            var template = Handlebars.compile($('#peopleHeroTemplate').html());
            var header = Widgets.genericHeader;
            $.when(header.promise).done(function () {
                context.myContext = header.data.page;
                if (context.myContext[0]) {
                    if (context.myContext[0].BAHHeroBylineOWSTEXT) {
                        context.vm.bylineText = Bah.setEllipsis(context.myContext[0].BAHHeroBylineOWSTEXT, 100);
                    }
                    context.vm.heroDescription = context.myContext[0].BAHHeroDescriptionOWSHTML;
                    context.vm.heroImg = $(context.myContext[0].BAHHeroPublishingImageOWSIMGE).find('img').attr('src') || $(context.myContext[0].BAHHeroPublishingImageOWSIMGE).attr('src');;
                    context.vm.heroLink = $(context.myContext[0].BAHHeroPublishingImageOWSIMGE).attr('href');
                    context.vm.heroVideo = $(context.myContext[0].BAHHeroVideoEmbedOWSMTXT).attr('src');
                    context.vm.heroVideo ? context.vm.showVideo = true : context.vm.showVideo = false;
                    context.vm.heroDescription = context.myContext[0].BAHHeroDescriptionOWSHTML;
                }
                var html = template(context.vm);
                $(context.container).html(html);
            }); //End Promise
        },
        htmlDecode: function (input) {
            var e = document.createElement('div');
            e.innerHTML = input;
            return e.childNodes.length === 0 ? "" : e.childNodes[0].nodeValue;
        },
        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);
///#source 1 1 Widgets/PeoplePage/peopleCareerManagerResources.js
var Widgets = Widgets || {};
(function ($)
{
    Widgets.peopleCareerManagerResources = {
        name: 'Career Manager Resources',
        log: true,
        load: function (options)
        {
            var context = this;
            var resourceContent = {};
            var resourceContentArray = { ResourceTitle: '', ResourceDescription: '' };
            var callout;

            var ID = $(context.container).attr('data-section');
            var sectionTitle = "BAHSectionTitle" + ID;
            var sectionDesc = "BAHSectionDescription" + ID + "OWSHTML";
            var header = Widgets.genericHeader;
            var template = Handlebars.compile($('#peopleCareerManagerResourcesTemplate').html());
            $.when(header.promise).done(function ()
            {
                var title = header.data.page[0][sectionTitle];
                var desc = header.data.page[0][sectionDesc];

                resourceContentArray.ResourceTitle = title;
                resourceContentArray.ResourceDescription = desc;

                $.each(header.data.results, function (index, value)
                {
                    if (Bah.czStringContains(value.BAHWidget, 'performance management callout campaign'))
                    {
                        resourceContentArray.ResourceTitle = '';
                    }
                });

                resourceContent.resourceContentArray = resourceContentArray;
                html = template(resourceContent);
                $(context.container).html(html);
            });
        },
        fail: function (error, event)
        {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);
///#source 1 1 Widgets/PeoplePage/peopleCareerCentralLearn.js
var Widgets = Widgets || {};
(function ($)
{
    Widgets.peopleLearn = {
        name: 'Career Central Learn',
        log: true,
        load: function (options)
        {

            var context = this;
            var learnContent = {};
            var learnArray = { data: [] };

            var ID = $(context.container).attr('data-section');
            var sectionDesc = "BAHSectionDescription" + ID + "OWSHTML";
            var sectionTitle = "BAHSectionTitle" + ID;
            var header = Widgets.genericHeader;

            var template = Handlebars.compile($('#peopleLearnTemplate').html());

            $.when(header.promise, header.termPromise).done(function ()
            {
                if (header.data.page[0])
                {
                    learnArray.data.LearnTitle = header.data.page[0][sectionTitle];
                    learnArray.data.LearnDesc = header.data.page[0][sectionDesc];
                    learnArray.data.LearnLink = header.data.customProperties.header['careercentrallearn'];
                    learnArray.HeaderColor = header.data.headerData.tagColor;

                    learnContent.learnArray = learnArray;
                    html = template(learnContent);
                    $(context.container).html(html);
                    $(document).foundation(); // NECESSARY FOR ACCORDION
                }

            });
        },
        fail: function (error, event)
        {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);

///#source 1 1 Widgets/PeoplePage/peopleFAQ.js
var Widgets = Widgets || {};
(function ($)
{
    Widgets.peopleFAQ = {
        name: 'FAQ',
        log: true,
        configuration: {
            selectProperties: [
            "BAHFunctionalDescriptionOWSHTML",
            "BAHLongURLTitleOWSTEXT",
            "BAHResourceUrl",
            "BAHIconUrlOWSURLH",
            "BAHSortOrder",
            "BAHFunctionalFilter",
            "BAHWidget",
            "BAHFunctionalPageTitle",
            "BAHHeroPublishingImageOWSIMGE",
            "BAHHeroVideoEmbedOWSMTXT",
            "Url",
            "Title",
            "ContentType",
            "BAHSubTitleOWSTEXT",
            "BAHHeroDescriptionOWSHTML",
            "BAHHeroImageOWSHTML",
            "BAHHeroBylineOWSTEXT",
            "BAHSectionDescription5OWSHTML",
            "BAHSectionDescription6OWSHTML",
            "BAHSectionDescription7OWSHTML",
            "BAHSectionDescription8OWSHTML",
            "BAHSectionDescription9OWSHTML",
            "BAHSectionDescription10OWSHTML",
            "BAHSectionTitle1",
            "BAHSectionTitle2",
            "BAHSectionTitle3",
            "BAHSectionTitle4",
            "BAHSectionTitle5",
            "BAHSectionTitle6",
            "BAHSectionTitle7",
            "BAHSectionTitle8",
            "BAHSectionTitle9",
            "BAHSectionTitle10"
            ],
            query: '',
            contentTypes: ['Functional List', 'Functional Document', 'Functional Page'],
        },
        load: function (options)
        {
            var context = this;
            var displayCount = 5;
            var faqContent = {};
            var faqArray = { data: [], FaqTitle: '', FaqLink: '', FaqCount: '' };
            var faqCount = 0;

            var ID = $(context.container).attr('data-section');
            var sectionDesc = "BAHSectionDescription" + ID + "OWSHTML";
            var sectionTitle = "BAHSectionTitle" + ID;

            var template = Handlebars.compile($('#peopleFAQTemplate').html());
            var header = Widgets.genericHeader;
            $.when(header.promise, header.termPromise).done(function ()
            {
                var title = header.data.page[0] ? header.data.page[0][sectionTitle] : '';
                var download = header.data.customProperties.header['faqdownload'];

                faqArray.FaqTitle = title != null && title != undefined ? title : '';
                faqArray.FaqLink = download != null && download != undefined ? download : '';

                $.each(header.data.results, function (index, value)
                {
                    var contentFaq = {};
                    if (value.BAHWidget === faqArray.FaqTitle)
                    {
                        //if (++faqCount > 3) return; // exit function when maximum elements reached

                        var characterLimit = 255; // the maximum number of characters allowed for the trimmed faqTitle
                        var faqTitle = value.Title;
                        var faqTitleTrimmed = Bah.setEllipsis(faqTitle, characterLimit);
                        var faqDesc = value.BAHFunctionalDescriptionOWSHTML;

                        contentFaq.Id = ++faqCount;

                        if (faqCount <= displayCount)
                        {
                            contentFaq.Class = "accordion-navigation"; // expands accordion
                        }
                        else contentFaq.Class = "accordion-navigation faq-hide"; // contracts accordion
                        contentFaq.Title = faqTitle;
                        contentFaq.TitleTrimmed = faqTitleTrimmed;
                        contentFaq.Desc = faqDesc != null && faqDesc != undefined ? faqDesc : '';
                        faqArray.data.push(contentFaq); // add items to object array
                    }
                });

                if (faqCount <= displayCount)
                {
                    faqArray.FaqCount = faqCount;
                }
                else
                {
                    faqArray.FaqCount = displayCount;
                }

                faqContent.faqArray = faqArray;
                html = template(faqContent);
                $(context.container).html(html);

                if (faqCount <= displayCount)
                {
                    $('#peopleFaqLoadMore').css('display', 'none');
                }

                $(document).foundation(); // NECESSARY FOR ACCORDION
                //$('#arrow1').switchClass('fa-angle-down', 'fa-angle-up'); // Expands the first faq by default when page is loaded
            });
        },
        faqLoadMore: function ()
        {
            var displayCount = 5;
            var accordion = document.getElementById('faqAccordion');
            var faqs = accordion.getElementsByTagName('dd');
            var visibleCount = Number($('#faqList').attr('count')); // The current number of visible FAQs
            var faqLength = faqs.length; // The total number of FAQs
            var hiddenCount = faqLength - visibleCount; // the number of hidden FAQs
            var includeCount = hiddenCount < displayCount ? hiddenCount : displayCount;
            var addCount = visibleCount + includeCount;
            for (var i = visibleCount; i < addCount; i++)
            {
                $(faqs[i]).removeClass('faq-hide');
            }
            $('#faqList').attr('count', addCount);
            if (hiddenCount - includeCount == 0) $('#peopleFaqLoadMore').css('display', 'none');
        },
        changeAccordionArrow: function (id)
        {
            var arrow = $('#arrow' + id);
            var title = $('#faqTitle' + id);
            var trimmed = $('#faqTitleTrimmed' + id);
            var desc = $('#faqDesc' + id);
            var href = $('#faqHrefTitle' + id);

            if (arrow.hasClass('fa-angle-down'))
            {
                // This item is being expanded
                href.css('background-color', 'white');
                arrow.switchClass('fa-angle-down', 'fa-angle-up');
                title.css('display', 'block');
                trimmed.css('display', 'none');
                desc.switchClass('faq-desc-hide', 'faq-desc-show');
            }
            else
            {
                // This item is being collapsed
                href.css('background-color', '');
                arrow.switchClass('fa-angle-up', 'fa-angle-down');
                title.css('display', 'none');
                trimmed.css('display', 'block');
                desc.switchClass('faq-desc-show', 'faq-desc-hide');
            }

            var arrowCount = document.getElementById('faqAccordion').getElementsByTagName('i').length;

            // Now collapse all items except for the one selected
            for (var i = 1; i < arrowCount + 1; i++)
            {
                if (i != id)
                {
                    $('#faqHrefTitle' + i).css('background-color', '');
                    $('#arrow' + i).switchClass('fa-angle-up', 'fa-angle-down');
                    $('#faqTitle' + i).css('display', 'none');
                    $('#faqTitleTrimmed' + i).css('display', 'block');
                    desc.switchClass('faq-desc-show', 'faq-desc-hide');
                }
            }
        },
        fail: function (error, event)
        {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);

///#source 1 1 Widgets/PeoplePage/peopleResourcesForHR.js
var Widgets = Widgets || {};

(function ($) {
    var contentArrayHR = [];
    var contextHR;
    var pageEndHR = 0;
    var descHR;
    var titleHR; Widgets.peopleResourcesForHR = {
        name: 'People Resources For HR',
        log: true,
        load: function (options) {
            contextHR = this;
            var header = Widgets.genericHeader;
            $.when(header.promise).done(function () {
                var ID = $(contextHR.container).attr('data-section');
                var desc = "BAHSectionDescription" + ID + "OWSHTML";
                var title = "BAHSectionTitle" + ID;
                $.each(header.data.results, function (index, value) {
                    var contentBox = {};
                    contentBox.Title = value.Title;
                    if ((value.BAHWidget.indexOf('Resources for HR Business Partners') != -1) && (value.FileExtension != 'aspx' || value.BAHResourceUrl != "")) {
                        if (value.BAHResourceUrl == "") {
                            contentBox.Url = value.Url;
                        }
                        else {
                            contentBox.Url = value.BAHResourceUrl;
                        }
                        contentBox.DocType = value.FileExtension + ' / ' + parseInt(((value.Size)/1000)).toString().replace(/\B(?=(?:\d{3})+(?!\d))/g, ',')+" KB";
                        if (value.FileExtension == 'aspx') {
                            contentBox.DocType = value.FileExtension;
                        }
                        contentArrayHR.push(contentBox);
                    }
                    if (value.ContentType.indexOf('Functional Page') != -1) {
                        descHR = value[desc];
                        titleHR = value[title];
                    }
                });
                DisplayItHR();
            })
        },
        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }

    };

    DisplayItHR = function () {
        var template = Handlebars.compile($('#peopleResourcesForHRTemplate').html());
        var featuredContent = {};
        featuredContent.contentArray = [];
        featuredContent.Title = titleHR;
        featuredContent.Description = descHR;
        featuredContent.URLHost = "https://" + window.location.hostname + "/_layouts/images/";
        pageEndHR = pageEndHR + 6;
        featuredContent.ShowMore = true;
        if (pageEndHR >= contentArrayHR.length) {
            pageEndHR = contentArrayHR.length;
            featuredContent.ShowMore = false;
        }
        for (i = 0; i < pageEndHR; i++) {
            featuredContent.contentArray.push(contentArrayHR[i]);
        }
        if (contentArrayHR.length > 0) {
            html = template(featuredContent);
            $(contextHR.container).html(html);
        }
    }

    GoForwardHR = function() {
        DisplayItHR();
    }
})(jQuery);








///#source 1 1 Widgets/PeoplePage/peopleResourcesForPerformanceManagement.js
//var Widgets = Widgets || {};
//var contentArray = [];
//var MatchedContent = [];
//var context7;
//var pageStart = 0;
//(function ($) {
//    Widgets.peopleResourcesForPerformanceManagement = {
//        name: 'Resources For Performance Management',
//        log: true,
//        load: function (options) {
//            context7 = this;
//            var header = Widgets.genericHeader;
//            $.when(header.promise).done(function () {
//                var ID = $(context7.container).attr('data-section');
//                var desc = "BAHSectionDescription" + ID + "OWSHTML";
//                var title = "BAHSectionTitle" + ID;
//                //alert(desc);
//                //alert(title);

//                $.each(header.data.results, function (index, value) {
//                    var contentBox = {};
//                    if (value.BAHWidget === 'Resources for Performance Management') {
//                        contentBox.Title = value.Title;
//                        contentBox.Url = value.Url;
//                        contentBox.IconImage = GetDocIcon(value.FileExtension);
//                        contentBox.DocType = value.FileExtension;
//                        if (value.BAHFunctionalFilter == null) {
//                            contentBox.Filter = "";
//                        }
//                        else {
//                            contentBox.Filter = value.BAHFunctionalFilter.split(':').pop();
//                        }
//                        contentArray.push(contentBox);
//                    }
//                    if (value.ContentType.indexOf('Functional Page') != -1) {
//                        alert(value.BAHSectionTitle5);
//                    }
//                });
//                GetFilterMatched("All Employees");
//            })
//        },
//        fail: function (error, event) {
//            Bah.logging.error(event, this.name);
//        }
//   };

//})(jQuery);

//function DisplayIt(filter) {
//    var template = Handlebars.compile($('#peopleResourcesForPerformanceManagementTemplate').html());
//    var featuredContent = {};
//    featuredContent.contentArray = [];
//    featuredContent.ShowMore = true;
//    featuredContent.ShowLess = true;
//    featuredContent.ShowInfo = true;
//    var pageEnd = pageStart + 6;
//    if (pageEnd > MatchedContent.length) {
//        pageEnd = MatchedContent.length;
//        featuredContent.ShowMore = false;
//    }
//    if (pageStart == 0) {
//        featuredContent.ShowLess = false;
//    }
//    if (featuredContent.ShowLess == false && featuredContent.ShowMore == false) {
//        featuredContent.ShowInfo = false;
//    }
//    featuredContent.PageInfo = "Items " + (pageStart + 1).toString() + " - " + pageEnd.toString() + " of " + MatchedContent.length.toString();
//    for (i = pageStart; i < pageEnd; i++) {
//        featuredContent.contentArray.push(MatchedContent[i]);
//    }
//    html = template(featuredContent);
//    $(context7.container).html(html);
//    if (filter != "") {
//        document.getElementById("PeopleResourcesDDL").value = filter;
//    }
//}

//function GetDDLInfo() {
//    GetFilterMatched($('#PeopleResourcesDDL').val());
//}

//function GetFilterMatched(filter) {
//    pageStart = 0;
//    MatchedContent = [];
//    for (i = 0; i < contentArray.length; i++) {
//        if (contentArray[i]['Filter'] == filter) {
//            MatchedContent.push(contentArray[i]);
//        }
//    }
//    DisplayIt(filter);
//}

//function GoBack() {
//    pageStart = pageStart - 6;
//    if (pageStart < 0) {
//        pageStart = 0;
//    };
//    DisplayIt("");
//}

//function GoForward() {
//    pageStart = pageStart + 6;
//    DisplayIt("");
//}

//function GetDocIcon(fileext) {
//    var fileext3 = fileext.substr(0, 3);
//    var IconHash = {}; // New object
//    IconHash['doc'] = 'icdocx.png';
//    IconHash['xls'] = 'icxlsx.png';
//    IconHash['ppt'] = 'icpptx.png';
//    IconHash['pdf'] = 'icpdf.png';
//    IconHash['vsd'] = 'icvisiogeneric.png';
//    IconHash['one'] = 'icone.png';
//    if (fileext3 in IconHash) {
//        return IconHash[fileext3];
//    }
//    else {
//        return "folder.gif";
//    }

//}
///#source 1 1 Widgets/PeoplePage/peopleBreadcrumbs.js
var Widgets = Widgets || {};
(function ($) {
    Widgets.peopleBreadcrumbs = {
        name: 'Featured Content',
        log: true,
        load: function(options) {
            var featuredContent = {};
            var contentArray = [];
            var context = this;
            var header = Widgets.genericHeader;
            //var template = Handlebars.compile($('#peopleFeaturedContentTemplate').html());
            $.when(header.promise, header.termPromise).done(function() {
                var terms = header.data.termStore;
                var currentPage = header.data.configuration;
                
                for (var i = 0; i < terms.get_count(); i++) {
                    var spTerm = terms.getItemAtIndex(i);
                    if (spTerm.get_name() === currentPage) {
                        context.vm.push(spTerm.get_customProperties());
                        context.getParents(spTerm);
                    }
                    
                }
                context.vm.reverse();
                var template = Handlebars.compile($('#peopleBreadcrumbsTemplate').html());
                var html = template(context.vm);
                $(context.container).html(html);
            });
        },
        vm: [],
        getParents: function (term) {
            var context = this;
            var header = Widgets.genericHeader;
            if (!term.get_isRoot()) {
                var terms = header.data.termStore;
                var tmpTerm = term.get_parent();
                var currentPage = tmpTerm.get_name();
                if (currentPage !== "Pages") {
                    for (var i = 0; i < terms.get_count(); i++) {
                        var spTerm = terms.getItemAtIndex(i);
                        if (spTerm.get_name() === currentPage) {
                            context.vm.push(spTerm.get_customProperties());
                            context.getParents(spTerm);
                        }
                    }
                }
            }
        },
        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);
///#source 1 1 Widgets/PeoplePage/peopleVideos.js
var Widgets = Widgets || {};
(function ($) {
    Widgets.peopleVideo = {
        log: true,
        configuration: {
            selectProperties: [
            "Title",
            "BAHWidget",
            "BAHHeroVideoEmbedOWSMTXT",
            "BAHIconUrlOWSURLH",
            "BAHFunctionalDescriptionOWSHTML",
            ],
            query: '',
            contentTypes: ['Functional List'],
        },
        myContext: { vm: [], widgetTitle: '', isMobile:false, totalResults: 0, currentIndex:0 },
        load: function (options) {
            var context = this;
            var header = Widgets.genericHeader;
            $.when(header.promise).done(function () {
                $.each(header.data.results, function (key, val) {
                    if (val.BAHWidget === 'Videos') {
                        var vm = {
                            id: 0,
                            videoTitle: Bah.setEllipsis(val.Title, 30),
                            videoEmbed: $(val.BAHHeroVideoEmbedOWSMTXT).attr('src'),
                            videoIcon: val.BAHIconUrlOWSURLH.split(',')[0],
                            videoDescription: Bah.setEllipsis($(val.BAHFunctionalDescriptionOWSHTML).text(), 75),
                            activeVideo: false
                        };
                        context.myContext.vm.push(vm);
                    }
                });
                //context.testvm();
                for (i = 0; i < context.myContext.vm.length; i++) {
                    context.myContext.vm[i].id = i;
                    i === 0 ? context.myContext.vm[i].activeVideo = true : context.myContext.vm[i].activeVideo = false;
                }
                var ID = $(context.container).attr('data-section');
                var sectionTitle = "BAHSectionTitle" + ID;
                header.data.page[0] ? context.myContext.widgetTitle = header.data.page[0][sectionTitle] : context.myContext.widgetTitle = "";
                context.myContext.vm.length ? context.myContext.totalResults = context.myContext.vm.length : context.myContext.totalResults = 0;
                context.setThumbnails();
            }); //End Promise
        },
        setThumbnails: function () {
            var context = this;
            var override = parseInt($(context.container).attr('data-thumbnails'));
            if (Bah.isMobile.any() || override <= context.myContext.vm.length) {
                context.myContext.isMobile = true;
                if (Bah.isMobile.any()) {
                    context.myContext.isMobile ? context.myContext.currentIndex = 3 : context.myContext.currentIndex = context.myContext.vm.length;
                } else {
                    context.myContext.isMobile ? context.myContext.currentIndex = override : context.myContext.currentIndex = context.myContext.vm.length;
                }
                
            } else {
                context.myContext.currentIndex = context.myContext.vm.length;
            }
            context.compileHtml();
        },
        mobileLoadMore: function () {
            var context = this;
            context.myContext.currentIndex = context.myContext.currentIndex + 3;
            context.compileHtml();
        },
        selectVideo: function (index) {
            var context = this;
            for (i = 0; i < context.myContext.vm.length; i++) {
                context.myContext.vm[i].id === index ? context.myContext.vm[i].activeVideo = true : context.myContext.vm[i].activeVideo = false;
            }
            context.compileHtml();
        },
        compileHtml: function (input) {
            var context = this;
            var template = Handlebars.compile($("#peopleVideoTemplate").html());
            var html = template(context.myContext);
            $(context.container).html(html);
        },
        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        },
        testvm: function () {
            var context = this;
            if (context.myContext.vm.length < 6) {
                for (var i = 2; i < 8; i++) {
                    var vm = {
                        id: 0,
                        videoTitle: '',
                        videoEmbed: '',
                        videoIcon: '',
                        videoDescription: '',
                        activeVideo: false
                    };
                    vm.id = i;
                    vm.videoTitle = Bah.setEllipsis("Video Title " + i +" making this title really long to see if it cuts off properly", 30);
                    i === 0 ? vm.videoEmbed = "https://www.youtube.com/embed/3eVF9uBbuqc" : vm.videoEmbed = "https://www.youtube.com/embed/76y3QDeMm3o"
                    vm.videoIcon = "https://thethemefoundry.com/wp-content/themes/ttf-reloaded/images/single-theme/video-thumbnail.png";
                    vm.videoDescription = Bah.setEllipsis("This is video description " + i + " Let make this supper super long so it has to be ellipsis function processed blah blah blah lets make this even longer cause its not 150 characters!!!!", 75);
                    i === 0 ? vm.activeVideo = true : vm.activeVideo = false;
                    context.myContext.vm.push(vm)
                }
                context.myContext.widgetTitle = "Video Widget";
                context.myContext.vm.length ? context.myContext.totalResults = context.myContext.vm.length : context.myContext.totalResults = 0;
            }
        }
    };
})(jQuery);
///#source 1 1 Widgets/PeoplePage/peopleResources.js
var Widgets = Widgets || {};
(function ($) {

    Widgets.peopleResources = {         
        log: true,
        configuration: {
            selectProperties: [
            "BAHFunctionalDescriptionOWSHTML",
            "BAHLongURLTitleOWSTEXT",
            "BAHResourceUrl",
            "BAHIconUrlOWSURLH",
            "BAHSortOrder",
            "BAHFunctionalFilter",
            "BAHWidget",
            "BAHFunctionalPageTitle",
            "BAHHeroPublishingImageOWSIMGE",
            "BAHHeroVideoEmbedOWSMTXT",
            "Url",
            "Title",
            "ContentType",
            "BAHSubTitleOWSTEXT",
            "BAHHeroDescriptionOWSHTML",
            "BAHHeroImageOWSHTML",
            "BAHHeroBylineOWSTEXT",
            "BAHSectionDescription5OWSHTML",
            "BAHSectionDescription6OWSHTML",
            "BAHSectionDescription7OWSHTML",
            "BAHSectionDescription8OWSHTML",
            "BAHSectionDescription9OWSHTML",
            "BAHSectionDescription10OWSHTML",
            "BAHSectionTitle1",
            "BAHSectionTitle2",
            "BAHSectionTitle3",
            "BAHSectionTitle4",
            "BAHSectionTitle5",
            "BAHSectionTitle6",
            "BAHSectionTitle7",
            "BAHSectionTitle8",
            "BAHSectionTitle9",
            "BAHSectionTitle10"
            ],
            query: '',
            contentTypes: ['Functional List', 'Functional Document', 'Functional Page'],
        },
        load: function (options) {
            var context = this;
            var container = context.container;
            var data = {};
            data.widgetID = $(container).attr('data-section');
            data.maxTiles = $(container).attr('data-maxTiles');
            data.widgetTitle = null;
            data.widgetDescription = null;
            data.sections = null; 
            data.widgetCollapse = null;
            data.widgetCollapseTarget = null;
            data.widgetHeading = 'heading-main';
            var config = $(container).attr('data-configuration');
            var collapse = $(container).attr('data-collapse');            
            var desc = "BAHSectionDescription" + data.widgetID + "OWSHTML";
            var template = Handlebars.compile($('#peopleResourcesTemplate').html());
            var title = "BAHSectionTitle" + data.widgetID;

            if ($(container).attr('data-displayTiles') == "false"){
                data.displayTiles = false;
            } else {
                data.displayTiles = true;
            }
            var header = Widgets.genericHeader;
            $.when(header.promise, header.termPromise).done(function () {
                //build out the resource widget in sections / panels / items
                data.sections = context.buildWidget(config, data.displayTiles);

                $.each(header.data.page, function (key, item) {
                        data.widgetTitle = item[title];
                        data.widgetDescription = item[desc];
                });

                //add collapse to widget in mobile view if this instance appears on right column in desktop view
                if (collapse == 'true') {
                    data.widgetHeading = 'heading-main accord-btn';
                    data.widgetCollapse = 'data-toggle=collapse data-target=.peopleResources' + data.widgetID + '-drop';
                    data.widgetCollapseTarget = ' accord-content peopleResources' + data.widgetID + '-drop collapse';
                }

                html = template(data);
                $(container).html(html);

                if ((data.sections.length > 0) && (data.displayTiles)) {
                    //build out the carousel functionality for panels
                    $.each(data.sections, function (sectionIndex, section) {
                        $.each(section.panels, function (panelIndex, panel) {

                            var $owl = $("#owl-slider-Widget" + data.widgetID + '-Section' + section.sectionID + "-Panel" + panel.panelID);
                            var displayNumTiles = 3;
                            if (data.maxTiles == 1) {
                                displayNumTiles = 1; //if maxtiles = 1, then override the value for itemsDesktopSmall
                            }
                             $owl.owlCarousel({
                                paginationNumbers: false,
                                navigation: true,
                                autoPlay: false,
                                slideSpeed: 300,
                                paginationSpeed: 400,
                                singleItem: false,
                                items: data.maxTiles,
                                itemsCustom: [[0, 1], [400, 2], [743, displayNumTiles], [1024, data.maxTiles], [1280, data.maxTiles], [1600, data.maxTiles]],
                                singleItem: false,
                                itemsScaleUp: false,
                                rewindNav: false
                            });

                            //move the controls so we can style them the way we want
                            var ctrls = $owl.find('.owl-controls').detach();
                            ctrls.appendTo($owl.closest('article').parent());                           
                        });
                    });
                }

                //determine if we need the icon to be plus or minus based on child content attrs
                //on load first should be active, may not though, so use active class
                var activeAccordion = $('.tileSectionContainer').find('dd div.active');
                if (activeAccordion) {
                    $('.tileSectionContainer').find('dd div.active').parent().addClass('active');
                } else {
                    $('.tileSectionContainer').find('dd').first().addClass('active');
                }

                $(document).foundation();                                           // Required for accordion to function                                
            });
        },

        buildWidget: function (config, displayTiles) {
            var items = [];
            var panels = [];
            var sections = [];

            if (displayTiles) {
                items = Widgets.peopleResources.buildTiles(config);
            } else {
                items = Widgets.peopleResources.buildTableRow(config);
            }

            if (items.length > 0) {
                panels = Widgets.peopleResources.buildPanels(items);
                sections = Widgets.peopleResources.buildSections(panels);
            }
            return sections;
        },

        buildTiles: function (widgetName) {
            var items = [];
            var header = Widgets.genericHeader;
            $.each(header.data.results, function (index, value)
            {
                var filter = (value["BAHFunctionalFilter"]) ? value["BAHFunctionalFilter"] : null;

                // if this data belongs in the widget on this page 
                if ( value["BAHWidget"].indexOf(widgetName) > -1 && filter && filter.indexOf(widgetName) > -1 ) {    
                    var footer = null;
                    var link = null;
                    var icon = "<i class='fa fa-file right'></i>";                                  //default icon
                    var linkClass = "tile-link";

                    filter = Widgets.peopleResources.parseFilter(value["BAHFunctionalFilter"], widgetName);

                    // if the filter doesn't contain multiple sections and panels then set it to null
                    if (Widgets.peopleResources.getFilterDepth(filter) < 2)  
                        filter = null;

                    if (value["ContentType"].indexOf("Functional Document") > -1) {
                        var fileType = value["FileExtension"] ? value["FileExtension"] : null;
                        footer = "Download";
                        link = value["Url"];

                        // if fileType is doc, xls, docs, pdf, etc.
                        if (fileType && Bah.getIcon(fileType)) {
                            icon = "<img src='" + Bah.getIcon(fileType) + "' alt='" + fileType.toString() + "' />";
                        }                       
                    }

                    if (value["ContentType"].indexOf("Functional List") > -1) {
                        footer = "";
                        icon = "<i class='fa fa-external-link-square right'></i>";
                        link = value["BAHResourceUrl"];
                    }

                    // check if link is empty, if so, assign the "no hand" class to the link
                    if (!link) {
                        linkClass = "tile-no-link";
                        link = "#";
                        icon = "";
                    }

                    // create the tile item
                    var tile = {
                        item: {
                            title: Bah.setEllipsis(value["Title"], 48),     //TODO:  should character max length be dynamic?
                            hoverTitle: value["Title"],
                            link: link,
                            filter: filter,
                            footerText: footer,
                            icon: icon,
                            linkClass: linkClass
                        }
                    };
                    items.push(tile);
                }
            });
            return items;
        },

        buildTableRow: function (widgetName) {
            var items = [];
            var header = Widgets.genericHeader;
            $.each(header.data.results, function (index, value) {
                var filter = (value["BAHFunctionalFilter"]) ? value["BAHFunctionalFilter"] : null;
                var link = null;

                // if this data belongs in the widget on this page 
                if ( value["BAHWidget"].indexOf(widgetName) > -1 && filter && filter.indexOf(widgetName) > -1 ) {    

                filter = Widgets.peopleResources.parseFilter(value["BAHFunctionalFilter"], widgetName);

                // if the filter doesn't contain multiple sections and panels then set it to null
                if (Widgets.peopleResources.getFilterDepth(filter) < 2)
                    filter = null;
       
                if (value["ContentType"].indexOf("Functional List") > -1) {
                    link = value["BAHResourceUrl"].length > 0 ? value["BAHResourceUrl"] : null;
                }
                else if (value["ContentType"].indexOf("Functional Document") > -1) {
                    link = value["Url"];
                }
                    
                var row = {
                    item: {
                        title: Bah.setEllipsis(value["Title"], 48),                                    //TODO:  should character max length be dynamic?
                        hoverTitle: value["Title"],
                        filter: filter,
                        description: $(value["BAHFunctionalDescriptionOWSHTML"]).text(),
                        link: link
                    }
                };
                items.push(row);
            };
        });
            return items;
     },

        buildPanels: function (items) {
            // a panel is representative a set of items with same filter
            // a panel could be a slider if enough items exist
            // a panel assumes a filter depth of at least 3 colons [Filters:WidgetName:Accordion:Slider / Filters:WidgetName:Section:Panel]
            var panels = [];
            var result = Widgets.peopleResources.groupBy(items, function (value) {              //group the items by filter
                return [value.item.filter];
            });
            var header = Widgets.genericHeader;
            $.each(result, function (index, value) {
                var displayName = false;
                var sorted = false;
                var sortOrder = [];
                var panelName = null;
                var panelParent = null;
                var sortOrderIndex = null;
                var termID = null;
                var filter = (value[0].item.filter) ? value[0].item.filter : null;
               
                if (filter != null) {                                                                                         
                    if (Widgets.peopleResources.getFilterDepth(filter) === 3) {                // find how many levels the filter contains                                                           //parse out the panel name from the filter if 
                        exp = /[^:]*$/igm;                                                      // it is a valid filter of 3 levels deep --> Widget:Section:Panel
                        panelName = filter.match(exp)[0];
                        filter = filter.substring(0, filter.lastIndexOf(":" + panelName));
                        displayName = true;                                                     // the panel name should be displayed 
                        var foundTerm = false;                                                  // ini found in term store
                        var panelFilter = value[0].item.filter.replace(/:/g, ';');              // ini filter to match in term store using semicolons instead of colons

                        for (var i = 0; ((i < header.data.termStore.get_count()) && (foundTerm === false)) ; i++) {        // for each item found in the term store
                            var spTerm = header.data.termStore.getItemAtIndex(i);
                            if (spTerm.get_pathOfTerm() === panelFilter) {
                                termID = spTerm.get_id();                                       // get the id of the term 
                                foundTerm = true;

                                if (sorted === false) {                                         // sort info not yet set for panels and only required once per panel                                                                  
                                    panelParent = spTerm.get_parent();                          // get term parent of the panel where sort is stored
                                    var temp = panelParent.get_customSortOrder();               //TODO:  Refactor for cases where custom order is not set and this condition doesn't get checked numerous times unnecessarily 
                                    if (temp)                                                   // custom sort order may not exist because not configured for term 
                                        sortOrder = temp.split(':');                            // create the sort array of term ids in sorted order
                                    if (sortOrder.length > 0)                                   // if more than one item is in sort array then items need to be sorted
                                        sorted = true;
                                }   
                            }
                        }
                        if (sorted)
                            sortOrderIndex = sortOrder.indexOf(termID.toString());              // if sorted then find this panels sort index
                    }
                }

                var item = {                                        // set the panel object
                    panelID: index,                                 // this will be overwritten in buildSections because section grouping is unknown at this point
                    panelName: panelName,                           // set the name based on the filter
                    sortOrderIndex: sortOrderIndex,                 // set sort order
                    filter: filter,                                 // the filter for the panel slider (not tile)
                    displayName: displayName,                       // whether to display the name of panel based on if it is from filter
                    items: value                                    // the grouped items based on filter for the panel
                }
                    panels.push(item);                              // order doesn't matter at this point of building the widget
            });
            return panels;                                          // returning unsorted panels
        },

        buildSections: function (panels) {
            // a section is representative of a set of panels with same filter
            // a section could be an accordion if more than one section exists
            var regex = new RegExp("[^:]+$");
            var sectionParent = null;
            var sections = [];
            var sorted = false;
            var sortOrder = [];

            var sectionResult = Widgets.peopleResources.groupBy(panels, function (value) {
                return [value.filter];
            });

            $.each(sectionResult, function (index, value) {
                var displayName = false;
                var filter = value[0].filter;
                var sectionName = null;
                var sectionDescription = null;
                var sortOrderIndex = null;
                var termID = null;
                var leftColumnHeading = null;
                var rightColumnHeading = null;
                var displayContent = "content";

                if (filter != null) {                                                          // if the section filter is not null
                    sectionName = regex.exec(value[0].filter)[0];                              // set name of the section found in filter
                    displayName = true;                                                        // display the section name on the widget because valid name found in filter
                    var filterPath = filter.replace(/:/g, ';');                                // copy of filter with Term Store format
                    filter = filter.substring(0, filter.lastIndexOf(":" + sectionName));       // filter for the section
                    var foundTerm = false;
                    var header = Widgets.genericHeader;
                    for (var i = 0; i < header.data.termStore.get_count() && foundTerm === false; i++) {        // for each item found in the term store
                        var spTerm = header.data.termStore.getItemAtIndex(i);                                   // if the term name is the same as section name
                        if (spTerm.get_pathOfTerm() === filterPath) {
                            foundTerm = true;
                            sectionDescription = spTerm.get_customProperties().Description;             // set the section description
                            leftColumnHeading = spTerm.get_customProperties().LeftColumnHeading;        // if table view, get the left column title
                            rightColumnHeading = spTerm.get_customProperties().RightColumnHeading;      // if table view, get the right column title
                            termID = spTerm.get_id();

                            if (sorted === false)                                                       // if it's the first section and sort info not yet set
                            {                                                                           // only required to be executed once per Widget
                                sectionParent = spTerm.get_parent();                                    // get the term set parent of the section where sort is stored
                                var temp = sectionParent.get_customSortOrder();                         // custom sort order may not exist because not added
                                if (temp)                                                               //TODO:  Refactor for cases where custom order is not set and this condition doesn't get checked numerous times unnecessarily 
                                    sortOrder = temp.split(':');                                        // create the sort array of term ids in sorted order
                                if (sortOrder.length > 0)                                               // if more than one item is in sort array then items need to be sorted
                                    sorted = true;
                            }
                        }
                    }

                    if (sorted)
                        sortOrderIndex = sortOrder.indexOf(termID.toString());                          // if sorted then find this sections sort index
                }

                // if this is the first section on load, then required to display content, else section accordion is collapsed
                if ((sortOrderIndex == 0 && sorted) || (index == 0 && !sorted))
                    displayContent = "content active";

                // set the Panel ID by section now that the number of panel groupings by section are available 
                $.each(value, function (id, panel) {
                    panel.panelID = id;
                    if (!panel.displayName)
                        panel.panelName =  "Panel" + id;
                });                

                var item = {                                        //set the section object
                    sectionID: index,
                    sectionName: (sectionName) ? sectionName : "Section" + index,
                    sectionDescription: sectionDescription ? sectionDescription : null,
                    sortOrderIndex: sortOrderIndex,
                    filter: filter,
                    panels: value,
                    displayContent: displayContent,
                    displayName: displayName,
                    leftColumnHeading: leftColumnHeading ? leftColumnHeading : "Title",
                    rightColumnHeading: rightColumnHeading ? rightColumnHeading : "Description",
                }
                    sections.push(item);                           
            });

            if (sorted) {                                               //order matters, sort sections
                sections.sort(function (a, b) {
                    return a.sortOrderIndex - b.sortOrderIndex
                });
            }

            $.each(sections, function (index, value) {                  //order matters, sort panels
                value.panels.sort(function (a, b) {
                    return a.sortOrderIndex - b.sortOrderIndex
                });
            });

            return sections;
        },

        parseFilter: function (value, widgetName) {
            //returns the filter that is specific to the widget since the filter value could contain multiple filters
            var filter = value ? value : null;
            var startIndex;

            if (filter) {
                startIndex = filter.indexOf(widgetName);
                filter = filter.replace(/[\n\r]/g, '|');
            }

            if (startIndex > -1) {
                filter = "Filters:" + filter.substring(startIndex);
                var endIndex = filter.indexOf("|");
                if (endIndex > -1)
                    filter = filter.slice(0, endIndex);
            }
            return filter;
        },

        getFilterDepth: function (filter) {
            //returns the number of colons found in the filter to represent depth 
            //expects input of Filter:Widget:Accordion:Panel
            var exp = /:/igm;
            var depth = filter.match(exp);
            depth = (depth) ? depth.length : 0;
            return depth;
        },

        groupBy:  function (array, fn) {
            var groups = {};
            array.forEach(function (value) {
                var group = JSON.stringify(fn(value));          // get the filter group  from the object
                groups[group] = groups[group] || [];            // if array does not exist for group, create new
                groups[group].push(value);                      // push the item onto groups array
            });
            return Object.keys(groups).map(function (group) {
                return groups[group];
            })
        },

        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };

})(jQuery);



///#source 1 1 Widgets/PeoplePage/peopleGuides.js
var Widgets = Widgets || {};

(function ($) {
    var contentArray = [];
    var MatchedContent = [];
    var context;
    var pageEnd = 0;
    var descGuide;
    var titleGuide;
    var PickedFilter;
    var DDLValues = [];
    Widgets.peopleGuides = {
        name: 'Staff Development Guides',
        log: true,
        load: function (options) {
            context = this;
            var header = Widgets.genericHeader;
            $.when(header.promise).done(function () {
                var ID = $(context.container).attr('data-section');
                var desc = "BAHSectionDescription" + ID + "OWSHTML";
                var title = "BAHSectionTitle" + ID;
                $.each(header.data.results, function (index, value) {
                    var contentBox = {};
                    contentBox.Title = value.Title;
                    if ((value.BAHWidget.indexOf('Resources for Staff Development Guides') != -1) && (value.FileExtension != 'aspx' || value.BAHResourceUrl != "")) {
                        if (value.BAHResourceUrl == "") {
                            contentBox.Url = value.Url;
                        }
                        else {
                            contentBox.Url = value.BAHResourceUrl;
                        }
                        contentBox.DocType = value.FileExtension + ' / ' + parseInt(((value.Size) / 1000)).toString().replace(/\B(?=(?:\d{3})+(?!\d))/g, ',') + " KB";
                        if (value.FileExtension == 'aspx') {
                            contentBox.DocType = value.FileExtension;
                        }
                        if (value.BAHFunctionalFilter == null) {
                            contentBox.Filter = "";
                        }
                        else {
                            contentBox.Filter = value.BAHFunctionalFilter.split(':').pop();
                        }
                        contentArray.push(contentBox);
                    }
                    if (value.ContentType.indexOf('Functional Page') != -1) {
                        descGuide = value[desc];
                        titleGuide = value[title];
                    }
                });
                var terms = header.data.termStore;
                for (var i = 0; i < terms.get_count() ; i++) {
                    var spTerm = terms.getItemAtIndex(i);
                    if (!spTerm.get_isRoot() && spTerm.get_parent().get_name() == 'Staff Development Guides') {
                        DDLValues.push(spTerm.get_name());

                        var customProperties = spTerm.get_customProperties();
                        var sDefault = (customProperties['default'] || '').toString();
                        if (sDefault.toLowerCase() == 'yes')
                            PickedFilter = spTerm.get_name();
                    }
                }
                GetFilterMatched();
            })
         },
        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }

    };

    DisplayIt = function () {
        var template = Handlebars.compile($('#peopleGuidesTemplate').html());
        var featuredContent = {};
        featuredContent.contentArray = [];
        featuredContent.DDL = [];
        for (var i = 0; i < DDLValues.length; i++) {
            featuredContent.DDL.push(DDLValues[i]);
        }
        featuredContent.Title = titleGuide;
        featuredContent.Description = descGuide;
        pageEnd = pageEnd + 6;
        featuredContent.ShowMore = true;
        if (pageEnd >= MatchedContent.length) {
            pageEnd = MatchedContent.length;
            featuredContent.ShowMore = false;
        }
        for (i = 0; i < pageEnd; i++) {
            featuredContent.contentArray.push(MatchedContent[i]);
        }
        html = template(featuredContent);
        $(context.container).html(html);
        if (PickedFilter != "") {
            document.getElementById("PeopleGuidesDDL").value = PickedFilter;
        }
    }

    GoForward = function () {
        DisplayIt();
    }

    GetDDLInfo = function() {
        PickedFilter = $('#PeopleGuidesDDL').val();
        GetFilterMatched();
    }

    GetFilterMatched = function() {
        pageEnd=0;
        MatchedContent = [];
        for (i = 0; i < contentArray.length; i++) {
            if (contentArray[i]['Filter'] == PickedFilter) {
                MatchedContent.push(contentArray[i]);
            }
        }
        DisplayIt();
    }
})(jQuery);








///#source 1 1 Widgets/TotalRewards/totalRewardsHeader.js
var Widgets = Widgets || {};
(function ($) {
    Widgets.totalRewardsHeader = {
        name: 'People Header',
        log: true,
        promise: new $.Deferred(),
        termPromise: new $.Deferred(),
        selectProperties: [
            "BAHFunctionalDescriptionOWSHTML",
            "BAHLongURLTitleOWSTEXT",
            "BAHResourceUrl",
            "BAHIconUrlOWSURLH",
            "BAHSortOrder",
            "BAHFunctionalFilter",
            "BAHWidget",
            "BAHFunctionalPageTitle",
            "BAHHeroPublishingImageOWSIMGE",
            "BAHHeroVideoEmbedOWSMTXT",
            "Url",
            "Title",
            "ContentType",
            "BAHSubTitleOWSTEXT",
            "BAHHeroDescriptionOWSHTML",
            "BAHHeroImageOWSHTML",
            "BAHHeroBylineOWSTEXT",
            "BAHSectionDescription5OWSHTML",
            "BAHSectionDescription6OWSHTML",
            "BAHSectionDescription7OWSHTML",
            "BAHSectionDescription8OWSHTML",
            "BAHSectionDescription9OWSHTML",
            "BAHSectionDescription10OWSHTML",
            "BAHSectionTitle1",
            "BAHSectionTitle2",
            "BAHSectionTitle3",
            "BAHSectionTitle4",
            "BAHSectionTitle5",
            "BAHSectionTitle6",
            "BAHSectionTitle7",
            "BAHSectionTitle8",
            "BAHSectionTitle9",
            "BAHSectionTitle10"
        ],
        data: {
            configuration: '',
            customProperties: {
                connect: { email: [], groupEmail: [], groupHeader: [], groupYammer: [], phone: [], yammerLink: [] },
                header: [],
            },
            results: [],
            page: [],
            termStore: [],
            headerData: { name: '', tagColor: '', subTitle:'' }
        },
        currentIndex: 0,
        totalResults: 0,
        initialResultsAmount: 50,
        fetchTermStore: function () {
            var getTermsDeferred = function (termSetName) {
                var deferred = $.Deferred();
                var locale = 1033; //English
                var clientContext = SP.ClientContext.get_current();
                var taxonomySession = SP.Taxonomy.TaxonomySession.getTaxonomySession(clientContext);
                var termStore = taxonomySession.getDefaultSiteCollectionTermStore();
                var termSets = termStore.getTermSetsByName(termSetName, locale);
                var termSet = termSets.getByName(termSetName);
                var terms = termSet.getAllTerms();
                clientContext.load(taxonomySession);
                clientContext.load(termStore);
                clientContext.load(termSet);
                clientContext.load(terms, 'Include(IsRoot, Labels, TermsCount, Id, IsAvailableForTagging, Name, PathOfTerm, Parent, TermSet.Name, LocalCustomProperties, CustomProperties, Parent.Name)');
                clientContext.executeQueryAsync(Function.createDelegate(this, function () { deferred.resolve(terms); }),
                    Function.createDelegate(this, function (sender, args) { deferred.reject(sender, args); }));
                return deferred.promise();
            };
            return getTermsDeferred("Total Rewards");
        },
        setTermset: function () {
            var context = this;
            $.when(context.fetchTermStore()).done(function (terms) {
                context.data.termStore = terms;
                for (var i = 0; i < terms.get_count() ; i++) {
                    var spTerm = terms.getItemAtIndex(i);
                    if (spTerm.get_name() === "email") context.data.customProperties.connect.email = spTerm.get_customProperties();
                    if (spTerm.get_name() === "groupemail") context.data.customProperties.connect.groupEmail = spTerm.get_customProperties();
                    if (spTerm.get_name() === "groupheader") context.data.customProperties.connect.groupHeader = spTerm.get_customProperties();
                    if (spTerm.get_name() === "groupyammer") context.data.customProperties.connect.groupYammer = spTerm.get_customProperties();
                    if (spTerm.get_name() === "phone") context.data.customProperties.connect.phone = spTerm.get_customProperties();
                    if (spTerm.get_name() === "yammerlink") context.data.customProperties.connect.yammerLink = spTerm.get_customProperties();
                    if (spTerm.get_name() === "Configuration") context.data.customProperties.header = spTerm.get_customProperties();
                }
                context.data.headerData.tagColor = context.data.customProperties.header['bannercolor'];
                context.termPromise.resolve();
            });
        },
        load: function (options) {
            $('html').addClass('bah-people-page');
            var context = this;
            context.setTermset();
            var widgetConfiguration = $(context.container).attr('data-configuration') || "";
            var queryParams = "(BAHFunctionalPageTitle=\"" + widgetConfiguration + "\" AND ContentType:\"Functional List\") OR (BAHFunctionalPageTitle=\"" + widgetConfiguration + "\" AND ContentType:\"Functional Document\") OR (BAHFunctionalPageTitle=\"" + widgetConfiguration + "\" AND ContentType:\"Functional Page\")";
            widgetConfiguration !== "" ? context.setResults(widgetConfiguration, queryParams, context.currentIndex) : console.log("People Header is missing data-configuration parameter");
        },
        constructQuery: function (parameter, startPosition) {
            var context = this;
            var deferred = $.Deferred();
            SP.SOD.executeFunc("SP.js", "SP.ClientContext", function () {
                SP.SOD.executeFunc("SP.Search.js", "Microsoft.SharePoint.Client.Search.Query.KeywordQuery", function () {
                    var sContext = SP.ClientContext.get_current();
                    var keywordQuery = new Microsoft.SharePoint.Client.Search.Query.KeywordQuery(sContext);
                    keywordQuery.set_trimDuplicates(false);
                    keywordQuery.set_rowLimit(context.initialResultsAmount);
                    keywordQuery.set_startRow(startPosition);
                    var properties = keywordQuery.get_selectProperties();
                    $.each(context.selectProperties, function (key, widgetConfiguration) {
                        properties.add(widgetConfiguration);
                    });
                    // Sorting (Ascending = 0, Descending = 1)
                    keywordQuery.set_enableSorting(true);
                    var sortproperties = keywordQuery.get_sortList();
                    sortproperties.add("BAHWidget", 0);
                    sortproperties.add("BAHSortOrder", 0);
                    var queryText = parameter;
                    keywordQuery.set_queryText(queryText);
                    var searchExecutor = new Microsoft.SharePoint.Client.Search.Query.SearchExecutor(sContext);
                    results = searchExecutor.executeQuery(keywordQuery);
                    sContext.executeQueryAsync(
                        function () {
                            deferred.resolve(results);
                        },
                        function (err) {
                            deferred.reject(null);
                        }
                    );
                });
            });
            return deferred.promise();
        },
        setResults: function (configuration, parameter, startPosition) {
            var context = this;
            context.data.headerData.name = configuration;
            context.data.configuration = configuration;
            context.compileHtml(context.data.headerData);
            $.when(context.constructQuery(parameter, startPosition)).done(function (data) {
                if (data.m_value !== undefined && data.m_value.ResultTables[0].TotalRows !== 0) {
                    context.totalResults = data.m_value.ResultTables[0].TotalRows;
                    var results = data.m_value.ResultTables[0].ResultRows;
                    context.data.results = results.length > 0 ? results : null;
                    if (context.totalResults > context.initialResultsAmount) {
                        context.currentIndex = context.currentIndex + context.initialResultsAmount;
                        context.loadMore(parameter, context.currentIndex);
                    } else {
                        context.extractPageData();
                        context.promise.resolve();
                    }
                } else {
                    console.log("Verify data for configuration: '" + configuration + "' has data.");
                }
            });
        },
        extractPageData: function () {
            var context = this;
            $.each(context.data.results, function (key, val) {
                $.each(val, function (key2, val2) {
                    if (key2 === "ContentType") {
                        if (val2.indexOf("Functional Page") > -1) {
                            context.data.page.push(val);
                            context.data.headerData.name = val.Title;
                            context.data.headerData.subTitle = val.BAHSubTitleOWSTEXT;
                        }
                    }
                });
            });
            if (context.data.page.length === 0) console.log("No page data has been indexed by search for this page");
        },
        compileHtml: function (model) {
            var context = this;
            $.when(context.promise, context.termPromise).done(function () {
                var template = Handlebars.compile($('#totalRewardsHeaderTemplate').html());
                var html = template(model);
                $(context.container).html(html);
            });
        },
        loadMore: function (parameter, startPosition) {
            var context = this;
            $.when(context.constructQuery(parameter, startPosition)).done(function (data) {
                if (data.m_value !== undefined) {
                    var results = data.m_value.ResultTables[0].ResultRows;
                    if (results.length > 0) {
                        $.each(results, function (key, val) {
                            context.data.results.push(val);
                        });
                    }
                    context.currentIndex = context.currentIndex + results.length;
                    if (context.currentIndex < context.totalResults) {
                        context.loadMore(parameter, context.currentIndex);
                    }
                    else {
                        context.extractPageData();
                        context.promise.resolve();
                    }
                }
            });
        },
        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery); 
///#source 1 1 Widgets/TotalRewards/totalMessage.js
var Widgets = Widgets || {};

(function ($) {
    Widgets.totalMessage = {
        name: 'Total Message',
        log: true,
        getTotalMessage: function () {
            var url = _spPageContextInfo.webAbsoluteUrl;//Bah.configuration.rootSiteCollectionUrl + Widgets.totalRewardsHeader.data.customProperties.header.cmslocation;
            var queryUrl = url + "/_api/web/lists/GetByTitle('Important Messages')/items?$select=Title,Body&$filter=BAH_NewsArticleFeatured%20eq%201&$orderby=Created desc&$top=1";

            return $.ajax({
                async: true,
                url: queryUrl,
                type: "GET",
                headers: { "Accept": "application/json; odata=verbose" },
                cache: false
            });
        },

         load: function (options) {
            var html;
            var template = Handlebars.compile($('#totalMessageTemplate').html());

            var titleLimit = 128;
            var viewModel =
                {
                    isDisplay: false,
                    message: []
                };
            var header = Widgets.genericHeader;
            var self = this;
            $.when(header.promise, header.termPromise).done(function () {
                $.when(self.getTotalMessage()).done(function (data) { // retrieve group articles 
                    if (data.d !== undefined) {
                        var results = data.d.results;

                        if (results.length > 0) {
                            var Title_trim = Bah.setEllipsis(results[0].Title, titleLimit);
                            viewModel.isDisplay = true;
                            var item = {
                                title: Title_trim,
                                body: results[0].Body
                            }
                            viewModel.message.push(item);
                            html = template(viewModel);
                            $(self.container).html(html);
                        }
                    }
                });
            });
        },
        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);
///#source 1 1 Widgets/TotalRewards/totalResources.js
var Widgets = Widgets || {};
(function ($) {
    Widgets.totalResources = {
        name: 'Total Resources',
        log: true,
        load: function (options) {
            var context = this;
            var content = Widgets.genericHeader;
            var viewModel =
                 {
                     isDisplay: false,
                     widgetTitle: '',
                     tiles: []
                 };
            var template = Handlebars.compile($('#totalResourcesTemplate').html());
            var id = $(context.container).attr('data-section');
            var title = "BAHSectionTitle" + id;
            var desc = "BAHSectionDescription" + id + "OWSHTML";

            $.when(content.promise, content.termPromise).done(function () {
                //your widget code starts executing  here to verify all data is available  
                $.each(content.data.results, function (key, val) {
                    $.each(val, function (key2, val2) {
                        if (key2 === "BAHWidget") {
                            if (val2.indexOf("Resources") > -1) {
                                viewModel.widgetTitle = val2;
                                viewModel.isDisplay = true;
                                var link = null;
                                var fileName = null;
                                var msIcon = null;
                                var faIcon = "fa fa-file right";

                                if (val["ContentType"].indexOf("Functional Document") > -1) {
                                    link = val["Url"];
                                    var fileTitle = link.split('/');
                                    var fileNames = fileTitle[fileTitle.length - 1].split('.');
                                    fileName = "Download";
                                    msIcon = Bah.getSPSIcon(val["FileExtension"]);
                                }
                                if (val["ContentType"].indexOf("Functional List") > -1) {
                                    faIcon = "fa fa-external-link-square right";
                                    link = val["BAHResourceUrl"];
                                }
                                    var item = {
                                        link: link,
                                        title: val["Title"],
                                        footerText: fileName,
                                        msIcon: msIcon,
                                        faIcon: faIcon
                                    }
                                    viewModel.tiles.push(item);
                                
                            }
                        }
                    });
                });

                html = template(viewModel);
                $(context.container).html(html);

                var maxTiles = 4;
                var $owl = $("#owl-slider-TotalResource");

                $owl.owlCarousel({
                    paginationNumbers: false,
                    navigation: true,
                    autoPlay: false,
                    slideSpeed: 300,
                    paginationSpeed: 400,
                    singleItem: false,
                    items: maxTiles,
                    itemsCustom: false,
                    itemsDesktop: [1199, maxTiles],
                    itemsDesktopSmall: [979, maxTiles],
                    itemsTablet: [767, 2],
                    itemsTabletSmall: [620, 1],
                    itemsMobile: [479, 1],
                    singleItem: false,
                    itemsScaleUp: false,
                    rewindNav: false
                });

                var ctrls = $owl.find('.owl-controls').detach();
                ctrls.prependTo($owl.closest('article').parent());

 
            });
        },
        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);
///#source 1 1 Widgets/TotalRewards/totalResourceBucket.js
var Widgets = Widgets || {};

(function ($) {
    Widgets.totalBlocks = {
        name: 'Total Resource Bucket',
        log: true,
        load: function (options) {
            var context = this;
            var html;
            var content = Widgets.genericHeader;
            var template = Handlebars.compile($('#totalResourceBucketTemplate').html());
            var id = $(context.container).attr('data-section');
            var title = "BAHSectionTitle" + id;
            var desc = "BAHSectionDescription" + id + "OWSHTML";

            var buckets = [];
            var titleLimit = 20;
            var maxLink = 8;

            var bucketArrary = [];
            $.when(content.promise, content.termPromise).done(function () {
                $.each(content.data.results, function (key, val) {
                    $.each(val, function (key2, val2) {
                        if (key2 === "BAHWidget") {
                            if (val2.indexOf("Resource Bucket") > -1) {
                                var url = null;
                                if (val["ContentType"].indexOf("Functional List") > -1) {
                                    url = val["BAHResourceUrl"];
                                }
                                if (val["ContentType"].indexOf("Functional Document") > -1) {
                                    url = val["Url"];
                                }
                                    //Assume the valut is Ex:"Filters:Resource Bucket:Work-Life and Wellness Benefits"
                                    var filter = val["BAHFunctionalFilter"];
                                    var bucketTitle = '';
                                    if (filter != null) {
                                        var titles = val["BAHFunctionalFilter"].split(':');
                                        bucketTitle = titles[titles.length - 1];
                                    }
                                    var arrayItem = {
                                        bucketTitle: bucketTitle,
                                        url: url,
                                        urlText :  Bah.setEllipsis(val["Title"], titleLimit)
                                        }
                                bucketArrary.push(arrayItem);
                                
                            }
                        }
                    });
                });

                var bucketArrarySort = lazy(bucketArrary).sortBy('bucketTitle').toArray();
                var result = context.groupBy(bucketArrarySort, function (value) {
                    return [value.bucketTitle];
                });

                $.each(result, function (index, value) {
                    var item =
                        {
                            bucketTitle: value[0].bucketTitle,
                            links: []
                        };
   
                    $.each(value.slice(0, maxLink), function (i, links) {
                        var linkInfo =
                        {
                            link: links.url,
                            linkText: links.urlText
                        };
                        item.links.push(linkInfo);                     
                      });            
                      buckets.push(item);
                });

                html = template(buckets);
                $(context.container).html(html);
                //$('.accordion .accordionTotal:first-child .accordion-section-title').addClass('active');

                function close_accordion_section() {
                         $('.accordion .accordion-section-title').removeClass('active');
                        $('.accordion .accordion-section-content').slideUp(300).removeClass('open');
                }

                $('.accordion-section-title').click(function (e) {
                    // Grab current anchor value
                    var currentAttrValue = $(this).attr('href');

                    if ($(e.target).is('.active')) {
                        close_accordion_section();
                    } else {
                        close_accordion_section();

                        // Add active class to section title
                        $(this).addClass('active');
                        // Open up the hidden content panel
                        $('.accordion ' + currentAttrValue).slideDown(300).addClass('open');
                    }

                   e.preventDefault();
                });
                
                $('.fa-minus').click(function (e) {
                    // Grab current anchor value
                    var currentAttrValue = $(this).attr('href');
                    if ($(e.target).is('.active')) {
                        close_accordion_section();
                    } else {
                        close_accordion_section();

                        // Add active class to section title
                        $(this).addClass('active');
                        // Open up the hidden content panel
                        $('.accordion ' + currentAttrValue).slideDown(300).addClass('open');
                    }

                    e.preventDefault();
                });
               
                Widgets.totalBlocks.showAccordion();
                $('.accordion .accordionTotal:first-child .accordion-section-title').addClass('active');
                $('.accordion #accordion-0').slideDown(300).addClass('open');
               
                $(window).resize(function () {
                    Widgets.totalBlocks.showAccordion();
                  
                });


            });
        },

        showAccordion: function () {
            var windowWidth = $(window).width();
            if (windowWidth > 680) {
                $('.accordion-section-content').css({ display: "block" });
                $('.accordion .accordion-section-title').addClass('active');
            }
            //else
            //{
            //    //close all accordion sections
            //    $('.accordion .accordion-section-title').removeClass('active');
            //    $('.accordion .accordion-section-content').slideUp(300).removeClass('open');
            //    // open only the first one
            //    $('.accordion .accordionTotal:first-child .accordion-section-title').addClass('active');
            //    $('.accordion #accordion-0').slideDown(300).addClass('open');
                
            //}
         
        },

        groupBy: function (array, fn) {
            var groups = {};
            array.forEach(function (value) {
                var group = JSON.stringify(fn(value));          
                groups[group] = groups[group] || [];            
                groups[group].push(value);                      
            });
            return Object.keys(groups).map(function (group) {
                return groups[group];
            })
        },

        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);
///#source 1 1 Widgets/TotalRewards/totalConnect.js
var Widgets = Widgets || {};
(function ($) {
    Widgets.totalConnect = {
        name: 'Total Connect',
        log: true,
        load: function (options) {
            var context = this;
            //Reusing People Model template as the functionality is same
            var template = Handlebars.compile($('#peopleConnectTemplate').html());
            var content = Widgets.genericHeader;
            var id = $(context.container).attr('data-section');
            var title = "BAHSectionTitle" + id;
            var desc = "BAHSectionDescription" + id + "OWSHTML";

            $.when(content.promise, content.termPromise).done(function () {
                //your widget code starts executing  here to verify all data is available  
                var resultData = content.data.customProperties.connect;

                var data = {
                    email: resultData.email.address,
                    phone: resultData.phone.number,
                    yammer: resultData.yammerLink['yammer url'],
                    groupTitle: resultData.groupHeader.title,
                    groupEmail: resultData.groupemail,
                    groupYammer: resultData.groupYammer['yammer url']
                };

                //writes title and description
                $.each(content.data.page, function (key, item) {
                    data.name = item[title];
                    data.description = item[desc];
                });

                html = template(data);
                $(context.container).html(html);
            });
        },
        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);
///#source 1 1 Widgets/TotalRewards/totalPromo.js
var Widgets = Widgets || {};
(function ($) {
    Widgets.totalPromo = {
        name: "Total Rewards Promo",
        log: true,
        load: function (options) {

            var context = this;
            var promoContent = {};
            var promoArray = { data: [] };
            var template = Handlebars.compile($('#totalPromoTemplate').html());
            var header = Widgets.genericHeader;
            $.when(header.promise).done(function () {
                $.each(header.data.results, function (key, val) {
                    if (val.BAHWidget === 'Promo')   {
                        promoArray.data.PromoTitle = val.Title;
                        promoArray.data.PromoDesc = val.BAHFunctionalDescriptionOWSHTML;
                        promoArray.data.LearnLink = val.BAHResourceUrl;
                        promoArray.data.LearnMoreTitle = val.BAHLongURLTitleOWSTEXT;
                        promoArray.HeaderColor = header.data.headerData.tagColor;
                        promoContent.promoArray = promoArray;
                        html = template(promoArray);
                        $(context.container).html(html);
                }
                });
            });

        },       
        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);

///#source 1 1 Widgets/TotalRewards/totalIWantTo.js
var Widgets = Widgets || {};
(function ($) {
    Widgets.totalWantTo = {
        name: 'I Want To',
        log: true,
        configuration: {
            selectProperties: [
            "BAHFunctionalDescriptionOWSHTML",
            "BAHLongURLTitleOWSTEXT",
            "BAHResourceUrl",
            "BAHIconUrlOWSURLH",
            "BAHSortOrder",
            "BAHFunctionalFilter",

            "BAHWidget",
            "BAHFunctionalPageTitle",
            "BAHHeroPublishingImageOWSIMGE",
            "BAHHeroVideoEmbedOWSMTXT",
            "Url",
            "Title",
            "ContentType",
            "BAHSubTitleOWSTEXT",
            "BAHHeroDescriptionOWSHTML",
            "BAHHeroImageOWSHTML",
            "BAHHeroBylineOWSTEXT",
            "BAHSectionDescription5OWSHTML",
            "BAHSectionDescription6OWSHTML",
            "BAHSectionDescription7OWSHTML",
            "BAHSectionDescription8OWSHTML",
            "BAHSectionDescription9OWSHTML",
            "BAHSectionDescription10OWSHTML",
            "BAHSectionTitle1",
            "BAHSectionTitle2",
            "BAHSectionTitle3",
            "BAHSectionTitle4",
            "BAHSectionTitle5",
            "BAHSectionTitle6",
            "BAHSectionTitle7",
            "BAHSectionTitle8",
            "BAHSectionTitle9",
            "BAHSectionTitle10"
            ],
            query: '',
            contentTypes: ['Functional List', 'Functional Document', 'Functional Page'],
        },
        load: function (options) {
            var context = this;
            var template = Handlebars.compile($('#iWantToTemplate').html());
            var content = Widgets.genericHeader;
            var id = $(context.container).attr('data-section');
            var title = "BAHSectionTitle" + id;
            var desc = "BAHSectionDescription" + id + "OWSHTML";

            var iwanttocontent = [];

            $.when(content.promise).done(function () {
                //your widget code starts executing  here to verify all data is available  
                var myContext = [];

                $.each(content.data.results, function (key, val) {
                    $.each(val, function (key2, val2) {
                        if (key2 === "BAHWidget") {
                            if (val2.indexOf("I Want To") > -1) {

                                var filter = val["BAHFunctionalFilter"];
                                var category = '';
                                var url = '';

                                if (filter != null) {
                                    var titles = val["BAHFunctionalFilter"].split(':');
                                    category = titles[titles.length - 1];
                                }

                                if (val["BAHResourceUrl"] == "" || val["BAHResourceUrl"] == null) {
                                    url = val["Url"];
                                } else {
                                    url = val["BAHResourceUrl"];
                                }

                                iWantToArray = {
                                    url: url,
                                    title: val["Title"],
                                    category: category
                                }

                                myContext.push(iWantToArray);
                            }
                        }
                    });
                });
                var categorySort = lazy(myContext).sortBy('category').groupBy('category').toArray();

                $.each(categorySort, function (index, value) {
                    var item =
                        {
                            category: value[0],
                            links: []
                        };
                    $.each(value[1], function (i, links) {
                        var linkInfo =
                        {
                            url: links["url"],
                            title: links["title"]
                        };

                        item.links.push(linkInfo);

                    });

                    iwanttocontent.push(item);
                });

                var data = {
                    name: "I Want To",
                    content: iwanttocontent
                };
                /*
                //writes title and description
                $.each(content.data.page, function (key, item) {
                    data.name = item[title];
                    data.description = item[desc];
                });
                */

                html = template(data);
                $(context.container).html(html);
            });

        },
        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);
///#source 1 1 Widgets/TotalRewards/totalAwards.js
var Widgets = Widgets || {};
(function ($) {
    Widgets.totalAwards = {
        name: 'Total Awards',
        log: true,
        configuration: {
            selectProperties: [
            "BAHFunctionalDescriptionOWSHTML",
            "BAHLongURLTitleOWSTEXT",
            "BAHResourceUrl",
            "BAHIconUrlOWSURLH",
            "BAHSortOrder",
            "BAHFunctionalFilter",
            "BAHWidget",
            "BAHFunctionalPageTitle",
            "BAHHeroPublishingImageOWSIMGE",
            "BAHHeroVideoEmbedOWSMTXT",
            "Url",
            "Title",
            "ContentType",
            "BAHSubTitleOWSTEXT",
            "BAHHeroDescriptionOWSHTML",
            "BAHHeroImageOWSHTML",
            "BAHHeroBylineOWSTEXT",
            "BAHSectionDescription5OWSHTML",
            "BAHSectionDescription6OWSHTML",
            "BAHSectionDescription7OWSHTML",
            "BAHSectionDescription8OWSHTML",
            "BAHSectionDescription9OWSHTML",
            "BAHSectionDescription10OWSHTML",
            "BAHSectionTitle1",
            "BAHSectionTitle2",
            "BAHSectionTitle3",
            "BAHSectionTitle4",
            "BAHSectionTitle5",
            "BAHSectionTitle6",
            "BAHSectionTitle7",
            "BAHSectionTitle8",
            "BAHSectionTitle9",
            "BAHSectionTitle10"
            ],
            query: '',
            contentTypes: ['Functional List', 'Functional Document', 'Functional Page'],
        },
        load: function (options) {

            var context = this;
            var awardsInfoArray = { data: [], AwardsWidgetTitle: '', AwardsWidgetDesc: '', HeaderColor: '' };


            var ID = $(context.container).attr('data-section');
            var sectionDesc = "BAHSectionDescription" + ID + "OWSHTML";
            var sectionTitle = "BAHSectionTitle" + ID;

            var template = Handlebars.compile($('#totalAwardsTemplate').html());
            var header = Widgets.genericHeader;


            $.when(header.promise).done(function () {
                if (header.data.page[0]) {
                    awardsInfoArray.AwardsWidgetTitle = header.data.page[0][sectionTitle];
                    awardsInfoArray.AwardsWidgetDesc = header.data.page[0][sectionDesc];
                    awardsInfoArray.HeaderColor = header.data.headerData.tagColor;
                    var iconCount = 0;
                }
                $.each(header.data.results, function (index, value) {
                    if ((value.BAHWidget === awardsInfoArray.AwardsWidgetTitle) && iconCount < 4) {
                        var iconData = { icon: '', link: '' };
                        iconData.icon = value.BAHIconUrlOWSURLH.split(",")[0];
                        iconData.link = value.BAHResourceUrl;
                        awardsInfoArray.data.push(iconData);
                        iconCount++;
                    }
                });
                if (awardsInfoArray) {
                    
                    html = template(awardsInfoArray);
                    $(context.container).html(html);
                }
            });
            
        },
        click: function (url) {
            window.location = url;
        },
        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);

///#source 1 1 Widgets/TotalRewards/totalNews.js
var Widgets = Widgets || {};
(function ($) {
    Widgets.totalNews= {
        name: 'Total News',
        log: true,
        load: function (options) {
            var context = this;
            //Reusing People Model template as the functionality is same
            var template = Handlebars.compile($('#totalNewsTemplate').html());
            var content = Widgets.genericHeader;
            var id = $(context.container).attr('data-section');
            var title = "BAHSectionTitle" + id;
            var desc = "BAHSectionDescription" + id + "OWSHTML";

            $.when(content.promise, content.termPromise).done(function () {
                //your widget code starts executing  here to verify all data is available  
                var myContext = [];

                $.each(content.data.results, function (key, val) {
                    $.each(val, function (key2, val2) {
                        if (key2 === "BAHWidget") {
                            if (val2.indexOf("News and Updates") > -1) {
                                myContext.push(val);
                            }
                        }
                    });
                });

                var data = {
                    context: myContext.slice(0, 3)
                };

                //writes title and description
                $.each(content.data.page, function (key, item) {
                    data.name = item[title];
                    data.description = item[desc];
                });

                html = template(data);
                $(context.container).html(html);
                $(context.container).foundation();
            });
        },
        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);
///#source 1 1 Widgets/PlatformPage/platformHeader.js
var Widgets = Widgets || {};
(function ($) {
    Widgets.platformHeader = {
        name: 'People Header',
        log: true,
        promise: new $.Deferred(),
        termPromise: new $.Deferred(),
        selectProperties: [
            "BAHStream",
            "BAHFunctionalDescriptionOWSHTML",
            "BAHLongURLTitleOWSTEXT",
            "BAHResourceUrl",
            "BAHIconUrlOWSURLH",
            "BAHSortOrder",
            "BAHFunctionalFilter",
            "BAHWidget",
            "BAHHeroPublishingImageOWSIMGE",
            "BAHHeroVideoEmbedOWSMTXT",
            "Url",
            "Title",
            "ContentType",
            "BAHStream",
            "ContentType",
            "Title",
            "PublishingImage",
            "BAHSubTitleOWSTEXT",
            "ArticleByLineOWSTEXT",
            "PublishingPageContentOWSHTML",
            "BAHStreamShowcaseOWSBOOL",
            "BAHShowcaseExpiryDate",
            "BAHShowcasePublishDate",
            "write",
            "Created",
            "path",
            "BAHLeader",
            "ArticleByLineOWSTEXT",
            "BAHNewsArticleFeatured",
            "BAHLeaderOWSUSER",
            "BodyOWSMTXT",
            "BAHFeedbackComment",
            "BAHResourceImageOWSIMGE",
            "BAHLocation",
            "BAHLinkUrl",
            "LeaderSortOrder",
            "ViewsRecent",
            "BAHYammerCommentCountOWSNMBR",
            "BAHArticleDate",
            "listitemid",
            "Description",
            "AllDayEvent",
            "BAHStartDate",
            "BAHEndDate"
        ],
        data: {
            configuration: '',
            customProperties: {
                header: [],
            },
            results: [],
            headerData: { name: '', tagColor: '', subTitle: '' }
        },
        currentIndex: 0,
        totalResults: 0,
        initialResultsAmount: 100,
        load: function (options) {
            $('html').addClass('bah-platform-page');
            var context = this;
            var orgId = Bah.GetQueryStringParams("orgid");
            var todayPlus = context.todaysDate(6);
            var todayMinus = context.todaysDate(-6);
            if (orgId) {
                $.when(Bah.getTerm(Bah.Constants.Guid.StreamTermSet, orgId)).then(
                    function (groupTerm) {
                        orgTermSet = groupTerm;
                        orgTermName = groupTerm.get_name();
                        orgTermProps = groupTerm.get_customProperties();
                        context.data.customProperties.header = orgTermProps;
                        context.data.headerData.subTitle = orgTermProps['subTitle'];
                        context.data.headerData.tagColor = orgTermProps['tagcolor'];
                        //context.setTermset(orgTermName);
                        //var widgetConfiguration = $(context.container).attr('data-configuration') || "";
                        //
                        //UPDATE SEARCH QUERY
                        //
                        var widgetConfiguration = orgTermName;
                        var queryParams = "(contenttype:\"Hero Carousel\" AND BAHStream:" + orgTermName + " ) OR (contenttype:\"Platform List\" AND BAHStream:" + orgTermName + " ) OR (contenttype:\"Platform Document\" AND BAHStream:" + orgTermName + ") OR   (contenttype:\"Leadership Messages\" AND bahstream:" + orgTermName + " )  OR   (contenttype:\"Our Leadership Team\" AND BAHStream:" + orgTermName + " ) OR (contenttype:\"More About Us\" AND BAHStream:" + orgTermName + " ) OR  (contenttype:\"Firmwide Events\" AND BAHStream:" + orgTermName + " AND bahstartdate>=today AND bahstartdate<" + todayPlus + ")  OR (contenttype:\"Zone Publishing Stream Enhanced News Page\" AND BAHStream:\"" + orgTermName + "\" AND write>" + todayMinus + " AND BAHArticleDate<Today)";
                        //var queryParams = "(BAHFunctionalPageTitle=\"" + widgetConfiguration + "\" AND ContentType:\"Functional List\") OR (BAHFunctionalPageTitle=\"" + widgetConfiguration + "\" AND ContentType:\"Functional Document\") OR (BAHFunctionalPageTitle=\"" + widgetConfiguration + "\" AND ContentType:\"Functional Page\")";
                        widgetConfiguration !== "" ? context.setResults(widgetConfiguration, queryParams, context.currentIndex) : console.log("People Header is missing data-configuration parameter");
                    }
                );
            }

        },
        todaysDate: function (variation) {
            //variation is plus or minus months
            var today = new Date();
            today = new Date(today);
            today.setMonth(today.getMonth() + variation);
            var dd = today.getDate();
            var mm = today.getMonth() + 1; //January is 0!
            var yyyy = today.getFullYear();
            if (dd < 10) {
                dd = '0' + dd
            }
            if (mm < 10) {
                mm = '0' + mm
            }
            today = mm + '-' + dd + '-' + yyyy;
            return today;
        },
        constructQuery: function (parameter, startPosition) {
            var context = this;
            var deferred = $.Deferred();
            SP.SOD.executeFunc("SP.js", "SP.ClientContext", function () {
                SP.SOD.executeFunc("SP.Search.js", "Microsoft.SharePoint.Client.Search.Query.KeywordQuery", function () {
                    var sContext = SP.ClientContext.get_current();
                    var keywordQuery = new Microsoft.SharePoint.Client.Search.Query.KeywordQuery(sContext);
                    keywordQuery.set_trimDuplicates(false);
                    keywordQuery.set_rowLimit(context.initialResultsAmount);
                    keywordQuery.set_startRow(startPosition);
                    var properties = keywordQuery.get_selectProperties();
                    $.each(context.selectProperties, function (key, widgetConfiguration) {
                        properties.add(widgetConfiguration);
                    });
                    // Sorting (Ascending = 0, Descending = 1)
                    keywordQuery.set_enableSorting(true);
                    var sortproperties = keywordQuery.get_sortList();
                    sortproperties.add("BAHWidget", 0);
                    sortproperties.add("BAHSortOrder", 0);
                    sortproperties.add("BAHArticleDate", 1);                    
                    sortproperties.add("BAHStartDate", 0);

                    var queryText = parameter;
                    keywordQuery.set_queryText(queryText);
                    var searchExecutor = new Microsoft.SharePoint.Client.Search.Query.SearchExecutor(sContext);
                    results = searchExecutor.executeQuery(keywordQuery);
                    sContext.executeQueryAsync(
                        function () {
                            deferred.resolve(results);
                        },
                        function (err) {
                            deferred.reject(null);
                        }
                    );
                });
            });
            return deferred.promise();
        },
        setResults: function (configuration, parameter, startPosition) {
            var context = this;
            context.data.headerData.name = configuration;
            context.data.configuration = configuration;
            context.compileHtml(context.data.headerData);
            $.when(context.constructQuery(parameter, startPosition)).done(function (data) {
                if (data.m_value !== undefined && data.m_value.ResultTables[0].TotalRows !== 0) {
                    context.totalResults = data.m_value.ResultTables[0].TotalRows;
                    var results = data.m_value.ResultTables[0].ResultRows;
                    context.data.results = results.length > 0 ? results : null;
                    if (context.totalResults > context.initialResultsAmount) {
                        context.currentIndex = context.currentIndex + context.initialResultsAmount;
                        context.loadMore(parameter, context.currentIndex);
                    } else {
                        context.promise.resolve();
                    }
                } else {
                    console.log("Verify data for configuration: '" + configuration + "' has data.");
                }
            });
        },
        compileHtml: function (model) {
            var context = this;
            $.when(context.promise).done(function () {
                var template = Handlebars.compile($('#platformHeaderTemplate').html());
                var html = template(model);
                $(context.container).html(html);
            });
        },
        loadMore: function (parameter, startPosition) {
            var context = this;
            $.when(context.constructQuery(parameter, startPosition)).done(function (data) {
                if (data.m_value !== undefined) {
                    var results = data.m_value.ResultTables[0].ResultRows;
                    if (results.length > 0) {
                        $.each(results, function (key, val) {
                            context.data.results.push(val);
                        });
                    }
                    context.currentIndex = context.currentIndex + results.length;
                    if (context.currentIndex < context.totalResults) {
                        context.loadMore(parameter, context.currentIndex);
                    }
                    else {
                        context.promise.resolve();
                    }
                }
            });
        },
        newsFeedTotalResults: 0,
        newsFeedCurrent: 0,
        newsFeedData:[],
        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);
///#source 1 1 Widgets/PlatformPage/platformNews.js
var Widgets = Widgets || {};
(function ($) {
    Widgets.platformNews = {
        name: 'Platform News',
        log: true,
        configuration: {
            selectProperties: [
            "BAHStream",
            "listitemid",
            "Description",
            "AllDayEvent",
            "BAHStartDate",
            "BAHEndDate"
            ],
            query: '(contenttype:"Zone Publishing Stream Enhanced News Page" AND BAHStream:"BAHSTREAM" AND write>TODAYMINUS6MONTHS AND BAHArticleDate<today)',
            contentTypes: [],
        },
        load: function (options) {
            var context = this;

            var contentArray = { data: [] };

            var id = $(context.container).attr('data-section');
            var sectionDesc = "BAHSectionDescription" + id + "OWSHTML";
            var sectionTitle = "BAHSectionTitle" + id;
            var header = Widgets.genericHeader;
            $.when(header.promise).done(function () {
                $.each(header.data.results, function (key, val) {
                    if (val.ContentType.indexOf("Zone Publishing Stream Enhanced News Page") > -1) {
                        var article = {
                            image: Bah.getImageRendition($(val.PublishingImage).attr('src'), 3),
                            title: val.Title,
                            articleUrl: '/Pages/Article.aspx?path=' + val.path,
                            body: val.ArticleByLineOWSTEXT,
                            views: val.ViewsRecent,
                            comments: val.BAHYammerCommentCountOWSNMBR,
                            shortName: '',
                            color: ''
                        };
                        context.vm.news.push(article);
                    }
                });
                context.vm.currentSearchIndex = 3;
                context.vm.totalSearchResults = context.vm.news.length;
                context.vm.name = header.data.configuration + " Latest Updates";
                context.buildHtml();
            });
        },
        vm: {
            name: "",
            news: [],
            currentSearchIndex: 0,
            totalSearchResults: 0,
        },
        loadMoreArticles: function () {
            context = this;
            context.vm.currentSearchIndex += 3;
            context.buildHtml();
        },
        buildHtml: function () {
            var template = Handlebars.compile($('#platformNewsTemplate').html());
            context = this;
            var html = template(context.vm);
            $(context.container).html(html);
        },
        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);

///#source 1 1 Widgets/PlatformPage/platformExplore.js
var Widgets = Widgets || {};
(function ($) {
    Widgets.platformExplore = {
        name: 'Platform Explore',
        log: true,
        load: function (options) {
            var context = this;
            var template = Handlebars.compile($('#platformExploreTemplate').html());
            var content = Widgets.genericHeader;
            var id = $(context.container).attr('data-section');
            var title = "BAHSectionTitle" + id;
            var desc = "BAHSectionDescription" + id + "OWSHTML";

            var explorecontent = [];

            $.when(content.promise).done(function () {
                //your widget code starts executing  here to verify all data is available  
                var myContext = [];

                $.each(content.data.results, function (key, val) {
                    $.each(val, function (key2, val2) {
                        if (key2 === "BAHWidget") {
                            if (val2.indexOf("Platform Explore") > -1) {
                                var filter = val["BAHFunctionalFilter"];
                                var category = '';
                                var url = '';

                                if (filter != null) {
                                    var titles = val["BAHFunctionalFilter"].split(':');
                                    category = titles[titles.length - 1];
                                }

                                if (val["BAHResourceUrl"] == "" || val["BAHResourceUrl"] == null) {
                                    url = val["Url"];
                                } else {
                                    url = val["BAHResourceUrl"];
                                }

                                exploreArray = {
                                    url: url,
                                    title: val["Title"],
                                    category: category
                                }
                                myContext.push(exploreArray);
                            }
                        }
                    });
                });
                
                var categorySort = lazy(myContext).sortBy('category').groupBy('category').toArray();

                $.each(categorySort, function (index, value) {
                    var item =
                        {
                            category: value[0],
                            links: []
                        };
                    $.each(value[1], function (i, links) {
                        var linkInfo =
                        {
                            url: links["url"],
                            title: links["title"]
                        };
                        
                        item.links.push(linkInfo);
                        
                    });
                    
                    explorecontent.push(item);
                });

                var data = {
                    name: "Explore",
                    content: explorecontent
                };

                html = template(data);
                $(context.container).html(html);
            });

        },
        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);
///#source 1 1 Widgets/PlatformPage/platformEvents.js
var Widgets = Widgets || {};
(function ($) {
    Widgets.platformEvents = {
        name: 'Platform Events',
        log: true,
        configuration: {
            selectProperties: [
            "BAHStream",
            "listitemid",
            "Description",
            "AllDayEvent",
            "BAHStartDate",
            "BAHEndDate"
            ],
            query: '(contenttype:"Firmwide Events" AND BAHStreamdisplay="BAHSTREAM" AND bahstartdate>=today AND bahstartdate<TODAYPLUS6MONTHS)',
            contentTypes: [],
        },
        load: function (options) {

            var context = this;
            var eventsArray = { data: [], PlatformWidgetTitle: '', HeaderColor: '', loadMoreURL: '', itemsToDisplay: false };
            var template = Handlebars.compile($('#platformEventsTemplate').html());
            var header = Widgets.genericHeader;
            $.when(header.promise).done(function () {
                var eventCount = 0;
                eventsArray.PlatformWidgetTitle = 'Events';
                eventsArray.HeaderColor = header.data.headerData.tagColor;
                var searchEventsURL = '/Pages/Search-Events.aspx?k=bahstreamdisplay%3A%22';
                //var platformName = Widgets.platformHeader.data.configuration;
                var platformName = header.data.configuration;
                eventsArray.loadMoreURL = searchEventsURL + encodeURIComponent(platformName) + '%22';
                $.each(header.data.results, function (index, value) {               
                    if (value["ContentType"].indexOf("Firmwide Events") > -1 && eventCount < 3) {

                        var eventData = { title: '', url: '', startDate: '', enddate: '', eventID: '', description: '', allDayEvent: '' };
                        eventData.title = value.Title;
                        eventData.eventID = value.listitemid;
                        eventData.description = value.Description;
                        eventData.allDayEvent = value.AllDayEvent;                    
                        //var eventURL = value.url;
                        //Get Event URL
                        var eventBaseURL = '/Pages/Event-Details.aspx?eventId=';
                        //https://boozallen.sharepoint.com/Pages/Event-Details.aspx?eventId=322&sourceUrl=https://boozallen.sharepoint.com/sites/fc/&listTitle=Calendar                        
                        eventData.url = eventBaseURL + value.listitemid + '&sourceUrl=' + value.Url.split("/Lists/")[0] + '/&listTitle=' + (value.Url.split("/Lists/")[1]).split("/DispForm")[0];
                        //Get Event Date and times
                        var eventSPStartDate = new Date(value.BAHStartDate + " UTC");

                        //var eventStartDate = new Date(itemStartDate);
                        eventData.eventStartMonth = $.format.date(eventSPStartDate, 'MMM');
                        eventData.eventStartDay = $.format.date(eventSPStartDate, 'dd');
                        eventData.eventStartTime = $.format.date(eventSPStartDate, 'h:mm a');

                        //var itemEndDate = $.format.date(value.BAHEndDate, 'MM/dd/yyyy hh:mm:ss a');
                        var eventSPEndDate = new Date(value.BAHEndDate + " UTC");

                        //var eventEndDate = new Date(itemEndDate);
                        eventData.eventEndMonth = $.format.date(eventSPEndDate, 'MMM');
                        eventData.eventEndDay = $.format.date(eventSPEndDate, 'dd');
                        eventData.eventEndTime = $.format.date(eventSPEndDate, 'h:mm a');
                        eventsArray.data.push(eventData);
                        eventCount++;
                    };
                });

                if (eventsArray.data.length > 0) {
                    eventsArray.itemsToDisplay = true;
                }
    
                if (eventsArray) {
                    html = template(eventsArray);
                    $(context.container).html(html);
                }
            });

        },
        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);

///#source 1 1 Widgets/PlatformPage/platformConnect.js
var Widgets = Widgets || {};
(function ($) {
    Widgets.platformConnect = {
        name: 'Platform Connect',
        log: true,
        configuration: {
            selectProperties: [
            "BAHStream",
            "BAHFunctionalDescriptionOWSHTML",
            "BAHLongURLTitleOWSTEXT",
            "BAHResourceUrl",
            "BAHIconUrlOWSURLH",
            "BAHSortOrder",
            "BAHFunctionalFilter",
            "BAHWidget",
            "BAHHeroPublishingImageOWSIMGE",
            "BAHHeroVideoEmbedOWSMTXT",
            "Url",
            "Title",
            "ContentType",
            "BAHStream",
            "ContentType",
            "Title",
            "PublishingImage",
            "BAHSubTitleOWSTEXT",
            "ArticleByLineOWSTEXT",
            "PublishingPageContentOWSHTML",
            "BAHStreamShowcaseOWSBOOL",
            "BAHShowcaseExpiryDate",
            "BAHShowcasePublishDate",
            "write",
            "Created",
            "path",
            "BAHLeader",
            "ArticleByLineOWSTEXT",
            "BAHNewsArticleFeatured",
            "BAHLeaderOWSUSER",
            "BodyOWSMTXT",
            "BAHFeedbackComment",
            "BAHResourceImageOWSIMGE",
            "BAHLocation",
            "BAHLinkUrl",
            "LeaderSortOrder",
            "ViewsRecent",
            "BAHYammerCommentCountOWSNMBR",
            "BAHArticleDate",
            "listitemid",
            "Description",
            "AllDayEvent",
            "BAHStartDate",
            "BAHEndDate"
            ],
            query: '',
            contentTypes: ['Hero Carousel', 'Platform List', 'Platform Document', 'Leadership Messages', 'Our Leadership Team', 'More About Us'],
        },
        load: function (options) {
            var context = this;
            var template = Handlebars.compile($('#platformConnectTemplate').html());
            var content = Widgets.genericHeader;
            var id = $(context.container).attr('data-section');
            var title = "BAHSectionTitle" + id;
            var desc = "BAHSectionDescription" + id + "OWSHTML";

            $.when(content.promise).done(function () {
                //your widget code starts executing  here to verify all data is available  
                var myContext = [];

                $.each(content.data.results, function (key, val) {
                    $.each(val, function (key2, val2) {
                        if (key2 === "BAHWidget") {
                            if (val2.indexOf("Platform Connect") > -1) {
                                myContext.push(val);
                            }
                        }
                    });
                });

                var data = {
                    name: "Connect",
                    isMobile: Bah.isMobile.any(),
                };

                for (var i = 0, len = myContext.length; i < len; i++) {
                    var url = myContext[i]["BAHResourceUrl"];

                    switch (myContext[i]["Title"]) {
                        case "Email":
                            data.email = url;
                        break;
                        case "Yammer":
                            data.yammer = url;
                        break;
                    }
                };

                html = template(data);
                $(context.container).html(html);
            });

        },
        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);
///#source 1 1 Widgets/PlatformPage/platformMessage.js
var Widgets = Widgets || {};

(function ($) {
    Widgets.platformMessage = {
        name: 'Platform Message',
        log: true,

        load: function (options) {
            var html;
            var template = Handlebars.compile($('#platformMessageTemplate').html());
            var content = Widgets.genericHeader;
            var maxChars = 500;
            var viewModel = {
                viewmore: '',
                message: '',
                fullMessage: ''
            };
            var LastModidified = null;

            $.when(content.promise).done(function () {
                $.each(content.data.results, function (key, val) {
                    var body = "";
                    var bodyLimit = "";
                    if (val["ContentType"].indexOf("Leadership Messages") > -1) {                      
                        //get the latest message based on LastModifiedTime
                        if (LastModidified == null || val["LastModifiedTime"] > LastModidified) {
                            body = Widgets.platformMessage.removeHTMLTags(val["BodyOWSMTXT"]);
                            if (body.length > maxChars) {
                                bodyLimit = Bah.setEllipsis(body, maxChars);
                                viewModel.viewmore = "view more";
                            }
                            viewModel.message = bodyLimit;
                            viewModel.fullMessage = body;
                            LastModidified = val["LastModifiedTime"];
                        }
                    }

                    html = template(viewModel);
                    $(Widgets.platformMessage.container).html(html);

                    $('#viewmore').on('click', function () {
                        $('#trimMessage').css('display', 'none');
                        $('#fullMessage').css('display', 'block');
                    });
                });
            });

        },

        removeHTMLTags: function (htmlString) {
            if (htmlString) {
                var mydiv = document.createElement("div");
                mydiv.innerHTML = htmlString;
                if (document.all) // IE Stuff
                {
                    return mydiv.innerText;
                }
                else // Mozilla does not work with innerText
                {
                    return mydiv.textContent;
                }

            }
        },

        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);
///#source 1 1 Widgets/PlatformPage/platformBreadcrumbs.js
var Widgets = Widgets || {};
(function ($) {
    Widgets.platformBreadcrumbs = {
        name: 'Featured Content',
        log: true,
        load: function (options) {
            var context = this;
            var header = Widgets.platformHeader;
            $.when(header.promise).done(function () {
                var template = Handlebars.compile($('#platformBreadcrumbsTemplate').html());
                var html = template(header.data.headerData);
                $(context.container).html(html);
            });
        },
        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);
///#source 1 1 Widgets/PlatformPage/platformResources.js
var Widgets = Widgets || {};

(function ($) {
    Widgets.platformResources = {
        name: 'Platform Resources',
        log: true,
        load: function (options) {
            var context = this;
            var html;
            var content = Widgets.genericHeader;
            var template = Handlebars.compile($('#platformResourcesTemplate').html());

            var viewModel={
                widgetTitle: '',
                buckets: []
            };
            var titleLimit = 30;
            var maxLink = 8;

            var bucketArray = [];
            $.when(content.promise).done(function () {
                $.each(content.data.results, function (key, val) {
                    $.each(val, function (key2, val2) {
                        if (key2 === "BAHWidget") {
                            if (val2.indexOf("Platform Resources") > -1) {
                                var url = null;
                                if (val["ContentType"].indexOf("Platform List") > -1) {
                                    url = val["BAHResourceUrl"];
                                }
                                if (val["ContentType"].indexOf("Platform Document") > -1) {
                                    url = val["Url"];
                                }
                                //Assume the valut is Ex:"Filters:Resource Bucket:Work-Life and Wellness Benefits"
                                var filter = val["BAHFunctionalFilter"];
                                var bucketTitle = '';
                                if (filter != null) {
                                    var titles = val["BAHFunctionalFilter"].split(':');
                                    bucketTitle = titles[titles.length - 1];
                                }
                                var arrayItem = {
                                    bucketTitle: bucketTitle,
                                    url: url,
                                    urlText: Bah.setEllipsis(val["Title"], titleLimit),
                                    urlFullText: val["Title"]
                                }
                                bucketArray.push(arrayItem);

                            }
                        }
                    });
                });

                var bucketArraySort = lazy(bucketArray).sortBy('bucketTitle').toArray();
                var result = context.groupBy(bucketArraySort, function (value) {
                    return [value.bucketTitle];
                });

                $.each(result, function (index, value) {
                    var item =
                        {
                            bucketTitle: value[0].bucketTitle,
                            links: []
                        };

                    $.each(value.slice(0, maxLink), function (i, links) {
                        var linkInfo =
                        {
                            link: links.url,
                            linkText: links.urlText,
                            linkFullText: links.urlFullText
                        };
                        item.links.push(linkInfo);
                    });
                    viewModel.buckets.push(item);
                });

                viewModel.widgetTitle = content.data.headerData.name;
                html = template(viewModel);
                $(context.container).html(html);
                //$('.accordion .accordionTotal:first-child .accordion-section-title').addClass('active');

                function close_accordion_section() {
                    $('.accordion .accordion-section-title').removeClass('active');
                    $('.accordion .accordion-section-content').slideUp(300).removeClass('open');
                }

                $('.accordion-section-title').click(function (e) {
                    // Grab current anchor value
                    var currentAttrValue = $(this).attr('href');

                    if ($(e.target).is('.active')) {
                        close_accordion_section();
                    } else {
                        close_accordion_section();

                        // Add active class to section title
                        $(this).addClass('active');
                        // Open up the hidden content panel
                        $('.accordion ' + currentAttrValue).slideDown(300).addClass('open');
                    }

                    e.preventDefault();
                });

                $('.fa-minus').click(function (e) {
                    // Grab current anchor value
                    var currentAttrValue = $(this).attr('href');
                    if ($(e.target).is('.active')) {
                        close_accordion_section();
                    } else {
                        close_accordion_section();

                        // Add active class to section title
                        $(this).addClass('active');
                        // Open up the hidden content panel
                        $('.accordion ' + currentAttrValue).slideDown(300).addClass('open');
                    }

                    e.preventDefault();
                });

                Widgets.platformResources.showAccordion();
                $('.accordion .accordionPlatform:first-child .accordion-section-title').addClass('active');
                $('.accordion #accordion-0').slideDown(300).addClass('open');

                $(window).resize(function () {
                    Widgets.platformResources.showAccordion();

                });


            });
        },

        showAccordion: function () {
            var windowWidth = $(window).width();
            if (windowWidth > 680) {
                $('.accordion-section-content').css({ display: "block" });
                $('.accordion .accordion-section-title').addClass('active');
            }
        },

        groupBy: function (array, fn) {
            var groups = {};
            array.forEach(function (value) {
                var group = JSON.stringify(fn(value));
                groups[group] = groups[group] || [];
                groups[group].push(value);
            });
            return Object.keys(groups).map(function (group) {
                return groups[group];
            })
        },

        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);
///#source 1 1 Widgets/PlatformPage/platformHero.js
var Widgets = Widgets || {};

(function ($) {
    Widgets.platformHero = {
        name: 'Platform Hero',
        log: true,
        configuration: {
            selectProperties: [
            "BAHStream",
            "BAHSortOrder",
            "BAHFunctionalFilter",
            "BAHWidget",
            "BAHHeroPublishingImageOWSIMGE",
            "BAHHeroVideoEmbedOWSMTXT",
            "BAHWidget",
            "Title"
            ],
            query: '',
            contentTypes: ['Hero Carousel', 'Hero Carousel Stream', 'Hero Carousel Page'] //Added Additional Content Types to get ready for name change on content type
        },
        vm: {
            slider: []
        },
        load: function (options) {
            var html;
            var template = Handlebars.compile($('#platformHeroTemplate').html());
            var header = Widgets.genericHeader;
            var context = this;
            $.when(header.promise).done(function () {
                $.each(header.data.results, function (key, val) {
                    if (val.BAHWidget.indexOf("Platform Hero") > -1) {
                        var vm = {
                            bylineText: '',
                            heroImg: '',
                            heroVideo: '',
                            showVideo: false,
                            heroLink: '',
                            title: ''
                        };
                        val.Title ? vm.title = Bah.setEllipsis(val.Title, 128) : vm.title;
                        val.BAHSubTitleOWSTEXT ? vm.bylineText = Bah.setEllipsis(val.BAHSubTitleOWSTEXT, 300) : vm.bylineText;
                        //Null reference check for hero image
                        if (val.BAHHeroPublishingImageOWSIMGE) {
                            vm.heroImg = $(val.BAHHeroPublishingImageOWSIMGE).find('img').attr('src') || $(val.BAHHeroPublishingImageOWSIMGE).attr('src');;
                            vm.heroLink = $(val.BAHHeroPublishingImageOWSIMGE).attr('href');
                        }
                        //Null reference check for Hero Video
                        if (val.BAHHeroVideoEmbedOWSMTXT) {
                            vm.heroVideo = $(val.BAHHeroVideoEmbedOWSMTXT).attr('src');
                            vm.showVideo = true;
                            vm.heroVideo = vm.heroVideo.replace('autoPlay=false', 'autoPlay=true');
                            vm.heroVideo.indexOf("www.youtube.com") > -1 ? vm.heroVideo += "?autoplay=1&html5=1" : "";
                        }
                        context.vm.slider.push(vm);
                    }
                });
                $.each(context.vm.slider, function (index, val) {
                    val.id = index;
                });
                if (context.vm.slider.length > 5) {
                    context.vm.slider = context.vm.slider.slice(0, 5);
                }
                html = template(context.vm);
                $(context.container).html(html);
                $('.flexslider').each(function () {
                    $(this).flexslider({
                        animation: "move",
                        slideshow: true,
                        slideshowSpeed: 5000,
                        animationSpeed: 600,
                        after: function () { context.stopAllVideos(); }
                    });
                });
            });
        },
        stopAllVideos: function () {
            var context = this;
            $.each(context.vm.slider, function (index, val) {
                $("#peopleHeroVideo-" + val.id).attr('src', "")
                $("#peopleHeroVideo-" + val.id).css({
                    display: 'none',
                });
                $("#platformHeroVideoAside-" + val.id).css({
                    display: 'inline',
                });
            })
            $('.flexslider').each(function () {
                $(this).flexslider("pause");
                $(this).flexslider("play");
            });
        },
        videoPlay: function (id) {
            var context = this;
            $('.flexslider').each(function () {
                $(this).flexslider("pause");
            });
            $.each(context.vm.slider, function (index, val) {
                if (val.id === id) {
                    $("#peopleHeroVideo-" + id).attr('src', val.heroVideo)
                    $("#peopleHeroVideo-" + id).css({
                        display: 'inline',
                    });
                    $("#platformHeroVideoAside-" + id).css({
                        display: 'none',
                    });
                }
            })
        },
        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);
///#source 1 1 Widgets/PlatformPage/platformFileSlider.js
/*  
    NOTE: This will eventually be replaced with - Pages/owlSliderContent.js which will satisfy any owl slider content display
*/
var Widgets = Widgets || {};
(function ($)
{
    Widgets.pagesPlatform = {
        name: 'Pages Platform File Slider',
        log: true,
        data: { widgetTitle: "", id: "", totalCount: 0, minTiles: 0, maxTiles: 0, items: [] },
        configure: function (context)
        {
            var config = {};
            // parse through via each and key name
            config.widget = $(context.container).data("widget");
            config.widgetTitle = $(this.container).data("title");
            config.contentType = $(context.container).data("contenttype");
            config.tag = $(context.container).data("tag");
            config.minTiles = $(context.container).data("mintiles");
            config.maxTiles = $(context.container).data("maxtiles");
            config.template = "#" + $(context.container).data("template");
            return config;
        },
        load: function (options)
        {
            var context = this;
            var content = Widgets.genericHeader;
            var config = this.configure(context);
            this.getData(context, content, config).done(function (data)
            {
                context.updateData(context, data, config);
            });
        },
        getData: function (context, content, config)
        {
            var deferred = new $.Deferred();

            $.when(content.promise).done(function ()
            {
                var dataResults = content.data.results;
                // by content type
                var dataContext = $.grep(dataResults, function (c, i)
                {
                    return (c.ContentType === config.contentType.toString());
                });
                // start populating data
                var data = {};
                data = Widgets.platform.data;
                data.widgetTitle = config.widgetTitle;
                data.minTiles = config.minTiles;
                data.maxTiles = config.maxTiles;
                data.uid = (config.contentType.toString()).toLowerCase().split(" ").join("-");

                $.each(dataContext, function (index, item)
                {
                    data.items[index] = {};
                    // item image 
                    data.items[index].imageUrl = $(item.BAHResourceImageOWSIMGE).attr("src");
                    // title for url link
                    data.items[index].title = item.Title;
                    // url to link to
                    data.items[index].url = item.BAHLinkUrl;
                    data.totalCount++;
                });
                deferred.resolve(data);
            });
            return deferred.promise();
        },
        updateData: function (context, data, config)
        {
            context.renderTemplate(context, data, config);
        },
        renderTemplate: function (context, data, config)
        {
            var template = Handlebars.compile($(config.template).html());
            var html = template(data);
            $(context.container).html(html);
            this.updateDisplay(context, data, config);
        },
        updateDisplay: function (context, data, config)
        {
            var $owl = $("#owl-slider-items");
            $owl.owlCarousel(owlSliderConfig.getConfig(config.minTiles, config.maxTiles));
            // move the controls so we can style them the way we want
            var ctrls = $owl.find('.owl-controls').detach();
            ctrls.appendTo($owl.closest('article').parent());
        },
        fail: function (error, event)
        {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);
///#source 1 1 Widgets/PlatformPage/platformFaqs.js
var Widgets = Widgets || {};
(function ($)
{
    Widgets.platformFaqs = {
        name: 'Platform Faqs',
        log: true,
        configuration: {
            selectProperties: [
            "BAHFunctionalDescriptionOWSHTML",
            "BAHLongURLTitleOWSTEXT",
            "BAHResourceUrl",
            "BAHIconUrlOWSURLH",
            "BAHSortOrder",
            "BAHFunctionalFilter",
            "BAHWidget",
            "BAHFunctionalPageTitle",
            "BAHHeroPublishingImageOWSIMGE",
            "BAHHeroVideoEmbedOWSMTXT",
            "Url",
            "Title",
            "ContentType",
            "BAHSubTitleOWSTEXT",
            "BAHHeroDescriptionOWSHTML",
            "BAHHeroImageOWSHTML",
            "BAHHeroBylineOWSTEXT",
            "BAHSectionDescription5OWSHTML",
            "BAHSectionDescription6OWSHTML",
            "BAHSectionDescription7OWSHTML",
            "BAHSectionDescription8OWSHTML",
            "BAHSectionDescription9OWSHTML",
            "BAHSectionDescription10OWSHTML",
            "BAHSectionTitle1",
            "BAHSectionTitle2",
            "BAHSectionTitle3",
            "BAHSectionTitle4",
            "BAHSectionTitle5",
            "BAHSectionTitle6",
            "BAHSectionTitle7",
            "BAHSectionTitle8",
            "BAHSectionTitle9",
            "BAHSectionTitle10"
            ],
            query: '',
            contentTypes: ['Platform List', 'Functional List'],
        },
        changeAccordionArrow: function (id)
        {
            var arrow = $('#arrow' + id);
            var title = $('#faqTitle' + id);
            var trimmed = $('#faqTitleTrimmed' + id);
            var desc = $('#faqDesc' + id);
            var href = $('#faqHrefTitle' + id);

            if (arrow.hasClass('fa-angle-down'))
            {
                // This item is being expanded
                href.css('background-color', 'white');
                arrow.switchClass('fa-angle-down', 'fa-angle-up');
                title.css('display', 'block');
                trimmed.css('display', 'none');
                desc.switchClass('faq-desc-hide', 'faq-desc-show');
            }
            else
            {
                // This item is being collapsed
                href.css('background-color', '');
                arrow.switchClass('fa-angle-up', 'fa-angle-down');
                title.css('display', 'none');
                trimmed.css('display', 'block');
                desc.switchClass('faq-desc-show', 'faq-desc-hide');
            }

            var arrowCount = document.getElementById('faqAccordion').getElementsByTagName('i').length;

            // Now collapse all items except for the one selected
            for (var i = 1; i < arrowCount + 1; i++)
            {
                if (i != id)
                {
                    $('#faqHrefTitle' + i).css('background-color', '');
                    $('#arrow' + i).switchClass('fa-angle-up', 'fa-angle-down');
                    $('#faqTitle' + i).css('display', 'none');
                    $('#faqTitleTrimmed' + i).css('display', 'block');
                    desc.switchClass('faq-desc-show', 'faq-desc-hide');
                }
            }
        },
        load: function (options)
        {
            var context = this;
            var displayCount = 5;
            var faqContent = {};
            var faqArray = { data: [], FaqTitle: '', FaqLink: '', FaqCount: '' };
            var faqCount = 0;

            var ID = $(context.container).attr('data-section');
            var sectionDesc = "BAHSectionDescription" + ID + "OWSHTML";
            var sectionTitle = "BAHSectionTitle" + ID;

            var template = Handlebars.compile($('#platformFaqsTemplate').html());
            var header = Widgets.genericHeader;
            $.when(header.promise, header.termPromise).done(function ()
            {
                var title = header.data.page[0] ? header.data.page[0][sectionTitle] : '';
                var download = header.data.customProperties.header['faqdownload'];

                faqArray.FaqTitle = title != null && title != undefined ? title : '';
                faqArray.FaqLink = download != null && download != undefined ? download : '';

                $.each(header.data.results, function (index, value)
                {
                    var contentFaq = {};
                    if (value.BAHWidget.indexOf("Platform Faqs") > -1 || value.BAHWidget.indexOf("People Faqs") > -1)
                    {
                        //if (++faqCount > 3) return; // exit function when maximum elements reached

                        var characterLimit = 255; // the maximum number of characters allowed for the trimmed faqTitle
                        var faqTitle = value.Title;
                        var faqTitleTrimmed = Bah.setEllipsis(faqTitle, characterLimit);
                        var faqDesc = value.BAHFunctionalDescriptionOWSHTML;

                        contentFaq.Id = ++faqCount;

                        if (faqCount <= displayCount)
                        {
                            contentFaq.Class = "accordion-navigation"; // expands accordion
                        }
                        else contentFaq.Class = "accordion-navigation faq-hide"; // contracts accordion
                        contentFaq.Title = faqTitle;
                        contentFaq.TitleTrimmed = faqTitleTrimmed;
                        contentFaq.Desc = faqDesc != null && faqDesc != undefined ? faqDesc : '';
                        faqArray.data.push(contentFaq); // add items to object array
                    }
                });

                if (faqCount <= displayCount)
                {
                    faqArray.FaqCount = faqCount;
                }
                else
                {
                    faqArray.FaqCount = displayCount;
                }

                faqContent.faqArray = faqArray;
                html = template(faqContent);
                $(context.container).html(html);

                if (faqCount <= displayCount)
                {
                    $('#peopleFaqLoadMore').css('display', 'none');
                }

                $(document).foundation(); // NECESSARY FOR ACCORDION
                //$('#arrow1').switchClass('fa-angle-down', 'fa-angle-up'); // Expands the first faq by default when page is loaded
            });
        },
        faqLoadMore: function ()
        {
            var displayCount = 5;
            var accordion = document.getElementById('faqAccordion');
            var faqs = accordion.getElementsByTagName('dd');
            var visibleCount = Number($('#faqList').attr('count')); // The current number of visible FAQs
            var faqLength = faqs.length; // The total number of FAQs
            var hiddenCount = faqLength - visibleCount; // the number of hidden FAQs
            var includeCount = hiddenCount < displayCount ? hiddenCount : displayCount;
            var addCount = visibleCount + includeCount;
            for (var i = visibleCount; i < addCount; i++)
            {
                $(faqs[i]).removeClass('faq-hide');
            }
            $('#faqList').attr('count', addCount);
            if (hiddenCount - includeCount == 0) $('#peopleFaqLoadMore').css('display', 'none');
        },
        fail: function (error, event)
        {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);

///#source 1 1 Widgets/Pages/owlSliderContent.js
var owlSliderConfig = owlSliderConfig || {};
(function ($) {
owlSliderConfig = {
    getConfig: function (min, max) {
        var mid = min +1;
        var config = {
            paginationNumbers: false,
            navigation: true,
            autoPlay: false,
            slideSpeed: 300,
            paginationSpeed: 400,
            singleItem: false,
            items: min,
            itemsCustom: false,
            itemsDesktop: [1023, max],
            itemsDesktopSmall: [979, max],
            itemsTablet: [767, max],
            itemsTabletSmall: [620, mid],
            itemsMobile: [479, min],
            singleItem: false,
            itemsScaleUp: false,
            rewindNav: false
        };
        return config;
    },
    getFunctionalLayoutConfig: function (min, max, colDisplay, isMobile) {
        var mid = (colDisplay) ? 1 : min; 
        min = (colDisplay) ? 2 : min; 
        var config = {
            paginationNumbers: false,
            navigation: true,
            autoPlay: false,
            slideSpeed: 300,
            paginationSpeed: 400,
            singleItem: false,
            items: max,
            itemsCustom: false,
            itemsDesktop: [1023, mid],
            itemsDesktopSmall: [979, mid],
            itemsTablet: [767, min],
            itemsTabletSmall: [640, 2],
            itemsMobile: [479, 1],
            singleItem: false,
            itemsScaleUp: false,
            rewindNav: false
        };
        return config;
    },
    getDropDown2: function (min) {
        var config = {
            paginationNumbers: false,
            navigation: true,
            autoPlay: false,
            slideSpeed: 300,
            paginationSpeed: 400,
            singleItem: false,
            items: min,
            itemsCustom: false,
            itemsDesktop: [1023, min],
            itemsDesktopSmall: [979, min],
            itemsTablet: [767, min],
            itemsTabletSmall: [620, min],
            itemsMobile: [479, min],
            singleItem: false,
            itemsScaleUp: false,
            rewindNav: false
        };
        return config;
    }
}
})(jQuery);
///#source 1 1 Widgets/PlatformPage/pagesLeadershipTeam.js
/*  
    NOTE: This will eventually be replaced with - Pages/owlSliderContent.js which will satisfy any owl slider content display
*/
var Widgets = Widgets || {};
(function ($) {
    Widgets.pagesLeadershipTeam = {
        name: 'Pages Leadership Team Slider',
        configuration: {
            selectProperties: [
            "BAHStream",
            "BAHLeader",
            "BAHLeaderOWSUSER",
            "BAHResourceImageOWSIMGE"
            ],
            query: '',
            contentTypes: ['Our Leadership Team'],
        },
        log: true,
        data: { widgetTitle: "", totalCount: 0, minTiles: 0, maxTiles: 0, hideNext: false, showPrevious: true, items: []},
        configure: function(context) {
            var config = {};
            // parse through via each and key name
            config.widgetTitle = $(this.container).data("title");
            config.contentType = $(context.container).data("contenttype");
            /* 10-22-2015 ryan.williams [832868] BUG: Even when maxTiles = 4 & minTiles = 2, it only shows 2 tiles on the left column */
            if ((Bah.isMobile.any() || $(window).width() < 460 ) && $(context.container).data("mintiles") >= 4) {
                config.minTiles = 2;
            } else {
                config.minTiles = $(context.container).data("mintiles");
            }
            config.maxTiles = $(context.container).data("maxtiles");
            config.template = "#" + $(context.container).data("template");
            return config;
        },
        load: function(options) {
            var context = this;
            var content = Widgets.genericHeader;
            var config = this.configure(context);
            this.getData(context, content, config).done(function(data) {
                context.updateData(context, data, config);
            });
        },
        getData : function (context, content, config) {
            var deferred = new $.Deferred();
            var data = [];
            $.when(content.promise).done(function () {
                var dataResults = content.data.results;
                var dataContext = $.grep(dataResults, function(c, i) {
                  return ( c.ContentType === config.contentType.toString() );
                });
                // start populating data
                data = Widgets.pagesLeadershipTeam.data;
                data.widgetTitle = config.widgetTitle;
                data.minTiles = config.minTiles;
                data.maxTiles = config.maxTiles;

                $.each(dataContext, function (index, item) {
                    // get searchable email param from userInfo
                    data.items[index] = {};

                    //The method below does not work because there is a friendly email and a unfriendly email in the AccountName string that is coming back. 
                    //In Bahtest since we use onmircosoft accounts you can use the first email (friendly) but it does not work in production.
                    //For this reason you find both email address and use the second email address which is the one that is usable in both production and bahtest.
                    //data.items[index].email = BahUtilities.remapStringToDataArray(item.BAHLeaderOWSUSER, ["email"], "|")[0]["email"];
                    
                    var temp = item.BAHLeaderOWSUSER.match(/(([a-zA-Z]|[0-9])|([-]|[_]|[.]))+[@](([a-zA-Z0-9])|([-])){2,63}[.](([a-zA-Z0-9]){2,63})+/gi);
                    data.items[index].email = temp[temp.length - 1]

                    // name // BAHLeader
                    data.items[index].name = item.BAHLeader;
                    // imageUrl // BAHResourceImageOWSIMGE
                    // default to upload image, replace with account info if not available
                    if (item.BAHResourceImageOWSIMGE) {
                        data.items[index].imageUrl = $(item.BAHResourceImageOWSIMGE).attr("src");
                    }
                   (data.items[index].email && data.items[index].email != " ") ? 
                                            data.items[index].profileUrl = "/Pages/View-Profile.aspx?user=i%3A0%23.f%7Cmembership%7C" + data.items[index].email 
                                            : data.items[index].profileUrl = "#";
                    
                    // title // can be replaced with BahPrimaryRole or JobTitle from user AccountInfo
                    data.items[index].title = item.Title;
                    data.totalCount++;
                });
                deferred.resolve(data);
            });
            return deferred.promise();
        },
        updateData : function (context, data, config) {
            var updated = 0;
            // writes secondary info from the email address
            // account related info only now
            $.each(data.items, function (i, item) {
                // async call each ensures update item matches intended user
                BahUtilities.getUserAccountProfile(item.email).then( function (results) {
                    var resultsData = BahUtilities.getFirstSharePointSearchResults(results);
                    if (resultsData) { // if a profile exists
                        $.each(resultsData, function (index, item) { 
                            // TODO: genericize this list for replacement see pagesSuccess.js
                            // name // FirstName + LastName
                            if (item.Key === "FirstName") {
                                data.items[i].name = item.Value;
                            }
                            if (item.Key === "LastName") {
                               data.items[i].name += " " + item.Value;
                            }
                            // image // BAHResourceImageOWSIMGE
                            if (item.Key === "BAHResourceImageOWSIMGE" && item.value) {
                                var src = $(leader.leaderImage).attr('src');
                                data.items[i].imageUrl = src;
                            } else {
                                var email = BahUtilities.getSearchableEmailFormat(data.items[i].email, "@", "%40");
                                //Not sure why this is here... You should not need to append '.com' to an email address
                                //email += ".com";
                                var userPhotoPath = "_layouts/15/userphoto.aspx?size=L&accountname=i%3A0%23.f%7Cmembership%7C";
                                data.items[i].imageUrl = "/" + userPhotoPath + email;

                            }
                            if (item.Key === "AccountName") {
                                data.items[i].profileUrl = "/Pages/View-Profile.aspx?user=" + encodeURIComponent(item.Value);
                            }

                            // title // BAHRolePrimary
                            if (item.Key === "BAHRolePrimary" && item.Value) {
                                data.items[i].title = item.Value;
                            } else if (item.Key === "JobTitle" && item.Value) {
                                data.items[i].title = item.Value;
                            }
                        });
                    } else { 
                        // if no account leave current data and disable
                        data.items[i].classes = "disabled";
                    }
                    updated++;
                    // all items have been updated so render
                    if(parseInt(updated) == parseInt(data.items.length)) {
                        context.renderTemplate(context, data, config);
                    }
                });
            });      
        },
        renderTemplate: function (context, data, config) {
            var template = Handlebars.compile($(config.template).html());
            var html = template(data);
            $(context.container).html(html);
            this.updateDisplay(context, data, config);
        },
        updateDisplay: function (context, data, config) {
            var $owl = $("#owl-slider-leadership");
            $owl.owlCarousel(owlSliderConfig.getConfig(config.minTiles, config.maxTiles));
            // move the controls so we can style them the way we want
            var ctrls = $owl.find('.owl-controls').detach();
            ctrls.appendTo($owl.closest('article').parent()); 
        },
        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);
///#source 1 1 Widgets/PlatformPage/pagesSuccess.js
/*  
    NOTE: This will eventually be replaced with - Pages/owlSliderContent.js which will satisfy any owl slider content display
*/
var Widgets = Widgets || {};
(function ($) {
    Widgets.pagesSuccess = {
        name: 'Pages Success Slider',
        log: true,
        data: { widgetTitle: "", id: "", totalCount: 0, minTiles: 0, maxTiles: 0, items: []},
        configure: function(context) {
            var config = {};
            // parse through via each and key name
            config.widget = $(context.container).data("widget");
            config.widgetTitle = $(this.container).data("title");
            config.contentType = $(context.container).data("contenttype");
            config.tag = $(context.container).data("tag");
            config.minTiles = $(context.container).data("mintiles");
            config.maxTiles = $(context.container).data("maxtiles");
            config.template = "#" + $(context.container).data("template");
            return config;
        },
        load: function(options) {
            var context = this;
            var content = Widgets.genericHeader;
            var config = this.configure(context);
            this.getData(context, content, config).done(function(data) {
                context.updateData(context, data, config);
            });
        },
        getData : function (context, content, config) {
            var deferred = new $.Deferred();

            $.when(content.promise).done(function () {
                var dataResults = content.data.results;
                // by content type
                var dataContext = $.grep(dataResults, function(c, i) {
                    return ( c.ContentType === config.contentType.toString() );
                });
                // start populating data
                var data = {};
                data =  Widgets.pagesSuccess.data;
                data.widgetTitle = config.widgetTitle;
                data.minTiles = config.minTiles;
                data.maxTiles = config.maxTiles;
                data.uid = (config.contentType.toString()).toLowerCase().split(" ").join("-");

                $.each(dataContext, function (index, item) {
                    data.items[index] = {};
                    // item image 
                    data.items[index].imageUrl = $(item.BAHResourceImageOWSIMGE).attr("src");
                    // title for url link
                    data.items[index].title = item.Title;
                    // url to link to
                    data.items[index].url = item.BAHLinkUrl;
                    data.totalCount++;
                });
                deferred.resolve(data);
            });
            return deferred.promise();
        },
        updateData : function (context, data, config) {
            context.renderTemplate(context, data, config);
        },
        renderTemplate: function (context, data, config) {
            var template = Handlebars.compile($(config.template).html());
            var html = template(data);
            $(context.container).html(html);
            this.updateDisplay(context, data, config);
        },
        updateDisplay: function (context, data, config) {
            var $owl = $("#owl-slider-items");
            $owl.owlCarousel(owlSliderConfig.getConfig(config.minTiles, config.maxTiles));
            // move the controls so we can style them the way we want
            var ctrls = $owl.find('.owl-controls').detach();
            ctrls.appendTo($owl.closest('article').parent()); 
        },
        fail: function (error, event) {
            Bah.logging.error(event, this.name);
        }
    };
})(jQuery);
